import{$ as tp,A as Mc,B as Ef,C as Af,E as Gu,F as Hu,G as Pf,H as Wu,I as Xu,J as Gt,K as Kh,L as Ic,M as Yh,N as al,O as Df,P as ro,Q as zf,R as Dn,S as Qu,T as sl,U as Lf,V as la,W as ca,X as ep,Y as Tc,Z as Jh,_ as Rf,a as Hh,aa as Xr,ba as ll,da as Ff,ea as Bf,h as yf,i as Wh,j as vf,k as Xh,l as Sc,m as bf,n as io,o as Zu,p as xf,q as wf,r as Ho,s as kf,t as Cf,u as Sf,v as Mf,w as If,x as Wo,y as Tf,z as Xo}from"./chunk-TZKDIJQ3.js";import{$a as kt,$b as Zh,Ab as $h,Ba as Qs,Bb as mf,C as Hr,Cb as qt,Db as ff,Eb as rt,F as sf,Fa as el,Fb as Pn,Gb as hn,Hb as dn,Ib as na,Jb as ji,Kb as qi,L as lf,Lb as aa,Mb as nt,N as ln,Nb as tr,O as No,Ob as Qa,P as Ys,Pb as $o,Q as En,Qa as tl,Qb as gf,Ra as Ye,Rb as qu,S as Ni,Sb as Uu,T as _i,Ua as jo,V as si,Wa as qh,Wb as eo,X as kc,Xa as Uh,Y as me,Yb as Zo,Z as Bu,_ as Ou,_b as to,a as Ka,ab as yi,ac as Gh,bb as Pr,bc as _f,cb as er,da as cf,db as uf,ea as Vu,eb as Cc,f as Mi,fa as Nt,fb as Mt,ga as jt,gc as Go,ha as Nu,ia,j as Er,ja as Ja,jc as $u,k as nf,ka as hf,lb as Zt,mb as Dt,n as Tn,nb as ju,oa as An,ob as Qt,pa as Js,pb as qo,qa as Nh,qb as pf,qc as Ko,r as Vh,ra as df,rb as Yt,rc as oa,s as af,sa as Ar,sb as il,sc as Ku,tb as rl,u as Ya,ub as nl,uc as Wr,va as ra,vb as Ne,vc as ol,w as Gr,wa as jh,wb as $e,wc as sa,xb as cn,xc as Yu,y as of,yb as Uo,yc as Ju,zb as Ii}from"./chunk-J3OCRKPK.js";import{a as Kt,b as In,d as s0,e as rf}from"./chunk-C6Q5SG76.js";var mp=s0((up,pp)=>{"use strict";(function(D,Y){typeof up=="object"&&typeof pp<"u"?pp.exports=Y():typeof define=="function"&&define.amd?define(Y):(D=typeof globalThis<"u"?globalThis:D||self,D.maplibregl=Y())})(up,function(){"use strict";var D={},Y={};function v(y,c,he){if(Y[y]=he,y==="index"){var ze="var sharedModule = {}; ("+Y.shared+")(sharedModule); ("+Y.worker+")(sharedModule);",Je={};return Y.shared(Je),Y.index(D,Je),typeof window<"u"&&D.setWorkerUrl(window.URL.createObjectURL(new Blob([ze],{type:"text/javascript"}))),D}}v("shared",["exports"],function(y){"use strict";function c(i,t,r,a){return new(r||(r=Promise))(function(l,u){function p(x){try{g(a.next(x))}catch(w){u(w)}}function m(x){try{g(a.throw(x))}catch(w){u(w)}}function g(x){var w;x.done?l(x.value):(w=x.value,w instanceof r?w:new r(function(C){C(w)})).then(p,m)}g((a=a.apply(i,t||[])).next())})}function he(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var ze=Je;function Je(i,t){this.x=i,this.y=t}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,t){var r=Math.cos(i),a=Math.sin(i),l=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(i){return i instanceof Je?i:Array.isArray(i)?new Je(i[0],i[1]):i};var ge=he(ze),le=ur;function ur(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}ur.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var p=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?p=r:m=r,r=.5*(m-p)+p;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ei=he(le);let Ui,un;function Kr(){return Ui==null&&(Ui=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ui}function oo(){if(un==null&&(un=!1,Kr())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){let l=4*a;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){un=!0;break}}}return un||!1}function $i(i,t,r,a){let l=new Ei(i,t,r,a);return u=>l.solve(u)}let ml=$i(.25,.1,.25,1);function pr(i,t,r){return Math.min(r,Math.max(t,i))}function Dr(i,t,r){let a=r-t,l=((i-t)%a+a)%a+t;return l===t?r:l}function ir(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}let es=1;function zr(i,t,r){let a={};for(let l in i)a[l]=t.call(this,i[l],l,i);return a}function so(i,t,r){let a={};for(let l in i)t.call(this,i[l],l,i)&&(a[l]=i[l]);return a}function yt(i){return Array.isArray(i)?i.map(yt):typeof i=="object"&&i?zr(i,yt):i}let ts={};function li(i){ts[i]||(typeof console<"u"&&console.warn(i),ts[i]=!0)}function vi(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Yr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let da=null;function Lr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}let is="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Rn(i,t,r,a,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let u=new VideoFrame(i,{timestamp:0});try{let p=u?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);let m=p.startsWith("BGR"),g=new Uint8ClampedArray(a*l*4);if(yield u.copyTo(g,function(x,w,C,T,P){let L=4*Math.max(-w,0),R=(Math.max(0,C)-C)*T*4+L,N=4*T,$=Math.max(0,w),re=Math.max(0,C);return{rect:{x:$,y:re,width:Math.min(x.width,w+T)-$,height:Math.min(x.height,C+P)-re},layout:[{offset:R,stride:N}]}}(i,t,r,a,l)),m)for(let x=0;x<g.length;x+=4){let w=g[x];g[x]=g[x+2],g[x+2]=w}return g}finally{u.close()}})}let Jr,Ai,mr="AbortError";function ua(){return new Error(mr)}let pn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Rr(i){return pn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}let pa="global-dispatcher";class Zi extends Error{constructor(t,r,a,l){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=l}}let fr=()=>Yr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){let a=Rr(i.url);if(a)return a(i,t);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:pa},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(fr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,l){return c(this,void 0,void 0,function*(){let u=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:fr(),signal:l.signal});a.type!=="json"||u.headers.has("Accept")||u.headers.set("Accept","application/json");let p=yield fetch(u);if(!p.ok){let x=yield p.blob();throw new Zi(p.status,p.statusText,a.url,x)}let m;m=a.type==="arrayBuffer"||a.type==="image"?p.arrayBuffer():a.type==="json"?p.json():p.text();let g=yield m;if(l.signal.aborted)throw ua();return{data:g,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(i,t);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:pa},t)}var r;return function(a,l){return new Promise((u,p)=>{var m;let g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(g.responseType="arraybuffer");for(let x in a.headers)g.setRequestHeader(x,a.headers[x]);a.type==="json"&&(g.responseType="text",!((m=a.headers)===null||m===void 0)&&m.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let x=g.response;if(a.type==="json")try{x=JSON.parse(g.response)}catch(w){return void p(w)}u({data:x,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{let x=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});p(new Zi(g.status,g.statusText,a.url,x))}},l.signal.addEventListener("abort",()=>{g.abort(),p(ua())}),g.send(a.body)})}(i,t)};function Bn(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;let t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function lo(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Qr(i,t,r){if(r&&r[i]){let a=r[i].indexOf(t);a!==-1&&r[i].splice(a,1)}}class mn{constructor(t,r={}){ir(this,r),this.type=t}}class fn extends mn{constructor(t,r={}){super("error",ir({error:t},r))}}class ma{on(t,r){return this._listeners=this._listeners||{},lo(t,r,this._listeners),this}off(t,r){return Qr(t,r,this._listeners),Qr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},lo(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new mn(t,r||{}));let a=t.type;if(this.listens(a)){t.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let m of l)m.call(this,t);let u=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let m of u)Qr(a,m,this._oneTimeListeners),m.call(this,t);let p=this._eventedParent;p&&(ir(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof fn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let On=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function co(i,t){let r={};for(let a in i)a!=="ref"&&(r[a]=i[a]);return On.forEach(a=>{a in t&&(r[a]=t[a])}),r}function pt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!pt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(let r in i)if(!pt(i[r],t[r]))return!1;return!0}return i===t}function Lt(i,t){i.push(t)}function ho(i,t,r){Lt(r,{command:"addSource",args:[i,t[i]]})}function gn(i,t,r){Lt(t,{command:"removeSource",args:[i]}),r[i]=!0}function en(i,t,r,a){gn(i,r,a),ho(i,t,r)}function fa(i,t,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!pt(i[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!pt(i[r][a],t[r][a]))return!1;return!0}function rr(i,t,r,a,l,u){i=i||{},t=t||{};for(let p in i)Object.prototype.hasOwnProperty.call(i,p)&&(pt(i[p],t[p])||r.push({command:u,args:[a,p,t[p],l]}));for(let p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(pt(i[p],t[p])||r.push({command:u,args:[a,p,t[p],l]}))}function uo(i){return i.id}function po(i,t){return i[t.id]=t,i}class ye{constructor(t,r,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Fr(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}class bi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Br{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[a,l]of r)this.bindings[a]=l}concat(t){return new Br(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let _n={kind:"null"},we={kind:"number"},et={kind:"string"},Ze={kind:"boolean"},Pi={kind:"color"},gr={kind:"object"},Xe={kind:"value"},Or={kind:"collator"},tn={kind:"formatted"},yn={kind:"padding"},Vr={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function A(i,t){return{kind:"array",itemType:i,N:t}}function E(i){if(i.kind==="array"){let t=E(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let B=[_n,we,et,Ze,Pi,tn,gr,A(Xe),yn,Vr,U];function j(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!j(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let r of B)if(!j(r,t))return null}}return`Expected ${E(i)} but found ${E(t)} instead.`}function K(i,t){return t.some(r=>r.kind===i.kind)}function Q(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ie(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}let H=.96422,ce=.82521,pe=4/29,ae=6/29,ve=3*ae*ae,Ve=ae*ae*ae,je=Math.PI/180,ct=180/Math.PI;function Ke(i){return(i%=360)<0&&(i+=360),i}function ht([i,t,r,a]){let l,u,p=Ht((.2225045*(i=at(i))+.7168786*(t=at(t))+.0606169*(r=at(r)))/1);i===t&&t===r?l=u=p:(l=Ht((.4360747*i+.3850649*t+.1430804*r)/H),u=Ht((.0139322*i+.0971045*t+.7141733*r)/ce));let m=116*p-16;return[m<0?0:m,500*(l-p),200*(p-u),a]}function at(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ht(i){return i>Ve?Math.pow(i,1/3):i/ve+pe}function Rt([i,t,r,a]){let l=(i+16)/116,u=isNaN(t)?l:l+t/500,p=isNaN(r)?l:l-r/200;return l=1*gt(l),u=H*gt(u),p=ce*gt(p),[tt(3.1338561*u-1.6168667*l-.4906146*p),tt(-.9787684*u+1.9161415*l+.033454*p),tt(.0719453*u-.2289914*l+1.4052427*p),a]}function tt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function gt(i){return i>ae?i*i*i:ve*(i-pe)}function zt(i){return parseInt(i.padEnd(2,i),16)/255}function ei(i,t){return ni(t?i/100:i,0,1)}function ni(i,t,r){return Math.min(Math.max(t,i),r)}function xi(i){return!i.some(Number.isNaN)}let ga={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class _t{constructor(t,r,a,l=1,u=!0){this.r=t,this.g=r,this.b=a,this.a=l,u||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,a,l]))}static parse(t){if(t instanceof _t)return t;if(typeof t!="string")return;let r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=ga[a];if(l){let[p,m,g]=l;return[p/255,m/255,g/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let p=a.length<6?1:2,m=1;return[zt(a.slice(m,m+=p)),zt(a.slice(m,m+=p)),zt(a.slice(m,m+=p)),zt(a.slice(m,m+p)||"ff")]}if(a.startsWith("rgb")){let p=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){let[m,g,x,w,C,T,P,L,R,N,$,re]=p,X=[w||" ",P||" ",N].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){let te=[x,T,R].join(""),se=te==="%%%"?100:te===""?255:0;if(se){let fe=[ni(+g/se,0,1),ni(+C/se,0,1),ni(+L/se,0,1),$?ei(+$,re):1];if(xi(fe))return fe}}return}}let u=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(u){let[p,m,g,x,w,C,T,P,L]=u,R=[g||" ",w||" ",T].join("");if(R==="  "||R==="  /"||R===",,"||R===",,,"){let N=[+m,ni(+x,0,100),ni(+C,0,100),P?ei(+P,L):1];if(xi(N))return function([$,re,X,te]){function se(fe){let Te=(fe+$/30)%12,qe=re*Math.min(X,1-X);return X-qe*Math.max(-1,Math.min(Te-3,9-Te,1))}return $=Ke($),re/=100,X/=100,[se(0),se(8),se(4),te]}(N)}}}(t);return r?new _t(...r,!1):void 0}get rgb(){let{r:t,g:r,b:a,a:l}=this,u=l||1/0;return this.overwriteGetter("rgb",[t/u,r/u,a/u,l])}get hcl(){return this.overwriteGetter("hcl",function(t){let[r,a,l,u]=ht(t),p=Math.sqrt(a*a+l*l);return[Math.round(1e4*p)?Ke(Math.atan2(l,a)*ct):NaN,p,r,u]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ht(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,a,l]=this.rgb;return`rgba(${[t,r,a].map(u=>Math.round(255*u)).join(",")},${l})`}}_t.black=new _t(0,0,0,1),_t.white=new _t(1,1,1,1),_t.transparent=new _t(0,0,0,0),_t.red=new _t(1,0,0,1);class fl{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gl{constructor(t,r,a,l,u){this.text=t,this.image=r,this.scale=a,this.fontStack=l,this.textColor=u}}class Gi{constructor(t){this.sections=t}static fromString(t){return new Gi([new gl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Gi?t:Gi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Hi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Hi)return t;if(typeof t=="number")return new Hi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Hi(t)}}toString(){return JSON.stringify(this.values)}}let wd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class nr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof nr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let a=t[r],l=t[r+1];if(typeof a!="string"||!wd.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new nr(t)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Wi({name:t,available:!1}):null}}function _a(i,t,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,r,a]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof _t||i instanceof fl||i instanceof Gi||i instanceof Hi||i instanceof nr||i instanceof Wi)return!0;if(Array.isArray(i)){for(let t of i)if(!Vn(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!Vn(i[t]))return!1;return!0}return!1}function Wt(i){if(i===null)return _n;if(typeof i=="string")return et;if(typeof i=="boolean")return Ze;if(typeof i=="number")return we;if(i instanceof _t)return Pi;if(i instanceof fl)return Or;if(i instanceof Gi)return tn;if(i instanceof Hi)return yn;if(i instanceof nr)return U;if(i instanceof Wi)return Vr;if(Array.isArray(i)){let t=i.length,r;for(let a of i){let l=Wt(a);if(r){if(r===l)continue;r=Xe;break}r=l}return A(r||Xe,t)}return gr}function mo(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof _t||i instanceof Gi||i instanceof Hi||i instanceof nr||i instanceof Wi?i.toString():JSON.stringify(i)}class _r{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Vn(t[1]))return r.error("invalid value");let a=t[1],l=Wt(a),u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new _r(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ut{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let rs={string:et,number:we,boolean:Ze,object:gr};class yr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,l=1,u=t[0];if(u==="array"){let m,g;if(t.length>2){let x=t[1];if(typeof x!="string"||!(x in rs)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=rs[x],l++}else m=Xe;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],l++}a=A(m,g)}else{if(!rs[u])throw new Error(`Types doesn't contain name = ${u}`);a=rs[u]}let p=[];for(;l<t.length;l++){let m=r.parse(t[l],l,Xe);if(!m)return null;p.push(m)}return new yr(a,p)}evaluate(t){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(t);if(!j(this.type,Wt(a)))return a;if(r===this.args.length-1)throw new Ut(`Expected value to be of type ${E(this.type)}, but found ${E(Wt(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let _l={"to-boolean":Ze,"to-color":Pi,"to-number":we,"to-string":et};class vr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[0];if(!_l[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");let l=_l[a],u=[];for(let p=1;p<t.length;p++){let m=r.parse(t[p],p,Xe);if(!m)return null;u.push(m)}return new vr(l,u)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(let l of this.args){if(r=l.evaluate(t),a=null,r instanceof _t)return r;if(typeof r=="string"){let u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:_a(r[0],r[1],r[2],r[3]),!a))return new _t(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ut(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let a of this.args){r=a.evaluate(t);let l=Hi.parse(r);if(l)return l}throw new Ut(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let a of this.args){r=a.evaluate(t);let l=nr.parse(r);if(l)return l}throw new Ut(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let a of this.args){if(r=a.evaluate(t),r===null)return 0;let l=Number(r);if(!isNaN(l))return l}throw new Ut(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Gi.fromString(mo(this.args[0].evaluate(t)));case"resolvedImage":return Wi.fromString(mo(this.args[0].evaluate(t)));default:return mo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let kd=["Unknown","Point","LineString","Polygon"];class ns{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=_t.parse(t)),r}}class Nn{constructor(t,r,a=[],l,u=new Br,p=[]){this.registry=t,this.path=a,this.key=a.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l,this._isConstant=r}parse(t,r,a,l,u={}){return r?this.concat(r,a,l)._parse(t,u):this._parse(t,u)}_parse(t,r){function a(l,u,p){return p==="assert"?new yr(u,[l]):p==="coerce"?new vr(u,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let u=this.registry[l];if(u){let p=u.parse(t,this);if(!p)return null;if(this.expectedType){let m=this.expectedType,g=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(m.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(m,g))return null}else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"assert")}if(!(p instanceof _r)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){let m=new ns;try{p=new _r(p.type,p.evaluate(m))}catch(g){return this.error(g.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){let l=typeof t=="number"?this.path.concat(t):this.path,u=a?this.scope.concat(a):this.scope;return new Nn(this.registry,this._isConstant,l,r||null,u,this.errors)}error(t,...r){let a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new bi(a,t))}checkSubtype(t,r){let a=j(t,r);return a&&this.error(a),a}}class vn{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let u=1;u<t.length-1;u+=2){let p=t[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);let m=r.parse(t[u+1],u+1);if(!m)return null;a.push([p,m])}let l=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return l?new vn(a,l):null}outputDefined(){return this.result.outputDefined()}}class mt{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=t[1];return r.scope.has(a)?new mt(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class yl{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,we),l=r.parse(t[2],2,A(r.expectedType||Xe));return a&&l?new yl(l.type.itemType,a,l):null}evaluate(t){let r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Ut(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ut(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ut(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class vl{constructor(t,r){this.type=Ze,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,Xe);return a&&l?K(a.type,[Ze,et,we,_n,Xe])?new vl(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${E(a.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Q(r,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${E(Wt(r))} instead.`);if(!Q(a,["string","array"]))throw new Ut(`Expected second argument to be of type array or string, but found ${E(Wt(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ya{constructor(t,r,a){this.type=we,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,Xe);if(!a||!l)return null;if(!K(a.type,[Ze,et,we,_n,Xe]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${E(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,we);return u?new ya(a,l,u):null}return new ya(a,l)}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Q(r,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${E(Wt(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Q(a,["string"])){let u=a.indexOf(r,l);return u===-1?-1:[...a.slice(0,u)].length}if(Q(a,["array"]))return a.indexOf(r,l);throw new Ut(`Expected second argument to be of type array or string, but found ${E(Wt(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class bl{constructor(t,r,a,l,u,p){this.inputType=t,this.type=r,this.input=a,this.cases=l,this.outputs=u,this.otherwise=p}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);let u={},p=[];for(let x=2;x<t.length-1;x+=2){let w=t[x],C=t[x+1];Array.isArray(w)||(w=[w]);let T=r.concat(x);if(w.length===0)return T.error("Expected at least one branch label.");for(let L of w){if(typeof L!="number"&&typeof L!="string")return T.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return T.error("Numeric branch labels must be integer values.");if(a){if(T.checkSubtype(a,Wt(L)))return null}else a=Wt(L);if(u[String(L)]!==void 0)return T.error("Branch labels must be unique.");u[String(L)]=p.length}let P=r.parse(C,x,l);if(!P)return null;l=l||P.type,p.push(P)}let m=r.parse(t[1],1,Xe);if(!m)return null;let g=r.parse(t[t.length-1],t.length-1,l);return g?m.type.kind!=="value"&&r.concat(1).checkSubtype(a,m.type)?null:new bl(a,l,m,u,p,g):null}evaluate(t){let r=this.input.evaluate(t);return(Wt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class as{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let l=[];for(let p=1;p<t.length-1;p+=2){let m=r.parse(t[p],p,Ze);if(!m)return null;let g=r.parse(t[p+1],p+1,a);if(!g)return null;l.push([m,g]),a=a||g.type}let u=r.parse(t[t.length-1],t.length-1,a);if(!u)return null;if(!a)throw new Error("Can't infer output type");return new as(a,l,u)}evaluate(t){for(let[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class fo{constructor(t,r,a,l){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,we);if(!a||!l)return null;if(!K(a.type,[A(Xe),et,Xe]))return r.error(`Expected first argument to be of type array or string, but found ${E(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,we);return u?new fo(a.type,a,l,u):null}return new fo(a.type,a,l)}evaluate(t){let r=this.input.evaluate(t),a=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Q(r,["string"]))return[...r].slice(a,l).join("");if(Q(r,["array"]))return r.slice(a,l);throw new Ut(`Expected first argument to be of type array or string, but found ${E(Wt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function os(i,t){let r=i.length-1,a,l,u=0,p=r,m=0;for(;u<=p;)if(m=Math.floor((u+p)/2),a=i[m],l=i[m+1],a<=t){if(m===r||t<l)return m;u=m+1}else{if(!(a>t))throw new Ut("Input is not a number.");p=m-1}return 0}class va{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[l,u]of a)this.labels.push(l),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(t[1],1,we);if(!a)return null;let l=[],u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<t.length;p+=2){let m=p===1?-1/0:t[p],g=t[p+1],x=p,w=p+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let C=r.parse(g,w,u);if(!C)return null;u=u||C.type,l.push([m,C])}return new va(u,a,l)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;return l>=r[u-1]?a[u-1].evaluate(t):a[os(r,l)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Cd=Oc;function Oc(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}Oc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var p=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?p=r:m=r,r=.5*(m-p)+p;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Sd=Bc(Cd);function jn(i,t,r){return i+r*(t-i)}function go(i,t,r){return i.map((a,l)=>jn(a,t[l],r))}let Di={number:jn,color:function(i,t,r,a="rgb"){switch(a){case"rgb":{let[l,u,p,m]=go(i.rgb,t.rgb,r);return new _t(l,u,p,m,!1)}case"hcl":{let[l,u,p,m]=i.hcl,[g,x,w,C]=t.hcl,T,P;if(isNaN(l)||isNaN(g))isNaN(l)?isNaN(g)?T=NaN:(T=g,p!==1&&p!==0||(P=x)):(T=l,w!==1&&w!==0||(P=u));else{let re=g-l;g>l&&re>180?re-=360:g<l&&l-g>180&&(re+=360),T=l+r*re}let[L,R,N,$]=function([re,X,te,se]){return re=isNaN(re)?0:re*je,Rt([te,Math.cos(re)*X,Math.sin(re)*X,se])}([T,P??jn(u,x,r),jn(p,w,r),jn(m,C,r)]);return new _t(L,R,N,$,!1)}case"lab":{let[l,u,p,m]=Rt(go(i.lab,t.lab,r));return new _t(l,u,p,m,!1)}}},array:go,padding:function(i,t,r){return new Hi(go(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){let a=i.values,l=t.values;if(a.length!==l.length)throw new Ut(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);let u=[];for(let p=0;p<a.length;p+=2){if(a[p]!==l[p])throw new Ut(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${a[p]}, to[${p}]: ${l[p]}`);u.push(a[p]);let[m,g]=a[p+1],[x,w]=l[p+1];u.push([jn(m,x,r),jn(g,w,r)])}return new nr(u)}};class zi{constructor(t,r,a,l,u){this.type=t,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[p,m]of u)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(t,r,a,l){let u=0;if(t.name==="exponential")u=ss(r,t.base,a,l);else if(t.name==="linear")u=ss(r,1,a,l);else if(t.name==="cubic-bezier"){let p=t.controlPoints;u=new Sd(p[0],p[1],p[2],p[3]).solve(ss(r,1,a,l))}return u}static parse(t,r){let[a,l,u,...p]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let x=l[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let x=l.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,we),!u)return null;let m=[],g=null;a==="interpolate-hcl"||a==="interpolate-lab"?g=Pi:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let x=0;x<p.length;x+=2){let w=p[x],C=p[x+1],T=x+3,P=x+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);let L=r.parse(C,P,g);if(!L)return null;g=g||L.type,m.push([w,L])}return ie(g,we)||ie(g,Pi)||ie(g,yn)||ie(g,U)||ie(g,A(we))?new zi(g,a,l,u,m):r.error(`Type ${E(g)} is not interpolatable.`)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;if(l>=r[u-1])return a[u-1].evaluate(t);let p=os(r,l),m=zi.interpolationFactor(this.interpolation,l,r[p],r[p+1]),g=a[p].evaluate(t),x=a[p+1].evaluate(t);switch(this.operator){case"interpolate":return Di[this.type.kind](g,x,m);case"interpolate-hcl":return Di.color(g,x,m,"hcl");case"interpolate-lab":return Di.color(g,x,m,"lab")}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ss(i,t,r,a){let l=a-r,u=i-r;return l===0?0:t===1?u/l:(Math.pow(t,u)-1)/(Math.pow(t,l)-1)}class ls{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null,l=r.expectedType;l&&l.kind!=="value"&&(a=l);let u=[];for(let m of t.slice(1)){let g=r.parse(m,1+u.length,a,void 0,{typeAnnotation:"omit"});if(!g)return null;a=a||g.type,u.push(g)}if(!a)throw new Error("No output type");let p=l&&u.some(m=>j(l,m.type));return new ls(p?Xe:a,u)}evaluate(t){let r,a=null,l=0;for(let u of this.args)if(l++,a=u.evaluate(t),a&&a instanceof Wi&&!a.available&&(r||(r=a.name),a=null,l===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function cs(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Vc(i,t,r,a){return a.compare(t,r)===0}function ba(i,t,r){let a=i!=="=="&&i!=="!=";return class sg{constructor(u,p,m){this.type=Ze,this.lhs=u,this.rhs=p,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");let m=u[0],g=p.parse(u[1],1,Xe);if(!g)return null;if(!cs(m,g.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${E(g.type)}'.`);let x=p.parse(u[2],2,Xe);if(!x)return null;if(!cs(m,x.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${E(x.type)}'.`);if(g.type.kind!==x.type.kind&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error(`Cannot compare types '${E(g.type)}' and '${E(x.type)}'.`);a&&(g.type.kind==="value"&&x.type.kind!=="value"?g=new yr(x.type,[g]):g.type.kind!=="value"&&x.type.kind==="value"&&(x=new yr(g.type,[x])));let w=null;if(u.length===4){if(g.type.kind!=="string"&&x.type.kind!=="string"&&g.type.kind!=="value"&&x.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(w=p.parse(u[3],3,Or),!w)return null}return new sg(g,x,w)}evaluate(u){let p=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(a&&this.hasUntypedArgument){let g=Wt(p),x=Wt(m);if(g.kind!==x.kind||g.kind!=="string"&&g.kind!=="number")throw new Ut(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${x.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let g=Wt(p),x=Wt(m);if(g.kind!=="string"||x.kind!=="string")return t(u,p,m)}return this.collator?r(u,p,m,this.collator.evaluate(u)):t(u,p,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}let Md=ba("==",function(i,t,r){return t===r},Vc),Nc=ba("!=",function(i,t,r){return t!==r},function(i,t,r,a){return!Vc(0,t,r,a)}),jc=ba("<",function(i,t,r){return t<r},function(i,t,r,a){return a.compare(t,r)<0}),Id=ba(">",function(i,t,r){return t>r},function(i,t,r,a){return a.compare(t,r)>0}),Td=ba("<=",function(i,t,r){return t<=r},function(i,t,r,a){return a.compare(t,r)<=0}),qc=ba(">=",function(i,t,r){return t>=r},function(i,t,r,a){return a.compare(t,r)>=0});class _o{constructor(t,r,a){this.type=Or,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ze);if(!l)return null;let u=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ze);if(!u)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,et),!p)?null:new _o(l,u,p)}evaluate(t){return new fl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class xl{constructor(t,r,a,l,u){this.type=et,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let a=r.parse(t[1],1,we);if(!a)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,et),!u))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,et),!p))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,we),!m))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,we),!g)?null:new xl(a,u,p,m,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class hs{constructor(t){this.type=tn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let l=[],u=!1;for(let p=1;p<=t.length-1;++p){let m=t[p];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let g=null;if(m["font-scale"]&&(g=r.parse(m["font-scale"],1,we),!g))return null;let x=null;if(m["text-font"]&&(x=r.parse(m["text-font"],1,A(et)),!x))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,Pi),!w))return null;let C=l[l.length-1];C.scale=g,C.font=x,C.textColor=w}else{let g=r.parse(t[p],1,Xe);if(!g)return null;let x=g.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new hs(l)}evaluate(t){return new Gi(this.sections.map(r=>{let a=r.content.evaluate(t);return Wt(a)===Vr?new gl("",a,null,null,null):new gl(mo(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class wl{constructor(t){this.type=Vr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let a=r.parse(t[1],1,et);return a?new wl(a):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),a=Wi.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class kl{constructor(t){this.type=we,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${E(a.type)} instead.`):new kl(a):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Ut(`Expected value to be of type string or array, but found ${E(Wt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Nr=8192;function Ed(i,t){let r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*Nr),Math.round(a*l*Nr)]}function Cl(i,t){let r=Math.pow(2,t.z);return[(l=(i[0]/Nr+t.x)/r,360*l-180),(a=(i[1]/Nr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function qn(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function bn(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function ft(i,t,r){let a=i[0]-t[0],l=i[1]-t[1],u=i[0]-r[0],p=i[1]-r[1];return a*p-u*l==0&&a*u<=0&&l*p<=0}function ds(i,t,r,a){return(l=[a[0]-r[0],a[1]-r[1]])[0]*(u=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*u[0]!=0&&!(!$c(i,t,r,a)||!$c(r,a,i,t));var l,u}function Ad(i,t,r){for(let a of r)for(let l=0;l<a.length-1;++l)if(ds(i,t,a[l],a[l+1]))return!0;return!1}function xa(i,t,r=!1){let a=!1;for(let m of t)for(let g=0;g<m.length-1;g++){if(ft(i,m[g],m[g+1]))return r;(u=m[g])[1]>(l=i)[1]!=(p=m[g+1])[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(a=!a)}var l,u,p;return a}function Pd(i,t){for(let r of t)if(xa(i,r))return!0;return!1}function Uc(i,t){for(let r of i)if(!xa(r,t))return!1;for(let r=0;r<i.length-1;++r)if(Ad(i[r],i[r+1],t))return!1;return!0}function Dd(i,t){for(let r of t)if(Uc(i,r))return!0;return!1}function $c(i,t,r,a){let l=a[0]-r[0],u=a[1]-r[1],p=(i[0]-r[0])*u-l*(i[1]-r[1]),m=(t[0]-r[0])*u-l*(t[1]-r[1]);return p>0&&m<0||p<0&&m>0}function Sl(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=[];for(let p=0;p<i[l].length;p++){let m=Ed(i[l][p],r);qn(t,m),u.push(m)}a.push(u)}return a}function Zc(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=Sl(i[l],t,r);a.push(u)}return a}function Gc(i,t,r,a){if(i[0]<r[0]||i[0]>r[2]){let l=.5*a,u=i[0]-r[0]>l?-a:r[0]-i[0]>l?a:0;u===0&&(u=i[0]-r[2]>l?-a:r[2]-i[0]>l?a:0),i[0]+=u}qn(t,i)}function Hc(i,t,r,a){let l=Math.pow(2,a.z)*Nr,u=[a.x*Nr,a.y*Nr],p=[];for(let m of i)for(let g of m){let x=[g.x+u[0],g.y+u[1]];Gc(x,t,r,l),p.push(x)}return p}function Wc(i,t,r,a){let l=Math.pow(2,a.z)*Nr,u=[a.x*Nr,a.y*Nr],p=[];for(let g of i){let x=[];for(let w of g){let C=[w.x+u[0],w.y+u[1]];qn(t,C),x.push(C)}p.push(x)}if(t[2]-t[0]<=l/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let g of p)for(let x of g)Gc(x,t,r,l)}var m;return p}class Un{constructor(t,r){this.type=Ze,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Vn(t[1])){let a=t[1];if(a.type==="FeatureCollection"){let l=[];for(let u of a.features){let{type:p,coordinates:m}=u.geometry;p==="Polygon"&&l.push(m),p==="MultiPolygon"&&l.push(...m)}if(l.length)return new Un(a,{type:"MultiPolygon",coordinates:l})}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Un(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Un(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(a.type==="Polygon"){let m=Sl(a.coordinates,u,p),g=Hc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let x of g)if(!xa(x,m))return!1}if(a.type==="MultiPolygon"){let m=Zc(a.coordinates,u,p),g=Hc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let x of g)if(!Pd(x,m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(a.type==="Polygon"){let m=Sl(a.coordinates,u,p),g=Wc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let x of g)if(!Uc(x,m))return!1}if(a.type==="MultiPolygon"){let m=Zc(a.coordinates,u,p),g=Wc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let x of g)if(!Dd(x,m))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xc=class{constructor(i=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:t,compare:r}=this,a=t[i];for(;i>0;){let l=i-1>>1,u=t[l];if(r(a,u)>=0)break;t[i]=u,i=l}t[i]=a}_down(i){let{data:t,compare:r}=this,a=this.length>>1,l=t[i];for(;i<a;){let u=1+(i<<1),p=u+1;if(p<this.length&&r(t[p],t[u])<0&&(u=p),r(t[u],l)>=0)break;t[i]=t[u],i=u}t[i]=l}};function zd(i,t,r,a,l){Kc(i,t,r,a||i.length-1,l||Ld)}function Kc(i,t,r,a,l){for(;a>r;){if(a-r>600){var u=a-r+1,p=t-r+1,m=Math.log(u),g=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*g*(u-g)/u)*(p-u/2<0?-1:1);Kc(i,t,Math.max(r,Math.floor(t-p*g/u+x)),Math.min(a,Math.floor(t+(u-p)*g/u+x)),l)}var w=i[t],C=r,T=a;for(yo(i,r,t),l(i[a],w)>0&&yo(i,r,a);C<T;){for(yo(i,C,T),C++,T--;l(i[C],w)<0;)C++;for(;l(i[T],w)>0;)T--}l(i[r],w)===0?yo(i,r,T):yo(i,++T,a),T<=t&&(r=T+1),t<=T&&(a=T-1)}}function yo(i,t,r){var a=i[t];i[t]=i[r],i[r]=a}function Ld(i,t){return i<t?-1:i>t?1:0}function us(i,t){if(i.length<=1)return[i];let r=[],a,l;for(let u of i){let p=Fd(u);p!==0&&(u.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(a&&r.push(a),a=[u]):a.push(u))}if(a&&r.push(a),t>1)for(let u=0;u<r.length;u++)r[u].length<=t||(zd(r[u],t,1,r[u].length-1,Rd),r[u]=r[u].slice(0,t));return r}function Rd(i,t){return t.area-i.area}function Fd(i){let t=0;for(let r,a,l=0,u=i.length,p=u-1;l<u;p=l++)r=i[l],a=i[p],t+=(a.x-r.x)*(r.y+a.y);return t}let Yc=1/298.257223563,Jc=Yc*(2-Yc),Qc=Math.PI/180;class Ml{constructor(t){let r=6378.137*Qc*1e3,a=Math.cos(t*Qc),l=1/(1-Jc*(1-a*a)),u=Math.sqrt(l);this.kx=r*u*a,this.ky=r*u*l*(1-Jc)}distance(t,r){let a=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+l*l)}pointOnLine(t,r){let a,l,u,p,m=1/0;for(let g=0;g<t.length-1;g++){let x=t[g][0],w=t[g][1],C=this.wrap(t[g+1][0]-x)*this.kx,T=(t[g+1][1]-w)*this.ky,P=0;C===0&&T===0||(P=(this.wrap(r[0]-x)*this.kx*C+(r[1]-w)*this.ky*T)/(C*C+T*T),P>1?(x=t[g+1][0],w=t[g+1][1]):P>0&&(x+=C/this.kx*P,w+=T/this.ky*P)),C=this.wrap(r[0]-x)*this.kx,T=(r[1]-w)*this.ky;let L=C*C+T*T;L<m&&(m=L,a=x,l=w,u=g,p=P)}return{point:[a,l],index:u,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function eh(i,t){return t[0]-i[0]}function ps(i){return i[1]-i[0]+1}function rn(i,t){return i[1]>=i[0]&&i[1]<t}function Il(i,t){if(i[0]>i[1])return[null,null];let r=ps(i);if(t){if(r===2)return[i,null];let l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];let a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function Tl(i,t){if(!rn(t,i.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)qn(r,i[a]);return r}function El(i){let t=[1/0,1/0,-1/0,-1/0];for(let r of i)for(let a of r)qn(t,a);return t}function ms(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Al(i,t,r){if(!ms(i)||!ms(t))return NaN;let a=0,l=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[a,l])}function $n(i,t,r){let a=r.pointOnLine(t,i);return r.distance(i,a.point)}function Pl(i,t,r,a,l){let u=Math.min($n(i,[r,a],l),$n(t,[r,a],l)),p=Math.min($n(r,[i,t],l),$n(a,[i,t],l));return Math.min(u,p)}function Bd(i,t,r,a,l){if(!rn(t,i.length)||!rn(a,r.length))return 1/0;let u=1/0;for(let p=t[0];p<t[1];++p){let m=i[p],g=i[p+1];for(let x=a[0];x<a[1];++x){let w=r[x],C=r[x+1];if(ds(m,g,w,C))return 0;u=Math.min(u,Pl(m,g,w,C,l))}}return u}function Bt(i,t,r,a,l){if(!rn(t,i.length)||!rn(a,r.length))return NaN;let u=1/0;for(let p=t[0];p<=t[1];++p)for(let m=a[0];m<=a[1];++m)if(u=Math.min(u,l.distance(i[p],r[m])),u===0)return u;return u}function Od(i,t,r){if(xa(i,t,!0))return 0;let a=1/0;for(let l of t){let u=l[0],p=l[l.length-1];if(u!==p&&(a=Math.min(a,$n(i,[p,u],r)),a===0))return a;let m=r.pointOnLine(l,i);if(a=Math.min(a,r.distance(i,m.point)),a===0)return a}return a}function it(i,t,r,a){if(!rn(t,i.length))return NaN;for(let u=t[0];u<=t[1];++u)if(xa(i[u],r,!0))return 0;let l=1/0;for(let u=t[0];u<t[1];++u){let p=i[u],m=i[u+1];for(let g of r)for(let x=0,w=g.length,C=w-1;x<w;C=x++){let T=g[C],P=g[x];if(ds(p,m,T,P))return 0;l=Math.min(l,Pl(p,m,T,P,a))}}return l}function fs(i,t){for(let r of i)for(let a of r)if(xa(a,t,!0))return!0;return!1}function Ct(i,t,r,a=1/0){let l=El(i),u=El(t);if(a!==1/0&&Al(l,u,r)>=a)return a;if(bn(l,u)){if(fs(i,t))return 0}else if(fs(t,i))return 0;let p=1/0;for(let m of i)for(let g=0,x=m.length,w=x-1;g<x;w=g++){let C=m[w],T=m[g];for(let P of t)for(let L=0,R=P.length,N=R-1;L<R;N=L++){let $=P[N],re=P[L];if(ds(C,T,$,re))return 0;p=Math.min(p,Pl(C,T,$,re,r))}}return p}function vt(i,t,r,a,l,u){if(!u)return;let p=Al(Tl(a,u),l,r);p<t&&i.push([p,u,[0,0]])}function Zn(i,t,r,a,l,u,p){if(!u||!p)return;let m=Al(Tl(a,u),Tl(l,p),r);m<t&&i.push([m,u,p])}function vo(i,t,r,a,l=1/0){let u=Math.min(a.distance(i[0],r[0][0]),l);if(u===0)return u;let p=new Xc([[0,[0,i.length-1],[0,0]]],eh),m=El(r);for(;p.length>0;){let g=p.pop();if(g[0]>=u)continue;let x=g[1],w=t?50:100;if(ps(x)<=w){if(!rn(x,i.length))return NaN;if(t){let C=it(i,x,r,a);if(isNaN(C)||C===0)return C;u=Math.min(u,C)}else for(let C=x[0];C<=x[1];++C){let T=Od(i[C],r,a);if(u=Math.min(u,T),u===0)return 0}}else{let C=Il(x,t);vt(p,u,a,i,m,C[0]),vt(p,u,a,i,m,C[1])}}return u}function bo(i,t,r,a,l,u=1/0){let p=Math.min(u,l.distance(i[0],r[0]));if(p===0)return p;let m=new Xc([[0,[0,i.length-1],[0,r.length-1]]],eh);for(;m.length>0;){let g=m.pop();if(g[0]>=p)continue;let x=g[1],w=g[2],C=t?50:100,T=a?50:100;if(ps(x)<=C&&ps(w)<=T){if(!rn(x,i.length)&&rn(w,r.length))return NaN;let P;if(t&&a)P=Bd(i,x,r,w,l),p=Math.min(p,P);else if(t&&!a){let L=i.slice(x[0],x[1]+1);for(let R=w[0];R<=w[1];++R)if(P=$n(r[R],L,l),p=Math.min(p,P),p===0)return p}else if(!t&&a){let L=r.slice(w[0],w[1]+1);for(let R=x[0];R<=x[1];++R)if(P=$n(i[R],L,l),p=Math.min(p,P),p===0)return p}else P=Bt(i,x,r,w,l),p=Math.min(p,P)}else{let P=Il(x,t),L=Il(w,a);Zn(m,p,l,i,r,P[0],L[0]),Zn(m,p,l,i,r,P[0],L[1]),Zn(m,p,l,i,r,P[1],L[0]),Zn(m,p,l,i,r,P[1],L[1])}}return p}function Dl(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Gn{constructor(t,r){this.type=we,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Vn(t[1])){let a=t[1];if(a.type==="FeatureCollection")return new Gn(a,a.features.map(l=>Dl(l.geometry)).flat());if(a.type==="Feature")return new Gn(a,Dl(a.geometry));if("type"in a&&"coordinates"in a)return new Gn(a,Dl(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>Cl([g.x,g.y],r.canonical));if(l.length===0)return NaN;let p=new Ml(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,bo(u,!1,[g.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,bo(u,!1,g.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,vo(u,!1,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>Cl([g.x,g.y],r.canonical));if(l.length===0)return NaN;let p=new Ml(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,bo(u,!0,[g.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,bo(u,!0,g.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,vo(u,!0,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,a){let l=r.geometry();if(l.length===0||l[0].length===0)return NaN;let u=us(l,0).map(g=>g.map(x=>x.map(w=>Cl([w.x,w.y],r.canonical)))),p=new Ml(u[0][0][0][1]),m=1/0;for(let g of a)for(let x of u){switch(g.type){case"Point":m=Math.min(m,vo([g.coordinates],!1,x,p,m));break;case"LineString":m=Math.min(m,vo(g.coordinates,!0,x,p,m));break;case"Polygon":m=Math.min(m,Ct(x,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let wa={"==":Md,"!=":Nc,">":Id,"<":jc,">=":qc,"<=":Td,array:yr,at:yl,boolean:yr,case:as,coalesce:ls,collator:_o,format:hs,image:wl,in:vl,"index-of":ya,interpolate:zi,"interpolate-hcl":zi,"interpolate-lab":zi,length:kl,let:vn,literal:_r,match:bl,number:yr,"number-format":xl,object:yr,slice:fo,step:va,string:yr,"to-boolean":vr,"to-color":vr,"to-number":vr,"to-string":vr,var:mt,within:Un,distance:Gn};class ar{constructor(t,r,a,l){this.name=t,this.type=r,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let a=t[0],l=ar.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=p.filter(([x])=>!Array.isArray(x)||x.length===t.length-1),g=null;for(let[x,w]of m){g=new Nn(r.registry,xo,r.path,null,r.scope);let C=[],T=!1;for(let P=1;P<t.length;P++){let L=t[P],R=Array.isArray(x)?x[P-1]:x.type,N=g.parse(L,1+C.length,R);if(!N){T=!0;break}C.push(N)}if(!T)if(Array.isArray(x)&&x.length!==C.length)g.error(`Expected ${x.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){let L=Array.isArray(x)?x[P]:x.type,R=C[P];g.concat(P+1).checkSubtype(L,R.type)}if(g.errors.length===0)return new ar(a,u,w,C)}}if(m.length===1)r.errors.push(...g.errors);else{let x=(m.length?m:p).map(([C])=>{return T=C,Array.isArray(T)?`(${T.map(E).join(", ")})`:`(${E(T.type)}...)`;var T}).join(" | "),w=[];for(let C=1;C<t.length;C++){let T=r.parse(t[C],1+w.length);if(!T)return null;w.push(E(T.type))}r.error(`Expected arguments of type ${x}, but found (${w.join(", ")}) instead.`)}return null}static register(t,r){ar.definitions=r;for(let a in r)t[a]=ar}}function zl(i,[t,r,a,l]){t=t.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);let u=l?l.evaluate(i):1,p=_a(t,r,a,u);if(p)throw new Ut(p);return new _t(t/255,r/255,a/255,u,!1)}function Ll(i,t){return i in t}function Rl(i,t){let r=t[i];return r===void 0?null:r}function Hn(i){return{type:i}}function xo(i){if(i instanceof mt)return xo(i.boundExpression);if(i instanceof ar&&i.name==="error"||i instanceof _o||i instanceof Un||i instanceof Gn)return!1;let t=i instanceof vr||i instanceof yr,r=!0;return i.eachChild(a=>{r=t?r&&xo(a):r&&a instanceof _r}),!!r&&wo(i)&&ko(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wo(i){if(i instanceof ar&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Un||i instanceof Gn)return!1;let t=!0;return i.eachChild(r=>{t&&!wo(r)&&(t=!1)}),t}function ka(i){if(i instanceof ar&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!ka(r)&&(t=!1)}),t}function ko(i,t){if(i instanceof ar&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!ko(a,t)&&(r=!1)}),r}function gs(i){return{result:"success",value:i}}function Ca(i){return{result:"error",value:i}}function Sa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function th(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Fl(i){return!!i.expression&&i.expression.interpolated}function dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function _s(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Vd(i){return i}function ih(i,t){let r=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",l=a||!(a||i.property!==void 0),u=i.type||(Fl(t)?"exponential":"interval");if(r||t.type==="padding"){let w=r?_t.parse:Hi.parse;(i=Fr({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],w(C[1])])),i.default=w(i.default?i.default:t.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let m,g,x;if(u==="exponential")m=nh;else if(u==="interval")m=ys;else if(u==="categorical"){m=rh,g=Object.create(null);for(let w of i.stops)g[w[0]]=w[1];x=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=ah}if(a){let w={},C=[];for(let L=0;L<i.stops.length;L++){let R=i.stops[L],N=R[0].zoom;w[N]===void 0&&(w[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},C.push(N)),w[N].stops.push([R[0].value,R[1]])}let T=[];for(let L of C)T.push([w[L].zoom,ih(w[L],t)]);let P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:zi.interpolationFactor.bind(void 0,P),zoomStops:T.map(L=>L[0]),evaluate:({zoom:L},R)=>nh({stops:T,base:i.base},t,L).evaluate(L,R)}}if(l){let w=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:zi.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,t,C,g,x)}}return{kind:"source",evaluate(w,C){let T=C&&C.properties?C.properties[i.property]:void 0;return T===void 0?Ma(i.default,t.default):m(i,t,T,g,x)}}}function Ma(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function rh(i,t,r,a,l){return Ma(typeof r===l?a[r]:void 0,i.default,t.default)}function ys(i,t,r){if(dt(r)!=="number")return Ma(i.default,t.default);let a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];let l=os(i.stops.map(u=>u[0]),r);return i.stops[l][1]}function nh(i,t,r){let a=i.base!==void 0?i.base:1;if(dt(r)!=="number")return Ma(i.default,t.default);let l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];let u=os(i.stops.map(w=>w[0]),r),p=function(w,C,T,P){let L=P-T,R=w-T;return L===0?0:C===1?R/L:(Math.pow(C,R)-1)/(Math.pow(C,L)-1)}(r,a,i.stops[u][0],i.stops[u+1][0]),m=i.stops[u][1],g=i.stops[u+1][1],x=Di[t.type]||Vd;return typeof m.evaluate=="function"?{evaluate(...w){let C=m.evaluate.apply(void 0,w),T=g.evaluate.apply(void 0,w);if(C!==void 0&&T!==void 0)return x(C,T,p,i.colorSpace)}}:x(m,g,p,i.colorSpace)}function ah(i,t,r){switch(t.type){case"color":r=_t.parse(r);break;case"formatted":r=Gi.fromString(r.toString());break;case"resolvedImage":r=Wi.fromString(r.toString());break;case"padding":r=Hi.parse(r);break;default:dt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Ma(r,i.default,t.default)}ar.register(wa,{error:[{kind:"error"},[et],(i,[t])=>{throw new Ut(t.evaluate(i))}],typeof:[et,[Xe],(i,[t])=>E(Wt(t.evaluate(i)))],"to-rgba":[A(we,4),[Pi],(i,[t])=>{let[r,a,l,u]=t.evaluate(i).rgb;return[255*r,255*a,255*l,u]}],rgb:[Pi,[we,we,we],zl],rgba:[Pi,[we,we,we,we],zl],has:{type:Ze,overloads:[[[et],(i,[t])=>Ll(t.evaluate(i),i.properties())],[[et,gr],(i,[t,r])=>Ll(t.evaluate(i),r.evaluate(i))]]},get:{type:Xe,overloads:[[[et],(i,[t])=>Rl(t.evaluate(i),i.properties())],[[et,gr],(i,[t,r])=>Rl(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Xe,[et],(i,[t])=>Rl(t.evaluate(i),i.featureState||{})],properties:[gr,[],i=>i.properties()],"geometry-type":[et,[],i=>i.geometryType()],id:[Xe,[],i=>i.id()],zoom:[we,[],i=>i.globals.zoom],"heatmap-density":[we,[],i=>i.globals.heatmapDensity||0],"line-progress":[we,[],i=>i.globals.lineProgress||0],accumulated:[Xe,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[we,Hn(we),(i,t)=>{let r=0;for(let a of t)r+=a.evaluate(i);return r}],"*":[we,Hn(we),(i,t)=>{let r=1;for(let a of t)r*=a.evaluate(i);return r}],"-":{type:we,overloads:[[[we,we],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[we],(i,[t])=>-t.evaluate(i)]]},"/":[we,[we,we],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[we,[we,we],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[we,[],()=>Math.LN2],pi:[we,[],()=>Math.PI],e:[we,[],()=>Math.E],"^":[we,[we,we],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[we,[we],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[we,[we],(i,[t])=>Math.log(t.evaluate(i))],log2:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[we,[we],(i,[t])=>Math.sin(t.evaluate(i))],cos:[we,[we],(i,[t])=>Math.cos(t.evaluate(i))],tan:[we,[we],(i,[t])=>Math.tan(t.evaluate(i))],asin:[we,[we],(i,[t])=>Math.asin(t.evaluate(i))],acos:[we,[we],(i,[t])=>Math.acos(t.evaluate(i))],atan:[we,[we],(i,[t])=>Math.atan(t.evaluate(i))],min:[we,Hn(we),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[we,Hn(we),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[we,[we],(i,[t])=>Math.abs(t.evaluate(i))],round:[we,[we],(i,[t])=>{let r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[we,[we],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[we,[we],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ze,[et,Xe],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Ze,[Xe],(i,[t])=>i.id()===t.value],"filter-type-==":[Ze,[et],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Ze,[Xe],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ze,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ze,[A(et)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ze,[A(Xe)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ze,[et,A(Xe)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ze,[et,A(Xe)],(i,[t,r])=>function(a,l,u,p){for(;u<=p;){let m=u+p>>1;if(l[m]===a)return!0;l[m]>a?p=m-1:u=m+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Hn(Ze),(i,t)=>{for(let r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Hn(Ze),(i,t)=>{for(let r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Ze,[Ze],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ze,[et],(i,[t])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[et,[et],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[et,[et],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[et,Hn(Xe),(i,t)=>t.map(r=>mo(r.evaluate(i))).join("")],"resolved-locale":[et,[Or],(i,[t])=>t.evaluate(i).resolvedLocale()]});class vs{constructor(t,r){var a;this.expression=t,this._warningHistory={},this._evaluator=new ns,this._defaultValue=r?(a=r).type==="color"&&_s(a.default)?new _t(0,0,0,0):a.type==="color"?_t.parse(a.default)||null:a.type==="padding"?Hi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?nr.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,l,u,p){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null;try{let m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Ut(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function bs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in wa}function Ia(i,t){let r=new Nn(wa,xo,[],t?function(l){let u={color:Pi,string:et,number:we,enum:et,boolean:Ze,formatted:tn,padding:yn,resolvedImage:Vr,variableAnchorOffsetCollection:U};return l.type==="array"?A(u[l.value]||Xe,l.length):u[l.type]}(t):void 0),a=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?gs(new vs(a,t)):Ca(r.errors)}class Ta{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ka(r.expression)}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,p)}evaluate(t,r,a,l,u,p){return this._styleExpression.evaluate(t,r,a,l,u,p)}}class Ea{constructor(t,r,a,l){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ka(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,p)}evaluate(t,r,a,l,u,p){return this._styleExpression.evaluate(t,r,a,l,u,p)}interpolationFactor(t,r,a){return this.interpolationType?zi.interpolationFactor(this.interpolationType,t,r,a):0}}function Bl(i,t){let r=Ia(i,t);if(r.result==="error")return r;let a=r.value.expression,l=wo(a);if(!l&&!Sa(t))return Ca([new bi("","data expressions not supported")]);let u=ko(a,["zoom"]);if(!u&&!th(t))return Ca([new bi("","zoom expressions not supported")]);let p=Co(a);return p||u?p instanceof bi?Ca([p]):p instanceof zi&&!Fl(t)?Ca([new bi("",'"interpolate" expressions cannot be used with this property')]):gs(p?new Ea(l?"camera":"composite",r.value,p.labels,p instanceof zi?p.interpolation:void 0):new Ta(l?"constant":"source",r.value)):Ca([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Aa{constructor(t,r){this._parameters=t,this._specification=r,Fr(this,ih(this._parameters,this._specification))}static deserialize(t){return new Aa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Co(i){let t=null;if(i instanceof vn)t=Co(i.result);else if(i instanceof ls){for(let r of i.args)if(t=Co(r),t)break}else(i instanceof va||i instanceof zi)&&i.input instanceof ar&&i.input.name==="zoom"&&(t=i);return t instanceof bi||i.eachChild(r=>{let a=Co(r);a instanceof bi?t=a:!t&&a?t=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function xs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!xs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let ws={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ol(i){if(i==null)return{filter:()=>!0,needGeometry:!1};xs(i)||(i=ks(i));let t=Ia(i,ws);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,l)=>t.value.evaluate(r,a,{},l),needGeometry:oh(i)}}function Nd(i,t){return i<t?-1:i>t?1:0}function oh(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(oh(i[t]))return!0;return!1}function ks(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?Vl(i[1],i[2],"=="):t==="!="?ci(Vl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Vl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(ks))):t==="all"?["all"].concat(i.slice(1).map(ks)):t==="none"?["all"].concat(i.slice(1).map(ks).map(ci)):t==="in"?So(i[1],i.slice(2)):t==="!in"?ci(So(i[1],i.slice(2))):t==="has"?Mo(i[1]):t!=="!has"||ci(Mo(i[1]));var r}function Vl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function So(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Nd)]]:["filter-in-small",i,["literal",t]]}}function Mo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ci(i){return["!",i]}function Wn(i){let t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(let u of i)l+=`${Wn(u)},`;return`${l}]`}let r=Object.keys(i).sort(),a="{";for(let l=0;l<r.length;l++)a+=`${JSON.stringify(r[l])}:${Wn(i[r[l]])},`;return`${a}}`}function sh(i){let t="";for(let r of On)t+=`/${Wn(i[r])}`;return t}function lh(i){let t=i.value;return t?[new ye(i.key,t,"constants have been deprecated as of v8")]:[]}function Ot(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function br(i){if(Array.isArray(i))return i.map(br);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let r in i)t[r]=br(i[r]);return t}return Ot(i)}function Xi(i){let t=i.key,r=i.value,a=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec,m=i.validateSpec,g=[],x=dt(r);if(x!=="object")return[new ye(t,r,`object expected, ${x} found`)];for(let w in r){let C=w.split(".")[0],T=a[C]||a["*"],P;if(l[C])P=l[C];else if(a[C])P=m;else if(l["*"])P=l["*"];else{if(!a["*"]){g.push(new ye(t,r[w],`unknown property "${w}"`));continue}P=m}g=g.concat(P({key:(t&&`${t}.`)+w,value:r[w],valueSpec:T,style:u,styleSpec:p,object:r,objectKey:w,validateSpec:m},r))}for(let w in a)l[w]||a[w].required&&a[w].default===void 0&&r[w]===void 0&&g.push(new ye(t,r,`missing required property "${w}"`));return g}function Io(i){let t=i.value,r=i.valueSpec,a=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||i.validateSpec;if(dt(t)!=="array")return[new ye(u,t,`array expected, ${dt(t)} found`)];if(r.length&&t.length!==r.length)return[new ye(u,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ye(u,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),dt(r.value)==="object"&&(m=r.value);let g=[];for(let x=0;x<t.length;x++)g=g.concat(p({array:t,arrayIndex:x,value:t[x],valueSpec:m,validateSpec:i.validateSpec,style:a,styleSpec:l,key:`${u}[${x}]`}));return g}function Nl(i){let t=i.key,r=i.value,a=i.valueSpec,l=dt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ye(t,r,`number expected, ${l} found`)]:"minimum"in a&&r<a.minimum?[new ye(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new ye(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Cs(i){let t=i.valueSpec,r=Ot(i.value.type),a,l,u,p={},m=r!=="categorical"&&i.value.property===void 0,g=!m,x=dt(i.value.stops)==="array"&&dt(i.value.stops[0])==="array"&&dt(i.value.stops[0][0])==="object",w=Xi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(r==="identity")return[new ye(P.key,P.value,'identity function may not have a "stops" property')];let L=[],R=P.value;return L=L.concat(Io({key:P.key,value:R,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),dt(R)==="array"&&R.length===0&&L.push(new ye(P.key,R,"array must have at least one stop")),L},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return r==="identity"&&m&&w.push(new ye(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new ye(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Fl(i.valueSpec)&&w.push(new ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Sa(i.valueSpec)?w.push(new ye(i.key,i.value,"property functions not supported")):m&&!th(i.valueSpec)&&w.push(new ye(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||w.push(new ye(i.key,i.value,'"property" property is required')),w;function C(P){let L=[],R=P.value,N=P.key;if(dt(R)!=="array")return[new ye(N,R,`array expected, ${dt(R)} found`)];if(R.length!==2)return[new ye(N,R,`array length 2 expected, length ${R.length} found`)];if(x){if(dt(R[0])!=="object")return[new ye(N,R,`object expected, ${dt(R[0])} found`)];if(R[0].zoom===void 0)return[new ye(N,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new ye(N,R,"object stop key must have value")];if(u&&u>Ot(R[0].zoom))return[new ye(N,R[0].zoom,"stop zoom values must appear in ascending order")];Ot(R[0].zoom)!==u&&(u=Ot(R[0].zoom),l=void 0,p={}),L=L.concat(Xi({key:`${N}[0]`,value:R[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:Nl,value:T}}))}else L=L.concat(T({key:`${N}[0]`,value:R[0],valueSpec:{},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},R));return bs(br(R[1]))?L.concat([new ye(`${N}[1]`,R[1],"expressions are not allowed in function stops.")]):L.concat(P.validateSpec({key:`${N}[1]`,value:R[1],valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function T(P,L){let R=dt(P.value),N=Ot(P.value),$=P.value!==null?P.value:L;if(a){if(R!==a)return[new ye(P.key,$,`${R} stop domain type must match previous stop domain type ${a}`)]}else a=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new ye(P.key,$,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&r!=="categorical"){let re=`number expected, ${R} found`;return Sa(t)&&r===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ye(P.key,$,re)]}return r!=="categorical"||R!=="number"||isFinite(N)&&Math.floor(N)===N?r!=="categorical"&&R==="number"&&l!==void 0&&N<l?[new ye(P.key,$,"stop domain values must appear in ascending order")]:(l=N,r==="categorical"&&N in p?[new ye(P.key,$,"stop domain values must be unique")]:(p[N]=!0,[])):[new ye(P.key,$,`integer expected, found ${N}`)]}}function Pa(i){let t=(i.expressionContext==="property"?Bl:Ia)(br(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new ye(`${i.key}${a.key}`,i.value,a.message));let r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ka(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ka(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ko(r,["zoom","feature-state"]))return[new ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!wo(r))return[new ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nn(i){let t=i.key,r=i.value,a=i.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function jl(i){return xs(br(i.value))?Pa(Fr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ss(i)}function Ss(i){let t=i.value,r=i.key;if(dt(t)!=="array")return[new ye(r,t,`array expected, ${dt(t)} found`)];let a=i.styleSpec,l,u=[];if(t.length<1)return[new ye(r,t,"filter array must have at least 1 element")];switch(u=u.concat(nn({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ot(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ot(t[1])==="$type"&&u.push(new ye(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&u.push(new ye(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=dt(t[1]),l!=="string"&&u.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=dt(t[p]),Ot(t[1])==="$type"?u=u.concat(nn({key:`${r}[${p}]`,value:t[p],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new ye(`${r}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)u=u.concat(Ss({key:`${r}[${p}]`,value:t[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=dt(t[1]),t.length!==2?u.push(new ye(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`))}return u}function ql(i,t){let r=i.key,a=i.validateSpec,l=i.style,u=i.styleSpec,p=i.value,m=i.objectKey,g=u[`${t}_${i.layerType}`];if(!g)return[];let x=m.match(/^(.*)-transition$/);if(t==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return a({key:r,value:p,valueSpec:u.transition,style:l,styleSpec:u});let w=i.valueSpec||g[m];if(!w)return[new ye(r,p,`unknown property "${m}"`)];let C;if(dt(p)==="string"&&Sa(w)&&!w.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new ye(r,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];let T=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&T.push(new ye(r,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&_s(br(p))&&Ot(p.type)==="identity"&&T.push(new ye(r,p,'"text-font" does not support identity functions'))),T.concat(a({key:i.key,value:p,valueSpec:w,style:l,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Ms(i){return ql(i,"paint")}function Ul(i){return ql(i,"layout")}function $l(i){let t=[],r=i.value,a=i.key,l=i.style,u=i.styleSpec;r.type||r.ref||t.push(new ye(a,r,'either "type" or "ref" is required'));let p=Ot(r.type),m=Ot(r.ref);if(r.id){let g=Ot(r.id);for(let x=0;x<i.arrayIndex;x++){let w=l.layers[x];Ot(w.id)===g&&t.push(new ye(a,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&t.push(new ye(a,r[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{Ot(x.id)===m&&(g=x)}),g?g.ref?t.push(new ye(a,r.ref,"ref cannot reference another ref layer")):p=Ot(g.type):t.push(new ye(a,r.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(r.source){let g=l.sources&&l.sources[r.source],x=g&&Ot(g.type);g?x==="vector"&&p==="raster"?t.push(new ye(a,r.source,`layer "${r.id}" requires a raster source`)):x!=="raster-dem"&&p==="hillshade"?t.push(new ye(a,r.source,`layer "${r.id}" requires a raster-dem source`)):x==="raster"&&p!=="raster"?t.push(new ye(a,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&p!=="hillshade"?t.push(new ye(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||x==="geojson"&&g.lineMetrics||t.push(new ye(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ye(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ye(a,r.source,`source "${r.source}" not found`))}else t.push(new ye(a,r,'missing required property "source"'));return t=t.concat(Xi({key:a,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:jl,layout:g=>Xi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>Ul(Fr({layerType:p},x))}}),paint:g=>Xi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":x=>Ms(Fr({layerType:p},x))}})}})),t}function Xn(i){let t=i.value,r=i.key,a=dt(t);return a!=="string"?[new ye(r,t,`string expected, ${a} found`)]:[]}let Is={promoteId:function({key:i,value:t}){if(dt(t)==="string")return Xn({key:i,value:t});{let r=[];for(let a in t)r.push(...Xn({key:`${i}.${a}`,value:t[a]}));return r}}};function To(i){let t=i.value,r=i.key,a=i.styleSpec,l=i.style,u=i.validateSpec;if(!t.type)return[new ye(r,t,'"type" is required')];let p=Ot(t.type),m;switch(p){case"vector":case"raster":return m=Xi({key:r,value:t,valueSpec:a[`source_${p.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Is,validateSpec:u}),m;case"raster-dem":return m=function(g){var x;let w=(x=g.sourceName)!==null&&x!==void 0?x:"",C=g.value,T=g.styleSpec,P=T.source_raster_dem,L=g.style,R=[],N=dt(C);if(C===void 0)return R;if(N!=="object")return R.push(new ye("source_raster_dem",C,`object expected, ${N} found`)),R;let $=Ot(C.encoding)==="custom",re=["redFactor","greenFactor","blueFactor","baseShift"],X=g.value.encoding?`"${g.value.encoding}"`:"Default";for(let te in C)!$&&re.includes(te)?R.push(new ye(te,C[te],`In "${w}": "${te}" is only valid when "encoding" is set to "custom". ${X} encoding found`)):P[te]?R=R.concat(g.validateSpec({key:te,value:C[te],valueSpec:P[te],validateSpec:g.validateSpec,style:L,styleSpec:T})):R.push(new ye(te,C[te],`unknown property "${te}"`));return R}({sourceName:r,value:t,style:i.style,styleSpec:a,validateSpec:u}),m;case"geojson":if(m=Xi({key:r,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:u,objectElementValidators:Is}),t.cluster)for(let g in t.clusterProperties){let[x,w]=t.clusterProperties[g],C=typeof x=="string"?[x,["accumulated"],["get",g]]:x;m.push(...Pa({key:`${r}.${g}.map`,value:w,validateSpec:u,expressionContext:"cluster-map"})),m.push(...Pa({key:`${r}.${g}.reduce`,value:C,validateSpec:u,expressionContext:"cluster-reduce"}))}return m;case"video":return Xi({key:r,value:t,valueSpec:a.source_video,style:l,validateSpec:u,styleSpec:a});case"image":return Xi({key:r,value:t,valueSpec:a.source_image,style:l,validateSpec:u,styleSpec:a});case"canvas":return[new ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:u,styleSpec:a})}}function Zl(i){let t=i.value,r=i.styleSpec,a=r.light,l=i.style,u=[],p=dt(t);if(t===void 0)return u;if(p!=="object")return u=u.concat([new ye("light",t,`object expected, ${p} found`)]),u;for(let m in t){let g=m.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?i.validateSpec({key:m,value:t[m],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)])}return u}function Gl(i){let t=i.value,r=i.styleSpec,a=r.sky,l=i.style,u=dt(t);if(t===void 0)return[];if(u!=="object")return[new ye("sky",t,`object expected, ${u} found`)];let p=[];for(let m in t)p=p.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return p}function Hl(i){let t=i.value,r=i.styleSpec,a=r.terrain,l=i.style,u=[],p=dt(t);if(t===void 0)return u;if(p!=="object")return u=u.concat([new ye("terrain",t,`object expected, ${p} found`)]),u;for(let m in t)u=u.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return u}function Wl(i){let t=[],r=i.value,a=i.key;if(Array.isArray(r)){let l=[],u=[];for(let p in r)r[p].id&&l.includes(r[p].id)&&t.push(new ye(a,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&u.includes(r[p].url)&&t.push(new ye(a,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),u.push(r[p].url),t=t.concat(Xi({key:`${a}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Xn({key:a,value:r})}let Ts={"*":()=>[],array:Io,boolean:function(i){let t=i.value,r=i.key,a=dt(t);return a!=="boolean"?[new ye(r,t,`boolean expected, ${a} found`)]:[]},number:Nl,color:function(i){let t=i.key,r=i.value,a=dt(r);return a!=="string"?[new ye(t,r,`color expected, ${a} found`)]:_t.parse(String(r))?[]:[new ye(t,r,`color expected, "${r}" found`)]},constants:lh,enum:nn,filter:jl,function:Cs,layer:$l,object:Xi,source:To,light:Zl,sky:Gl,terrain:Hl,projection:function(i){let t=i.value,r=i.styleSpec,a=r.projection,l=i.style,u=dt(t);if(t===void 0)return[];if(u!=="object")return[new ye("projection",t,`object expected, ${u} found`)];let p=[];for(let m in t)p=p.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return p},string:Xn,formatted:function(i){return Xn(i).length===0?[]:Pa(i)},resolvedImage:function(i){return Xn(i).length===0?[]:Pa(i)},padding:function(i){let t=i.key,r=i.value;if(dt(r)==="array"){if(r.length<1||r.length>4)return[new ye(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let a={type:"number"},l=[];for(let u=0;u<r.length;u++)l=l.concat(i.validateSpec({key:`${t}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:a}));return l}return Nl({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){let t=i.key,r=i.value,a=dt(r),l=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new ye(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let u=[];for(let p=0;p<r.length;p+=2)u=u.concat(nn({key:`${t}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),u=u.concat(Io({key:`${t}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return u},sprite:Wl};function Da(i){let t=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=Da,r.expression&&_s(Ot(t))?Cs(i):r.expression&&bs(br(t))?Pa(i):r.type&&Ts[r.type]?Ts[r.type](i):Xi(Fr({},i,{valueSpec:r.type?a[r.type]:r}))}function ch(i){let t=i.value,r=i.key,a=Xn(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new ye(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new ye(r,t,'"glyphs" url must include a "{range}" token'))),a}function or(i,t=oe){let r=[];return r=r.concat(Da({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Da,objectElementValidators:{glyphs:ch,"*":()=>[]}})),i.constants&&(r=r.concat(lh({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:Da}))),Xl(r)}function jr(i){return function(t){return i(In(Kt({},t),{validateSpec:Da}))}}function Xl(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function xr(i){return function(...t){return Xl(i.apply(this,t))}}or.source=xr(jr(To)),or.sprite=xr(jr(Wl)),or.glyphs=xr(jr(ch)),or.light=xr(jr(Zl)),or.sky=xr(jr(Gl)),or.terrain=xr(jr(Hl)),or.layer=xr(jr($l)),or.filter=xr(jr(jl)),or.paintProperty=xr(jr(Ms)),or.layoutProperty=xr(jr(Ul));let Kn=or,jd=Kn.light,qd=Kn.sky,hh=Kn.paintProperty,dh=Kn.layoutProperty;function Kl(i,t){let r=!1;if(t&&t.length)for(let a of t)i.fire(new fn(new Error(a.message))),r=!0;return r}class za{constructor(t,r,a){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(r=p[1])+2*(a=p[2]);for(let g=0;g<this.d*this.d;g++){let x=p[3+g],w=p[3+g+1];l.push(x===w?null:p.subarray(x,w))}let m=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;let u=a/r*t;this.min=-u,this.max=t+u}insert(t,r,a,l,u){this._forEachCell(r,a,l,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,l,u,p){this.cells[u].push(p)}query(t,r,a,l,u){let p=this.min,m=this.max;if(t<=p&&r<=p&&m<=a&&m<=l&&!u)return Array.prototype.slice.call(this.keys);{let g=[];return this._forEachCell(t,r,a,l,this._queryCell,g,{},u),g}}_queryCell(t,r,a,l,u,p,m,g){let x=this.cells[u];if(x!==null){let w=this.keys,C=this.bboxes;for(let T=0;T<x.length;T++){let P=x[T];if(m[P]===void 0){let L=4*P;(g?g(C[L+0],C[L+1],C[L+2],C[L+3]):t<=C[L+2]&&r<=C[L+3]&&a>=C[L+0]&&l>=C[L+1])?(m[P]=!0,p.push(w[P])):m[P]=!1}}}}_forEachCell(t,r,a,l,u,p,m,g){let x=this._convertToCellCoord(t),w=this._convertToCellCoord(r),C=this._convertToCellCoord(a),T=this._convertToCellCoord(l);for(let P=x;P<=C;P++)for(let L=w;L<=T;L++){let R=this.d*L+P;if((!g||g(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&u.call(this,t,r,a,l,R,p,m,g))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,a=0;for(let p=0;p<this.cells.length;p++)a+=this.cells[p].length;let l=new Int32Array(r+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let u=r;for(let p=0;p<t.length;p++){let m=t[p];l[3+p]=u,l.set(m,u),u+=m.length}return l[3+t.length]=u,l.set(this.keys,u),u+=this.keys.length,l[3+t.length+1]=u,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer}static serialize(t,r){let a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new za(t.buffer)}}let sr={};function Pe(i,t,r={}){if(sr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),sr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Pe("Object",Object),Pe("TransferableGridIndex",za),Pe("Color",_t),Pe("Error",Error),Pe("AJAXError",Zi),Pe("ResolvedImage",Wi),Pe("StylePropertyFunction",Aa),Pe("StyleExpression",vs,{omit:["_evaluator"]}),Pe("ZoomDependentExpression",Ea),Pe("ZoomConstantExpression",Ta),Pe("CompoundExpression",ar,{omit:["_evaluate"]});for(let i in wa)wa[i]._classRegistryKey||Pe(`Expression_${i}`,wa[i]);function Es(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Yl(i){return i.$name||i.constructor._classRegistryKey}function uh(i){return!function(t){if(t===null||typeof t!="object")return!1;let r=Yl(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Es(i)||Lr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function La(i,t){if(uh(i))return(Es(i)||Lr(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let u=[];for(let p of i)u.push(La(p,t));return u}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);let r=Yl(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!sr[r])throw new Error(`${r} is not registered.`);let{klass:a}=sr[r],l=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let u in i){if(!i.hasOwnProperty(u)||sr[r].omit.indexOf(u)>=0)continue;let p=i[u];l[u]=sr[r].shallow.indexOf(u)>=0?p:La(p,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function Ra(i){if(uh(i))return i;if(Array.isArray(i))return i.map(Ra);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);let t=Yl(i)||"Object";if(!sr[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=sr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);let a=Object.create(r.prototype);for(let l of Object.keys(i)){if(l==="$name")continue;let u=i[l];a[l]=sr[t].shallow.indexOf(l)>=0?u:Ra(u)}return a}class Jl{constructor(){this.first=!0}update(t,r){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let st={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ql(i){for(let t of i)if(tc(t.charCodeAt(0)))return!0;return!1}function Ud(i){for(let t of i)if(!Fa(t.charCodeAt(0)))return!1;return!0}function ec(i){let t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}let $d=ec(["Arab","Dupl","Mong","Ougr","Syrc"]);function Fa(i){return!$d.test(String.fromCodePoint(i))}let ph=ec(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function tc(i){return!(i!==746&&i!==747&&(i<4352||!(st["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||st["CJK Compatibility"](i)||st["CJK Strokes"](i)||!(!st["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||st["Enclosed CJK Letters and Months"](i)||st["Ideographic Description Characters"](i)||st.Kanbun(i)||st.Katakana(i)&&i!==12540||!(!st["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!st["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||st["Vertical Forms"](i)||st["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||ph.test(String.fromCodePoint(i)))))}function mh(i){return!(tc(i)||function(t){return!!(st["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||st["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||st["Letterlike Symbols"](t)||st["Number Forms"](t)||st["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||st["Control Pictures"](t)&&t!==9251||st["Optical Character Recognition"](t)||st["Enclosed Alphanumerics"](t)||st["Geometric Shapes"](t)||st["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||st["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||st["CJK Symbols and Punctuation"](t)||st.Katakana(t)||st["Private Use Area"](t)||st["CJK Compatibility Forms"](t)||st["Small Form Variants"](t)||st["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}let Zd=ec(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ic(i){return Zd.test(String.fromCodePoint(i))}function Gd(i,t){return!(!t&&ic(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||st.Khmer(i))}function Hd(i){for(let t of i)if(ic(t.charCodeAt(0)))return!0;return!1}let Ki=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class It{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jl,this.transition={})}isSupportedScript(t){return function(r,a){for(let l of r)if(!Gd(l.charCodeAt(0),a))return!1;return!0}(t,Ki.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Ba{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,l){if(_s(a))return new Aa(a,l);if(bs(a)){let u=Bl(a,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=a;return l.type==="color"&&typeof a=="string"?u=_t.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(u=nr.parse(a)):u=Hi.parse(a),{kind:"constant",evaluate:()=>u}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class As{constructor(t){this.property=t,this.value=new Ba(t,void 0)}transitioned(t,r){return new fh(this.property,this.value,r,ir({},t.transition,this.transition),t.now)}untransitioned(){return new fh(this.property,this.value,null,{},0)}}class Ps{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return yt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new As(this._values[t].property)),this._values[t].value=new Ba(this._values[t].property,r===null?void 0:yt(r))}getTransition(t){return yt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new As(this._values[t].property)),this._values[t].transition=yt(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a);let l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){let a=new Eo(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,r._values[l]);return a}untransitioned(){let t=new Eo(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class fh{constructor(t,r,a,l,u){this.property=t,this.value=r,this.begin=u+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){let l=t.now||0,u=this.value.possiblyEvaluate(t,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(t,r,a);{let m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,r,a),u,function(g){if(g<=0)return 0;if(g>=1)return 1;let x=g*g,w=x*g;return 4*(g<.5?w:3*(g-x)+w-.75)}(m))}}return u}}class Eo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){let l=new Po(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return yt(this._values[t].value)}setValue(t,r){this._values[t]=new Ba(this._values[t].property,r===null?void 0:yt(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){let l=new Po(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}}class qr{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,l){return this.property.evaluate(this.value,this.parameters,t,r,a,l)}}class Po{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Le{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){let l=Di[this.specification.type];return l?l(t,r,a):t}}class Ue{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,l){return new qr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,l)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new qr(this,{kind:"constant",value:void 0},t.parameters);let l=Di[this.specification.type];if(l){let u=l(t.value.value,r.value.value,a);return new qr(this,{kind:"constant",value:u},t.parameters)}return t}evaluate(t,r,a,l,u,p){return t.kind==="constant"?t.value:t.evaluate(r,a,l,u,p)}}class Ds extends Ue{possiblyEvaluate(t,r,a,l){if(t.value===void 0)return new qr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l),p=t.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,m=this._calculate(p,p,p,r);return new qr(this,{kind:"constant",value:m},r)}if(t.expression.kind==="camera"){let u=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new qr(this,{kind:"constant",value:u},r)}return new qr(this,t.expression,r)}evaluate(t,r,a,l,u,p){if(t.kind==="source"){let m=t.evaluate(r,a,l,u,p);return this._calculate(m,m,m,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,l),t.evaluate({zoom:Math.floor(r.zoom)},a,l),t.evaluate({zoom:Math.floor(r.zoom)+1},a,l),r):t.value}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class zs{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l);return this._calculate(u,u,u,r)}return this._calculate(t.expression.evaluate(new It(Math.floor(r.zoom-1),r)),t.expression.evaluate(new It(Math.floor(r.zoom),r)),t.expression.evaluate(new It(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class rc{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){return!!t.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class d{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let a=t[r];a.specification.overridable&&this.overridableProperties.push(r);let l=this.defaultPropertyValues[r]=new Ba(a,void 0),u=this.defaultTransitionablePropertyValues[r]=new As(a);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Pe("DataDrivenProperty",Ue),Pe("DataConstantProperty",Le),Pe("CrossFadedDataDrivenProperty",Ds),Pe("CrossFadedProperty",zs),Pe("ColorRampProperty",rc);let e="-transition";class n extends ma{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Ao(r.layout)),r.paint)){this._transitionablePaint=new Ps(r.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Po(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(dh,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(hh,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let l=this._transitionablePaint._values[t],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let g=this._transitionablePaint._values[t].value;return g.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(t,m,g)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),so(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,l,u={}){return(!u||u.validate!==!1)&&Kl(this,t.call(Kn,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof qr&&Sa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class s{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function f(i,t=1){let r=0,a=0;return{members:i.map(l=>{let u=o[l.type].BYTES_PER_ELEMENT,p=r=_(r,Math.max(t,u)),m=l.components||1;return a=Math.max(a,u),r+=u*m,{name:l.name,type:l.type,components:m,offset:p}}),size:_(r,Math.max(a,t)),alignment:t}}function _(i,t){return Math.ceil(i/t)*t}class b extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.int16[l+0]=r,this.int16[l+1]=a,t}}b.prototype.bytesPerElement=4,Pe("StructArrayLayout2i4",b);class k extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.int16[u+0]=r,this.int16[u+1]=a,this.int16[u+2]=l,t}}k.prototype.bytesPerElement=6,Pe("StructArrayLayout3i6",k);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let p=4*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=u,t}}M.prototype.bytesPerElement=8,Pe("StructArrayLayout4i8",M);class I extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=m,t}}I.prototype.bytesPerElement=12,Pe("StructArrayLayout2i4i12",I);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=4*t,x=8*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.uint8[x+4]=l,this.uint8[x+5]=u,this.uint8[x+6]=p,this.uint8[x+7]=m,t}}z.prototype.bytesPerElement=8,Pe("StructArrayLayout2i4ub8",z);class F extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.float32[l+0]=r,this.float32[l+1]=a,t}}F.prototype.bytesPerElement=8,Pe("StructArrayLayout2f8",F);class O extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,x,w){let C=this.length;return this.resize(C+1),this.emplace(C,t,r,a,l,u,p,m,g,x,w)}emplace(t,r,a,l,u,p,m,g,x,w,C){let T=10*t;return this.uint16[T+0]=r,this.uint16[T+1]=a,this.uint16[T+2]=l,this.uint16[T+3]=u,this.uint16[T+4]=p,this.uint16[T+5]=m,this.uint16[T+6]=g,this.uint16[T+7]=x,this.uint16[T+8]=w,this.uint16[T+9]=C,t}}O.prototype.bytesPerElement=20,Pe("StructArrayLayout10ui20",O);class q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,x,w,C,T){let P=this.length;return this.resize(P+1),this.emplace(P,t,r,a,l,u,p,m,g,x,w,C,T)}emplace(t,r,a,l,u,p,m,g,x,w,C,T,P){let L=12*t;return this.int16[L+0]=r,this.int16[L+1]=a,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=p,this.uint16[L+5]=m,this.uint16[L+6]=g,this.uint16[L+7]=x,this.int16[L+8]=w,this.int16[L+9]=C,this.int16[L+10]=T,this.int16[L+11]=P,t}}q.prototype.bytesPerElement=24,Pe("StructArrayLayout4i4ui4i24",q);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.float32[u+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}Z.prototype.bytesPerElement=12,Pe("StructArrayLayout3f12",Z);class G extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}G.prototype.bytesPerElement=4,Pe("StructArrayLayout1ul4",G);class W extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,x){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,a,l,u,p,m,g,x)}emplace(t,r,a,l,u,p,m,g,x,w){let C=10*t,T=5*t;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=l,this.int16[C+3]=u,this.int16[C+4]=p,this.int16[C+5]=m,this.uint32[T+3]=g,this.uint16[C+8]=x,this.uint16[C+9]=w,t}}W.prototype.bytesPerElement=20,Pe("StructArrayLayout6i1ul2ui20",W);class V extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=m,t}}V.prototype.bytesPerElement=12,Pe("StructArrayLayout2i2i2i12",V);class J extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u)}emplace(t,r,a,l,u,p){let m=4*t,g=8*t;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=l,this.int16[g+6]=u,this.int16[g+7]=p,t}}J.prototype.bytesPerElement=16,Pe("StructArrayLayout2f1f2i16",J);class ee extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=16*t,x=4*t,w=8*t;return this.uint8[g+0]=r,this.uint8[g+1]=a,this.float32[x+1]=l,this.float32[x+2]=u,this.int16[w+6]=p,this.int16[w+7]=m,t}}ee.prototype.bytesPerElement=16,Pe("StructArrayLayout2ub2f2i16",ee);class ne extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=a,this.uint16[u+2]=l,t}}ne.prototype.bytesPerElement=6,Pe("StructArrayLayout3ui6",ne);class ue extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$){let re=this.length;return this.resize(re+1),this.emplace(re,t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$)}emplace(t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$,re){let X=24*t,te=12*t,se=48*t;return this.int16[X+0]=r,this.int16[X+1]=a,this.uint16[X+2]=l,this.uint16[X+3]=u,this.uint32[te+2]=p,this.uint32[te+3]=m,this.uint32[te+4]=g,this.uint16[X+10]=x,this.uint16[X+11]=w,this.uint16[X+12]=C,this.float32[te+7]=T,this.float32[te+8]=P,this.uint8[se+36]=L,this.uint8[se+37]=R,this.uint8[se+38]=N,this.uint32[te+10]=$,this.int16[X+22]=re,t}}ue.prototype.bytesPerElement=48,Pe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ue);class _e extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$,re,X,te,se,fe,Te,qe,Me,Ce,Be,De){let Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$,re,X,te,se,fe,Te,qe,Me,Ce,Be,De)}emplace(t,r,a,l,u,p,m,g,x,w,C,T,P,L,R,N,$,re,X,te,se,fe,Te,qe,Me,Ce,Be,De,Ae){let de=32*t,Oe=16*t;return this.int16[de+0]=r,this.int16[de+1]=a,this.int16[de+2]=l,this.int16[de+3]=u,this.int16[de+4]=p,this.int16[de+5]=m,this.int16[de+6]=g,this.int16[de+7]=x,this.uint16[de+8]=w,this.uint16[de+9]=C,this.uint16[de+10]=T,this.uint16[de+11]=P,this.uint16[de+12]=L,this.uint16[de+13]=R,this.uint16[de+14]=N,this.uint16[de+15]=$,this.uint16[de+16]=re,this.uint16[de+17]=X,this.uint16[de+18]=te,this.uint16[de+19]=se,this.uint16[de+20]=fe,this.uint16[de+21]=Te,this.uint16[de+22]=qe,this.uint32[Oe+12]=Me,this.float32[Oe+13]=Ce,this.float32[Oe+14]=Be,this.uint16[de+30]=De,this.uint16[de+31]=Ae,t}}_e.prototype.bytesPerElement=64,Pe("StructArrayLayout8i15ui1ul2f2ui64",_e);class Se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Se.prototype.bytesPerElement=4,Pe("StructArrayLayout1f4",Se);class Ee extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[6*t+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}Ee.prototype.bytesPerElement=12,Pe("StructArrayLayout1ui2f12",Ee);class xe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=4*t;return this.uint32[2*t+0]=r,this.uint16[u+2]=a,this.uint16[u+3]=l,t}}xe.prototype.bytesPerElement=8,Pe("StructArrayLayout1ul2ui8",xe);class be extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=a,t}}be.prototype.bytesPerElement=4,Pe("StructArrayLayout2ui4",be);class Re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Re.prototype.bytesPerElement=2,Pe("StructArrayLayout1ui2",Re);class We extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let p=4*t;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=u,t}}We.prototype.bytesPerElement=16,Pe("StructArrayLayout4f16",We);class ke extends s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}ke.prototype.size=20;class Ie extends W{get(t){return new ke(this,t)}}Pe("CollisionBoxArray",Ie);class Ge extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ge.prototype.size=48;class Tt extends ue{get(t){return new Ge(this,t)}}Pe("PlacedSymbolArray",Tt);class Qe extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Qe.prototype.size=64;class ot extends _e{get(t){return new Qe(this,t)}}Pe("SymbolInstanceArray",ot);class Et extends Se{getoffsetX(t){return this.float32[1*t+0]}}Pe("GlyphOffsetArray",Et);class hi extends k{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Pe("SymbolLineVertexArray",hi);class wr extends s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}wr.prototype.size=12;class At extends Ee{get(t){return new wr(this,t)}}Pe("TextAnchorOffsetArray",At);class Li extends s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Li.prototype.size=8;class wi extends xe{get(t){return new Li(this,t)}}Pe("FeatureIndexArray",wi);class di extends b{}class ki extends b{}class Ur extends b{}class Oa extends I{}class Ls extends z{}class Va extends F{}class lr extends O{}class Rs extends q{}class nc extends Z{}class cr extends G{}class hr extends V{}class xn extends ee{}class kr extends ne{}class ai extends be{}let ui=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yi}=ui;class lt{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,l){let u=this.segments[this.segments.length-1];return t>lt.MAX_VERTEX_ARRAY_LENGTH&&li(`Max vertices per segment is ${lt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>lt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,l){return new lt([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function Yn(i,t){return 256*(i=pr(Math.floor(i),0,255))+pr(Math.floor(t),0,255)}lt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pe("SegmentVector",lt);let Na=f([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ja={exports:{}},gh={exports:{}};gh.exports=function(i,t){var r,a,l,u,p,m,g,x;for(a=i.length-(r=3&i.length),l=t,p=3432918353,m=461845907,x=0;x<a;)g=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24,++x,l=27492+(65535&(u=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(x)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var Wd=gh.exports,_h={exports:{}};_h.exports=function(i,t){for(var r,a=i.length,l=t^a,u=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:l^=(255&i.charCodeAt(u+2))<<16;case 2:l^=(255&i.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var wn=Wd,yh=_h.exports;ja.exports=wn,ja.exports.murmur3=wn,ja.exports.murmur2=yh;var Fs=he(ja.exports);class Do{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,l){this.ids.push(Bs(t)),this.positions.push(r,a,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Bs(t),a=0,l=this.ids.length-1;for(;a<l;){let p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}let u=[];for(;this.ids[a]===r;)u.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return u}static serialize(t,r){let a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Os(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(t){let r=new Do;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Bs(i){let t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Fs(String(i))}function Os(i,t,r,a){for(;r<a;){let l=i[r+a>>1],u=r-1,p=a+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;qa(i,u,p),qa(t,3*u,3*p),qa(t,3*u+1,3*p+1),qa(t,3*u+2,3*p+2)}p-r<a-p?(Os(i,t,r,p),r=p+1):(Os(i,t,p+1,a),a=p)}}function qa(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}Pe("FeaturePositionMap",Do);class zo{constructor(t,r){this.gl=t.gl,this.location=r}}class vh extends zo{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class vp extends zo{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class bp extends zo{constructor(t,r){super(t,r),this.current=_t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let fg=new Float32Array(16);function Xd(i){return[Yn(255*i.r,255*i.g),Yn(255*i.b,255*i.a)]}class ac{constructor(t,r,a){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new bp(t,r):new vh(t,r)}}class Vs{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,l){let u=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&t.set(u)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new vp(t,r):new vh(t,r)}}class Jn{constructor(t,r,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,a,l,u){let p=this.paintVertexArray.length,m=this.expression.evaluate(new It(0),r,{},l,[],u);this.paintVertexArray.resize(t),this._setPaintValue(p,t,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:0},a,l);this._setPaintValue(t,r,u)}_setPaintValue(t,r,a){if(this.type==="color"){let l=Xd(a);for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class an{constructor(t,r,a,l,u,p){this.expression=t,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,a,l,u){let p=this.expression.evaluate(new It(this.zoom),r,{},l,[],u),m=this.expression.evaluate(new It(this.zoom+1),r,{},l,[],u),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,p,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:this.zoom},a,l),p=this.expression.evaluate({zoom:this.zoom+1},a,l);this._setPaintValue(t,r,u,p)}_setPaintValue(t,r,a,l){if(this.type==="color"){let u=Xd(a),p=Xd(l);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1],p[0],p[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=pr(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,a){return new vh(t,r)}}class Ua{constructor(t,r,a,l,u,p){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(t,r,a){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,l,u){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],u)}_setPaintValues(t,r,a,l){if(!l||!a)return;let{min:u,mid:p,max:m}=a,g=l[u],x=l[p],w=l[m];if(g&&x&&w)for(let C=t;C<r;C++)this.zoomInPaintVertexArray.emplace(C,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,x.tl[0],x.tl[1],x.br[0],x.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],x.pixelRatio,w.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Na.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Na.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xp{constructor(t,r,a){this.binders={},this._buffers=[];let l=[];for(let u in t.paint._values){if(!a(u))continue;let p=t.paint.get(u);if(!(p instanceof qr&&Sa(p.property.specification)))continue;let m=gg(u,t.type),g=p.value,x=p.property.specification.type,w=p.property.useIntegerZoom,C=p.property.specification["property-type"],T=C==="cross-faded"||C==="cross-faded-data-driven";if(g.kind==="constant")this.binders[u]=T?new Vs(g.value,m):new ac(g.value,m,x),l.push(`/u_${u}`);else if(g.kind==="source"||T){let P=wp(u,x,"source");this.binders[u]=T?new Ua(g,x,w,r,P,t.id):new Jn(g,m,x,P),l.push(`/a_${u}`)}else{let P=wp(u,x,"composite");this.binders[u]=new an(g,m,x,w,r,P),l.push(`/z_${u}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof Jn||r instanceof an?r.maxValue:0}populatePaintArrays(t,r,a,l,u){for(let p in this.binders){let m=this.binders[p];(m instanceof Jn||m instanceof an||m instanceof Ua)&&m.populatePaintArray(t,r,a,l,u)}}setConstantPatternPositions(t,r){for(let a in this.binders){let l=this.binders[a];l instanceof Vs&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,l,u){let p=!1;for(let m in t){let g=r.getPositions(m);for(let x of g){let w=a.feature(x.index);for(let C in this.binders){let T=this.binders[C];if((T instanceof Jn||T instanceof an||T instanceof Ua)&&T.expression.isStateDependent===!0){let P=l.paint.get(C);T.expression=P.value,T.updatePaintArray(x.start,x.end,w,t[m],u),p=!0}}}}return p}defines(){let t=[];for(let r in this.binders){let a=this.binders[r];(a instanceof ac||a instanceof Vs)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Jn||a instanceof an)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name);else if(a instanceof Ua)for(let l=0;l<Na.members.length;l++)t.push(Na.members[l].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof ac||a instanceof Vs||a instanceof an)for(let l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let a=[];for(let l in this.binders){let u=this.binders[l];if(u instanceof ac||u instanceof Vs||u instanceof an){for(let p of u.uniformNames)if(r[p]){let m=u.getBinding(t,r[p],p);a.push({name:p,property:l,binding:m})}}}return a}setUniforms(t,r,a,l){for(let{name:u,property:p,binding:m}of r)this.binders[p].setUniform(m,l,a.get(p),u)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let a=this.binders[r];if(t&&a instanceof Ua){let l=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof Jn||a instanceof an)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let r in this.binders){let a=this.binders[r];(a instanceof Jn||a instanceof an||a instanceof Ua)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof Jn||r instanceof an||r instanceof Ua)&&r.destroy()}}}class Lo{constructor(t,r,a=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new xp(l,r,a);this.needsUpload=!1,this._featureMap=new Do,this._bufferOffset=0}populatePaintArrays(t,r,a,l,u,p){for(let m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,u,p);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,l){for(let u of a)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(t,this._featureMap,r,u,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function gg(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function wp(i,t,r){let a={color:{source:F,composite:We},number:{source:Se,composite:F}},l=function(u){return{"line-pattern":{source:lr,composite:lr},"fill-pattern":{source:lr,composite:lr},"fill-extrusion-pattern":{source:lr,composite:lr}}[u]}(i);return l&&l[r]||a[t][r]}Pe("ConstantBinder",ac),Pe("CrossFadedConstantBinder",Vs),Pe("SourceExpressionBinder",Jn),Pe("CrossFadedCompositeBinder",Ua),Pe("CompositeExpressionBinder",an),Pe("ProgramConfiguration",xp,{omit:["_buffers"]}),Pe("ProgramConfigurationSet",Lo);let Xt=8192,Kd=Math.pow(2,14)-1,kp=-Kd-1;function Ro(i){let t=Xt/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){let l=r[a];for(let u=0;u<l.length;u++){let p=l[u],m=Math.round(p.x*t),g=Math.round(p.y*t);p.x=pr(m,kp,Kd),p.y=pr(g,kp,Kd),(m<p.x||m>p.x+1||g<p.y||g>p.y+1)&&li("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Fo(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Ro(i):[]}}function bh(i,t,r,a,l){i.emplaceBack(2*t+(a+1)/2,2*r+(l+1)/2)}class Yd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new kr,this.segments=new lt,this.programConfigurations=new Lo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){let l=this.layers[0],u=[],p=null,m=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),m=!p.isConstant());for(let{feature:g,id:x,index:w,sourceLayerIndex:C}of t){let T=this.layers[0]._featureFilter.needGeometry,P=Fo(g,T);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),P,a))continue;let L=m?p.evaluate(P,{},a):void 0,R={id:x,properties:g.properties,type:g.type,sourceLayerIndex:C,index:w,geometry:T?P.geometry:Ro(g),patterns:{},sortKey:L};u.push(R)}m&&u.sort((g,x)=>g.sortKey-x.sortKey);for(let g of u){let{geometry:x,index:w,sourceLayerIndex:C}=g,T=t[w].feature;this.addFeature(g,x,w,a),r.featureIndex.insert(T,x,w,C,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,l){for(let u of r)for(let p of u){let m=p.x,g=p.y;if(m<0||m>=Xt||g<0||g>=Xt)continue;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),w=x.vertexLength;bh(this.layoutVertexArray,m,g,-1,-1),bh(this.layoutVertexArray,m,g,1,-1),bh(this.layoutVertexArray,m,g,1,1),bh(this.layoutVertexArray,m,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),x.vertexLength+=4,x.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l)}}function Cp(i,t){for(let r=0;r<i.length;r++)if(Ns(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Ns(i,t[r]))return!0;return!!Jd(i,t)}function _g(i,t,r){return!!Ns(i,t)||!!Qd(t,i,r)}function Sp(i,t){if(i.length===1)return Ip(t,i[0]);for(let r=0;r<t.length;r++){let a=t[r];for(let l=0;l<a.length;l++)if(Ns(i,a[l]))return!0}for(let r=0;r<i.length;r++)if(Ip(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Jd(i,t[r]))return!0;return!1}function yg(i,t,r){if(i.length>1){if(Jd(i,t))return!0;for(let a=0;a<t.length;a++)if(Qd(t[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Qd(i[a],t,r))return!0;return!1}function Jd(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){let a=i[r],l=i[r+1];for(let u=0;u<t.length-1;u++)if(vg(a,l,t[u],t[u+1]))return!0}return!1}function vg(i,t,r,a){return vi(i,r,a)!==vi(t,r,a)&&vi(i,t,r)!==vi(i,t,a)}function Qd(i,t,r){let a=r*r;if(t.length===1)return i.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(Mp(i,t[l-1],t[l])<a)return!0;return!1}function Mp(i,t,r){let a=t.distSqr(r);if(a===0)return i.distSqr(t);let l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/a;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function Ip(i,t){let r,a,l,u=!1;for(let p=0;p<i.length;p++){r=i[p];for(let m=0,g=r.length-1;m<r.length;g=m++)a=r[m],l=r[g],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(u=!u)}return u}function Ns(i,t){let r=!1;for(let a=0,l=i.length-1;a<i.length;l=a++){let u=i[a],p=i[l];u.y>t.y!=p.y>t.y&&t.x<(p.x-u.x)*(t.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function bg(i,t,r){let a=r[0],l=r[2];if(i.x<a.x&&t.x<a.x||i.x>l.x&&t.x>l.x||i.y<a.y&&t.y<a.y||i.y>l.y&&t.y>l.y)return!1;let u=vi(i,t,r[0]);return u!==vi(i,t,r[1])||u!==vi(i,t,r[2])||u!==vi(i,t,r[3])}function oc(i,t,r){let a=t.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(i)}function xh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function wh(i,t,r,a,l){if(!t[0]&&!t[1])return i;let u=ge.convert(t)._mult(l);r==="viewport"&&u._rotate(-a);let p=[];for(let m=0;m<i.length;m++)p.push(i[m].sub(u));return p}let Tp,Ep;Pe("CircleBucket",Yd,{omit:["layers"]});var xg={get paint(){return Ep=Ep||new d({"circle-radius":new Ue(oe.paint_circle["circle-radius"]),"circle-color":new Ue(oe.paint_circle["circle-color"]),"circle-blur":new Ue(oe.paint_circle["circle-blur"]),"circle-opacity":new Ue(oe.paint_circle["circle-opacity"]),"circle-translate":new Le(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Le(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Le(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Le(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(oe.paint_circle["circle-stroke-opacity"])})},get layout(){return Tp=Tp||new d({"circle-sort-key":new Ue(oe.layout_circle["circle-sort-key"])})}},Ri=1e-6,js=typeof Float32Array<"u"?Float32Array:Array;function eu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ap(i,t,r){var a=t[0],l=t[1],u=t[2],p=t[3],m=t[4],g=t[5],x=t[6],w=t[7],C=t[8],T=t[9],P=t[10],L=t[11],R=t[12],N=t[13],$=t[14],re=t[15],X=r[0],te=r[1],se=r[2],fe=r[3];return i[0]=X*a+te*m+se*C+fe*R,i[1]=X*l+te*g+se*T+fe*N,i[2]=X*u+te*x+se*P+fe*$,i[3]=X*p+te*w+se*L+fe*re,i[4]=(X=r[4])*a+(te=r[5])*m+(se=r[6])*C+(fe=r[7])*R,i[5]=X*l+te*g+se*T+fe*N,i[6]=X*u+te*x+se*P+fe*$,i[7]=X*p+te*w+se*L+fe*re,i[8]=(X=r[8])*a+(te=r[9])*m+(se=r[10])*C+(fe=r[11])*R,i[9]=X*l+te*g+se*T+fe*N,i[10]=X*u+te*x+se*P+fe*$,i[11]=X*p+te*w+se*L+fe*re,i[12]=(X=r[12])*a+(te=r[13])*m+(se=r[14])*C+(fe=r[15])*R,i[13]=X*l+te*g+se*T+fe*N,i[14]=X*u+te*x+se*P+fe*$,i[15]=X*p+te*w+se*L+fe*re,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var sc,wg=Ap;function kh(i,t,r){var a=t[0],l=t[1],u=t[2],p=t[3];return i[0]=r[0]*a+r[4]*l+r[8]*u+r[12]*p,i[1]=r[1]*a+r[5]*l+r[9]*u+r[13]*p,i[2]=r[2]*a+r[6]*l+r[10]*u+r[14]*p,i[3]=r[3]*a+r[7]*l+r[11]*u+r[15]*p,i}sc=new js(4),js!=Float32Array&&(sc[0]=0,sc[1]=0,sc[2]=0,sc[3]=0);class kg extends n{constructor(t){super(t,xg)}createBucket(t){return new Yd(t)}queryRadius(t){let r=t;return oc("circle-radius",this,r)+oc("circle-stroke-width",this,r)+xh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m,g){let x=wh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,m),w=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),C=this.paint.get("circle-pitch-alignment")==="map",T=C?x:function(L,R){return L.map(N=>Pp(N,R))}(x,g),P=C?w*m:w;for(let L of l)for(let R of L){let N=C?R:Pp(R,g),$=P,re=kh([],[R.x,R.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$*=re[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($*=p.cameraToCenterDistance/re[3]),_g(T,N,$))return!0}return!1}}function Pp(i,t){let r=kh([],[i.x,i.y,0,1],t);return new ge(r[0]/r[3],r[1]/r[3])}class Dp extends Yd{}let zp;Pe("HeatmapBucket",Dp,{omit:["layers"]});var Cg={get paint(){return zp=zp||new d({"heatmap-radius":new Ue(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Le(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Le(oe.paint_heatmap["heatmap-opacity"])})}};function tu(i,{width:t,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*a}`)}else l=new Uint8Array(t*r*a);return i.width=t,i.height=r,i.data=l,i}function Lp(i,{width:t,height:r},a){if(t===i.width&&r===i.height)return;let l=tu({},{width:t,height:r},a);iu(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},a),i.width=t,i.height=r,i.data=l.data}function iu(i,t,r,a,l,u){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let p=i.data,m=t.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){let x=((r.y+g)*i.width+r.x)*u,w=((a.y+g)*t.width+a.x)*u;for(let C=0;C<l.width*u;C++)m[w+C]=p[x+C]}return t}class lc{constructor(t,r){tu(this,t,1,r)}resize(t){Lp(this,t,1)}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){iu(t,r,a,l,u,1)}}class Cr{constructor(t,r){tu(this,t,4,r)}resize(t){Lp(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){iu(t,r,a,l,u,4)}}function Rp(i){let t={},r=i.resolution||256,a=i.clips?i.clips.length:1,l=i.image||new Cr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let u=(p,m,g)=>{t[i.evaluationKey]=g;let x=i.expression.evaluate(t);l.data[p+m+0]=Math.floor(255*x.r/x.a),l.data[p+m+1]=Math.floor(255*x.g/x.a),l.data[p+m+2]=Math.floor(255*x.b/x.a),l.data[p+m+3]=Math.floor(255*x.a)};if(i.clips)for(let p=0,m=0;p<a;++p,m+=4*r)for(let g=0,x=0;g<r;g++,x+=4){let w=g/(r-1),{start:C,end:T}=i.clips[p];u(m,x,C*(1-w)+T*w)}else for(let p=0,m=0;p<r;p++,m+=4)u(0,m,p/(r-1));return l}Pe("AlphaImage",lc),Pe("RGBAImage",Cr);let ru="big-fb";class Sg extends n{createBucket(t){return new Dp(t)}constructor(t){super(t,Cg),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ru)&&this.heatmapFbos.delete(ru)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Fp;var Mg={get paint(){return Fp=Fp||new d({"hillshade-illumination-direction":new Le(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Le(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Le(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Le(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Le(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Le(oe.paint_hillshade["hillshade-accent-color"])})}};class Ig extends n{constructor(t){super(t,Mg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Tg=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:Eg}=Tg;function Bp(i,t,r=2){let a=t&&t.length,l=a?t[0]*r:i.length,u=Op(i,0,l,r,!0),p=[];if(!u||u.next===u.prev)return p;let m,g,x;if(a&&(u=function(w,C,T,P){let L=[];for(let R=0,N=C.length;R<N;R++){let $=Op(w,C[R]*P,R<N-1?C[R+1]*P:w.length,P,!1);$===$.next&&($.steiner=!0),L.push(Bg($))}L.sort(Lg);for(let R=0;R<L.length;R++)T=Rg(L[R],T);return T}(i,t,u,r)),i.length>80*r){m=1/0,g=1/0;let w=-1/0,C=-1/0;for(let T=r;T<l;T+=r){let P=i[T],L=i[T+1];P<m&&(m=P),L<g&&(g=L),P>w&&(w=P),L>C&&(C=L)}x=Math.max(w-m,C-g),x=x!==0?32767/x:0}return cc(u,p,r,m,g,x,0),p}function Op(i,t,r,a,l){let u;if(l===function(p,m,g,x){let w=0;for(let C=m,T=g-x;C<g;C+=x)w+=(p[T]-p[C])*(p[C+1]+p[T+1]),T=C;return w}(i,t,r,a)>0)for(let p=t;p<r;p+=a)u=jp(p/a|0,i[p],i[p+1],u);else for(let p=r-a;p>=t;p-=a)u=jp(p/a|0,i[p],i[p+1],u);return u&&Ch(u,u.next)&&(dc(u),u=u.next),u}function Bo(i,t){if(!i)return i;t||(t=i);let r,a=i;do if(r=!1,a.steiner||!Ch(a,a.next)&&$t(a.prev,a,a.next)!==0)a=a.next;else{if(dc(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function cc(i,t,r,a,l,u,p){if(!i)return;!p&&u&&function(g,x,w,C){let T=g;do T.z===0&&(T.z=nu(T.x,T.y,x,w,C)),T.prevZ=T.prev,T.nextZ=T.next,T=T.next;while(T!==g);T.prevZ.nextZ=null,T.prevZ=null,function(P){let L,R=1;do{let N,$=P;P=null;let re=null;for(L=0;$;){L++;let X=$,te=0;for(let fe=0;fe<R&&(te++,X=X.nextZ,X);fe++);let se=R;for(;te>0||se>0&&X;)te!==0&&(se===0||!X||$.z<=X.z)?(N=$,$=$.nextZ,te--):(N=X,X=X.nextZ,se--),re?re.nextZ=N:P=N,N.prevZ=re,re=N;$=X}re.nextZ=null,R*=2}while(L>1)}(T)}(i,a,l,u);let m=i;for(;i.prev!==i.next;){let g=i.prev,x=i.next;if(u?Pg(i,a,l,u):Ag(i))t.push(g.i,i.i,x.i),dc(i),i=x.next,m=x.next;else if((i=x)===m){p?p===1?cc(i=Dg(Bo(i),t),t,r,a,l,u,2):p===2&&zg(i,t,r,a,l,u):cc(Bo(i),t,r,a,l,u,1);break}}}function Ag(i){let t=i.prev,r=i,a=i.next;if($t(t,r,a)>=0)return!1;let l=t.x,u=r.x,p=a.x,m=t.y,g=r.y,x=a.y,w=l<u?l<p?l:p:u<p?u:p,C=m<g?m<x?m:x:g<x?g:x,T=l>u?l>p?l:p:u>p?u:p,P=m>g?m>x?m:x:g>x?g:x,L=a.next;for(;L!==t;){if(L.x>=w&&L.x<=T&&L.y>=C&&L.y<=P&&qs(l,m,u,g,p,x,L.x,L.y)&&$t(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Pg(i,t,r,a){let l=i.prev,u=i,p=i.next;if($t(l,u,p)>=0)return!1;let m=l.x,g=u.x,x=p.x,w=l.y,C=u.y,T=p.y,P=m<g?m<x?m:x:g<x?g:x,L=w<C?w<T?w:T:C<T?C:T,R=m>g?m>x?m:x:g>x?g:x,N=w>C?w>T?w:T:C>T?C:T,$=nu(P,L,t,r,a),re=nu(R,N,t,r,a),X=i.prevZ,te=i.nextZ;for(;X&&X.z>=$&&te&&te.z<=re;){if(X.x>=P&&X.x<=R&&X.y>=L&&X.y<=N&&X!==l&&X!==p&&qs(m,w,g,C,x,T,X.x,X.y)&&$t(X.prev,X,X.next)>=0||(X=X.prevZ,te.x>=P&&te.x<=R&&te.y>=L&&te.y<=N&&te!==l&&te!==p&&qs(m,w,g,C,x,T,te.x,te.y)&&$t(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;X&&X.z>=$;){if(X.x>=P&&X.x<=R&&X.y>=L&&X.y<=N&&X!==l&&X!==p&&qs(m,w,g,C,x,T,X.x,X.y)&&$t(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;te&&te.z<=re;){if(te.x>=P&&te.x<=R&&te.y>=L&&te.y<=N&&te!==l&&te!==p&&qs(m,w,g,C,x,T,te.x,te.y)&&$t(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Dg(i,t){let r=i;do{let a=r.prev,l=r.next.next;!Ch(a,l)&&Vp(a,r,r.next,l)&&hc(a,l)&&hc(l,a)&&(t.push(a.i,r.i,l.i),dc(r),dc(r.next),r=i=l),r=r.next}while(r!==i);return Bo(r)}function zg(i,t,r,a,l,u){let p=i;do{let m=p.next.next;for(;m!==p.prev;){if(p.i!==m.i&&Og(p,m)){let g=Np(p,m);return p=Bo(p,p.next),g=Bo(g,g.next),cc(p,t,r,a,l,u,0),void cc(g,t,r,a,l,u,0)}m=m.next}p=p.next}while(p!==i)}function Lg(i,t){return i.x-t.x}function Rg(i,t){let r=function(l,u){let p=u,m=l.x,g=l.y,x,w=-1/0;do{if(g<=p.y&&g>=p.next.y&&p.next.y!==p.y){let R=p.x+(g-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(R<=m&&R>w&&(w=R,x=p.x<p.next.x?p:p.next,R===m))return x}p=p.next}while(p!==u);if(!x)return null;let C=x,T=x.x,P=x.y,L=1/0;p=x;do{if(m>=p.x&&p.x>=T&&m!==p.x&&qs(g<P?m:w,g,T,P,g<P?w:m,g,p.x,p.y)){let R=Math.abs(g-p.y)/(m-p.x);hc(p,l)&&(R<L||R===L&&(p.x>x.x||p.x===x.x&&Fg(x,p)))&&(x=p,L=R)}p=p.next}while(p!==C);return x}(i,t);if(!r)return t;let a=Np(r,i);return Bo(a,a.next),Bo(r,r.next)}function Fg(i,t){return $t(i.prev,i,t.prev)<0&&$t(t.next,i,i.next)<0}function nu(i,t,r,a,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Bg(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function qs(i,t,r,a,l,u,p,m){return(l-p)*(t-m)>=(i-p)*(u-m)&&(i-p)*(a-m)>=(r-p)*(t-m)&&(r-p)*(u-m)>=(l-p)*(a-m)}function Og(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,a){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Vp(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(hc(i,t)&&hc(t,i)&&function(r,a){let l=r,u=!1,p=(r.x+a.x)/2,m=(r.y+a.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&p<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(i,t)&&($t(i.prev,i,t.prev)||$t(i,t.prev,t))||Ch(i,t)&&$t(i.prev,i,i.next)>0&&$t(t.prev,t,t.next)>0)}function $t(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Ch(i,t){return i.x===t.x&&i.y===t.y}function Vp(i,t,r,a){let l=Mh($t(i,t,r)),u=Mh($t(i,t,a)),p=Mh($t(r,a,i)),m=Mh($t(r,a,t));return l!==u&&p!==m||!(l!==0||!Sh(i,r,t))||!(u!==0||!Sh(i,a,t))||!(p!==0||!Sh(r,i,a))||!(m!==0||!Sh(r,t,a))}function Sh(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Mh(i){return i>0?1:i<0?-1:0}function hc(i,t){return $t(i.prev,i,i.next)<0?$t(i,t,i.next)>=0&&$t(i,i.prev,t)>=0:$t(i,t,i.prev)<0||$t(i,i.next,t)<0}function Np(i,t){let r=au(i.i,i.x,i.y),a=au(t.i,t.x,t.y),l=i.next,u=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,a.next=r,r.prev=a,u.next=a,a.prev=u,a}function jp(i,t,r,a){let l=au(i,t,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function dc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function au(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ou(i,t,r){let a=r.patternDependencies,l=!1;for(let u of t){let p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);let m=p.constantOr(null);m&&(l=!0,a[m.to]=!0,a[m.from]=!0)}return l}function su(i,t,r,a,l){let u=l.patternDependencies;for(let p of t){let m=p.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:a-1},r,{},l.availableImages),x=m.evaluate({zoom:a},r,{},l.availableImages),w=m.evaluate({zoom:a+1},r,{},l.availableImages);g=g&&g.name?g.name:g,x=x&&x.name?x.name:x,w=w&&w.name?w.name:w,u[g]=!0,u[x]=!0,u[w]=!0,r.patterns[p.id]={min:g,mid:x,max:w}}}return r}class lu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ur,this.indexArray=new kr,this.indexArray2=new ai,this.programConfigurations=new Lo(t.layers,t.zoom),this.segments=new lt,this.segments2=new lt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=ou("fill",this.layers,r);let l=this.layers[0].layout.get("fill-sort-key"),u=!l.isConstant(),p=[];for(let{feature:m,id:g,index:x,sourceLayerIndex:w}of t){let C=this.layers[0]._featureFilter.needGeometry,T=Fo(m,C);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),T,a))continue;let P=u?l.evaluate(T,{},a,r.availableImages):void 0,L={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:C?T.geometry:Ro(m),patterns:{},sortKey:P};p.push(L)}u&&p.sort((m,g)=>m.sortKey-g.sortKey);for(let m of p){let{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){let C=su("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(m,g,x,a,{});r.featureIndex.insert(t[x].feature,g,x,w,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Eg),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,l,u){for(let p of us(r,500)){let m=0;for(let P of p)m+=P.length;let g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),x=g.vertexLength,w=[],C=[];for(let P of p){if(P.length===0)continue;P!==p[0]&&C.push(w.length/2);let L=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),R=L.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(R+P.length-1,R),w.push(P[0].x),w.push(P[0].y);for(let N=1;N<P.length;N++)this.layoutVertexArray.emplaceBack(P[N].x,P[N].y),this.indexArray2.emplaceBack(R+N-1,R+N),w.push(P[N].x),w.push(P[N].y);L.vertexLength+=P.length,L.primitiveLength+=P.length}let T=Bp(w,C);for(let P=0;P<T.length;P+=3)this.indexArray.emplaceBack(x+T[P],x+T[P+1],x+T[P+2]);g.vertexLength+=m,g.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}let qp,Up;Pe("FillBucket",lu,{omit:["layers","patternFeatures"]});var Vg={get paint(){return Up=Up||new d({"fill-antialias":new Le(oe.paint_fill["fill-antialias"]),"fill-opacity":new Ue(oe.paint_fill["fill-opacity"]),"fill-color":new Ue(oe.paint_fill["fill-color"]),"fill-outline-color":new Ue(oe.paint_fill["fill-outline-color"]),"fill-translate":new Le(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Le(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ds(oe.paint_fill["fill-pattern"])})},get layout(){return qp=qp||new d({"fill-sort-key":new Ue(oe.layout_fill["fill-sort-key"])})}};class Ng extends n{constructor(t){super(t,Vg)}recalculate(t,r){super.recalculate(t,r);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new lu(t)}queryRadius(){return xh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m){return Sp(wh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,m),l)}isTileClipped(){return!0}}let jg=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qg=f([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ug}=jg;var $a={},$g=ze,$p=Us;function Us(i,t,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=l,i.readFields(Zg,this,t)}function Zg(i,t,r){i==1?t.id=r.readVarint():i==2?function(a,l){for(var u=a.readVarint()+a.pos;a.pos<u;){var p=l._keys[a.readVarint()],m=l._values[a.readVarint()];l.properties[p]=m}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Gg(i){for(var t,r,a=0,l=0,u=i.length,p=u-1;l<u;p=l++)a+=((r=i[p]).x-(t=i[l]).x)*(t.y+r.y);return a}Us.types=["Unknown","Point","LineString","Polygon"],Us.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,a=1,l=0,u=0,p=0,m=[];i.pos<r;){if(l<=0){var g=i.readVarint();a=7&g,l=g>>3}if(l--,a===1||a===2)u+=i.readSVarint(),p+=i.readSVarint(),a===1&&(t&&m.push(t),t=[]),t.push(new $g(u,p));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&m.push(t),m},Us.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,a=0,l=0,u=0,p=1/0,m=-1/0,g=1/0,x=-1/0;i.pos<t;){if(a<=0){var w=i.readVarint();r=7&w,a=w>>3}if(a--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>m&&(m=l),(u+=i.readSVarint())<g&&(g=u),u>x&&(x=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,g,m,x]},Us.prototype.toGeoJSON=function(i,t,r){var a,l,u=this.extent*Math.pow(2,r),p=this.extent*i,m=this.extent*t,g=this.loadGeometry(),x=Us.types[this.type];function w(P){for(var L=0;L<P.length;L++){var R=P[L];P[L]=[360*(R.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<g.length;a++)C[a]=g[a][0];w(g=C);break;case 2:for(a=0;a<g.length;a++)w(g[a]);break;case 3:for(g=function(P){var L=P.length;if(L<=1)return[P];for(var R,N,$=[],re=0;re<L;re++){var X=Gg(P[re]);X!==0&&(N===void 0&&(N=X<0),N===X<0?(R&&$.push(R),R=[P[re]]):R.push(P[re]))}return R&&$.push(R),$}(g),a=0;a<g.length;a++)for(l=0;l<g[a].length;l++)w(g[a][l])}g.length===1?g=g[0]:x="Multi"+x;var T={type:"Feature",geometry:{type:x,coordinates:g},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Hg=$p,Zp=Gp;function Gp(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Wg,this,t),this.length=this._features.length}function Wg(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(a){for(var l=null,u=a.readVarint()+a.pos;a.pos<u;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}Gp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Hg(this._pbf,t,this.extent,this._keys,this._values)};var Xg=Zp;function Kg(i,t,r){if(i===3){var a=new Xg(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}$a.VectorTile=function(i,t){this.layers=i.readFields(Kg,{},t)},$a.VectorTileFeature=$p,$a.VectorTileLayer=Zp;let Yg=$a.VectorTileFeature.types,cu=Math.pow(2,13);function uc(i,t,r,a,l,u,p,m){i.emplaceBack(t,r,2*Math.floor(a*cu)+p,l*cu*2,u*cu*2,Math.round(m))}class hu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Oa,this.centroidVertexArray=new di,this.indexArray=new kr,this.programConfigurations=new Lo(t.layers,t.zoom),this.segments=new lt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.features=[],this.hasPattern=ou("fill-extrusion",this.layers,r);for(let{feature:l,id:u,index:p,sourceLayerIndex:m}of t){let g=this.layers[0]._featureFilter.needGeometry,x=Fo(l,g);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),x,a))continue;let w={id:u,sourceLayerIndex:m,index:p,geometry:g?x.geometry:Ro(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(su("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,a,{}),r.featureIndex.insert(l,w.geometry,p,m,this.index,!0)}}addFeatures(t,r,a){for(let l of this.features){let{geometry:u}=l;this.addFeature(l,u,l.index,r,a)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ug),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,qg.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,l,u){for(let p of us(r,500)){let m={x:0,y:0,vertexCount:0},g=0;for(let L of p)g+=L.length;let x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let L of p){if(L.length===0||Qg(L))continue;let R=0;for(let N=0;N<L.length;N++){let $=L[N];if(N>=1){let re=L[N-1];if(!Jg($,re)){x.vertexLength+4>lt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let X=$.sub(re)._perp()._unit(),te=re.dist($);R+te>32768&&(R=0),uc(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,0,R),uc(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,1,R),m.x+=2*$.x,m.y+=2*$.y,m.vertexCount+=2,R+=te,uc(this.layoutVertexArray,re.x,re.y,X.x,X.y,0,0,R),uc(this.layoutVertexArray,re.x,re.y,X.x,X.y,0,1,R),m.x+=2*re.x,m.y+=2*re.y,m.vertexCount+=2;let se=x.vertexLength;this.indexArray.emplaceBack(se,se+2,se+1),this.indexArray.emplaceBack(se+1,se+2,se+3),x.vertexLength+=4,x.primitiveLength+=2}}}}if(x.vertexLength+g>lt.MAX_VERTEX_ARRAY_LENGTH&&(x=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),Yg[t.type]!=="Polygon")continue;let w=[],C=[],T=x.vertexLength;for(let L of p)if(L.length!==0){L!==p[0]&&C.push(w.length/2);for(let R=0;R<L.length;R++){let N=L[R];uc(this.layoutVertexArray,N.x,N.y,0,0,1,1,0),m.x+=N.x,m.y+=N.y,m.vertexCount+=1,w.push(N.x),w.push(N.y)}}let P=Bp(w,C);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(T+P[L],T+P[L+2],T+P[L+1]);x.primitiveLength+=P.length/3,x.vertexLength+=g;for(let L=0;L<m.vertexCount;L++){let R=Math.floor(m.x/m.vertexCount),N=Math.floor(m.y/m.vertexCount);this.centroidVertexArray.emplaceBack(R,N)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}function Jg(i,t){return i.x===t.x&&(i.x<0||i.x>Xt)||i.y===t.y&&(i.y<0||i.y>Xt)}function Qg(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Xt)||i.every(t=>t.y<0)||i.every(t=>t.y>Xt)}let Hp;Pe("FillExtrusionBucket",hu,{omit:["layers","features"]});var e_={get paint(){return Hp=Hp||new d({"fill-extrusion-opacity":new Le(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Le(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Le(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ds(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Le(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class t_ extends n{constructor(t){super(t,e_)}createBucket(t){return new hu(t)}queryRadius(){return xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,a,l,u,p,m,g){let x=wh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,m),w=this.paint.get("fill-extrusion-height").evaluate(r,a),C=this.paint.get("fill-extrusion-base").evaluate(r,a),T=function(L,R,N,$){let re=[];for(let X of L){let te=[X.x,X.y,0,1];kh(te,te,R),re.push(new ge(te[0]/te[3],te[1]/te[3]))}return re}(x,g),P=function(L,R,N,$){let re=[],X=[],te=$[8]*R,se=$[9]*R,fe=$[10]*R,Te=$[11]*R,qe=$[8]*N,Me=$[9]*N,Ce=$[10]*N,Be=$[11]*N;for(let De of L){let Ae=[],de=[];for(let Oe of De){let Fe=Oe.x,He=Oe.y,wt=$[0]*Fe+$[4]*He+$[12],xt=$[1]*Fe+$[5]*He+$[13],ti=$[2]*Fe+$[6]*He+$[14],$r=$[3]*Fe+$[7]*He+$[15],mi=ti+fe,ii=$r+Te,Fi=wt+qe,Bi=xt+Me,Oi=ti+Ce,Vt=$r+Be,ri=new ge((wt+te)/ii,(xt+se)/ii);ri.z=mi/ii,Ae.push(ri);let Ci=new ge(Fi/Vt,Bi/Vt);Ci.z=Oi/Vt,de.push(Ci)}re.push(Ae),X.push(de)}return[re,X]}(l,C,w,g);return function(L,R,N){let $=1/0;Sp(N,R)&&($=Wp(N,R[0]));for(let re=0;re<R.length;re++){let X=R[re],te=L[re];for(let se=0;se<X.length-1;se++){let fe=X[se],Te=[fe,X[se+1],te[se+1],te[se],fe];Cp(N,Te)&&($=Math.min($,Wp(N,Te)))}}return $!==1/0&&$}(P[0],P[1],T)}}function pc(i,t){return i.x*t.x+i.y*t.y}function Wp(i,t){if(i.length===1){let r=0,a=t[r++],l;for(;!l||a.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){let u=t[r],p=i[0],m=l.sub(a),g=u.sub(a),x=p.sub(a),w=pc(m,m),C=pc(m,g),T=pc(g,g),P=pc(x,m),L=pc(x,g),R=w*T-C*C,N=(T*P-C*L)/R,$=(w*L-C*P)/R,re=a.z*(1-N-$)+l.z*N+u.z*$;if(isFinite(re))return re}return 1/0}{let r=1/0;for(let a of t)r=Math.min(r,a.z);return r}}let i_=f([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:r_}=i_,n_=f([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:a_}=n_,o_=$a.VectorTileFeature.types,s_=Math.cos(Math.PI/180*37.5),Xp=Math.pow(2,14)/.5;class du{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ls,this.layoutVertexArray2=new Va,this.indexArray=new kr,this.programConfigurations=new Lo(t.layers,t.zoom),this.segments=new lt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=ou("line",this.layers,r);let l=this.layers[0].layout.get("line-sort-key"),u=!l.isConstant(),p=[];for(let{feature:m,id:g,index:x,sourceLayerIndex:w}of t){let C=this.layers[0]._featureFilter.needGeometry,T=Fo(m,C);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),T,a))continue;let P=u?l.evaluate(T,{},a):void 0,L={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:C?T.geometry:Ro(m),patterns:{},sortKey:P};p.push(L)}u&&p.sort((m,g)=>m.sortKey-g.sortKey);for(let m of p){let{geometry:g,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){let C=su("line",this.layers,m,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(m,g,x,a,{});r.featureIndex.insert(t[x].feature,g,x,w,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,a_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,r_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,l,u){let p=this.layers[0].layout,m=p.get("line-join").evaluate(t,{}),g=p.get("line-cap"),x=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let C of r)this.addLine(C,t,m,g,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}addLine(t,r,a,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<t.length-1;$++)this.totalDistance+=t[$].dist(t[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let m=o_[r.type]==="Polygon",g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let x=0;for(;x<g-1&&t[x].equals(t[x+1]);)x++;if(g<(m?3:2))return;a==="bevel"&&(u=1.05);let w=this.overscaling<=16?15*Xt/(512*this.overscaling):0,C=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray),T,P,L,R,N;this.e1=this.e2=-1,m&&(T=t[g-2],N=t[x].sub(T)._unit()._perp());for(let $=x;$<g;$++){if(L=$===g-1?m?t[x+1]:void 0:t[$+1],L&&t[$].equals(L))continue;N&&(R=N),T&&(P=T),T=t[$],N=L?L.sub(T)._unit()._perp():R,R=R||N;let re=R.add(N);re.x===0&&re.y===0||re._unit();let X=R.x*N.x+R.y*N.y,te=re.x*N.x+re.y*N.y,se=te!==0?1/te:1/0,fe=2*Math.sqrt(2-2*te),Te=te<s_&&P&&L,qe=R.x*N.y-R.y*N.x>0;if(Te&&$>x){let Be=T.dist(P);if(Be>2*w){let De=T.sub(T.sub(P)._mult(w/Be)._round());this.updateDistance(P,De),this.addCurrentVertex(De,R,0,0,C),P=De}}let Me=P&&L,Ce=Me?a:m?"butt":l;if(Me&&Ce==="round"&&(se<p?Ce="miter":se<=2&&(Ce="fakeround")),Ce==="miter"&&se>u&&(Ce="bevel"),Ce==="bevel"&&(se>2&&(Ce="flipbevel"),se<u&&(Ce="miter")),P&&this.updateDistance(P,T),Ce==="miter")re._mult(se),this.addCurrentVertex(T,re,0,0,C);else if(Ce==="flipbevel"){if(se>100)re=N.mult(-1);else{let Be=se*R.add(N).mag()/R.sub(N).mag();re._perp()._mult(Be*(qe?-1:1))}this.addCurrentVertex(T,re,0,0,C),this.addCurrentVertex(T,re.mult(-1),0,0,C)}else if(Ce==="bevel"||Ce==="fakeround"){let Be=-Math.sqrt(se*se-1),De=qe?Be:0,Ae=qe?0:Be;if(P&&this.addCurrentVertex(T,R,De,Ae,C),Ce==="fakeround"){let de=Math.round(180*fe/Math.PI/20);for(let Oe=1;Oe<de;Oe++){let Fe=Oe/de;if(Fe!==.5){let wt=Fe-.5;Fe+=Fe*wt*(Fe-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*wt*wt+(.848013+X*(.215638*X-1.06021)))}let He=N.sub(R)._mult(Fe)._add(R)._unit()._mult(qe?-1:1);this.addHalfVertex(T,He.x,He.y,!1,qe,0,C)}}L&&this.addCurrentVertex(T,N,-De,-Ae,C)}else if(Ce==="butt")this.addCurrentVertex(T,re,0,0,C);else if(Ce==="square"){let Be=P?1:-1;this.addCurrentVertex(T,re,Be,Be,C)}else Ce==="round"&&(P&&(this.addCurrentVertex(T,R,0,0,C),this.addCurrentVertex(T,R,1,1,C,!0)),L&&(this.addCurrentVertex(T,N,-1,-1,C,!0),this.addCurrentVertex(T,N,0,0,C)));if(Te&&$<g-1){let Be=T.dist(L);if(Be>2*w){let De=T.add(L.sub(T)._mult(w/Be)._round());this.updateDistance(T,De),this.addCurrentVertex(De,N,0,0,C),T=De}}}}addCurrentVertex(t,r,a,l,u,p=!1){let m=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,p,!1,a,u),this.addHalfVertex(t,m,g,p,!0,-l,u),this.distance>Xp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,l,u,p))}addHalfVertex({x:t,y:r},a,l,u,p,m,g){let x=.5*(this.lineClips?this.scaledDistance*(Xp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&x)<<2,x>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Kp,Yp;Pe("LineBucket",du,{omit:["layers","patternFeatures"]});var Jp={get paint(){return Yp=Yp||new d({"line-opacity":new Ue(oe.paint_line["line-opacity"]),"line-color":new Ue(oe.paint_line["line-color"]),"line-translate":new Le(oe.paint_line["line-translate"]),"line-translate-anchor":new Le(oe.paint_line["line-translate-anchor"]),"line-width":new Ue(oe.paint_line["line-width"]),"line-gap-width":new Ue(oe.paint_line["line-gap-width"]),"line-offset":new Ue(oe.paint_line["line-offset"]),"line-blur":new Ue(oe.paint_line["line-blur"]),"line-dasharray":new zs(oe.paint_line["line-dasharray"]),"line-pattern":new Ds(oe.paint_line["line-pattern"]),"line-gradient":new rc(oe.paint_line["line-gradient"])})},get layout(){return Kp=Kp||new d({"line-cap":new Le(oe.layout_line["line-cap"]),"line-join":new Ue(oe.layout_line["line-join"]),"line-miter-limit":new Le(oe.layout_line["line-miter-limit"]),"line-round-limit":new Le(oe.layout_line["line-round-limit"]),"line-sort-key":new Ue(oe.layout_line["line-sort-key"])})}};class l_ extends Ue{possiblyEvaluate(t,r){return r=new It(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,l){return r=ir({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,l)}}let Ih;class c_ extends n{constructor(t){super(t,Jp),this.gradientVersion=0,Ih||(Ih=new l_(Jp.paint.properties["line-width"].specification),Ih.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof va,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ih.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new du(t)}queryRadius(t){let r=t,a=Qp(oc("line-width",this,r),oc("line-gap-width",this,r)),l=oc("line-offset",this,r);return a/2+Math.abs(l)+xh(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m){let g=wh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,m),x=m/2*Qp(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),w=this.paint.get("line-offset").evaluate(r,a);return w&&(l=function(C,T){let P=[];for(let L=0;L<C.length;L++){let R=C[L],N=[];for(let $=0;$<R.length;$++){let re=R[$-1],X=R[$],te=R[$+1],se=$===0?new ge(0,0):X.sub(re)._unit()._perp(),fe=$===R.length-1?new ge(0,0):te.sub(X)._unit()._perp(),Te=se._add(fe)._unit(),qe=Te.x*fe.x+Te.y*fe.y;qe!==0&&Te._mult(1/qe),N.push(Te._mult(T)._add(X))}P.push(N)}return P}(l,w*m)),function(C,T,P){for(let L=0;L<T.length;L++){let R=T[L];if(C.length>=3){for(let N=0;N<R.length;N++)if(Ns(C,R[N]))return!0}if(yg(C,R,P))return!0}return!1}(g,l,x)}isTileClipped(){return!0}}function Qp(i,t){return t>0?t+2*i:i}let h_=f([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),d_=f([{name:"a_projected_pos",components:3,type:"Float32"}],4);f([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let u_=f([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);f([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let em=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),p_=f([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function m_(i,t,r){return i.sections.forEach(a=>{a.text=function(l,u,p){let m=u.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Ki.applyArabicShaping&&(l=Ki.applyArabicShaping(l)),l}(a.text,t,r)}),i}f([{name:"triangle",components:3,type:"Uint16"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),f([{type:"Float32",name:"offsetX"}]),f([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),f([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let mc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Jt=24,tm=bt,im=function(i,t,r,a,l){var u,p,m=8*l-a-1,g=(1<<m)-1,x=g>>1,w=-7,C=r?l-1:0,T=r?-1:1,P=i[t+C];for(C+=T,u=P&(1<<-w)-1,P>>=-w,w+=m;w>0;u=256*u+i[t+C],C+=T,w-=8);for(p=u&(1<<-w)-1,u>>=-w,w+=a;w>0;p=256*p+i[t+C],C+=T,w-=8);if(u===0)u=1-x;else{if(u===g)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,a),u-=x}return(P?-1:1)*p*Math.pow(2,u-a)},rm=function(i,t,r,a,l,u){var p,m,g,x=8*u-l-1,w=(1<<x)-1,C=w>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:u-1,L=a?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,p=w):(p=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-p))<1&&(p--,g*=2),(t+=p+C>=1?T/g:T*Math.pow(2,1-C))*g>=2&&(p++,g/=2),p+C>=w?(m=0,p=w):p+C>=1?(m=(t*g-1)*Math.pow(2,l),p+=C):(m=t*Math.pow(2,C-1)*Math.pow(2,l),p=0));l>=8;i[r+P]=255&m,P+=L,m/=256,l-=8);for(p=p<<l|m,x+=l;x>0;i[r+P]=255&p,P+=L,p/=256,x-=8);i[r+P-L]|=128*R};function bt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}bt.Varint=0,bt.Fixed64=1,bt.Bytes=2,bt.Fixed32=5;var uu=4294967296,nm=1/uu,am=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Qn(i){return i.type===bt.Bytes?i.readVarint()+i.pos:i.pos+1}function $s(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function om(i,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=i;l--)r.buf[l+a]=r.buf[l]}function f_(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function g_(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function __(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function y_(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function v_(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function b_(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function x_(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function w_(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function k_(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Th(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Zs(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function sm(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}bt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,u=this.pos;this.type=7&a,i(l,t,this),this.pos===u&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Th(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=sm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Th(this.buf,this.pos)+Th(this.buf,this.pos+4)*uu;return this.pos+=8,i},readSFixed64:function(){var i=Th(this.buf,this.pos)+sm(this.buf,this.pos+4)*uu;return this.pos+=8,i},readFloat:function(){var i=im(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=im(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(l,u,p){var m,g,x=p.buf;if(m=(112&(g=x[p.pos++]))>>4,g<128||(m|=(127&(g=x[p.pos++]))<<3,g<128)||(m|=(127&(g=x[p.pos++]))<<10,g<128)||(m|=(127&(g=x[p.pos++]))<<17,g<128)||(m|=(127&(g=x[p.pos++]))<<24,g<128)||(m|=(1&(g=x[p.pos++]))<<31,g<128))return $s(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&am?function(r,a,l){return am.decode(r.subarray(a,l))}(this.buf,t,i):function(r,a,l){for(var u="",p=a;p<l;){var m,g,x,w=r[p],C=null,T=w>239?4:w>223?3:w>191?2:1;if(p+T>l)break;T===1?w<128&&(C=w):T===2?(192&(m=r[p+1]))==128&&(C=(31&w)<<6|63&m)<=127&&(C=null):T===3?(g=r[p+2],(192&(m=r[p+1]))==128&&(192&g)==128&&((C=(15&w)<<12|(63&m)<<6|63&g)<=2047||C>=55296&&C<=57343)&&(C=null)):T===4&&(g=r[p+2],x=r[p+3],(192&(m=r[p+1]))==128&&(192&g)==128&&(192&x)==128&&((C=(15&w)<<18|(63&m)<<12|(63&g)<<6|63&x)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,T=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),p+=T}return u}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==bt.Bytes)return i.push(this.readVarint(t));var r=Qn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==bt.Bytes)return i.push(this.readSVarint());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==bt.Bytes)return i.push(this.readBoolean());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==bt.Bytes)return i.push(this.readFloat());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==bt.Bytes)return i.push(this.readDouble());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==bt.Bytes)return i.push(this.readFixed32());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==bt.Bytes)return i.push(this.readSFixed32());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==bt.Bytes)return i.push(this.readFixed64());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==bt.Bytes)return i.push(this.readSFixed64());var t=Qn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===bt.Varint)for(;this.buf[this.pos++]>127;);else if(t===bt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===bt.Fixed32)this.pos+=4;else{if(t!==bt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Zs(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Zs(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Zs(this.buf,-1&i,this.pos),Zs(this.buf,Math.floor(i*nm),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Zs(this.buf,-1&i,this.pos),Zs(this.buf,Math.floor(i*nm),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var a,l;if(t>=0?(a=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(a,0,r),function(u,p){var m=(7&u)<<4;p.buf[p.pos++]|=m|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,l,u){for(var p,m,g=0;g<l.length;g++){if((p=l.charCodeAt(g))>55295&&p<57344){if(!m){p>56319||g+1===l.length?(a[u++]=239,a[u++]=191,a[u++]=189):m=p;continue}if(p<56320){a[u++]=239,a[u++]=191,a[u++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(a[u++]=239,a[u++]=191,a[u++]=189,m=null);p<128?a[u++]=p:(p<2048?a[u++]=p>>6|192:(p<65536?a[u++]=p>>12|224:(a[u++]=p>>18|240,a[u++]=p>>12&63|128),a[u++]=p>>6&63|128),a[u++]=63&p|128)}return u}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&om(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),rm(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),rm(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var a=this.pos-r;a>=128&&om(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,r){this.writeTag(i,bt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,f_,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,g_,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,v_,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,__,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,y_,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,b_,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,x_,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,w_,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,k_,t)},writeBytesField:function(i,t){this.writeTag(i,bt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,bt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,bt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,bt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,bt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,bt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,bt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,bt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,bt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,bt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var pu=he(tm);let mu=3;function C_(i,t,r){i===1&&r.readMessage(S_,t)}function S_(i,t,r){if(i===3){let{id:a,bitmap:l,width:u,height:p,left:m,top:g,advance:x}=r.readMessage(M_,{});t.push({id:a,bitmap:new lc({width:u+2*mu,height:p+2*mu},l),metrics:{width:u,height:p,left:m,top:g,advance:x}})}}function M_(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}let lm=mu;function cm(i){let t=0,r=0;for(let p of i)t+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,m)=>m.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],l=0,u=0;for(let p of i)for(let m=a.length-1;m>=0;m--){let g=a[m];if(!(p.w>g.w||p.h>g.h)){if(p.x=g.x,p.y=g.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===g.w&&p.h===g.h){let x=a.pop();m<a.length&&(a[m]=x)}else p.h===g.h?(g.x+=p.w,g.w-=p.w):p.w===g.w?(g.y+=p.h,g.h-=p.h):(a.push({x:g.x+p.w,y:g.y,w:g.w-p.w,h:p.h}),g.y+=p.h,g.h-=p.h);break}}return{w:l,h:u,fill:t/(l*u)||0}}let Ji=1;class fu{constructor(t,{pixelRatio:r,version:a,stretchX:l,stretchY:u,content:p,textFitWidth:m,textFitHeight:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=p,this.version=a,this.textFitWidth=m,this.textFitHeight=g}get tl(){return[this.paddedRect.x+Ji,this.paddedRect.y+Ji]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ji,this.paddedRect.y+this.paddedRect.h-Ji]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ji)/this.pixelRatio,(this.paddedRect.h-2*Ji)/this.pixelRatio]}}class hm{constructor(t,r){let a={},l={};this.haveRenderCallbacks=[];let u=[];this.addImages(t,a,u),this.addImages(r,l,u);let{w:p,h:m}=cm(u),g=new Cr({width:p||1,height:m||1});for(let x in t){let w=t[x],C=a[x].paddedRect;Cr.copy(w.data,g,{x:0,y:0},{x:C.x+Ji,y:C.y+Ji},w.data)}for(let x in r){let w=r[x],C=l[x].paddedRect,T=C.x+Ji,P=C.y+Ji,L=w.data.width,R=w.data.height;Cr.copy(w.data,g,{x:0,y:0},{x:T,y:P},w.data),Cr.copy(w.data,g,{x:0,y:R-1},{x:T,y:P-1},{width:L,height:1}),Cr.copy(w.data,g,{x:0,y:0},{x:T,y:P+R},{width:L,height:1}),Cr.copy(w.data,g,{x:L-1,y:0},{x:T-1,y:P},{width:1,height:R}),Cr.copy(w.data,g,{x:0,y:0},{x:T+L,y:P},{width:1,height:R})}this.image=g,this.iconPositions=a,this.patternPositions=l}addImages(t,r,a){for(let l in t){let u=t[l],p={x:0,y:0,w:u.data.width+2*Ji,h:u.data.height+2*Ji};a.push(p),r[l]=new fu(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;let[l,u]=t.tl;a.update(r.data,void 0,{x:l,y:u})}}var Za;Pe("ImagePosition",fu),Pe("ImageAtlas",hm),y.ah=void 0,(Za=y.ah||(y.ah={}))[Za.none=0]="none",Za[Za.horizontal=1]="horizontal",Za[Za.vertical=2]="vertical",Za[Za.horizontalOnly=3]="horizontalOnly";let fc=-17;class gc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){let a=new gc;return a.scale=t||1,a.fontStack=r,a}static forImage(t){let r=new gc;return r.imageName=t,r}}class Gs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let a=new Gs;for(let l=0;l<t.sections.length;l++){let u=t.sections[l];u.image?a.addImageSection(u):a.addTextSection(u,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let a=0;a<t.length;a++){let l=t.charCodeAt(a+1)||null,u=t.charCodeAt(a-1)||null;r+=l&&mh(l)&&!mc[t[a+1]]||u&&mh(u)&&!mc[t[a-1]]||!mc[t[a]]?t[a]:mc[t[a]]}return r}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Ah[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Ah[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let a=new Gs;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(gc.forText(t.scale,t.fontStack||r));let a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void li("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(gc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Eh(i,t,r,a,l,u,p,m,g,x,w,C,T,P,L){let R=Gs.fromFeature(i,l),N;C===y.ah.vertical&&R.verticalizePunctuation();let{processBidirectionalText:$,processStyledBidirectionalText:re}=Ki;if($&&R.sections.length===1){N=[];let se=$(R.toString(),gu(R,x,u,t,a,P));for(let fe of se){let Te=new Gs;Te.text=fe,Te.sections=R.sections;for(let qe=0;qe<fe.length;qe++)Te.sectionIndex.push(0);N.push(Te)}}else if(re){N=[];let se=re(R.text,R.sectionIndex,gu(R,x,u,t,a,P));for(let fe of se){let Te=new Gs;Te.text=fe[0],Te.sectionIndex=fe[1],Te.sections=R.sections,N.push(Te)}}else N=function(se,fe){let Te=[],qe=se.text,Me=0;for(let Ce of fe)Te.push(se.substring(Me,Ce)),Me=Ce;return Me<qe.length&&Te.push(se.substring(Me,qe.length)),Te}(R,gu(R,x,u,t,a,P));let X=[],te={positionedLines:X,text:R.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(se,fe,Te,qe,Me,Ce,Be,De,Ae,de,Oe,Fe){let He=0,wt=fc,xt=0,ti=0,$r=De==="right"?1:De==="left"?0:.5,mi=0;for(let Vt of Me){Vt.trim();let ri=Vt.getMaxScale(),Ci=(ri-1)*Jt,fi={positionedGlyphs:[],lineOffset:0};se.positionedLines[mi]=fi;let Vi=fi.positionedGlyphs,gi=0;if(!Vt.length()){wt+=Ce,++mi;continue}for(let Qi=0;Qi<Vt.length();Qi++){let ut=Vt.getSection(Qi),St=Vt.getSectionIndex(Qi),Pt=Vt.getCharCode(Qi),dr=0,Ft=null,Ks=null,Cn=null,Sn=Jt,Zr=!(Ae===y.ah.horizontal||!Oe&&!tc(Pt)||Oe&&(Ah[Pt]||(ii=Pt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ii)))));if(ut.imageName){let Ir=qe[ut.imageName];if(!Ir)continue;Cn=ut.imageName,se.iconsInText=se.iconsInText||!0,Ks=Ir.paddedRect;let oi=Ir.displaySize;ut.scale=ut.scale*Jt/Fe,Ft={width:oi[0],height:oi[1],left:Ji,top:-lm,advance:Zr?oi[1]:oi[0]},dr=Ci+(Jt-oi[1]*ut.scale),Sn=Ft.advance;let ea=Zr?oi[0]*ut.scale-Jt*ri:oi[1]*ut.scale-Jt*ri;ea>0&&ea>gi&&(gi=ea)}else{let Ir=Te[ut.fontStack],oi=Ir&&Ir[Pt];if(oi&&oi.rect)Ks=oi.rect,Ft=oi.metrics;else{let ea=fe[ut.fontStack],wc=ea&&ea[Pt];if(!wc)continue;Ft=wc.metrics}dr=(ri-ut.scale)*Jt}Zr?(se.verticalizable=!0,Vi.push({glyph:Pt,imageName:Cn,x:He,y:wt+dr,vertical:Zr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:St,metrics:Ft,rect:Ks}),He+=Sn*ut.scale+de):(Vi.push({glyph:Pt,imageName:Cn,x:He,y:wt+dr,vertical:Zr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:St,metrics:Ft,rect:Ks}),He+=Ft.advance*ut.scale+de)}Vi.length!==0&&(xt=Math.max(He-de,xt),A_(Vi,0,Vi.length-1,$r,gi)),He=0;let Mr=Ce*ri+gi;fi.lineOffset=Math.max(gi,Ci),wt+=Mr,ti=Math.max(Mr,ti),++mi}var ii;let Fi=wt-fc,{horizontalAlign:Bi,verticalAlign:Oi}=_u(Be);(function(Vt,ri,Ci,fi,Vi,gi,Mr,Qi,ut){let St=(ri-Ci)*Vi,Pt=0;Pt=gi!==Mr?-Qi*fi-fc:(-fi*ut+.5)*Mr;for(let dr of Vt)for(let Ft of dr.positionedGlyphs)Ft.x+=St,Ft.y+=Pt})(se.positionedLines,$r,Bi,Oi,xt,ti,Ce,Fi,Me.length),se.top+=-Oi*Fi,se.bottom=se.top+Fi,se.left+=-Bi*xt,se.right=se.left+xt}(te,t,r,a,N,p,m,g,C,x,T,L),!function(se){for(let fe of se)if(fe.positionedGlyphs.length!==0)return!1;return!0}(X)&&te}let Ah={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},T_={40:!0};function dm(i,t,r,a,l,u){if(t.imageName){let p=a[t.imageName];return p?p.displaySize[0]*t.scale*Jt/u+l:0}{let p=r[t.fontStack],m=p&&p[i];return m?m.metrics.advance*t.scale+l:0}}function um(i,t,r,a){let l=Math.pow(i-t,2);return a?i<t?l/2:2*l:l+Math.abs(r)*r}function E_(i,t,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function pm(i,t,r,a,l,u){let p=null,m=um(t,r,l,u);for(let g of a){let x=um(t-g.x,r,l,u)+g.badness;x<=m&&(p=g,m=x)}return{index:i,x:t,priorBreak:p,badness:m}}function mm(i){return i?mm(i.priorBreak).concat(i.index):[]}function gu(i,t,r,a,l,u){if(!i)return[];let p=[],m=function(C,T,P,L,R,N){let $=0;for(let re=0;re<C.length();re++){let X=C.getSection(re);$+=dm(C.getCharCode(re),X,L,R,T,N)}return $/Math.max(1,Math.ceil($/P))}(i,t,r,a,l,u),g=i.text.indexOf("\u200B")>=0,x=0;for(let C=0;C<i.length();C++){let T=i.getSection(C),P=i.getCharCode(C);if(Ah[P]||(x+=dm(P,T,a,l,t,u)),C<i.length()-1){let L=!((w=P)<11904)&&(!!st["CJK Compatibility Forms"](w)||!!st["CJK Compatibility"](w)||!!st["CJK Strokes"](w)||!!st["CJK Symbols and Punctuation"](w)||!!st["Enclosed CJK Letters and Months"](w)||!!st["Halfwidth and Fullwidth Forms"](w)||!!st["Ideographic Description Characters"](w)||!!st["Vertical Forms"](w)||ph.test(String.fromCodePoint(w)));(I_[P]||L||T.imageName||C!==i.length()-2&&T_[i.getCharCode(C+1)])&&p.push(pm(C+1,x,m,p,E_(P,i.getCharCode(C+1),L&&g),!1))}}var w;return mm(pm(i.length(),x,m,p,0,!0))}function _u(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function A_(i,t,r,a,l){if(!a&&!l)return;let u=i[r],p=(i[r].x+u.metrics.advance*u.scale)*a;for(let m=t;m<=r;m++)i[m].x-=p,i[m].y+=l}function P_(i,t,r){let{horizontalAlign:a,verticalAlign:l}=_u(r),u=t[0]-i.displaySize[0]*a,p=t[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function fm(i){var t,r;let a=i.left,l=i.top,u=i.right-a,p=i.bottom-l,m=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",x=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(m==="stretchOnly"&&u/p<x||m==="proportional"){let w=Math.ceil(p*x);a*=w/u,u=w}}else if(m==="proportional"&&g==="stretchOnly"&&x!==0&&u/p>x){let w=Math.ceil(u/x);l*=w/p,p=w}return{x1:a,y1:l,x2:a+u,y2:l+p}}function gm(i,t,r,a,l,u){let p=i.image,m;if(p.content){let N=p.content,$=p.pixelRatio||1;m=[N[0]/$,N[1]/$,p.displaySize[0]-N[2]/$,p.displaySize[1]-N[3]/$]}let g=t.left*u,x=t.right*u,w,C,T,P;r==="width"||r==="both"?(P=l[0]+g-a[3],C=l[0]+x+a[1]):(P=l[0]+(g+x-p.displaySize[0])/2,C=P+p.displaySize[0]);let L=t.top*u,R=t.bottom*u;return r==="height"||r==="both"?(w=l[1]+L-a[0],T=l[1]+R+a[2]):(w=l[1]+(L+R-p.displaySize[1])/2,T=w+p.displaySize[1]),{image:p,top:w,right:C,bottom:T,left:P,collisionPadding:m}}let _c=255,kn=128,Ga=_c*kn;function _m(i,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new It(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=r,u=0;for(;u<a.length&&a[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<a.length&&a[p]<i+1;)p++;p=Math.min(a.length-1,p);let m=a[u],g=a[p];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new It(m)),maxSize:r.evaluate(new It(g)),interpolationType:l}}}function yu(i,t,r){let a="never",l=i.get(t);return l?a=l:i.get(r)&&(a="always"),a}let D_=$a.VectorTileFeature.types,z_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ph(i,t,r,a,l,u,p,m,g,x,w,C,T){let P=m?Math.min(Ga,Math.round(m[0])):0,L=m?Math.min(Ga,Math.round(m[1])):0;i.emplaceBack(t,r,Math.round(32*a),Math.round(32*l),u,p,(P<<1)+(g?1:0),L,16*x,16*w,256*C,256*T)}function vu(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function L_(i){for(let t of i.sections)if(Hd(t.text))return!0;return!1}class bu{constructor(t){this.layoutVertexArray=new Rs,this.indexArray=new kr,this.programConfigurations=t,this.segments=new lt,this.dynamicLayoutVertexArray=new nc,this.opacityVertexArray=new cr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Tt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,h_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,d_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,z_,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pe("SymbolBuffers",bu);class xu{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new lt,this.collisionVertexArray=new xn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,u_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pe("CollisionBuffers",xu);class Hs{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(p=>p.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=eu([]),this.placementViewportMatrix=eu([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_m(this.zoom,r["text-size"]),this.iconSizeData=_m(this.zoom,r["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),u=a.get("symbol-z-order");this.canOverlap=yu(a,"text-overlap","text-allow-overlap")!=="never"||yu(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(p=>y.ah[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=t.sourceID}createArrays(){this.text=new bu(new Lo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new bu(new Lo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Et,this.lineVertexArray=new hi,this.symbolInstances=new ot,this.textAnchorOffsets=new At}calculateGlyphDependencies(t,r,a,l,u){for(let p=0;p<t.length;p++)if(r[t.charCodeAt(p)]=!0,(a||l)&&u){let m=mc[t.charAt(p)];m&&(r[m.charCodeAt(0)]=!0)}}populate(t,r,a){let l=this.layers[0],u=l.layout,p=u.get("text-font"),m=u.get("text-field"),g=u.get("icon-image"),x=(m.value.kind!=="constant"||m.value.value instanceof Gi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,C=u.get("symbol-sort-key");if(this.features=[],!x&&!w)return;let T=r.iconDependencies,P=r.glyphDependencies,L=r.availableImages,R=new It(this.zoom);for(let{feature:N,id:$,index:re,sourceLayerIndex:X}of t){let te=l._featureFilter.needGeometry,se=Fo(N,te);if(!l._featureFilter.filter(R,se,a))continue;let fe,Te;if(te||(se.geometry=Ro(N)),x){let Me=l.getValueAndResolveTokens("text-field",se,a,L),Ce=Gi.factory(Me),Be=this.hasRTLText=this.hasRTLText||L_(Ce);(!Be||Ki.getRTLTextPluginStatus()==="unavailable"||Be&&Ki.isParsed())&&(fe=m_(Ce,l,se))}if(w){let Me=l.getValueAndResolveTokens("icon-image",se,a,L);Te=Me instanceof Wi?Me:Wi.fromString(Me)}if(!fe&&!Te)continue;let qe=this.sortFeaturesByKey?C.evaluate(se,{},a):void 0;if(this.features.push({id:$,text:fe,icon:Te,index:re,sourceLayerIndex:X,geometry:se.geometry,properties:N.properties,type:D_[N.type],sortKey:qe}),Te&&(T[Te.name]=!0),fe){let Me=p.evaluate(se,{},a).join(","),Ce=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(y.ah.vertical)>=0;for(let Be of fe.sections)if(Be.image)T[Be.image.name]=!0;else{let De=Ql(fe.toString()),Ae=Be.fontStack||Me,de=P[Ae]=P[Ae]||{};this.calculateGlyphDependencies(Be.text,de,Ce,this.allowVerticalPlacement,De)}}}u.get("symbol-placement")==="line"&&(this.features=function(N){let $={},re={},X=[],te=0;function se(Me){X.push(N[Me]),te++}function fe(Me,Ce,Be){let De=re[Me];return delete re[Me],re[Ce]=De,X[De].geometry[0].pop(),X[De].geometry[0]=X[De].geometry[0].concat(Be[0]),De}function Te(Me,Ce,Be){let De=$[Ce];return delete $[Ce],$[Me]=De,X[De].geometry[0].shift(),X[De].geometry[0]=Be[0].concat(X[De].geometry[0]),De}function qe(Me,Ce,Be){let De=Be?Ce[0][Ce[0].length-1]:Ce[0][0];return`${Me}:${De.x}:${De.y}`}for(let Me=0;Me<N.length;Me++){let Ce=N[Me],Be=Ce.geometry,De=Ce.text?Ce.text.toString():null;if(!De){se(Me);continue}let Ae=qe(De,Be),de=qe(De,Be,!0);if(Ae in re&&de in $&&re[Ae]!==$[de]){let Oe=Te(Ae,de,Be),Fe=fe(Ae,de,X[Oe].geometry);delete $[Ae],delete re[de],re[qe(De,X[Fe].geometry,!0)]=Fe,X[Oe].geometry=null}else Ae in re?fe(Ae,de,Be):de in $?Te(Ae,de,Be):(se(Me),$[Ae]=te-1,re[de]=te-1)}return X.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((N,$)=>N.sortKey-$.sortKey)}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let a=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),u=t.dist(r[t.segment]),p={};for(let m=t.segment+1;m<r.length;m++)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=t.segment||0;m>=0;m--)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:u},m>0&&(u+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){let g=p[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,l,u,p,m,g,x,w,C,T){let P=t.indexArray,L=t.layoutVertexArray,R=t.segments.prepareSegment(4*r.length,L,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,$=R.vertexLength,re=this.allowVerticalPlacement&&m===y.ah.vertical?Math.PI/2:0,X=p.text&&p.text.sections;for(let te=0;te<r.length;te++){let{tl:se,tr:fe,bl:Te,br:qe,tex:Me,pixelOffsetTL:Ce,pixelOffsetBR:Be,minFontScaleX:De,minFontScaleY:Ae,glyphOffset:de,isSDF:Oe,sectionIndex:Fe}=r[te],He=R.vertexLength,wt=de[1];Ph(L,g.x,g.y,se.x,wt+se.y,Me.x,Me.y,a,Oe,Ce.x,Ce.y,De,Ae),Ph(L,g.x,g.y,fe.x,wt+fe.y,Me.x+Me.w,Me.y,a,Oe,Be.x,Ce.y,De,Ae),Ph(L,g.x,g.y,Te.x,wt+Te.y,Me.x,Me.y+Me.h,a,Oe,Ce.x,Be.y,De,Ae),Ph(L,g.x,g.y,qe.x,wt+qe.y,Me.x+Me.w,Me.y+Me.h,a,Oe,Be.x,Be.y,De,Ae),vu(t.dynamicLayoutVertexArray,g,re),P.emplaceBack(He,He+1,He+2),P.emplaceBack(He+1,He+2,He+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(de[0]),te!==r.length-1&&Fe===r[te+1].sectionIndex||t.programConfigurations.populatePaintArrays(L.length,p,p.index,{},T,X&&X[Fe])}t.placedSymbolArray.emplaceBack(g.x,g.y,N,this.glyphOffsetArray.length-N,$,x,w,g.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],m,0,!1,0,C)}_addCollisionDebugVertex(t,r,a,l,u,p){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,l,u,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,r,a,l,u,p,m){let g=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),x=g.vertexLength,w=u.layoutVertexArray,C=u.collisionVertexArray,T=m.anchorX,P=m.anchorY;this._addCollisionDebugVertex(w,C,p,T,P,new ge(t,r)),this._addCollisionDebugVertex(w,C,p,T,P,new ge(a,r)),this._addCollisionDebugVertex(w,C,p,T,P,new ge(a,l)),this._addCollisionDebugVertex(w,C,p,T,P,new ge(t,l)),g.vertexLength+=4;let L=u.indexArray;L.emplaceBack(x,x+1),L.emplaceBack(x+1,x+2),L.emplaceBack(x+2,x+3),L.emplaceBack(x+3,x),g.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,l){for(let u=t;u<r;u++){let p=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xu(hr,em.members,ai),this.iconCollisionBox=new xu(hr,em.members,ai);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,l,u,p,m,g,x){let w={};for(let C=r;C<a;C++){let T=t.get(C);w.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.textFeatureIndex=T.featureIndex;break}for(let C=l;C<u;C++){let T=t.get(C);w.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.verticalTextFeatureIndex=T.featureIndex;break}for(let C=p;C<m;C++){let T=t.get(C);w.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.iconFeatureIndex=T.featureIndex;break}for(let C=g;C<x;C++){let T=t.get(C);w.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.verticalIconFeatureIndex=T.featureIndex;break}return w}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let a=t.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let u=a.vertexStartIndex;u<l;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),a=Math.cos(t),l=[],u=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);let g=this.symbolInstances.get(m);l.push(0|Math.round(r*g.anchorX+a*g.anchorY)),u.push(g.featureIndex)}return p.sort((m,g)=>l[m]-l[g]||u[g]-u[m]),p}addToSortKeyRanges(t,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ym,vm;Pe("SymbolBucket",Hs,{omit:["layers","collisionBoxArray","features","compareText"]}),Hs.MAX_GLYPHS=65535,Hs.addDynamicAttributes=vu;var wu={get paint(){return vm=vm||new d({"icon-opacity":new Ue(oe.paint_symbol["icon-opacity"]),"icon-color":new Ue(oe.paint_symbol["icon-color"]),"icon-halo-color":new Ue(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Le(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Le(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue(oe.paint_symbol["text-opacity"]),"text-color":new Ue(oe.paint_symbol["text-color"],{runtimeType:Pi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ue(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(oe.paint_symbol["text-halo-blur"]),"text-translate":new Le(oe.paint_symbol["text-translate"]),"text-translate-anchor":new Le(oe.paint_symbol["text-translate-anchor"])})},get layout(){return ym=ym||new d({"symbol-placement":new Le(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Le(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Le(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Le(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Le(oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Le(oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Le(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Le(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Le(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(oe.layout_symbol["icon-size"]),"icon-text-fit":new Le(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Le(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(oe.layout_symbol["icon-image"]),"icon-rotate":new Ue(oe.layout_symbol["icon-rotate"]),"icon-padding":new Ue(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Le(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(oe.layout_symbol["icon-offset"]),"icon-anchor":new Ue(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Le(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Le(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Le(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(oe.layout_symbol["text-field"]),"text-font":new Ue(oe.layout_symbol["text-font"]),"text-size":new Ue(oe.layout_symbol["text-size"]),"text-max-width":new Ue(oe.layout_symbol["text-max-width"]),"text-line-height":new Le(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(oe.layout_symbol["text-justify"]),"text-radial-offset":new Ue(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Le(oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ue(oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ue(oe.layout_symbol["text-anchor"]),"text-max-angle":new Le(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Le(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(oe.layout_symbol["text-rotate"]),"text-padding":new Le(oe.layout_symbol["text-padding"]),"text-keep-upright":new Le(oe.layout_symbol["text-keep-upright"]),"text-transform":new Ue(oe.layout_symbol["text-transform"]),"text-offset":new Ue(oe.layout_symbol["text-offset"]),"text-allow-overlap":new Le(oe.layout_symbol["text-allow-overlap"]),"text-overlap":new Le(oe.layout_symbol["text-overlap"]),"text-ignore-placement":new Le(oe.layout_symbol["text-ignore-placement"]),"text-optional":new Le(oe.layout_symbol["text-optional"])})}};class bm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:_n,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pe("FormatSectionOverride",bm,{omit:["defaultValue"]});class Dh extends n{constructor(t){super(t,wu)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let u of a)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,l){let u=this.layout.get(t).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||bs(p.value)||!u?u:function(m,g){return g.replace(/{([^{}]+)}/g,(x,w)=>m&&w in m?String(m[w]):"")}(r.properties,u)}createBucket(t){return new Hs(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of wu.paint.overridableProperties){if(!Dh.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),a=new bm(r),l=new vs(a,r.property.specification),u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Ta("source",l):new Ea("composite",l,r.value.zoomStops),this.paint._values[t]=new qr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Dh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let a=t.get("text-field"),l=wu.paint.properties[r],u=!1,p=m=>{for(let g of m)if(l.overrides&&l.overrides.hasOverride(g))return void(u=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Gi)p(a.value.value.sections);else if(a.value.kind==="source"){let m=x=>{u||(x instanceof _r&&Wt(x.value)===tn?p(x.value.sections):x instanceof hs?p(x.sections):x.eachChild(m))},g=a.value;g._styleExpression&&m(g._styleExpression.expression)}return u}}let xm;var R_={get paint(){return xm=xm||new d({"background-color":new Le(oe.paint_background["background-color"]),"background-pattern":new zs(oe.paint_background["background-pattern"]),"background-opacity":new Le(oe.paint_background["background-opacity"])})}};class F_ extends n{constructor(t){super(t,R_)}}let wm;var B_={get paint(){return wm=wm||new d({"raster-opacity":new Le(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Le(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Le(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Le(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Le(oe.paint_raster["raster-saturation"]),"raster-contrast":new Le(oe.paint_raster["raster-contrast"]),"raster-resampling":new Le(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Le(oe.paint_raster["raster-fade-duration"])})}};class O_ extends n{constructor(t){super(t,B_)}}class V_ extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class N_{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let ku=63710088e-1;class Ha{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ha(Dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,a=this.lat*r,l=t.lat*r,u=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return ku*Math.acos(Math.min(u,1))}static convert(t){if(t instanceof Ha)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ha(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ha(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let km=2*Math.PI*ku;function Cm(i){return km*Math.cos(i*Math.PI/180)}function Sm(i){return(180+i)/360}function Mm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Im(i,t){return i/Cm(t)}function Cu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class yc{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){let a=Ha.convert(t);return new yc(Sm(a.lng),Mm(a.lat),Im(r,a.lat))}toLngLat(){return new Ha(360*this.x-180,Cu(this.y))}toAltitude(){return this.z*Cm(Cu(this.y))}meterInMercatorCoordinateUnits(){return 1/km*(t=Cu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Tm(i,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Su{constructor(t,r,a){if(!function(l,u,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||u<0||u>=Math.pow(2,l))}(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=vc(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){let l=(p=this.y,m=this.z,g=Tm(256*(u=this.x),256*(p=Math.pow(2,m)-p-1),m),x=Tm(256*(u+1),256*(p+1),m),g[0]+","+g[1]+","+x[0]+","+x[1]);var u,p,m,g,x;let w=function(C,T,P){let L,R="";for(let N=C;N>0;N--)L=1<<N-1,R+=(T&L?1:0)+(P&L?2:0);return R}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new ge((t.x*r-this.x)*Xt,(t.y*r-this.y)*Xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Em{constructor(t,r){this.wrap=t,this.canonical=r,this.key=vc(t,r.z,r.z,r.x,r.y)}}class Sr{constructor(t,r,a,l,u){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Su(a,+l,+u),this.key=vc(r,t,a,l,u)}clone(){return new Sr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new Sr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?vc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):vc(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Sr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new Sr(r,this.wrap,r,a,l),new Sr(r,this.wrap,r,a+1,l),new Sr(r,this.wrap,r,a,l+1),new Sr(r,this.wrap,r,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Sr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Sr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Em(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new yc(t.x-this.wrap,t.y))}}function vc(i,t,r,a,l){(i*=2)<0&&(i=-1*i-1);let u=1<<r;return(u*u*i+u*l+a).toString(36)+r.toString(36)+t.toString(36)}Pe("CanonicalTileID",Su),Pe("OverscaledTileID",Sr,{omit:["posMatrix"]});class Am{constructor(t,r,a,l=1,u=1,p=1,m=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void li(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=u,this.blueFactor=p,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let x=0;x<g;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(g,x)]=this.data[this._idx(g-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,g)]=this.data[this._idx(x,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<g;x++)for(let w=0;w<g;w++){let C=this.get(x,w);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,r){let a=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Cr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,p=a*this.dim,m=a*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(a){case-1:p=m-1;break;case 1:m=p+1}let g=-r*this.dim,x=-a*this.dim;for(let w=p;w<m;w++)for(let C=l;C<u;C++)this.data[this._idx(C,w)]=t.data[this._idx(C+g,w+x)]}}Pe("DEMData",Am);class Pm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Dm{constructor(t,r,a,l,u){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=l,this.properties=t.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class zm{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new za(Xt,16,0),this.grid3D=new za(Xt,16,0),this.featureIndexArray=new wi,this.promoteId=r}insert(t,r,a,l,u,p){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,u);let g=p?this.grid3D:this.grid;for(let x=0;x<r.length;x++){let w=r[x],C=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){let P=w[T];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<Xt&&C[1]<Xt&&C[2]>=0&&C[3]>=0&&g.insert(m,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $a.VectorTile(new pu(this.rawTileData)).layers,this.sourceLayerCoder=new Pm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,l){this.loadVTLayers();let u=t.params||{},p=Xt/t.tileSize/t.scale,m=Ol(u.filter),g=t.queryGeometry,x=t.queryPadding*p,w=Rm(g),C=this.grid.query(w.minX-x,w.minY-x,w.maxX+x,w.maxY+x),T=Rm(t.cameraQueryGeometry),P=this.grid3D.query(T.minX-x,T.minY-x,T.maxX+x,T.maxY+x,(N,$,re,X)=>function(te,se,fe,Te,qe){for(let Ce of te)if(se<=Ce.x&&fe<=Ce.y&&Te>=Ce.x&&qe>=Ce.y)return!0;let Me=[new ge(se,fe),new ge(se,qe),new ge(Te,qe),new ge(Te,fe)];if(te.length>2){for(let Ce of Me)if(Ns(te,Ce))return!0}for(let Ce=0;Ce<te.length-1;Ce++)if(bg(te[Ce],te[Ce+1],Me))return!0;return!1}(t.cameraQueryGeometry,N-x,$-x,re+x,X+x));for(let N of P)C.push(N);C.sort(j_);let L={},R;for(let N=0;N<C.length;N++){let $=C[N];if($===R)continue;R=$;let re=this.featureIndexArray.get($),X=null;this.loadMatchingFeature(L,re.bucketIndex,re.sourceLayerIndex,re.featureIndex,m,u.layers,u.availableImages,r,a,l,(te,se,fe)=>(X||(X=Ro(te)),se.queryIntersectsFeature(g,te,fe,X,this.z,t.transform,p,t.pixelPosMatrix)))}return L}loadMatchingFeature(t,r,a,l,u,p,m,g,x,w,C){let T=this.bucketLayerIDs[r];if(p&&!function(N,$){for(let re=0;re<N.length;re++)if($.indexOf(N[re])>=0)return!0;return!1}(p,T))return;let P=this.sourceLayerCoder.decode(a),L=this.vtLayers[P].feature(l);if(u.needGeometry){let N=Fo(L,!0);if(!u.filter(new It(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!u.filter(new It(this.tileID.overscaledZ),L))return;let R=this.getId(L,P);for(let N=0;N<T.length;N++){let $=T[N];if(p&&p.indexOf($)<0)continue;let re=g[$];if(!re)continue;let X={};R&&w&&(X=w.getState(re.sourceLayer||"_geojsonTileLayer",R));let te=ir({},x[$]);te.paint=Lm(te.paint,re.paint,L,X,m),te.layout=Lm(te.layout,re.layout,L,X,m);let se=!C||C(L,re,X);if(!se)continue;let fe=new Dm(L,this.z,this.x,this.y,R);fe.layer=te;let Te=t[$];Te===void 0&&(Te=t[$]=[]),Te.push({featureIndex:l,feature:fe,intersectionZ:se})}}lookupSymbolFeatures(t,r,a,l,u,p,m,g){let x={};this.loadVTLayers();let w=Ol(u);for(let C of t)this.loadMatchingFeature(x,a,l,C,w,p,m,g,r);return x}hasLayer(t){for(let r of this.bucketLayerIDs)for(let a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Lm(i,t,r,a,l){return zr(i,(u,p)=>{let m=t instanceof Po?t.get(p):null;return m&&m.evaluate?m.evaluate(r,a,l):m})}function Rm(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return{minX:t,minY:r,maxX:a,maxY:l}}function j_(i,t){return t-i}function Fm(i,t,r,a,l){let u=[];for(let p=0;p<i.length;p++){let m=i[p],g;for(let x=0;x<m.length-1;x++){let w=m[x],C=m[x+1];w.x<t&&C.x<t||(w.x<t?w=new ge(t,w.y+(t-w.x)/(C.x-w.x)*(C.y-w.y))._round():C.x<t&&(C=new ge(t,w.y+(t-w.x)/(C.x-w.x)*(C.y-w.y))._round()),w.y<r&&C.y<r||(w.y<r?w=new ge(w.x+(r-w.y)/(C.y-w.y)*(C.x-w.x),r)._round():C.y<r&&(C=new ge(w.x+(r-w.y)/(C.y-w.y)*(C.x-w.x),r)._round()),w.x>=a&&C.x>=a||(w.x>=a?w=new ge(a,w.y+(a-w.x)/(C.x-w.x)*(C.y-w.y))._round():C.x>=a&&(C=new ge(a,w.y+(a-w.x)/(C.x-w.x)*(C.y-w.y))._round()),w.y>=l&&C.y>=l||(w.y>=l?w=new ge(w.x+(l-w.y)/(C.y-w.y)*(C.x-w.x),l)._round():C.y>=l&&(C=new ge(w.x+(l-w.y)/(C.y-w.y)*(C.x-w.x),l)._round()),g&&w.equals(g[g.length-1])||(g=[w],u.push(g)),g.push(C)))))}}return u}Pe("FeatureIndex",zm,{omit:["rawTileData","sourceLayerCoder"]});class Wa extends ge{constructor(t,r,a,l){super(t,r),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new Wa(this.x,this.y,this.angle,this.segment)}}function Bm(i,t,r,a,l){if(t.segment===void 0||r===0)return!0;let u=t,p=t.segment+1,m=0;for(;m>-r/2;){if(p--,p<0)return!1;m-=i[p].dist(u),u=i[p]}m+=i[p].dist(i[p+1]),p++;let g=[],x=0;for(;m<r/2;){let w=i[p],C=i[p+1];if(!C)return!1;let T=i[p-1].angleTo(w)-w.angleTo(C);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:T}),x+=T;m-g[0].distance>a;)x-=g.shift().angleDelta;if(x>l)return!1;p++,m+=w.dist(C)}return!0}function Om(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Vm(i,t,r){return i?.6*t*r:0}function Nm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function q_(i,t,r,a,l,u){let p=Vm(r,l,u),m=Nm(r,a)*u,g=0,x=Om(i)/2;for(let w=0;w<i.length-1;w++){let C=i[w],T=i[w+1],P=C.dist(T);if(g+P>x){let L=(x-g)/P,R=Di.number(C.x,T.x,L),N=Di.number(C.y,T.y,L),$=new Wa(R,N,T.angleTo(C),w);return $._round(),!p||Bm(i,$,m,p,t)?$:void 0}g+=P}}function U_(i,t,r,a,l,u,p,m,g){let x=Vm(a,u,p),w=Nm(a,l),C=w*p,T=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return t-C<t/4&&(t=C+t/4),jm(i,T?t/2*m%t:(w/2+2*u)*p*m%t,t,x,r,C,T,!1,g)}function jm(i,t,r,a,l,u,p,m,g){let x=u/2,w=Om(i),C=0,T=t-r,P=[];for(let L=0;L<i.length-1;L++){let R=i[L],N=i[L+1],$=R.dist(N),re=N.angleTo(R);for(;T+r<C+$;){T+=r;let X=(T-C)/$,te=Di.number(R.x,N.x,X),se=Di.number(R.y,N.y,X);if(te>=0&&te<g&&se>=0&&se<g&&T-x>=0&&T+x<=w){let fe=new Wa(te,se,re,L);fe._round(),a&&!Bm(i,fe,u,a,l)||P.push(fe)}}C+=$}return m||P.length||p||(P=jm(i,C/2,r,a,l,u,p,!0,g)),P}Pe("Anchor",Wa);let Ws=Ji;function qm(i,t,r,a){let l=[],u=i.image,p=u.pixelRatio,m=u.paddedRect.w-2*Ws,g=u.paddedRect.h-2*Ws,x={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom},w=u.stretchX||[[0,m]],C=u.stretchY||[[0,g]],T=(de,Oe)=>de+Oe[1]-Oe[0],P=w.reduce(T,0),L=C.reduce(T,0),R=m-P,N=g-L,$=0,re=P,X=0,te=L,se=0,fe=R,Te=0,qe=N;if(u.content&&a){let de=u.content,Oe=de[2]-de[0],Fe=de[3]-de[1];(u.textFitWidth||u.textFitHeight)&&(x=fm(i)),$=zh(w,0,de[0]),X=zh(C,0,de[1]),re=zh(w,de[0],de[2]),te=zh(C,de[1],de[3]),se=de[0]-$,Te=de[1]-X,fe=Oe-re,qe=Fe-te}let Me=x.x1,Ce=x.y1,Be=x.x2-Me,De=x.y2-Ce,Ae=(de,Oe,Fe,He)=>{let wt=Lh(de.stretch-$,re,Be,Me),xt=Rh(de.fixed-se,fe,de.stretch,P),ti=Lh(Oe.stretch-X,te,De,Ce),$r=Rh(Oe.fixed-Te,qe,Oe.stretch,L),mi=Lh(Fe.stretch-$,re,Be,Me),ii=Rh(Fe.fixed-se,fe,Fe.stretch,P),Fi=Lh(He.stretch-X,te,De,Ce),Bi=Rh(He.fixed-Te,qe,He.stretch,L),Oi=new ge(wt,ti),Vt=new ge(mi,ti),ri=new ge(mi,Fi),Ci=new ge(wt,Fi),fi=new ge(xt/p,$r/p),Vi=new ge(ii/p,Bi/p),gi=t*Math.PI/180;if(gi){let ut=Math.sin(gi),St=Math.cos(gi),Pt=[St,-ut,ut,St];Oi._matMult(Pt),Vt._matMult(Pt),Ci._matMult(Pt),ri._matMult(Pt)}let Mr=de.stretch+de.fixed,Qi=Oe.stretch+Oe.fixed;return{tl:Oi,tr:Vt,bl:Ci,br:ri,tex:{x:u.paddedRect.x+Ws+Mr,y:u.paddedRect.y+Ws+Qi,w:Fe.stretch+Fe.fixed-Mr,h:He.stretch+He.fixed-Qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:Vi,minFontScaleX:fe/p/Be,minFontScaleY:qe/p/De,isSDF:r}};if(a&&(u.stretchX||u.stretchY)){let de=Um(w,R,P),Oe=Um(C,N,L);for(let Fe=0;Fe<de.length-1;Fe++){let He=de[Fe],wt=de[Fe+1];for(let xt=0;xt<Oe.length-1;xt++)l.push(Ae(He,Oe[xt],wt,Oe[xt+1]))}}else l.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return l}function zh(i,t,r){let a=0;for(let l of i)a+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return a}function Um(i,t,r){let a=[{fixed:-Ws,stretch:0}];for(let[l,u]of i){let p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return a.push({fixed:t+Ws,stretch:r}),a}function Lh(i,t,r,a){return i/t*r+a}function Rh(i,t,r,a){return i-t*r/a}class Fh{constructor(t,r,a,l,u,p,m,g,x,w){var C;if(this.boxStartIndex=t.length,x){let T=p.top,P=p.bottom,L=p.collisionPadding;L&&(T-=L[1],P+=L[3]);let R=P-T;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{let T=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?fm(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};T.y1=T.y1*m-g[0],T.y2=T.y2*m+g[2],T.x1=T.x1*m-g[3],T.x2=T.x2*m+g[1];let P=p.collisionPadding;if(P&&(T.x1-=P[0]*m,T.y1-=P[1]*m,T.x2+=P[2]*m,T.y2+=P[3]*m),w){let L=new ge(T.x1,T.y1),R=new ge(T.x2,T.y1),N=new ge(T.x1,T.y2),$=new ge(T.x2,T.y2),re=w*Math.PI/180;L._rotate(re),R._rotate(re),N._rotate(re),$._rotate(re),T.x1=Math.min(L.x,R.x,N.x,$.x),T.x2=Math.max(L.x,R.x,N.x,$.x),T.y1=Math.min(L.y,R.y,N.y,$.y),T.y2=Math.max(L.y,R.y,N.y,$.y)}t.emplaceBack(r.x,r.y,T.x1,T.y1,T.x2,T.y2,a,l,u)}this.boxEndIndex=t.length}}class $_{constructor(t=[],r=(a,l)=>a<l?-1:a>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:a}=this,l=r[t];for(;t>0;){let u=t-1>>1,p=r[u];if(a(l,p)>=0)break;r[t]=p,t=u}r[t]=l}_down(t){let{data:r,compare:a}=this,l=this.length>>1,u=r[t];for(;t<l;){let p=1+(t<<1),m=p+1;if(m<this.length&&a(r[m],r[p])<0&&(p=m),a(r[p],u)>=0)break;r[t]=r[p],t=p}r[t]=u}}function Z_(i,t=1,r=!1){let a=1/0,l=1/0,u=-1/0,p=-1/0,m=i[0];for(let P=0;P<m.length;P++){let L=m[P];(!P||L.x<a)&&(a=L.x),(!P||L.y<l)&&(l=L.y),(!P||L.x>u)&&(u=L.x),(!P||L.y>p)&&(p=L.y)}let g=Math.min(u-a,p-l),x=g/2,w=new $_([],G_);if(g===0)return new ge(a,l);for(let P=a;P<u;P+=g)for(let L=l;L<p;L+=g)w.push(new Xs(P+x,L+x,x,i));let C=function(P){let L=0,R=0,N=0,$=P[0];for(let re=0,X=$.length,te=X-1;re<X;te=re++){let se=$[re],fe=$[te],Te=se.x*fe.y-fe.x*se.y;R+=(se.x+fe.x)*Te,N+=(se.y+fe.y)*Te,L+=3*Te}return new Xs(R/L,N/L,0,P)}(i),T=w.length;for(;w.length;){let P=w.pop();(P.d>C.d||!C.d)&&(C=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,T)),P.max-C.d<=t||(x=P.h/2,w.push(new Xs(P.p.x-x,P.p.y-x,x,i)),w.push(new Xs(P.p.x+x,P.p.y-x,x,i)),w.push(new Xs(P.p.x-x,P.p.y+x,x,i)),w.push(new Xs(P.p.x+x,P.p.y+x,x,i)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${C.d}`)),C.p}function G_(i,t){return t.max-i.max}function Xs(i,t,r,a){this.p=new ge(i,t),this.h=r,this.d=function(l,u){let p=!1,m=1/0;for(let g=0;g<u.length;g++){let x=u[g];for(let w=0,C=x.length,T=C-1;w<C;T=w++){let P=x[w],L=x[T];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(p=!p),m=Math.min(m,Mp(l,P,L))}}return(p?1:-1)*Math.sqrt(m)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var pi;y.aq=void 0,(pi=y.aq||(y.aq={}))[pi.center=1]="center",pi[pi.left=2]="left",pi[pi.right=3]="right",pi[pi.top=4]="top",pi[pi.bottom=5]="bottom",pi[pi["top-left"]=6]="top-left",pi[pi["top-right"]=7]="top-right",pi[pi["bottom-left"]=8]="bottom-left",pi[pi["bottom-right"]=9]="bottom-right";let Xa=7,Mu=Number.POSITIVE_INFINITY;function $m(i,t){return t[1]!==Mu?function(r,a,l){let u=0,p=0;switch(a=Math.abs(a),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-Xa;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Xa}switch(r){case"top-right":case"bottom-right":case"right":u=-a;break;case"top-left":case"bottom-left":case"left":u=a}return[u,p]}(i,t[0],t[1]):function(r,a){let l=0,u=0;a<0&&(a=0);let p=a/Math.SQRT2;switch(r){case"top-right":case"top-left":u=p-Xa;break;case"bottom-right":case"bottom-left":u=-p+Xa;break;case"bottom":u=-a+Xa;break;case"top":u=a-Xa}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=a;break;case"right":l=-a}return[l,u]}(i,t[0])}function Zm(i,t,r){var a;let l=i.layout,u=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(u){let m=u.values,g=[];for(let x=0;x<m.length;x+=2){let w=g[x]=m[x],C=m[x+1].map(T=>T*Jt);w.startsWith("top")?C[1]-=Xa:w.startsWith("bottom")&&(C[1]+=Xa),g[x+1]=C}return new nr(g)}let p=l.get("text-variable-anchor");if(p){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Jt,Mu]:l.get("text-offset").evaluate(t,{},r).map(x=>x*Jt);let g=[];for(let x of p)g.push(x,$m(x,m));return new nr(g)}return null}function Iu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function H_(i,t,r,a,l,u,p,m,g,x,w){let C=u.textMaxSize.evaluate(t,{});C===void 0&&(C=p);let T=i.layers[0].layout,P=T.get("icon-offset").evaluate(t,{},w),L=Hm(r.horizontal),R=p/24,N=i.tilePixelRatio*R,$=i.tilePixelRatio*C/24,re=i.tilePixelRatio*m,X=i.tilePixelRatio*T.get("symbol-spacing"),te=T.get("text-padding")*i.tilePixelRatio,se=function(de,Oe,Fe,He=1){let wt=de.get("icon-padding").evaluate(Oe,{},Fe),xt=wt&&wt.values;return[xt[0]*He,xt[1]*He,xt[2]*He,xt[3]*He]}(T,t,w,i.tilePixelRatio),fe=T.get("text-max-angle")/180*Math.PI,Te=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",qe=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Me=T.get("symbol-placement"),Ce=X/2,Be=T.get("icon-text-fit"),De;a&&Be!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(De=gm(a,r.vertical,Be,T.get("icon-text-fit-padding"),P,R)),L&&(a=gm(a,L,Be,T.get("icon-text-fit-padding"),P,R)));let Ae=(de,Oe)=>{Oe.x<0||Oe.x>=Xt||Oe.y<0||Oe.y>=Xt||function(Fe,He,wt,xt,ti,$r,mi,ii,Fi,Bi,Oi,Vt,ri,Ci,fi,Vi,gi,Mr,Qi,ut,St,Pt,dr,Ft,Ks){let Cn=Fe.addToLineVertexArray(He,wt),Sn,Zr,Ir,oi,ea=0,wc=0,Ym=0,Jm=0,Ru=-1,Fu=-1,ta={},Qm=Fs("");if(Fe.allowVerticalPlacement&&xt.vertical){let Si=ii.layout.get("text-rotate").evaluate(St,{},Ft)+90;Ir=new Fh(Fi,He,Bi,Oi,Vt,xt.vertical,ri,Ci,fi,Si),mi&&(oi=new Fh(Fi,He,Bi,Oi,Vt,mi,gi,Mr,fi,Si))}if(ti){let Si=ii.layout.get("icon-rotate").evaluate(St,{}),Tr=ii.layout.get("icon-text-fit")!=="none",Oo=qm(ti,Si,dr,Tr),sn=mi?qm(mi,Si,dr,Tr):void 0;Zr=new Fh(Fi,He,Bi,Oi,Vt,ti,gi,Mr,!1,Si),ea=4*Oo.length;let Vo=Fe.iconSizeData,Mn=null;Vo.kind==="source"?(Mn=[kn*ii.layout.get("icon-size").evaluate(St,{})],Mn[0]>Ga&&li(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${_c}. Reduce your "icon-size".`)):Vo.kind==="composite"&&(Mn=[kn*Pt.compositeIconSizes[0].evaluate(St,{},Ft),kn*Pt.compositeIconSizes[1].evaluate(St,{},Ft)],(Mn[0]>Ga||Mn[1]>Ga)&&li(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${_c}. Reduce your "icon-size".`)),Fe.addSymbols(Fe.icon,Oo,Mn,ut,Qi,St,y.ah.none,He,Cn.lineStartIndex,Cn.lineLength,-1,Ft),Ru=Fe.icon.placedSymbolArray.length-1,sn&&(wc=4*sn.length,Fe.addSymbols(Fe.icon,sn,Mn,ut,Qi,St,y.ah.vertical,He,Cn.lineStartIndex,Cn.lineLength,-1,Ft),Fu=Fe.icon.placedSymbolArray.length-1)}let ef=Object.keys(xt.horizontal);for(let Si of ef){let Tr=xt.horizontal[Si];if(!Sn){Qm=Fs(Tr.text);let sn=ii.layout.get("text-rotate").evaluate(St,{},Ft);Sn=new Fh(Fi,He,Bi,Oi,Vt,Tr,ri,Ci,fi,sn)}let Oo=Tr.positionedLines.length===1;if(Ym+=Gm(Fe,He,Tr,$r,ii,fi,St,Vi,Cn,xt.vertical?y.ah.horizontal:y.ah.horizontalOnly,Oo?ef:[Si],ta,Ru,Pt,Ft),Oo)break}xt.vertical&&(Jm+=Gm(Fe,He,xt.vertical,$r,ii,fi,St,Vi,Cn,y.ah.vertical,["vertical"],ta,Fu,Pt,Ft));let K_=Sn?Sn.boxStartIndex:Fe.collisionBoxArray.length,Y_=Sn?Sn.boxEndIndex:Fe.collisionBoxArray.length,J_=Ir?Ir.boxStartIndex:Fe.collisionBoxArray.length,Q_=Ir?Ir.boxEndIndex:Fe.collisionBoxArray.length,e0=Zr?Zr.boxStartIndex:Fe.collisionBoxArray.length,t0=Zr?Zr.boxEndIndex:Fe.collisionBoxArray.length,i0=oi?oi.boxStartIndex:Fe.collisionBoxArray.length,r0=oi?oi.boxEndIndex:Fe.collisionBoxArray.length,on=-1,Oh=(Si,Tr)=>Si&&Si.circleDiameter?Math.max(Si.circleDiameter,Tr):Tr;on=Oh(Sn,on),on=Oh(Ir,on),on=Oh(Zr,on),on=Oh(oi,on);let tf=on>-1?1:0;tf&&(on*=Ks/Jt),Fe.glyphOffsetArray.length>=Hs.MAX_GLYPHS&&li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),St.sortKey!==void 0&&Fe.addToSortKeyRanges(Fe.symbolInstances.length,St.sortKey);let n0=Zm(ii,St,Ft),[a0,o0]=function(Si,Tr){let Oo=Si.length,sn=Tr?.values;if(sn?.length>0)for(let Vo=0;Vo<sn.length;Vo+=2){let Mn=sn[Vo+1];Si.emplaceBack(y.aq[sn[Vo]],Mn[0],Mn[1])}return[Oo,Si.length]}(Fe.textAnchorOffsets,n0);Fe.symbolInstances.emplaceBack(He.x,He.y,ta.right>=0?ta.right:-1,ta.center>=0?ta.center:-1,ta.left>=0?ta.left:-1,ta.vertical||-1,Ru,Fu,Qm,K_,Y_,J_,Q_,e0,t0,i0,r0,Bi,Ym,Jm,ea,wc,tf,0,ri,on,a0,o0)}(i,Oe,de,r,a,l,De,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,N,[te,te,te,te],Te,g,re,se,qe,P,t,u,x,w,p)};if(Me==="line")for(let de of Fm(t.geometry,0,0,Xt,Xt)){let Oe=U_(de,X,fe,r.vertical||L,a,24,$,i.overscaling,Xt);for(let Fe of Oe)L&&W_(i,L.text,Ce,Fe)||Ae(de,Fe)}else if(Me==="line-center"){for(let de of t.geometry)if(de.length>1){let Oe=q_(de,fe,r.vertical||L,a,24,$);Oe&&Ae(de,Oe)}}else if(t.type==="Polygon")for(let de of us(t.geometry,0)){let Oe=Z_(de,16);Ae(de[0],new Wa(Oe.x,Oe.y,0))}else if(t.type==="LineString")for(let de of t.geometry)Ae(de,new Wa(de[0].x,de[0].y,0));else if(t.type==="Point")for(let de of t.geometry)for(let Oe of de)Ae([Oe],new Wa(Oe.x,Oe.y,0))}function Gm(i,t,r,a,l,u,p,m,g,x,w,C,T,P,L){let R=function(re,X,te,se,fe,Te,qe,Me){let Ce=se.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Be=[];for(let De of X.positionedLines)for(let Ae of De.positionedGlyphs){if(!Ae.rect)continue;let de=Ae.rect||{},Oe=lm+1,Fe=!0,He=1,wt=0,xt=(fe||Me)&&Ae.vertical,ti=Ae.metrics.advance*Ae.scale/2;if(Me&&X.verticalizable&&(wt=De.lineOffset/2-(Ae.imageName?-(Jt-Ae.metrics.width*Ae.scale)/2:(Ae.scale-1)*Jt)),Ae.imageName){let ut=qe[Ae.imageName];Fe=ut.sdf,He=ut.pixelRatio,Oe=Ji/He}let $r=fe?[Ae.x+ti,Ae.y]:[0,0],mi=fe?[0,0]:[Ae.x+ti+te[0],Ae.y+te[1]-wt],ii=[0,0];xt&&(ii=mi,mi=[0,0]);let Fi=Ae.metrics.isDoubleResolution?2:1,Bi=(Ae.metrics.left-Oe)*Ae.scale-ti+mi[0],Oi=(-Ae.metrics.top-Oe)*Ae.scale+mi[1],Vt=Bi+de.w/Fi*Ae.scale/He,ri=Oi+de.h/Fi*Ae.scale/He,Ci=new ge(Bi,Oi),fi=new ge(Vt,Oi),Vi=new ge(Bi,ri),gi=new ge(Vt,ri);if(xt){let ut=new ge(-ti,ti-fc),St=-Math.PI/2,Pt=Jt/2-ti,dr=new ge(5-fc-Pt,-(Ae.imageName?Pt:0)),Ft=new ge(...ii);Ci._rotateAround(St,ut)._add(dr)._add(Ft),fi._rotateAround(St,ut)._add(dr)._add(Ft),Vi._rotateAround(St,ut)._add(dr)._add(Ft),gi._rotateAround(St,ut)._add(dr)._add(Ft)}if(Ce){let ut=Math.sin(Ce),St=Math.cos(Ce),Pt=[St,-ut,ut,St];Ci._matMult(Pt),fi._matMult(Pt),Vi._matMult(Pt),gi._matMult(Pt)}let Mr=new ge(0,0),Qi=new ge(0,0);Be.push({tl:Ci,tr:fi,bl:Vi,br:gi,tex:de,writingMode:X.writingMode,glyphOffset:$r,sectionIndex:Ae.sectionIndex,isSDF:Fe,pixelOffsetTL:Mr,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}return Be}(0,r,m,l,u,p,a,i.allowVerticalPlacement),N=i.textSizeData,$=null;N.kind==="source"?($=[kn*l.layout.get("text-size").evaluate(p,{})],$[0]>Ga&&li(`${i.layerIds[0]}: Value for "text-size" is >= ${_c}. Reduce your "text-size".`)):N.kind==="composite"&&($=[kn*P.compositeTextSizes[0].evaluate(p,{},L),kn*P.compositeTextSizes[1].evaluate(p,{},L)],($[0]>Ga||$[1]>Ga)&&li(`${i.layerIds[0]}: Value for "text-size" is >= ${_c}. Reduce your "text-size".`)),i.addSymbols(i.text,R,$,m,u,p,x,t,g.lineStartIndex,g.lineLength,T,L);for(let re of w)C[re]=i.text.placedSymbolArray.length-1;return 4*R.length}function Hm(i){for(let t in i)return i[t];return null}function W_(i,t,r,a){let l=i.compareText;if(t in l){let u=l[t];for(let p=u.length-1;p>=0;p--)if(a.dist(u[p])<r)return!0}else l[t]=[];return l[t].push(a),!1}let Wm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let u=Wm[15&a];if(!u)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(t,2,1),[m]=new Uint32Array(t,4,1);return new Tu(m,p,u,t)}constructor(t,r=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let u=Wm.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,m=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-m%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Eu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:p,nodeSize:m}=this,g=[0,u.length-1,0],x=[];for(;g.length;){let w=g.pop()||0,C=g.pop()||0,T=g.pop()||0;if(C-T<=m){for(let N=T;N<=C;N++){let $=p[2*N],re=p[2*N+1];$>=t&&$<=a&&re>=r&&re<=l&&x.push(u[N])}continue}let P=T+C>>1,L=p[2*P],R=p[2*P+1];L>=t&&L<=a&&R>=r&&R<=l&&x.push(u[P]),(w===0?t<=L:r<=R)&&(g.push(T),g.push(P-1),g.push(1-w)),(w===0?a>=L:l>=R)&&(g.push(P+1),g.push(C),g.push(1-w))}return x}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:p}=this,m=[0,l.length-1,0],g=[],x=a*a;for(;m.length;){let w=m.pop()||0,C=m.pop()||0,T=m.pop()||0;if(C-T<=p){for(let N=T;N<=C;N++)Km(u[2*N],u[2*N+1],t,r)<=x&&g.push(l[N]);continue}let P=T+C>>1,L=u[2*P],R=u[2*P+1];Km(L,R,t,r)<=x&&g.push(l[P]),(w===0?t-a<=L:r-a<=R)&&(m.push(T),m.push(P-1),m.push(1-w)),(w===0?t+a>=L:r+a>=R)&&(m.push(P+1),m.push(C),m.push(1-w))}return g}}function Eu(i,t,r,a,l,u){if(l-a<=r)return;let p=a+l>>1;Xm(i,t,p,a,l,u),Eu(i,t,r,a,p-1,1-u),Eu(i,t,r,p+1,l,1-u)}function Xm(i,t,r,a,l,u){for(;l>a;){if(l-a>600){let x=l-a+1,w=r-a+1,C=Math.log(x),T=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*T*(x-T)/x)*(w-x/2<0?-1:1);Xm(i,t,r,Math.max(a,Math.floor(r-w*T/x+P)),Math.min(l,Math.floor(r+(x-w)*T/x+P)),u)}let p=t[2*r+u],m=a,g=l;for(bc(i,t,a,r),t[2*l+u]>p&&bc(i,t,a,l);m<g;){for(bc(i,t,m,g),m++,g--;t[2*m+u]<p;)m++;for(;t[2*g+u]>p;)g--}t[2*a+u]===p?bc(i,t,a,g):(g++,bc(i,t,g,l)),g<=r&&(a=g+1),r<=g&&(l=g-1)}}function bc(i,t,r,a){Au(i,r,a),Au(t,2*r,2*a),Au(t,2*r+1,2*a+1)}function Au(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}function Km(i,t,r,a){let l=i-r,u=t-a;return l*l+u*u}var Pu;y.bg=void 0,(Pu=y.bg||(y.bg={})).create="create",Pu.load="load",Pu.fullLoad="fullLoad";let Bh=null,xc=[],Du=1e3/60,zu="loadTime",Lu="fullLoadTime",X_={mark(i){performance.mark(i)},frame(i){let t=i;Bh!=null&&xc.push(t-Bh),Bh=t},clearMetrics(){Bh=null,xc=[],performance.clearMeasures(zu),performance.clearMeasures(Lu);for(let i in y.bg)performance.clearMarks(y.bg[i])},getPerformanceMetrics(){performance.measure(zu,y.bg.create,y.bg.load),performance.measure(Lu,y.bg.create,y.bg.fullLoad);let i=performance.getEntriesByName(zu)[0].duration,t=performance.getEntriesByName(Lu)[0].duration,r=xc.length,a=1/(xc.reduce((u,p)=>u+p,0)/r/1e3),l=xc.filter(u=>u>Du).reduce((u,p)=>u+(p-Du)/Du,0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};y.$=class extends M{},y.A=js,y.B=qd,y.C=function(i){if(da==null){let t=i.navigator?i.navigator.userAgent:null;da=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return da},y.D=Le,y.E=ma,y.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new N_(()=>this.process()),this.subscription=function(r,a,l,u){return r.addEventListener(a,l,!1),{unsubscribe:()=>{r.removeEventListener(a,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Yr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,a)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];let m={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(m)},{once:!0});let u=[],p=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:La(i.data,u)});this.target.postMessage(p,{transfer:u})})}receive(i){let t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(Yr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(Ra(t.error)):l.resolve(Ra(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=Ra(t.data),a=new AbortController;this.abortControllers[i]=a;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){let a=[];delete this.abortControllers[i];let l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?La(t):null,data:La(r,a)};this.target.postMessage(l,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},y.G=pa,y.H=function(){var i=new js(16);return js!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},y.I=fu,y.J=function(i,t,r){var a,l,u,p,m,g,x,w,C,T,P,L,R=r[0],N=r[1],$=r[2];return t===i?(i[12]=t[0]*R+t[4]*N+t[8]*$+t[12],i[13]=t[1]*R+t[5]*N+t[9]*$+t[13],i[14]=t[2]*R+t[6]*N+t[10]*$+t[14],i[15]=t[3]*R+t[7]*N+t[11]*$+t[15]):(l=t[1],u=t[2],p=t[3],m=t[4],g=t[5],x=t[6],w=t[7],C=t[8],T=t[9],P=t[10],L=t[11],i[0]=a=t[0],i[1]=l,i[2]=u,i[3]=p,i[4]=m,i[5]=g,i[6]=x,i[7]=w,i[8]=C,i[9]=T,i[10]=P,i[11]=L,i[12]=a*R+m*N+C*$+t[12],i[13]=l*R+g*N+T*$+t[13],i[14]=u*R+x*N+P*$+t[14],i[15]=p*R+w*N+L*$+t[15]),i},y.K=function(i,t,r){var a=r[0],l=r[1],u=r[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*u,i[9]=t[9]*u,i[10]=t[10]*u,i[11]=t[11]*u,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},y.L=Ap,y.M=function(i,t){let r={};for(let a=0;a<t.length;a++){let l=t[a];l in i&&(r[l]=i[l])}return r},y.N=Ha,y.O=Sm,y.P=ge,y.Q=Mm,y.R=Cr,y.S=Sr,y.T=Ps,y.U=Kr,y.V=oo,y.W=Rn,y.X=Xt,y.Y=f,y.Z=yc,y._=c,y.a=pn,y.a$=function(i,t){var r=i[0],a=i[1],l=i[2],u=i[3],p=i[4],m=i[5],g=i[6],x=i[7],w=i[8],C=i[9],T=i[10],P=i[11],L=i[12],R=i[13],N=i[14],$=i[15],re=t[0],X=t[1],te=t[2],se=t[3],fe=t[4],Te=t[5],qe=t[6],Me=t[7],Ce=t[8],Be=t[9],De=t[10],Ae=t[11],de=t[12],Oe=t[13],Fe=t[14],He=t[15];return Math.abs(r-re)<=Ri*Math.max(1,Math.abs(r),Math.abs(re))&&Math.abs(a-X)<=Ri*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(l-te)<=Ri*Math.max(1,Math.abs(l),Math.abs(te))&&Math.abs(u-se)<=Ri*Math.max(1,Math.abs(u),Math.abs(se))&&Math.abs(p-fe)<=Ri*Math.max(1,Math.abs(p),Math.abs(fe))&&Math.abs(m-Te)<=Ri*Math.max(1,Math.abs(m),Math.abs(Te))&&Math.abs(g-qe)<=Ri*Math.max(1,Math.abs(g),Math.abs(qe))&&Math.abs(x-Me)<=Ri*Math.max(1,Math.abs(x),Math.abs(Me))&&Math.abs(w-Ce)<=Ri*Math.max(1,Math.abs(w),Math.abs(Ce))&&Math.abs(C-Be)<=Ri*Math.max(1,Math.abs(C),Math.abs(Be))&&Math.abs(T-De)<=Ri*Math.max(1,Math.abs(T),Math.abs(De))&&Math.abs(P-Ae)<=Ri*Math.max(1,Math.abs(P),Math.abs(Ae))&&Math.abs(L-de)<=Ri*Math.max(1,Math.abs(L),Math.abs(de))&&Math.abs(R-Oe)<=Ri*Math.max(1,Math.abs(R),Math.abs(Oe))&&Math.abs(N-Fe)<=Ri*Math.max(1,Math.abs(N),Math.abs(Fe))&&Math.abs($-He)<=Ri*Math.max(1,Math.abs($),Math.abs(He))},y.a0=lt,y.a1=Su,y.a2=ye,y.a3=i=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(let a of i){let l=window.document.createElement("source");Bn(a)||(t.crossOrigin="Anonymous"),l.src=a,t.appendChild(l)}})},y.a4=function(){return es++},y.a5=Ie,y.a6=Hs,y.a7=Ol,y.a8=Fo,y.a9=Dm,y.aA=function(i){if(i.type==="custom")return new V_(i);switch(i.type){case"background":return new F_(i);case"circle":return new kg(i);case"fill":return new Ng(i);case"fill-extrusion":return new t_(i);case"heatmap":return new Sg(i);case"hillshade":return new Ig(i);case"line":return new c_(i);case"raster":return new O_(i);case"symbol":return new Dh(i)}},y.aB=yt,y.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!pt(i.version,t.version))return[{command:"setStyle",args:[t]}];pt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),pt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),pt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),pt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),pt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),pt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),pt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),pt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),pt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),pt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),pt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let a={},l=[];(function(p,m,g,x){let w;for(w in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,w)&&(Object.prototype.hasOwnProperty.call(m,w)||gn(w,g,x));for(w in m)Object.prototype.hasOwnProperty.call(m,w)&&(Object.prototype.hasOwnProperty.call(p,w)?pt(p[w],m[w])||(p[w].type==="geojson"&&m[w].type==="geojson"&&fa(p,m,w)?Lt(g,{command:"setGeoJSONSourceData",args:[w,m[w].data]}):en(w,m,g,x)):ho(w,m,g))})(i.sources,t.sources,l,a);let u=[];i.layers&&i.layers.forEach(p=>{"source"in p&&a[p.source]?r.push({command:"removeLayer",args:[p.id]}):u.push(p)}),r=r.concat(l),function(p,m,g){m=m||[];let x=(p=p||[]).map(uo),w=m.map(uo),C=p.reduce(po,{}),T=m.reduce(po,{}),P=x.slice(),L=Object.create(null),R,N,$,re,X;for(let te=0,se=0;te<x.length;te++)R=x[te],Object.prototype.hasOwnProperty.call(T,R)?se++:(Lt(g,{command:"removeLayer",args:[R]}),P.splice(P.indexOf(R,se),1));for(let te=0,se=0;te<w.length;te++)R=w[w.length-1-te],P[P.length-1-te]!==R&&(Object.prototype.hasOwnProperty.call(C,R)?(Lt(g,{command:"removeLayer",args:[R]}),P.splice(P.lastIndexOf(R,P.length-se),1)):se++,re=P[P.length-te],Lt(g,{command:"addLayer",args:[T[R],re]}),P.splice(P.length-te,0,R),L[R]=!0);for(let te=0;te<w.length;te++)if(R=w[te],N=C[R],$=T[R],!L[R]&&!pt(N,$))if(pt(N.source,$.source)&&pt(N["source-layer"],$["source-layer"])&&pt(N.type,$.type)){for(X in rr(N.layout,$.layout,g,R,null,"setLayoutProperty"),rr(N.paint,$.paint,g,R,null,"setPaintProperty"),pt(N.filter,$.filter)||Lt(g,{command:"setFilter",args:[R,$.filter]}),pt(N.minzoom,$.minzoom)&&pt(N.maxzoom,$.maxzoom)||Lt(g,{command:"setLayerZoomRange",args:[R,$.minzoom,$.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?rr(N[X],$[X],g,R,X.slice(6),"setPaintProperty"):pt(N[X],$[X])||Lt(g,{command:"setLayerProperty",args:[R,X,$[X]]}));for(X in $)Object.prototype.hasOwnProperty.call($,X)&&!Object.prototype.hasOwnProperty.call(N,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?rr(N[X],$[X],g,R,X.slice(6),"setPaintProperty"):pt(N[X],$[X])||Lt(g,{command:"setLayerProperty",args:[R,X,$[X]]}))}else Lt(g,{command:"removeLayer",args:[R]}),re=P[P.lastIndexOf(R)+1],Lt(g,{command:"addLayer",args:[$,re]})}(u,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},y.aD=function(i){let t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},y.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let a in t)if(!i(t[a],r[a]))return!1;return!0}return t===r},y.aF=zr,y.aG=so,y.aH=class extends zo{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},y.aI=vh,y.aJ=class extends zo{constructor(i,t){super(i,t),this.current=fg}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},y.aK=vp,y.aL=bp,y.aM=_t,y.aN=class extends zo{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},y.aO=class extends zo{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},y.aP=function(i,t,r,a,l,u,p){var m=1/(t-r),g=1/(a-l),x=1/(u-p);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(t+r)*m,i[13]=(l+a)*g,i[14]=(p+u)*x,i[15]=1,i},y.aQ=wg,y.aR=class extends J{},y.aS=p_,y.aT=class extends ne{},y.aU=ru,y.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},y.aW=Rp,y.aX=di,y.aY=kr,y.aZ=class extends Re{},y.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},y.aa=function(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,u)=>{let p=l||u;return t[a]=!p||p.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},y.ab=function(i,t){let r=[];for(let a in i)a in t||r.push(a);return r},y.ac=pr,y.ad=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[0],p=t[1],m=t[2],g=t[3],x=t[4],w=t[5],C=t[6],T=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=u*l+x*a,i[1]=p*l+w*a,i[2]=m*l+C*a,i[3]=g*l+T*a,i[4]=x*l-u*a,i[5]=w*l-p*a,i[6]=C*l-m*a,i[7]=T*l-g*a,i},y.ae=function(i){var t=new js(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},y.af=kh,y.ag=function(i,t){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:l,minZoom:u,maxZoom:p}=i,m=l?pr(zi.interpolationFactor(l,t,u,p),0,1):0;i.kind==="camera"?a=Di.number(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:a}},y.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:l}){return i.kind==="source"?a/kn:i.kind==="composite"?Di.number(a/kn,l/kn,r):t},y.aj=vu,y.ak=function(i,t,r,a){let l=t.y-i.y,u=t.x-i.x,p=a.y-r.y,m=a.x-r.x,g=p*u-m*l;if(g===0)return null;let x=(m*(i.y-r.y)-p*(i.x-r.x))/g;return new ge(i.x+x*u,i.y+x*l)},y.al=Fm,y.am=Cp,y.an=eu,y.ao=function(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return[t,r,a,l]},y.ap=Jt,y.ar=yu,y.as=function(i,t){var r=t[0],a=t[1],l=t[2],u=t[3],p=t[4],m=t[5],g=t[6],x=t[7],w=t[8],C=t[9],T=t[10],P=t[11],L=t[12],R=t[13],N=t[14],$=t[15],re=r*m-a*p,X=r*g-l*p,te=r*x-u*p,se=a*g-l*m,fe=a*x-u*m,Te=l*x-u*g,qe=w*R-C*L,Me=w*N-T*L,Ce=w*$-P*L,Be=C*N-T*R,De=C*$-P*R,Ae=T*$-P*N,de=re*Ae-X*De+te*Be+se*Ce-fe*Me+Te*qe;return de?(i[0]=(m*Ae-g*De+x*Be)*(de=1/de),i[1]=(l*De-a*Ae-u*Be)*de,i[2]=(R*Te-N*fe+$*se)*de,i[3]=(T*fe-C*Te-P*se)*de,i[4]=(g*Ce-p*Ae-x*Me)*de,i[5]=(r*Ae-l*Ce+u*Me)*de,i[6]=(N*te-L*Te-$*X)*de,i[7]=(w*Te-T*te+P*X)*de,i[8]=(p*De-m*Ce+x*qe)*de,i[9]=(a*Ce-r*De-u*qe)*de,i[10]=(L*fe-R*te+$*re)*de,i[11]=(C*te-w*fe-P*re)*de,i[12]=(m*Me-p*Be-g*qe)*de,i[13]=(r*Be-a*Me+l*qe)*de,i[14]=(R*X-L*se-N*re)*de,i[15]=(w*se-C*X+T*re)*de,i):null},y.at=Iu,y.au=_u,y.av=Tu,y.aw=function(){let i={},t=oe.$version;for(let r in oe.$root){let a=oe.$root[r];if(a.required){let l=null;l=r==="version"?t:a.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},y.ax=Jl,y.ay=fr,y.az=function(i){i=i.slice();let t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=co(i[r],t[i[r].ref]));return i},y.b=Lr,y.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},y.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},y.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},y.b3=Dr,y.b4=Em,y.b5=Im,y.b6=function(i,t,r,a,l){var u,p=1/Math.tan(t/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+a)*(u=1/(a-l)),i[14]=2*l*a*u):(i[10]=-1,i[14]=-2*a),i},y.b7=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[4],p=t[5],m=t[6],g=t[7],x=t[8],w=t[9],C=t[10],T=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=u*l+x*a,i[5]=p*l+w*a,i[6]=m*l+C*a,i[7]=g*l+T*a,i[8]=x*l-u*a,i[9]=w*l-p*a,i[10]=C*l-m*a,i[11]=T*l-g*a,i},y.b8=$i,y.b9=ml,y.bA=tm,y.bB=function(i){return i.message===mr},y.bC=Ia,y.bD=Ki,y.ba=function(i){return i*Math.PI/180},y.bb=function(i,t){let{x:r,y:a}=yc.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||r<0||r>=1)},y.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},y.bd=class extends k{},y.be=ku,y.bf=X_,y.bh=Zi,y.bi=function(i,t){pn.REGISTERED_PROTOCOLS[i]=t},y.bj=function(i){delete pn.REGISTERED_PROTOCOLS[i]},y.bk=function(i,t){let r={};for(let l=0;l<i.length;l++){let u=t&&t[i[l].id]||sh(i[l]);t&&(t[i[l].id]=u);let p=r[u];p||(p=r[u]=[]),p.push(i[l])}let a=[];for(let l in r)a.push(r[l]);return a},y.bl=Pe,y.bm=Pm,y.bn=zm,y.bo=hm,y.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Xt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;let t=i.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new It(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new It(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new It(18))};if(i.bucket.textSizeData.kind==="composite"){let{minZoom:x,maxZoom:w}=i.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new It(x),i.canonical),a["text-size"].possiblyEvaluate(new It(w),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){let{minZoom:x,maxZoom:w}=i.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new It(x),i.canonical),a["icon-size"].possiblyEvaluate(new It(w),i.canonical)]}let u=r.get("text-line-height")*Jt,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),g=r.get("text-size");for(let x of i.bucket.features){let w=r.get("text-font").evaluate(x,{},i.canonical).join(","),C=g.evaluate(x,{},i.canonical),T=l.layoutTextSize.evaluate(x,{},i.canonical),P=l.layoutIconSize.evaluate(x,{},i.canonical),L={horizontal:{},vertical:void 0},R=x.text,N,$=[0,0];if(R){let te=R.toString(),se=r.get("text-letter-spacing").evaluate(x,{},i.canonical)*Jt,fe=Ud(te)?se:0,Te=r.get("text-anchor").evaluate(x,{},i.canonical),qe=Zm(t,x,i.canonical);if(!qe){let De=r.get("text-radial-offset").evaluate(x,{},i.canonical);$=De?$m(Te,[De*Jt,Mu]):r.get("text-offset").evaluate(x,{},i.canonical).map(Ae=>Ae*Jt)}let Me=p?"center":r.get("text-justify").evaluate(x,{},i.canonical),Ce=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(x,{},i.canonical)*Jt:1/0,Be=()=>{i.bucket.allowVerticalPlacement&&Ql(te)&&(L.vertical=Eh(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,"left",fe,$,y.ah.vertical,!0,T,C))};if(!p&&qe){let De=new Set;if(Me==="auto")for(let de=0;de<qe.values.length;de+=2)De.add(Iu(qe.values[de]));else De.add(Me);let Ae=!1;for(let de of De)if(!L.horizontal[de])if(Ae)L.horizontal[de]=L.horizontal[0];else{let Oe=Eh(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,"center",de,fe,$,y.ah.horizontal,!1,T,C);Oe&&(L.horizontal[de]=Oe,Ae=Oe.positionedLines.length===1)}Be()}else{Me==="auto"&&(Me=Iu(Te));let De=Eh(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,Me,fe,$,y.ah.horizontal,!1,T,C);De&&(L.horizontal[Me]=De),Be(),Ql(te)&&p&&m&&(L.vertical=Eh(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,Me,fe,$,y.ah.vertical,!1,T,C))}}let re=!1;if(x.icon&&x.icon.name){let te=i.imageMap[x.icon.name];te&&(N=P_(i.imagePositions[x.icon.name],r.get("icon-offset").evaluate(x,{},i.canonical),r.get("icon-anchor").evaluate(x,{},i.canonical)),re=!!te.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=re:i.bucket.sdfIcons!==re&&li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}let X=Hm(L.horizontal)||L.vertical;i.bucket.iconsInText=!!X&&X.iconsInText,(X||N)&&H_(i.bucket,x,L,N,i.imageMap,l,T,P,$,re,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},y.bq=du,y.br=lu,y.bs=hu,y.bt=$a,y.bu=pu,y.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},y.bw=function(i,t,r,a,l){return c(this,void 0,void 0,function*(){if(oo())try{return yield Rn(i,t,r,a,l)}catch{}return function(u,p,m,g,x){let w=u.width,C=u.height;Jr&&Ai||(Jr=new OffscreenCanvas(w,C),Ai=Jr.getContext("2d",{willReadFrequently:!0})),Jr.width=w,Jr.height=C,Ai.drawImage(u,0,0,w,C);let T=Ai.getImageData(p,m,g,x);return Ai.clearRect(0,0,w,C),T.data}(i,t,r,a,l)})},y.bx=Am,y.by=he,y.bz=ze,y.c=ua,y.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),y.e=ir,y.f=i=>new Promise((t,r)=>{let a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=is})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(l):is}),y.g=Rr,y.h=(i,t)=>Fn(ir(i,{type:"json"}),t),y.i=Yr,y.j=fn,y.k=mn,y.l=(i,t)=>Fn(ir(i,{type:"arrayBuffer"}),t),y.m=Fn,y.n=function(i){return new pu(i).readFields(C_,[])},y.o=lc,y.p=cm,y.q=d,y.r=jd,y.s=Bn,y.t=Kl,y.u=Kn,y.v=oe,y.w=li,y.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},y.y=Di,y.z=It}),v("worker",["./shared"],function(y){"use strict";class c{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,E){for(let j of A){this._layerConfigs[j.id]=j;let K=this._layers[j.id]=y.aA(j);K._featureFilter=y.a7(K.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(let j of E)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};let B=y.bk(Object.values(this._layerConfigs),this.keyCache);for(let j of B){let K=j.map(ae=>this._layers[ae.id]),Q=K[0];if(Q.visibility==="none")continue;let ie=Q.source||"",H=this.familiesBySource[ie];H||(H=this.familiesBySource[ie]={});let ce=Q.sourceLayer||"_geojsonTileLayer",pe=H[ce];pe||(pe=H[ce]=[]),pe.push(K)}}}class he{constructor(A){let E={},B=[];for(let ie in A){let H=A[ie],ce=E[ie]={};for(let pe in H){let ae=H[+pe];if(!ae||ae.bitmap.width===0||ae.bitmap.height===0)continue;let ve={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};B.push(ve),ce[pe]={rect:ve,metrics:ae.metrics}}}let{w:j,h:K}=y.p(B),Q=new y.o({width:j||1,height:K||1});for(let ie in A){let H=A[ie];for(let ce in H){let pe=H[+ce];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;let ae=E[ie][ce].rect;y.o.copy(pe.bitmap,Q,{x:0,y:0},{x:ae.x+1,y:ae.y+1},pe.bitmap)}}this.image=Q,this.positions=E}}y.bl("GlyphAtlas",he);class ze{constructor(A){this.tileID=new y.S(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId,this.inFlightDependencies=[]}parse(A,E,B,j){return y._(this,void 0,void 0,function*(){this.status="parsing",this.data=A,this.collisionBoxArray=new y.a5;let K=new y.bm(Object.keys(A.layers).sort()),Q=new y.bn(this.tileID,this.promoteId);Q.bucketLayerIDs=[];let ie={},H={featureIndex:Q,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:B},ce=E.familiesBySource[this.source];for(let tt in ce){let gt=A.layers[tt];if(!gt)continue;gt.version===1&&y.w(`Vector tile source "${this.source}" layer "${tt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let zt=K.encode(tt),ei=[];for(let ni=0;ni<gt.length;ni++){let xi=gt.feature(ni),ga=Q.getId(xi,tt);ei.push({feature:xi,id:ga,index:ni,sourceLayerIndex:zt})}for(let ni of ce[tt]){let xi=ni[0];xi.source!==this.source&&y.w(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.minzoom&&this.zoom<Math.floor(xi.minzoom)||xi.maxzoom&&this.zoom>=xi.maxzoom||xi.visibility!=="none"&&(Je(ni,this.zoom,B),(ie[xi.id]=xi.createBucket({index:Q.bucketLayerIDs.length,layers:ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source})).populate(ei,H,this.tileID.canonical),Q.bucketLayerIDs.push(ni.map(ga=>ga.id)))}}let pe=y.aF(H.glyphDependencies,tt=>Object.keys(tt).map(Number));this.inFlightDependencies.forEach(tt=>tt?.abort()),this.inFlightDependencies=[];let ae=Promise.resolve({});if(Object.keys(pe).length){let tt=new AbortController;this.inFlightDependencies.push(tt),ae=j.sendAsync({type:"GG",data:{stacks:pe,source:this.source,tileID:this.tileID,type:"glyphs"}},tt)}let ve=Object.keys(H.iconDependencies),Ve=Promise.resolve({});if(ve.length){let tt=new AbortController;this.inFlightDependencies.push(tt),Ve=j.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"icons"}},tt)}let je=Object.keys(H.patternDependencies),ct=Promise.resolve({});if(je.length){let tt=new AbortController;this.inFlightDependencies.push(tt),ct=j.sendAsync({type:"GI",data:{icons:je,source:this.source,tileID:this.tileID,type:"patterns"}},tt)}let[Ke,ht,at]=yield Promise.all([ae,Ve,ct]),Ht=new he(Ke),Rt=new y.bo(ht,at);for(let tt in ie){let gt=ie[tt];gt instanceof y.a6?(Je(gt.layers,this.zoom,B),y.bp({bucket:gt,glyphMap:Ke,glyphPositions:Ht.positions,imageMap:ht,imagePositions:Rt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):gt.hasPattern&&(gt instanceof y.bq||gt instanceof y.br||gt instanceof y.bs)&&(Je(gt.layers,this.zoom,B),gt.addFeatures(H,this.tileID.canonical,Rt.patternPositions))}return this.status="done",{buckets:Object.values(ie).filter(tt=>!tt.isEmpty()),featureIndex:Q,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ht.image,imageAtlas:Rt,glyphMap:this.returnDependencies?Ke:null,iconMap:this.returnDependencies?ht:null,glyphPositions:this.returnDependencies?Ht.positions:null}})}}function Je(U,A,E){let B=new y.z(A);for(let j of U)j.recalculate(B,E)}class ge{constructor(A,E,B){this.actor=A,this.layerIndex=E,this.availableImages=B,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(A,E){return y._(this,void 0,void 0,function*(){let B=yield y.l(A.request,E);try{return{vectorTile:new y.bt.VectorTile(new y.bu(B.data)),rawData:B.data,cacheControl:B.cacheControl,expires:B.expires}}catch(j){let K=new Uint8Array(B.data),Q=`Unable to parse the tile at ${A.request.url}, `;throw Q+=K[0]===31&&K[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${j.message}`,new Error(Q)}})}loadTile(A){return y._(this,void 0,void 0,function*(){let E=A.uid,B=!!(A&&A.request&&A.request.collectResourceTiming)&&new y.bv(A.request),j=new ze(A);this.loading[E]=j;let K=new AbortController;j.abort=K;try{let Q=yield this.loadVectorTile(A,K);if(delete this.loading[E],!Q)return null;let ie=Q.rawData,H={};Q.expires&&(H.expires=Q.expires),Q.cacheControl&&(H.cacheControl=Q.cacheControl);let ce={};if(B){let ae=B.finish();ae&&(ce.resourceTiming=JSON.parse(JSON.stringify(ae)))}j.vectorTile=Q.vectorTile;let pe=j.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[E]=j,this.fetching[E]={rawTileData:ie,cacheControl:H,resourceTiming:ce};try{let ae=yield pe;return y.e({rawTileData:ie.slice(0)},ae,H,ce)}finally{delete this.fetching[E]}}catch(Q){throw delete this.loading[E],j.status="done",this.loaded[E]=j,Q}})}reloadTile(A){return y._(this,void 0,void 0,function*(){let E=A.uid;if(!this.loaded||!this.loaded[E])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let B=this.loaded[E];if(B.showCollisionBoxes=A.showCollisionBoxes,B.status==="parsing"){let j=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor),K;if(this.fetching[E]){let{rawTileData:Q,cacheControl:ie,resourceTiming:H}=this.fetching[E];delete this.fetching[E],K=y.e({rawTileData:Q.slice(0)},j,ie,H)}else K=j;return K}if(B.status==="done"&&B.vectorTile)return B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(A){return y._(this,void 0,void 0,function*(){let E=this.loading,B=A.uid;E&&E[B]&&E[B].abort&&(E[B].abort.abort(),delete E[B])})}removeTile(A){return y._(this,void 0,void 0,function*(){this.loaded&&this.loaded[A.uid]&&delete this.loaded[A.uid]})}}class le{constructor(){this.loaded={}}loadTile(A){return y._(this,void 0,void 0,function*(){let{uid:E,encoding:B,rawImageData:j,redFactor:K,greenFactor:Q,blueFactor:ie,baseShift:H}=A,ce=j.width+2,pe=j.height+2,ae=y.b(j)?new y.R({width:ce,height:pe},yield y.bw(j,-1,-1,ce,pe)):j,ve=new y.bx(E,ae,B,K,Q,ie,H);return this.loaded=this.loaded||{},this.loaded[E]=ve,ve})}removeTile(A){let E=this.loaded,B=A.uid;E&&E[B]&&delete E[B]}}function ur(U,A){if(U.length!==0){Ei(U[0],A);for(var E=1;E<U.length;E++)Ei(U[E],!A)}}function Ei(U,A){for(var E=0,B=0,j=0,K=U.length,Q=K-1;j<K;Q=j++){var ie=(U[j][0]-U[Q][0])*(U[Q][1]+U[j][1]),H=E+ie;B+=Math.abs(E)>=Math.abs(ie)?E-H+ie:ie-H+E,E=H}E+B>=0!=!!A&&U.reverse()}var Ui=y.by(function U(A,E){var B,j=A&&A.type;if(j==="FeatureCollection")for(B=0;B<A.features.length;B++)U(A.features[B],E);else if(j==="GeometryCollection")for(B=0;B<A.geometries.length;B++)U(A.geometries[B],E);else if(j==="Feature")U(A.geometry,E);else if(j==="Polygon")ur(A.coordinates,E);else if(j==="MultiPolygon")for(B=0;B<A.coordinates.length;B++)ur(A.coordinates[B],E);return A});let un=y.bt.VectorTileFeature.prototype.toGeoJSON;var Kr={exports:{}},oo=y.bz,$i=y.bt.VectorTileFeature,ml=pr;function pr(U,A){this.options=A||{},this.features=U,this.length=U.length}function Dr(U,A){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=A||4096}pr.prototype.feature=function(U){return new Dr(this.features[U],this.options.extent)},Dr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var A=0;A<U.length;A++){for(var E=U[A],B=[],j=0;j<E.length;j++)B.push(new oo(E[j][0],E[j][1]));this.geometry.push(B)}return this.geometry},Dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,A=1/0,E=-1/0,B=1/0,j=-1/0,K=0;K<U.length;K++)for(var Q=U[K],ie=0;ie<Q.length;ie++){var H=Q[ie];A=Math.min(A,H.x),E=Math.max(E,H.x),B=Math.min(B,H.y),j=Math.max(j,H.y)}return[A,B,E,j]},Dr.prototype.toGeoJSON=$i.prototype.toGeoJSON;var ir=y.bA,es=ml;function zr(U){var A=new ir;return function(E,B){for(var j in E.layers)B.writeMessage(3,so,E.layers[j])}(U,A),A.finish()}function so(U,A){var E;A.writeVarintField(15,U.version||1),A.writeStringField(1,U.name||""),A.writeVarintField(5,U.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(E=0;E<U.length;E++)B.feature=U.feature(E),A.writeMessage(2,yt,B);var j=B.keys;for(E=0;E<j.length;E++)A.writeStringField(3,j[E]);var K=B.values;for(E=0;E<K.length;E++)A.writeMessage(4,da,K[E])}function yt(U,A){var E=U.feature;E.id!==void 0&&A.writeVarintField(1,E.id),A.writeMessage(2,ts,U),A.writeVarintField(3,E.type),A.writeMessage(4,Yr,E)}function ts(U,A){var E=U.feature,B=U.keys,j=U.values,K=U.keycache,Q=U.valuecache;for(var ie in E.properties){var H=E.properties[ie],ce=K[ie];if(H!==null){ce===void 0&&(B.push(ie),K[ie]=ce=B.length-1),A.writeVarint(ce);var pe=typeof H;pe!=="string"&&pe!=="boolean"&&pe!=="number"&&(H=JSON.stringify(H));var ae=pe+":"+H,ve=Q[ae];ve===void 0&&(j.push(H),Q[ae]=ve=j.length-1),A.writeVarint(ve)}}}function li(U,A){return(A<<3)+(7&U)}function vi(U){return U<<1^U>>31}function Yr(U,A){for(var E=U.loadGeometry(),B=U.type,j=0,K=0,Q=E.length,ie=0;ie<Q;ie++){var H=E[ie],ce=1;B===1&&(ce=H.length),A.writeVarint(li(1,ce));for(var pe=B===3?H.length-1:H.length,ae=0;ae<pe;ae++){ae===1&&B!==1&&A.writeVarint(li(2,pe-1));var ve=H[ae].x-j,Ve=H[ae].y-K;A.writeVarint(vi(ve)),A.writeVarint(vi(Ve)),j+=ve,K+=Ve}B===3&&A.writeVarint(li(7,1))}}function da(U,A){var E=typeof U;E==="string"?A.writeStringField(1,U):E==="boolean"?A.writeBooleanField(7,U):E==="number"&&(U%1!=0?A.writeDoubleField(3,U):U<0?A.writeSVarintField(6,U):A.writeVarintField(5,U))}Kr.exports=zr,Kr.exports.fromVectorTileJs=zr,Kr.exports.fromGeojsonVt=function(U,A){A=A||{};var E={};for(var B in U)E[B]=new es(U[B].features,A),E[B].name=B,E[B].version=A.version,E[B].extent=A.extent;return zr({layers:E})},Kr.exports.GeoJSONWrapper=es;var Lr=y.by(Kr.exports);let is={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:U=>U},Rn=Math.fround||(Jr=new Float32Array(1),U=>(Jr[0]=+U,Jr[0]));var Jr;let Ai=3,mr=5,ua=6;class pn{constructor(A){this.options=Object.assign(Object.create(is),A),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(A){let{log:E,minZoom:B,maxZoom:j}=this.options;E&&console.time("total time");let K=`prepare ${A.length} points`;E&&console.time(K),this.points=A;let Q=[];for(let H=0;H<A.length;H++){let ce=A[H];if(!ce.geometry)continue;let[pe,ae]=ce.geometry.coordinates,ve=Rn(Zi(pe)),Ve=Rn(fr(ae));Q.push(ve,Ve,1/0,H,-1,1),this.options.reduce&&Q.push(0)}let ie=this.trees[j+1]=this._createTree(Q);E&&console.timeEnd(K);for(let H=j;H>=B;H--){let ce=+Date.now();ie=this.trees[H]=this._createTree(this._cluster(ie,H)),E&&console.log("z%d: %d clusters in %dms",H,ie.numItems,+Date.now()-ce)}return E&&console.timeEnd("total time"),this}getClusters(A,E){let B=((A[0]+180)%360+360)%360-180,j=Math.max(-90,Math.min(90,A[1])),K=A[2]===180?180:((A[2]+180)%360+360)%360-180,Q=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)B=-180,K=180;else if(B>K){let ae=this.getClusters([B,j,180,Q],E),ve=this.getClusters([-180,j,K,Q],E);return ae.concat(ve)}let ie=this.trees[this._limitZoom(E)],H=ie.range(Zi(B),fr(Q),Zi(K),fr(j)),ce=ie.data,pe=[];for(let ae of H){let ve=this.stride*ae;pe.push(ce[ve+mr]>1?Rr(ce,ve,this.clusterProps):this.points[ce[ve+Ai]])}return pe}getChildren(A){let E=this._getOriginId(A),B=this._getOriginZoom(A),j="No cluster with the specified id.",K=this.trees[B];if(!K)throw new Error(j);let Q=K.data;if(E*this.stride>=Q.length)throw new Error(j);let ie=this.options.radius/(this.options.extent*Math.pow(2,B-1)),H=K.within(Q[E*this.stride],Q[E*this.stride+1],ie),ce=[];for(let pe of H){let ae=pe*this.stride;Q[ae+4]===A&&ce.push(Q[ae+mr]>1?Rr(Q,ae,this.clusterProps):this.points[Q[ae+Ai]])}if(ce.length===0)throw new Error(j);return ce}getLeaves(A,E,B){let j=[];return this._appendLeaves(j,A,E=E||10,B=B||0,0),j}getTile(A,E,B){let j=this.trees[this._limitZoom(A)],K=Math.pow(2,A),{extent:Q,radius:ie}=this.options,H=ie/Q,ce=(B-H)/K,pe=(B+1+H)/K,ae={features:[]};return this._addTileFeatures(j.range((E-H)/K,ce,(E+1+H)/K,pe),j.data,E,B,K,ae),E===0&&this._addTileFeatures(j.range(1-H/K,ce,1,pe),j.data,K,B,K,ae),E===K-1&&this._addTileFeatures(j.range(0,ce,H/K,pe),j.data,-1,B,K,ae),ae.features.length?ae:null}getClusterExpansionZoom(A){let E=this._getOriginZoom(A)-1;for(;E<=this.options.maxZoom;){let B=this.getChildren(A);if(E++,B.length!==1)break;A=B[0].properties.cluster_id}return E}_appendLeaves(A,E,B,j,K){let Q=this.getChildren(E);for(let ie of Q){let H=ie.properties;if(H&&H.cluster?K+H.point_count<=j?K+=H.point_count:K=this._appendLeaves(A,H.cluster_id,B,j,K):K<j?K++:A.push(ie),A.length===B)break}return K}_createTree(A){let E=new y.av(A.length/this.stride|0,this.options.nodeSize,Float32Array);for(let B=0;B<A.length;B+=this.stride)E.add(A[B],A[B+1]);return E.finish(),E.data=A,E}_addTileFeatures(A,E,B,j,K,Q){for(let ie of A){let H=ie*this.stride,ce=E[H+mr]>1,pe,ae,ve;if(ce)pe=pa(E,H,this.clusterProps),ae=E[H],ve=E[H+1];else{let ct=this.points[E[H+Ai]];pe=ct.properties;let[Ke,ht]=ct.geometry.coordinates;ae=Zi(Ke),ve=fr(ht)}let Ve={type:1,geometry:[[Math.round(this.options.extent*(ae*K-B)),Math.round(this.options.extent*(ve*K-j))]],tags:pe},je;je=ce||this.options.generateId?E[H+Ai]:this.points[E[H+Ai]].id,je!==void 0&&(Ve.id=je),Q.features.push(Ve)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(Math.floor(+A),this.options.maxZoom+1))}_cluster(A,E){let{radius:B,extent:j,reduce:K,minPoints:Q}=this.options,ie=B/(j*Math.pow(2,E)),H=A.data,ce=[],pe=this.stride;for(let ae=0;ae<H.length;ae+=pe){if(H[ae+2]<=E)continue;H[ae+2]=E;let ve=H[ae],Ve=H[ae+1],je=A.within(H[ae],H[ae+1],ie),ct=H[ae+mr],Ke=ct;for(let ht of je){let at=ht*pe;H[at+2]>E&&(Ke+=H[at+mr])}if(Ke>ct&&Ke>=Q){let ht,at=ve*ct,Ht=Ve*ct,Rt=-1,tt=((ae/pe|0)<<5)+(E+1)+this.points.length;for(let gt of je){let zt=gt*pe;if(H[zt+2]<=E)continue;H[zt+2]=E;let ei=H[zt+mr];at+=H[zt]*ei,Ht+=H[zt+1]*ei,H[zt+4]=tt,K&&(ht||(ht=this._map(H,ae,!0),Rt=this.clusterProps.length,this.clusterProps.push(ht)),K(ht,this._map(H,zt)))}H[ae+4]=tt,ce.push(at/Ke,Ht/Ke,1/0,tt,-1,Ke),K&&ce.push(Rt)}else{for(let ht=0;ht<pe;ht++)ce.push(H[ae+ht]);if(Ke>1)for(let ht of je){let at=ht*pe;if(!(H[at+2]<=E)){H[at+2]=E;for(let Ht=0;Ht<pe;Ht++)ce.push(H[at+Ht])}}}}return ce}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,E,B){if(A[E+mr]>1){let Q=this.clusterProps[A[E+ua]];return B?Object.assign({},Q):Q}let j=this.points[A[E+Ai]].properties,K=this.options.map(j);return B&&K===j?Object.assign({},K):K}}function Rr(U,A,E){return{type:"Feature",id:U[A+Ai],properties:pa(U,A,E),geometry:{type:"Point",coordinates:[(B=U[A],360*(B-.5)),Fn(U[A+1])]}};var B}function pa(U,A,E){let B=U[A+mr],j=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B,K=U[A+ua],Q=K===-1?{}:Object.assign({},E[K]);return Object.assign(Q,{cluster:!0,cluster_id:U[A+Ai],point_count:B,point_count_abbreviated:j})}function Zi(U){return U/360+.5}function fr(U){let A=Math.sin(U*Math.PI/180),E=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return E<0?0:E>1?1:E}function Fn(U){let A=(180-360*U)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function Bn(U,A,E,B){let j=B,K=A+(E-A>>1),Q,ie=E-A,H=U[A],ce=U[A+1],pe=U[E],ae=U[E+1];for(let ve=A+3;ve<E;ve+=3){let Ve=lo(U[ve],U[ve+1],H,ce,pe,ae);if(Ve>j)Q=ve,j=Ve;else if(Ve===j){let je=Math.abs(ve-K);je<ie&&(Q=ve,ie=je)}}j>B&&(Q-A>3&&Bn(U,A,Q,B),U[Q+2]=j,E-Q>3&&Bn(U,Q,E,B))}function lo(U,A,E,B,j,K){let Q=j-E,ie=K-B;if(Q!==0||ie!==0){let H=((U-E)*Q+(A-B)*ie)/(Q*Q+ie*ie);H>1?(E=j,B=K):H>0&&(E+=Q*H,B+=ie*H)}return Q=U-E,ie=A-B,Q*Q+ie*ie}function Qr(U,A,E,B){let j={id:U??null,type:A,geometry:E,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(A==="Point"||A==="MultiPoint"||A==="LineString")mn(j,E);else if(A==="Polygon")mn(j,E[0]);else if(A==="MultiLineString")for(let K of E)mn(j,K);else if(A==="MultiPolygon")for(let K of E)mn(j,K[0]);return j}function mn(U,A){for(let E=0;E<A.length;E+=3)U.minX=Math.min(U.minX,A[E]),U.minY=Math.min(U.minY,A[E+1]),U.maxX=Math.max(U.maxX,A[E]),U.maxY=Math.max(U.maxY,A[E+1])}function fn(U,A,E,B){if(!A.geometry)return;let j=A.geometry.coordinates;if(j&&j.length===0)return;let K=A.geometry.type,Q=Math.pow(E.tolerance/((1<<E.maxZoom)*E.extent),2),ie=[],H=A.id;if(E.promoteId?H=A.properties[E.promoteId]:E.generateId&&(H=B||0),K==="Point")ma(j,ie);else if(K==="MultiPoint")for(let ce of j)ma(ce,ie);else if(K==="LineString")oe(j,ie,Q,!1);else if(K==="MultiLineString"){if(E.lineMetrics){for(let ce of j)ie=[],oe(ce,ie,Q,!1),U.push(Qr(H,"LineString",ie,A.properties));return}On(j,ie,Q,!1)}else if(K==="Polygon")On(j,ie,Q,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(let ce of A.geometry.geometries)fn(U,{id:H,geometry:ce,properties:A.properties},E,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let ce of j){let pe=[];On(ce,pe,Q,!0),ie.push(pe)}}U.push(Qr(H,K,ie,A.properties))}function ma(U,A){A.push(co(U[0]),pt(U[1]),0)}function oe(U,A,E,B){let j,K,Q=0;for(let H=0;H<U.length;H++){let ce=co(U[H][0]),pe=pt(U[H][1]);A.push(ce,pe,0),H>0&&(Q+=B?(j*pe-ce*K)/2:Math.sqrt(Math.pow(ce-j,2)+Math.pow(pe-K,2))),j=ce,K=pe}let ie=A.length-3;A[2]=1,Bn(A,0,ie,E),A[ie+2]=1,A.size=Math.abs(Q),A.start=0,A.end=A.size}function On(U,A,E,B){for(let j=0;j<U.length;j++){let K=[];oe(U[j],K,E,B),A.push(K)}}function co(U){return U/360+.5}function pt(U){let A=Math.sin(U*Math.PI/180),E=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return E<0?0:E>1?1:E}function Lt(U,A,E,B,j,K,Q,ie){if(B/=A,K>=(E/=A)&&Q<B)return U;if(Q<E||K>=B)return null;let H=[];for(let ce of U){let pe=ce.geometry,ae=ce.type,ve=j===0?ce.minX:ce.minY,Ve=j===0?ce.maxX:ce.maxY;if(ve>=E&&Ve<B){H.push(ce);continue}if(Ve<E||ve>=B)continue;let je=[];if(ae==="Point"||ae==="MultiPoint")ho(pe,je,E,B,j);else if(ae==="LineString")gn(pe,je,E,B,j,!1,ie.lineMetrics);else if(ae==="MultiLineString")fa(pe,je,E,B,j,!1);else if(ae==="Polygon")fa(pe,je,E,B,j,!0);else if(ae==="MultiPolygon")for(let ct of pe){let Ke=[];fa(ct,Ke,E,B,j,!0),Ke.length&&je.push(Ke)}if(je.length){if(ie.lineMetrics&&ae==="LineString"){for(let ct of je)H.push(Qr(ce.id,ae,ct,ce.tags));continue}ae!=="LineString"&&ae!=="MultiLineString"||(je.length===1?(ae="LineString",je=je[0]):ae="MultiLineString"),ae!=="Point"&&ae!=="MultiPoint"||(ae=je.length===3?"Point":"MultiPoint"),H.push(Qr(ce.id,ae,je,ce.tags))}}return H.length?H:null}function ho(U,A,E,B,j){for(let K=0;K<U.length;K+=3){let Q=U[K+j];Q>=E&&Q<=B&&rr(A,U[K],U[K+1],U[K+2])}}function gn(U,A,E,B,j,K,Q){let ie=en(U),H=j===0?uo:po,ce,pe,ae=U.start;for(let Ke=0;Ke<U.length-3;Ke+=3){let ht=U[Ke],at=U[Ke+1],Ht=U[Ke+2],Rt=U[Ke+3],tt=U[Ke+4],gt=j===0?ht:at,zt=j===0?Rt:tt,ei=!1;Q&&(ce=Math.sqrt(Math.pow(ht-Rt,2)+Math.pow(at-tt,2))),gt<E?zt>E&&(pe=H(ie,ht,at,Rt,tt,E),Q&&(ie.start=ae+ce*pe)):gt>B?zt<B&&(pe=H(ie,ht,at,Rt,tt,B),Q&&(ie.start=ae+ce*pe)):rr(ie,ht,at,Ht),zt<E&&gt>=E&&(pe=H(ie,ht,at,Rt,tt,E),ei=!0),zt>B&&gt<=B&&(pe=H(ie,ht,at,Rt,tt,B),ei=!0),!K&&ei&&(Q&&(ie.end=ae+ce*pe),A.push(ie),ie=en(U)),Q&&(ae+=ce)}let ve=U.length-3,Ve=U[ve],je=U[ve+1],ct=j===0?Ve:je;ct>=E&&ct<=B&&rr(ie,Ve,je,U[ve+2]),ve=ie.length-3,K&&ve>=3&&(ie[ve]!==ie[0]||ie[ve+1]!==ie[1])&&rr(ie,ie[0],ie[1],ie[2]),ie.length&&A.push(ie)}function en(U){let A=[];return A.size=U.size,A.start=U.start,A.end=U.end,A}function fa(U,A,E,B,j,K){for(let Q of U)gn(Q,A,E,B,j,K,!1)}function rr(U,A,E,B){U.push(A,E,B)}function uo(U,A,E,B,j,K){let Q=(K-A)/(B-A);return rr(U,K,E+(j-E)*Q,1),Q}function po(U,A,E,B,j,K){let Q=(K-E)/(j-E);return rr(U,A+(B-A)*Q,K,1),Q}function ye(U,A){let E=[];for(let B=0;B<U.length;B++){let j=U[B],K=j.type,Q;if(K==="Point"||K==="MultiPoint"||K==="LineString")Q=Fr(j.geometry,A);else if(K==="MultiLineString"||K==="Polygon"){Q=[];for(let ie of j.geometry)Q.push(Fr(ie,A))}else if(K==="MultiPolygon"){Q=[];for(let ie of j.geometry){let H=[];for(let ce of ie)H.push(Fr(ce,A));Q.push(H)}}E.push(Qr(j.id,K,Q,j.tags))}return E}function Fr(U,A){let E=[];E.size=U.size,U.start!==void 0&&(E.start=U.start,E.end=U.end);for(let B=0;B<U.length;B+=3)E.push(U[B]+A,U[B+1],U[B+2]);return E}function bi(U,A){if(U.transformed)return U;let E=1<<U.z,B=U.x,j=U.y;for(let K of U.features){let Q=K.geometry,ie=K.type;if(K.geometry=[],ie===1)for(let H=0;H<Q.length;H+=2)K.geometry.push(Br(Q[H],Q[H+1],A,E,B,j));else for(let H=0;H<Q.length;H++){let ce=[];for(let pe=0;pe<Q[H].length;pe+=2)ce.push(Br(Q[H][pe],Q[H][pe+1],A,E,B,j));K.geometry.push(ce)}}return U.transformed=!0,U}function Br(U,A,E,B,j,K){return[Math.round(E*(U*B-j)),Math.round(E*(A*B-K))]}function _n(U,A,E,B,j){let K=A===j.maxZoom?0:j.tolerance/((1<<A)*j.extent),Q={features:[],numPoints:0,numSimplified:0,numFeatures:U.length,source:null,x:E,y:B,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let ie of U)we(Q,ie,K,j);return Q}function we(U,A,E,B){let j=A.geometry,K=A.type,Q=[];if(U.minX=Math.min(U.minX,A.minX),U.minY=Math.min(U.minY,A.minY),U.maxX=Math.max(U.maxX,A.maxX),U.maxY=Math.max(U.maxY,A.maxY),K==="Point"||K==="MultiPoint")for(let ie=0;ie<j.length;ie+=3)Q.push(j[ie],j[ie+1]),U.numPoints++,U.numSimplified++;else if(K==="LineString")et(Q,j,U,E,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(let ie=0;ie<j.length;ie++)et(Q,j[ie],U,E,K==="Polygon",ie===0);else if(K==="MultiPolygon")for(let ie=0;ie<j.length;ie++){let H=j[ie];for(let ce=0;ce<H.length;ce++)et(Q,H[ce],U,E,!0,ce===0)}if(Q.length){let ie=A.tags||null;if(K==="LineString"&&B.lineMetrics){ie={};for(let ce in A.tags)ie[ce]=A.tags[ce];ie.mapbox_clip_start=j.start/j.size,ie.mapbox_clip_end=j.end/j.size}let H={geometry:Q,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:ie};A.id!==null&&(H.id=A.id),U.features.push(H)}}function et(U,A,E,B,j,K){let Q=B*B;if(B>0&&A.size<(j?Q:B))return void(E.numPoints+=A.length/3);let ie=[];for(let H=0;H<A.length;H+=3)(B===0||A[H+2]>Q)&&(E.numSimplified++,ie.push(A[H],A[H+1])),E.numPoints++;j&&function(H,ce){let pe=0;for(let ae=0,ve=H.length,Ve=ve-2;ae<ve;Ve=ae,ae+=2)pe+=(H[ae]-H[Ve])*(H[ae+1]+H[Ve+1]);if(pe>0===ce)for(let ae=0,ve=H.length;ae<ve/2;ae+=2){let Ve=H[ae],je=H[ae+1];H[ae]=H[ve-2-ae],H[ae+1]=H[ve-1-ae],H[ve-2-ae]=Ve,H[ve-1-ae]=je}}(ie,K),U.push(ie)}let Ze={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pi{constructor(A,E){let B=(E=this.options=function(K,Q){for(let ie in Q)K[ie]=Q[ie];return K}(Object.create(Ze),E)).debug;if(B&&console.time("preprocess data"),E.maxZoom<0||E.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(E.promoteId&&E.generateId)throw new Error("promoteId and generateId cannot be used together.");let j=function(K,Q){let ie=[];if(K.type==="FeatureCollection")for(let H=0;H<K.features.length;H++)fn(ie,K.features[H],Q,H);else fn(ie,K.type==="Feature"?K:{geometry:K},Q);return ie}(A,E);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",E.indexMaxZoom,E.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(K,Q){let ie=Q.buffer/Q.extent,H=K,ce=Lt(K,1,-1-ie,ie,0,-1,2,Q),pe=Lt(K,1,1-ie,2+ie,0,-1,2,Q);return(ce||pe)&&(H=Lt(K,1,-ie,1+ie,0,-1,2,Q)||[],ce&&(H=ye(ce,1).concat(H)),pe&&(H=H.concat(ye(pe,-1)))),H}(j,E),j.length&&this.splitTile(j,0,0,0),B&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(A,E,B,j,K,Q,ie){let H=[A,E,B,j],ce=this.options,pe=ce.debug;for(;H.length;){j=H.pop(),B=H.pop(),E=H.pop(),A=H.pop();let ae=1<<E,ve=gr(E,B,j),Ve=this.tiles[ve];if(!Ve&&(pe>1&&console.time("creation"),Ve=this.tiles[ve]=_n(A,E,B,j,ce),this.tileCoords.push({z:E,x:B,y:j}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",E,B,j,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));let ei=`z${E}`;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(Ve.source=A,K==null){if(E===ce.indexMaxZoom||Ve.numPoints<=ce.indexMaxPoints)continue}else{if(E===ce.maxZoom||E===K)continue;if(K!=null){let ei=K-E;if(B!==Q>>ei||j!==ie>>ei)continue}}if(Ve.source=null,A.length===0)continue;pe>1&&console.time("clipping");let je=.5*ce.buffer/ce.extent,ct=.5-je,Ke=.5+je,ht=1+je,at=null,Ht=null,Rt=null,tt=null,gt=Lt(A,ae,B-je,B+Ke,0,Ve.minX,Ve.maxX,ce),zt=Lt(A,ae,B+ct,B+ht,0,Ve.minX,Ve.maxX,ce);A=null,gt&&(at=Lt(gt,ae,j-je,j+Ke,1,Ve.minY,Ve.maxY,ce),Ht=Lt(gt,ae,j+ct,j+ht,1,Ve.minY,Ve.maxY,ce),gt=null),zt&&(Rt=Lt(zt,ae,j-je,j+Ke,1,Ve.minY,Ve.maxY,ce),tt=Lt(zt,ae,j+ct,j+ht,1,Ve.minY,Ve.maxY,ce),zt=null),pe>1&&console.timeEnd("clipping"),H.push(at||[],E+1,2*B,2*j),H.push(Ht||[],E+1,2*B,2*j+1),H.push(Rt||[],E+1,2*B+1,2*j),H.push(tt||[],E+1,2*B+1,2*j+1)}}getTile(A,E,B){A=+A,E=+E,B=+B;let j=this.options,{extent:K,debug:Q}=j;if(A<0||A>24)return null;let ie=1<<A,H=gr(A,E=E+ie&ie-1,B);if(this.tiles[H])return bi(this.tiles[H],K);Q>1&&console.log("drilling down to z%d-%d-%d",A,E,B);let ce,pe=A,ae=E,ve=B;for(;!ce&&pe>0;)pe--,ae>>=1,ve>>=1,ce=this.tiles[gr(pe,ae,ve)];return ce&&ce.source?(Q>1&&(console.log("found parent tile z%d-%d-%d",pe,ae,ve),console.time("drilling down")),this.splitTile(ce.source,pe,ae,ve,A,E,B),Q>1&&console.timeEnd("drilling down"),this.tiles[H]?bi(this.tiles[H],K):null):null}}function gr(U,A,E){return 32*((1<<U)*E+A)+U}function Xe(U,A){return A?U.properties[A]:U.id}function Or(U,A){if(U==null)return!0;if(U.type==="Feature")return Xe(U,A)!=null;if(U.type==="FeatureCollection"){let E=new Set;for(let B of U.features){let j=Xe(B,A);if(j==null||E.has(j))return!1;E.add(j)}return!0}return!1}function tn(U,A){let E=new Map;if(U!=null)if(U.type==="Feature")E.set(Xe(U,A),U);else for(let B of U.features)E.set(Xe(B,A),B);return E}class yn extends ge{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(A,E){return y._(this,void 0,void 0,function*(){let B=A.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let j=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!j)return null;let K=new class{constructor(ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.X,this.length=ie.length,this._features=ie}feature(ie){return new class{constructor(H){this._feature=H,this.extent=y.X,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){let H=[];for(let ce of this._feature.geometry)H.push([new y.P(ce[0],ce[1])]);return H}{let H=[];for(let ce of this._feature.geometry){let pe=[];for(let ae of ce)pe.push(new y.P(ae[0],ae[1]));H.push(pe)}return H}}toGeoJSON(H,ce,pe){return un.call(this,H,ce,pe)}}(this._features[ie])}}(j.features),Q=Lr(K);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:K,rawData:Q.buffer}})}loadData(A){return y._(this,void 0,void 0,function*(){var E;(E=this._pendingRequest)===null||E===void 0||E.abort();let B=!!(A&&A.request&&A.request.collectResourceTiming)&&new y.bv(A.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(A,this._pendingRequest),this._geoJSONIndex=A.cluster?new pn(function({superclusterOptions:Q,clusterProperties:ie}){if(!ie||!Q)return Q;let H={},ce={},pe={accumulated:null,zoom:0},ae={properties:null},ve=Object.keys(ie);for(let Ve of ve){let[je,ct]=ie[Ve],Ke=y.bC(ct),ht=y.bC(typeof je=="string"?[je,["accumulated"],["get",Ve]]:je);H[Ve]=Ke.value,ce[Ve]=ht.value}return Q.map=Ve=>{ae.properties=Ve;let je={};for(let ct of ve)je[ct]=H[ct].evaluate(pe,ae);return je},Q.reduce=(Ve,je)=>{ae.properties=je;for(let ct of ve)pe.accumulated=Ve[ct],Ve[ct]=ce[ct].evaluate(pe,ae)},Q}(A)).load((yield this._pendingData).features):(j=yield this._pendingData,new Pi(j,A.geojsonVtOptions)),this.loaded={};let K={};if(B){let Q=B.finish();Q&&(K.resourceTiming={},K.resourceTiming[A.source]=JSON.parse(JSON.stringify(Q)))}return K}catch(K){if(delete this._pendingRequest,y.bB(K))return{abandoned:!0};throw K}var j})}getData(){return y._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(A){let E=this.loaded;return E&&E[A.uid]?super.reloadTile(A):this.loadTile(A)}loadAndProcessGeoJSON(A,E){return y._(this,void 0,void 0,function*(){let B=yield this.loadGeoJSON(A,E);if(delete this._pendingRequest,typeof B!="object")throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(Ui(B,!0),A.filter){let j=y.bC(A.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(j.result==="error")throw new Error(j.value.map(Q=>`${Q.key}: ${Q.message}`).join(", "));B={type:"FeatureCollection",features:B.features.filter(Q=>j.value.evaluate({zoom:0},Q))}}return B})}loadGeoJSON(A,E){return y._(this,void 0,void 0,function*(){let{promoteId:B}=A;if(A.request){let j=yield y.h(A.request,E);return this._dataUpdateable=Or(j.data,B)?tn(j.data,B):void 0,j.data}if(typeof A.data=="string")try{let j=JSON.parse(A.data);return this._dataUpdateable=Or(j,B)?tn(j,B):void 0,j}catch{throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`)}if(!A.dataDiff)throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${A.source}`);return function(j,K,Q){var ie,H,ce,pe;if(K.removeAll&&j.clear(),K.remove)for(let ae of K.remove)j.delete(ae);if(K.add)for(let ae of K.add){let ve=Xe(ae,Q);ve!=null&&j.set(ve,ae)}if(K.update)for(let ae of K.update){let ve=j.get(ae.id);if(ve==null)continue;let Ve=!ae.removeAllProperties&&(((ie=ae.removeProperties)===null||ie===void 0?void 0:ie.length)>0||((H=ae.addOrUpdateProperties)===null||H===void 0?void 0:H.length)>0);if((ae.newGeometry||ae.removeAllProperties||Ve)&&(ve=Object.assign({},ve),j.set(ae.id,ve),Ve&&(ve.properties=Object.assign({},ve.properties))),ae.newGeometry&&(ve.geometry=ae.newGeometry),ae.removeAllProperties)ve.properties={};else if(((ce=ae.removeProperties)===null||ce===void 0?void 0:ce.length)>0)for(let je of ae.removeProperties)Object.prototype.hasOwnProperty.call(ve.properties,je)&&delete ve.properties[je];if(((pe=ae.addOrUpdateProperties)===null||pe===void 0?void 0:pe.length)>0)for(let{key:je,value:ct}of ae.addOrUpdateProperties)ve.properties[je]=ct}}(this._dataUpdateable,A.dataDiff,B),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(A){return y._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(A){return this._geoJSONIndex.getClusterExpansionZoom(A.clusterId)}getClusterChildren(A){return this._geoJSONIndex.getChildren(A.clusterId)}getClusterLeaves(A){return this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset)}}class Vr{constructor(A){this.self=A,this.actor=new y.F(A),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(E,B)=>{if(this.externalWorkerSourceTypes[E])throw new Error(`Worker source with name "${E}" already registered.`);this.externalWorkerSourceTypes[E]=B},this.self.addProtocol=y.bi,this.self.removeProtocol=y.bj,this.self.registerRTLTextPlugin=E=>{if(y.bD.isParsed())throw new Error("RTL text plugin already registered.");y.bD.setMethods(E)},this.actor.registerMessageHandler("LDT",(E,B)=>this._getDEMWorkerSource(E,B.source).loadTile(B)),this.actor.registerMessageHandler("RDT",(E,B)=>y._(this,void 0,void 0,function*(){this._getDEMWorkerSource(E,B.source).removeTile(B)})),this.actor.registerMessageHandler("GCEZ",(E,B)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterExpansionZoom(B)})),this.actor.registerMessageHandler("GCC",(E,B)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterChildren(B)})),this.actor.registerMessageHandler("GCL",(E,B)=>y._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterLeaves(B)})),this.actor.registerMessageHandler("LD",(E,B)=>this._getWorkerSource(E,B.type,B.source).loadData(B)),this.actor.registerMessageHandler("GD",(E,B)=>this._getWorkerSource(E,B.type,B.source).getData()),this.actor.registerMessageHandler("LT",(E,B)=>this._getWorkerSource(E,B.type,B.source).loadTile(B)),this.actor.registerMessageHandler("RT",(E,B)=>this._getWorkerSource(E,B.type,B.source).reloadTile(B)),this.actor.registerMessageHandler("AT",(E,B)=>this._getWorkerSource(E,B.type,B.source).abortTile(B)),this.actor.registerMessageHandler("RMT",(E,B)=>this._getWorkerSource(E,B.type,B.source).removeTile(B)),this.actor.registerMessageHandler("RS",(E,B)=>y._(this,void 0,void 0,function*(){if(!this.workerSources[E]||!this.workerSources[E][B.type]||!this.workerSources[E][B.type][B.source])return;let j=this.workerSources[E][B.type][B.source];delete this.workerSources[E][B.type][B.source],j.removeSource!==void 0&&j.removeSource(B)})),this.actor.registerMessageHandler("RM",E=>y._(this,void 0,void 0,function*(){delete this.layerIndexes[E],delete this.availableImages[E],delete this.workerSources[E],delete this.demWorkerSources[E]})),this.actor.registerMessageHandler("SR",(E,B)=>y._(this,void 0,void 0,function*(){this.referrer=B})),this.actor.registerMessageHandler("SRPS",(E,B)=>this._syncRTLPluginState(E,B)),this.actor.registerMessageHandler("IS",(E,B)=>y._(this,void 0,void 0,function*(){this.self.importScripts(B)})),this.actor.registerMessageHandler("SI",(E,B)=>this._setImages(E,B)),this.actor.registerMessageHandler("UL",(E,B)=>y._(this,void 0,void 0,function*(){this._getLayerIndex(E).update(B.layers,B.removedIds)})),this.actor.registerMessageHandler("SL",(E,B)=>y._(this,void 0,void 0,function*(){this._getLayerIndex(E).replace(B)}))}_setImages(A,E){return y._(this,void 0,void 0,function*(){this.availableImages[A]=E;for(let B in this.workerSources[A]){let j=this.workerSources[A][B];for(let K in j)j[K].availableImages=E}})}_syncRTLPluginState(A,E){return y._(this,void 0,void 0,function*(){if(y.bD.isParsed())return y.bD.getState();if(E.pluginStatus!=="loading")return y.bD.setState(E),E;let B=E.pluginURL;if(this.self.importScripts(B),y.bD.isParsed()){let j={pluginStatus:"loaded",pluginURL:B};return y.bD.setState(j),j}throw y.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${B}`)})}_getAvailableImages(A){let E=this.availableImages[A];return E||(E=[]),E}_getLayerIndex(A){let E=this.layerIndexes[A];return E||(E=this.layerIndexes[A]=new c),E}_getWorkerSource(A,E,B){if(this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][E]||(this.workerSources[A][E]={}),!this.workerSources[A][E][B]){let j={sendAsync:(K,Q)=>(K.targetMapId=A,this.actor.sendAsync(K,Q))};switch(E){case"vector":this.workerSources[A][E][B]=new ge(j,this._getLayerIndex(A),this._getAvailableImages(A));break;case"geojson":this.workerSources[A][E][B]=new yn(j,this._getLayerIndex(A),this._getAvailableImages(A));break;default:this.workerSources[A][E][B]=new this.externalWorkerSourceTypes[E](j,this._getLayerIndex(A),this._getAvailableImages(A))}}return this.workerSources[A][E][B]}_getDEMWorkerSource(A,E){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][E]||(this.demWorkerSources[A][E]=new le),this.demWorkerSources[A][E]}}return y.i(self)&&(self.worker=new Vr(self)),Vr}),v("index",["exports","./shared"],function(y,c){"use strict";var he="4.7.1";let ze,Je,ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((e,n)=>{let o=requestAnimationFrame(e);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(o),n(c.c())})}),getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){let e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(ze||(ze=document.createElement("a")),ze.href=d,ze.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Je==null&&(Je=matchMedia("(prefers-reduced-motion: reduce)")),Je.matches)}};class le{static testProp(e){if(!le.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in le.docStyle)return e[n];return e[0]}static create(e,n,o){let s=window.document.createElement(e);return n!==void 0&&(s.className=n),o&&o.appendChild(s),s}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){le.docStyle&&le.selectProp&&(le.userSelect=le.docStyle[le.selectProp],le.docStyle[le.selectProp]="none")}static enableDrag(){le.docStyle&&le.selectProp&&(le.docStyle[le.selectProp]=le.userSelect)}static setTransform(e,n){e.style[le.transformProp]=n}static addEventListener(e,n,o,s={}){e.addEventListener(n,o,"passive"in s?s:s.capture)}static removeEventListener(e,n,o,s={}){e.removeEventListener(n,o,"passive"in s?s:s.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",le.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",le.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",le.suppressClickInternal,!0)},0)}static getScale(e){let n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,o){let s=n.boundingClientRect;return new c.P((o.clientX-s.left)/n.x-e.clientLeft,(o.clientY-s.top)/n.y-e.clientTop)}static mousePos(e,n){let o=le.getScale(e);return le.getPoint(e,o,n)}static touchPos(e,n){let o=[],s=le.getScale(e);for(let h=0;h<n.length;h++)o.push(le.getPoint(e,s,n[h]));return o}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}le.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,le.selectProp=le.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),le.transformProp=le.testProp(["transform","WebkitTransform"]);let ur={supported:!1,testSupport:function(d){!un&&Ui&&(Kr?oo(d):Ei=d)}},Ei,Ui,un=!1,Kr=!1;function oo(d){let e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Ui),d.isContextLost())return;ur.supported=!0}catch{}d.deleteTexture(e),un=!0}var $i;typeof document<"u"&&(Ui=document.createElement("img"),Ui.onload=()=>{Ei&&oo(Ei),Ei=null,Kr=!0},Ui.onerror=()=>{un=!0,Ei=null},Ui.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,o,s;d.resetRequestQueue=()=>{e=[],n=0,o=0,s={}},d.addThrottleControl=b=>{let k=o++;return s[k]=b,k},d.removeThrottleControl=b=>{delete s[b],f()},d.getImage=(b,k,M=!0)=>new Promise((I,z)=>{ur.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),c.e(b,{type:"image"}),e.push({abortController:k,requestParameters:b,supportImageRefresh:M,state:"queued",onError:F=>{z(F)},onSuccess:F=>{I(F)}}),f()});let h=b=>c._(this,void 0,void 0,function*(){b.state="running";let{requestParameters:k,supportImageRefresh:M,onError:I,onSuccess:z,abortController:F}=b,O=M===!1&&!c.i(self)&&!c.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((G,W)=>G&&W==="accept",!0));n++;let q=O?_(k,F):c.m(k,F);try{let G=yield q;delete b.abortController,b.state="completed",G.data instanceof HTMLImageElement||c.b(G.data)?z(G):G.data&&z({data:yield(Z=G.data,typeof createImageBitmap=="function"?c.d(Z):c.f(Z)),cacheControl:G.cacheControl,expires:G.expires})}catch(G){delete b.abortController,I(G)}finally{n--,f()}var Z}),f=()=>{let b=(()=>{for(let k of Object.keys(s))if(s[k]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=n;k<b&&e.length>0;k++){let M=e.shift();M.abortController.signal.aborted?k--:h(M)}},_=(b,k)=>new Promise((M,I)=>{let z=new Image,F=b.url,O=b.credentials;O&&O==="include"?z.crossOrigin="use-credentials":(O&&O==="same-origin"||!c.s(F))&&(z.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{z.src="",I(c.c())}),z.fetchPriority="high",z.onload=()=>{z.onerror=z.onload=null,M({data:z})},z.onerror=()=>{z.onerror=z.onload=null,k.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},z.src=F})}($i||($i={})),$i.resetRequestQueue();class ml{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function pr(d){var e=new c.A(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var Dr,ir=function(d,e,n){return d[0]=e[0]-n[0],d[1]=e[1]-n[1],d[2]=e[2]-n[2],d};Dr=new c.A(3),c.A!=Float32Array&&(Dr[0]=0,Dr[1]=0,Dr[2]=0);var es=function(d){var e=d[0],n=d[1];return e*e+n*n};function zr(d){let e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){let n=[];for(let{id:o,url:s}of d){let h=`${o}${s}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:o,url:s}))}}return e}function so(d,e,n){let o=d.split("?");return o[0]+=`${e}${n}`,o.join("?")}(function(){var d=new c.A(2);c.A!=Float32Array&&(d[0]=0,d[1]=0)})();class yt{constructor(e,n,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,o){let{width:s,height:h}=e,f=!(this.size&&this.size[0]===s&&this.size[1]===h||o),{context:_}=this,{gl:b}=_;if(this.useMipmap=!!(n&&n.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[s,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,s,h,0,this.format,b.UNSIGNED_BYTE,e.data);else{let{x:k,y:M}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?b.texSubImage2D(b.TEXTURE_2D,0,k,M,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,k,M,s,h,b.RGBA,b.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n,o){let{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),o!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function ts(d){let{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class li extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:n,promiseResolve:o}of this.requestors)o(this._getImagesForIds(n));this.requestors=[]}}getImage(e){let n=this.images[e];if(n&&!n.data&&n.spriteData){let o=n.spriteData;n.data=new c.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let o=!0,s=n.data||n.spriteData;return this._validateStretch(n.stretchX,s&&s.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,s&&s.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),o=!1),o}_validateStretch(e,n){if(!e)return!0;let o=0;for(let s of e){if(s[0]<o||s[1]<s[0]||n<s[1])return!1;o=s[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;let o=n.spriteData,s=o&&o.width||n.data.width,h=o&&o.height||n.data.height;return!(e[0]<0||s<e[0]||e[1]<0||h<e[1]||e[2]<0||s<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,o=!0){let s=this.getImage(e);if(o&&(s.data.width!==n.data.width||s.data.height!==n.data.height))throw new Error(`size mismatch between old image (${s.data.width}x${s.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=s.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){let n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,o)=>{let s=!0;if(!this.isLoaded())for(let h of e)this.images[h]||(s=!1);this.isLoaded()||s?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){let n={};for(let o of e){let s=this.getImage(o);s||(this.fire(new c.k("styleimagemissing",{id:o})),s=this.getImage(o)),s?n[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,textFitWidth:s.textFitWidth,textFitHeight:s.textFitHeight,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:c.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){let{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){let n=this.patterns[e],o=this.getImage(e);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{let s={w:o.data.width+2,h:o.data.height+2,x:0,y:0},h=new c.I(s,o);this.patterns[e]={bin:s,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new yt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let h in this.patterns)e.push(this.patterns[h].bin);let{w:n,h:o}=c.p(e),s=this.atlasImage;s.resize({width:n||1,height:o||1});for(let h in this.patterns){let{bin:f}=this.patterns[h],_=f.x+1,b=f.y+1,k=this.getImage(h).data,M=k.width,I=k.height;c.R.copy(k,s,{x:0,y:0},{x:_,y:b},{width:M,height:I}),c.R.copy(k,s,{x:0,y:I-1},{x:_,y:b-1},{width:M,height:1}),c.R.copy(k,s,{x:0,y:0},{x:_,y:b+I},{width:M,height:1}),c.R.copy(k,s,{x:M-1,y:0},{x:_-1,y:b},{width:1,height:I}),c.R.copy(k,s,{x:0,y:0},{x:_+M,y:b},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;let o=this.getImage(n);o||c.w(`Image with ID: "${n}" was not found`),ts(o)&&this.updateImage(n,o)}}}let vi=1e20;function Yr(d,e,n,o,s,h,f,_,b){for(let k=e;k<e+o;k++)da(d,n*h+k,h,s,f,_,b);for(let k=n;k<n+s;k++)da(d,k*h+e,1,o,f,_,b)}function da(d,e,n,o,s,h,f){h[0]=0,f[0]=-vi,f[1]=vi,s[0]=d[e];for(let _=1,b=0,k=0;_<o;_++){s[_]=d[e+_*n];let M=_*_;do{let I=h[b];k=(s[_]-s[I]+M-I*I)/(_-I)/2}while(k<=f[b]&&--b>-1);b++,h[b]=_,f[b]=k,f[b+1]=vi}for(let _=0,b=0;_<o;_++){for(;f[b+1]<_;)b++;let k=h[b],M=_-k;d[e+_*n]=s[k]+M*M}}class Lr{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){let n=[];for(let h in e)for(let f of e[h])n.push(this._getAndCacheGlyphsPromise(h,f));let o=yield Promise.all(n),s={};for(let{stack:h,id:f,glyph:_}of o)s[h]||(s[h]={}),s[h][f]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return s})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let o=this.entries[e];o||(o=this.entries[e]={glyphs:{},requests:{},ranges:{}});let s=o.glyphs[n];if(s!==void 0)return{stack:e,id:n,glyph:s};if(s=this._tinySDF(o,e,n),s)return o.glyphs[n]=s,{stack:e,id:n,glyph:s};let h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(o.ranges[h])return{stack:e,id:n,glyph:s};if(!this.url)throw new Error("glyphsUrl is not set");if(!o.requests[h]){let _=Lr.loadGlyphRange(e,h,this.url,this.requestManager);o.requests[h]=_}let f=yield o.requests[h];for(let _ in f)this._doesCharSupportLocalGlyph(+_)||(o.glyphs[+_]=f[+_]);return o.ranges[h]=!0,{stack:e,id:n,glyph:f[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,o){let s=this.localIdeographFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),h=e.tinySDF=new Lr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:s,fontWeight:_})}let f=h.draw(String.fromCharCode(o));return{id:o,bitmap:new c.o({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}Lr.loadGlyphRange=function(d,e,n,o){return c._(this,void 0,void 0,function*(){let s=256*e,h=s+255,f=o.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${s}-${h}`),"Glyphs"),_=yield c.l(f,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${e}, ${s}-${h}`);let b={};for(let k of c.n(_.data))b[k.id]=k;return b})},Lr.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:h="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let _=this.size=d+4*e,b=this._createCanvas(_),k=this.ctx=b.getContext("2d",{willReadFrequently:!0});k.font=`${f} ${h} ${d}px ${s}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(d){let e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:h}=this.ctx.measureText(d),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-s))),b=Math.min(this.size-this.buffer,f+Math.ceil(o)),k=_+2*this.buffer,M=b+2*this.buffer,I=Math.max(k*M,0),z=new Uint8ClampedArray(I),F={data:z,width:k,height:M,glyphWidth:_,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||b===0)return F;let{ctx:O,buffer:q,gridInner:Z,gridOuter:G}=this;O.clearRect(q,q,_,b),O.fillText(d,q,q+f);let W=O.getImageData(q,q,_,b);G.fill(vi,0,I),Z.fill(0,0,I);for(let V=0;V<b;V++)for(let J=0;J<_;J++){let ee=W.data[4*(V*_+J)+3]/255;if(ee===0)continue;let ne=(V+q)*k+J+q;if(ee===1)G[ne]=0,Z[ne]=vi;else{let ue=.5-ee;G[ne]=ue>0?ue*ue:0,Z[ne]=ue<0?ue*ue:0}}Yr(G,0,0,k,M,k,this.f,this.v,this.z),Yr(Z,q,q,_,b,k,this.f,this.v,this.z);for(let V=0;V<I;V++){let J=Math.sqrt(G[V])-Math.sqrt(Z[V]);z[V]=Math.round(255-255*(J/this.radius+this.cutoff))}return F}};class is{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,o){return{x:c.y.number(e.x,n.x,o),y:c.y.number(e.y,n.y,o),z:c.y.number(e.z,n.z,o)}}}let Rn;class Jr extends c.E{constructor(e){super(),Rn=Rn||new c.q({anchor:new c.D(c.v.light.anchor),position:new is,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Rn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o){return(!o||o.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}let Ai=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class mr extends c.E{constructor(e){super(),this._transitionable=new c.T(Ai),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o={}){return o?.validate!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ua{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){let o=e.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(e,n)),this.dashEntry[o]}getDashRanges(e,n,o){let s=[],h=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,_=!0;s.push({left:h,right:f,isDash:_,zeroLength:e[0]===0});let b=e[0];for(let k=1;k<e.length;k++){_=!_;let M=e[k];h=b*o,b+=M,f=b*o,s.push({left:h,right:f,isDash:_,zeroLength:M===0})}return s}addRoundDash(e,n,o){let s=n/2;for(let h=-o;h<=o;h++){let f=this.width*(this.nextRow+o+h),_=0,b=e[_];for(let k=0;k<this.width;k++){k/b.right>1&&(b=e[++_]);let M=Math.abs(k-b.left),I=Math.abs(k-b.right),z=Math.min(M,I),F,O=h/o*(s+1);if(b.isDash){let q=s-Math.abs(O);F=Math.sqrt(z*z+q*q)}else F=s-Math.sqrt(z*z+O*O);this.data[f+k]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e){for(let _=e.length-1;_>=0;--_){let b=e[_],k=e[_+1];b.zeroLength?e.splice(_,1):k&&k.isDash===b.isDash&&(k.left=b.left,e.splice(_,1))}let n=e[0],o=e[e.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);let s=this.width*this.nextRow,h=0,f=e[h];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++h]);let b=Math.abs(_-f.left),k=Math.abs(_-f.right),M=Math.min(b,k);this.data[s+_]=Math.max(0,Math.min(255,(f.isDash?M:-M)+128))}}addDash(e,n){let o=n?7:0,s=2*o+1;if(this.nextRow+s>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let _=0;_<e.length;_++)h+=e[_];if(h!==0){let _=this.width/h,b=this.getDashRanges(e,this.width,_);n?this.addRoundDash(b,_,o):this.addRegularDash(b)}let f={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:h};return this.nextRow+=s,this.dirty=!0,f}bind(e){let n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}let pn="maplibre_preloaded_worker_pool";class Rr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pn]}numActive(){return Object.keys(this.active).length}}let pa=Math.floor(ge.hardwareConcurrency/2),Zi,fr;function Fn(){return Zi||(Zi=new Rr),Zi}Rr.workerCount=c.C(globalThis)?Math.max(Math.min(pa,3),1):1;class Bn{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;let o=this.workerPool.acquire(n);for(let s=0;s<o.length;s++){let h=new c.F(o[s],n);h.name=`Worker ${s}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){let o=[];for(let s of this.actors)o.push(s.sendAsync({type:e,data:n}));return Promise.all(o)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(let o of this.actors)o.registerMessageHandler(e,n)}}function lo(){return fr||(fr=new Bn(Fn(),c.G),fr.registerMessageHandler("GR",(d,e,n)=>c.m(e,n))),fr}function Qr(d,e){let n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*d.width,.5*d.height,1]),c.L(n,n,d.calculatePosMatrix(e.toUnwrapped()))}function mn(d,e,n,o,s,h){let f=function(I,z,F){if(I)for(let O of I){let q=z[O];if(q&&q.source===F&&q.type==="fill-extrusion")return!0}else for(let O in z){let q=z[O];if(q.source===F&&q.type==="fill-extrusion")return!0}return!1}(s&&s.layers,e,d.id),_=h.maxPitchScaleFactor(),b=d.tilesIn(o,_,f);b.sort(fn);let k=[];for(let I of b)k.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(e,n,d._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,s,h,_,Qr(d.transform,I.tileID))});let M=function(I){let z={},F={};for(let O of I){let q=O.queryResults,Z=O.wrappedTileID,G=F[Z]=F[Z]||{};for(let W in q){let V=q[W],J=G[W]=G[W]||{},ee=z[W]=z[W]||[];for(let ne of V)J[ne.featureIndex]||(J[ne.featureIndex]=!0,ee.push(ne))}}return z}(k);for(let I in M)M[I].forEach(z=>{let F=z.feature,O=d.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=O});return M}function fn(d,e){let n=d.tileID,o=e.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}function ma(d,e,n){return c._(this,void 0,void 0,function*(){let o=d;if(d.url?o=(yield c.h(e.transformRequest(d.url,"Source"),n)).data:yield ge.frameAsync(n),!o)return null;let s=c.M(c.e(o,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in o&&o.vector_layers&&(s.vectorLayerIds=o.vector_layers.map(h=>h.id)),s})}class oe{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){let n=this._sw,o=this._ne,s,h;if(e instanceof c.N)s=e,h=e;else{if(!(e instanceof oe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oe.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(s=e._sw,h=e._ne,!s||!h)return this}return n||o?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new c.N(s.lng,s.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=c.N.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return e instanceof oe?e:e&&new oe(e)}static fromLngLat(e,n=0){let o=360*n/40075017,s=o/Math.cos(Math.PI/180*e.lat);return new oe(new c.N(e.lng-s,e.lat-o),new c.N(e.lng+s,e.lat+o))}adjustAntiMeridian(){let e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new oe(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class On{constructor(e,n,o){this.bounds=oe.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),o=Math.floor(c.O(this.bounds.getWest())*n),s=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),f=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=o&&e.x<h&&e.y>=s&&e.y<f}}class co extends c.E{constructor(e,n,o,s){if(super(),this.id=e,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new On(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request.collectResourceTiming=this._collectResourceTiming;let s="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,f)=>{e.reloadPromise={resolve:h,reject:f}})}else e.actor=this.dispatcher.getActor(),s="LT";e.abortController=new AbortController;try{let h=yield e.actor.sendAsync({type:s,data:o},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){let o=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(o.resolve).catch(o.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pt extends c.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new On(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let o=yield $i.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});let s=this.map.painter.context,h=s.gl,f=o.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new yt(s,f,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Lt extends pt{constructor(e,n,o,s){super(e,n,o,s),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let s=yield $i.getImage(o,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){let h=s.data;this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let f=c.b(h)&&c.U()?h:yield this.readImageNow(h),_={type:this.type,uid:e.uid,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let b=yield e.actor.sendAsync({type:"LDT",data:_});e.dem=b,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){let n=e.width+2,o=e.height+2;try{return new c.R({width:n,height:o},yield c.W(e,-1,-1,n,o))}catch{}}return ge.getImageData(e,1)})}_getNeighboringTiles(e){let n=e.canonical,o=Math.pow(2,n.z),s=(n.x-1+o)%o,h=n.x===0?e.wrap-1:e.wrap,f=(n.x+1+o)%o,_=n.x+1===o?e.wrap+1:e.wrap,b={};return b[new c.S(e.overscaledZ,h,n.z,s,n.y).key]={backfilled:!1},b[new c.S(e.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(b[new c.S(e.overscaledZ,h,n.z,s,n.y-1).key]={backfilled:!1},b[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},b[new c.S(e.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(b[new c.S(e.overscaledZ,h,n.z,s,n.y+1).key]={backfilled:!1},b[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},b[new c.S(e.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1}),b}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ho extends c.E{constructor(e,n,o,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(s),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){let e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,o){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:o}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){let n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(ge.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{let o=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||o.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let s=null;o.resourceTiming&&o.resourceTiming[this.id]&&(s=o.resourceTiming[this.id].slice(0));let h={dataType:"source"};this._collectResourceTiming&&s&&s.length>0&&c.e(h,{resourceTiming:s}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(o){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(o))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.actor?"RT":"LT";e.actor=this.actor;let o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;let s=yield this.actor.sendAsync({type:n,data:o},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(s,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var gn=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class en extends c.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let n=yield $i.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let n=e.map(c.Z.fromLngLat);this.tileID=function(s){let h=1/0,f=1/0,_=-1/0,b=-1/0;for(let z of s)h=Math.min(h,z.x),f=Math.min(f,z.y),_=Math.max(_,z.x),b=Math.max(b,z.y);let k=Math.max(_-h,b-f),M=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),I=Math.pow(2,M);return new c.a1(M,Math.floor((h+_)/2*I),Math.floor((f+b)/2*I))}(n),this.minzoom=this.maxzoom=this.tileID.z;let o=n.map(s=>this.tileID.getTilePoint(s)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,c.X,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,c.X),this._boundsArray.emplaceBack(o[2].x,o[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new yt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let h=this.tiles[s];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class fa extends en{constructor(e,n,o,s){super(e,n,o,s),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{let n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new yt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let h=this.tiles[s];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class rr extends en{constructor(e,n,o,s){super(e,n,o,s),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(f=>typeof f!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,gn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new yt(n,this.canvas,o.RGBA,{premultiply:!0});let s=!1;for(let h in this.tiles){let f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,s=!0)}s&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let uo={},po=d=>{switch(d){case"geojson":return ho;case"image":return en;case"raster":return pt;case"raster-dem":return Lt;case"vector":return co;case"video":return fa;case"canvas":return rr}return uo[d]},ye="RTLPluginLoaded";class Fr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=lo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,o=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!o)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ye))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let bi=null;function Br(){return bi||(bi=new Fr),bi}class _n{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,h){let f={};if(!h)return f;for(let _ of s){let b=_.layerIds.map(k=>h.getLayer(k)).filter(Boolean);if(b.length!==0){_.layers=b,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(k=>b.filter(M=>M.id===k)[0]));for(let k of b)f[k.id]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let h=this.buckets[s];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!o)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let h=this.buckets[s];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,Br().lazyLoad();break}}this.queryPadding=0;for(let s in this.buckets){let h=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(s).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let o in this.buckets){let s=this.buckets[o];s.uploadPending()&&s.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,s,h,f,_,b,k,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:h,scale:f,tileSize:this.tileSize,pixelPosMatrix:M,transform:b,params:_,queryPadding:this.queryPadding*k},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let s=o.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",f=s._geojsonTileLayer||s[h];if(!f)return;let _=c.a7(n&&n.filter),{z:b,x:k,y:M}=this.tileID.canonical,I={z:b,x:k,y:M};for(let z=0;z<f.length;z++){let F=f.feature(z);if(_.needGeometry){let Z=c.a8(F,!0);if(!_.filter(new c.z(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!_.filter(new c.z(this.tileID.overscaledZ),F))continue;let O=o.getId(F,h),q=new c.a9(F,b,k,M,O);q.tile=I,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=c.aa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),s=!1;if(this.expirationTime>o)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let h=this.expirationTime-n;h?this.expirationTime=o+Math.max(h,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let o=this.latestFeatureIndex.loadVTLayers();for(let s in this.buckets){if(!n.style.hasLayer(s))continue;let h=this.buckets[s],f=h.layers[0].sourceLayer||"_geojsonTileLayer",_=o[f],b=e[f];if(!_||!b||Object.keys(b).length===0)continue;h.update(b,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});let k=n&&n.style&&n.style.getLayer(s);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ge.now()+e}setDependencies(e,n){let o={};for(let s of n)o[s]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let s=this.dependencies[o];if(s){for(let h of n)if(s[h])return!0}}return!1}}class we{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let h={value:n,timeout:void 0};if(o!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},o)),this.data[s].push(h),this.order.push(s),this.order.length>this.max){let f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,s=n===void 0?0:this.data[o].indexOf(n),h=this.data[o][s];return this.data[o].splice(s,1),h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(h.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let s of this.data[o])e(s.value)||n.push(s);for(let o of n)this.remove(o.value.tileID,o)}}class et{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},c.e(this.stateChanges[e][s],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let h in this.state[e])h!==s&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let h in this.state[e][s])o[h]||(this.deletedStates[e][s][h]=null)}else for(let h in o)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][h]===null&&delete this.deletedStates[e][s][h]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(o in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][o]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),s=c.e({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let h=this.deletedStates[e][n];if(h===null)return{};for(let f in h)delete s[f]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let h={};for(let f in this.stateChanges[s])this.state[s][f]||(this.state[s][f]={}),c.e(this.state[s][f],this.stateChanges[s][f]),h[f]=this.state[s][f];o[s]=h}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let h={};if(this.deletedStates[s]===null)for(let f in this.state[s])h[f]={},this.state[s][f]={};else for(let f in this.deletedStates[s]){if(this.deletedStates[s][f]===null)this.state[s][f]={};else for(let _ of Object.keys(this.deletedStates[s][f]))delete this.state[s][f][_];h[f]=this.state[s][f]}o[s]=o[s]||{},c.e(o[s],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let s in e)e[s].setFeatureState(o,n)}}class Ze extends c.E{constructor(e,n,o){super(),this.id=e,this.dispatcher=o,this.on("data",s=>this._dataHandler(s)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((s,h,f,_)=>{let b=new(po(h.type))(s,h,f,_);if(b.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${b.id}`);return b})(e,n,o,this),this._tiles={},this._cache=new we(0,s=>this._unloadTile(s)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new et,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,o){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,o)}catch(s){e.state="errored",s.status!==404?this._source.fire(new c.j(s,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Pi).map(e=>e.key)}getRenderableIds(e){let n=[];for(let o in this._tiles)this._isIdRenderable(o,e)&&n.push(this._tiles[o]);return e?n.sort((o,s)=>{let h=o.tileID,f=s.tileID,_=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),b=new c.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-f.overscaledZ||b.y-_.y||b.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Pi).map(o=>o.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),yield this._loadTile(o,e,n))})}_tileLoaded(e,n,o){e.timeAdded=ge.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let h=n[s];if(e.neighboringTiles&&e.neighboringTiles[h]){let f=this.getTileByID(h);o(e,f),o(f,e)}}function o(s,h){s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0;let f=h.tileID.canonical.x-s.tileID.canonical.x,_=h.tileID.canonical.y-s.tileID.canonical.y,b=Math.pow(2,s.tileID.canonical.z),k=h.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+b)===1?f+=b:Math.abs(f-b)===1&&(f-=b)),h.dem&&s.dem&&(s.dem.backfillBorder(h.dem,f,_),s.neighboringTiles&&s.neighboringTiles[k]&&(s.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,s){for(let h in this._tiles){let f=this._tiles[h];if(s[h]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){let k=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[k.key],f&&f.hasData()&&(_=k)}let b=_;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){s[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let s=e.scaledTo(o),h=this._getLoadedTile(s);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let n=Math.ceil(e.width/this._source.tileSize)+1,o=Math.ceil(e.height/this._source.tileSize)+1,s=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(h)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let s in this._tiles){let h=this._tiles[s];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),o[h.tileID.key]=h}this._tiles=o;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}}_updateCoveredAndRetainedTiles(e,n,o,s,h,f){let _={},b={},k=Object.keys(e),M=ge.now();for(let I of k){let z=e[I],F=this._tiles[I];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=M)continue;let O=this.findLoadedParent(z,n),q=this.findLoadedSibling(z),Z=O||q||null;Z&&(this._addTile(Z.tileID),_[Z.tileID.key]=Z.tileID),b[I]=z}this._retainLoadedChildren(b,s,o,e);for(let I in _)e[I]||(this._coveredTiles[I]=!0,e[I]=_[I]);if(f){let I={},z={};for(let F of h)this._tiles[F.key].hasData()?I[F.key]=F:z[F.key]=F;for(let F in z){let O=z[F].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(I[O[0].key]=e[O[0].key]=O[0],I[O[1].key]=e[O[1].key]=O[1],I[O[2].key]=e[O[2].key]=O[2],I[O[3].key]=e[O[3].key]=O[3],delete z[F])}for(let F in z){let O=z[F],q=this.findLoadedParent(O,this._source.minzoom),Z=this.findLoadedSibling(O),G=q||Z||null;if(G){I[G.tileID.key]=e[G.tileID.key]=G.tileID;for(let W in I)I[W].isChildOf(G.tileID)&&delete I[W]}}for(let F in this._tiles)I[F]||(this._coveredTiles[F]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let o;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(o=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(M=>this._source.hasTile(M)))):o=[];let s=e.coveringZoomLevel(this._source),h=Math.max(s-Ze.maxOverzooming,this._source.minzoom),f=Math.max(s+Ze.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let M={};for(let I of o)if(I.canonical.z>this._source.minzoom){let z=I.scaledTo(I.canonical.z-1);M[z.key]=z;let F=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));M[F.key]=F}o=o.concat(Object.values(M))}let _=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let b=this._updateRetainedTiles(o,s);gr(this._source.type)&&this._updateCoveredAndRetainedTiles(b,h,f,s,o,n);for(let M in b)this._tiles[M].clearFadeHold();let k=c.ab(this._tiles,b);for(let M of k){let I=this._tiles[M];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var o;let s={},h={},f=Math.max(n-Ze.maxOverzooming,this._source.minzoom),_=Math.max(n+Ze.maxUnderzooming,this._source.minzoom),b={};for(let k of e){let M=this._addTile(k);s[k.key]=k,M.hasData()||n<this._source.maxzoom&&(b[k.key]=k)}this._retainLoadedChildren(b,n,_,s);for(let k of e){let M=this._tiles[k.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){let z=k.children(this._source.maxzoom)[0],F=this.getTile(z);if(F&&F.hasData()){s[z.key]=z;continue}}else{let z=k.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let I=M.wasRequested();for(let z=k.overscaledZ-1;z>=f;--z){let F=k.scaledTo(z);if(h[F.key])break;if(h[F.key]=!0,M=this.getTile(F),!M&&I&&(M=this._addTile(F)),M){let O=M.hasData();if((O||!(!((o=this.map)===null||o===void 0)&&o.cancelPendingTileRequestsWhileZooming)||I)&&(s[F.key]=F),I=M.wasRequested(),O)break}}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){o=this._loadedParentTiles[s.key];break}n.push(s.key);let h=s.scaledTo(s.overscaledZ-1);if(o=this._getLoadedTile(h),o)break;s=h}for(let h of n)this._loadedParentTiles[h]=o}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let n=this._tiles[e].tileID,o=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=n;return n||(n=new _n(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,o||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){let n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,o){let s=[],h=this.transform;if(!h)return s;let f=o?h.getCameraQueryGeometry(e):e,_=e.map(O=>h.pointCoordinate(O,this.terrain)),b=f.map(O=>h.pointCoordinate(O,this.terrain)),k=this.getIds(),M=1/0,I=1/0,z=-1/0,F=-1/0;for(let O of b)M=Math.min(M,O.x),I=Math.min(I,O.y),z=Math.max(z,O.x),F=Math.max(F,O.y);for(let O=0;O<k.length;O++){let q=this._tiles[k[O]];if(q.holdingForFade())continue;let Z=q.tileID,G=Math.pow(2,h.zoom-q.tileID.overscaledZ),W=n*q.queryPadding*c.X/q.tileSize/G,V=[Z.getTilePoint(new c.Z(M,I)),Z.getTilePoint(new c.Z(z,F))];if(V[0].x-W<c.X&&V[0].y-W<c.X&&V[1].x+W>=0&&V[1].y+W>=0){let J=_.map(ne=>Z.getTilePoint(ne)),ee=b.map(ne=>Z.getTilePoint(ne));s.push({tile:q,tileID:Z,queryGeometry:J,cameraQueryGeometry:ee,scale:G})}}return s}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(let o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(gr(this._source.type)){let e=ge.now();for(let n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let s=this._tiles[e];s&&s.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}}function Pi(d,e){let n=Math.abs(2*d.wrap)-+(d.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||o-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function gr(d){return d==="raster"||d==="image"||d==="video"}Ze.maxOverzooming=10,Ze.maxUnderzooming=3;class Xe{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,o=this._distances[n],s=e*this.paddedLength+this.padding;for(;o<s&&n<this._distances.length;)o=this._distances[++n];let h=n-1,f=this._distances[h],_=o-f,b=_>0?(s-f)/_:0;return this.points[h].mult(1-b).add(this.points[n].mult(b))}}function Or(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class tn{constructor(e,n,o){let s=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/o),this.yCellCount=Math.ceil(n/o);for(let f=0;f<this.xCellCount*this.yCellCount;f++)s.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,o,s,h){this._forEachCell(n,o,s,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(h)}insertCircle(e,n,o,s){this._forEachCell(n-s,o-s,n+s,o+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(o),this.circles.push(s)}_insertBoxCell(e,n,o,s,h,f){this.boxCells[h].push(f)}_insertCircleCell(e,n,o,s,h,f){this.circleCells[h].push(f)}_query(e,n,o,s,h,f,_){if(o<0||e>this.width||s<0||n>this.height)return[];let b=[];if(e<=0&&n<=0&&this.width<=o&&this.height<=s){if(h)return[{key:null,x1:e,y1:n,x2:o,y2:s}];for(let k=0;k<this.boxKeys.length;k++)b.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let M=this.circles[3*k],I=this.circles[3*k+1],z=this.circles[3*k+2];b.push({key:this.circleKeys[k],x1:M-z,y1:I-z,x2:M+z,y2:I+z})}}else this._forEachCell(e,n,o,s,this._queryCell,b,{hitTest:h,overlapMode:f,seenUids:{box:{},circle:{}}},_);return b}query(e,n,o,s){return this._query(e,n,o,s,!1,null)}hitTest(e,n,o,s,h,f){return this._query(e,n,o,s,!0,h,f).length>0}hitTestCircle(e,n,o,s,h){let f=e-o,_=e+o,b=n-o,k=n+o;if(_<0||f>this.width||k<0||b>this.height)return!1;let M=[];return this._forEachCell(f,b,_,k,this._queryCellCircle,M,{hitTest:!0,overlapMode:s,circle:{x:e,y:n,radius:o},seenUids:{box:{},circle:{}}},h),M.length>0}_queryCell(e,n,o,s,h,f,_,b){let{seenUids:k,hitTest:M,overlapMode:I}=_,z=this.boxCells[h];if(z!==null){let O=this.bboxes;for(let q of z)if(!k.box[q]){k.box[q]=!0;let Z=4*q,G=this.boxKeys[q];if(e<=O[Z+2]&&n<=O[Z+3]&&o>=O[Z+0]&&s>=O[Z+1]&&(!b||b(G))&&(!M||!Or(I,G.overlapMode))&&(f.push({key:G,x1:O[Z],y1:O[Z+1],x2:O[Z+2],y2:O[Z+3]}),M))return!0}}let F=this.circleCells[h];if(F!==null){let O=this.circles;for(let q of F)if(!k.circle[q]){k.circle[q]=!0;let Z=3*q,G=this.circleKeys[q];if(this._circleAndRectCollide(O[Z],O[Z+1],O[Z+2],e,n,o,s)&&(!b||b(G))&&(!M||!Or(I,G.overlapMode))){let W=O[Z],V=O[Z+1],J=O[Z+2];if(f.push({key:G,x1:W-J,y1:V-J,x2:W+J,y2:V+J}),M)return!0}}}return!1}_queryCellCircle(e,n,o,s,h,f,_,b){let{circle:k,seenUids:M,overlapMode:I}=_,z=this.boxCells[h];if(z!==null){let O=this.bboxes;for(let q of z)if(!M.box[q]){M.box[q]=!0;let Z=4*q,G=this.boxKeys[q];if(this._circleAndRectCollide(k.x,k.y,k.radius,O[Z+0],O[Z+1],O[Z+2],O[Z+3])&&(!b||b(G))&&!Or(I,G.overlapMode))return f.push(!0),!0}}let F=this.circleCells[h];if(F!==null){let O=this.circles;for(let q of F)if(!M.circle[q]){M.circle[q]=!0;let Z=3*q,G=this.circleKeys[q];if(this._circlesCollide(O[Z],O[Z+1],O[Z+2],k.x,k.y,k.radius)&&(!b||b(G))&&!Or(I,G.overlapMode))return f.push(!0),!0}}}_forEachCell(e,n,o,s,h,f,_,b){let k=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),I=this._convertToXCellCoord(o),z=this._convertToYCellCoord(s);for(let F=k;F<=I;F++)for(let O=M;O<=z;O++)if(h.call(this,e,n,o,s,this.xCellCount*O+F,f,_,b))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,o,s,h,f){let _=s-e,b=h-n,k=o+f;return k*k>_*_+b*b}_circleAndRectCollide(e,n,o,s,h,f,_){let b=(f-s)/2,k=Math.abs(e-(s+b));if(k>b+o)return!1;let M=(_-h)/2,I=Math.abs(n-(h+M));if(I>M+o)return!1;if(k<=b||I<=M)return!0;let z=k-b,F=I-M;return z*z+F*F<=o*o}}function yn(d,e,n,o,s){let h=c.H();return e?(c.K(h,h,[1/s,1/s,1]),n||c.ad(h,h,o.angle)):c.L(h,o.labelPlaneMatrix,d),h}function Vr(d,e,n,o,s){if(e){let h=c.ae(d);return c.K(h,h,[s,s,1]),n||c.ad(h,h,-o.angle),h}return o.glCoordMatrix}function U(d,e,n,o){let s;o?(s=[d,e,o(d,e),1],c.af(s,s,n)):(s=[d,e,0,1],ct(s,s,n));let h=s[3];return{point:new c.P(s[0]/h,s[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function A(d,e){return .5+d/e*.5}function E(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function B(d,e,n,o,s,h,f,_,b,k,M,I,z,F,O){let q=o?d.textSizeData:d.iconSizeData,Z=c.ag(q,n.transform.zoom),G=[256/n.width*2+1,256/n.height*2+1],W=o?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;W.clear();let V=d.lineVertexArray,J=o?d.text.placedSymbolArray:d.icon.placedSymbolArray,ee=n.transform.width/n.transform.height,ne=!1;for(let ue=0;ue<J.length;ue++){let _e=J.get(ue);if(_e.hidden||_e.writingMode===c.ah.vertical&&!ne){je(_e.numGlyphs,W);continue}ne=!1;let Se=U(_e.anchorX,_e.anchorY,e,O);if(!E(Se.point,G)){je(_e.numGlyphs,W);continue}let Ee=A(n.transform.cameraToCenterDistance,Se.signedDistanceFromCamera),xe=c.ai(q,Z,_e),be=f?xe/Ee:xe*Ee,Re={getElevation:O,labelPlaneMatrix:s,lineVertexArray:V,pitchWithMap:f,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:k,tileAnchorPoint:new c.P(_e.anchorX,_e.anchorY),unwrappedTileID:M,width:I,height:z,translation:F},We=Q(Re,_e,be,!1,_,e,h,d.glyphOffsetArray,W,ee,b);ne=We.useVertical,(We.notEnoughRoom||ne||We.needsFlipping&&Q(Re,_e,be,!0,_,e,h,d.glyphOffsetArray,W,ee,b).notEnoughRoom)&&je(_e.numGlyphs,W)}o?d.text.dynamicLayoutVertexBuffer.updateData(W):d.icon.dynamicLayoutVertexBuffer.updateData(W)}function j(d,e,n,o,s,h,f,_){let b=h.glyphStartIndex+h.numGlyphs,k=h.lineStartIndex,M=h.lineStartIndex+h.lineLength,I=e.getoffsetX(h.glyphStartIndex),z=e.getoffsetX(b-1),F=ve(d*I,n,o,s,h.segment,k,M,_,f);if(!F)return null;let O=ve(d*z,n,o,s,h.segment,k,M,_,f);return O?_.projectionCache.anyProjectionOccluded?null:{first:F,last:O}:null}function K(d,e,n,o){return d===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*o?{useVertical:!0}:(d===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Q(d,e,n,o,s,h,f,_,b,k,M){let I=n/24,z=e.lineOffsetX*I,F=e.lineOffsetY*I,O;if(e.numGlyphs>1){let q=e.glyphStartIndex+e.numGlyphs,Z=e.lineStartIndex,G=e.lineStartIndex+e.lineLength,W=j(I,_,z,F,o,e,M,d);if(!W)return{notEnoughRoom:!0};let V=U(W.first.point.x,W.first.point.y,f,d.getElevation).point,J=U(W.last.point.x,W.last.point.y,f,d.getElevation).point;if(s&&!o){let ee=K(e.writingMode,V,J,k);if(ee)return ee}O=[W.first];for(let ee=e.glyphStartIndex+1;ee<q-1;ee++)O.push(ve(I*_.getoffsetX(ee),z,F,o,e.segment,Z,G,d,M));O.push(W.last)}else{if(s&&!o){let Z=U(d.tileAnchorPoint.x,d.tileAnchorPoint.y,h,d.getElevation).point,G=e.lineStartIndex+e.segment+1,W=new c.P(d.lineVertexArray.getx(G),d.lineVertexArray.gety(G)),V=U(W.x,W.y,h,d.getElevation),J=V.signedDistanceFromCamera>0?V.point:function(ne,ue,_e,Se,Ee,xe){return ie(ne,ue,_e,1,Ee,xe)}(d.tileAnchorPoint,W,Z,0,h,d),ee=K(e.writingMode,Z,J,k);if(ee)return ee}let q=ve(I*_.getoffsetX(e.glyphStartIndex),z,F,o,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,d,M);if(!q||d.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};O=[q]}for(let q of O)c.aj(b,q.point,q.angle);return{}}function ie(d,e,n,o,s,h){let f=d.add(d.sub(e)._unit()),_=s!==void 0?U(f.x,f.y,s,h.getElevation).point:ce(f.x,f.y,h).point,b=n.sub(_);return n.add(b._mult(o/b.mag()))}function H(d,e,n){let o=e.projectionCache;if(o.projections[d])return o.projections[d];let s=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),h=ce(s.x,s.y,e);if(h.signedDistanceFromCamera>0)return o.projections[d]=h.point,o.anyProjectionOccluded=o.anyProjectionOccluded||h.isOccluded,h.point;let f=d-n.direction;return function(_,b,k,M,I){return ie(_,b,k,M,void 0,I)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),s,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function ce(d,e,n){let o=d+n.translation[0],s=e+n.translation[1],h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(o,s,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=U(o,s,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function pe(d,e,n){return d._unit()._perp()._mult(e*n)}function ae(d,e,n,o,s,h,f,_,b){if(_.projectionCache.offsets[d])return _.projectionCache.offsets[d];let k=n.add(e);if(d+b.direction<o||d+b.direction>=s)return _.projectionCache.offsets[d]=k,k;let M=H(d+b.direction,_,b),I=pe(M.sub(n),f,b.direction),z=n.add(I),F=M.add(I);return _.projectionCache.offsets[d]=c.ak(h,k,z,F)||k,_.projectionCache.offsets[d]}function ve(d,e,n,o,s,h,f,_,b){let k=o?d-e:d+e,M=k>0?1:-1,I=0;o&&(M*=-1,I=Math.PI),M<0&&(I+=Math.PI);let z,F=M>0?h+s:h+s+1;_.projectionCache.cachedAnchorPoint?z=_.projectionCache.cachedAnchorPoint:(z=ce(_.tileAnchorPoint.x,_.tileAnchorPoint.y,_).point,_.projectionCache.cachedAnchorPoint=z);let O,q,Z=z,G=z,W=0,V=0,J=Math.abs(k),ee=[],ne;for(;W+V<=J;){if(F+=M,F<h||F>=f)return null;W+=V,G=Z,q=O;let Se={absOffsetX:J,direction:M,distanceFromAnchor:W,previousVertex:G};if(Z=H(F,_,Se),n===0)ee.push(G),ne=Z.sub(G);else{let Ee,xe=Z.sub(G);Ee=xe.mag()===0?pe(H(F+M,_,Se).sub(Z),n,M):pe(xe,n,M),q||(q=G.add(Ee)),O=ae(F,Ee,Z,h,f,q,n,_,Se),ee.push(q),ne=O.sub(q)}V=ne.mag()}let ue=ne._mult((J-W)/V)._add(q||G),_e=I+Math.atan2(Z.y-G.y,Z.x-G.x);return ee.push(ue),{point:ue,angle:b?_e:0,path:ee}}let Ve=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function je(d,e){for(let n=0;n<d;n++){let o=e.length;e.resize(o+4),e.float32.set(Ve,3*o)}}function ct(d,e,n){let o=e[0],s=e[1];return d[0]=n[0]*o+n[4]*s+n[12],d[1]=n[1]*o+n[5]*s+n[13],d[3]=n[3]*o+n[7]*s+n[15],d}let Ke=100;class ht{constructor(e,n,o=new tn(e.width+200,e.height+200,25),s=new tn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=o,this.ignoredGrid=s,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ke,this.screenBottomBoundary=e.height+Ke,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,o,s,h,f,_,b,k,M,I){let z=e.anchorPointX+b[0],F=e.anchorPointY+b[1],O=this.projectAndGetPerspectiveRatio(s,z,F,h,M),q=o*O.perspectiveRatio,Z;if(f||_)Z=this._projectCollisionBox(e,q,s,h,f,_,b,O,M,I);else{let ee=O.point.x+(I?I.x*q:0),ne=O.point.y+(I?I.y*q:0);Z={allPointsOccluded:!1,box:[ee+e.x1*q,ne+e.y1*q,ee+e.x2*q,ne+e.y2*q]}}let[G,W,V,J]=Z.box;return this.mapProjection.useSpecialProjectionForSymbols&&(f?Z.allPointsOccluded:this.mapProjection.isOccluded(z,F,h))||O.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(G,W,V,J)||n!=="always"&&this.grid.hitTest(G,W,V,J,n,k)?{box:[G,W,V,J],placeable:!1,offscreen:!1}:{box:[G,W,V,J],placeable:!0,offscreen:this.isOffscreen(G,W,V,J)}}placeCollisionCircles(e,n,o,s,h,f,_,b,k,M,I,z,F,O,q,Z){let G=[],W=new c.P(n.anchorX,n.anchorY),V=this.getPerspectiveRatio(f,W.x,W.y,_,Z),J=(I?h/V:h*V)/c.ap,ee={getElevation:Z,labelPlaneMatrix:b,lineVertexArray:o,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:W,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:q},ne=j(J,s,n.lineOffsetX*J,n.lineOffsetY*J,!1,n,!1,ee),ue=!1,_e=!1,Se=!0;if(ne){let Ee=.5*F*V+O,xe=new c.P(-100,-100),be=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new Xe,We=ne.first,ke=ne.last,Ie=[];for(let Qe=We.path.length-1;Qe>=1;Qe--)Ie.push(We.path[Qe]);for(let Qe=1;Qe<ke.path.length;Qe++)Ie.push(ke.path[Qe]);let Ge=2.5*Ee;if(k){let Qe=this.projectPathToScreenSpace(Ie,ee,k);Ie=Qe.some(ot=>ot.signedDistanceFromCamera<=0)?[]:Qe.map(ot=>ot.point)}let Tt=[];if(Ie.length>0){let Qe=Ie[0].clone(),ot=Ie[0].clone();for(let Et=1;Et<Ie.length;Et++)Qe.x=Math.min(Qe.x,Ie[Et].x),Qe.y=Math.min(Qe.y,Ie[Et].y),ot.x=Math.max(ot.x,Ie[Et].x),ot.y=Math.max(ot.y,Ie[Et].y);Tt=Qe.x>=xe.x&&ot.x<=be.x&&Qe.y>=xe.y&&ot.y<=be.y?[Ie]:ot.x<xe.x||Qe.x>be.x||ot.y<xe.y||Qe.y>be.y?[]:c.al([Ie],xe.x,xe.y,be.x,be.y)}for(let Qe of Tt){Re.reset(Qe,.25*Ee);let ot=0;ot=Re.length<=.5*Ee?1:Math.ceil(Re.paddedLength/Ge)+1;for(let Et=0;Et<ot;Et++){let hi=Et/Math.max(ot-1,1),wr=Re.lerp(hi),At=wr.x+Ke,Li=wr.y+Ke;G.push(At,Li,Ee,0);let wi=At-Ee,di=Li-Ee,ki=At+Ee,Ur=Li+Ee;if(Se=Se&&this.isOffscreen(wi,di,ki,Ur),_e=_e||this.isInsideGrid(wi,di,ki,Ur),e!=="always"&&this.grid.hitTestCircle(At,Li,Ee,e,z)&&(ue=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ue}}}}return{circles:!M&&ue||!_e||V<this.perspectiveRatioCutoff?[]:G,offscreen:Se,collisionDetected:ue}}projectPathToScreenSpace(e,n,o){return e.map(s=>U(s.x,s.y,o,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],o=1/0,s=1/0,h=-1/0,f=-1/0;for(let M of e){let I=new c.P(M.x+Ke,M.y+Ke);o=Math.min(o,I.x),s=Math.min(s,I.y),h=Math.max(h,I.x),f=Math.max(f,I.y),n.push(I)}let _=this.grid.query(o,s,h,f).concat(this.ignoredGrid.query(o,s,h,f)),b={},k={};for(let M of _){let I=M.key;if(b[I.bucketInstanceId]===void 0&&(b[I.bucketInstanceId]={}),b[I.bucketInstanceId][I.featureIndex])continue;let z=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(n,z)&&(b[I.bucketInstanceId][I.featureIndex]=!0,k[I.bucketInstanceId]===void 0&&(k[I.bucketInstanceId]=[]),k[I.bucketInstanceId].push(I.featureIndex))}return k}insertCollisionBox(e,n,o,s,h,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:h,collisionGroupID:f,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,o,s,h,f){let _=o?this.ignoredGrid:this.grid,b={bucketInstanceId:s,featureIndex:h,collisionGroupID:f,overlapMode:n};for(let k=0;k<e.length;k+=4)_.insertCircle(b,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,n,o,s,h){let f;h?(f=[n,o,h(n,o),1],c.af(f,f,e)):(f=[n,o,0,1],ct(f,f,e));let _=f[3];return{point:new c.P((f[0]/_+1)/2*this.transform.width+Ke,(-f[1]/_+1)/2*this.transform.height+Ke),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_*.5,isOccluded:!1,signedDistanceFromCamera:_}}getPerspectiveRatio(e,n,o,s,h){let f=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,o,s,h):U(n,o,e,h);return .5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5}isOffscreen(e,n,o,s){return o<Ke||e>=this.screenRightBoundary||s<Ke||n>this.screenBottomBoundary}isInsideGrid(e,n,o,s){return o>=0&&e<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,o,s,h,f,_,b,k,M){let I=new c.P(1,0),z=new c.P(0,1),F=new c.P(e.anchorPointX+_[0],e.anchorPointY+_[1]);if(f&&!h){let Se=this.projectAndGetPerspectiveRatio(o,F.x+1,F.y,s,k).point.sub(b.point).unit(),Ee=Math.atan(Se.y/Se.x)+(Se.x<0?Math.PI:0),xe=Math.sin(Ee),be=Math.cos(Ee);I=new c.P(be,xe),z=new c.P(-xe,be)}else if(!f&&h){let Se=-this.transform.angle,Ee=Math.sin(Se),xe=Math.cos(Se);I=new c.P(xe,Ee),z=new c.P(-Ee,xe)}let O=b.point,q=n;if(h){O=F;let Se=this.transform.zoom-Math.floor(this.transform.zoom);q=Math.pow(2,-Se),q*=this.mapProjection.getPitchedTextCorrection(this.transform,F,s),M||(q*=c.ac(.5+b.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(O=O.add(I.mult(M.x*q)).add(z.mult(M.y*q)));let Z=e.x1*q,G=e.x2*q,W=(Z+G)/2,V=e.y1*q,J=e.y2*q,ee=(V+J)/2,ne=[{offsetX:Z,offsetY:V},{offsetX:W,offsetY:V},{offsetX:G,offsetY:V},{offsetX:G,offsetY:ee},{offsetX:G,offsetY:J},{offsetX:W,offsetY:J},{offsetX:Z,offsetY:J},{offsetX:Z,offsetY:ee}],ue=[];for(let{offsetX:Se,offsetY:Ee}of ne)ue.push(new c.P(O.x+I.x*Se+z.x*Ee,O.y+I.y*Se+z.y*Ee));let _e=!1;if(h){let Se=ue.map(Ee=>this.projectAndGetPerspectiveRatio(o,Ee.x,Ee.y,s,k));_e=Se.some(Ee=>!Ee.isOccluded),ue=Se.map(Ee=>Ee.point)}else _e=!0;return{box:c.ao(ue),allPointsOccluded:!_e}}}function at(d,e,n){return e*(c.X/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class Ht{constructor(e,n,o,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):s&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Rt{constructor(e,n,o,s,h){this.text=new Ht(e?e.text:null,n,o,h),this.icon=new Ht(e?e.icon:null,n,s,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tt{constructor(e,n,o){this.text=e,this.icon=n,this.skipFade=o}}class gt{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class zt{constructor(e,n,o,s,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=s,this.tileID=h}}class ei{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[e]}}function ni(d,e,n,o,s){let{horizontalAlign:h,verticalAlign:f}=c.au(d);return new c.P(-(h-.5)*e+o[0]*s,-(f-.5)*n+o[1]*s)}class xi{constructor(e,n,o,s,h,f){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new ht(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new ei(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let n=this.terrain;return n?(o,s)=>n.getElevation(e,o,s):null}getBucketParts(e,n,o,s){let h=o.getBucket(n),f=o.latestFeatureIndex;if(!h||!f||n.id!==h.layerIds[0])return;let _=o.collisionBoxArray,b=h.layers[0].layout,k=h.layers[0].paint,M=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),I=o.tileSize/c.X,z=o.tileID.toUnwrapped(),F=this.transform.calculatePosMatrix(z),O=b.get("text-pitch-alignment")==="map",q=b.get("text-rotation-alignment")==="map",Z=at(o,1,this.transform.zoom),G=this.collisionIndex.mapProjection.translatePosition(this.transform,o,k.get("text-translate"),k.get("text-translate-anchor")),W=this.collisionIndex.mapProjection.translatePosition(this.transform,o,k.get("icon-translate"),k.get("icon-translate-anchor")),V=yn(F,O,q,this.transform,Z),J=null;if(O){let ne=Vr(F,O,q,this.transform,Z);J=c.L([],this.transform.labelPlaneMatrix,ne)}this.retainedQueryData[h.bucketInstanceId]=new zt(h.bucketInstanceId,f,h.sourceLayerIndex,h.index,o.tileID);let ee={bucket:h,layout:b,translationText:G,translationIcon:W,posMatrix:F,unwrappedTileID:z,textLabelPlaneMatrix:V,labelToScreenMatrix:J,scale:M,textPixelRatio:I,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(s)for(let ne of h.sortKeyRanges){let{sortKey:ue,symbolInstanceStart:_e,symbolInstanceEnd:Se}=ne;e.push({sortKey:ue,symbolInstanceStart:_e,symbolInstanceEnd:Se,parameters:ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(e,n,o,s,h,f,_,b,k,M,I,z,F,O,q,Z,G,W,V){let J=c.aq[e.textAnchor],ee=[e.textOffset0,e.textOffset1],ne=ni(J,o,s,ee,h),ue=this.collisionIndex.placeCollisionBox(n,z,b,k,M,_,f,Z,I.predicate,V,ne);if((!W||this.collisionIndex.placeCollisionBox(W,z,b,k,M,_,f,G,I.predicate,V,ne).placeable)&&ue.placeable){let _e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(_e=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:ee,width:o,height:s,anchor:J,textBoxScale:h,prevAnchor:_e},this.markUsedJustification(O,J,F,q),O.allowVerticalPlacement&&(this.markUsedOrientation(O,q,F),this.placedOrientations[F.crossTileID]=q),{shift:ne,placedGlyphBoxes:ue}}}placeLayerBucketPart(e,n,o){let{bucket:s,layout:h,translationText:f,translationIcon:_,posMatrix:b,unwrappedTileID:k,textLabelPlaneMatrix:M,labelToScreenMatrix:I,textPixelRatio:z,holdingForFade:F,collisionBoxArray:O,partiallyEvaluatedTextSize:q,collisionGroup:Z}=e.parameters,G=h.get("text-optional"),W=h.get("icon-optional"),V=c.ar(h,"text-overlap","text-allow-overlap"),J=V==="always",ee=c.ar(h,"icon-overlap","icon-allow-overlap"),ne=ee==="always",ue=h.get("text-rotation-alignment")==="map",_e=h.get("text-pitch-alignment")==="map",Se=h.get("icon-text-fit")!=="none",Ee=h.get("symbol-z-order")==="viewport-y",xe=J&&(ne||!s.hasIconData()||W),be=ne&&(J||!s.hasTextData()||G);!s.collisionArrays&&O&&s.deserializeCollisionBoxes(O);let Re=this._getTerrainElevationFunc(this.retainedQueryData[s.bucketInstanceId].tileID),We=(ke,Ie,Ge)=>{var Tt,Qe;if(n[ke.crossTileID])return;if(F)return void(this.placements[ke.crossTileID]=new tt(!1,!1,!1));let ot=!1,Et=!1,hi=!0,wr=null,At={box:null,placeable:!1,offscreen:null},Li={box:null,placeable:!1,offscreen:null},wi=null,di=null,ki=null,Ur=0,Oa=0,Ls=0;Ie.textFeatureIndex?Ur=Ie.textFeatureIndex:ke.useRuntimeCollisionCircles&&(Ur=ke.featureIndex),Ie.verticalTextFeatureIndex&&(Oa=Ie.verticalTextFeatureIndex);let Va=Ie.textBox;if(Va){let cr=ai=>{let ui=c.ah.horizontal;if(s.allowVerticalPlacement&&!ai&&this.prevPlacement){let Yi=this.prevPlacement.placedOrientations[ke.crossTileID];Yi&&(this.placedOrientations[ke.crossTileID]=Yi,ui=Yi,this.markUsedOrientation(s,ui,ke))}return ui},hr=(ai,ui)=>{if(s.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(let Yi of s.writingModes)if(Yi===c.ah.vertical?(At=ui(),Li=At):At=ai(),At&&At.placeable)break}else At=ai()},xn=ke.textAnchorOffsetStartIndex,kr=ke.textAnchorOffsetEndIndex;if(kr===xn){let ai=(ui,Yi)=>{let lt=this.collisionIndex.placeCollisionBox(ui,V,z,b,k,_e,ue,f,Z.predicate,Re);return lt&&lt.placeable&&(this.markUsedOrientation(s,Yi,ke),this.placedOrientations[ke.crossTileID]=Yi),lt};hr(()=>ai(Va,c.ah.horizontal),()=>{let ui=Ie.verticalTextBox;return s.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&ui?ai(ui,c.ah.vertical):{box:null,offscreen:null}}),cr(At&&At.placeable)}else{let ai=c.aq[(Qe=(Tt=this.prevPlacement)===null||Tt===void 0?void 0:Tt.variableOffsets[ke.crossTileID])===null||Qe===void 0?void 0:Qe.anchor],ui=(lt,Yn,Na)=>{let ja=lt.x2-lt.x1,gh=lt.y2-lt.y1,Wd=ke.textBoxScale,_h=Se&&ee==="never"?Yn:null,wn=null,yh=V==="never"?1:2,Fs="never";ai&&yh++;for(let Do=0;Do<yh;Do++){for(let Bs=xn;Bs<kr;Bs++){let Os=s.textAnchorOffsets.get(Bs);if(ai&&Os.textAnchor!==ai)continue;let qa=this.attemptAnchorPlacement(Os,lt,ja,gh,Wd,ue,_e,z,b,k,Z,Fs,ke,s,Na,f,_,_h,Re);if(qa&&(wn=qa.placedGlyphBoxes,wn&&wn.placeable))return ot=!0,wr=qa.shift,wn}ai?ai=null:Fs=V}return o&&!wn&&(wn={box:this.collisionIndex.placeCollisionBox(Va,"always",z,b,k,_e,ue,f,Z.predicate,Re,new c.P(0,0)).box,offscreen:!1,placeable:!1}),wn};hr(()=>ui(Va,Ie.iconBox,c.ah.horizontal),()=>{let lt=Ie.verticalTextBox;return s.allowVerticalPlacement&&(!At||!At.placeable)&&ke.numVerticalGlyphVertices>0&&lt?ui(lt,Ie.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),At&&(ot=At.placeable,hi=At.offscreen);let Yi=cr(At&&At.placeable);if(!ot&&this.prevPlacement){let lt=this.prevPlacement.variableOffsets[ke.crossTileID];lt&&(this.variableOffsets[ke.crossTileID]=lt,this.markUsedJustification(s,lt.anchor,ke,Yi))}}}if(wi=At,ot=wi&&wi.placeable,hi=wi&&wi.offscreen,ke.useRuntimeCollisionCircles){let cr=s.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex),hr=c.ai(s.textSizeData,q,cr),xn=h.get("text-padding");di=this.collisionIndex.placeCollisionCircles(V,cr,s.lineVertexArray,s.glyphOffsetArray,hr,b,k,M,I,o,_e,Z.predicate,ke.collisionCircleDiameter,xn,f,Re),di.circles.length&&di.collisionDetected&&!o&&c.w("Collisions detected, but collision boxes are not shown"),ot=J||di.circles.length>0&&!di.collisionDetected,hi=hi&&di.offscreen}if(Ie.iconFeatureIndex&&(Ls=Ie.iconFeatureIndex),Ie.iconBox){let cr=hr=>this.collisionIndex.placeCollisionBox(hr,ee,z,b,k,_e,ue,_,Z.predicate,Re,Se&&wr?wr:void 0);Li&&Li.placeable&&Ie.verticalIconBox?(ki=cr(Ie.verticalIconBox),Et=ki.placeable):(ki=cr(Ie.iconBox),Et=ki.placeable),hi=hi&&ki.offscreen}let lr=G||ke.numHorizontalGlyphVertices===0&&ke.numVerticalGlyphVertices===0,Rs=W||ke.numIconVertices===0;lr||Rs?Rs?lr||(Et=Et&&ot):ot=Et&&ot:Et=ot=Et&&ot;let nc=Et&&ki.placeable;if(ot&&wi.placeable&&this.collisionIndex.insertCollisionBox(wi.box,V,h.get("text-ignore-placement"),s.bucketInstanceId,Li&&Li.placeable&&Oa?Oa:Ur,Z.ID),nc&&this.collisionIndex.insertCollisionBox(ki.box,ee,h.get("icon-ignore-placement"),s.bucketInstanceId,Ls,Z.ID),di&&ot&&this.collisionIndex.insertCollisionCircles(di.circles,V,h.get("text-ignore-placement"),s.bucketInstanceId,Ur,Z.ID),o&&this.storeCollisionData(s.bucketInstanceId,Ge,Ie,wi,ki,di),ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(s.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ke.crossTileID]=new tt(ot||xe,Et||be,hi||s.justReloaded),n[ke.crossTileID]=!0};if(Ee){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let ke=s.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ke.length-1;Ie>=0;--Ie){let Ge=ke[Ie];We(s.symbolInstances.get(Ge),s.collisionArrays[Ge],Ge)}}else for(let ke=e.symbolInstanceStart;ke<e.symbolInstanceEnd;ke++)We(s.symbolInstances.get(ke),s.collisionArrays[ke],ke);if(o&&s.bucketInstanceId in this.collisionCircleArrays){let ke=this.collisionCircleArrays[s.bucketInstanceId];c.as(ke.invProjMatrix,b),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}storeCollisionData(e,n,o,s,h,f){if(o.textBox||o.iconBox){let _,b;this.collisionBoxArrays.has(e)?_=this.collisionBoxArrays.get(e):(_=new Map,this.collisionBoxArrays.set(e,_)),_.has(n)?b=_.get(n):(b={text:null,icon:null},_.set(n,b)),o.textBox&&(b.text=s.box),o.iconBox&&(b.icon=h.box)}if(f){let _=this.collisionCircleArrays[e];_===void 0&&(_=this.collisionCircleArrays[e]=new gt);for(let b=0;b<f.circles.length;b+=4)_.circles.push(f.circles[b+0]),_.circles.push(f.circles[b+1]),_.circles.push(f.circles[b+2]),_.circles.push(f.collisionDetected?1:0)}}markUsedJustification(e,n,o,s){let h;h=s===c.ah.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[c.at(n)];let f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(let _ of f)_>=0&&(e.text.placedSymbolArray.get(_).crossTileID=h>=0&&_!==h?0:o.crossTileID)}markUsedOrientation(e,n,o){let s=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(let _ of f)e.text.placedSymbolArray.get(_).placedOrientation=s;o.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let s=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},f=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(let b in this.placements){let k=this.placements[b],M=h[b];M?(this.opacities[b]=new Rt(M,s,k.text,k.icon),o=o||k.text!==M.text.placed||k.icon!==M.icon.placed):(this.opacities[b]=new Rt(null,s,k.text,k.icon,k.skipFade),o=o||k.text||k.icon)}for(let b in h){let k=h[b];if(!this.opacities[b]){let M=new Rt(k,s,!1,!1);M.isHidden()||(this.opacities[b]=M,o=o||k.text.placed||k.icon.placed)}}for(let b in f)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=f[b]);for(let b in _)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=_[b]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let o={};for(let s of n){let h=s.getBucket(e);h&&s.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,s.tileID,o,s.collisionBoxArray)}}updateBucketOpacities(e,n,o,s){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let h=e.layers[0],f=h.layout,_=new Rt(null,0,!1,!1,!0),b=f.get("text-allow-overlap"),k=f.get("icon-allow-overlap"),M=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=f.get("text-rotation-alignment")==="map",z=f.get("text-pitch-alignment")==="map",F=f.get("icon-text-fit")!=="none",O=new Rt(null,0,b&&(k||!e.hasIconData()||f.get("icon-optional")),k&&(b||!e.hasTextData()||f.get("text-optional")),!0);!e.collisionArrays&&s&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(s);let q=(G,W,V)=>{for(let J=0;J<W/4;J++)G.opacityVertexArray.emplaceBack(V);G.hasVisibleVertices=G.hasVisibleVertices||V!==_a},Z=this.collisionBoxArrays.get(e.bucketInstanceId);for(let G=0;G<e.symbolInstances.length;G++){let W=e.symbolInstances.get(G),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:J,crossTileID:ee}=W,ne=this.opacities[ee];o[ee]?ne=_:ne||(ne=O,this.opacities[ee]=ne),o[ee]=!0;let ue=W.numIconVertices>0,_e=this.placedOrientations[W.crossTileID],Se=_e===c.ah.vertical,Ee=_e===c.ah.horizontal||_e===c.ah.horizontalOnly;if(V>0||J>0){let be=Wi(ne.text);q(e.text,V,Se?_a:be),q(e.text,J,Ee?_a:be);let Re=ne.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Ie=>{Ie>=0&&(e.text.placedSymbolArray.get(Ie).hidden=Re||Se?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Re||Ee?1:0);let We=this.variableOffsets[W.crossTileID];We&&this.markUsedJustification(e,We.anchor,W,_e);let ke=this.placedOrientations[W.crossTileID];ke&&(this.markUsedJustification(e,"left",W,ke),this.markUsedOrientation(e,ke,W))}if(ue){let be=Wi(ne.icon),Re=!(F&&W.verticalPlacedIconSymbolIndex&&Se);W.placedIconSymbolIndex>=0&&(q(e.icon,W.numIconVertices,Re?be:_a),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ne.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,W.numVerticalIconVertices,Re?_a:be),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}let xe=Z&&Z.has(G)?Z.get(G):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let be=e.collisionArrays[G];if(be){let Re=new c.P(0,0);if(be.textBox||be.verticalTextBox){let We=!0;if(M){let ke=this.variableOffsets[ee];ke?(Re=ni(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textBoxScale),I&&Re._rotate(z?this.transform.angle:-this.transform.angle)):We=!1}if(be.textBox||be.verticalTextBox){let ke;be.textBox&&(ke=Se),be.verticalTextBox&&(ke=Ee),ga(e.textCollisionBox.collisionVertexArray,ne.text.placed,!We||ke,xe.text,Re.x,Re.y)}}if(be.iconBox||be.verticalIconBox){let We=!!(!Ee&&be.verticalIconBox),ke;be.iconBox&&(ke=We),be.verticalIconBox&&(ke=!We),ga(e.iconCollisionBox.collisionVertexArray,ne.icon.placed,ke,xe.icon,F?Re.x:0,F?Re.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=G.invProjMatrix,e.placementViewportMatrix=G.viewportMatrix,e.collisionCircleArray=G.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>e}setStale(){this.stale=!0}}function ga(d,e,n,o,s,h){o&&o.length!==0||(o=[0,0,0,0]);let f=o[0]-Ke,_=o[1]-Ke,b=o[2]-Ke,k=o[3]-Ke;d.emplaceBack(e?1:0,n?1:0,s||0,h||0,f,_),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,b,_),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,b,k),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,f,k)}let _t=Math.pow(2,25),fl=Math.pow(2,24),gl=Math.pow(2,17),Gi=Math.pow(2,16),Hi=Math.pow(2,9),wd=Math.pow(2,8),nr=Math.pow(2,1);function Wi(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*_t+e*fl+n*gl+e*Gi+n*Hi+e*wd+n*nr+e}let _a=0;function Vn(){return{isOccluded:(d,e,n)=>!1,getPitchedTextCorrection:(d,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(d,e,n,o){throw new Error("Not implemented.")},translatePosition:(d,e,n,o)=>function(s,h,f,_,b=!1){if(!f[0]&&!f[1])return[0,0];let k=b?_==="map"?s.angle:0:_==="viewport"?-s.angle:0;if(k){let M=Math.sin(k),I=Math.cos(k);f=[f[0]*I-f[1]*M,f[0]*M+f[1]*I]}return[b?f[0]:at(h,f[0],s.zoom),b?f[1]:at(h,f[1],s.zoom)]}(d,e,n,o),getCircleRadiusCorrection:d=>1}}class Wt{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,o,s,h){let f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(f,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((_,b)=>_.sortKey-b.sortKey));this._currentPartIndex<f.length;)if(n.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,h())return!0;return!1}}class mo{constructor(e,n,o,s,h,f,_,b){this.placement=new xi(e,Vn(),n,f,_,b),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,o){let s=ge.now(),h=()=>!this._forceFullPlacement&&ge.now()-s>2;for(;this._currentPlacementIndex>=0;){let f=n[e[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Wt(f)),this._inProgressLayer.continuePlacement(o[f.source],this.placement,this._showCollisionBoxes,f,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let _r=512/c.X/2;class Ut{constructor(e,n,o){this.tileID=e,this.bucketInstanceId=o,this._symbolsByKey={};let s=new Map;for(let h=0;h<n.length;h++){let f=n.get(h),_=f.key,b=s.get(_);b?b.push(f):s.set(_,[f])}for(let[h,f]of s){let _={positions:f.map(b=>({x:Math.floor(b.anchorX*_r),y:Math.floor(b.anchorY*_r)})),crossTileIDs:f.map(b=>b.crossTileID)};if(_.positions.length>128){let b=new c.av(_.positions.length,16,Uint16Array);for(let{x:k,y:M}of _.positions)b.add(k,M);b.finish(),delete _.positions,_.index=b}this._symbolsByKey[h]=_}}getScaledCoordinates(e,n){let{x:o,y:s,z:h}=this.tileID.canonical,{x:f,y:_,z:b}=n.canonical,k=_r/Math.pow(2,b-h),M=(_*c.X+e.anchorY)*k,I=s*c.X*_r;return{x:Math.floor((f*c.X+e.anchorX)*k-o*c.X*_r),y:Math.floor(M-I)}}findMatches(e,n,o){let s=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){let f=e.get(h);if(f.crossTileID)continue;let _=this._symbolsByKey[f.key];if(!_)continue;let b=this.getScaledCoordinates(f,n);if(_.index){let k=_.index.range(b.x-s,b.y-s,b.x+s,b.y+s).sort();for(let M of k){let I=_.crossTileIDs[M];if(!o[I]){o[I]=!0,f.crossTileID=I;break}}}else if(_.positions)for(let k=0;k<_.positions.length;k++){let M=_.positions[k],I=_.crossTileIDs[k];if(Math.abs(M.x-b.x)<=s&&Math.abs(M.y-b.y)<=s&&!o[I]){o[I]=!0,f.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class rs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let o in this.indexes){let s=this.indexes[o],h={};for(let f in s){let _=s[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),h[_.tileID.key]=_}this.indexes[o]=h}this.lng=e}addBucket(e,n,o){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let s=this.usedCrossTileIDs[e.overscaledZ];for(let h in this.indexes){let f=this.indexes[h];if(Number(h)>e.overscaledZ)for(let _ in f){let b=f[_];b.tileID.isChildOf(e)&&b.findMatches(n.symbolInstances,e,s)}else{let _=f[e.scaledTo(Number(h)).key];_&&_.findMatches(n.symbolInstances,e,s)}}for(let h=0;h<n.symbolInstances.length;h++){let f=n.symbolInstances.get(h);f.crossTileID||(f.crossTileID=o.generate(),s[f.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ut(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let o of n.getCrossTileIDsLists())for(let s of o)delete this.usedCrossTileIDs[e][s]}removeStaleBuckets(e){let n=!1;for(let o in this.indexes){let s=this.indexes[o];for(let h in s)e[s[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,s[h]),delete s[h],n=!0)}return n}}class _l{constructor(){this.layerIndexes={},this.crossTileIDs=new rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,o){let s=this.layerIndexes[e.id];s===void 0&&(s=this.layerIndexes[e.id]=new yr);let h=!1,f={};s.handleWrapJump(o);for(let _ of n){let b=_.getBucket(e);b&&e.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(_.tileID,b,this.crossTileIDs)&&(h=!0),f[b.bucketInstanceId]=!0)}return s.removeStaleBuckets(f)&&(h=!0),h}pruneUnusedLayers(e){let n={};e.forEach(o=>{n[o]=!0});for(let o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}let vr=(d,e)=>c.t(d,e&&e.filter(n=>n.identifier!=="source.canvas")),kd=c.aw();class ns extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(let o in this.sourceCaches){let s=this.sourceCaches[o].getSource().type;s!=="vector"&&s!=="geojson"||this.sourceCaches[o].reload()}},this.map=e,this.dispatcher=new Bn(Fn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(o,s)=>this.getGlyphs(o,s)),this.dispatcher.registerMessageHandler("GI",(o,s)=>this.getImages(o,s)),this.imageManager=new li,this.imageManager.setEventedParent(this),this.glyphManager=new Lr(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ua(256,512),this.crossTileSymbolIndex=new _l,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Br().on(ye,this._rtlPluginLoaded),this.on("data",o=>{if(o.dataType!=="source"||o.sourceDataType!=="metadata")return;let s=this.sourceCaches[o.sourceId];if(!s)return;let h=s.getSource();if(h&&h.vectorLayerIds)for(let f in this._layers){let _=this._layers[f];_.source===h.id&&this._validateLayer(_)}})}loadURL(e,n={},o){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;let s=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let h=this._loadStyleRequest;c.h(s,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,n,o)}).catch(f=>{this._loadStyleRequest=null,f&&!h.signal.aborted&&this.fire(new c.j(f))})}loadJSON(e,n={},o){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,o)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(kd,{validate:!1})}_load(e,n,o){var s;let h=n.transformStyle?n.transformStyle(o,e):e;if(!n.validate||!vr(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(let f in h.sources)this.addSource(f,h.sources[f],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new Jr(this.stylesheet.light),this.sky=new mr(this.stylesheet.sky),this.map.setTerrain((s=this.stylesheet.terrain)!==null&&s!==void 0?s:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){let e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(let n of e){let o=c.aA(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(e,n=!1,o=void 0){let s;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,f,_,b){return c._(this,void 0,void 0,function*(){let k=zr(h),M=_>1?"@2x":"",I={},z={};for(let{id:F,url:O}of k){let q=f.transformRequest(so(O,M,".json"),"SpriteJSON");I[F]=c.h(q,b);let Z=f.transformRequest(so(O,M,".png"),"SpriteImage");z[F]=$i.getImage(Z,b)}return yield Promise.all([...Object.values(I),...Object.values(z)]),function(F,O){return c._(this,void 0,void 0,function*(){let q={};for(let Z in F){q[Z]={};let G=ge.getImageCanvasContext((yield O[Z]).data),W=(yield F[Z]).data;for(let V in W){let{width:J,height:ee,x:ne,y:ue,sdf:_e,pixelRatio:Se,stretchX:Ee,stretchY:xe,content:be,textFitWidth:Re,textFitHeight:We}=W[V];q[Z][V]={data:null,pixelRatio:Se,sdf:_e,stretchX:Ee,stretchY:xe,content:be,textFitWidth:Re,textFitHeight:We,spriteData:{width:J,height:ee,x:ne,y:ue,context:G}}}}return q})}(I,z)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(let f in h){this._spritesImagesIds[f]=[];let _=this._spritesImagesIds[f]?this._spritesImagesIds[f].filter(b=>!(b in h)):[];for(let b of _)this.imageManager.removeImage(b),this._changedImages[b]=!0;for(let b in h[f]){let k=f==="default"?b:`${f}:${b}`;this._spritesImagesIds[f].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,h[f][b],!1):this.imageManager.addImage(k,h[f][b]),n&&(this._changedImages[k]=!0)}}}).catch(h=>{this._spriteRequest=null,s=h,this.fire(new c.j(s))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),o&&o(s)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){let n=this.sourceCaches[e.source];if(!n)return;let o=e.sourceLayer;if(!o)return;let s=n.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(o)===-1)&&this.fire(new c.j(new Error(`Source layer "${o}" does not exist on source "${s.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){let o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(o):o);let s=[];for(let h of e)if(o[h]){let f=n?c.aB(o[h]):o[h];s.push(f)}return s}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let n=Object.keys(this._layers);for(let o of n){let s=this._layers[o];s.type!=="custom"&&(e[o]=s.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let n=this._changed;if(n){let s=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(s.length||h.length)&&this._updateWorkerLayers(s,h);for(let f in this._updatedSources){let _=this._updatedSources[f];if(_==="reload")this._reloadSource(f);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(f)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let f in this._updatedPaintProps)this._layers[f].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let o={};for(let s in this.sourceCaches){let h=this.sourceCaches[s];o[s]=h.used,h.used=!1}for(let s of this._order){let h=this._layers[s];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(let s in o){let h=this.sourceCaches[s];!!o[s]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var o;this._checkLoaded();let s=this.serialize();if(e=n.transformStyle?n.transformStyle(s,e):e,((o=n.validate)===null||o===void 0||o)&&vr(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);let h=c.aC(s,e),f=this._getOperationsToPerform(h);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(let _ of f.operations)_();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let n=[],o=[];for(let s of e)switch(s.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,s.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,s.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,s.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,s.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,s.args));break;case"addSource":n.push(()=>this.addSource.apply(this,s.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,s.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,s.args));break;case"setLight":n.push(()=>this.setLight.apply(this,s.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,s.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,s.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,s.args));break;case"setSky":n.push(()=>this.setSky.apply(this,s.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,s.args));break;case"setTransition":n.push(()=>{});break;default:o.push(s.command)}return{operations:n,unimplemented:o}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,o={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let s=this.sourceCaches[e]=new Ze(e,n,this.dispatcher);s.style=this,s.setEventedParent(this,()=>({isSourceLoaded:s.loaded(),source:s.serialize(),sourceId:e})),s.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let o in this._layers)if(this._layers[o].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${o}" is using it.`)));let n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let o=this.sourceCaches[e].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,o={}){this._checkLoaded();let s=e.id;if(this.getLayer(s))return void this.fire(new c.j(new Error(`Layer "${s}" already exists on this map.`)));let h;if(e.type==="custom"){if(vr(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(s,e.source),e=c.aB(e),e=c.e(e,{source:s})),this._validate(c.u.layer,`layers.${s}`,e,{arrayIndex:-1},o))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:s}})}let f=n?this._order.indexOf(n):this._order.length;if(n&&f===-1)this.fire(new c.j(new Error(`Cannot add layer "${s}" before non-existing layer "${n}".`)));else{if(this._order.splice(f,0,s),this._layerOrderChanged=!0,this._layers[s]=h,this._removedLayers[s]&&h.source&&h.type!=="custom"){let _=this._removedLayers[s];delete this._removedLayers[s],_.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;let o=this._order.indexOf(e);this._order.splice(o,1);let s=n?this._order.indexOf(n):this._order.length;n&&s===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);let o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,o){this._checkLoaded();let s=this.getLayer(e);s?s.minzoom===n&&s.maxzoom===o||(n!=null&&(s.minzoom=n),o!=null&&(s.maxzoom=o),this._updateLayer(s)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,o={}){this._checkLoaded();let s=this.getLayer(e);if(s){if(!c.aE(s.filter,n))return n==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(c.u.filter,`layers.${s.id}.filter`,n,null,o)||(s.filter=c.aB(n),this._updateLayer(s)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,o,s={}){this._checkLoaded();let h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),o)||(h.setLayoutProperty(n,o,s),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){let o=this.getLayer(e);if(o)return o.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,o,s={}){this._checkLoaded();let h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),o)||(h.setPaintProperty(n,o,s)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let o=e.source,s=e.sourceLayer,h=this.sourceCaches[o];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)));let f=h.getSource().type;f==="geojson"&&s?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||s?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(s,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();let o=e.source,s=this.sourceCaches[o];if(s===void 0)return void this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)));let h=s.getSource().type,f=h==="vector"?e.sourceLayer:void 0;h!=="vector"||f?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(f,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let n=e.source,o=e.sourceLayer,s=this.sourceCaches[n];if(s!==void 0)return s.getSource().type!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),s.getFeatureState(o,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),o=this.map.getTerrain()||void 0,s=this.stylesheet;return c.aG({version:s.version,name:s.name,metadata:s.metadata,light:s.light,sky:s.sky,center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,sprite:s.sprite,glyphs:s.glyphs,transition:s.transition,sources:e,layers:n,terrain:o},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let n=f=>this._layers[f].type==="fill-extrusion",o={},s=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_)){o[_]=f;for(let b of e){let k=b[_];if(k)for(let M of k)s.push(M)}}}s.sort((f,_)=>_.intersectionZ-f.intersectionZ);let h=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_))for(let b=s.length-1;b>=0;b--){let k=s[b].feature;if(o[k.layer.id]<f)break;h.push(k),s.pop()}else for(let b of e){let k=b[_];if(k)for(let M of k)h.push(M.feature)}}return h}queryRenderedFeatures(e,n,o){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);let s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(let _ of n.layers){let b=this._layers[_];if(!b)return this.fire(new c.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];s[b.source]=!0}}let h=[];n.availableImages=this._availableImages;let f=this._serializedAllLayers();for(let _ in this.sourceCaches)n.layers&&!s[_]||h.push(mn(this.sourceCaches[_],this._layers,f,e,n,o));return this.placement&&h.push(function(_,b,k,M,I,z,F){let O={},q=z.queryRenderedSymbols(M),Z=[];for(let G of Object.keys(q).map(Number))Z.push(F[G]);Z.sort(fn);for(let G of Z){let W=G.featureIndex.lookupSymbolFeatures(q[G.bucketInstanceId],b,G.bucketIndex,G.sourceLayerIndex,I.filter,I.layers,I.availableImages,_);for(let V in W){let J=O[V]=O[V]||[],ee=W[V];ee.sort((ne,ue)=>{let _e=G.featureSortOrder;if(_e){let Se=_e.indexOf(ne.featureIndex);return _e.indexOf(ue.featureIndex)-Se}return ue.featureIndex-ne.featureIndex});for(let ne of ee)J.push(ne)}}for(let G in O)O[G].forEach(W=>{let V=W.feature,J=k[_[G].source].getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=J});return O}(this._layers,f,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);let o=this.sourceCaches[e];return o?function(s,h){let f=s.getRenderableIds().map(k=>s.getTileByID(k)),_=[],b={};for(let k=0;k<f.length;k++){let M=f[k],I=M.tileID.canonical.key;b[I]||(b[I]=!0,M.querySourceFeatures(_,h))}return _}(o,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();let o=this.light.getLight(),s=!1;for(let f in e)if(!c.aE(e[f],o[f])){s=!0;break}if(!s)return;let h={now:ge.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){let o=this.getSky(),s=!1;if(!e&&!o)return;if(e&&!o)s=!0;else if(!e&&o)s=!0;else for(let f in e)if(!c.aE(e[f],o[f])){s=!0;break}if(!s)return;let h={now:ge.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,o,s,h={}){return(!h||h.validate!==!1)&&vr(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:o,styleSpec:c.v},s)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Br().off(ye,this._rtlPluginLoaded);for(let n in this._layers)this._layers[n].setEventedParent(null);for(let n in this.sourceCaches){let o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,o,s,h=!1){let f=!1,_=!1,b={};for(let k of this._order){let M=this._layers[k];if(M.type!=="symbol")continue;if(!b[M.source]){let z=this.sourceCaches[M.source];b[M.source]=z.getRenderableIds(!0).map(F=>z.getTileByID(F)).sort((F,O)=>O.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(O.tileID)?-1:1))}let I=this.crossTileSymbolIndex.addLayer(M,b[M.source],e.center.lng);f=f||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ge.now(),e.zoom))&&(this.pauseablePlacement=new mo(e,this.map.terrain,this._order,h,n,o,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ge.now()),_=!0),f&&this.pauseablePlacement.placement.setStale()),_||f)for(let k of this._order){let M=this._layers[k];M.type==="symbol"&&this.placement.updateLayerOpacities(M,b[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ge.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){let o=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();let s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,n.icons),o})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){let o=yield this.glyphManager.getGlyphs(n.stacks),s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,[""]),o})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,o={},s){this._checkLoaded();let h=[{id:e,url:n}],f=[...zr(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",f,null,o)||(this.stylesheet.sprite=f,this._loadSprite(h,!0,s))}removeSprite(e){this._checkLoaded();let n=zr(this.stylesheet.sprite);if(n.find(o=>o.id===e)){if(this._spritesImagesIds[e])for(let o of this._spritesImagesIds[e])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return zr(this.stylesheet.sprite)}setSprite(e,n={},o){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,o):(this._unloadSprite(),o&&o(null)))}}var Nn=c.Y([{name:"a_pos",type:"Int16",components:2}]);let vn={prelude:mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:mt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mt(d,e){let n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=e.match(/attribute ([\w]+) ([\w]+)/g),s=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=h?h.concat(s):s,_={};return{fragmentSource:d=d.replace(n,(b,k,M,I,z)=>(_[z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${M} ${I} ${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = u_${z};
#endif
`)),vertexSource:e=e.replace(n,(b,k,M,I,z)=>{let F=I==="float"?"vec2":"vec4",O=z.match(/color/)?"color":F;return _[z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${M} ${F} a_${z};
varying ${M} ${I} ${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${M} ${F} a_${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = a_${z};
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${M} ${I} ${z} = u_${z};
#endif
`}),staticAttributes:o,staticUniforms:f}}class yl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,o,s,h,f,_,b,k){this.context=e;let M=this.boundPaintVertexBuffers.length!==s.length;for(let I=0;!M&&I<s.length;I++)this.boundPaintVertexBuffers[I]!==s[I]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||M||this.boundIndexBuffer!==h||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==b||this.boundDynamicVertexBuffer3!==k?this.freshBind(n,o,s,h,f,_,b,k):(e.bindVertexArray.set(this.vao),_&&_.bind(),h&&h.dynamicDraw&&h.bind(),b&&b.bind(),k&&k.bind())}freshBind(e,n,o,s,h,f,_,b){let k=e.numAttributes,M=this.context,I=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=s,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=b,n.enableAttributes(I,e);for(let z of o)z.enableAttributes(I,e);f&&f.enableAttributes(I,e),_&&_.enableAttributes(I,e),b&&b.enableAttributes(I,e),n.bind(),n.setVertexAttribPointers(I,e,h);for(let z of o)z.bind(),z.setVertexAttribPointers(I,e,h);f&&(f.bind(),f.setVertexAttribPointers(I,e,h)),s&&s.bind(),_&&(_.bind(),_.setVertexAttribPointers(I,e,h)),b&&(b.bind(),b.setVertexAttribPointers(I,e,h)),M.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let vl=(d,e,n,o,s)=>({u_matrix:d,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:o?o.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?o.calculateFogBlendOpacity(s):0,u_horizon_color:o?o.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1});function ya(d){let e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;let o=d[n].split(" ");e.push(o.pop())}return e}class bl{constructor(e,n,o,s,h,f){let _=e.gl;this.program=_.createProgram();let b=ya(n.staticAttributes),k=o?o.getBinderAttributes():[],M=b.concat(k),I=vn.prelude.staticUniforms?ya(vn.prelude.staticUniforms):[],z=n.staticUniforms?ya(n.staticUniforms):[],F=o?o.getBinderUniforms():[],O=I.concat(z).concat(F),q=[];for(let ne of O)q.indexOf(ne)<0&&q.push(ne);let Z=o?o.defines():[];h&&Z.push("#define OVERDRAW_INSPECTOR;"),f&&Z.push("#define TERRAIN3D;");let G=Z.concat(vn.prelude.fragmentSource,n.fragmentSource).join(`
`),W=Z.concat(vn.prelude.vertexSource,n.vertexSource).join(`
`),V=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(V,G),_.compileShader(V),!_.getShaderParameter(V,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(V)}`);_.attachShader(this.program,V);let J=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(J,W),_.compileShader(J),!_.getShaderParameter(J,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(J)}`);_.attachShader(this.program,J),this.attributes={};let ee={};this.numAttributes=M.length;for(let ne=0;ne<this.numAttributes;ne++)M[ne]&&(_.bindAttribLocation(this.program,ne,M[ne]),this.attributes[M[ne]]=ne);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(J),_.deleteShader(V);for(let ne=0;ne<q.length;ne++){let ue=q[ne];if(ue&&!ee[ue]){let _e=_.getUniformLocation(this.program,ue);_e&&(ee[ue]=_e)}}this.fixedUniforms=s(e,ee),this.terrainUniforms=((ne,ue)=>({u_depth:new c.aH(ne,ue.u_depth),u_terrain:new c.aH(ne,ue.u_terrain),u_terrain_dim:new c.aI(ne,ue.u_terrain_dim),u_terrain_matrix:new c.aJ(ne,ue.u_terrain_matrix),u_terrain_unpack:new c.aK(ne,ue.u_terrain_unpack),u_terrain_exaggeration:new c.aI(ne,ue.u_terrain_exaggeration)}))(e,ee),this.binderUniforms=o?o.getUniforms(e,ee):[]}draw(e,n,o,s,h,f,_,b,k,M,I,z,F,O,q,Z,G,W){let V=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(o),e.setStencilMode(s),e.setColorMode(h),e.setCullFace(f),b){e.activeTexture.set(V.TEXTURE2),V.bindTexture(V.TEXTURE_2D,b.depthTexture),e.activeTexture.set(V.TEXTURE3),V.bindTexture(V.TEXTURE_2D,b.texture);for(let ee in this.terrainUniforms)this.terrainUniforms[ee].set(b[ee])}for(let ee in this.fixedUniforms)this.fixedUniforms[ee].set(_[ee]);q&&q.setUniforms(e,this.binderUniforms,F,{zoom:O});let J=0;switch(n){case V.LINES:J=2;break;case V.TRIANGLES:J=3;break;case V.LINE_STRIP:J=1}for(let ee of z.get()){let ne=ee.vaos||(ee.vaos={});(ne[k]||(ne[k]=new yl)).bind(e,this,M,q?q.getPaintVertexBuffers():[],I,ee.vertexOffset,Z,G,W),V.drawElements(n,ee.primitiveLength*J,V.UNSIGNED_SHORT,ee.primitiveOffset*J*2)}}}function as(d,e,n){let o=1/at(n,1,e.transform.tileZoom),s=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/s,f=h*(n.tileID.canonical.x+n.tileID.wrap*s),_=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}let fo=(d,e,n,o)=>{let s=e.style.light,h=s.properties.get("position"),f=[h.x,h.y,h.z],_=function(){var k=new c.A(9);return c.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();s.properties.get("anchor")==="viewport"&&function(k,M){var I=Math.sin(M),z=Math.cos(M);k[0]=z,k[1]=I,k[2]=0,k[3]=-I,k[4]=z,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(_,-e.transform.angle),function(k,M,I){var z=M[0],F=M[1],O=M[2];k[0]=z*I[0]+F*I[3]+O*I[6],k[1]=z*I[1]+F*I[4]+O*I[7],k[2]=z*I[2]+F*I[5]+O*I[8]}(f,f,_);let b=s.properties.get("color");return{u_matrix:d,u_lightpos:f,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+n,u_opacity:o}},os=(d,e,n,o,s,h,f)=>c.e(fo(d,e,n,o),as(h,e,f),{u_height_factor:-Math.pow(2,s.overscaledZ)/f.tileSize/8}),va=d=>({u_matrix:d}),Bc=(d,e,n,o)=>c.e(va(d),as(n,e,o)),Cd=(d,e)=>({u_matrix:d,u_world:e}),Oc=(d,e,n,o,s)=>c.e(Bc(d,e,n,o),{u_world:s}),Sd=(d,e,n,o)=>{let s=d.transform,h,f;if(o.paint.get("circle-pitch-alignment")==="map"){let _=at(n,1,s.zoom);h=!0,f=[_,_]}else h=!1,f=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:f}},jn=(d,e,n)=>({u_matrix:d,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),go=(d,e,n=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:n}),Di=d=>({u_matrix:d}),zi=(d,e,n,o)=>({u_matrix:d,u_extrude_scale:at(e,1,n),u_intensity:o}),ss=(d,e,n,o)=>{let s=c.H();c.aP(s,0,d.width,d.height,0,0,1);let h=d.context.gl;return{u_matrix:s,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:o,u_opacity:e.paint.get("heatmap-opacity")}};function ls(d,e){let n=Math.pow(2,e.canonical.z),o=e.canonical.y;return[new c.Z(0,o/n).toLngLat().lat,new c.Z(0,(o+1)/n).toLngLat().lat]}let cs=(d,e,n,o)=>{let s=d.transform;return{u_matrix:jc(d,e,n,o),u_ratio:1/at(e,1,s.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Vc=(d,e,n,o,s)=>c.e(cs(d,e,n,s),{u_image:0,u_image_height:o}),ba=(d,e,n,o,s)=>{let h=d.transform,f=Nc(e,h);return{u_matrix:jc(d,e,n,s),u_texsize:e.imageAtlasTexture.size,u_ratio:1/at(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Md=(d,e,n,o,s,h)=>{let f=d.lineAtlas,_=Nc(e,d.transform),b=n.layout.get("line-cap")==="round",k=f.getDash(o.from,b),M=f.getDash(o.to,b),I=k.width*s.fromScale,z=M.width*s.toScale;return c.e(cs(d,e,n,h),{u_patternscale_a:[_/I,-k.height/2],u_patternscale_b:[_/z,-M.height/2],u_sdfgamma:f.width/(256*Math.min(I,z)*d.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:M.y,u_mix:s.t})};function Nc(d,e){return 1/at(d,1,e.tileZoom)}function jc(d,e,n,o){return d.translatePosMatrix(o?o.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let Id=(d,e,n,o,s)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(f=s.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(h=s.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:Td(s.paint.get("raster-hue-rotate"))};var h,f};function Td(d){d*=Math.PI/180;let e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}let qc=(d,e,n,o,s,h,f,_,b,k,M,I,z,F)=>{let O=f.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:O.width/O.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:k,u_is_text:+I,u_pitch_with_map:+o,u_is_along_line:s,u_is_variable_anchor:h,u_texsize:z,u_texture:0,u_translation:M,u_pitched_scale:F}},_o=(d,e,n,o,s,h,f,_,b,k,M,I,z,F,O)=>{let q=f.transform;return c.e(qc(d,e,n,o,s,h,f,_,b,k,M,I,z,O),{u_gamma_scale:o?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+F})},xl=(d,e,n,o,s,h,f,_,b,k,M,I,z,F)=>c.e(_o(d,e,n,o,s,h,f,_,b,k,M,!0,I,!0,F),{u_texsize_icon:z,u_texture_icon:1}),hs=(d,e,n)=>({u_matrix:d,u_opacity:e,u_color:n}),wl=(d,e,n,o,s,h)=>c.e(function(f,_,b,k){let M=b.imageManager.getPattern(f.from.toString()),I=b.imageManager.getPattern(f.to.toString()),{width:z,height:F}=b.imageManager.getPixelSize(),O=Math.pow(2,k.tileID.overscaledZ),q=k.tileSize*Math.pow(2,b.transform.tileZoom)/O,Z=q*(k.tileID.canonical.x+k.tileID.wrap*O),G=q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[z,F],u_mix:_.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/at(k,1,b.transform.tileZoom),u_pixel_coord_upper:[Z>>16,G>>16],u_pixel_coord_lower:[65535&Z,65535&G]}}(o,h,n,s),{u_matrix:d,u_opacity:e}),kl={fillExtrusion:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_opacity:new c.aI(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_height_factor:new c.aI(d,e.u_height_factor),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade),u_opacity:new c.aI(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(d,e.u_scale_with_map),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_extrude_scale:new c.aO(d,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_matrix:new c.aJ(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_pixel_extrude_scale:new c.aO(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_inv_matrix:new c.aJ(d,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_viewport_size:new c.aO(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.aL(d,e.u_color),u_matrix:new c.aJ(d,e.u_matrix),u_overlay:new c.aH(d,e.u_overlay),u_overlay_scale:new c.aI(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new c.aI(d,e.u_extrude_scale),u_intensity:new c.aI(d,e.u_intensity),u_matrix:new c.aJ(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_color_ramp:new c.aH(d,e.u_color_ramp),u_opacity:new c.aI(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_latrange:new c.aO(d,e.u_latrange),u_light:new c.aO(d,e.u_light),u_shadow:new c.aL(d,e.u_shadow),u_highlight:new c.aL(d,e.u_highlight),u_accent:new c.aL(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_dimension:new c.aO(d,e.u_dimension),u_zoom:new c.aI(d,e.u_zoom),u_unpack:new c.aK(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_image:new c.aH(d,e.u_image),u_image_height:new c.aI(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texsize:new c.aO(d,e.u_texsize),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_image:new c.aH(d,e.u_image),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_patternscale_a:new c.aO(d,e.u_patternscale_a),u_patternscale_b:new c.aO(d,e.u_patternscale_b),u_sdfgamma:new c.aI(d,e.u_sdfgamma),u_image:new c.aH(d,e.u_image),u_tex_y_a:new c.aI(d,e.u_tex_y_a),u_tex_y_b:new c.aI(d,e.u_tex_y_b),u_mix:new c.aI(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_tl_parent:new c.aO(d,e.u_tl_parent),u_scale_parent:new c.aI(d,e.u_scale_parent),u_buffer_scale:new c.aI(d,e.u_buffer_scale),u_fade_t:new c.aI(d,e.u_fade_t),u_opacity:new c.aI(d,e.u_opacity),u_image0:new c.aH(d,e.u_image0),u_image1:new c.aH(d,e.u_image1),u_brightness_low:new c.aI(d,e.u_brightness_low),u_brightness_high:new c.aI(d,e.u_brightness_high),u_saturation_factor:new c.aI(d,e.u_saturation_factor),u_contrast_factor:new c.aI(d,e.u_contrast_factor),u_spin_weights:new c.aN(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texsize_icon:new c.aO(d,e.u_texsize_icon),u_texture:new c.aH(d,e.u_texture),u_texture_icon:new c.aH(d,e.u_texture_icon),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),background:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_color:new c.aL(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_image:new c.aH(d,e.u_image),u_pattern_tl_a:new c.aO(d,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(d,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(d,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(d,e.u_pattern_br_b),u_texsize:new c.aO(d,e.u_texsize),u_mix:new c.aI(d,e.u_mix),u_pattern_size_a:new c.aO(d,e.u_pattern_size_a),u_pattern_size_b:new c.aO(d,e.u_pattern_size_b),u_scale_a:new c.aI(d,e.u_scale_a),u_scale_b:new c.aI(d,e.u_scale_b),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_ele_delta:new c.aI(d,e.u_ele_delta),u_fog_matrix:new c.aJ(d,e.u_fog_matrix),u_fog_color:new c.aL(d,e.u_fog_color),u_fog_ground_blend:new c.aI(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon_fog_blend:new c.aI(d,e.u_horizon_fog_blend)}),terrainDepth:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ele_delta:new c.aI(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_terrain_coords_id:new c.aI(d,e.u_terrain_coords_id),u_ele_delta:new c.aI(d,e.u_ele_delta)}),sky:(d,e)=>({u_sky_color:new c.aL(d,e.u_sky_color),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon:new c.aI(d,e.u_horizon),u_sky_horizon_blend:new c.aI(d,e.u_sky_horizon_blend)})};class Nr{constructor(e,n,o){this.context=e;let s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Ed={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cl{constructor(e,n,o,s){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=s,this.context=e;let h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let o=0;o<this.attributes.length;o++){let s=n.attributes[this.attributes[o].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,n,o){for(let s=0;s<this.attributes.length;s++){let h=this.attributes[s],f=n.attributes[h.name];f!==void 0&&e.vertexAttribPointer(f,h.components,e[Ed[h.type]],!1,this.itemSize,h.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let qn=new WeakMap;function bn(d){var e;if(qn.has(d))return qn.get(d);{let n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return qn.set(d,n),n}}class ft{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ds extends ft{getDefault(){return c.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ad extends ft{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class xa extends ft{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Pd extends ft{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Uc extends ft{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Dd extends ft{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class $c extends ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Sl extends ft{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Zc extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Gc extends ft{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Hc extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Wc extends ft{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Un extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Xc extends ft{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class zd extends ft{getDefault(){return c.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kc extends ft{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class yo extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Ld extends ft{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class us extends ft{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Rd extends ft{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Fd extends ft{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Yc extends ft{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Jc extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Qc extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ml extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class eh extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ps extends ft{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rn extends ft{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;let o=this.gl;bn(o)?o.bindVertexArray(e):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Il extends ft{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Tl extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class El extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ms extends ft{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Al extends ms{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class $n extends ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pl extends ms{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Bd{constructor(e,n,o,s,h){this.context=e,this.width=n,this.height=o;let f=e.gl,_=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new Al(e,_),s)this.depthAttachment=h?new Pl(e,_):new $n(e,_);else if(h)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){let o=this.depthAttachment.get();o&&e.deleteRenderbuffer(o)}e.deleteFramebuffer(this.framebuffer)}}class Bt{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}Bt.Replace=[1,0],Bt.disabled=new Bt(Bt.Replace,c.aM.transparent,[!1,!1,!1,!1]),Bt.unblended=new Bt(Bt.Replace,c.aM.transparent,[!0,!0,!0,!0]),Bt.alphaBlended=new Bt([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Od{constructor(e){var n,o;if(this.gl=e,this.clearColor=new ds(this),this.clearDepth=new Ad(this),this.clearStencil=new xa(this),this.colorMask=new Pd(this),this.depthMask=new Uc(this),this.stencilMask=new Dd(this),this.stencilFunc=new $c(this),this.stencilOp=new Sl(this),this.stencilTest=new Zc(this),this.depthRange=new Gc(this),this.depthTest=new Hc(this),this.depthFunc=new Wc(this),this.blend=new Un(this),this.blendFunc=new Xc(this),this.blendColor=new zd(this),this.blendEquation=new Kc(this),this.cullFace=new yo(this),this.cullFaceSide=new Ld(this),this.frontFace=new us(this),this.program=new Rd(this),this.activeTexture=new Fd(this),this.viewport=new Yc(this),this.bindFramebuffer=new Jc(this),this.bindRenderbuffer=new Qc(this),this.bindTexture=new Ml(this),this.bindVertexBuffer=new eh(this),this.bindElementBuffer=new ps(this),this.bindVertexArray=new rn(this),this.pixelStoreUnpack=new Il(this),this.pixelStoreUnpackPremultiplyAlpha=new Tl(this),this.pixelStoreUnpackFlipY=new El(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),bn(e)){this.HALF_FLOAT=e.HALF_FLOAT;let s=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:s?.RGBA16F_EXT,this.RGB16F=(o=e.RGB16F)!==null&&o!==void 0?o:s?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let s=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=s?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Nr(this,e,n)}createVertexBuffer(e,n,o){return new Cl(this,e,n,o)}createRenderbuffer(e,n,o){let s=this.gl,h=s.createRenderbuffer();return this.bindRenderbuffer.set(h),s.renderbufferStorage(s.RENDERBUFFER,e,n,o),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,o,s){return new Bd(this,e,n,o,s)}clear({color:e,depth:n,stencil:o}){let s=this.gl,h=0;e&&(h|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(h|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),s.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Bt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return bn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return bn(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class it{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}it.ReadOnly=!1,it.ReadWrite=!0,it.disabled=new it(519,it.ReadOnly,[0,1]);let fs=7680;class Ct{constructor(e,n,o,s,h,f){this.test=e,this.ref=n,this.mask=o,this.fail=s,this.depthFail=h,this.pass=f}}Ct.disabled=new Ct({func:519,mask:0},0,0,fs,fs,fs);class vt{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}let Zn;function vo(d,e,n,o,s){let h=d.context,f=h.gl,_=d.useProgram("collisionBox"),b=[],k=0,M=0;for(let G=0;G<o.length;G++){let W=o[G],V=e.getTile(W).getBucket(n);if(!V)continue;let J=s?V.textCollisionBox:V.iconCollisionBox,ee=V.collisionCircleArray;if(ee.length>0){let ne=c.H();c.aQ(ne,V.placementInvProjMatrix,d.transform.glCoordMatrix),c.aQ(ne,ne,V.placementViewportMatrix),b.push({circleArray:ee,circleOffset:M,transform:W.posMatrix,invTransform:ne,coord:W}),k+=ee.length/4,M=k}J&&_.draw(h,f.LINES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,{u_matrix:W.posMatrix,u_pixel_extrude_scale:[1/(I=d.transform).width,1/I.height]},d.style.map.terrain&&d.style.map.terrain.getTerrainData(W),n.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,null,d.transform.zoom,null,null,J.collisionVertexBuffer)}var I;if(!s||!b.length)return;let z=d.useProgram("collisionCircle"),F=new c.aR;F.resize(4*k),F._trim();let O=0;for(let G of b)for(let W=0;W<G.circleArray.length/4;W++){let V=4*W,J=G.circleArray[V+0],ee=G.circleArray[V+1],ne=G.circleArray[V+2],ue=G.circleArray[V+3];F.emplace(O++,J,ee,ne,ue,0),F.emplace(O++,J,ee,ne,ue,1),F.emplace(O++,J,ee,ne,ue,2),F.emplace(O++,J,ee,ne,ue,3)}(!Zn||Zn.length<2*k)&&(Zn=function(G){let W=2*G,V=new c.aT;V.resize(W),V._trim();for(let J=0;J<W;J++){let ee=6*J;V.uint16[ee+0]=4*J+0,V.uint16[ee+1]=4*J+1,V.uint16[ee+2]=4*J+2,V.uint16[ee+3]=4*J+2,V.uint16[ee+4]=4*J+3,V.uint16[ee+5]=4*J+0}return V}(k));let q=h.createIndexBuffer(Zn,!0),Z=h.createVertexBuffer(F,c.aS.members,!0);for(let G of b){let W=jn(G.transform,G.invTransform,d.transform);z.draw(h,f.TRIANGLES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,W,d.style.map.terrain&&d.style.map.terrain.getTerrainData(G.coord),n.id,Z,q,c.a0.simpleSegment(0,2*G.circleOffset,G.circleArray.length,G.circleArray.length/2),null,d.transform.zoom,null,null,null)}Z.destroy(),q.destroy()}vt.disabled=new vt(!1,1029,2305),vt.backCCW=new vt(!0,1029,2305);let bo=c.an(new Float32Array(16));function Dl(d,e,n,o,s,h){let{horizontalAlign:f,verticalAlign:_}=c.au(d);return new c.P((-(f-.5)*e/s+o[0])*h,(-(_-.5)*n/s+o[1])*h)}function Gn(d,e,n,o,s,h){let f=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let _=o.mult(h);n||(_=_.rotate(-s));let b=f.add(_);return U(b.x,b.y,e.labelPlaneMatrix,e.getElevation).point}if(n){let _=ce(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),b=Math.atan(_.y/_.x)+(_.x<0?Math.PI:0);return d.add(o.rotate(b))}return d.add(o)}function wa(d,e,n,o,s,h,f,_,b,k,M,I,z,F){let O=d.text.placedSymbolArray,q=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,G={};q.clear();for(let W=0;W<O.length;W++){let V=O.get(W),J=V.hidden||!V.crossTileID||d.allowVerticalPlacement&&!V.placedOrientation?null:o[V.crossTileID];if(J){let ee=new c.P(V.anchorX,V.anchorY),ne={getElevation:F,width:s.width,height:s.height,labelPlaneMatrix:h,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:ee,translation:I,unwrappedTileID:z},ue=n?U(ee.x,ee.y,f,F):ce(ee.x,ee.y,ne),_e=A(s.cameraToCenterDistance,ue.signedDistanceFromCamera),Se=c.ai(d.textSizeData,b,V)*_e/c.ap;n&&(Se*=d.tilePixelRatio/_);let{width:Ee,height:xe,anchor:be,textOffset:Re,textBoxScale:We}=J,ke=Dl(be,Ee,xe,Re,We,Se),Ie=M.getPitchedTextCorrection(s,ee.add(new c.P(I[0],I[1])),z),Ge=Gn(ue.point,ne,e,ke,s.angle,Ie),Tt=d.allowVerticalPlacement&&V.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Qe=0;Qe<V.numGlyphs;Qe++)c.aj(q,Ge,Tt);k&&V.associatedIconIndex>=0&&(G[V.associatedIconIndex]={shiftedAnchor:Ge,angle:Tt})}else je(V.numGlyphs,q)}if(k){Z.clear();let W=d.icon.placedSymbolArray;for(let V=0;V<W.length;V++){let J=W.get(V);if(J.hidden)je(J.numGlyphs,Z);else{let ee=G[V];if(ee)for(let ne=0;ne<J.numGlyphs;ne++)c.aj(Z,ee.shiftedAnchor,ee.angle);else je(J.numGlyphs,Z)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(q)}function ar(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function zl(d,e,n,o,s,h,f,_,b,k,M,I){let z=d.context,F=z.gl,O=d.transform,q=Vn(),Z=_==="map",G=b==="map",W=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",V=Z&&!G&&!W,J=!G&&W,ee=!n.layout.get("symbol-sort-key").isConstant(),ne=!1,ue=d.depthModeForSublayer(0,it.ReadOnly),_e=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],Ee=q.getCircleRadiusCorrection(O);for(let xe of o){let be=e.getTile(xe),Re=be.getBucket(n);if(!Re)continue;let We=s?Re.text:Re.icon;if(!We||!We.segments.get().length||!We.hasVisibleVertices)continue;let ke=We.programConfigurations.get(n.id),Ie=s||Re.sdfIcons,Ge=s?Re.textSizeData:Re.iconSizeData,Tt=G||O.pitch!==0,Qe=d.useProgram(ar(Ie,s,Re),ke),ot=c.ag(Ge,O.zoom),Et=d.style.map.terrain&&d.style.map.terrain.getTerrainData(xe),hi,wr,At,Li,wi=[0,0],di=null;if(s)wr=be.glyphAtlasTexture,At=F.LINEAR,hi=be.glyphAtlasTexture.size,Re.iconsInText&&(wi=be.imageAtlasTexture.size,di=be.imageAtlasTexture,Li=Tt||d.options.rotating||d.options.zooming||Ge.kind==="composite"||Ge.kind==="camera"?F.LINEAR:F.NEAREST);else{let lt=n.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;wr=be.imageAtlasTexture,At=Ie||d.options.rotating||d.options.zooming||lt||Tt?F.LINEAR:F.NEAREST,hi=be.imageAtlasTexture.size}let ki=at(be,1,d.transform.zoom),Ur=J?xe.posMatrix:bo,Oa=yn(Ur,G,Z,d.transform,ki),Ls=Vr(Ur,G,Z,d.transform,ki),Va=Vr(xe.posMatrix,G,Z,d.transform,ki),lr=q.translatePosition(d.transform,be,h,f),Rs=_e&&Re.hasTextData(),nc=n.layout.get("icon-text-fit")!=="none"&&Rs&&Re.hasIconData();if(W){let lt=d.style.map.terrain?(Na,ja)=>d.style.map.terrain.getElevation(xe,Na,ja):null,Yn=n.layout.get("text-rotation-alignment")==="map";B(Re,xe.posMatrix,d,s,Oa,Va,G,k,Yn,q,xe.toUnwrapped(),O.width,O.height,lr,lt)}let cr=xe.posMatrix,hr=s&&_e||nc,xn=W||hr?bo:Oa,kr=Ls,ai=Ie&&n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ui;ui=Ie?Re.iconsInText?xl(Ge.kind,ot,V,G,W,hr,d,cr,xn,kr,lr,hi,wi,Ee):_o(Ge.kind,ot,V,G,W,hr,d,cr,xn,kr,lr,s,hi,!0,Ee):qc(Ge.kind,ot,V,G,W,hr,d,cr,xn,kr,lr,s,hi,Ee);let Yi={program:Qe,buffers:We,uniformValues:ui,atlasTexture:wr,atlasTextureIcon:di,atlasInterpolation:At,atlasInterpolationIcon:Li,isSDF:Ie,hasHalo:ai};if(ee&&Re.canOverlap){ne=!0;let lt=We.segments.get();for(let Yn of lt)Se.push({segments:new c.a0([Yn]),sortKey:Yn.sortKey,state:Yi,terrainData:Et})}else Se.push({segments:We.segments,sortKey:0,state:Yi,terrainData:Et})}ne&&Se.sort((xe,be)=>xe.sortKey-be.sortKey);for(let xe of Se){let be=xe.state;if(z.activeTexture.set(F.TEXTURE0),be.atlasTexture.bind(be.atlasInterpolation,F.CLAMP_TO_EDGE),be.atlasTextureIcon&&(z.activeTexture.set(F.TEXTURE1),be.atlasTextureIcon&&be.atlasTextureIcon.bind(be.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),be.isSDF){let Re=be.uniformValues;be.hasHalo&&(Re.u_is_halo=1,Ll(be.buffers,xe.segments,n,d,be.program,ue,M,I,Re,xe.terrainData)),Re.u_is_halo=0}Ll(be.buffers,xe.segments,n,d,be.program,ue,M,I,be.uniformValues,xe.terrainData)}}function Ll(d,e,n,o,s,h,f,_,b,k){let M=o.context;s.draw(M,M.gl.TRIANGLES,h,f,_,vt.disabled,b,k,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,o.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Rl(d,e,n,o){let s=d.context,h=s.gl,f=Ct.disabled,_=new Bt([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),b=e.getBucket(n);if(!b)return;let k=o.key,M=n.heatmapFbos.get(k);M||(M=xo(s,e.tileSize,e.tileSize),n.heatmapFbos.set(k,M)),s.bindFramebuffer.set(M.framebuffer),s.viewport.set([0,0,e.tileSize,e.tileSize]),s.clear({color:c.aM.transparent});let I=b.programConfigurations.get(n.id),z=d.useProgram("heatmap",I),F=d.style.map.terrain.getTerrainData(o);z.draw(s,h.TRIANGLES,it.disabled,f,_,vt.disabled,zi(o.posMatrix,e,d.transform.zoom,n.paint.get("heatmap-intensity")),F,n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,n.paint,d.transform.zoom,I)}function Hn(d,e,n){let o=d.context,s=o.gl;o.setColorMode(d.colorModeForRenderPass());let h=wo(o,e),f=n.key,_=e.heatmapFbos.get(f);_&&(o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,_.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),h.bind(s.LINEAR,s.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(o,s.TRIANGLES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,ss(d,e,0,1),null,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,d.transform.zoom),_.destroy(),e.heatmapFbos.delete(f))}function xo(d,e,n){var o,s;let h=d.gl,f=h.createTexture();h.bindTexture(h.TEXTURE_2D,f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);let _=(o=d.HALF_FLOAT)!==null&&o!==void 0?o:h.UNSIGNED_BYTE,b=(s=d.RGBA16F)!==null&&s!==void 0?s:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,b,e,n,0,h.RGBA,_,null);let k=d.createFramebuffer(e,n,!1,!1);return k.colorAttachment.set(f),k}function wo(d,e){return e.colorRampTexture||(e.colorRampTexture=new yt(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function ka(d,e,n,o,s){if(!n||!o||!o.imageAtlas)return;let h=o.imageAtlas.patternPositions,f=h[n.to.toString()],_=h[n.from.toString()];if(!f&&_&&(f=_),!_&&f&&(_=f),!f||!_){let b=s.getPaintProperty(e);f=h[b],_=h[b]}f&&_&&d.setConstantPatternPositions(f,_)}function ko(d,e,n,o,s,h,f){let _=d.context.gl,b="fill-pattern",k=n.paint.get(b),M=k&&k.constantOr(1),I=n.getCrossfadeParameters(),z,F,O,q,Z;f?(F=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=_.LINES):(F=M?"fillPattern":"fill",z=_.TRIANGLES);let G=k.constantOr(null);for(let W of o){let V=e.getTile(W);if(M&&!V.patternsLoaded())continue;let J=V.getBucket(n);if(!J)continue;let ee=J.programConfigurations.get(n.id),ne=d.useProgram(F,ee),ue=d.style.map.terrain&&d.style.map.terrain.getTerrainData(W);M&&(d.context.activeTexture.set(_.TEXTURE0),V.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),ee.updatePaintBuffers(I)),ka(ee,b,G,V,n);let _e=ue?W:null,Se=d.translatePosMatrix(_e?_e.posMatrix:W.posMatrix,V,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(f){q=J.indexBuffer2,Z=J.segments2;let Ee=[_.drawingBufferWidth,_.drawingBufferHeight];O=F==="fillOutlinePattern"&&M?Oc(Se,d,I,V,Ee):Cd(Se,Ee)}else q=J.indexBuffer,Z=J.segments,O=M?Bc(Se,d,I,V):va(Se);ne.draw(d.context,z,s,d.stencilModeForClipping(W),h,vt.disabled,O,ue,n.id,J.layoutVertexBuffer,q,Z,n.paint,d.transform.zoom,ee)}}function gs(d,e,n,o,s,h,f){let _=d.context,b=_.gl,k="fill-extrusion-pattern",M=n.paint.get(k),I=M.constantOr(1),z=n.getCrossfadeParameters(),F=n.paint.get("fill-extrusion-opacity"),O=M.constantOr(null);for(let q of o){let Z=e.getTile(q),G=Z.getBucket(n);if(!G)continue;let W=d.style.map.terrain&&d.style.map.terrain.getTerrainData(q),V=G.programConfigurations.get(n.id),J=d.useProgram(I?"fillExtrusionPattern":"fillExtrusion",V);I&&(d.context.activeTexture.set(b.TEXTURE0),Z.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),V.updatePaintBuffers(z)),ka(V,k,O,Z,n);let ee=d.translatePosMatrix(q.posMatrix,Z,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ne=n.paint.get("fill-extrusion-vertical-gradient"),ue=I?os(ee,d,ne,F,q,z,Z):fo(ee,d,ne,F);J.draw(_,_.gl.TRIANGLES,s,h,f,vt.backCCW,ue,W,n.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,n.paint,d.transform.zoom,V,d.style.map.terrain&&G.centroidVertexBuffer)}}function Ca(d,e,n,o,s,h,f){let _=d.context,b=_.gl,k=n.fbo;if(!k)return;let M=d.useProgram("hillshade"),I=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,k.colorAttachment.get()),M.draw(_,b.TRIANGLES,s,h,f,vt.disabled,((z,F,O,q)=>{let Z=O.paint.get("hillshade-shadow-color"),G=O.paint.get("hillshade-highlight-color"),W=O.paint.get("hillshade-accent-color"),V=O.paint.get("hillshade-illumination-direction")*(Math.PI/180);O.paint.get("hillshade-illumination-anchor")==="viewport"&&(V-=z.transform.angle);let J=!z.options.moving;return{u_matrix:q?q.posMatrix:z.transform.calculatePosMatrix(F.tileID.toUnwrapped(),J),u_image:0,u_latrange:ls(0,F.tileID),u_light:[O.paint.get("hillshade-exaggeration"),V],u_shadow:Z,u_highlight:G,u_accent:W}})(d,n,o,I?e:null),I,o.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Sa(d,e,n,o,s,h){let f=d.context,_=f.gl,b=e.dem;if(b&&b.data){let k=b.dim,M=b.stride,I=b.getPixels();if(f.activeTexture.set(_.TEXTURE1),f.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(M),e.demTexture){let F=e.demTexture;F.update(I,{premultiply:!1}),F.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else e.demTexture=new yt(f,I,_.RGBA,{premultiply:!1}),e.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);f.activeTexture.set(_.TEXTURE0);let z=e.fbo;if(!z){let F=new yt(f,{width:k,height:k,data:null},_.RGBA);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),z=e.fbo=f.createFramebuffer(k,k,!0,!1),z.colorAttachment.set(F.texture)}f.bindFramebuffer.set(z.framebuffer),f.viewport.set([0,0,k,k]),d.useProgram("hillshadePrepare").draw(f,_.TRIANGLES,o,s,h,vt.disabled,((F,O)=>{let q=O.stride,Z=c.H();return c.aP(Z,0,c.X,-c.X,0,0,1),c.J(Z,Z,[0,-c.X,0]),{u_matrix:Z,u_image:1,u_dimension:[q,q],u_zoom:F.overscaledZ,u_unpack:O.getUnpackVector()}})(e.tileID,b),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function th(d,e,n,o,s,h){let f=o.paint.get("raster-fade-duration");if(!h&&f>0){let _=ge.now(),b=(_-d.timeAdded)/f,k=e?(_-e.timeAdded)/f:-1,M=n.getSource(),I=s.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),z=!e||Math.abs(e.tileID.overscaledZ-I)>Math.abs(d.tileID.overscaledZ-I),F=z&&d.refreshedUponExpiration?1:c.ac(z?b:1-k,0,1);return d.refreshedUponExpiration&&b>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}let Fl=new c.aM(1,0,0,1),dt=new c.aM(0,1,0,1),_s=new c.aM(0,0,1,1),Vd=new c.aM(1,0,1,1),ih=new c.aM(0,1,1,1);function Ma(d,e,n,o){ys(d,0,e+n/2,d.transform.width,n,o)}function rh(d,e,n,o){ys(d,e-n/2,0,n,d.transform.height,o)}function ys(d,e,n,o,s,h){let f=d.context,_=f.gl;_.enable(_.SCISSOR_TEST),_.scissor(e*d.pixelRatio,n*d.pixelRatio,o*d.pixelRatio,s*d.pixelRatio),f.clear({color:h}),_.disable(_.SCISSOR_TEST)}function nh(d,e,n){let o=d.context,s=o.gl,h=n.posMatrix,f=d.useProgram("debug"),_=it.disabled,b=Ct.disabled,k=d.colorModeForRenderPass(),M="$debug",I=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);o.activeTexture.set(s.TEXTURE0);let z=e.getTileByID(n.key).latestRawTileData,F=Math.floor((z&&z.byteLength||0)/1024),O=e.getTile(n).tileSize,q=512/Math.min(O,512)*(n.overscaledZ/d.transform.zoom)*.5,Z=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Z+=` => ${n.overscaledZ}`),function(G,W){G.initDebugOverlayCanvas();let V=G.debugOverlayCanvas,J=G.context.gl,ee=G.debugOverlayCanvas.getContext("2d");ee.clearRect(0,0,V.width,V.height),ee.shadowColor="white",ee.shadowBlur=2,ee.lineWidth=1.5,ee.strokeStyle="white",ee.textBaseline="top",ee.font="bold 36px Open Sans, sans-serif",ee.fillText(W,5,5),ee.strokeText(W,5,5),G.debugOverlayTexture.update(V),G.debugOverlayTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE)}(d,`${Z} ${F}kB`),f.draw(o,s.TRIANGLES,_,b,Bt.alphaBlended,vt.disabled,go(h,c.aM.transparent,q),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),f.draw(o,s.LINE_STRIP,_,b,k,vt.disabled,go(h,c.aM.red),I,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function ah(d,e,n){let o=d.context,s=o.gl,h=d.colorModeForRenderPass(),f=new it(s.LEQUAL,it.ReadWrite,d.depthRangeFor3D),_=d.useProgram("terrain"),b=e.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,d.width,d.height]);for(let k of n){let M=d.renderToTexture.getTexture(k),I=e.getTerrainData(k.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,M.texture);let z=d.transform.calculatePosMatrix(k.tileID.toUnwrapped()),F=e.getMeshFrameDelta(d.transform.zoom),O=d.transform.calculateFogMatrix(k.tileID.toUnwrapped()),q=vl(z,F,O,d.style.sky,d.transform.pitch);_.draw(o,s.TRIANGLES,f,Ct.disabled,h,vt.backCCW,q,I,"terrain",b.vertexBuffer,b.indexBuffer,b.segments)}}class vs{constructor(e,n,o){this.vertexBuffer=e,this.indexBuffer=n,this.segments=o}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class bs{constructor(e,n){this.context=new Od(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ze.maxUnderzooming+Ze.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _l}resize(e,n,o){if(this.width=Math.floor(e*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let s of this.style._order)this.style._layers[s].resize()}setup(){let e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,Nn.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);let o=new c.aX;o.emplaceBack(0,0),o.emplaceBack(c.X,0),o.emplaceBack(0,c.X),o.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(o,Nn.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);let s=new c.$;s.emplaceBack(0,0,0,0),s.emplaceBack(c.X,0,c.X,0),s.emplaceBack(0,c.X,0,c.X),s.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(s,gn.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);let h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,Nn.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);let f=new c.aZ;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(f);let _=new c.aY;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(_);let b=this.context.gl;this.stencilClearMode=new Ct({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){let e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let o=c.H();c.aP(o,0,this.width,this.height,0,0,1),c.K(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,it.disabled,this.stencilClearMode,Bt.disabled,vt.disabled,Di(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;let o=this.context,s=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Bt.disabled),o.setDepthMode(it.disabled);let h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let f of n){let _=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(f);h.draw(o,s.TRIANGLES,it.disabled,new Ct({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),Bt.disabled,vt.disabled,Di(f.posMatrix),b,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new Ct({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){let n=this.context.gl;return new Ct({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){let n=this.context.gl,o=e.sort((f,_)=>_.overscaledZ-f.overscaledZ),s=o[o.length-1].overscaledZ,h=o[0].overscaledZ-s+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();let f={};for(let _=0;_<h;_++)f[_+s]=new Ct({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[f,o]}return[{[s]:Ct.disabled},o]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Bt([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bt.unblended:Bt.alphaBlended}depthModeForSublayer(e,n,o){if(!this.opaquePassEnabledForLayer())return it.disabled;let s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new it(o||this.context.gl.LEQUAL,n,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ge.now()),this.imageManager.beginFrame();let o=this.style._order,s=this.style.sourceCaches,h={},f={},_={};for(let b in s){let k=s[b];k.used&&k.prepare(this.context),h[b]=k.getVisibleCoordinates(),f[b]=h[b].slice().reverse(),_[b]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<o.length;b++)if(this.style._layers[o[b]].is3D()){this.opaquePassCutoff=b;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let b of o){let k=this.style._layers[b];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;let M=f[k.source];(k.type==="custom"||M.length)&&this.renderLayer(this,s[k.source],k,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(b,k){let M=b.context,I=M.gl,z=((G,W,V)=>({u_sky_color:G.properties.get("sky-color"),u_horizon_color:G.properties.get("horizon-color"),u_horizon:(W.height/2+W.getHorizon())*V,u_sky_horizon_blend:G.properties.get("sky-horizon-blend")*W.height/2*V}))(k,b.style.map.transform,b.pixelRatio),F=new it(I.LEQUAL,it.ReadWrite,[0,1]),O=Ct.disabled,q=b.colorModeForRenderPass(),Z=b.useProgram("sky");if(!k.mesh){let G=new c.aX;G.emplaceBack(-1,-1),G.emplaceBack(1,-1),G.emplaceBack(1,1),G.emplaceBack(-1,1);let W=new c.aY;W.emplaceBack(0,1,2),W.emplaceBack(0,2,3),k.mesh=new vs(M.createVertexBuffer(G,Nn.members),M.createIndexBuffer(W),c.a0.simpleSegment(0,0,G.length,W.length))}Z.draw(M,I.TRIANGLES,F,O,q,vt.disabled,z,void 0,"sky",k.mesh.vertexBuffer,k.mesh.indexBuffer,k.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){let b=this.style._layers[o[this.currentLayer]],k=s[b.source],M=h[b.source];this._renderTileClippingMasks(b,M),this.renderLayer(this,k,b,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){let b=this.style._layers[o[this.currentLayer]],k=s[b.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(b))continue;let M=(b.type==="symbol"?_:f)[b.source];this._renderTileClippingMasks(b,h[b.source]),this.renderLayer(this,k,b,M)}if(this.options.showTileBoundaries){let b=function(k,M){let I=null,z=Object.values(k._layers).flatMap(Z=>Z.source&&!Z.isHidden(M)?[k.sourceCaches[Z.source]]:[]),F=z.filter(Z=>Z.getSource().type==="vector"),O=z.filter(Z=>Z.getSource().type!=="vector"),q=Z=>{(!I||I.getSource().maxzoom<Z.getSource().maxzoom)&&(I=Z)};return F.forEach(Z=>q(Z)),I||O.forEach(Z=>q(Z)),I}(this.style,this.transform.zoom);b&&function(k,M,I){for(let z=0;z<I.length;z++)nh(k,M,I[z])}(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){let k=b.transform.padding;Ma(b,b.transform.height-(k.top||0),3,Fl),Ma(b,k.bottom||0,3,dt),rh(b,k.left||0,3,_s),rh(b,b.transform.width-(k.right||0),3,Vd);let M=b.transform.centerPoint;(function(I,z,F,O){ys(I,z-1,F-10,2,20,O),ys(I,z-10,F-1,20,2,O)})(b,M.x,b.transform.height-M.y,ih)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let n=this.terrainFacilitator.matrix,o=this.transform.modelViewProjectionMatrix,s=this.terrainFacilitator.dirty;s||(s=e?!c.a_(n,o):!c.a$(n,o)),s||(s=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),s&&(c.b0(n,o),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,f){let _=h.context,b=_.gl,k=Bt.unblended,M=new it(b.LEQUAL,it.ReadWrite,[0,1]),I=f.getTerrainMesh(),z=f.sourceCache.getRenderableTiles(),F=h.useProgram("terrainDepth");_.bindFramebuffer.set(f.getFramebuffer("depth").framebuffer),_.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),_.clear({color:c.aM.transparent,depth:1});for(let O of z){let q=f.getTerrainData(O.tileID),Z={u_matrix:h.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_ele_delta:f.getMeshFrameDelta(h.transform.zoom)};F.draw(_,b.TRIANGLES,M,Ct.disabled,k,vt.backCCW,Z,q,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,f){let _=h.context,b=_.gl,k=Bt.unblended,M=new it(b.LEQUAL,it.ReadWrite,[0,1]),I=f.getTerrainMesh(),z=f.getCoordsTexture(),F=f.sourceCache.getRenderableTiles(),O=h.useProgram("terrainCoords");_.bindFramebuffer.set(f.getFramebuffer("coords").framebuffer),_.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),_.clear({color:c.aM.transparent,depth:1}),f.coordsIndex=[];for(let q of F){let Z=f.getTerrainData(q.tileID);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,z.texture);let G={u_matrix:h.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-f.coordsIndex.length)/255,u_texture:0,u_ele_delta:f.getMeshFrameDelta(h.transform.zoom)};O.draw(_,b.TRIANGLES,M,Ct.disabled,k,vt.backCCW,G,Z,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),f.coordsIndex.push(q.tileID.key)}_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,o,s){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(s||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(h,f,_,b,k){if(h.renderPass!=="translucent")return;let M=Ct.disabled,I=h.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(z,F,O,q,Z,G,W,V,J){let ee=F.transform,ne=Vn(),ue=Z==="map",_e=G==="map";for(let Se of z){let Ee=q.getTile(Se),xe=Ee.getBucket(O);if(!xe||!xe.text||!xe.text.segments.get().length)continue;let be=c.ag(xe.textSizeData,ee.zoom),Re=at(Ee,1,F.transform.zoom),We=yn(Se.posMatrix,_e,ue,F.transform,Re),ke=O.layout.get("icon-text-fit")!=="none"&&xe.hasIconData();if(be){let Ie=Math.pow(2,ee.zoom-Ee.tileID.overscaledZ),Ge=F.style.map.terrain?(Qe,ot)=>F.style.map.terrain.getElevation(Se,Qe,ot):null,Tt=ne.translatePosition(ee,Ee,W,V);wa(xe,ue,_e,J,ee,We,Se.posMatrix,Ie,be,ke,ne,Tt,Se.toUnwrapped(),Ge)}}}(b,h,_,f,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),k),_.paint.get("icon-opacity").constantOr(1)!==0&&zl(h,f,_,b,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),M,I),_.paint.get("text-opacity").constantOr(1)!==0&&zl(h,f,_,b,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),M,I),f.map.showCollisionBoxes&&(vo(h,f,_,b,!0),vo(h,f,_,b,!1))})(e,n,o,s,this.style.placement.variableOffsets);break;case"circle":(function(h,f,_,b){if(h.renderPass!=="translucent")return;let k=_.paint.get("circle-opacity"),M=_.paint.get("circle-stroke-width"),I=_.paint.get("circle-stroke-opacity"),z=!_.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(M.constantOr(1)===0||I.constantOr(1)===0))return;let F=h.context,O=F.gl,q=h.depthModeForSublayer(0,it.ReadOnly),Z=Ct.disabled,G=h.colorModeForRenderPass(),W=[];for(let V=0;V<b.length;V++){let J=b[V],ee=f.getTile(J),ne=ee.getBucket(_);if(!ne)continue;let ue=ne.programConfigurations.get(_.id),_e=h.useProgram("circle",ue),Se=ne.layoutVertexBuffer,Ee=ne.indexBuffer,xe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),be={programConfiguration:ue,program:_e,layoutVertexBuffer:Se,indexBuffer:Ee,uniformValues:Sd(h,J,ee,_),terrainData:xe};if(z){let Re=ne.segments.get();for(let We of Re)W.push({segments:new c.a0([We]),sortKey:We.sortKey,state:be})}else W.push({segments:ne.segments,sortKey:0,state:be})}z&&W.sort((V,J)=>V.sortKey-J.sortKey);for(let V of W){let{programConfiguration:J,program:ee,layoutVertexBuffer:ne,indexBuffer:ue,uniformValues:_e,terrainData:Se}=V.state;ee.draw(F,O.TRIANGLES,q,Z,G,vt.disabled,_e,Se,_.id,ne,ue,V.segments,_.paint,h.transform.zoom,J)}})(e,n,o,s);break;case"heatmap":(function(h,f,_,b){if(_.paint.get("heatmap-opacity")===0)return;let k=h.context;if(h.style.map.terrain){for(let M of b){let I=f.getTile(M);f.hasRenderableParent(M)||(h.renderPass==="offscreen"?Rl(h,I,_,M):h.renderPass==="translucent"&&Hn(h,_,M))}k.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(M,I,z,F){let O=M.context,q=O.gl,Z=Ct.disabled,G=new Bt([q.ONE,q.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(W,V,J){let ee=W.gl;W.activeTexture.set(ee.TEXTURE1),W.viewport.set([0,0,V.width/4,V.height/4]);let ne=J.heatmapFbos.get(c.aU);ne?(ee.bindTexture(ee.TEXTURE_2D,ne.colorAttachment.get()),W.bindFramebuffer.set(ne.framebuffer)):(ne=xo(W,V.width/4,V.height/4),J.heatmapFbos.set(c.aU,ne))})(O,M,z),O.clear({color:c.aM.transparent});for(let W=0;W<F.length;W++){let V=F[W];if(I.hasRenderableParent(V))continue;let J=I.getTile(V),ee=J.getBucket(z);if(!ee)continue;let ne=ee.programConfigurations.get(z.id),ue=M.useProgram("heatmap",ne),{zoom:_e}=M.transform;ue.draw(O,q.TRIANGLES,it.disabled,Z,G,vt.disabled,zi(V.posMatrix,J,_e,z.paint.get("heatmap-intensity")),null,z.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,z.paint,M.transform.zoom,ne)}O.viewport.set([0,0,M.width,M.height])}(h,f,_,b):h.renderPass==="translucent"&&function(M,I){let z=M.context,F=z.gl;z.setColorMode(M.colorModeForRenderPass());let O=I.heatmapFbos.get(c.aU);O&&(z.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,O.colorAttachment.get()),z.activeTexture.set(F.TEXTURE1),wo(z,I).bind(F.LINEAR,F.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(z,F.TRIANGLES,it.disabled,Ct.disabled,M.colorModeForRenderPass(),vt.disabled,ss(M,I,0,1),null,I.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,I.paint,M.transform.zoom))}(h,_)})(e,n,o,s);break;case"line":(function(h,f,_,b){if(h.renderPass!=="translucent")return;let k=_.paint.get("line-opacity"),M=_.paint.get("line-width");if(k.constantOr(1)===0||M.constantOr(1)===0)return;let I=h.depthModeForSublayer(0,it.ReadOnly),z=h.colorModeForRenderPass(),F=_.paint.get("line-dasharray"),O=_.paint.get("line-pattern"),q=O.constantOr(1),Z=_.paint.get("line-gradient"),G=_.getCrossfadeParameters(),W=q?"linePattern":F?"lineSDF":Z?"lineGradient":"line",V=h.context,J=V.gl,ee=!0;for(let ne of b){let ue=f.getTile(ne);if(q&&!ue.patternsLoaded())continue;let _e=ue.getBucket(_);if(!_e)continue;let Se=_e.programConfigurations.get(_.id),Ee=h.context.program.get(),xe=h.useProgram(W,Se),be=ee||xe.program!==Ee,Re=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ne),We=O.constantOr(null);if(We&&ue.imageAtlas){let Ge=ue.imageAtlas,Tt=Ge.patternPositions[We.to.toString()],Qe=Ge.patternPositions[We.from.toString()];Tt&&Qe&&Se.setConstantPatternPositions(Tt,Qe)}let ke=Re?ne:null,Ie=q?ba(h,ue,_,G,ke):F?Md(h,ue,_,F,G,ke):Z?Vc(h,ue,_,_e.lineClipsArray.length,ke):cs(h,ue,_,ke);if(q)V.activeTexture.set(J.TEXTURE0),ue.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Se.updatePaintBuffers(G);else if(F&&(be||h.lineAtlas.dirty))V.activeTexture.set(J.TEXTURE0),h.lineAtlas.bind(V);else if(Z){let Ge=_e.gradients[_.id],Tt=Ge.texture;if(_.gradientVersion!==Ge.version){let Qe=256;if(_.stepInterpolant){let ot=f.getSource().maxzoom,Et=ne.canonical.z===ot?Math.ceil(1<<h.transform.maxZoom-ne.canonical.z):1;Qe=c.ac(c.aV(_e.maxLineLength/c.X*1024*Et),256,V.maxTextureSize)}Ge.gradient=c.aW({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:Ge.gradient||void 0,clips:_e.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new yt(V,Ge.gradient,J.RGBA),Ge.version=_.gradientVersion,Tt=Ge.texture}V.activeTexture.set(J.TEXTURE0),Tt.bind(_.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}xe.draw(V,J.TRIANGLES,I,h.stencilModeForClipping(ne),z,vt.disabled,Ie,Re,_.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,_.paint,h.transform.zoom,Se,_e.layoutVertexBuffer2),ee=!1}})(e,n,o,s);break;case"fill":(function(h,f,_,b){let k=_.paint.get("fill-color"),M=_.paint.get("fill-opacity");if(M.constantOr(1)===0)return;let I=h.colorModeForRenderPass(),z=_.paint.get("fill-pattern"),F=h.opaquePassEnabledForLayer()&&!z.constantOr(1)&&k.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===F){let O=h.depthModeForSublayer(1,h.renderPass==="opaque"?it.ReadWrite:it.ReadOnly);ko(h,f,_,b,O,I,!1)}if(h.renderPass==="translucent"&&_.paint.get("fill-antialias")){let O=h.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,it.ReadOnly);ko(h,f,_,b,O,I,!0)}})(e,n,o,s);break;case"fill-extrusion":(function(h,f,_,b){let k=_.paint.get("fill-extrusion-opacity");if(k!==0&&h.renderPass==="translucent"){let M=new it(h.context.gl.LEQUAL,it.ReadWrite,h.depthRangeFor3D);if(k!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))gs(h,f,_,b,M,Ct.disabled,Bt.disabled),gs(h,f,_,b,M,h.stencilModeFor3D(),h.colorModeForRenderPass());else{let I=h.colorModeForRenderPass();gs(h,f,_,b,M,Ct.disabled,I)}}})(e,n,o,s);break;case"hillshade":(function(h,f,_,b){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;let k=h.context,M=h.depthModeForSublayer(0,it.ReadOnly),I=h.colorModeForRenderPass(),[z,F]=h.renderPass==="translucent"?h.stencilConfigForOverlap(b):[{},b];for(let O of F){let q=f.getTile(O);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&h.renderPass==="offscreen"?Sa(h,q,_,M,Ct.disabled,I):h.renderPass==="translucent"&&Ca(h,O,q,_,M,z[O.overscaledZ],I)}k.viewport.set([0,0,h.width,h.height])})(e,n,o,s);break;case"raster":(function(h,f,_,b){if(h.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!b.length)return;let k=h.context,M=k.gl,I=f.getSource(),z=h.useProgram("raster"),F=h.colorModeForRenderPass(),[O,q]=I instanceof en?[{},b]:h.stencilConfigForOverlap(b),Z=q[q.length-1].overscaledZ,G=!h.options.moving;for(let W of q){let V=h.depthModeForSublayer(W.overscaledZ-Z,_.paint.get("raster-opacity")===1?it.ReadWrite:it.ReadOnly,M.LESS),J=f.getTile(W);J.registerFadeDuration(_.paint.get("raster-fade-duration"));let ee=f.findLoadedParent(W,0),ne=f.findLoadedSibling(W),ue=th(J,ee||ne||null,f,_,h.transform,h.style.map.terrain),_e,Se,Ee=_.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;k.activeTexture.set(M.TEXTURE0),J.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(M.TEXTURE1),ee?(ee.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,ee.tileID.overscaledZ-J.tileID.overscaledZ),Se=[J.tileID.canonical.x*_e%1,J.tileID.canonical.y*_e%1]):J.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),J.texture.useMipmap&&k.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let xe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),be=xe?W:null,Re=be?be.posMatrix:h.transform.calculatePosMatrix(W.toUnwrapped(),G),We=Id(Re,Se||[0,0],_e||1,ue,_);I instanceof en?z.draw(k,M.TRIANGLES,V,Ct.disabled,F,vt.disabled,We,xe,_.id,I.boundsBuffer,h.quadTriangleIndexBuffer,I.boundsSegments):z.draw(k,M.TRIANGLES,V,O[W.overscaledZ],F,vt.disabled,We,xe,_.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,o,s);break;case"background":(function(h,f,_,b){let k=_.paint.get("background-color"),M=_.paint.get("background-opacity");if(M===0)return;let I=h.context,z=I.gl,F=h.transform,O=F.tileSize,q=_.paint.get("background-pattern");if(h.isPatternMissing(q))return;let Z=!q&&k.a===1&&M===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==Z)return;let G=Ct.disabled,W=h.depthModeForSublayer(0,Z==="opaque"?it.ReadWrite:it.ReadOnly),V=h.colorModeForRenderPass(),J=h.useProgram(q?"backgroundPattern":"background"),ee=b||F.coveringTiles({tileSize:O,terrain:h.style.map.terrain});q&&(I.activeTexture.set(z.TEXTURE0),h.imageManager.bind(h.context));let ne=_.getCrossfadeParameters();for(let ue of ee){let _e=b?ue.posMatrix:h.transform.calculatePosMatrix(ue.toUnwrapped()),Se=q?wl(_e,M,h,q,{tileID:ue,tileSize:O},ne):hs(_e,M,k),Ee=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ue);J.draw(I,z.TRIANGLES,W,G,V,vt.disabled,Se,Ee,_.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,o,s);break;case"custom":(function(h,f,_){let b=h.context,k=_.implementation;if(h.renderPass==="offscreen"){let M=k.prerender;M&&(h.setCustomLayerDefaults(),b.setColorMode(h.colorModeForRenderPass()),M.call(k,b.gl,h.transform.customLayerMatrix()),b.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),b.setColorMode(h.colorModeForRenderPass()),b.setStencilMode(Ct.disabled);let M=k.renderingMode==="3d"?new it(h.context.gl.LEQUAL,it.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,it.ReadOnly);b.setDepthMode(M),k.render(b.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),b.setDirty(),h.setBaseState(),b.bindFramebuffer.set(null)}})(e,0,o)}}translatePosMatrix(e,n,o,s,h){if(!o[0]&&!o[1])return e;let f=h?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(f){let k=Math.sin(f),M=Math.cos(f);o=[o[0]*M-o[1]*k,o[0]*k+o[1]*M]}let _=[h?o[0]:at(n,o[0],this.transform.zoom),h?o[1]:at(n,o[1],this.transform.zoom),0],b=new Float32Array(16);return c.J(b,e,_),b}saveTileTexture(e){let n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let n=this.imageManager.getPattern(e.from.toString()),o=this.imageManager.getPattern(e.to.toString());return!n||!o}useProgram(e,n){this.cache=this.cache||{};let o=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new bl(this.context,vn[e],n,kl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new yt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class Ia{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o){let s=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{let b=1/(_=c.af([],_,e))[3]/n*s;return c.b1(_,_,[b,b,1/_[3],b])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{let b=function(z,F){var O=F[0],q=F[1],Z=F[2],G=O*O+q*q+Z*Z;return G>0&&(G=1/Math.sqrt(G)),z[0]=F[0]*G,z[1]=F[1]*G,z[2]=F[2]*G,z}([],function(z,F,O){var q=F[0],Z=F[1],G=F[2],W=O[0],V=O[1],J=O[2];return z[0]=Z*J-G*V,z[1]=G*W-q*J,z[2]=q*V-Z*W,z}([],ir([],h[_[0]],h[_[1]]),ir([],h[_[2]],h[_[1]]))),k=-((M=b)[0]*(I=h[_[1]])[0]+M[1]*I[1]+M[2]*I[2]);var M,I;return b.concat(k)});return new Ia(h,f)}}class Ta{constructor(e,n){this.min=e,this.max=n,this.center=function(o,s,h){return o[0]=.5*s[0],o[1]=.5*s[1],o[2]=.5*s[2],o}([],function(o,s,h){return o[0]=s[0]+h[0],o[1]=s[1]+h[1],o[2]=s[2]+h[2],o}([],this.min,this.max))}quadrant(e){let n=[e%2==0,e<2],o=pr(this.min),s=pr(this.max);for(let h=0;h<n.length;h++)o[h]=n[h]?this.min[h]:this.center[h],s[h]=n[h]?this.center[h]:this.max[h];return s[2]=this.max[2],new Ta(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],o=!0;for(let s=0;s<e.planes.length;s++){let h=e.planes[s],f=0;for(let _=0;_<n.length;_++)c.b2(h,n[_])>=0&&f++;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let s=0;s<3;s++){let h=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){let b=e.points[_][s]-this.min[s];h=Math.min(h,b),f=Math.max(f,b)}if(f<0||h>this.max[s]-this.min[s])return 0}return 1}}class Ea{constructor(e=0,n=0,o=0,s=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=o,this.right=s}interpolate(e,n,o){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,o)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,o)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,o)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,o)),this}getCenter(e,n){let o=c.ac((this.left+e-this.right)/2,0,e),s=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(o,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ea(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Bl=85.051129;class Aa{constructor(e,n,o,s,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=s??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ea,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){let e=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new c.A(4);return c.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,s,h){var f=s[0],_=s[1],b=s[2],k=s[3],M=Math.sin(h),I=Math.cos(h);o[0]=f*I+b*M,o[1]=_*I+k*M,o[2]=f*-M+b*I,o[3]=_*-M+k*I}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,o){this._unmodified=!1,this._edgeInsets.interpolate(e,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){let n=[new c.b4(0,e)];if(this._renderWorldCopies){let o=this.pointCoordinate(new c.P(0,0)),s=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),f=this.pointCoordinate(new c.P(0,this.height)),_=Math.floor(Math.min(o.x,s.x,h.x,f.x)),b=Math.floor(Math.max(o.x,s.x,h.x,f.x)),k=1;for(let M=_-k;M<=b+k;M++)M!==0&&n.push(new c.b4(M,e))}return n}coveringTiles(e){var n,o;let s=this.coveringZoomLevel(e),h=s;if(e.minzoom!==void 0&&s<e.minzoom)return[];e.maxzoom!==void 0&&s>e.maxzoom&&(s=e.maxzoom);let f=this.pointCoordinate(this.getCameraPoint()),_=c.Z.fromLngLat(this.center),b=Math.pow(2,s),k=[b*f.x,b*f.y,0],M=[b*_.x,b*_.y,0],I=Ia.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,s),z=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=s);let F=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,O=V=>({aabb:new Ta([V*b,0,0],[(V+1)*b,b,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),q=[],Z=[],G=s,W=e.reparseOverscaled?h:s;if(this._renderWorldCopies)for(let V=1;V<=3;V++)q.push(O(-V)),q.push(O(V));for(q.push(O(0));q.length>0;){let V=q.pop(),J=V.x,ee=V.y,ne=V.fullyVisible;if(!ne){let xe=V.aabb.intersects(I);if(xe===0)continue;ne=xe===2}let ue=e.terrain?k:M,_e=V.aabb.distanceX(ue),Se=V.aabb.distanceY(ue),Ee=Math.max(Math.abs(_e),Math.abs(Se));if(V.zoom===G||Ee>F+(1<<G-V.zoom)-2&&V.zoom>=z){let xe=G-V.zoom,be=k[0]-.5-(J<<xe),Re=k[1]-.5-(ee<<xe);Z.push({tileID:new c.S(V.zoom===G?W:V.zoom,V.wrap,V.zoom,J,ee),distanceSq:es([M[0]-.5-J,M[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(be*be+Re*Re)})}else for(let xe=0;xe<4;xe++){let be=(J<<1)+xe%2,Re=(ee<<1)+(xe>>1),We=V.zoom+1,ke=V.aabb.quadrant(xe);if(e.terrain){let Ie=new c.S(We,V.wrap,We,be,Re),Ge=e.terrain.getMinMaxElevation(Ie),Tt=(n=Ge.minElevation)!==null&&n!==void 0?n:this.elevation,Qe=(o=Ge.maxElevation)!==null&&o!==void 0?o:this.elevation;ke=new Ta([ke.min[0],ke.min[1],Tt],[ke.max[0],ke.max[1],Qe])}q.push({aabb:ke,zoom:We,x:be,y:Re,wrap:V.wrap,fullyVisible:ne})}}return Z.sort((V,J)=>V.distanceSq-J.distanceSq).map(V=>V.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let n=c.ac(e.lat,-85.051129,Bl);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let n=this.elevation,o=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,s=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-h))return;let f=o+n-h,_=Math.cos(this._pitch)*this.cameraToCenterDistance/f/c.b5(1,s.lat),b=this.scaleZoom(_/this.tileSize);this._elevation=h,this._center=s,this.zoom=b}setLocationAtPoint(e,n){let o=this.pointCoordinate(n),s=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),f=new c.Z(h.x-(o.x-s.x),h.y-(o.y-s.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){let z=n.pointCoordinate(e);if(z!=null)return z}let o=[e.x,e.y,0,1],s=[e.x,e.y,1,1];c.af(o,o,this.pixelMatrixInverse),c.af(s,s,this.pixelMatrixInverse);let h=o[3],f=s[3],_=o[1]/h,b=s[1]/f,k=o[2]/h,M=s[2]/f,I=k===M?0:(0-k)/(M-k);return new c.Z(c.y.number(o[0]/h,s[0]/f,I)/this.worldSize,c.y.number(_,b,I)/this.worldSize)}coordinatePoint(e,n=0,o=this.pixelMatrix){let s=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(s,s,o),new c.P(s[0]/s[3],s[1]/s[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new oe().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new oe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Bl])}calculateTileMatrix(e){let n=e.canonical,o=this.worldSize/this.zoomScale(n.z),s=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[s*o,n.y*o,0]),c.K(h,h,[o/c.X,o/c.X,1]),h}calculatePosMatrix(e,n=!1){let o=e.key,s=n?this._alignedPosMatrixCache:this._posMatrixCache;if(s[o])return s[o];let h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),s[o]=new Float32Array(h),s[o]}calculateFogMatrix(e){let n=e.key,o=this._fogMatrixCache;if(o[n])return o[n];let s=this.calculateTileMatrix(e);return c.L(s,this.fogMatrix,s),o[n]=new Float32Array(s),o[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);let o={center:new c.N(e.lng,e.lat),zoom:n},s=this.lngRange;if(!this._renderWorldCopies&&s===null){let V=179.9999999999;s=[-V,V]}let h=this.tileSize*this.zoomScale(o.zoom),f=0,_=h,b=0,k=h,M=0,I=0,{x:z,y:F}=this.size;if(this.latRange){let V=this.latRange;f=c.Q(V[1])*h,_=c.Q(V[0])*h,_-f<F&&(M=F/(_-f))}s&&(b=c.b3(c.O(s[0])*h,0,h),k=c.b3(c.O(s[1])*h,0,h),k<b&&(k+=h),k-b<z&&(I=z/(k-b)));let{x:O,y:q}=this.project.call({worldSize:h},e),Z,G,W=Math.max(I||0,M||0);if(W){let V=new c.P(I?(k+b)/2:O,M?(_+f)/2:q);return o.center=this.unproject.call({worldSize:h},V).wrap(),o.zoom+=this.scaleZoom(W),o}if(this.latRange){let V=F/2;q-V<f&&(G=f+V),q+V>_&&(G=_-V)}if(s){let V=(b+k)/2,J=O;this._renderWorldCopies&&(J=c.b3(O,V-h/2,V+h/2));let ee=z/2;J-ee<b&&(Z=b+ee),J+ee>k&&(Z=k-ee)}if(Z!==void 0||G!==void 0){let V=new c.P(Z??O,G??q);o.center=this.unproject.call({worldSize:h},V).wrap()}return o}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:n,zoom:o}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=o,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let s=c.an(new Float64Array(16));c.K(s,s,[this.width/2,-this.height/2,1]),c.J(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=c.an(new Float64Array(16)),c.K(s,s,[1,-1,1]),c.J(s,s,[-1,-1,0]),c.K(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s;let h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),f=Math.min(this.elevation,this.minElevationForCurrentTile),_=h-f*this._pixelPerMeter/Math.cos(this._pitch),b=f<0?_:h,k=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),I=Math.sin(M)*b/Math.sin(c.ac(Math.PI-k-M,.01,Math.PI-.01)),z=this.getHorizon(),F=2*Math.atan(z/this.cameraToCenterDistance)*(.5+e.y/(2*z)),O=Math.sin(F)*b/Math.sin(c.ac(Math.PI-k-F,.01,Math.PI-.01)),q=Math.min(I,O);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*q+b),this.nearZ=this.height/50,s=new Float64Array(16),c.b6(s,this._fov,this.width/this.height,this.nearZ,this.farZ),s[8]=2*-e.x/this.width,s[9]=2*e.y/this.height,this.projectionMatrix=c.ae(s),c.K(s,s,[1,-1,1]),c.J(s,s,[0,0,-this.cameraToCenterDistance]),c.b7(s,s,this._pitch),c.ad(s,s,this.angle),c.J(s,s,[-n,-o,0]),this.mercatorMatrix=c.K([],s,[this.worldSize,this.worldSize,this.worldSize]),c.K(s,s,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,s),c.J(s,s,[0,0,-this.elevation]),this.modelViewProjectionMatrix=s,this.invModelViewProjectionMatrix=c.as([],s),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-o,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,s);let Z=this.width%2/2,G=this.height%2/2,W=Math.cos(this.angle),V=Math.sin(this.angle),J=n-Math.round(n)+W*Z+V*G,ee=o-Math.round(o)+W*G+V*Z,ne=new Float64Array(s);if(c.J(ne,ne,[J>.5?J-1:J,ee>.5?ee-1:ee,0]),this.alignedModelViewProjectionMatrix=ne,s=c.as(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){let n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let o=n.x,s=n.y,h=n.x,f=n.y;for(let _ of e)o=Math.min(o,_.x),s=Math.min(s,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return[new c.P(o,s),new c.P(h,s),new c.P(h,f),new c.P(o,f),new c.P(o,s)]}}lngLatToCameraDepth(e,n){let o=this.locationCoordinate(e),s=[o.x*this.worldSize,o.y*this.worldSize,n,1];return c.af(s,s,this.modelViewProjectionMatrix),s[2]/s[3]}}function Co(d,e){let n,o=!1,s=null,h=null,f=()=>{s=null,o&&(d.apply(h,n),s=setTimeout(f,e),o=!1)};return(..._)=>(o=!0,h=this,n=_,s||f(),s)}class xs{constructor(e){this._getCurrentHash=()=>{let n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(o=s)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{let n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){let o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{let n=this._getCurrentHash();if(n.length===0)return;let o=n.join("/"),s=o;s.split("&").length>0&&(s=s.split("&")[0]),this._hashName&&(s=`${this._hashName}=${o}`);let h=window.location.hash.replace(s,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let f=window.location.href.replace(/(#.+)?$/,h);f=f.replace("&&","&"),window.history.replaceState(window.history.state,null,f)},this._updateHash=Co(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,s=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,s),f=Math.round(n.lng*h)/h,_=Math.round(n.lat*h)/h,b=this._map.getBearing(),k=this._map.getPitch(),M="";if(M+=e?`/${f}/${_}/${o}`:`${o}/${_}/${f}`,(b||k)&&(M+="/"+Math.round(10*b)/10),k&&(M+=`/${Math.round(k)}`),this._hashName){let I=this._hashName,z=!1,F=window.location.hash.slice(1).split("&").map(O=>{let q=O.split("=")[0];return q===I?(z=!0,`${q}=${M}`):O}).filter(O=>O);return z||F.push(`${I}=${M}`),`#${F.join("&")}`}return`#${M}`}}let ws={linearity:.3,easing:c.b8(0,0,.3,1)},Ol=c.e({deceleration:2500,maxSpeed:1400},ws),Nd=c.e({deceleration:20,maxSpeed:1400},ws),oh=c.e({deceleration:1e3,maxSpeed:360},ws),ks=c.e({deceleration:1e3,maxSpeed:90},ws);class Vl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ge.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=ge.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){let h=Mo(n.pan.mag(),o,c.e({},Ol,e||{}));s.offset=n.pan.mult(h.amount/n.pan.mag()),s.center=this._map.transform.center,So(s,h)}if(n.zoom){let h=Mo(n.zoom,o,Nd);s.zoom=this._map.transform.zoom+h.amount,So(s,h)}if(n.bearing){let h=Mo(n.bearing,o,oh);s.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),So(s,h)}if(n.pitch){let h=Mo(n.pitch,o,ks);s.pitch=this._map.transform.pitch+h.amount,So(s,h)}if(s.zoom||s.bearing){let h=n.pinchAround===void 0?n.around:n.pinchAround;s.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(s,{noMoveStart:!0})}}function So(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function Mo(d,e,n){let{maxSpeed:o,linearity:s,deceleration:h}=n,f=c.ac(d*s/(e/1e3),-o,o),_=Math.abs(f)/(h*s);return{easing:n.easing,duration:1e3*_,amount:f*(_/2)}}class ci extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o,s={}){let h=le.mousePos(n.getCanvas(),o),f=n.unproject(h);super(e,c.e({point:h,lngLat:f,originalEvent:o},s)),this._defaultPrevented=!1,this.target=n}}class Wn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){let s=e==="touchend"?o.changedTouches:o.touches,h=le.touchPos(n.getCanvasContainer(),s),f=h.map(b=>n.unproject(b)),_=h.reduce((b,k,M,I)=>b.add(k.div(I.length)),new c.P(0,0));super(e,{points:h,point:_,lngLats:f,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}}class sh extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){super(e,{originalEvent:o}),this._defaultPrevented=!1}}class lh{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new sh(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ci(e.type,this._map,e))}mouseup(e){this._map.fire(new ci(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ci(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ci(e.type,this._map,e))}mouseover(e){this._map.fire(new ci(e.type,this._map,e))}mouseout(e){this._map.fire(new ci(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Wn(e.type,this._map,e))}touchmove(e){this._map.fire(new Wn(e.type,this._map,e))}touchend(e){this._map.fire(new Wn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Wn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ot{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ci(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ci("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ci(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class br{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Xi{constructor(e,n){this._map=e,this._tr=new br(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(le.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;let s=this._startPos;this._lastPos=o,this._box||(this._box=le.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let h=Math.min(s.x,o.x),f=Math.max(s.x,o.x),_=Math.min(s.y,o.y),b=Math.max(s.y,o.y);le.setTransform(this._box,`translate(${h}px,${_}px)`),this._box.style.width=f-h+"px",this._box.style.height=b-_+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;let o=this._startPos,s=n;if(this.reset(),le.suppressClick(),o.x!==s.x||o.y!==s.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(o,s,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(le.remove(this._box),this._box=null),le.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function Io(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);let n={};for(let o=0;o<d.length;o++)n[d[o].identifier]=e[o];return n}class Nl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),o.length===this.numTouches&&(this.centroid=function(s){let h=new c.P(0,0);for(let f of s)h._add(f);return h.div(s.length)}(n),this.touches=Io(o,n)))}touchmove(e,n,o){if(this.aborted||!this.centroid)return;let s=Io(o,n);for(let h in this.touches){let f=s[h];(!f||f.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,o){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class Cs{constructor(e){this.singleTap=new Nl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,o){this.singleTap.touchstart(e,n,o)}touchmove(e,n,o){this.singleTap.touchmove(e,n,o)}touchend(e,n,o){let s=this.singleTap.touchend(e,n,o);if(s){let h=e.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(s)<30;if(h&&f||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class Pa{constructor(e){this._tr=new br(e),this._zoomIn=new Cs({numTouches:1,numTaps:2}),this._zoomOut=new Cs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,o){this._zoomIn.touchstart(e,n,o),this._zoomOut.touchstart(e,n,o)}touchmove(e,n,o){this._zoomIn.touchmove(e,n,o),this._zoomOut.touchmove(e,n,o)}touchend(e,n,o){let s=this._zoomIn.touchend(e,n,o),h=this._zoomOut.touchend(e,n,o),f=this._tr;return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom+1,around:f.unproject(s)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom-1,around:f.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;let o=this._lastPoint;if(!o)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let s=n.length?n[0]:n;return!this._moved&&s.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=s,this._move(o,s))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&le.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let jl={0:1,2:2};class Ss{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let n=le.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,o){let s=jl[o];return n.buttons===void 0||(n.buttons&s)!==s}(e,this._eventButton)}isValidEndEvent(e){return le.mouseButton(e)===this._eventButton}}class ql{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let Ms=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}},Ul=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{let o=new Ss({checkCorrectEvent:s=>le.mouseButton(s)===0&&s.ctrlKey||le.mouseButton(s)===2});return new nn({clickTolerance:e,move:(s,h)=>({bearingDelta:(h.x-s.x)*n}),moveStateManager:o,enable:d,assignEvents:Ms})},$l=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{let o=new Ss({checkCorrectEvent:s=>le.mouseButton(s)===0&&s.ctrlKey||le.mouseButton(s)===2});return new nn({clickTolerance:e,move:(s,h)=>({pitchDelta:(h.y-s.y)*n}),moveStateManager:o,enable:d,assignEvents:Ms})};class Xn{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,o){return this._calculateTransform(e,n,o)}touchmove(e,n,o){if(this._active){if(!this._shouldBePrevented(o.length))return e.preventDefault(),this._calculateTransform(e,n,o);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,o){this._calculateTransform(e,n,o),this._active&&this._shouldBePrevented(o.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,o){o.length>0&&(this._active=!0);let s=Io(o,n),h=new c.P(0,0),f=new c.P(0,0),_=0;for(let k in s){let M=s[k],I=this._touches[k];I&&(h._add(M),f._add(M.sub(I)),_++,s[k]=M)}if(this._touches=s,this._shouldBePrevented(_)||!f.mag())return;let b=f.div(_);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(_),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Is{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,o){if(!this._firstTwoTouches)return;e.preventDefault();let[s,h]=this._firstTwoTouches,f=To(o,n,s),_=To(o,n,h);if(!f||!_)return;let b=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],b,e)}touchend(e,n,o){if(!this._firstTwoTouches)return;let[s,h]=this._firstTwoTouches,f=To(o,n,s),_=To(o,n,h);f&&_||(this._active&&le.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function To(d,e,n){for(let o=0;o<d.length;o++)if(d[o].identifier===n)return e[o]}function Zl(d,e){return Math.log(d/e)/Math.LN2}class Gl extends Is{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let o=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Zl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zl(this._distance,o),pinchAround:n}}}function Hl(d,e){return 180*d.angleWith(e)/Math.PI}class Wl extends Is{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,o){let s=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hl(this._vector,s),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,o=Hl(e,this._startVector);return Math.abs(o)<n}}function Ts(d){return Math.abs(d.y)>Math.abs(d.x)}class Da extends Is{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,o){super.touchstart(e,n,o),this._currentTouchCount=o.length}_start(e){this._lastPoints=e,Ts(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,o){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let s=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(s,h,o.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,o){if(this._valid!==void 0)return this._valid;let s=e.mag()>=2,h=n.mag()>=2;if(!s&&!h)return;if(!s||!h)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;let f=e.y>0==n.y>0;return Ts(e)&&Ts(n)&&f}}let ch={panStep:100,bearingStep:15,pitchStep:10};class or{constructor(e){this._tr=new br(e);let n=ch;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,o=0,s=0,h=0,f=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?o=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?o=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),f=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(o=0,s=0),{cameraAnimation:_=>{let b=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:jr,zoom:n?Math.round(b.zoom)+n*(e.shiftKey?2:1):b.zoom,bearing:b.bearing+o*this._bearingStep,pitch:b.pitch+s*this._pitchStep,offset:[-h*this._panStep,-f*this._panStep],center:b.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jr(d){return d*(2-d)}let Xl=4.000244140625;class xr{constructor(e,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=e,this._tr=new br(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=ge.now(),s=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Xl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=le.mousePos(this._map.getCanvas(),e),o=this._tr;this._around=n.y>o.transform.height/2-o.transform.getHorizon()?c.N.convert(this._aroundCenter?o.center:o.unproject(n)):c.N.convert(o.center),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let b=this._type==="wheel"&&Math.abs(this._delta)>Xl?this._wheelZoomRate:this._defaultZoomRate,k=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&k!==0&&(k=1/k);let M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*k))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,o=this._startZoom,s=this._easing,h,f=!1,_=ge.now()-this._lastWheelEventTime;if(this._type==="wheel"&&o&&s&&_){let b=Math.min(_/200,1),k=s(b);h=c.y.number(o,n,k),b<1?this._frameId||(this._frameId=!0):f=!0}else h=n,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){let o=this._prevEase,s=(ge.now()-o.start)/o.duration,h=o.easing(s+.01)-o.easing(s),f=.27/Math.sqrt(h*h+1e-4)*.01,_=Math.sqrt(.0729-f*f);n=c.b8(f,_,.25,1)}return this._prevEase={start:ge.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kn{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jd{constructor(e){this._tr=new br(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qd{constructor(){this._tap=new Cs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,o){if(!this._swipePoint)if(this._tapTime){let s=n[0],h=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(s)<30;h&&f?o.length>0&&(this._swipePoint=s,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(e,n,o)}touchmove(e,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let s=n[0],h=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,o)}touchend(e,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{let s=this._tap.touchend(e,n,o);s&&(this._tapTime=e.timeStamp,this._tapPoint=s)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(e,n,o){this._el=e,this._mousePan=n,this._touchPan=o}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dh{constructor(e,n,o){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Kl{constructor(e,n,o,s){this._el=e,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class za{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=le.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let o=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),s=document.createElement("div");s.className="maplibregl-desktop-message",s.textContent=n,this._container.appendChild(s);let h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=o,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(le.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let sr=d=>d.zoom||d.drag||d.pitch||d.rotate;class Pe extends c.k{}function Es(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Yl{constructor(e,n){this.handleWindowEvent=s=>{this.handleEvent(s,`${s.type}Window`)},this.handleEvent=(s,h)=>{if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let f=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},b={},k={},M=s.touches,I=M?this._getMapTouches(M):void 0,z=I?le.touchPos(this._map.getCanvas(),I):le.mousePos(this._map.getCanvas(),s);for(let{handlerName:q,handler:Z,allowed:G}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(k,G,q)?Z.reset():Z[h||s.type]&&(W=Z[h||s.type](s,z,I),this.mergeHandlerResult(_,b,W,q,f),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(k[q]=Z)}let F={};for(let q in this._previousActiveHandlers)k[q]||(F[q]=f);this._previousActiveHandlers=k,(Object.keys(F).length||Es(_))&&(this._changes.push([_,b,F]),this._triggerRenderFrame()),(Object.keys(k).length||Es(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(let[s,h,f]of this._listeners)le.addEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(let[e,n,o]of this._listeners)le.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(e){let n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new lh(n,e));let s=n.boxZoom=new Xi(n,e);this._add("boxZoom",s),e.interactive&&e.boxZoom&&s.enable();let h=n.cooperativeGestures=new za(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();let f=new Pa(n),_=new jd(n);n.doubleClickZoom=new Kn(_,f),this._add("tapZoom",f),this._add("clickZoom",_),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();let b=new qd;this._add("tapDragZoom",b);let k=n.touchPitch=new Da(n);this._add("touchPitch",k),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);let M=Ul(e),I=$l(e);n.dragRotate=new dh(e,M,I),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();let z=(({enable:W,clickTolerance:V})=>{let J=new Ss({checkCorrectEvent:ee=>le.mouseButton(ee)===0&&!ee.ctrlKey});return new nn({clickTolerance:V,move:(ee,ne)=>({around:ne,panDelta:ne.sub(ee)}),activateOnStart:!0,moveStateManager:J,enable:W,assignEvents:Ms})})(e),F=new Xn(e,n);n.dragPan=new hh(o,z,F),this._add("mousePan",z),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);let O=new Wl,q=new Gl;n.touchZoomRotate=new Kl(o,q,O,b),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);let Z=n.scrollZoom=new xr(n,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);let G=n.keyboard=new or(n);this._add("keyboard",G),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Ot(n))}_add(e,n,o){this._handlers.push({handlerName:e,handler:n,allowed:o}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,o){for(let s in e)if(s!==o&&(!n||n.indexOf(s)<0))return!0;return!1}_getMapTouches(e){let n=[];for(let o of e)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(e,n,o,s,h){if(!o)return;c.e(e,o);let f={handlerName:s,originalEvent:o.originalEvent||h};o.zoomDelta!==void 0&&(n.zoom=f),o.panDelta!==void 0&&(n.drag=f),o.pitchDelta!==void 0&&(n.pitch=f),o.bearingDelta!==void 0&&(n.rotate=f)}_applyChanges(){let e={},n={},o={};for(let[s,h,f]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(e.around=s.around),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),c.e(n,h),c.e(o,f);this._updateMapTransform(e,n,o),this._changes=[]}_updateMapTransform(e,n,o){let s=this._map,h=s._getTransformForUpdate(),f=s.terrain;if(!(Es(e)||f&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:b,bearingDelta:k,pitchDelta:M,around:I,pinchAround:z}=e;z!==void 0&&(I=z),s._stop(!0),I=I||s.transform.centerPoint;let F=h.pointLocation(_?I.sub(_):I);k&&(h.bearing+=k),M&&(h.pitch+=M),b&&(h.zoom+=b),f?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(_)):h.setLocationAtPoint(F,I):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(F,I)):h.setLocationAtPoint(F,I),s._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,o,!0)}_fireEvents(e,n,o){let s=sr(this._eventsInProgress),h=sr(e),f={};for(let I in e){let{originalEvent:z}=e[I];this._eventsInProgress[I]||(f[`${I}start`]=z),this._eventsInProgress[I]=e[I]}!s&&h&&this._fireEvent("movestart",h.originalEvent);for(let I in f)this._fireEvent(I,f[I]);h&&this._fireEvent("move",h.originalEvent);for(let I in e){let{originalEvent:z}=e[I];this._fireEvent(I,z)}let _={},b;for(let I in this._eventsInProgress){let{handlerName:z,originalEvent:F}=this._eventsInProgress[I];this._handlersById[z].isActive()||(delete this._eventsInProgress[I],b=n[z]||F,_[`${I}end`]=b)}for(let I in _)this._fireEvent(I,_[I]);let k=sr(this._eventsInProgress),M=(s||h)&&!k;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let I=this._map._getTransformForUpdate();I.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(I)}if(o&&M){this._updatingCamera=!0;let I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!I||!I.essential&&ge.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:b})),z(this._map.getBearing())&&this._map.resetNorth()):(z(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:b})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Pe("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class uh extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{let o=Math.min((ge.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,o){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),o)}panTo(e,n,o){return this.easeTo(c.e({center:e},n),o)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,o){return this.easeTo(c.e({zoom:e},n),o)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,o){return this.easeTo(c.e({bearing:e},n),o)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=oe.convert(e).adjustAntiMeridian();let o=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),o,n)}_cameraForBoxAndBearing(e,n,o,s){let h={top:0,bottom:0,right:0,left:0};if(typeof(s=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){let xe=s.padding;s.padding={top:xe,bottom:xe,right:xe,left:xe}}s.padding=c.e(h,s.padding);let f=this.transform,_=f.padding,b=new oe(e,n),k=f.project(b.getNorthWest()),M=f.project(b.getNorthEast()),I=f.project(b.getSouthEast()),z=f.project(b.getSouthWest()),F=c.ba(-o),O=k.rotate(F),q=M.rotate(F),Z=I.rotate(F),G=z.rotate(F),W=new c.P(Math.max(O.x,q.x,G.x,Z.x),Math.max(O.y,q.y,G.y,Z.y)),V=new c.P(Math.min(O.x,q.x,G.x,Z.x),Math.min(O.y,q.y,G.y,Z.y)),J=W.sub(V),ee=(f.width-(_.left+_.right+s.padding.left+s.padding.right))/J.x,ne=(f.height-(_.top+_.bottom+s.padding.top+s.padding.bottom))/J.y;if(ne<0||ee<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ue=Math.min(f.scaleZoom(f.scale*Math.min(ee,ne)),s.maxZoom),_e=c.P.convert(s.offset),Se=new c.P((s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2).rotate(c.ba(o)),Ee=_e.add(Se).mult(f.scale/f.zoomScale(ue));return{center:f.unproject(k.add(I).div(2).sub(Ee)),zoom:ue,bearing:o}}fitBounds(e,n,o){return this._fitInternal(this.cameraForBounds(e,n),n,o)}fitScreenCoordinates(e,n,o,s,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),o,s),s,h)}_fitInternal(e,n,o){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(e,n){this.stop();let o=this._getTransformForUpdate(),s=!1,h=!1,f=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(s=!0,o.zoom=+e.zoom),e.center!==void 0&&(o.center=c.N.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(h=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(f=!0,o.pitch=+e.pitch),e.padding==null||o.isPaddingEqual(e.padding)||(o.padding=e.padding),this._applyUpdatedTransform(o),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),s&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),f&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,o,s=0){let h=c.Z.fromLngLat(e,n),f=c.Z.fromLngLat(o,s),_=f.x-h.x,b=f.y-h.y,k=f.z-h.z,M=Math.hypot(_,b,k);if(M===0)throw new Error("Can't calculate camera options with same From and To");let I=Math.hypot(_,b),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),F=180*Math.atan2(_,-b)/Math.PI,O=180*Math.acos(I/M)/Math.PI;return O=k<0?90-O:90+O,{center:f.toLngLat(),zoom:z,pitch:O,bearing:F}}easeTo(e,n){var o;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);let s=this._getTransformForUpdate(),h=s.zoom,f=s.bearing,_=s.pitch,b=s.padding,k="bearing"in e?this._normalizeBearing(e.bearing,f):f,M="pitch"in e?+e.pitch:_,I="padding"in e?e.padding:s.padding,z=c.P.convert(e.offset),F=s.centerPoint.add(z),O=s.pointLocation(F),{center:q,zoom:Z}=s.getConstrained(c.N.convert(e.center||O),(o=e.zoom)!==null&&o!==void 0?o:h);this._normalizeCenter(q,s);let G=s.project(O),W=s.project(q).sub(G),V=s.zoomScale(Z-h),J,ee;e.around&&(J=c.N.convert(e.around),ee=s.locationPoint(J));let ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==h,this._rotating=this._rotating||f!==k,this._pitching=this._pitching||M!==_,this._padding=!s.isPaddingEqual(I),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,ne),this.terrain&&this._prepareElevation(q),this._ease(ue=>{if(this._zooming&&(s.zoom=c.y.number(h,Z,ue)),this._rotating&&(s.bearing=c.y.number(f,k,ue)),this._pitching&&(s.pitch=c.y.number(_,M,ue)),this._padding&&(s.interpolatePadding(b,I,ue),F=s.centerPoint.add(z)),this.terrain&&!e.freezeElevation&&this._updateElevation(ue),J)s.setLocationAtPoint(J,ee);else{let _e=s.zoomScale(s.zoom-h),Se=Z>h?Math.min(2,V):Math.max(.5,V),Ee=Math.pow(Se,1-ue),xe=s.unproject(G.add(W.mult(ue*Ee)).mult(_e));s.setLocationAtPoint(s.renderWorldCopies?xe.wrap():xe,F)}this._applyUpdatedTransform(s),this._fireMoveEvents(n)},ue=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ue)},e),this}_prepareEase(e,n,o={}){this._moving=!0,n||o.moving||this.fire(new c.k("movestart",e)),this._zooming&&!o.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!o.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!o.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){let o=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(o-(n-(o*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){let n=e.getCameraPosition(),o=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<o){let s=this.calculateCameraOptionsFromTo(n.lngLat,o,e.center,e.elevation);return{pitch:s.pitch,zoom:s.zoom}}return{}}_applyUpdatedTransform(e){let n=[];if(this.terrain&&n.push(s=>this._elevateCameraIfInsideTerrain(s)),this.transformCameraUpdate&&n.push(s=>this.transformCameraUpdate(s)),!n.length)return;let o=e.clone();for(let s of n){let h=o.clone(),{center:f,zoom:_,pitch:b,bearing:k,elevation:M}=s(h);f&&(h.center=f),_!==void 0&&(h.zoom=_),b!==void 0&&(h.pitch=b),k!==void 0&&(h.bearing=k),M!==void 0&&(h.elevation=M),o.apply(h)}this.transform.apply(o)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;let o=this._zooming,s=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new c.k("zoomend",e)),s&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var o;if(!e.essential&&ge.prefersReducedMotion){let Ie=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ie,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);let s=this._getTransformForUpdate(),h=s.zoom,f=s.bearing,_=s.pitch,b=s.padding,k="bearing"in e?this._normalizeBearing(e.bearing,f):f,M="pitch"in e?+e.pitch:_,I="padding"in e?e.padding:s.padding,z=c.P.convert(e.offset),F=s.centerPoint.add(z),O=s.pointLocation(F),{center:q,zoom:Z}=s.getConstrained(c.N.convert(e.center||O),(o=e.zoom)!==null&&o!==void 0?o:h);this._normalizeCenter(q,s);let G=s.zoomScale(Z-h),W=s.project(O),V=s.project(q).sub(W),J=e.curve,ee=Math.max(s.width,s.height),ne=ee/G,ue=V.mag();if("minZoom"in e){let Ie=c.ac(Math.min(e.minZoom,h,Z),s.minZoom,s.maxZoom),Ge=ee/s.zoomScale(Ie-h);J=Math.sqrt(Ge/ue*2)}let _e=J*J;function Se(Ie){let Ge=(ne*ne-ee*ee+(Ie?-1:1)*_e*_e*ue*ue)/(2*(Ie?ne:ee)*_e*ue);return Math.log(Math.sqrt(Ge*Ge+1)-Ge)}function Ee(Ie){return(Math.exp(Ie)-Math.exp(-Ie))/2}function xe(Ie){return(Math.exp(Ie)+Math.exp(-Ie))/2}let be=Se(!1),Re=function(Ie){return xe(be)/xe(be+J*Ie)},We=function(Ie){return ee*((xe(be)*(Ee(Ge=be+J*Ie)/xe(Ge))-Ee(be))/_e)/ue;var Ge},ke=(Se(!0)-be)/J;if(Math.abs(ue)<1e-6||!isFinite(ke)){if(Math.abs(ee-ne)<1e-6)return this.easeTo(e,n);let Ie=ne<ee?-1:1;ke=Math.abs(Math.log(ne/ee))/J,We=()=>0,Re=Ge=>Math.exp(Ie*J*Ge)}return e.duration="duration"in e?+e.duration:1e3*ke/("screenSpeed"in e?+e.screenSpeed/J:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==k,this._pitching=M!==_,this._padding=!s.isPaddingEqual(I),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(q),this._ease(Ie=>{let Ge=Ie*ke,Tt=1/Re(Ge);s.zoom=Ie===1?Z:h+s.scaleZoom(Tt),this._rotating&&(s.bearing=c.y.number(f,k,Ie)),this._pitching&&(s.pitch=c.y.number(_,M,Ie)),this._padding&&(s.interpolatePadding(b,I,Ie),F=s.centerPoint.add(z)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ie);let Qe=Ie===1?q:s.unproject(W.add(V.mult(We(Ge))).mult(Tt));s.setLocationAtPoint(s.renderWorldCopies?Qe.wrap():Qe,F),this._applyUpdatedTransform(s),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var o;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,n)}return e||(o=this.handlers)===null||o===void 0||o.stop(!1),this}_ease(e,n,o){o.animate===!1||o.duration===0?(e(1),n()):(this._easeStart=ge.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);let o=Math.abs(e-n);return Math.abs(e-360-n)<o&&(e-=360),Math.abs(e+360-n)<o&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;let o=e.lng-n.center.lng;e.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}let La={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ra{constructor(e=La){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=le.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=le.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=le.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){le.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let o=this._map._getUIString(`AttributionControl.${n}`);e.title=o,e.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(s=>typeof s!="string"?"":s)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}let n=this._map.style.sourceCaches;for(let s in n){let h=n[s];if(h.used||h.usedForTerrain){let f=h.getSource();f.attribution&&e.indexOf(f.attribution)<0&&e.push(f.attribution)}}e=e.filter(s=>String(s).trim()),e.sort((s,h)=>s.length-h.length),e=e.filter((s,h)=>{for(let f=h+1;f<e.length;f++)if(e[f].indexOf(s)>=0)return!1;return!0});let o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jl{constructor(e={}){this._updateCompact=()=>{let n=this._container.children;if(n.length){let o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=le.create("div","maplibregl-ctrl");let n=le.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){le.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class st{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(let s of o)if(s.id===e)return void(s.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let n=this._currentlyRunning=this._queue;this._queue=[];for(let o of n)if(!o.cancelled&&(o.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ql=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ud extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];let o={};for(let s of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[s.key]=!0,this._renderableTilesKeys.push(s.key),this._tiles[s.key]||(s.posMatrix=new Float64Array(16),c.aP(s.posMatrix,0,c.X,0,c.X,0,1),this._tiles[s.key]=new _n(s,this.tileSize));for(let s in this._tiles)o[s]||delete this._tiles[s]}freeRtt(e){for(let n in this._tiles){let o=this._tiles[n];(!e||o.tileID.equals(e)||o.tileID.isChildOf(e)||e.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let n={};for(let o of this._renderableTilesKeys){let s=this._tiles[o].tileID;if(s.canonical.equals(e.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[o]=h}else if(s.canonical.isChildOf(e.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16);let f=s.canonical.z-e.canonical.z,_=s.canonical.x-(s.canonical.x>>f<<f),b=s.canonical.y-(s.canonical.y>>f<<f),k=c.X>>f;c.aP(h.posMatrix,0,k,0,k,0,1),c.J(h.posMatrix,h.posMatrix,[-_*k,-b*k,0]),n[o]=h}else if(e.canonical.isChildOf(s.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16);let f=e.canonical.z-s.canonical.z,_=e.canonical.x-(e.canonical.x>>f<<f),b=e.canonical.y-(e.canonical.y>>f<<f),k=c.X>>f;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[_*k,b*k,0]),c.K(h.posMatrix,h.posMatrix,[1/2**f,1/2**f,0]),n[o]=h}}return n}getSourceTile(e,n){let o=this.sourceCache._source,s=e.overscaledZ-this.deltaZoom;if(s>o.maxzoom&&(s=o.maxzoom),s<o.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(s).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;s>=o.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(s--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class ec{constructor(e,n,o){this.painter=e,this.sourceCache=new Ud(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,o,s=c.X){var h;if(!(n>=0&&n<s&&o>=0&&o<s))return 0;let f=this.getTerrainData(e),_=(h=f.tile)===null||h===void 0?void 0:h.dem;if(!_)return 0;let b=function(O,q,Z){var G=q[0],W=q[1];return O[0]=Z[0]*G+Z[4]*W+Z[12],O[1]=Z[1]*G+Z[5]*W+Z[13],O}([],[n/s*c.X,o/s*c.X],f.u_terrain_matrix),k=[b[0]*_.dim,b[1]*_.dim],M=Math.floor(k[0]),I=Math.floor(k[1]),z=k[0]-M,F=k[1]-I;return _.get(M,I)*(1-z)*(1-F)+_.get(M+1,I)*z*(1-F)+_.get(M,I+1)*(1-z)*F+_.get(M+1,I+1)*z*F}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;let{tileID:o,mercatorX:s,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(o,s%c.X,h%c.X,c.X)}getElevation(e,n,o,s=c.X){return this.getDEMElevation(e,n,o,s)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let s=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new yt(s,h,s.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new yt(s,new c.R({width:1,height:1}),s.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}let n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){let s=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new yt(s,n.dem.getPixels(),s.gl.RGBA,{premultiply:!1}),n.demTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}let o=n&&n+n.tileID.key+e.key;if(o&&!this._demMatrixCache[o]){let s=this.sourceCache.sourceCache._source.maxzoom,h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=s?h=e.canonical.z-s:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let f=e.canonical.x-(e.canonical.x>>h<<h),_=e.canonical.y-(e.canonical.y>>h<<h),b=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(b,b,[f*c.X,_*c.X,0]),this._demMatrixCache[e.key]={matrix:b,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){let n=this.painter,o=n.width/devicePixelRatio,s=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===s||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new yt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new yt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,s,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,s))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,f=0;h<this._coordsTextureSize;h++)for(let _=0;_<this._coordsTextureSize;_++,f+=4)n[f+0]=255&_,n[f+1]=255&h,n[f+2]=_>>8<<4|h>>8,n[f+3]=0;let o=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),s=new yt(e,o,e.gl.RGBA,{premultiply:!1});return s.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=s,s}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let n=new Uint8Array(4),o=this.painter.context,s=o.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),f=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),_=Math.round(this.painter.height/devicePixelRatio);o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),s.readPixels(h,_-f-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);let b=n[0]+(n[2]>>4<<8),k=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],I=M&&this.sourceCache.getTileByID(M);if(!I)return null;let z=this._coordsTextureSize,F=(1<<I.tileID.canonical.z)*z;return new c.Z((I.tileID.canonical.x*z+b)/F+I.tileID.wrap,(I.tileID.canonical.y*z+k)/F,this.getElevation(I.tileID,b,k,z))}depthAtPoint(e){let n=new Uint8Array(4),o=this.painter.context,s=o.gl;return o.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),s.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,n=new c.bd,o=new c.aY,s=this.meshSize,h=c.X/s,f=s*s;for(let I=0;I<=s;I++)for(let z=0;z<=s;z++)n.emplaceBack(z*h,I*h,0);for(let I=0;I<f;I+=s+1)for(let z=0;z<s;z++)o.emplaceBack(z+I,s+z+I+1,s+z+I+2),o.emplaceBack(z+I,s+z+I+2,z+I+1);let _=n.length,b=_+2*(s+1);for(let I of[0,1])for(let z=0;z<=s;z++)for(let F of[0,1])n.emplaceBack(z*h,I*c.X,F);for(let I=0;I<2*s;I+=2)o.emplaceBack(b+I,b+I+1,b+I+3),o.emplaceBack(b+I,b+I+3,b+I+2),o.emplaceBack(_+I,_+I+3,_+I+1),o.emplaceBack(_+I,_+I+2,_+I+3);let k=n.length,M=k+2*(s+1);for(let I of[0,1])for(let z=0;z<=s;z++)for(let F of[0,1])n.emplaceBack(I*c.X,z*h,F);for(let I=0;I<2*s;I+=2)o.emplaceBack(k+I,k+I+1,k+I+3),o.emplaceBack(k+I,k+I+3,k+I+2),o.emplaceBack(M+I,M+I+3,M+I+1),o.emplaceBack(M+I,M+I+2,M+I+3);return this._mesh=new vs(e.createVertexBuffer(n,Ql.members),e.createIndexBuffer(o),c.a0.simpleSegment(0,0,n.length,o.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var o;let{tileID:s}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(o=this.getMinMaxElevation(s).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(e){let n=this.getTerrainData(e).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(e,n){let o=c.Z.fromLngLat(e.wrap()),s=(1<<n)*c.X,h=o.x*s,f=o.y*s,_=Math.floor(h/c.X),b=Math.floor(f/c.X);return{tileID:new c.S(n,0,n,_,b),mercatorX:h,mercatorY:f}}}class $d{constructor(e,n,o){this._context=e,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new yt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:e,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let Fa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ph{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new $d(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(o=>!e._layers[o].isHidden(n)),this._coordsDescendingInv={};for(let o in e.sourceCaches){this._coordsDescendingInv[o]={};let s=e.sourceCaches[o].getVisibleCoordinates();for(let h of s){let f=this.terrain.sourceCache.getTerrainCoords(h);for(let _ in f)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(f[_])}}this._coordsDescendingInvStr={};for(let o of e._order){let s=e._layers[o],h=s.source;if(Fa[s.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(let f in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][f]=this._coordsDescendingInv[h][f].map(_=>_.key).sort().join()}}for(let o of this._renderableTiles)for(let s in this._coordsDescendingInvStr){let h=this._coordsDescendingInvStr[s][o.tileID.key];h&&h!==o.rttCoords[s]&&(o.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let n=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Fa[n]&&(this._prevType&&Fa[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(Fa[this._prevType]||Fa[n]&&s){this._prevType=n;let h=this._stacks.length-1,f=this._stacks[h]||[];for(let _ of this._renderableTiles){if(this.pool.isFull()&&(ah(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[h]){let k=this.pool.getObjectForId(_.rtt[h].id);if(k.stamp===_.rtt[h].stamp){this.pool.useObject(k);continue}}let b=this.pool.getOrCreateFreeObject();this.pool.useObject(b),this.pool.stampObject(b),_.rtt[h]={id:b.id,stamp:b.stamp},o.context.bindFramebuffer.set(b.fbo.framebuffer),o.context.clear({color:c.aM.transparent,stencil:0}),o.currentStencilSource=void 0;for(let k=0;k<f.length;k++){let M=o.style._layers[f[k]],I=M.source?this._coordsDescendingInv[M.source][_.tileID.key]:[_.tileID];o.context.viewport.set([0,0,b.fbo.width,b.fbo.height]),o._renderTileClippingMasks(M,I),o.renderLayer(o,o.style.sourceCaches[M.source],M,I),M.source&&(_.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][_.tileID.key])}}return ah(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fa[n]}return!1}}let tc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},mh=he,Zd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:La,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ic=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},Gd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Hd{constructor(e,n,o=!1){this.mousedown=f=>{this.startMouse(c.e({},f,{ctrlKey:!0,preventDefault:()=>f.preventDefault()}),le.mousePos(this.element,f)),le.addEventListener(window,"mousemove",this.mousemove),le.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=f=>{this.moveMouse(f,le.mousePos(this.element,f))},this.mouseup=f=>{this.mouseRotate.dragEnd(f),this.mousePitch&&this.mousePitch.dragEnd(f),this.offTemp()},this.touchstart=f=>{f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=le.touchPos(this.element,f.targetTouches)[0],this.startTouch(f,this._startPos),le.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.addEventListener(window,"touchend",this.touchend))},this.touchmove=f=>{f.targetTouches.length!==1?this.reset():(this._lastPos=le.touchPos(this.element,f.targetTouches)[0],this.moveTouch(f,this._lastPos))},this.touchend=f=>{f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let s=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Ul({clickTolerance:s,enable:!0}),this.touchRotate=(({enable:f,clickTolerance:_,bearingDegreesPerPixelMoved:b=.8})=>{let k=new ql;return new nn({clickTolerance:_,move:(M,I)=>({bearingDelta:(I.x-M.x)*b}),moveStateManager:k,enable:f,assignEvents:ic})})({clickTolerance:s,enable:!0}),this.map=e,o&&(this.mousePitch=$l({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:f,clickTolerance:_,pitchDegreesPerPixelMoved:b=-.5})=>{let k=new ql;return new nn({clickTolerance:_,move:(M,I)=>({pitchDelta:(I.y-M.y)*b}),moveStateManager:k,enable:f,assignEvents:ic})})({clickTolerance:h,enable:!0})),le.addEventListener(n,"mousedown",this.mousedown),le.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),le.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),le.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),le.disableDrag()}moveMouse(e,n){let o=this.map,{bearingDelta:s}=this.mouseRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.mousePitch){let{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&o.setPitch(o.getPitch()+h)}}moveTouch(e,n){let o=this.map,{bearingDelta:s}=this.touchRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.touchPitch){let{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&o.setPitch(o.getPitch()+h)}}off(){let e=this.element;le.removeEventListener(e,"mousedown",this.mousedown),le.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),le.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.removeEventListener(window,"touchend",this.touchend),le.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){le.enableDrag(),le.removeEventListener(window,"mousemove",this.mousemove),le.removeEventListener(window,"mouseup",this.mouseup),le.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.removeEventListener(window,"touchend",this.touchend)}}let Ki;function It(d,e,n){let o=new c.N(d.lng,d.lat);if(d=new c.N(d.lng,d.lat),e){let s=new c.N(d.lng-360,d.lat),h=new c.N(d.lng+360,d.lat),f=n.locationPoint(d).distSqr(e);n.locationPoint(s).distSqr(e)<f?d=s:n.locationPoint(h).distSqr(e)<f&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){let s=n.locationPoint(d);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==o.lng&&n.locationPoint(d).y>n.height/2-n.getHorizon()?d:o}let Ba={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function As(d,e,n){let o=d.classList;for(let s in Ba)o.remove(`maplibregl-${n}-anchor-${s}`);o.add(`maplibregl-${n}-anchor-${e}`)}class Ps extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{let o=n.code,s=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&s!==32&&s!==13||this.togglePopup()},this._onMapClick=n=>{let o=n.originalEvent.target,s=this._element;this._popup&&(o===s||s.contains(o))&&this.togglePopup()},this._update=n=>{var o;if(!this._map)return;let s=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?It(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),le.setTransform(this._element,`${Ba[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${h}`),ge.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){let o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=le.create("div");let n=le.createNS("http://www.w3.org/2000/svg","svg"),o=41,s=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${s}px`),n.setAttributeNS(null,"viewBox",`0 0 ${s} ${o}`);let h=le.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");let f=le.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");let _=le.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");let b=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let G of b){let W=le.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",G.rx),W.setAttributeNS(null,"ry",G.ry),_.appendChild(W)}let k=le.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let M=le.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(M);let I=le.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");let z=le.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(z);let F=le.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");let O=le.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");let q=le.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");let Z=le.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),O.appendChild(q),O.appendChild(Z),f.appendChild(_),f.appendChild(k),f.appendChild(I),f.appendChild(F),f.appendChild(O),n.appendChild(f),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),As(this._element,this._anchor,"marker"),e&&e.className)for(let n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),le.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let s=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,o;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let s=this._map,h=s.terrain.depthAtPoint(this._pos),f=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,f)-h<.006)return void(this._element.style.opacity=this._opacity);let _=-this._offset.y/s.transform._pixelPerMeter,b=Math.sin(s.getPitch()*Math.PI/180)*_,k=s.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=s.transform.lngLatToCameraDepth(this._lngLat,f+b)-k>.006;!((o=this._popup)===null||o===void 0)&&o.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}let fh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Eo=0,Ao=!1,qr={maxWidth:100,unit:"metric"};function Po(d,e,n){let o=n&&n.maxWidth||100,s=d._container.clientHeight/2,h=d.unproject([0,s]),f=d.unproject([o,s]),_=h.distanceTo(f);if(n&&n.unit==="imperial"){let b=3.2808*_;b>5280?Le(e,o,b/5280,d._getUIString("ScaleControl.Miles")):Le(e,o,b,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Le(e,o,_/1852,d._getUIString("ScaleControl.NauticalMiles")):_>=1e3?Le(e,o,_/1e3,d._getUIString("ScaleControl.Kilometers")):Le(e,o,_,d._getUIString("ScaleControl.Meters"))}function Le(d,e,n,o){let s=function(h){let f=Math.pow(10,`${Math.floor(h)}`.length-1),_=h/f;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(b){let k=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*k)/k}(_),f*_}(n);d.style.width=e*(s/n)+"px",d.innerHTML=`${s}&nbsp;${o}`}let Ue={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ds=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zs(d){if(d){if(typeof d=="number"){let e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){let e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return zs(new c.P(0,0))}let rc=he;y.AJAXError=c.bh,y.Evented=c.E,y.LngLat=c.N,y.MercatorCoordinate=c.Z,y.Point=c.P,y.addProtocol=c.bi,y.config=c.a,y.removeProtocol=c.bj,y.AttributionControl=Ra,y.BoxZoomHandler=Xi,y.CanvasSource=rr,y.CooperativeGesturesHandler=za,y.DoubleClickZoomHandler=Kn,y.DragPanHandler=hh,y.DragRotateHandler=dh,y.EdgeInsets=Ea,y.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){le.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let d=this._fullscreenButton=le.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);le.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},y.GeoJSONSource=ho,y.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let n=new c.N(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy,s=this._map.getBearing(),h=c.e({bearing:s},this.options.fitBoundsOptions),f=oe.fromLngLat(n,o);this._map.fitBounds(f,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ao)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=le.create("button","maplibregl-ctrl-geolocate",this._container),le.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=le.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ps({element:this._dotElement}),this._circleElement=le.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ps({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},fh,d)}onAdd(d){return this._map=d,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Ki!==void 0&&!e)return Ki;if(window.navigator.permissions===void 0)return Ki=!!window.navigator.geolocation,Ki;try{Ki=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ki=!!window.navigator.geolocation}return Ki})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),le.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Eo=0,Ao=!1}_isOutOfMapMaxBounds(d){let e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),o=e.distanceTo(n),s=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Eo--,Ao=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Eo++,Eo>1?(d={maximumAge:6e5,timeout:0},Ao=!0):(d=this.options.positionOptions,Ao=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},y.Hash=xs,y.ImageSource=en,y.KeyboardHandler=or,y.LngLatBounds=oe,y.LogoControl=Jl,y.Map=class extends uh{constructor(d){c.bf.mark(c.bg.create);let e=Object.assign(Object.assign({},Zd),d);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Aa(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new st,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},tc),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$i.addThrottleControl(()=>this.isMoving()),this._requestManager=new ml(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1,o=Co(s=>{this._trackResize&&!this._removed&&(this.resize(s),this.redraw())},50);this._resizeObserver=new ResizeObserver(s=>{n?o(s):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Yl(this,e),this._hash=e.hash&&new xs(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ra(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Jl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=d.onAdd(this);this._controls.push(d);let o=this._controlPositions[e];return e.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,o)}resize(d){var e;let n=this._containerDimensions(),o=n[0],s=n[1],h=this._getClampedPixelRatio(o,s);if(this._resizeCanvas(o,s,h),this.painter.resize(o,s,h),this.painter.overLimit()){let _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];let b=this._getClampedPixelRatio(o,s);this._resizeCanvas(o,s,b),this.painter.resize(o,s,b)}this.transform.resize(o,s),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,s);let f=!this._moving;return f&&(this.stop(),this.fire(new c.k("movestart",d)).fire(new c.k("move",d))),this.fire(new c.k("resize",d)),f&&this.fire(new c.k("moveend",d)),this}_getClampedPixelRatio(d,e){let{0:n,1:o}=this._maxCanvasSize,s=this.getPixelRatio(),h=d*s,f=e*s;return Math.min(h>n?n/h:1,f>o?o/f:1)*s}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(oe.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(c.N.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{let f=e.filter(b=>this.getLayer(b)),_=f.length!==0?this.queryRenderedFeatures(h.point,{layers:f}):[];_.length?o||(o=!0,n.call(this,new ci(d,this,h.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(d==="mouseleave"||d==="mouseout"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:f=>{let _=e.filter(b=>this.getLayer(b));(_.length!==0?this.queryRenderedFeatures(f.point,{layers:_}):[]).length?o=!0:o&&(o=!1,n.call(this,new ci(d,this,f.originalEvent)))},mouseout:f=>{o&&(o=!1,n.call(this,new ci(d,this,f.originalEvent)))}}}}{let o=s=>{let h=e.filter(_=>this.getLayer(_)),f=h.length!==0?this.queryRenderedFeatures(s.point,{layers:h}):[];f.length&&(s.features=f,n.call(this,s),delete s.features)};return{layers:e,listener:n,delegates:{[d]:o}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;let o=this._delegatedListeners[d];for(let s=0;s<o.length;s++){let h=o[s];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(f=>e.includes(f))){for(let f in h.delegates)this.off(f,h.delegates[f]);return void o.splice(s,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);let o=this._createDelegatedListener(d,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(d,o);for(let s in o.delegates)this.on(s,o.delegates[s]);return this}once(d,e,n){if(n===void 0)return super.once(d,e);let o=typeof e=="string"?[e]:e,s=this._createDelegatedListener(d,o,n);for(let h in s.delegates){let f=s.delegates[h];s.delegates[h]=(..._)=>{this._removeDelegatedListener(d,o,n),f(..._)}}this._saveDelegatedListener(d,s);for(let h in s.delegates)this.once(h,s.delegates[h]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n,o=d instanceof c.P||Array.isArray(d),s=o?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(o?{}:d)||{},s instanceof c.P||typeof s[0]=="number")n=[c.P.convert(s)];else{let h=c.P.convert(s[0]),f=c.P.convert(s[1]);n=[h,new c.P(f.x,h.y),f,new c.P(h.x,f.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){let e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));let n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new ns(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,n):this.style.loadJSON(d,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){let n=this._requestManager.transformRequest(d,"Style");c.h(n,new AbortController).then(o=>{this._updateDiff(o.data,e)}).catch(o=>{o&&this.fire(new c.j(o))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){let e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){let e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(let n in this.style._layers){let o=this.style._layers[n];o.type==="hillshade"&&o.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ec(this.painter,e,d),this.painter.renderToTexture=new ph(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let d=this.style&&this.style.sourceCaches;for(let e in d){let n=d[e]._tiles;for(let o in n){let s=n[o];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,n={}){let{pixelRatio:o=1,sdf:s=!1,stretchX:h,stretchY:f,content:_,textFitWidth:b,textFitHeight:k}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:M,height:I,data:z}=e,F=e;return this.style.addImage(d,{data:new c.R({width:M,height:I},new Uint8Array(z)),pixelRatio:o,stretchX:h,stretchY:f,content:_,textFitWidth:b,textFitHeight:k,sdf:s,version:0,userImage:F}),F.onAdd&&F.onAdd(this,d),this}}{let{width:M,height:I,data:z}=ge.getImageData(e);this.style.addImage(d,{data:new c.R({width:M,height:I},z),pixelRatio:o,stretchX:h,stretchY:f,content:_,textFitWidth:b,textFitHeight:k,sdf:s,version:0})}}updateImage(d,e){let n=this.style.getImage(d);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=e instanceof HTMLImageElement||c.b(e)?ge.getImageData(e):e,{width:s,height:h,data:f}=o;if(s===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let _=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(f,_),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return $i.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,o={}){return this.style.setPaintProperty(d,e,n,o),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,o={}){return this.style.setLayoutProperty(d,e,n,o),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,o=>{o||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d){return this._lazyInitEmptyStyle(),this.style.setSky(d),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){let d=this._container;d.classList.add("maplibregl-map");let e=this._canvasContainer=le.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=le.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);let s=this._controlContainer=le.create("div","maplibregl-control-container",d),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{h[f]=le.create("div",`maplibregl-ctrl-${f} `,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{e={requestedAttributes:d},o&&(e.statusMessage=o.statusMessage,e.type=o.type)},{once:!0});let n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){let o="Failed to initialize WebGL";throw e?(e.message=o,new Error(JSON.stringify(e))):new Error(o)}this.painter=new bs(n,this.transform),ur.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let s=this.transform.zoom,h=ge.now();this.style.zoomHistory.update(s,h);let f=new c.z(s,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=f.crossFadingFactor();_===1&&_===this._crossFadingFactor||(n=!0,this._crossFadingFactor=_),this.style.update(f)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$i.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),le.remove(this._canvasContainer),le.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(d=>{c.bf.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return mh}getCameraTargetElevation(){return this.transform.elevation}},y.MapMouseEvent=ci,y.MapTouchEvent=Wn,y.MapWheelEvent=sh,y.Marker=Ps,y.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{let e=this._map.getZoom(),n=e===this._map.getMaxZoom(),o=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{let o=this._map._getUIString(`NavigationControl.${n}`);e.title=o,e.setAttribute("aria-label",o)},this.options=c.e({},Gd,d),this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),le.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),le.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=le.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){le.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){let n=le.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},y.Popup=class extends c.E{constructor(d){super(),this.remove=()=>(this._content&&le.remove(this._content),this._container&&(le.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=le.create("div","maplibregl-popup",this._map.getContainer()),this._tip=le.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?It(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;let o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let s=this.options.anchor,h=zs(this.options.offset);if(!s){let _=this._container.offsetWidth,b=this._container.offsetHeight,k;k=o.y+h.bottom.y<b?["top"]:o.y>this._map.transform.height-b?["bottom"]:[],o.x<_/2?k.push("left"):o.x>this._map.transform.width-_/2&&k.push("right"),s=k.length===0?"bottom":k.join("-")}let f=o.add(h[s]);this.options.subpixelPositioning||(f=f.round()),le.setTransform(this._container,`${Ba[s]} translate(${f.x}px,${f.y}px)`),As(this._container,s,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ue),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.N.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let e=document.createDocumentFragment(),n=document.createElement("body"),o;for(n.innerHTML=d;o=n.firstChild,o;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=le.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=le.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(Ds);d&&d.focus()}},y.RasterDEMTileSource=Lt,y.RasterTileSource=pt,y.ScaleControl=class{constructor(d){this._onMove=()=>{Po(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Po(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},qr),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){le.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},y.ScrollZoomHandler=xr,y.Style=ns,y.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=le.create("button","maplibregl-ctrl-terrain",this._container),le.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){le.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},y.TwoFingersTouchPitchHandler=Da,y.TwoFingersTouchRotateHandler=Wl,y.TwoFingersTouchZoomHandler=Gl,y.TwoFingersTouchZoomRotateHandler=Kl,y.VectorTileSource=co,y.VideoSource=fa,y.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(po(d))throw new Error(`A source type called "${d}" already exists.`);((n,o)=>{uo[n]=o})(d,e)}),y.clearPrewarmedResources=function(){let d=Zi;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(pn),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},y.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},y.getRTLTextPluginStatus=function(){return Br().getRTLTextPluginStatus()},y.getVersion=function(){return rc},y.getWorkerCount=function(){return Rr.workerCount},y.getWorkerUrl=function(){return c.a.WORKER_URL},y.importScriptInWorkers=function(d){return lo().broadcast("IS",d)},y.prewarm=function(){Fn().acquire(pn)},y.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},y.setRTLTextPlugin=function(d,e){return Br().setRTLTextPlugin(d,e)},y.setWorkerCount=function(d){Rr.workerCount=d},y.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var S=D;return S})});function l0(D,Y){}var no=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var Ec=(()=>{class D extends Lf{_elementRef=me(Ar);_focusTrapFactory=me(Sf);_config;_interactivityChecker=me(Cf);_ngZone=me(Js);_overlayRef=me(tp);_focusMonitor=me(Wo);_renderer=me(qh);_platform=me(Wh);_document=me(Go,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=me(eo);_injector=me(Ja);_isDestroyed=!1;constructor(){super(),this._config=me(no,{optional:!0})||new no,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(v){this._ariaLabelledByQueue.push(v),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(v){let S=this._ariaLabelledByQueue.indexOf(v);S>-1&&(this._ariaLabelledByQueue.splice(S,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(v){this._portalOutlet.hasAttached();let S=this._portalOutlet.attachComponentPortal(v);return this._contentAttached(),S}attachTemplatePortal(v){this._portalOutlet.hasAttached();let S=this._portalOutlet.attachTemplatePortal(v);return this._contentAttached(),S}attachDomPortal=v=>{this._portalOutlet.hasAttached();let S=this._portalOutlet.attachDomPortal(v);return this._contentAttached(),S};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(v,S){this._interactivityChecker.isFocusable(v)||(v.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let y=()=>{c(),he(),v.removeAttribute("tabindex")},c=this._renderer.listen(v,"blur",y),he=this._renderer.listen(v,"mousedown",y)})),v.focus(S)}_focusByCssSelector(v,S){let y=this._elementRef.nativeElement.querySelector(v);y&&this._forceFocus(y,S)}_trapFocus(){this._isDestroyed||el(()=>{let v=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||v.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let v=this._config.restoreFocus,S=null;if(typeof v=="string"?S=this._document.querySelector(v):typeof v=="boolean"?S=v?this._elementFocusedBeforeDialogWasOpened:null:v&&(S=v),this._config.restoreFocus&&S&&typeof S.focus=="function"){let y=Xh(),c=this._elementRef.nativeElement;(!y||y===this._document.body||y===c||c.contains(y))&&(this._focusMonitor?(this._focusMonitor.focusVia(S,this._closeInteractionType),this._closeInteractionType=null):S.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let v=this._elementRef.nativeElement,S=Xh();return v===S||v.contains(S)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Xh()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["cdk-dialog-container"]],viewQuery:function(S,y){if(S&1&&na(la,7),S&2){let c;ji(c=qi())&&(y._portalOutlet=c.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(S,y){S&2&&Zt("id",y._config.id||null)("role",y._config.role)("aria-modal",y._config.ariaModal)("aria-labelledby",y._config.ariaLabel?null:y._ariaLabelledByQueue[0])("aria-label",y._config.ariaLabel)("aria-describedby",y._config.ariaDescribedBy||null)},features:[er],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(S,y){S&1&&Mt(0,l0,0,0,"ng-template",0)},dependencies:[la],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return D})(),Yo=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new Mi;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(Y,v){this.overlayRef=Y,this.config=v,this.disableClose=v.disableClose,this.backdropClick=Y.backdropClick(),this.keydownEvents=Y.keydownEvents(),this.outsidePointerEvents=Y.outsidePointerEvents(),this.id=v.id,this.keydownEvents.subscribe(S=>{S.keyCode===27&&!this.disableClose&&!io(S)&&(S.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=Y.detachments().subscribe(()=>{v.closeOnOverlayDetachments!==!1&&this.close()})}close(Y,v){if(this.containerInstance){let S=this.closed;this.containerInstance._closeInteractionType=v?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),S.next(Y),S.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(Y="",v=""){return this.overlayRef.updateSize({width:Y,height:v}),this}addPanelClass(Y){return this.overlayRef.addPanelClass(Y),this}removePanelClass(Y){return this.overlayRef.removePanelClass(Y),this}},c0=new si("DialogScrollStrategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.block()}}),h0=new si("DialogData"),d0=new si("DefaultDialogConfig");var Ac=(()=>{class D{_overlay=me(Xr);_injector=me(Ja);_defaultOptions=me(d0,{optional:!0});_parentDialog=me(D,{optional:!0,skipSelf:!0});_overlayContainer=me(Rf);_idGenerator=me(Xo);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Mi;_afterOpenedAtThisLevel=new Mi;_ariaHiddenElements=new Map;_scrollStrategy=me(c0);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=Vh(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ln(void 0)));constructor(){}open(v,S){let y=this._defaultOptions||new no;S=Kt(Kt({},y),S),S.id=S.id||this._idGenerator.getId("cdk-dialog-"),S.id&&this.getDialogById(S.id);let c=this._getOverlayConfig(S),he=this._overlay.create(c),ze=new Yo(he,S),Je=this._attachContainer(he,ze,S);return ze.containerInstance=Je,this._attachDialogContent(v,ze,Je,S),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(ze),ze.closed.subscribe(()=>this._removeOpenDialog(ze,!0)),this.afterOpened.next(ze),ze}closeAll(){ip(this.openDialogs,v=>v.close())}getDialogById(v){return this.openDialogs.find(S=>S.id===v)}ngOnDestroy(){ip(this._openDialogsAtThisLevel,v=>{v.config.closeOnDestroy===!1&&this._removeOpenDialog(v,!1)}),ip(this._openDialogsAtThisLevel,v=>v.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(v){let S=new Jh({positionStrategy:v.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:v.scrollStrategy||this._scrollStrategy(),panelClass:v.panelClass,hasBackdrop:v.hasBackdrop,direction:v.direction,minWidth:v.minWidth,minHeight:v.minHeight,maxWidth:v.maxWidth,maxHeight:v.maxHeight,width:v.width,height:v.height,disposeOnNavigation:v.closeOnNavigation});return v.backdropClass&&(S.backdropClass=v.backdropClass),S}_attachContainer(v,S,y){let c=y.injector||y.viewContainerRef?.injector,he=[{provide:no,useValue:y},{provide:Yo,useValue:S},{provide:tp,useValue:v}],ze;y.container?typeof y.container=="function"?ze=y.container:(ze=y.container.type,he.push(...y.container.providers(y))):ze=Ec;let Je=new Qu(ze,y.viewContainerRef,Ja.create({parent:c||this._injector,providers:he}));return v.attach(Je).instance}_attachDialogContent(v,S,y,c){if(v instanceof jo){let he=this._createInjector(c,S,y,void 0),ze={$implicit:c.data,dialogRef:S};c.templateContext&&(ze=Kt(Kt({},ze),typeof c.templateContext=="function"?c.templateContext():c.templateContext)),y.attachTemplatePortal(new sl(v,null,ze,he))}else{let he=this._createInjector(c,S,y,this._injector),ze=y.attachComponentPortal(new Qu(v,c.viewContainerRef,he));S.componentRef=ze,S.componentInstance=ze.instance}}_createInjector(v,S,y,c){let he=v.injector||v.viewContainerRef?.injector,ze=[{provide:h0,useValue:v.data},{provide:Yo,useValue:S}];return v.providers&&(typeof v.providers=="function"?ze.push(...v.providers(S,v,y)):ze.push(...v.providers)),v.direction&&(!he||!he.get(Mc,null,{optional:!0}))&&ze.push({provide:Mc,useValue:{value:v.direction,change:Er()}}),Ja.create({parent:he||c,providers:ze})}_removeOpenDialog(v,S){let y=this.openDialogs.indexOf(v);y>-1&&(this.openDialogs.splice(y,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((c,he)=>{c?he.setAttribute("aria-hidden",c):he.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),S&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let v=this._overlayContainer.getContainerElement();if(v.parentElement){let S=v.parentElement.children;for(let y=S.length-1;y>-1;y--){let c=S[y];c!==v&&c.nodeName!=="SCRIPT"&&c.nodeName!=="STYLE"&&!c.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(c,c.getAttribute("aria-hidden")),c.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let v=this._parentDialog;return v?v._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(S){return new(S||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function ip(D,Y){let v=D.length;for(;v--;)Y(D[v])}var Qh=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[Ac],imports:[ll,ca,Tf,ca]})}return D})();function u0(D,Y){}var td=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},rp="mdc-dialog--open",Of="mdc-dialog--opening",Vf="mdc-dialog--closing",p0=150,m0=75,f0=(()=>{class D extends Ec{_animationMode=me(Qs,{optional:!0});_animationStateChanged=new An;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?jf(this._config.enterAnimationDuration)??p0:0;_exitAnimationDuration=this._animationsEnabled?jf(this._config.exitAnimationDuration)??m0:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(Nf,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Of,rp)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(rp),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(rp),this._animationsEnabled?(this._hostElement.style.setProperty(Nf,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Vf)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(v){this._actionSectionCount+=v,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(Of,Vf)}_waitForAnimationToComplete(v,S){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(S,v)}_requestAnimationFrame(v){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(v):v()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(v){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:v})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(v){let S=super.attachComponentPortal(v);return S.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),S}static \u0275fac=(()=>{let v;return function(y){return(v||(v=ia(D)))(y||D)}})();static \u0275cmp=kt({type:D,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(S,y){S&2&&($h("id",y._config.id),Zt("aria-modal",y._config.ariaModal)("role",y._config.role)("aria-labelledby",y._config.ariaLabel?null:y._ariaLabelledByQueue[0])("aria-label",y._config.ariaLabel)("aria-describedby",y._config.ariaDescribedBy||null),Qt("_mat-animation-noopable",!y._animationsEnabled)("mat-mdc-dialog-container-with-actions",y._actionSectionCount>0))},features:[er],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(S,y){S&1&&(Ne(0,"div",0)(1,"div",1),Mt(2,u0,0,0,"ng-template",2),$e()())},dependencies:[la],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return D})(),Nf="--mat-dialog-transition-duration";function jf(D){return D==null?null:typeof D=="number"?D:D.endsWith("ms")?Zu(D.substring(0,D.length-2)):D.endsWith("s")?Zu(D.substring(0,D.length-1))*1e3:D==="0"?0:null}var ed=function(D){return D[D.OPEN=0]="OPEN",D[D.CLOSING=1]="CLOSING",D[D.CLOSED=2]="CLOSED",D}(ed||{}),Pc=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new Mi;_beforeClosed=new Mi;_result;_closeFallbackTimeout;_state=ed.OPEN;_closeInteractionType;constructor(Y,v,S){this._ref=Y,this._containerInstance=S,this.disableClose=v.disableClose,this.id=Y.id,Y.addPanelClass("mat-mdc-dialog-panel"),S._animationStateChanged.pipe(Gr(y=>y.state==="opened"),Hr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),S._animationStateChanged.pipe(Gr(y=>y.state==="closed"),Hr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),Y.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Ya(this.backdropClick(),this.keydownEvents().pipe(Gr(y=>y.keyCode===27&&!this.disableClose&&!io(y)))).subscribe(y=>{this.disableClose||(y.preventDefault(),qf(this,y.type==="keydown"?"keyboard":"mouse"))})}close(Y){this._result=Y,this._containerInstance._animationStateChanged.pipe(Gr(v=>v.state==="closing"),Hr(1)).subscribe(v=>{this._beforeClosed.next(Y),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),v.totalTime+100)}),this._state=ed.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(Y){let v=this._ref.config.positionStrategy;return Y&&(Y.left||Y.right)?Y.left?v.left(Y.left):v.right(Y.right):v.centerHorizontally(),Y&&(Y.top||Y.bottom)?Y.top?v.top(Y.top):v.bottom(Y.bottom):v.centerVertically(),this._ref.updatePosition(),this}updateSize(Y="",v=""){return this._ref.updateSize(Y,v),this}addPanelClass(Y){return this._ref.addPanelClass(Y),this}removePanelClass(Y){return this._ref.removePanelClass(Y),this}getState(){return this._state}_finishDialogClose(){this._state=ed.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function qf(D,Y,v){return D._closeInteractionType=Y,D.close(v)}var np=new si("MatMdcDialogData"),g0=new si("mat-mdc-dialog-default-options"),_0=new si("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.block()}});var Qo=(()=>{class D{_overlay=me(Xr);_defaultOptions=me(g0,{optional:!0});_scrollStrategy=me(_0);_parentDialog=me(D,{optional:!0,skipSelf:!0});_idGenerator=me(Xo);_dialog=me(Ac);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Mi;_afterOpenedAtThisLevel=new Mi;dialogConfigClass=td;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let v=this._parentDialog;return v?v._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=Vh(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ln(void 0)));constructor(){this._dialogRefConstructor=Pc,this._dialogContainerType=f0,this._dialogDataToken=np}open(v,S){let y;S=Kt(Kt({},this._defaultOptions||new td),S),S.id=S.id||this._idGenerator.getId("mat-mdc-dialog-"),S.scrollStrategy=S.scrollStrategy||this._scrollStrategy();let c=this._dialog.open(v,In(Kt({},S),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:S},{provide:no,useValue:S}]},templateContext:()=>({dialogRef:y}),providers:(he,ze,Je)=>(y=new this._dialogRefConstructor(he,S,Je),y.updatePosition(S?.position),[{provide:this._dialogContainerType,useValue:Je},{provide:this._dialogDataToken,useValue:ze.data},{provide:this._dialogRefConstructor,useValue:y}])}));return y.componentRef=c.componentRef,y.componentInstance=c.componentInstance,this.openDialogs.push(y),this.afterOpened.next(y),y.afterClosed().subscribe(()=>{let he=this.openDialogs.indexOf(y);he>-1&&(this.openDialogs.splice(he,1),this.openDialogs.length||this._getAfterAllClosed().next())}),y}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(v){return this.openDialogs.find(S=>S.id===v)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(v){let S=v.length;for(;S--;)v[S].close()}static \u0275fac=function(S){return new(S||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),id=(()=>{class D{dialogRef=me(Pc,{optional:!0});_elementRef=me(Ar);_dialog=me(Qo);ariaLabel;type="button";dialogResult;_matDialogClose;constructor(){}ngOnInit(){this.dialogRef||(this.dialogRef=$f(this._elementRef,this._dialog.openDialogs))}ngOnChanges(v){let S=v._matDialogClose||v._matDialogCloseResult;S&&(this.dialogResult=S.currentValue)}_onButtonClick(v){qf(this.dialogRef,v.screenX===0&&v.screenY===0?"keyboard":"mouse",this.dialogResult)}static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-close",""],["","matDialogClose",""]],hostVars:2,hostBindings:function(S,y){S&1&&qt("click",function(he){return y._onButtonClick(he)}),S&2&&Zt("aria-label",y.ariaLabel||null)("type",y.type)},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],type:"type",dialogResult:[0,"mat-dialog-close","dialogResult"],_matDialogClose:[0,"matDialogClose","_matDialogClose"]},exportAs:["matDialogClose"],features:[Vu]})}return D})(),Uf=(()=>{class D{_dialogRef=me(Pc,{optional:!0});_elementRef=me(Ar);_dialog=me(Qo);constructor(){}ngOnInit(){this._dialogRef||(this._dialogRef=$f(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D})}return D})(),rd=(()=>{class D extends Uf{id=me(Xo).getId("mat-mdc-dialog-title-");_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}static \u0275fac=(()=>{let v;return function(y){return(v||(v=ia(D)))(y||D)}})();static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(S,y){S&2&&$h("id",y.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],features:[er]})}return D})(),nd=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],features:[uf([ep])]})}return D})(),ad=(()=>{class D extends Uf{align;_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}static \u0275fac=(()=>{let v;return function(y){return(v||(v=ia(D)))(y||D)}})();static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(S,y){S&2&&Qt("mat-mdc-dialog-actions-align-start",y.align==="start")("mat-mdc-dialog-actions-align-center",y.align==="center")("mat-mdc-dialog-actions-align-end",y.align==="end")},inputs:{align:"align"},features:[er]})}return D})();function $f(D,Y){let v=D.nativeElement.parentElement;for(;v&&!v.classList.contains("mat-mdc-dialog-container");)v=v.parentElement;return v?Y.find(S=>S.id===v.id):null}var od=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[Qo],imports:[Qh,ll,ca,Gt,Gt]})}return D})();var y0=["*"],sd;function v0(){if(sd===void 0&&(sd=null,typeof window<"u")){let D=window;D.trustedTypes!==void 0&&(sd=D.trustedTypes.createPolicy("angular#components",{createHTML:Y=>Y}))}return sd}function Dc(D){return v0()?.createHTML(D)||D}function Gf(D){return Error(`Unable to find icon with the name "${D}"`)}function b0(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function Hf(D){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${D}".`)}function Wf(D){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${D}".`)}var ha=class{url;svgText;options;svgElement;constructor(Y,v,S){this.url=Y,this.svgText=v,this.options=S}},x0=(()=>{class D{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(v,S,y,c){this._httpClient=v,this._sanitizer=S,this._errorHandler=c,this._document=y}addSvgIcon(v,S,y){return this.addSvgIconInNamespace("",v,S,y)}addSvgIconLiteral(v,S,y){return this.addSvgIconLiteralInNamespace("",v,S,y)}addSvgIconInNamespace(v,S,y,c){return this._addSvgIconConfig(v,S,new ha(y,null,c))}addSvgIconResolver(v){return this._resolvers.push(v),this}addSvgIconLiteralInNamespace(v,S,y,c){let he=this._sanitizer.sanitize(tl.HTML,y);if(!he)throw Wf(y);let ze=Dc(he);return this._addSvgIconConfig(v,S,new ha("",ze,c))}addSvgIconSet(v,S){return this.addSvgIconSetInNamespace("",v,S)}addSvgIconSetLiteral(v,S){return this.addSvgIconSetLiteralInNamespace("",v,S)}addSvgIconSetInNamespace(v,S,y){return this._addSvgIconSetConfig(v,new ha(S,null,y))}addSvgIconSetLiteralInNamespace(v,S,y){let c=this._sanitizer.sanitize(tl.HTML,S);if(!c)throw Wf(S);let he=Dc(c);return this._addSvgIconSetConfig(v,new ha("",he,y))}registerFontClassAlias(v,S=v){return this._fontCssClassesByAlias.set(v,S),this}classNameForFontAlias(v){return this._fontCssClassesByAlias.get(v)||v}setDefaultFontSetClass(...v){return this._defaultFontSetClass=v,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(v){let S=this._sanitizer.sanitize(tl.RESOURCE_URL,v);if(!S)throw Hf(v);let y=this._cachedIconsByUrl.get(S);return y?Er(ld(y)):this._loadSvgIconFromConfig(new ha(v,null)).pipe(En(c=>this._cachedIconsByUrl.set(S,c)),Tn(c=>ld(c)))}getNamedSvgIcon(v,S=""){let y=Xf(S,v),c=this._svgIconConfigs.get(y);if(c)return this._getSvgFromConfig(c);if(c=this._getIconConfigFromResolvers(S,v),c)return this._svgIconConfigs.set(y,c),this._getSvgFromConfig(c);let he=this._iconSetConfigs.get(S);return he?this._getSvgFromIconSetConfigs(v,he):nf(Gf(y))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(v){return v.svgText?Er(ld(this._svgElementFromConfig(v))):this._loadSvgIconFromConfig(v).pipe(Tn(S=>ld(S)))}_getSvgFromIconSetConfigs(v,S){let y=this._extractIconWithNameFromAnySet(v,S);if(y)return Er(y);let c=S.filter(he=>!he.svgText).map(he=>this._loadSvgIconSetFromConfig(he).pipe(of(ze=>{let ge=`Loading icon set URL: ${this._sanitizer.sanitize(tl.RESOURCE_URL,he.url)} failed: ${ze.message}`;return this._errorHandler.handleError(new Error(ge)),Er(null)})));return af(c).pipe(Tn(()=>{let he=this._extractIconWithNameFromAnySet(v,S);if(!he)throw Gf(v);return he}))}_extractIconWithNameFromAnySet(v,S){for(let y=S.length-1;y>=0;y--){let c=S[y];if(c.svgText&&c.svgText.toString().indexOf(v)>-1){let he=this._svgElementFromConfig(c),ze=this._extractSvgIconFromSet(he,v,c.options);if(ze)return ze}}return null}_loadSvgIconFromConfig(v){return this._fetchIcon(v).pipe(En(S=>v.svgText=S),Tn(()=>this._svgElementFromConfig(v)))}_loadSvgIconSetFromConfig(v){return v.svgText?Er(null):this._fetchIcon(v).pipe(En(S=>v.svgText=S))}_extractSvgIconFromSet(v,S,y){let c=v.querySelector(`[id="${S}"]`);if(!c)return null;let he=c.cloneNode(!0);if(he.removeAttribute("id"),he.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(he,y);if(he.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(he),y);let ze=this._svgElementFromString(Dc("<svg></svg>"));return ze.appendChild(he),this._setSvgAttributes(ze,y)}_svgElementFromString(v){let S=this._document.createElement("DIV");S.innerHTML=v;let y=S.querySelector("svg");if(!y)throw Error("<svg> tag not found");return y}_toSvgElement(v){let S=this._svgElementFromString(Dc("<svg></svg>")),y=v.attributes;for(let c=0;c<y.length;c++){let{name:he,value:ze}=y[c];he!=="id"&&S.setAttribute(he,ze)}for(let c=0;c<v.childNodes.length;c++)v.childNodes[c].nodeType===this._document.ELEMENT_NODE&&S.appendChild(v.childNodes[c].cloneNode(!0));return S}_setSvgAttributes(v,S){return v.setAttribute("fit",""),v.setAttribute("height","100%"),v.setAttribute("width","100%"),v.setAttribute("preserveAspectRatio","xMidYMid meet"),v.setAttribute("focusable","false"),S&&S.viewBox&&v.setAttribute("viewBox",S.viewBox),v}_fetchIcon(v){let{url:S,options:y}=v,c=y?.withCredentials??!1;if(!this._httpClient)throw b0();if(S==null)throw Error(`Cannot fetch icon from URL "${S}".`);let he=this._sanitizer.sanitize(tl.RESOURCE_URL,S);if(!he)throw Hf(S);let ze=this._inProgressUrlFetches.get(he);if(ze)return ze;let Je=this._httpClient.get(he,{responseType:"text",withCredentials:c}).pipe(Tn(ge=>Dc(ge)),sf(()=>this._inProgressUrlFetches.delete(he)),lf());return this._inProgressUrlFetches.set(he,Je),Je}_addSvgIconConfig(v,S,y){return this._svgIconConfigs.set(Xf(v,S),y),this}_addSvgIconSetConfig(v,S){let y=this._iconSetConfigs.get(v);return y?y.push(S):this._iconSetConfigs.set(v,[S]),this}_svgElementFromConfig(v){if(!v.svgElement){let S=this._svgElementFromString(v.svgText);this._setSvgAttributes(S,v.options),v.svgElement=S}return v.svgElement}_getIconConfigFromResolvers(v,S){for(let y=0;y<this._resolvers.length;y++){let c=this._resolvers[y](S,v);if(c)return w0(c)?new ha(c.url,null,c.options):new ha(c,null)}}static \u0275fac=function(S){return new(S||D)(kc(Hh,8),kc(yf),kc(Go,8),kc(Nh))};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function ld(D){return D.cloneNode(!0)}function Xf(D,Y){return D+":"+Y}function w0(D){return!!(D.url&&D.options)}var k0=new si("MAT_ICON_DEFAULT_OPTIONS"),C0=new si("mat-icon-location",{providedIn:"root",factory:S0});function S0(){let D=me(Go),Y=D?D.location:null;return{getPathname:()=>Y?Y.pathname+Y.search:""}}var Kf=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],M0=Kf.map(D=>`[${D}]`).join(", "),I0=/^url\(['"]?#(.*?)['"]?\)$/,zn=(()=>{class D{_elementRef=me(Ar);_iconRegistry=me(x0);_location=me(C0);_errorHandler=me(Nh);_defaultColor;get color(){return this._color||this._defaultColor}set color(v){this._color=v}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(v){v!==this._svgIcon&&(v?this._updateSvgIcon(v):this._svgIcon&&this._clearSvgElement(),this._svgIcon=v)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(v){let S=this._cleanupFontValue(v);S!==this._fontSet&&(this._fontSet=S,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(v){let S=this._cleanupFontValue(v);S!==this._fontIcon&&(this._fontIcon=S,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Ka.EMPTY;constructor(){let v=me(new hf("aria-hidden"),{optional:!0}),S=me(k0,{optional:!0});S&&(S.color&&(this.color=this._defaultColor=S.color),S.fontSet&&(this.fontSet=S.fontSet)),v||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(v){if(!v)return["",""];let S=v.split(":");switch(S.length){case 1:return["",S[0]];case 2:return S;default:throw Error(`Invalid icon name: "${v}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let v=this._elementsWithExternalReferences;if(v&&v.size){let S=this._location.getPathname();S!==this._previousPath&&(this._previousPath=S,this._prependPathToReferences(S))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(v){this._clearSvgElement();let S=this._location.getPathname();this._previousPath=S,this._cacheChildrenWithExternalReferences(v),this._prependPathToReferences(S),this._elementRef.nativeElement.appendChild(v)}_clearSvgElement(){let v=this._elementRef.nativeElement,S=v.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();S--;){let y=v.childNodes[S];(y.nodeType!==1||y.nodeName.toLowerCase()==="svg")&&y.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let v=this._elementRef.nativeElement,S=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(y=>y.length>0);this._previousFontSetClass.forEach(y=>v.classList.remove(y)),S.forEach(y=>v.classList.add(y)),this._previousFontSetClass=S,this.fontIcon!==this._previousFontIconClass&&!S.includes("mat-ligature-font")&&(this._previousFontIconClass&&v.classList.remove(this._previousFontIconClass),this.fontIcon&&v.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(v){return typeof v=="string"?v.trim().split(" ")[0]:v}_prependPathToReferences(v){let S=this._elementsWithExternalReferences;S&&S.forEach((y,c)=>{y.forEach(he=>{c.setAttribute(he.name,`url('${v}#${he.value}')`)})})}_cacheChildrenWithExternalReferences(v){let S=v.querySelectorAll(M0),y=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let c=0;c<S.length;c++)Kf.forEach(he=>{let ze=S[c],Je=ze.getAttribute(he),ge=Je?Je.match(I0):null;if(ge){let le=y.get(ze);le||(le=[],y.set(ze,le)),le.push({name:he,value:ge[1]})}})}_updateSvgIcon(v){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),v){let[S,y]=this._splitIconName(v);S&&(this._svgNamespace=S),y&&(this._svgName=y),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(y,S).pipe(Hr(1)).subscribe(c=>this._setSvgElement(c),c=>{let he=`Error retrieving icon ${S}:${y}! ${c.message}`;this._errorHandler.handleError(new Error(he))})}}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(S,y){S&2&&(Zt("data-mat-icon-type",y._usingFontIcon()?"font":"svg")("data-mat-icon-name",y._svgName||y.fontIcon)("data-mat-icon-namespace",y._svgNamespace||y.fontSet)("fontIcon",y._usingFontIcon()?y.fontIcon:null),qo(y.color?"mat-"+y.color:""),Qt("mat-icon-inline",y.inline)("mat-icon-no-color",y.color!=="primary"&&y.color!=="accent"&&y.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Zo],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[Cc],ngContentSelectors:y0,decls:1,vars:0,template:function(S,y){S&1&&(Pn(),hn(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return D})(),Ln=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Gt]})}return D})();var D0=["mat-menu-item",""],z0=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],L0=["mat-icon, [matMenuItemIcon]","*"];function R0(D,Y){D&1&&(Nu(),Ne(0,"svg",2),cn(1,"polygon",3),$e())}var F0=["*"];function B0(D,Y){if(D&1){let v=Ii();Ne(0,"div",0),qt("click",function(){Nt(v);let y=rt();return jt(y.closed.emit("click"))})("animationstart",function(y){Nt(v);let c=rt();return jt(c._onAnimationStart(y.animationName))})("animationend",function(y){Nt(v);let c=rt();return jt(c._onAnimationDone(y.animationName))})("animationcancel",function(y){Nt(v);let c=rt();return jt(c._onAnimationDone(y.animationName))}),Ne(1,"div",1),hn(2),$e()()}if(D&2){let v=rt();qo(v._classList),Qt("mat-menu-panel-animations-disabled",v._animationsDisabled)("mat-menu-panel-exit-animation",v._panelAnimationState==="void")("mat-menu-panel-animating",v._isAnimating),Dt("id",v.panelId),Zt("aria-label",v.ariaLabel||null)("aria-labelledby",v.ariaLabelledby||null)("aria-describedby",v.ariaDescribedby||null)}}var op=new si("MAT_MENU_PANEL"),Lc=(()=>{class D{_elementRef=me(Ar);_document=me(Go);_focusMonitor=me(Wo);_parentMenu=me(op,{optional:!0});_changeDetectorRef=me(eo);role="menuitem";disabled=!1;disableRipple=!1;_hovered=new Mi;_focused=new Mi;_highlighted=!1;_triggersSubmenu=!1;constructor(){me(Sc).load(Ic),this._parentMenu?.addItem?.(this)}focus(v,S){this._focusMonitor&&v?this._focusMonitor.focusVia(this._getHostElement(),v,S):this._getHostElement().focus(S),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(v){this.disabled&&(v.preventDefault(),v.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let v=this._elementRef.nativeElement.cloneNode(!0),S=v.querySelectorAll("mat-icon, .material-icons");for(let y=0;y<S.length;y++)S[y].remove();return v.textContent?.trim()||""}_setHighlighted(v){this._highlighted=v,this._changeDetectorRef.markForCheck()}_setTriggersSubmenu(v){this._triggersSubmenu=v,this._changeDetectorRef.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-focus-indicator"],hostVars:8,hostBindings:function(S,y){S&1&&qt("click",function(he){return y._checkDisabled(he)})("mouseenter",function(){return y._handleMouseEnter()}),S&2&&(Zt("role",y.role)("tabindex",y._getTabIndex())("aria-disabled",y.disabled)("disabled",y.disabled||null),Qt("mat-mdc-menu-item-highlighted",y._highlighted)("mat-mdc-menu-item-submenu-trigger",y._triggersSubmenu))},inputs:{role:"role",disabled:[2,"disabled","disabled",Zo],disableRipple:[2,"disableRipple","disableRipple",Zo]},exportAs:["matMenuItem"],features:[Cc],attrs:D0,ngContentSelectors:L0,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(S,y){S&1&&(Pn(z0),hn(0),Ne(1,"span",0),hn(2,1),$e(),cn(3,"div",1),Mt(4,R0,2,0,":svg:svg",2)),S&2&&(Ye(3),Dt("matRippleDisabled",y.disableRipple||y.disabled)("matRippleTrigger",y._getHostElement()),Ye(),Yt(y._triggersSubmenu?4:-1))},dependencies:[Yh],encapsulation:2,changeDetection:0})}return D})();var O0=new si("MatMenuContent");var V0=new si("mat-menu-default-options",{providedIn:"root",factory:N0});function N0(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var ap="_mat-menu-enter",hd="_mat-menu-exit",cl=(()=>{class D{_elementRef=me(Ar);_changeDetectorRef=me(eo);_injector=me(Ja);_keyManager;_xPosition;_yPosition;_firstItemFocusRef;_exitFallbackTimeout;_animationsDisabled;_allItems;_directDescendantItems=new jh;_classList={};_panelAnimationState="void";_animationDone=new Mi;_isAnimating=!1;parentMenu;direction;overlayPanelClass;backdropClass;ariaLabel;ariaLabelledby;ariaDescribedby;get xPosition(){return this._xPosition}set xPosition(v){this._xPosition=v,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(v){this._yPosition=v,this.setPositionClasses()}templateRef;items;lazyContent;overlapTrigger;hasBackdrop;set panelClass(v){let S=this._previousPanelClass,y=Kt({},this._classList);S&&S.length&&S.split(" ").forEach(c=>{y[c]=!1}),this._previousPanelClass=v,v&&v.length&&(v.split(" ").forEach(c=>{y[c]=!0}),this._elementRef.nativeElement.className=""),this._classList=y}_previousPanelClass;get classList(){return this.panelClass}set classList(v){this.panelClass=v}closed=new An;close=this.closed;panelId=me(Xo).getId("mat-menu-panel-");constructor(){let v=me(V0);this.overlayPanelClass=v.overlayPanelClass||"",this._xPosition=v.xPosition,this._yPosition=v.yPosition,this.backdropClass=v.backdropClass,this.overlapTrigger=v.overlapTrigger,this.hasBackdrop=v.hasBackdrop,this._animationsDisabled=me(Qs,{optional:!0})==="NoopAnimations"}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new kf(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(ln(this._directDescendantItems),No(v=>Ya(...v.map(S=>S._focused)))).subscribe(v=>this._keyManager.updateActiveItem(v)),this._directDescendantItems.changes.subscribe(v=>{let S=this._keyManager;if(this._panelAnimationState==="enter"&&S.activeItem?._hasFocus()){let y=v.toArray(),c=Math.max(0,Math.min(y.length-1,S.activeItemIndex||0));y[c]&&!y[c].disabled?S.setActiveItem(c):S.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusRef?.destroy(),clearTimeout(this._exitFallbackTimeout)}_hovered(){return this._directDescendantItems.changes.pipe(ln(this._directDescendantItems),No(S=>Ya(...S.map(y=>y._hovered))))}addItem(v){}removeItem(v){}_handleKeydown(v){let S=v.keyCode,y=this._keyManager;switch(S){case 27:io(v)||(v.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(S===38||S===40)&&y.setFocusOrigin("keyboard"),y.onKeydown(v);return}}focusFirstItem(v="program"){this._firstItemFocusRef?.destroy(),this._firstItemFocusRef=el(()=>{let S=this._resolvePanel();if(!S||!S.contains(document.activeElement)){let y=this._keyManager;y.setFocusOrigin(v).setFirstItemActive(),!y.activeItem&&S&&S.focus()}},{injector:this._injector})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(v){}setPositionClasses(v=this.xPosition,S=this.yPosition){this._classList=In(Kt({},this._classList),{"mat-menu-before":v==="before","mat-menu-after":v==="after","mat-menu-above":S==="above","mat-menu-below":S==="below"}),this._changeDetectorRef.markForCheck()}_onAnimationDone(v){let S=v===hd;(S||v===ap)&&(S&&(clearTimeout(this._exitFallbackTimeout),this._exitFallbackTimeout=void 0),this._animationDone.next(S?"void":"enter"),this._isAnimating=!1)}_onAnimationStart(v){(v===ap||v===hd)&&(this._isAnimating=!0)}_setIsOpen(v){if(this._panelAnimationState=v?"enter":"void",v){if(this._keyManager.activeItemIndex===0){let S=this._resolvePanel();S&&(S.scrollTop=0)}}else this._animationsDisabled||(this._exitFallbackTimeout=setTimeout(()=>this._onAnimationDone(hd),200));this._animationsDisabled&&setTimeout(()=>{this._onAnimationDone(v?ap:hd)}),this._changeDetectorRef.markForCheck()}_updateDirectDescendants(){this._allItems.changes.pipe(ln(this._allItems)).subscribe(v=>{this._directDescendantItems.reset(v.filter(S=>S._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}_resolvePanel(){let v=null;return this._directDescendantItems.length&&(v=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),v}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["mat-menu"]],contentQueries:function(S,y,c){if(S&1&&(dn(c,O0,5),dn(c,Lc,5),dn(c,Lc,4)),S&2){let he;ji(he=qi())&&(y.lazyContent=he.first),ji(he=qi())&&(y._allItems=he),ji(he=qi())&&(y.items=he)}},viewQuery:function(S,y){if(S&1&&na(jo,5),S&2){let c;ji(c=qi())&&(y.templateRef=c.first)}},hostVars:3,hostBindings:function(S,y){S&2&&Zt("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[2,"overlapTrigger","overlapTrigger",Zo],hasBackdrop:[2,"hasBackdrop","hasBackdrop",v=>v==null?null:Zo(v)],panelClass:[0,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],features:[$o([{provide:op,useExisting:D}]),Cc],ngContentSelectors:F0,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel",3,"click","animationstart","animationend","animationcancel","id"],[1,"mat-mdc-menu-content"]],template:function(S,y){S&1&&(Pn(),Mt(0,B0,3,12,"ng-template"))},styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;outline:0}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-menu-item-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-menu-item-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-menu-item-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-menu-item-label-text-weight, var(--mat-sys-label-large-weight))}@keyframes _mat-menu-enter{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:none}}@keyframes _mat-menu-exit{from{opacity:1}to{opacity:0}}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;box-sizing:border-box;outline:0;animation:_mat-menu-enter 120ms cubic-bezier(0, 0, 0.2, 1);border-radius:var(--mat-menu-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-menu-container-color, var(--mat-sys-surface-container));box-shadow:var(--mat-menu-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));will-change:transform,opacity}.mat-mdc-menu-panel.mat-menu-panel-exit-animation{animation:_mat-menu-exit 100ms 25ms linear forwards}.mat-mdc-menu-panel.mat-menu-panel-animations-disabled{animation:none}.mat-mdc-menu-panel.mat-menu-panel-animating{pointer-events:none}.mat-mdc-menu-panel.mat-menu-panel-animating:has(.mat-mdc-menu-content:empty){display:none}@media(forced-colors: active){.mat-mdc-menu-panel{outline:solid 1px}}.mat-mdc-menu-panel .mat-divider{color:var(--mat-menu-divider-color, var(--mat-sys-surface-variant));margin-bottom:var(--mat-menu-divider-bottom-spacing, 8px);margin-top:var(--mat-menu-divider-top-spacing, 8px)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;min-height:48px;padding-left:var(--mat-menu-item-leading-spacing, 12px);padding-right:var(--mat-menu-item-trailing-spacing, 12px);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-menu-item::-moz-focus-inner{border:0}[dir=rtl] .mat-mdc-menu-item{padding-left:var(--mat-menu-item-trailing-spacing, 12px);padding-right:var(--mat-menu-item-leading-spacing, 12px)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-trailing-spacing, 12px)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-trailing-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-leading-spacing, 12px)}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color, var(--mat-sys-on-surface))}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item:focus{outline:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing, 12px);height:var(--mat-menu-item-icon-size, 24px);width:var(--mat-menu-item-icon-size, 24px)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing, 12px)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent))}@media(forced-colors: active){.mat-mdc-menu-item{margin-top:1px}}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size, 24px);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing, 12px)}[dir=rtl] .mat-mdc-menu-submenu-icon{padding-right:var(--mat-menu-item-spacing, 12px);padding-left:0}[dir=rtl] .mat-mdc-menu-submenu-icon polygon{transform:scaleX(-1);transform-origin:center}@media(forced-colors: active){.mat-mdc-menu-submenu-icon{fill:CanvasText}}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,changeDetection:0})}return D})(),eg=new si("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.reposition()}});function j0(D){return()=>D.scrollStrategies.reposition()}var q0={provide:eg,deps:[Xr],useFactory:j0},Yf=vf({passive:!0});var zc=new WeakMap,tg=(()=>{class D{_overlay=me(Xr);_element=me(Ar);_viewContainerRef=me(Uh);_menuItemInstance=me(Lc,{optional:!0,self:!0});_dir=me(Mc,{optional:!0});_focusMonitor=me(Wo);_ngZone=me(Js);_scrollStrategy=me(eg);_changeDetectorRef=me(eo);_portal;_overlayRef=null;_menuOpen=!1;_closingActionsSubscription=Ka.EMPTY;_hoverSubscription=Ka.EMPTY;_menuCloseSubscription=Ka.EMPTY;_pendingRemoval;_parentMaterialMenu;_parentInnerPadding;_handleTouchStart=v=>{If(v)||(this._openedBy="touch")};_openedBy=void 0;get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(v){this.menu=v}get menu(){return this._menu}set menu(v){v!==this._menu&&(this._menu=v,this._menuCloseSubscription.unsubscribe(),v&&(this._parentMaterialMenu,this._menuCloseSubscription=v.close.subscribe(S=>{this._destroyMenu(S),(S==="click"||S==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(S)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}_menu;menuData;restoreFocus=!0;menuOpened=new An;onMenuOpen=this.menuOpened;menuClosed=new An;onMenuClose=this.menuClosed;constructor(){let v=me(op,{optional:!0});this._parentMaterialMenu=v instanceof cl?v:void 0,this._element.nativeElement.addEventListener("touchstart",this._handleTouchStart,Yf)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this.menu&&this._ownsMenu(this.menu)&&zc.delete(this.menu),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,Yf),this._pendingRemoval?.unsubscribe(),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe(),this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null)}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let v=this.menu;if(this._menuOpen||!v)return;this._pendingRemoval?.unsubscribe();let S=zc.get(v);zc.set(v,this),S&&S!==this&&S.closeMenu();let y=this._createOverlay(v),c=y.getConfig(),he=c.positionStrategy;this._setPosition(v,he),c.hasBackdrop=v.hasBackdrop==null?!this.triggersSubmenu():v.hasBackdrop,y.hasAttached()||(y.attach(this._getPortal(v)),v.lazyContent?.attach(this.menuData)),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),v.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,v.direction=this.dir,v.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0),v instanceof cl&&(v._setIsOpen(!0),v._directDescendantItems.changes.pipe(Ys(v.close)).subscribe(()=>{he.withLockedPosition(!1).reapplyLastPosition(),he.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(v,S){this._focusMonitor&&v?this._focusMonitor.focusVia(this._element,v,S):this._element.nativeElement.focus(S)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(v){let S=this._overlayRef,y=this._menu;!S||!this.menuOpen||(this._closingActionsSubscription.unsubscribe(),this._pendingRemoval?.unsubscribe(),y instanceof cl&&this._ownsMenu(y)?(this._pendingRemoval=y._animationDone.pipe(Hr(1)).subscribe(()=>{S.detach(),y.lazyContent?.detach()}),y._setIsOpen(!1)):(S.detach(),y?.lazyContent?.detach()),y&&this._ownsMenu(y)&&zc.delete(y),this.restoreFocus&&(v==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,this._setIsMenuOpen(!1))}_setIsMenuOpen(v){v!==this._menuOpen&&(this._menuOpen=v,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(v),this._changeDetectorRef.markForCheck())}_createOverlay(v){if(!this._overlayRef){let S=this._getOverlayConfig(v);this._subscribeToPositions(v,S.positionStrategy),this._overlayRef=this._overlay.create(S),this._overlayRef.keydownEvents().subscribe(y=>{this.menu instanceof cl&&this.menu._handleKeydown(y)})}return this._overlayRef}_getOverlayConfig(v){return new Jh({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:v.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:v.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir||"ltr"})}_subscribeToPositions(v,S){v.setPositionClasses&&S.positionChanges.subscribe(y=>{this._ngZone.run(()=>{let c=y.connectionPair.overlayX==="start"?"after":"before",he=y.connectionPair.overlayY==="top"?"below":"above";v.setPositionClasses(c,he)})})}_setPosition(v,S){let[y,c]=v.xPosition==="before"?["end","start"]:["start","end"],[he,ze]=v.yPosition==="above"?["bottom","top"]:["top","bottom"],[Je,ge]=[he,ze],[le,ur]=[y,c],Ei=0;if(this.triggersSubmenu()){if(ur=y=v.xPosition==="before"?"start":"end",c=le=y==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let Ui=this._parentMaterialMenu.items.first;this._parentInnerPadding=Ui?Ui._getHostElement().offsetTop:0}Ei=he==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else v.overlapTrigger||(Je=he==="top"?"bottom":"top",ge=ze==="top"?"bottom":"top");S.withPositions([{originX:y,originY:Je,overlayX:le,overlayY:he,offsetY:Ei},{originX:c,originY:Je,overlayX:ur,overlayY:he,offsetY:Ei},{originX:y,originY:ge,overlayX:le,overlayY:ze,offsetY:-Ei},{originX:c,originY:ge,overlayX:ur,overlayY:ze,offsetY:-Ei}])}_menuClosingActions(){let v=this._overlayRef.backdropClick(),S=this._overlayRef.detachments(),y=this._parentMaterialMenu?this._parentMaterialMenu.closed:Er(),c=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(Gr(he=>this._menuOpen&&he!==this._menuItemInstance)):Er();return Ya(v,y,c,S)}_handleMousedown(v){Mf(v)||(this._openedBy=v.button===0?"mouse":void 0,this.triggersSubmenu()&&v.preventDefault())}_handleKeydown(v){let S=v.keyCode;(S===13||S===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(S===39&&this.dir==="ltr"||S===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(v){this.triggersSubmenu()?(v.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){this.triggersSubmenu()&&this._parentMaterialMenu&&(this._hoverSubscription=this._parentMaterialMenu._hovered().subscribe(v=>{v===this._menuItemInstance&&!v.disabled&&(this._openedBy="mouse",this.openMenu())}))}_getPortal(v){return(!this._portal||this._portal.templateRef!==v.templateRef)&&(this._portal=new sl(v.templateRef,this._viewContainerRef)),this._portal}_ownsMenu(v){return zc.get(v)===this}static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(S,y){S&1&&qt("click",function(he){return y._handleClick(he)})("mousedown",function(he){return y._handleMousedown(he)})("keydown",function(he){return y._handleKeydown(he)}),S&2&&Zt("aria-haspopup",y.menu?"menu":null)("aria-expanded",y.menuOpen)("aria-controls",y.menuOpen?y.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[0,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[0,"matMenuTriggerFor","menu"],menuData:[0,"matMenuTriggerData","menuData"],restoreFocus:[0,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"]})}return D})(),dd=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[q0],imports:[al,Gt,ll,Tc,Gt]})}return D})(),ig={transformMenu:Ko("transformMenu",[ol("void",Wr({opacity:0,transform:"scale(0.8)"})),sa("void => enter",oa("120ms cubic-bezier(0, 0, 0.2, 1)",Wr({opacity:1,transform:"scale(1)"}))),sa("* => void",oa("100ms 25ms linear",Wr({opacity:0})))]),fadeInItems:Ko("fadeInItems",[ol("showing",Wr({opacity:1})),sa("void => *",[Wr({opacity:0}),oa("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},rv=ig.fadeInItems,nv=ig.transformMenu;var rg=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Tc,Tc,Gt]})}return D})();function $0(D,Y){if(D&1&&Uo(0,2),D&2){let v=rt();Dt("ngTemplateOutlet",v.iconOverrides[v.state])("ngTemplateOutletContext",v._getIconContext())}}function Z0(D,Y){if(D&1&&(Ne(0,"span",7),nt(1),$e()),D&2){let v=rt(2);Ye(),tr(v._getDefaultTextForState(v.state))}}function G0(D,Y){if(D&1&&(Ne(0,"span",8),nt(1),$e()),D&2){let v=rt(3);Ye(),tr(v._intl.completedLabel)}}function H0(D,Y){if(D&1&&(Ne(0,"span",8),nt(1),$e()),D&2){let v=rt(3);Ye(),tr(v._intl.editableLabel)}}function W0(D,Y){if(D&1&&(Mt(0,G0,2,1,"span",8)(1,H0,2,1,"span",8),Ne(2,"mat-icon",7),nt(3),$e()),D&2){let v=rt(2);Yt(v.state==="done"?0:v.state==="edit"?1:-1),Ye(3),tr(v._getDefaultTextForState(v.state))}}function X0(D,Y){if(D&1&&Mt(0,Z0,2,1,"span",7)(1,W0,4,2),D&2){let v,S=rt();Yt((v=S.state)==="number"?0:1)}}function K0(D,Y){D&1&&(Ne(0,"div",4),Uo(1,9),$e()),D&2&&(Ye(),Dt("ngTemplateOutlet",Y.template))}function Y0(D,Y){if(D&1&&(Ne(0,"div",4),nt(1),$e()),D&2){let v=rt();Ye(),tr(v.label)}}function J0(D,Y){if(D&1&&(Ne(0,"div",5),nt(1),$e()),D&2){let v=rt();Ye(),tr(v._intl.optionalLabel)}}function Q0(D,Y){if(D&1&&(Ne(0,"div",6),nt(1),$e()),D&2){let v=rt();Ye(),tr(v.errorMessage)}}var ng=["*"];function e1(D,Y){}function t1(D,Y){if(D&1&&(hn(0),Mt(1,e1,0,0,"ng-template",0)),D&2){let v=rt();Ye(),Dt("cdkPortalOutlet",v._portal)}}var i1=["animatedContainer"],ag=(D,Y)=>({step:D,i:Y});function r1(D,Y){D&1&&hn(0)}function n1(D,Y){D&1&&cn(0,"div",7)}function a1(D,Y){if(D&1&&(Uo(0,6),Mt(1,n1,1,0,"div",7)),D&2){let v=Y.$implicit,S=Y.$index,y=Y.$index,c=Y.$count;rt(2);let he=aa(4);Dt("ngTemplateOutlet",he)("ngTemplateOutletContext",qu(3,ag,v,S)),Ye(),Yt(y!==c-1?1:-1)}}function o1(D,Y){if(D&1&&(Ne(0,"div",8,1),Uo(2,9),$e()),D&2){let v=Y.$implicit,S=Y.$index,y=rt(2);qo("mat-horizontal-stepper-content-"+y._getAnimationDirection(S)),Dt("id",y._getStepContentId(S)),Zt("aria-labelledby",y._getStepLabelId(S))("inert",y.selectedIndex===S?null:""),Ye(2),Dt("ngTemplateOutlet",v.content)}}function s1(D,Y){if(D&1&&(Ne(0,"div",2)(1,"div",3),rl(2,a1,2,6,null,null,il),$e(),Ne(4,"div",4),rl(5,o1,3,6,"div",5,il),$e()()),D&2){let v=rt();Ye(2),nl(v.steps),Ye(3),nl(v.steps)}}function l1(D,Y){if(D&1&&(Ne(0,"div",10),Uo(1,6),Ne(2,"div",11,1)(4,"div",12)(5,"div",13),Uo(6,9),$e()()()()),D&2){let v=Y.$implicit,S=Y.$index,y=Y.$index,c=Y.$count,he=rt(2),ze=aa(4);Ye(),Dt("ngTemplateOutlet",ze)("ngTemplateOutletContext",qu(10,ag,v,S)),Ye(),Qt("mat-stepper-vertical-line",y!==c-1)("mat-vertical-content-container-active",he.selectedIndex===S),Zt("inert",he.selectedIndex===S?null:""),Ye(2),Dt("id",he._getStepContentId(S)),Zt("aria-labelledby",he._getStepLabelId(S)),Ye(2),Dt("ngTemplateOutlet",v.content)}}function c1(D,Y){if(D&1&&rl(0,l1,7,13,"div",10,il),D&2){let v=rt();nl(v.steps)}}function h1(D,Y){if(D&1){let v=Ii();Ne(0,"mat-step-header",14),qt("click",function(){let y=Nt(v).step;return jt(y.select())})("keydown",function(y){Nt(v);let c=rt();return jt(c._onKeydown(y))}),$e()}if(D&2){let v=Y.step,S=Y.i,y=rt();Qt("mat-horizontal-stepper-header",y.orientation==="horizontal")("mat-vertical-stepper-header",y.orientation==="vertical"),Dt("tabIndex",y._getFocusIndex()===S?0:-1)("id",y._getStepLabelId(S))("index",S)("state",y._getIndicatorType(S,v.state))("label",v.stepLabel||v.label)("selected",y.selectedIndex===S)("active",y._stepIsNavigable(S,v))("optional",v.optional)("errorMessage",v.errorMessage)("iconOverrides",y._iconOverrides)("disableRipple",y.disableRipple||!y._stepIsNavigable(S,v))("color",v.color||y.color),Zt("aria-posinset",S+1)("aria-setsize",y.steps.length)("aria-controls",y._getStepContentId(S))("aria-selected",y.selectedIndex==S)("aria-label",v.ariaLabel||null)("aria-labelledby",!v.ariaLabel&&v.ariaLabelledby?v.ariaLabelledby:null)("aria-disabled",y._stepIsNavigable(S,v)?null:!0)}}var sp=(()=>{class D extends Af{static \u0275fac=(()=>{let v;return function(y){return(v||(v=ia(D)))(y||D)}})();static \u0275dir=Pr({type:D,selectors:[["","matStepLabel",""]],features:[er]})}return D})(),ud=(()=>{class D{changes=new Mi;optionalLabel="Optional";completedLabel="Completed";editableLabel="Editable";static \u0275fac=function(S){return new(S||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function d1(D){return D||new ud}var u1={provide:ud,deps:[[new Bu,new Ou,ud]],useFactory:d1},lp=(()=>{class D extends Ef{_intl=me(ud);_focusMonitor=me(Wo);_intlSubscription;state;label;errorMessage;iconOverrides;index;selected;active;optional;disableRipple;color;constructor(){super(),me(Sc).load(Ic),me(Sc).load(bf);let v=me(eo);this._intlSubscription=this._intl.changes.subscribe(()=>v.markForCheck())}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._intlSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._elementRef)}focus(v,S){v?this._focusMonitor.focusVia(this._elementRef,v,S):this._elementRef.nativeElement.focus(S)}_stringLabel(){return this.label instanceof sp?null:this.label}_templateLabel(){return this.label instanceof sp?this.label:null}_getHostElement(){return this._elementRef.nativeElement}_getIconContext(){return{index:this.index,active:this.active,optional:this.optional}}_getDefaultTextForState(v){return v=="number"?`${this.index+1}`:v=="edit"?"create":v=="error"?"warning":v}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["mat-step-header"]],hostAttrs:["role","tab",1,"mat-step-header"],hostVars:2,hostBindings:function(S,y){S&2&&qo("mat-"+(y.color||"primary"))},inputs:{state:"state",label:"label",errorMessage:"errorMessage",iconOverrides:"iconOverrides",index:"index",selected:"selected",active:"active",optional:"optional",disableRipple:"disableRipple",color:"color"},features:[er],decls:10,vars:17,consts:[["matRipple","",1,"mat-step-header-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-step-icon-content"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-step-label"],[1,"mat-step-text-label"],[1,"mat-step-optional"],[1,"mat-step-sub-label-error"],["aria-hidden","true"],[1,"cdk-visually-hidden"],[3,"ngTemplateOutlet"]],template:function(S,y){if(S&1&&(cn(0,"div",0),Ne(1,"div")(2,"div",1),Mt(3,$0,1,2,"ng-container",2)(4,X0,2,1),$e()(),Ne(5,"div",3),Mt(6,K0,2,1,"div",4)(7,Y0,2,1,"div",4)(8,J0,2,1,"div",5)(9,Q0,2,1,"div",6),$e()),S&2){let c;Dt("matRippleTrigger",y._getHostElement())("matRippleDisabled",y.disableRipple),Ye(),pf("mat-step-icon-state-",y.state," mat-step-icon"),Qt("mat-step-icon-selected",y.selected),Ye(2),Yt(y.iconOverrides&&y.iconOverrides[y.state]?3:4),Ye(2),Qt("mat-step-label-active",y.active)("mat-step-label-selected",y.selected)("mat-step-label-error",y.state=="error"),Ye(),Yt((c=y._templateLabel())?6:y._stringLabel()?7:-1,c),Ye(2),Yt(y.optional&&y.state!="error"?8:-1),Ye(),Yt(y.state==="error"?9:-1)}},dependencies:[Yh,$u,zn],styles:['.mat-step-header{overflow:hidden;outline:none;cursor:pointer;position:relative;box-sizing:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-step-header:focus .mat-focus-indicator::before{content:""}.mat-step-header:hover[aria-disabled=true]{cursor:default}.mat-step-header:hover:not([aria-disabled]),.mat-step-header:hover[aria-disabled=false]{background-color:var(--mat-stepper-header-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-hover-state-layer-shape, var(--mat-sys-corner-medium))}.mat-step-header.cdk-keyboard-focused,.mat-step-header.cdk-program-focused{background-color:var(--mat-stepper-header-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-focus-state-layer-shape, var(--mat-sys-corner-medium))}@media(hover: none){.mat-step-header:hover{background:none}}@media(forced-colors: active){.mat-step-header{outline:solid 1px}.mat-step-header[aria-selected=true] .mat-step-label{text-decoration:underline}.mat-step-header[aria-disabled=true]{outline-color:GrayText}.mat-step-header[aria-disabled=true] .mat-step-label,.mat-step-header[aria-disabled=true] .mat-step-icon,.mat-step-header[aria-disabled=true] .mat-step-optional{color:GrayText}}.mat-step-optional{font-size:12px;color:var(--mat-stepper-header-optional-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-sub-label-error{font-size:12px;font-weight:normal}.mat-step-icon{border-radius:50%;height:24px;width:24px;flex-shrink:0;position:relative;color:var(--mat-stepper-header-icon-foreground-color, var(--mat-sys-surface));background-color:var(--mat-stepper-header-icon-background-color, var(--mat-sys-on-surface-variant))}.mat-step-icon-content{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex}.mat-step-icon .mat-icon{font-size:16px;height:16px;width:16px}.mat-step-icon-state-error{background-color:var(--mat-stepper-header-error-state-icon-background-color, transparent);color:var(--mat-stepper-header-error-state-icon-foreground-color, var(--mat-sys-error))}.mat-step-icon-state-error .mat-icon{font-size:24px;height:24px;width:24px}.mat-step-label{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:50px;vertical-align:middle;font-family:var(--mat-stepper-header-label-text-font, var(--mat-sys-title-small-font));font-size:var(--mat-stepper-header-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-label-text-weight, var(--mat-sys-title-small-weight));color:var(--mat-stepper-header-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-active{color:var(--mat-stepper-header-selected-state-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-error{color:var(--mat-stepper-header-error-state-label-text-color, var(--mat-sys-error));font-size:var(--mat-stepper-header-error-state-label-text-size, var(--mat-sys-title-small-size))}.mat-step-label.mat-step-label-selected{font-size:var(--mat-stepper-header-selected-state-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-selected-state-label-text-weight, var(--mat-sys-title-small-weight))}.mat-step-text-label{text-overflow:ellipsis;overflow:hidden}.mat-step-header .mat-step-header-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-step-icon-selected{background-color:var(--mat-stepper-header-selected-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-selected-state-icon-foreground-color, var(--mat-sys-on-primary))}.mat-step-icon-state-done{background-color:var(--mat-stepper-header-done-state-icon-background-color);color:var(--mat-stepper-header-done-state-icon-foreground-color)}.mat-step-icon-state-edit{background-color:var(--mat-stepper-header-edit-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-edit-state-icon-foreground-color, var(--mat-sys-on-primary))}'],encapsulation:2,changeDetection:0})}return D})(),cp=(()=>{class D{templateRef=me(jo);name;constructor(){}static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D,selectors:[["ng-template","matStepperIcon",""]],inputs:{name:[0,"matStepperIcon","name"]}})}return D})(),p1=(()=>{class D{_template=me(jo);constructor(){}static \u0275fac=function(S){return new(S||D)};static \u0275dir=Pr({type:D,selectors:[["ng-template","matStepContent",""]]})}return D})(),hp=(()=>{class D extends Gu{_errorStateMatcher=me(Kh,{skipSelf:!0});_viewContainerRef=me(Uh);_isSelected=Ka.EMPTY;stepLabel=void 0;color;_lazyContent;_portal;ngAfterContentInit(){this._isSelected=this._stepper.steps.changes.pipe(No(()=>this._stepper.selectionChange.pipe(Tn(v=>v.selectedStep===this),ln(this._stepper.selected===this)))).subscribe(v=>{v&&this._lazyContent&&!this._portal&&(this._portal=new sl(this._lazyContent._template,this._viewContainerRef))})}ngOnDestroy(){this._isSelected.unsubscribe()}isErrorState(v,S){let y=this._errorStateMatcher.isErrorState(v,S),c=!!(v&&v.invalid&&this.interacted);return y||c}static \u0275fac=(()=>{let v;return function(y){return(v||(v=ia(D)))(y||D)}})();static \u0275cmp=kt({type:D,selectors:[["mat-step"]],contentQueries:function(S,y,c){if(S&1&&(dn(c,sp,5),dn(c,p1,5)),S&2){let he;ji(he=qi())&&(y.stepLabel=he.first),ji(he=qi())&&(y._lazyContent=he.first)}},hostAttrs:["hidden",""],inputs:{color:"color"},exportAs:["matStep"],features:[$o([{provide:Kh,useExisting:D},{provide:Gu,useExisting:D}]),er],ngContentSelectors:ng,decls:1,vars:0,consts:[[3,"cdkPortalOutlet"]],template:function(S,y){S&1&&(Pn(),Mt(0,t1,2,1,"ng-template"))},dependencies:[la],encapsulation:2,changeDetection:0})}return D})(),dp=(()=>{class D extends Hu{_ngZone=me(Js);_renderer=me(qh);_animationsModule=me(Qs,{optional:!0});_cleanupTransition;_isAnimating=ra(!1);_stepHeader=void 0;_animatedContainers;_steps=void 0;steps=new jh;_icons;animationDone=new An;disableRipple;color;labelPosition="end";headerPosition="top";_iconOverrides={};get animationDuration(){return this._animationDuration}set animationDuration(v){this._animationDuration=/^\d+$/.test(v)?v+"ms":v}_animationDuration="";_isServer=!me(Wh).isBrowser;constructor(){super();let S=me(Ar).nativeElement.nodeName.toLowerCase();this.orientation=S==="mat-vertical-stepper"?"vertical":"horizontal"}ngAfterContentInit(){super.ngAfterContentInit(),this._icons.forEach(({name:v,templateRef:S})=>this._iconOverrides[v]=S),this.steps.changes.pipe(Ys(this._destroyed)).subscribe(()=>this._stateChanged()),this.selectedIndexChange.pipe(Ys(this._destroyed)).subscribe(()=>{let v=this._getAnimationDuration();v==="0ms"||v==="0s"?this._onAnimationDone():this._isAnimating.set(!0)}),this._ngZone.runOutsideAngular(()=>{this._animationsModule!=="NoopAnimations"&&setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-stepper-animations-enabled"),this._cleanupTransition=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._handleTransitionend)},200)})}ngAfterViewInit(){if(super.ngAfterViewInit(),typeof queueMicrotask=="function"){let v=!1;this._animatedContainers.changes.pipe(ln(null),Ys(this._destroyed)).subscribe(()=>queueMicrotask(()=>{v||(v=!0,this.animationDone.emit()),this._stateChanged()}))}}ngOnDestroy(){super.ngOnDestroy(),this._cleanupTransition?.()}_stepIsNavigable(v,S){return S.completed||this.selectedIndex===v||!this.linear}_getAnimationDuration(){return this._animationsModule==="NoopAnimations"?"0ms":this.animationDuration?this.animationDuration:this.orientation==="horizontal"?"500ms":"225ms"}_handleTransitionend=v=>{let S=v.target;if(!S)return;let y=this.orientation==="horizontal"&&v.propertyName==="transform"&&S.classList.contains("mat-horizontal-stepper-content-current"),c=this.orientation==="vertical"&&v.propertyName==="grid-template-rows"&&S.classList.contains("mat-vertical-content-container-active");(y||c)&&this._animatedContainers.find(ze=>ze.nativeElement===S)&&this._onAnimationDone()};_onAnimationDone(){this._isAnimating.set(!1),this.animationDone.emit()}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["mat-stepper"],["mat-vertical-stepper"],["mat-horizontal-stepper"],["","matStepper",""]],contentQueries:function(S,y,c){if(S&1&&(dn(c,hp,5),dn(c,cp,5)),S&2){let he;ji(he=qi())&&(y._steps=he),ji(he=qi())&&(y._icons=he)}},viewQuery:function(S,y){if(S&1&&(na(lp,5),na(i1,5)),S&2){let c;ji(c=qi())&&(y._stepHeader=c),ji(c=qi())&&(y._animatedContainers=c)}},hostAttrs:["role","tablist"],hostVars:15,hostBindings:function(S,y){S&2&&(Zt("aria-orientation",y.orientation),ju("--mat-stepper-animation-duration",y._getAnimationDuration()),Qt("mat-stepper-horizontal",y.orientation==="horizontal")("mat-stepper-vertical",y.orientation==="vertical")("mat-stepper-label-position-end",y.orientation==="horizontal"&&y.labelPosition=="end")("mat-stepper-label-position-bottom",y.orientation==="horizontal"&&y.labelPosition=="bottom")("mat-stepper-header-position-bottom",y.headerPosition==="bottom")("mat-stepper-animating",y._isAnimating()))},inputs:{disableRipple:"disableRipple",color:"color",labelPosition:"labelPosition",headerPosition:"headerPosition",animationDuration:"animationDuration"},outputs:{animationDone:"animationDone"},exportAs:["matStepper","matVerticalStepper","matHorizontalStepper"],features:[$o([{provide:Hu,useExisting:D}]),er],ngContentSelectors:ng,decls:5,vars:2,consts:[["stepTemplate",""],["animatedContainer",""],[1,"mat-horizontal-stepper-wrapper"],[1,"mat-horizontal-stepper-header-container"],[1,"mat-horizontal-content-container"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id","class"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-stepper-horizontal-line"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id"],[3,"ngTemplateOutlet"],[1,"mat-step"],[1,"mat-vertical-content-container"],["role","tabpanel",1,"mat-vertical-stepper-content",3,"id"],[1,"mat-vertical-content"],[3,"click","keydown","tabIndex","id","index","state","label","selected","active","optional","errorMessage","iconOverrides","disableRipple","color"]],template:function(S,y){if(S&1&&(Pn(),Mt(0,r1,1,0)(1,s1,7,0,"div",2)(2,c1,2,0)(3,h1,1,23,"ng-template",null,0,Uu)),S&2){let c;Yt(y._isServer?0:-1),Ye(),Yt((c=y.orientation)==="horizontal"?1:c==="vertical"?2:-1)}},dependencies:[$u,lp],styles:['.mat-stepper-vertical,.mat-stepper-horizontal{display:block;font-family:var(--mat-stepper-container-text-font, var(--mat-sys-body-medium-font));background:var(--mat-stepper-container-color, var(--mat-sys-surface))}.mat-horizontal-stepper-header-container{white-space:nowrap;display:flex;align-items:center}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header-container{align-items:flex-start}.mat-stepper-header-position-bottom .mat-horizontal-stepper-header-container{order:1}.mat-stepper-horizontal-line{border-top-width:1px;border-top-style:solid;flex:auto;height:0;margin:0 -16px;min-width:32px;border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-stepper-horizontal-line{margin:0;min-width:0;position:relative;top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{border-top-width:1px;border-top-style:solid;content:"";display:inline-block;height:0;position:absolute;width:calc(50% - 20px)}.mat-horizontal-stepper-header{display:flex;height:72px;overflow:hidden;align-items:center;padding:0 24px;height:var(--mat-stepper-header-height, 72px)}.mat-horizontal-stepper-header .mat-step-icon{margin-right:8px;flex:none}[dir=rtl] .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:8px}.mat-horizontal-stepper-header::before,.mat-horizontal-stepper-header::after{border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::after{top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{box-sizing:border-box;flex-direction:column;height:auto}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{right:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before{left:0}[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:last-child::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:first-child::after{display:none}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-label{padding:16px 0 0 0;text-align:center;width:100%}.mat-vertical-stepper-header{display:flex;align-items:center;height:24px;padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-vertical-stepper-header .mat-step-icon{margin-right:12px}[dir=rtl] .mat-vertical-stepper-header .mat-step-icon{margin-right:0;margin-left:12px}.mat-horizontal-stepper-wrapper{display:flex;flex-direction:column}.mat-horizontal-stepper-content{visibility:hidden;overflow:hidden;outline:0;height:0}.mat-stepper-animations-enabled .mat-horizontal-stepper-content{transition:transform var(--mat-stepper-animation-duration, 0) cubic-bezier(0.35, 0, 0.25, 1)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-previous{transform:translate3d(-100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-next{transform:translate3d(100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{visibility:visible;transform:none;height:auto}.mat-stepper-horizontal:not(.mat-stepper-animating) .mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{overflow:visible}.mat-horizontal-content-container{overflow:hidden;padding:0 24px 24px 24px}@media(forced-colors: active){.mat-horizontal-content-container{outline:solid 1px}}.mat-stepper-header-position-bottom .mat-horizontal-content-container{padding:24px 24px 0 24px}.mat-vertical-content-container{display:grid;grid-template-rows:0fr;grid-template-columns:100%;margin-left:36px;border:0;position:relative}.mat-stepper-animations-enabled .mat-vertical-content-container{transition:grid-template-rows var(--mat-stepper-animation-duration, 0) cubic-bezier(0.4, 0, 0.2, 1)}.mat-vertical-content-container.mat-vertical-content-container-active{grid-template-rows:1fr}.mat-step:last-child .mat-vertical-content-container{border:none}@media(forced-colors: active){.mat-vertical-content-container{outline:solid 1px}}[dir=rtl] .mat-vertical-content-container{margin-left:0;margin-right:36px}@supports not (grid-template-rows: 0fr){.mat-vertical-content-container{height:0}.mat-vertical-content-container.mat-vertical-content-container-active{height:auto}}.mat-stepper-vertical-line::before{content:"";position:absolute;left:0;border-left-width:1px;border-left-style:solid;border-left-color:var(--mat-stepper-line-color, var(--mat-sys-outline));top:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2));bottom:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2))}[dir=rtl] .mat-stepper-vertical-line::before{left:auto;right:0}.mat-vertical-stepper-content{overflow:hidden;outline:0;visibility:hidden}.mat-stepper-animations-enabled .mat-vertical-stepper-content{transition:visibility var(--mat-stepper-animation-duration, 0) linear}.mat-vertical-content-container-active>.mat-vertical-stepper-content{visibility:visible}.mat-vertical-content{padding:0 24px 24px 24px}'],encapsulation:2,changeDetection:0})}return D})();var og=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[u1,Kh],imports:[Gt,ca,Pf,Ln,al,dp,lp,Gt]})}return D})();function f1(D,Y){if(D&1&&nt(0),D&2){let v=Y.index;Qa(" ",v+1," ")}}function g1(D,Y){if(D&1&&nt(0),D&2){let v=Y.index;Qa(" ",v+1," ")}}function _1(D,Y){if(D&1&&nt(0),D&2){let v=Y.index;Qa(" ",v+1," ")}}var pd=class D{_dialogRef=me(Yo);constructor(){this._dialogRef.addPanelClass("dialog-fullscreen")}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-guide-dialog"]],decls:23,vars:0,consts:[["stepper",""],["mat-dialog-title",""],["mat-dialog-close",""],[1,"content"],["matStepperIcon","edit"],["matStepperIcon","done"],["matStepperIcon","number"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","",3,"click"]],template:function(v,S){if(v&1){let y=Ii();Ne(0,"div",1)(1,"span"),nt(2,"Install Angular"),$e(),Ne(3,"mat-icon",2),nt(4,"close"),$e()(),Ne(5,"mat-stepper",null,0)(7,"mat-step")(8,"div",3),nt(9," Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque? "),$e()(),Ne(10,"mat-step"),nt(11,"asd "),$e(),Ne(12,"mat-step"),nt(13," asd"),$e(),Mt(14,f1,1,1,"ng-template",4)(15,g1,1,1,"ng-template",5)(16,_1,1,1,"ng-template",6),$e(),cn(17,"mat-dialog-content"),Ne(18,"mat-dialog-actions",7)(19,"button",8),qt("click",function(){Nt(y);let he=aa(6);return jt(he.previous())}),nt(20,"Poprzednie"),$e(),Ne(21,"button",9),qt("click",function(){Nt(y);let he=aa(6);return jt(he.next())}),nt(22,"Nast\u0119pne"),$e()()}},dependencies:[og,hp,dp,cp,Dn,ro,od,id,rd,ad,nd,Ln,zn],styles:[".mat-step-label{display:none!important}  .mat-horizontal-stepper-header-container{position:sticky;top:0;background-color:var(--mat-sys-surface)}.content[_ngcontent-%COMP%]{overflow:hidden;flex:1}mat-dialog-actions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface);position:sticky;bottom:0}"],changeDetection:0})};var dl=rf(mp());var lg=rf(mp());var ao={geocodeApi:"https://services.gugik.gov.pl/uug",primaryColor:"#0078bd",apiUrl:"https://parkowanko.onrender.com/api"};var fd=class D{prepareMarker(){let Y=document.createElement("div");return Y.className="marker",new lg.Marker({element:Y})}async preparePoiLayers(Y,v){Y.addSource("parkings",{type:"geojson",data:{type:"FeatureCollection",features:[]},cluster:!0,clusterMaxZoom:14,clusterRadius:50});let S=await Y.loadImage("https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Cyprus_road_sign_parking.svg/212px-Cyprus_road_sign_parking.svg.png?20130416124154");Y.addImage("parking",S.data),Y.addSource("point",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[0,0]}}]}}),Y.addLayer({id:"unclustered-point",type:"symbol",source:"parkings",filter:["!",["has","point_count"]],layout:{"icon-image":"parking","icon-size":.1}}),Y.addLayer({id:"clusters",type:"circle",source:v,filter:["has","point_count"],paint:{"circle-color":ao.primaryColor,"circle-radius":["step",["get","point_count"],20,100,30,750,40],"circle-stroke-color":"#FFFFFF","circle-stroke-width":2}}),Y.addLayer({id:"cluster-count",type:"symbol",source:v,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Roboto Regular"],"text-size":16},paint:{"text-color":"#FFFFFF"}}),Y.addSource("line-source",{type:"geojson",data:this.getLineGeoJson()}),Y.addLayer({id:"line-layer",type:"line",source:"line-source",paint:{"line-color":ao.primaryColor,"line-width":3,"line-dasharray":[2,2]}})}getLineGeoJson(Y,v){let S=[];return Y&&v&&(S=[[Y.lng,Y.lat],[v.lng,v.lat]]),{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:S},properties:[]}]}}static \u0275fac=function(v){return new(v||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})};var Fc=[14,48,24.5,56],y1=[Fc[0]-3,Fc[1]-3,Fc[2]+3,Fc[3]+3],v1=16,hl=class D{_mapRendererService=me(fd);_markerMoveListener;_markerRef=this._mapRendererService.prepareMarker();_map;_selectingMode="enabled";selectedParking=ra(null);_isMapLoaded=ra(!1);isMapLoaded=this._isMapLoaded.asReadonly();constructor(){this._prepareAdditionalFeaturesOnLoadMap()}_prepareAdditionalFeaturesOnLoadMap(){Gh(()=>{this.isMapLoaded()&&to(()=>{this._listenForPoiClick(),this._mapRendererService.preparePoiLayers(this._map,"parkings")})})}getMarkerLatLng(){return this._markerRef?.getLngLat()}setSelectingMode(Y){this._selectingMode=Y}getMap(){return this._map}async initialRenderMap(){let Y=await import("./chunk-OD53RADB.js");this._map=new dl.Map({container:"map",maxBounds:y1,bounds:Fc,style:"https://tiles.stadiamaps.com/styles/osm_bright.json"}).addControl(new dl.NavigationControl({showCompass:!1})).addControl(new dl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,fitBoundsOptions:{maxZoom:17}})).on("load",()=>this._isMapLoaded.set(!0))}_listenForPoiClick(){this._map.on("click","unclustered-point",Y=>{if(this._selectingMode==="disabled")return;let v=Y.features?.[0]?.properties;this.selectedParking.set(JSON.parse(v.parking))})}renderPoiList(Y){this._map.getSource("parkings").setData({type:"FeatureCollection",features:Y.map(y=>({type:"Feature",geometry:{type:"Point",coordinates:[y.location.lng,y.location.lat]},properties:{parking:y}}))})}renderMarkerForFocusPoi(Y){this.removeMarkerForFocusPoi(),this._markerRef.setLngLat(Y).addTo(this._map)}removeMarkerForFocusPoi(){this._markerRef.remove()}renderMoveableMarker(){this.removeMoveableMarker(),this._markerRef.setLngLat(this._map.getCenter()).addTo(this._map),this._markerMoveListener=Y=>{this._markerRef.setLngLat(Y.target.getCenter()),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson(this.selectedParking()?.location,this._markerRef.getLngLat()))},this._map.on("move",this._markerMoveListener)}removeMoveableMarker(){this._markerRef.remove(),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson()),this._map.off("move",this._markerMoveListener)}jumpToPoi(Y){this._map.jumpTo({center:[Y.lng,Y.lat],zoom:v1})}ngOnDestroy(){this._map?.remove()}static \u0275fac=function(v){return new(v||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})};var gd=class D{_mapService=me(hl);parkingsList=df([]);constructor(){el(()=>this._mapService.initialRenderMap()),Gh(()=>{this._mapService.isMapLoaded()&&(this.parkingsList(),to(()=>this._mapService.renderPoiList(this.parkingsList())))})}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-map"]],hostAttrs:["id","map"],inputs:{parkingsList:[1,"parkingsList"]},decls:0,vars:0,template:function(v,S){},styles:[`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors: active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors: active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors: active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors: active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover: none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}#map{height:100vh;width:100%;display:flex}#map .maplibregl-ctrl-attrib{display:none}#map .maplibregl-ctrl-group{border-radius:var(--mat-sys-corner-medium)}#map .maplibregl-ctrl-group button{width:40px;height:40px}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.marker{background-image:url("./media/parking-poi-KLDG7L2W.svg");background-size:cover;width:60px;aspect-ratio:1/1;translate:0px -50%;position:relative;animation:fadeIn .5s}
`],encapsulation:2,changeDetection:0})};function b1(D,Y){}var x1={bottomSheetState:Ko("state",[ol("void, hidden",Wr({transform:"translateY(100%)"})),ol("visible",Wr({transform:"translateY(0%)"})),sa("visible => void, visible => hidden",Ku([oa(`${Xu.COMPLEX} ${Wu.ACCELERATION_CURVE}`),Ju("@*",Yu(),{optional:!0})])),sa("void => visible",Ku([oa(`${Xu.EXITING} ${Wu.DECELERATION_CURVE}`),Ju("@*",Yu(),{optional:!0})]))])},w1=(()=>{class D extends Ec{_breakpointSubscription;_animationState="void";_animationStateChanged=new An;_destroyed;constructor(){super();let v=me(wf);this._breakpointSubscription=v.observe([Ho.Medium,Ho.Large,Ho.XLarge]).subscribe(()=>{let S=this._elementRef.nativeElement.classList;S.toggle("mat-bottom-sheet-container-medium",v.isMatched(Ho.Medium)),S.toggle("mat-bottom-sheet-container-large",v.isMatched(Ho.Large)),S.toggle("mat-bottom-sheet-container-xlarge",v.isMatched(Ho.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(v){v.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(v)}_onAnimationStart(v){this._animationStateChanged.emit(v)}_captureInitialFocus(){}static \u0275fac=function(S){return new(S||D)};static \u0275cmp=kt({type:D,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(S,y){S&1&&ff("@state.start",function(he){return y._onAnimationStart(he)})("@state.done",function(he){return y._onAnimationDone(he)}),S&2&&(mf("@state",y._animationState),Zt("role",y._config.role)("aria-modal",y._config.ariaModal)("aria-label",y._config.ariaLabel))},features:[er],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(S,y){S&1&&Mt(0,b1,0,0,"ng-template",0)},dependencies:[la],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[x1.bottomSheetState]}})}return D})(),gp=new si("MatBottomSheetData"),fp=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!0;closeOnNavigation=!0;autoFocus="dialog";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},ul=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new Mi;_result;_closeFallbackTimeout;constructor(Y,v,S){this._ref=Y,this.containerInstance=S,this.disableClose=v.disableClose,S._animationStateChanged.pipe(Gr(y=>y.phaseName==="done"&&y.toState==="visible"),Hr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),S._animationStateChanged.pipe(Gr(y=>y.phaseName==="done"&&y.toState==="hidden"),Hr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),Y.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),Ya(this.backdropClick(),this.keydownEvents().pipe(Gr(y=>y.keyCode===27))).subscribe(y=>{!this.disableClose&&(y.type!=="keydown"||!io(y))&&(y.preventDefault(),this.dismiss())})}dismiss(Y){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(Gr(v=>v.phaseName==="start"),Hr(1)).subscribe(v=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},v.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=Y,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},k1=new si("mat-bottom-sheet-default-options"),_p=(()=>{class D{_overlay=me(Xr);_parentBottomSheet=me(D,{optional:!0,skipSelf:!0});_defaultOptions=me(k1,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=me(Ac);get _openedBottomSheetRef(){let v=this._parentBottomSheet;return v?v._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(v){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=v:this._bottomSheetRefAtThisLevel=v}constructor(){}open(v,S){let y=Kt(Kt({},this._defaultOptions||new fp),S),c;return this._dialog.open(v,In(Kt({},y),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:w1,scrollStrategy:y.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:c}),providers:(he,ze,Je)=>(c=new ul(he,y,Je),[{provide:ul,useValue:c},{provide:gp,useValue:y.data}])})),c.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===c&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>c.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):c.containerInstance.enter(),this._openedBottomSheetRef=c,c}dismiss(v){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(v)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(S){return new(S||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),cg=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[_p],imports:[Qh,Gt,ca,Gt]})}return D})();var hg=Ko("enterFadeAnimation",[sa(":enter",[Wr({opacity:0}),oa("200ms",Wr({opacity:1}))])]);function yp(D){return D?.injector||cf(yp),_f(In(Kt({},D),{stream:Y=>{let v,S=()=>v.unsubscribe();Y.abortSignal.addEventListener("abort",S);let y=ra({value:void 0}),c,he=new Promise(Je=>c=Je);function ze(Je){y.set(Je),c?.(y),c=void 0}return v=D.loader(Y).subscribe({next:Je=>ze({value:Je}),error:Je=>ze({error:Je}),complete:()=>{c&&ze({error:new Error("Resource completed before producing a value")}),Y.abortSignal.removeEventListener("abort",S)}}),he}}))}var _d=class{id;created_at;updated_at};var yd=class extends _d{location;name;description;constructor(Y){super(),Object.entries(Y).forEach(([v,S])=>{["created_at","updated_at"].includes(v)?this[v]=new Date(S):this[v]=S})}};var pl=class D{_httpClient=me(Hh);parkingsList=yp({loader:()=>this.getParkings(),defaultValue:[]});getParkings(){return this._httpClient.get(`${ao.apiUrl}/parkings/?format=json`).pipe(Tn(Y=>Y.map(v=>new yd(v))))}postParking(Y){return this._httpClient.post(`${ao.apiUrl}/parkings`,Y).pipe(En(()=>this.parkingsList.reload()))}patchParking(Y,v){return this._httpClient.patch(`${ao.apiUrl}/parkings/${Y}`,v).pipe(En(()=>this.parkingsList.reload()))}deleteParking(Y){return this._httpClient.delete(`${ao.apiUrl}/parkings/${Y}`).pipe(En(()=>this.parkingsList.reload()))}static \u0275fac=function(v){return new(v||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})};function C1(D,Y){if(D&1&&(Ne(0,"button",1),nt(1),$e()),D&2){let v=rt();Dt("mat-dialog-close",!1),Ye(),Qa(" ",v.dialogData.cancelButtonLabel," ")}}function S1(D,Y){if(D&1&&(Ne(0,"button",3),nt(1),$e()),D&2){let v=rt();Qt("error-theme",v.dialogData.isConfirmErrorButton),Dt("mat-dialog-close",!0),Ye(),Qa(" ",v.dialogData.confirmButtonLabel," ")}}var vd=class D{dialogData=me(np);constructor(){this._setInitialData()}_setInitialData(){this.dialogData=Kt({title:this.dialogData.title,content:"",cancelButtonLabel:"Anuluj",confirmButtonLabel:"Potwierd\u017A",hideCancelButton:!1,hideConfirmButton:!1,isConfirmErrorButton:!0},this.dialogData)}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-title",""],["mat-button","",3,"mat-dialog-close"],["mat-flat-button","",3,"mat-dialog-close","error-theme"],["mat-flat-button","",3,"mat-dialog-close"]],template:function(v,S){v&1&&(Ne(0,"div",0),nt(1),$e(),Ne(2,"mat-dialog-content"),nt(3),$e(),Ne(4,"mat-dialog-actions"),Mt(5,C1,2,2,"button",1)(6,S1,2,4,"button",2),$e()),v&2&&(Ye(),tr(S.dialogData.title),Ye(2),Qa(" ",S.dialogData.content,`
`),Ye(2),Yt(S.dialogData.hideCancelButton?-1:5),Ye(),Yt(S.dialogData.hideConfirmButton?-1:6))},dependencies:[od,id,rd,ad,nd,Dn,ro],encapsulation:2,changeDetection:0})};var dg=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Gt]})}return D})();var ug=(()=>{class D{static \u0275fac=function(S){return new(S||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[xf,Gt,al,Df,dg]})}return D})();function M1(D,Y){if(D&1){let v=Ii();Ne(0,"button",3),qt("click",function(){Nt(v);let y=rt().$implicit,c=rt();return jt(c.choose(y.result))}),Ne(1,"mat-icon"),nt(2),$e(),Ne(3,"div"),nt(4),$e()()}if(D&2){let v=rt().$implicit;Qt("error-theme",v.isError),Ye(2),tr(v.icon),Ye(2),tr(v.label)}}function I1(D,Y){if(D&1){let v=Ii();Ne(0,"button",4),qt("click",function(){Nt(v);let y=rt().$implicit,c=rt();return jt(c.choose(y.result))}),Ne(1,"mat-icon"),nt(2),$e(),Ne(3,"div"),nt(4),$e()()}if(D&2){let v=rt().$implicit;Ye(2),tr(v.icon),Ye(2),tr(v.label)}}function T1(D,Y){if(D&1&&Mt(0,M1,5,4,"button",1)(1,I1,5,2,"button",2),D&2){let v=Y.$implicit;Yt(v.isPrimary||v.isError?0:1)}}var bd=class D{sheetData=me(gp);sheetRef=me(ul);choose(Y){this.sheetRef.dismiss(Y)}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-menu-sheet"]],decls:3,vars:0,consts:[[1,"items-list"],["mat-flat-button","",1,"item",3,"error-theme"],["mat-stroked-button","",1,"item"],["mat-flat-button","",1,"item",3,"click"],["mat-stroked-button","",1,"item",3,"click"]],template:function(v,S){v&1&&(Ne(0,"div",0),rl(1,T1,2,1,null,null,il),$e()),v&2&&(Ye(),nl(S.sheetData.menuItems))},dependencies:[ug,Ln,zn,Dn,ro],styles:[".title[_ngcontent-%COMP%]{padding:20px}.items-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.items-list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}"],changeDetection:0})};function E1(D,Y){if(D&1){let v=Ii();Ne(0,"button",2),qt("click",function(){Nt(v);let y=rt(2);return jt(y.startAddingPoi())}),Ne(1,"mat-icon"),nt(2,"local_parking"),$e(),nt(3," Dodaj bezp\u0142atny parking "),$e()}D&2&&Dt("@enterFadeAnimation",void 0)}function A1(D,Y){if(D&1){let v=Ii();Ne(0,"button",3),qt("click",function(){Nt(v);let y=rt(2);return jt(y.stopAddingPoi())}),nt(1," Anuluj "),$e(),Ne(2,"button",2),qt("click",function(){Nt(v);let y=rt(2);return jt(y.confirmAddedPoi())}),Ne(3,"mat-icon"),nt(4,"check"),$e(),nt(5," Zatwierd\u017A "),$e()}D&2&&(Dt("@enterFadeAnimation",void 0),Ye(2),Dt("@enterFadeAnimation",void 0))}function P1(D,Y){if(D&1){let v=Ii();Ne(0,"button",3),qt("click",function(){Nt(v);let y=rt(2);return jt(y.stopUpdatingPoiPosition())}),nt(1," Anuluj "),$e(),Ne(2,"button",2),qt("click",function(){Nt(v);let y=rt(2);return jt(y.confirmUpdatedPoiPosition())}),Ne(3,"mat-icon"),nt(4,"check"),$e(),nt(5," Zatwierd\u017A "),$e()}D&2&&(Dt("@enterFadeAnimation",void 0),Ye(2),Dt("@enterFadeAnimation",void 0))}function D1(D,Y){if(D&1&&(Ne(0,"div",0),Mt(1,E1,4,1,"button",1)(2,A1,6,2)(3,P1,6,2),$e()),D&2){let v,S=rt();Ye(),Yt((v=S.activeMode())===S.ACTIVE_MODE_ENUM.DEFAULT?1:v===S.ACTIVE_MODE_ENUM.ADDING_POI?2:v===S.ACTIVE_MODE_ENUM.UPDATING_POI_POSITION?3:-1)}}var pg=(y=>(y.DEFAULT="DEFAULT",y.ADDING_POI="ADDING_POI",y.EDITING_POI="EDITING_POI",y.UPDATING_POI_POSITION="UPDATE_POI_POSITION",y))(pg||{}),xd=class D{_mapService=me(hl);_matDialog=me(Qo);_snackBar=me(Ff);_sheet=me(_p);_parkingsService=me(pl);ACTIVE_MODE_ENUM=pg;activeMode=ra("DEFAULT");isMapLoaded=this._mapService.isMapLoaded;constructor(){Zh(()=>this._listenForSelectedPoiToStartEdit()),Zh(()=>this._listenForActiveModeToSetMapState())}_listenForSelectedPoiToStartEdit(){this._mapService.selectedParking(),to(()=>this.startEditingPoi())}_listenForActiveModeToSetMapState(){this.activeMode(),to(()=>{this.activeMode()==="DEFAULT"?(this._mapService.selectedParking.set(null),this._mapService.setSelectingMode("enabled")):this._mapService.setSelectingMode("disabled")})}startAddingPoi(){this.activeMode.set("ADDING_POI"),this._mapService.renderMoveableMarker()}stopAddingPoi(){this._mapService.removeMoveableMarker(),this.activeMode.set("DEFAULT")}confirmAddedPoi(){let Y=this._mapService.getMarkerLatLng();this._parkingsService.postParking({location:Y}).subscribe({next:()=>{this._snackBar.open(`Gotowe!
Oznaczenie bezp\u0142atnego parkingu zosta\u0142o dodane`,void 0,{verticalPosition:"top"})},complete:()=>{this.stopAddingPoi()}})}startEditingPoi(){this._mapService.selectedParking()&&(this.activeMode.set("EDITING_POI"),this._sheet.open(bd,{data:{menuItems:[{label:"Popraw pozycj\u0119 na mapie",icon:"edit_location_alt",result:"UPDATE"},{label:"Usu\u0144 znacznik",icon:"wrong_location",result:"REMOVE"},{label:"Anuluj",icon:"close",result:"CANCEL"}]}}).afterDismissed().subscribe(Y=>{(Y==="CANCEL"||!Y)&&this.activeMode.set("DEFAULT"),Y==="UPDATE"&&this.startUpdatingPoiPosition(),Y==="REMOVE"&&this.removePoi()}))}startUpdatingPoiPosition(){let Y=this._mapService.selectedParking();Y&&(this.activeMode.set("UPDATE_POI_POSITION"),this._mapService.renderMoveableMarker(),this._mapService.jumpToPoi(Y?.location))}stopUpdatingPoiPosition(){this._mapService.removeMoveableMarker(),this.startEditingPoi()}confirmUpdatedPoiPosition(){let Y=this._mapService.selectedParking();if(!Y)return;let v=this._mapService.getMarkerLatLng();this._parkingsService.patchParking(Y.id,{location:v}).subscribe({next:()=>{this._snackBar.open(`Gotowe!
Pozycja bezp\u0142atnego parkingu zosta\u0142a poprawiona`,void 0,{verticalPosition:"top"})},complete:()=>{this._mapService.removeMoveableMarker(),this.activeMode.set("DEFAULT")}})}removePoi(){let Y=this._mapService.selectedParking();Y&&(this._mapService.jumpToPoi(Y.location),this._mapService.getMap().panBy([0,200]),this._mapService.renderMarkerForFocusPoi(Y.location),this._matDialog.open(vd,{data:{title:"Usuwanie punktu",content:"Czy na pewno chcesz usun\u0105\u0107 obszar p\u0142atnego parkingu?"}}).afterClosed().pipe(No(v=>v?this._parkingsService.deleteParking(Y.id).pipe(En(()=>{this._snackBar.open(`Gotowe!
Usuni\u0119to znacznik bezp\u0142atnego parkingu`,void 0,{verticalPosition:"top"})})):Er(null))).subscribe({next:()=>{this._mapService.removeMarkerForFocusPoi(),this.activeMode.set("DEFAULT")}}))}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-poi-controller"]],decls:1,vars:1,consts:[[1,"menu-buttons-wrapper"],["mat-flat-button","",1,"menu-button"],["mat-flat-button","",1,"menu-button",3,"click"],["mat-raised-button","",1,"menu-button",3,"click"]],template:function(v,S){v&1&&Mt(0,D1,4,1,"div",0),v&2&&Yt(S.isMapLoaded()?0:-1)},dependencies:[dd,Ln,zn,Dn,ro,Bf,cg],styles:[".menu-buttons-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;gap:10px;position:fixed;z-index:100;left:0;right:0;bottom:0;white-space:nowrap;padding:10px}.menu-buttons-wrapper[_ngcontent-%COMP%]   .menu-button[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #fff,0 0 2px 2px #00000080}"],data:{animation:[hg]},changeDetection:0})};var z1=()=>[],mg=class D{_matDialog=me(Qo);_parkingsService=me(pl);parkingsList=this._parkingsService.parkingsList;openHelpDialog(){this._matDialog.open(pd)}static \u0275fac=function(v){return new(v||D)};static \u0275cmp=kt({type:D,selectors:[["app-main-page"]],decls:12,vars:3,consts:[["menu","matMenu"],["mat-mini-fab","",1,"menu-button",3,"matMenuTriggerFor"],[3,"parkingsList"],["mat-menu-item","",3,"click"]],template:function(v,S){if(v&1){let y=Ii();Ne(0,"button",1)(1,"mat-icon"),nt(2,"menu"),$e()(),cn(3,"app-poi-controller")(4,"app-map",2),Ne(5,"mat-menu",null,0)(7,"button",3),qt("click",function(){return Nt(y),jt(S.openHelpDialog())}),Ne(8,"mat-icon"),nt(9,"not_listed_location"),$e(),Ne(10,"span"),nt(11,"Poradnik"),$e()()()}if(v&2){let y=aa(6);Dt("matMenuTriggerFor",y),Ye(4),Dt("parkingsList",S.parkingsList.value()||gf(2,z1))}},dependencies:[gd,xd,Dn,zf,rg,Ln,zn,dd,cl,Lc,tg],styles:[".menu-button[_ngcontent-%COMP%]{position:fixed;z-index:100;left:10px;top:10px;box-shadow:0 0 2px #00000080}.menu-button[_ngcontent-%COMP%]:hover, .menu-button[_ngcontent-%COMP%]:focus:active, .menu-button[_ngcontent-%COMP%]:active, .menu-button[_ngcontent-%COMP%]:focus{box-shadow:0 0 2px #00000080}"],changeDetection:0})};export{mg as MainPageComponent};
