import{$ as Xu,A as Sc,B as kf,C as Cf,E as Nu,F as ju,G as Sf,H as qu,I as Uu,J as Gt,K as Wh,L as Mc,M as Xh,N as ol,O as Mf,P as no,Q as If,R as zn,S as Hu,T as ll,U as Tf,V as ca,W as ha,X as Wu,Y as Ic,Z as Kh,_ as Ef,a as Zh,aa as Xr,ba as cl,da as Af,ea as Pf,h as uf,i as Gh,j as pf,k as Hh,l as Cc,m as mf,n as ro,o as Vu,p as ff,q as gf,r as Wo,s as _f,t as yf,u as vf,v as xf,w as bf,x as Xo,y as wf,z as Ko}from"./chunk-7TRBZEQS.js";import{$a as kt,$b as $h,Ab as qh,Ba as el,Bb as lf,C as Hr,Cb as qt,Db as cf,Eb as rt,F as ef,Fa as tl,Fb as Dn,Gb as hn,Hb as dn,Ib as aa,Jb as ji,Kb as qi,L as tf,Lb as oa,Mb as nt,N as ln,Nb as tr,O as jo,Ob as eo,P as Js,Pb as Zo,Q as An,Qa as il,Qb as hf,Ra as Ye,Rb as Fu,S as Ni,Sb as Bu,T as _i,Ua as qo,V as si,Vb as to,Wa as Nh,X as wc,Xa as jh,Xb as Go,Y as me,Z as Pu,Zb as io,_ as Du,_b as Uh,a as Ya,ab as yi,ac as df,bb as Pr,cb as er,da as rf,db as of,ea as zu,eb as kc,f as Mi,fa as Nt,fb as Mt,fc as Ho,ga as jt,ha as Lu,ia as ra,ic as Ou,j as Er,ja as Qa,k as Ym,ka as nf,lb as Zt,mb as Dt,n as En,nb as Ru,oa as Pn,ob as Qt,pa as Qs,pb as Uo,pc as Yo,qa as Oh,qb as sf,qc as sa,r as Bh,ra as af,rb as Yt,rc as $u,s as Jm,sa as Ar,sb as rl,tb as nl,tc as Wr,u as Ja,ub as al,uc as sl,va as na,vb as Ne,vc as la,w as Gr,wa as Vh,wb as $e,wc as Zu,xb as cn,xc as Gu,y as Qm,yb as $o,zb as Ii}from"./chunk-5XF3OSTI.js";import{a as Kt,b as Tn,d as a0,e as Km}from"./chunk-VZBGOO6O.js";var lp=a0((op,sp)=>{"use strict";(function(D,he){typeof op=="object"&&typeof sp<"u"?sp.exports=he():typeof define=="function"&&define.amd?define(he):(D=typeof globalThis<"u"?globalThis:D||self,D.maplibregl=he())})(op,function(){"use strict";var D={},he={};function y(v,c,ce){if(he[v]=ce,v==="index"){var Pe="var sharedModule = {}; ("+he.shared+")(sharedModule); ("+he.worker+")(sharedModule);",Je={};return he.shared(Je),he.index(D,Je),typeof window<"u"&&D.setWorkerUrl(window.URL.createObjectURL(new Blob([Pe],{type:"text/javascript"}))),D}}y("shared",["exports"],function(v){"use strict";function c(i,t,r,a){return new(r||(r=Promise))(function(l,u){function p(b){try{g(a.next(b))}catch(w){u(w)}}function m(b){try{g(a.throw(b))}catch(w){u(w)}}function g(b){var w;b.done?l(b.value):(w=b.value,w instanceof r?w:new r(function(S){S(w)})).then(p,m)}g((a=a.apply(i,t||[])).next())})}function ce(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Pe=Je;function Je(i,t){this.x=i,this.y=t}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,t){var r=Math.cos(i),a=Math.sin(i),l=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(i){return i instanceof Je?i:Array.isArray(i)?new Je(i[0],i[1]):i};var ge=ce(Pe),se=ur;function ur(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}ur.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var p=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?p=r:m=r,r=.5*(m-p)+p;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ei=ce(se);let Ui,pn;function Kr(){return Ui==null&&(Ui=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ui}function so(){if(pn==null&&(pn=!1,Kr())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){let l=4*a;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){pn=!0;break}}}return pn||!1}function $i(i,t,r,a){let l=new Ei(i,t,r,a);return u=>l.solve(u)}let pl=$i(.25,.1,.25,1);function pr(i,t,r){return Math.min(r,Math.max(t,i))}function Dr(i,t,r){let a=r-t,l=((i-t)%a+a)%a+t;return l===t?r:l}function ir(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}let ts=1;function zr(i,t,r){let a={};for(let l in i)a[l]=t.call(this,i[l],l,i);return a}function lo(i,t,r){let a={};for(let l in i)t.call(this,i[l],l,i)&&(a[l]=i[l]);return a}function yt(i){return Array.isArray(i)?i.map(yt):typeof i=="object"&&i?zr(i,yt):i}let is={};function li(i){is[i]||(typeof console<"u"&&console.warn(i),is[i]=!0)}function vi(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Yr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let ua=null;function Lr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}let rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Fn(i,t,r,a,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let u=new VideoFrame(i,{timestamp:0});try{let p=u?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);let m=p.startsWith("BGR"),g=new Uint8ClampedArray(a*l*4);if(yield u.copyTo(g,function(b,w,S,T,P){let L=4*Math.max(-w,0),R=(Math.max(0,S)-S)*T*4+L,N=4*T,$=Math.max(0,w),ie=Math.max(0,S);return{rect:{x:$,y:ie,width:Math.min(b.width,w+T)-$,height:Math.min(b.height,S+P)-ie},layout:[{offset:R,stride:N}]}}(i,t,r,a,l)),m)for(let b=0;b<g.length;b+=4){let w=g[b];g[b]=g[b+2],g[b+2]=w}return g}finally{u.close()}})}let Jr,Ai,mr="AbortError";function pa(){return new Error(mr)}let mn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Rr(i){return mn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}let ma="global-dispatcher";class Zi extends Error{constructor(t,r,a,l){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=l}}let fr=()=>Yr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Bn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){let a=Rr(i.url);if(a)return a(i,t);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ma},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(fr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,l){return c(this,void 0,void 0,function*(){let u=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:fr(),signal:l.signal});a.type!=="json"||u.headers.has("Accept")||u.headers.set("Accept","application/json");let p=yield fetch(u);if(!p.ok){let b=yield p.blob();throw new Zi(p.status,p.statusText,a.url,b)}let m;m=a.type==="arrayBuffer"||a.type==="image"?p.arrayBuffer():a.type==="json"?p.json():p.text();let g=yield m;if(l.signal.aborted)throw pa();return{data:g,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(i,t);if(Yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ma},t)}var r;return function(a,l){return new Promise((u,p)=>{var m;let g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(g.responseType="arraybuffer");for(let b in a.headers)g.setRequestHeader(b,a.headers[b]);a.type==="json"&&(g.responseType="text",!((m=a.headers)===null||m===void 0)&&m.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let b=g.response;if(a.type==="json")try{b=JSON.parse(g.response)}catch(w){return void p(w)}u({data:b,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{let b=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});p(new Zi(g.status,g.statusText,a.url,b))}},l.signal.addEventListener("abort",()=>{g.abort(),p(pa())}),g.send(a.body)})}(i,t)};function On(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;let t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function co(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Qr(i,t,r){if(r&&r[i]){let a=r[i].indexOf(t);a!==-1&&r[i].splice(a,1)}}class fn{constructor(t,r={}){ir(this,r),this.type=t}}class gn extends fn{constructor(t,r={}){super("error",ir({error:t},r))}}class fa{on(t,r){return this._listeners=this._listeners||{},co(t,r,this._listeners),this}off(t,r){return Qr(t,r,this._listeners),Qr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},co(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new fn(t,r||{}));let a=t.type;if(this.listens(a)){t.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let m of l)m.call(this,t);let u=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let m of u)Qr(a,m,this._oneTimeListeners),m.call(this,t);let p=this._eventedParent;p&&(ir(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof gn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ho(i,t){let r={};for(let a in i)a!=="ref"&&(r[a]=i[a]);return Vn.forEach(a=>{a in t&&(r[a]=t[a])}),r}function pt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!pt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(let r in i)if(!pt(i[r],t[r]))return!1;return!0}return i===t}function Lt(i,t){i.push(t)}function uo(i,t,r){Lt(r,{command:"addSource",args:[i,t[i]]})}function _n(i,t,r){Lt(t,{command:"removeSource",args:[i]}),r[i]=!0}function en(i,t,r,a){_n(i,r,a),uo(i,t,r)}function ga(i,t,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!pt(i[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!pt(i[r][a],t[r][a]))return!1;return!0}function rr(i,t,r,a,l,u){i=i||{},t=t||{};for(let p in i)Object.prototype.hasOwnProperty.call(i,p)&&(pt(i[p],t[p])||r.push({command:u,args:[a,p,t[p],l]}));for(let p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(i,p)&&(pt(i[p],t[p])||r.push({command:u,args:[a,p,t[p],l]}))}function po(i){return i.id}function mo(i,t){return i[t.id]=t,i}class ye{constructor(t,r,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Fr(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}class xi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Br{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[a,l]of r)this.bindings[a]=l}concat(t){return new Br(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let yn={kind:"null"},we={kind:"number"},et={kind:"string"},Ze={kind:"boolean"},Pi={kind:"color"},gr={kind:"object"},Xe={kind:"value"},Or={kind:"collator"},tn={kind:"formatted"},vn={kind:"padding"},Vr={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function A(i,t){return{kind:"array",itemType:i,N:t}}function E(i){if(i.kind==="array"){let t=E(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let B=[yn,we,et,Ze,Pi,tn,gr,A(Xe),vn,Vr,U];function j(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!j(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let r of B)if(!j(r,t))return null}}return`Expected ${E(i)} but found ${E(t)} instead.`}function K(i,t){return t.some(r=>r.kind===i.kind)}function J(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function te(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}let H=.96422,le=.82521,pe=4/29,ne=6/29,ve=3*ne*ne,Ve=ne*ne*ne,je=Math.PI/180,ct=180/Math.PI;function Ke(i){return(i%=360)<0&&(i+=360),i}function ht([i,t,r,a]){let l,u,p=Ht((.2225045*(i=at(i))+.7168786*(t=at(t))+.0606169*(r=at(r)))/1);i===t&&t===r?l=u=p:(l=Ht((.4360747*i+.3850649*t+.1430804*r)/H),u=Ht((.0139322*i+.0971045*t+.7141733*r)/le));let m=116*p-16;return[m<0?0:m,500*(l-p),200*(p-u),a]}function at(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ht(i){return i>Ve?Math.pow(i,1/3):i/ve+pe}function Rt([i,t,r,a]){let l=(i+16)/116,u=isNaN(t)?l:l+t/500,p=isNaN(r)?l:l-r/200;return l=1*gt(l),u=H*gt(u),p=le*gt(p),[tt(3.1338561*u-1.6168667*l-.4906146*p),tt(-.9787684*u+1.9161415*l+.033454*p),tt(.0719453*u-.2289914*l+1.4052427*p),a]}function tt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function gt(i){return i>ne?i*i*i:ve*(i-pe)}function zt(i){return parseInt(i.padEnd(2,i),16)/255}function ei(i,t){return ni(t?i/100:i,0,1)}function ni(i,t,r){return Math.min(Math.max(t,i),r)}function bi(i){return!i.some(Number.isNaN)}let _a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class _t{constructor(t,r,a,l=1,u=!0){this.r=t,this.g=r,this.b=a,this.a=l,u||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,a,l]))}static parse(t){if(t instanceof _t)return t;if(typeof t!="string")return;let r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=_a[a];if(l){let[p,m,g]=l;return[p/255,m/255,g/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let p=a.length<6?1:2,m=1;return[zt(a.slice(m,m+=p)),zt(a.slice(m,m+=p)),zt(a.slice(m,m+=p)),zt(a.slice(m,m+p)||"ff")]}if(a.startsWith("rgb")){let p=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){let[m,g,b,w,S,T,P,L,R,N,$,ie]=p,X=[w||" ",P||" ",N].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){let ee=[b,T,R].join(""),oe=ee==="%%%"?100:ee===""?255:0;if(oe){let fe=[ni(+g/oe,0,1),ni(+S/oe,0,1),ni(+L/oe,0,1),$?ei(+$,ie):1];if(bi(fe))return fe}}return}}let u=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(u){let[p,m,g,b,w,S,T,P,L]=u,R=[g||" ",w||" ",T].join("");if(R==="  "||R==="  /"||R===",,"||R===",,,"){let N=[+m,ni(+b,0,100),ni(+S,0,100),P?ei(+P,L):1];if(bi(N))return function([$,ie,X,ee]){function oe(fe){let Te=(fe+$/30)%12,qe=ie*Math.min(X,1-X);return X-qe*Math.max(-1,Math.min(Te-3,9-Te,1))}return $=Ke($),ie/=100,X/=100,[oe(0),oe(8),oe(4),ee]}(N)}}}(t);return r?new _t(...r,!1):void 0}get rgb(){let{r:t,g:r,b:a,a:l}=this,u=l||1/0;return this.overwriteGetter("rgb",[t/u,r/u,a/u,l])}get hcl(){return this.overwriteGetter("hcl",function(t){let[r,a,l,u]=ht(t),p=Math.sqrt(a*a+l*l);return[Math.round(1e4*p)?Ke(Math.atan2(l,a)*ct):NaN,p,r,u]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ht(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,a,l]=this.rgb;return`rgba(${[t,r,a].map(u=>Math.round(255*u)).join(",")},${l})`}}_t.black=new _t(0,0,0,1),_t.white=new _t(1,1,1,1),_t.transparent=new _t(0,0,0,0),_t.red=new _t(1,0,0,1);class ml{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fl{constructor(t,r,a,l,u){this.text=t,this.image=r,this.scale=a,this.fontStack=l,this.textColor=u}}class Gi{constructor(t){this.sections=t}static fromString(t){return new Gi([new fl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Gi?t:Gi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Hi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Hi)return t;if(typeof t=="number")return new Hi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Hi(t)}}toString(){return JSON.stringify(this.values)}}let gd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class nr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof nr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let a=t[r],l=t[r+1];if(typeof a!="string"||!gd.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new nr(t)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Wi({name:t,available:!1}):null}}function ya(i,t,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,r,a]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof _t||i instanceof ml||i instanceof Gi||i instanceof Hi||i instanceof nr||i instanceof Wi)return!0;if(Array.isArray(i)){for(let t of i)if(!Nn(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!Nn(i[t]))return!1;return!0}return!1}function Wt(i){if(i===null)return yn;if(typeof i=="string")return et;if(typeof i=="boolean")return Ze;if(typeof i=="number")return we;if(i instanceof _t)return Pi;if(i instanceof ml)return Or;if(i instanceof Gi)return tn;if(i instanceof Hi)return vn;if(i instanceof nr)return U;if(i instanceof Wi)return Vr;if(Array.isArray(i)){let t=i.length,r;for(let a of i){let l=Wt(a);if(r){if(r===l)continue;r=Xe;break}r=l}return A(r||Xe,t)}return gr}function fo(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof _t||i instanceof Gi||i instanceof Hi||i instanceof nr||i instanceof Wi?i.toString():JSON.stringify(i)}class _r{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Nn(t[1]))return r.error("invalid value");let a=t[1],l=Wt(a),u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new _r(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ut{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let ns={string:et,number:we,boolean:Ze,object:gr};class yr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,l=1,u=t[0];if(u==="array"){let m,g;if(t.length>2){let b=t[1];if(typeof b!="string"||!(b in ns)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=ns[b],l++}else m=Xe;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],l++}a=A(m,g)}else{if(!ns[u])throw new Error(`Types doesn't contain name = ${u}`);a=ns[u]}let p=[];for(;l<t.length;l++){let m=r.parse(t[l],l,Xe);if(!m)return null;p.push(m)}return new yr(a,p)}evaluate(t){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(t);if(!j(this.type,Wt(a)))return a;if(r===this.args.length-1)throw new Ut(`Expected value to be of type ${E(this.type)}, but found ${E(Wt(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let gl={"to-boolean":Ze,"to-color":Pi,"to-number":we,"to-string":et};class vr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[0];if(!gl[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");let l=gl[a],u=[];for(let p=1;p<t.length;p++){let m=r.parse(t[p],p,Xe);if(!m)return null;u.push(m)}return new vr(l,u)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(let l of this.args){if(r=l.evaluate(t),a=null,r instanceof _t)return r;if(typeof r=="string"){let u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ya(r[0],r[1],r[2],r[3]),!a))return new _t(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ut(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let a of this.args){r=a.evaluate(t);let l=Hi.parse(r);if(l)return l}throw new Ut(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let a of this.args){r=a.evaluate(t);let l=nr.parse(r);if(l)return l}throw new Ut(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let a of this.args){if(r=a.evaluate(t),r===null)return 0;let l=Number(r);if(!isNaN(l))return l}throw new Ut(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Gi.fromString(fo(this.args[0].evaluate(t)));case"resolvedImage":return Wi.fromString(fo(this.args[0].evaluate(t)));default:return fo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let _d=["Unknown","Point","LineString","Polygon"];class as{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_d[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=_t.parse(t)),r}}class jn{constructor(t,r,a=[],l,u=new Br,p=[]){this.registry=t,this.path=a,this.key=a.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l,this._isConstant=r}parse(t,r,a,l,u={}){return r?this.concat(r,a,l)._parse(t,u):this._parse(t,u)}_parse(t,r){function a(l,u,p){return p==="assert"?new yr(u,[l]):p==="coerce"?new vr(u,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let u=this.registry[l];if(u){let p=u.parse(t,this);if(!p)return null;if(this.expectedType){let m=this.expectedType,g=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(m.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(m,g))return null}else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"coerce");else p=a(p,m,r.typeAnnotation||"assert")}if(!(p instanceof _r)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){let m=new as;try{p=new _r(p.type,p.evaluate(m))}catch(g){return this.error(g.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){let l=typeof t=="number"?this.path.concat(t):this.path,u=a?this.scope.concat(a):this.scope;return new jn(this.registry,this._isConstant,l,r||null,u,this.errors)}error(t,...r){let a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new xi(a,t))}checkSubtype(t,r){let a=j(t,r);return a&&this.error(a),a}}class xn{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let u=1;u<t.length-1;u+=2){let p=t[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);let m=r.parse(t[u+1],u+1);if(!m)return null;a.push([p,m])}let l=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return l?new xn(a,l):null}outputDefined(){return this.result.outputDefined()}}class mt{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=t[1];return r.scope.has(a)?new mt(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class _l{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,we),l=r.parse(t[2],2,A(r.expectedType||Xe));return a&&l?new _l(l.type.itemType,a,l):null}evaluate(t){let r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Ut(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ut(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ut(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class yl{constructor(t,r){this.type=Ze,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,Xe);return a&&l?K(a.type,[Ze,et,we,yn,Xe])?new yl(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${E(a.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!J(r,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${E(Wt(r))} instead.`);if(!J(a,["string","array"]))throw new Ut(`Expected second argument to be of type array or string, but found ${E(Wt(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class va{constructor(t,r,a){this.type=we,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,Xe);if(!a||!l)return null;if(!K(a.type,[Ze,et,we,yn,Xe]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${E(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,we);return u?new va(a,l,u):null}return new va(a,l)}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!J(r,["boolean","string","number","null"]))throw new Ut(`Expected first argument to be of type boolean, string, number or null, but found ${E(Wt(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),J(a,["string"])){let u=a.indexOf(r,l);return u===-1?-1:[...a.slice(0,u)].length}if(J(a,["array"]))return a.indexOf(r,l);throw new Ut(`Expected second argument to be of type array or string, but found ${E(Wt(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class vl{constructor(t,r,a,l,u,p){this.inputType=t,this.type=r,this.input=a,this.cases=l,this.outputs=u,this.otherwise=p}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);let u={},p=[];for(let b=2;b<t.length-1;b+=2){let w=t[b],S=t[b+1];Array.isArray(w)||(w=[w]);let T=r.concat(b);if(w.length===0)return T.error("Expected at least one branch label.");for(let L of w){if(typeof L!="number"&&typeof L!="string")return T.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return T.error("Numeric branch labels must be integer values.");if(a){if(T.checkSubtype(a,Wt(L)))return null}else a=Wt(L);if(u[String(L)]!==void 0)return T.error("Branch labels must be unique.");u[String(L)]=p.length}let P=r.parse(S,b,l);if(!P)return null;l=l||P.type,p.push(P)}let m=r.parse(t[1],1,Xe);if(!m)return null;let g=r.parse(t[t.length-1],t.length-1,l);return g?m.type.kind!=="value"&&r.concat(1).checkSubtype(a,m.type)?null:new vl(a,l,m,u,p,g):null}evaluate(t){let r=this.input.evaluate(t);return(Wt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class os{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let l=[];for(let p=1;p<t.length-1;p+=2){let m=r.parse(t[p],p,Ze);if(!m)return null;let g=r.parse(t[p+1],p+1,a);if(!g)return null;l.push([m,g]),a=a||g.type}let u=r.parse(t[t.length-1],t.length-1,a);if(!u)return null;if(!a)throw new Error("Can't infer output type");return new os(a,l,u)}evaluate(t){for(let[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class go{constructor(t,r,a,l){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Xe),l=r.parse(t[2],2,we);if(!a||!l)return null;if(!K(a.type,[A(Xe),et,Xe]))return r.error(`Expected first argument to be of type array or string, but found ${E(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,we);return u?new go(a.type,a,l,u):null}return new go(a.type,a,l)}evaluate(t){let r=this.input.evaluate(t),a=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),J(r,["string"]))return[...r].slice(a,l).join("");if(J(r,["array"]))return r.slice(a,l);throw new Ut(`Expected first argument to be of type array or string, but found ${E(Wt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ss(i,t){let r=i.length-1,a,l,u=0,p=r,m=0;for(;u<=p;)if(m=Math.floor((u+p)/2),a=i[m],l=i[m+1],a<=t){if(m===r||t<l)return m;u=m+1}else{if(!(a>t))throw new Ut("Input is not a number.");p=m-1}return 0}class xa{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[l,u]of a)this.labels.push(l),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(t[1],1,we);if(!a)return null;let l=[],u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<t.length;p+=2){let m=p===1?-1/0:t[p],g=t[p+1],b=p,w=p+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);let S=r.parse(g,w,u);if(!S)return null;u=u||S.type,l.push([m,S])}return new xa(u,a,l)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;return l>=r[u-1]?a[u-1].evaluate(t):a[ss(r,l)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Rc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var yd=Fc;function Fc(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}Fc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var p=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?p=r:m=r,r=.5*(m-p)+p;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var vd=Rc(yd);function qn(i,t,r){return i+r*(t-i)}function _o(i,t,r){return i.map((a,l)=>qn(a,t[l],r))}let Di={number:qn,color:function(i,t,r,a="rgb"){switch(a){case"rgb":{let[l,u,p,m]=_o(i.rgb,t.rgb,r);return new _t(l,u,p,m,!1)}case"hcl":{let[l,u,p,m]=i.hcl,[g,b,w,S]=t.hcl,T,P;if(isNaN(l)||isNaN(g))isNaN(l)?isNaN(g)?T=NaN:(T=g,p!==1&&p!==0||(P=b)):(T=l,w!==1&&w!==0||(P=u));else{let ie=g-l;g>l&&ie>180?ie-=360:g<l&&l-g>180&&(ie+=360),T=l+r*ie}let[L,R,N,$]=function([ie,X,ee,oe]){return ie=isNaN(ie)?0:ie*je,Rt([ee,Math.cos(ie)*X,Math.sin(ie)*X,oe])}([T,P??qn(u,b,r),qn(p,w,r),qn(m,S,r)]);return new _t(L,R,N,$,!1)}case"lab":{let[l,u,p,m]=Rt(_o(i.lab,t.lab,r));return new _t(l,u,p,m,!1)}}},array:_o,padding:function(i,t,r){return new Hi(_o(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){let a=i.values,l=t.values;if(a.length!==l.length)throw new Ut(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);let u=[];for(let p=0;p<a.length;p+=2){if(a[p]!==l[p])throw new Ut(`Cannot interpolate values containing mismatched anchors. from[${p}]: ${a[p]}, to[${p}]: ${l[p]}`);u.push(a[p]);let[m,g]=a[p+1],[b,w]=l[p+1];u.push([qn(m,b,r),qn(g,w,r)])}return new nr(u)}};class zi{constructor(t,r,a,l,u){this.type=t,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[p,m]of u)this.labels.push(p),this.outputs.push(m)}static interpolationFactor(t,r,a,l){let u=0;if(t.name==="exponential")u=ls(r,t.base,a,l);else if(t.name==="linear")u=ls(r,1,a,l);else if(t.name==="cubic-bezier"){let p=t.controlPoints;u=new vd(p[0],p[1],p[2],p[3]).solve(ls(r,1,a,l))}return u}static parse(t,r){let[a,l,u,...p]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let b=l[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let b=l.slice(1);if(b.length!==4||b.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,we),!u)return null;let m=[],g=null;a==="interpolate-hcl"||a==="interpolate-lab"?g=Pi:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let b=0;b<p.length;b+=2){let w=p[b],S=p[b+1],T=b+3,P=b+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);let L=r.parse(S,P,g);if(!L)return null;g=g||L.type,m.push([w,L])}return te(g,we)||te(g,Pi)||te(g,vn)||te(g,U)||te(g,A(we))?new zi(g,a,l,u,m):r.error(`Type ${E(g)} is not interpolatable.`)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;if(l>=r[u-1])return a[u-1].evaluate(t);let p=ss(r,l),m=zi.interpolationFactor(this.interpolation,l,r[p],r[p+1]),g=a[p].evaluate(t),b=a[p+1].evaluate(t);switch(this.operator){case"interpolate":return Di[this.type.kind](g,b,m);case"interpolate-hcl":return Di.color(g,b,m,"hcl");case"interpolate-lab":return Di.color(g,b,m,"lab")}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ls(i,t,r,a){let l=a-r,u=i-r;return l===0?0:t===1?u/l:(Math.pow(t,u)-1)/(Math.pow(t,l)-1)}class cs{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null,l=r.expectedType;l&&l.kind!=="value"&&(a=l);let u=[];for(let m of t.slice(1)){let g=r.parse(m,1+u.length,a,void 0,{typeAnnotation:"omit"});if(!g)return null;a=a||g.type,u.push(g)}if(!a)throw new Error("No output type");let p=l&&u.some(m=>j(l,m.type));return new cs(p?Xe:a,u)}evaluate(t){let r,a=null,l=0;for(let u of this.args)if(l++,a=u.evaluate(t),a&&a instanceof Wi&&!a.available&&(r||(r=a.name),a=null,l===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function hs(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Bc(i,t,r,a){return a.compare(t,r)===0}function ba(i,t,r){let a=i!=="=="&&i!=="!=";return class ig{constructor(u,p,m){this.type=Ze,this.lhs=u,this.rhs=p,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");let m=u[0],g=p.parse(u[1],1,Xe);if(!g)return null;if(!hs(m,g.type))return p.concat(1).error(`"${m}" comparisons are not supported for type '${E(g.type)}'.`);let b=p.parse(u[2],2,Xe);if(!b)return null;if(!hs(m,b.type))return p.concat(2).error(`"${m}" comparisons are not supported for type '${E(b.type)}'.`);if(g.type.kind!==b.type.kind&&g.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${E(g.type)}' and '${E(b.type)}'.`);a&&(g.type.kind==="value"&&b.type.kind!=="value"?g=new yr(b.type,[g]):g.type.kind!=="value"&&b.type.kind==="value"&&(b=new yr(g.type,[b])));let w=null;if(u.length===4){if(g.type.kind!=="string"&&b.type.kind!=="string"&&g.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(w=p.parse(u[3],3,Or),!w)return null}return new ig(g,b,w)}evaluate(u){let p=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(a&&this.hasUntypedArgument){let g=Wt(p),b=Wt(m);if(g.kind!==b.kind||g.kind!=="string"&&g.kind!=="number")throw new Ut(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let g=Wt(p),b=Wt(m);if(g.kind!=="string"||b.kind!=="string")return t(u,p,m)}return this.collator?r(u,p,m,this.collator.evaluate(u)):t(u,p,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}let xd=ba("==",function(i,t,r){return t===r},Bc),Oc=ba("!=",function(i,t,r){return t!==r},function(i,t,r,a){return!Bc(0,t,r,a)}),Vc=ba("<",function(i,t,r){return t<r},function(i,t,r,a){return a.compare(t,r)<0}),bd=ba(">",function(i,t,r){return t>r},function(i,t,r,a){return a.compare(t,r)>0}),wd=ba("<=",function(i,t,r){return t<=r},function(i,t,r,a){return a.compare(t,r)<=0}),Nc=ba(">=",function(i,t,r){return t>=r},function(i,t,r,a){return a.compare(t,r)>=0});class yo{constructor(t,r,a){this.type=Or,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ze);if(!l)return null;let u=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ze);if(!u)return null;let p=null;return a.locale&&(p=r.parse(a.locale,1,et),!p)?null:new yo(l,u,p)}evaluate(t){return new ml(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class xl{constructor(t,r,a,l,u){this.type=et,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let a=r.parse(t[1],1,we);if(!a)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,et),!u))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,et),!p))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,we),!m))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,we),!g)?null:new xl(a,u,p,m,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ds{constructor(t){this.type=tn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let l=[],u=!1;for(let p=1;p<=t.length-1;++p){let m=t[p];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let g=null;if(m["font-scale"]&&(g=r.parse(m["font-scale"],1,we),!g))return null;let b=null;if(m["text-font"]&&(b=r.parse(m["text-font"],1,A(et)),!b))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,Pi),!w))return null;let S=l[l.length-1];S.scale=g,S.font=b,S.textColor=w}else{let g=r.parse(t[p],1,Xe);if(!g)return null;let b=g.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new ds(l)}evaluate(t){return new Gi(this.sections.map(r=>{let a=r.content.evaluate(t);return Wt(a)===Vr?new fl("",a,null,null,null):new fl(fo(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class bl{constructor(t){this.type=Vr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let a=r.parse(t[1],1,et);return a?new bl(a):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),a=Wi.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class wl{constructor(t){this.type=we,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${E(a.type)} instead.`):new wl(a):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Ut(`Expected value to be of type string or array, but found ${E(Wt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Nr=8192;function kd(i,t){let r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*Nr),Math.round(a*l*Nr)]}function kl(i,t){let r=Math.pow(2,t.z);return[(l=(i[0]/Nr+t.x)/r,360*l-180),(a=(i[1]/Nr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function Un(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function bn(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function ft(i,t,r){let a=i[0]-t[0],l=i[1]-t[1],u=i[0]-r[0],p=i[1]-r[1];return a*p-u*l==0&&a*u<=0&&l*p<=0}function us(i,t,r,a){return(l=[a[0]-r[0],a[1]-r[1]])[0]*(u=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*u[0]!=0&&!(!qc(i,t,r,a)||!qc(r,a,i,t));var l,u}function Cd(i,t,r){for(let a of r)for(let l=0;l<a.length-1;++l)if(us(i,t,a[l],a[l+1]))return!0;return!1}function wa(i,t,r=!1){let a=!1;for(let m of t)for(let g=0;g<m.length-1;g++){if(ft(i,m[g],m[g+1]))return r;(u=m[g])[1]>(l=i)[1]!=(p=m[g+1])[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(a=!a)}var l,u,p;return a}function Sd(i,t){for(let r of t)if(wa(i,r))return!0;return!1}function jc(i,t){for(let r of i)if(!wa(r,t))return!1;for(let r=0;r<i.length-1;++r)if(Cd(i[r],i[r+1],t))return!1;return!0}function Md(i,t){for(let r of t)if(jc(i,r))return!0;return!1}function qc(i,t,r,a){let l=a[0]-r[0],u=a[1]-r[1],p=(i[0]-r[0])*u-l*(i[1]-r[1]),m=(t[0]-r[0])*u-l*(t[1]-r[1]);return p>0&&m<0||p<0&&m>0}function Cl(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=[];for(let p=0;p<i[l].length;p++){let m=kd(i[l][p],r);Un(t,m),u.push(m)}a.push(u)}return a}function Uc(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=Cl(i[l],t,r);a.push(u)}return a}function $c(i,t,r,a){if(i[0]<r[0]||i[0]>r[2]){let l=.5*a,u=i[0]-r[0]>l?-a:r[0]-i[0]>l?a:0;u===0&&(u=i[0]-r[2]>l?-a:r[2]-i[0]>l?a:0),i[0]+=u}Un(t,i)}function Zc(i,t,r,a){let l=Math.pow(2,a.z)*Nr,u=[a.x*Nr,a.y*Nr],p=[];for(let m of i)for(let g of m){let b=[g.x+u[0],g.y+u[1]];$c(b,t,r,l),p.push(b)}return p}function Gc(i,t,r,a){let l=Math.pow(2,a.z)*Nr,u=[a.x*Nr,a.y*Nr],p=[];for(let g of i){let b=[];for(let w of g){let S=[w.x+u[0],w.y+u[1]];Un(t,S),b.push(S)}p.push(b)}if(t[2]-t[0]<=l/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let g of p)for(let b of g)$c(b,t,r,l)}var m;return p}class $n{constructor(t,r){this.type=Ze,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Nn(t[1])){let a=t[1];if(a.type==="FeatureCollection"){let l=[];for(let u of a.features){let{type:p,coordinates:m}=u.geometry;p==="Polygon"&&l.push(m),p==="MultiPolygon"&&l.push(...m)}if(l.length)return new $n(a,{type:"MultiPolygon",coordinates:l})}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new $n(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new $n(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(a.type==="Polygon"){let m=Cl(a.coordinates,u,p),g=Zc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let b of g)if(!wa(b,m))return!1}if(a.type==="MultiPolygon"){let m=Uc(a.coordinates,u,p),g=Zc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let b of g)if(!Sd(b,m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(a.type==="Polygon"){let m=Cl(a.coordinates,u,p),g=Gc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let b of g)if(!jc(b,m))return!1}if(a.type==="MultiPolygon"){let m=Uc(a.coordinates,u,p),g=Gc(r.geometry(),l,u,p);if(!bn(l,u))return!1;for(let b of g)if(!Md(b,m))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hc=class{constructor(i=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:t,compare:r}=this,a=t[i];for(;i>0;){let l=i-1>>1,u=t[l];if(r(a,u)>=0)break;t[i]=u,i=l}t[i]=a}_down(i){let{data:t,compare:r}=this,a=this.length>>1,l=t[i];for(;i<a;){let u=1+(i<<1),p=u+1;if(p<this.length&&r(t[p],t[u])<0&&(u=p),r(t[u],l)>=0)break;t[i]=t[u],i=u}t[i]=l}};function Id(i,t,r,a,l){Wc(i,t,r,a||i.length-1,l||Td)}function Wc(i,t,r,a,l){for(;a>r;){if(a-r>600){var u=a-r+1,p=t-r+1,m=Math.log(u),g=.5*Math.exp(2*m/3),b=.5*Math.sqrt(m*g*(u-g)/u)*(p-u/2<0?-1:1);Wc(i,t,Math.max(r,Math.floor(t-p*g/u+b)),Math.min(a,Math.floor(t+(u-p)*g/u+b)),l)}var w=i[t],S=r,T=a;for(vo(i,r,t),l(i[a],w)>0&&vo(i,r,a);S<T;){for(vo(i,S,T),S++,T--;l(i[S],w)<0;)S++;for(;l(i[T],w)>0;)T--}l(i[r],w)===0?vo(i,r,T):vo(i,++T,a),T<=t&&(r=T+1),t<=T&&(a=T-1)}}function vo(i,t,r){var a=i[t];i[t]=i[r],i[r]=a}function Td(i,t){return i<t?-1:i>t?1:0}function ps(i,t){if(i.length<=1)return[i];let r=[],a,l;for(let u of i){let p=Ad(u);p!==0&&(u.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(a&&r.push(a),a=[u]):a.push(u))}if(a&&r.push(a),t>1)for(let u=0;u<r.length;u++)r[u].length<=t||(Id(r[u],t,1,r[u].length-1,Ed),r[u]=r[u].slice(0,t));return r}function Ed(i,t){return t.area-i.area}function Ad(i){let t=0;for(let r,a,l=0,u=i.length,p=u-1;l<u;p=l++)r=i[l],a=i[p],t+=(a.x-r.x)*(r.y+a.y);return t}let Xc=1/298.257223563,Kc=Xc*(2-Xc),Yc=Math.PI/180;class Sl{constructor(t){let r=6378.137*Yc*1e3,a=Math.cos(t*Yc),l=1/(1-Kc*(1-a*a)),u=Math.sqrt(l);this.kx=r*u*a,this.ky=r*u*l*(1-Kc)}distance(t,r){let a=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+l*l)}pointOnLine(t,r){let a,l,u,p,m=1/0;for(let g=0;g<t.length-1;g++){let b=t[g][0],w=t[g][1],S=this.wrap(t[g+1][0]-b)*this.kx,T=(t[g+1][1]-w)*this.ky,P=0;S===0&&T===0||(P=(this.wrap(r[0]-b)*this.kx*S+(r[1]-w)*this.ky*T)/(S*S+T*T),P>1?(b=t[g+1][0],w=t[g+1][1]):P>0&&(b+=S/this.kx*P,w+=T/this.ky*P)),S=this.wrap(r[0]-b)*this.kx,T=(r[1]-w)*this.ky;let L=S*S+T*T;L<m&&(m=L,a=b,l=w,u=g,p=P)}return{point:[a,l],index:u,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Jc(i,t){return t[0]-i[0]}function ms(i){return i[1]-i[0]+1}function rn(i,t){return i[1]>=i[0]&&i[1]<t}function Ml(i,t){if(i[0]>i[1])return[null,null];let r=ms(i);if(t){if(r===2)return[i,null];let l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];let a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function Il(i,t){if(!rn(t,i.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Un(r,i[a]);return r}function Tl(i){let t=[1/0,1/0,-1/0,-1/0];for(let r of i)for(let a of r)Un(t,a);return t}function fs(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function El(i,t,r){if(!fs(i)||!fs(t))return NaN;let a=0,l=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[a,l])}function Zn(i,t,r){let a=r.pointOnLine(t,i);return r.distance(i,a.point)}function Al(i,t,r,a,l){let u=Math.min(Zn(i,[r,a],l),Zn(t,[r,a],l)),p=Math.min(Zn(r,[i,t],l),Zn(a,[i,t],l));return Math.min(u,p)}function Pd(i,t,r,a,l){if(!rn(t,i.length)||!rn(a,r.length))return 1/0;let u=1/0;for(let p=t[0];p<t[1];++p){let m=i[p],g=i[p+1];for(let b=a[0];b<a[1];++b){let w=r[b],S=r[b+1];if(us(m,g,w,S))return 0;u=Math.min(u,Al(m,g,w,S,l))}}return u}function Bt(i,t,r,a,l){if(!rn(t,i.length)||!rn(a,r.length))return NaN;let u=1/0;for(let p=t[0];p<=t[1];++p)for(let m=a[0];m<=a[1];++m)if(u=Math.min(u,l.distance(i[p],r[m])),u===0)return u;return u}function Dd(i,t,r){if(wa(i,t,!0))return 0;let a=1/0;for(let l of t){let u=l[0],p=l[l.length-1];if(u!==p&&(a=Math.min(a,Zn(i,[p,u],r)),a===0))return a;let m=r.pointOnLine(l,i);if(a=Math.min(a,r.distance(i,m.point)),a===0)return a}return a}function it(i,t,r,a){if(!rn(t,i.length))return NaN;for(let u=t[0];u<=t[1];++u)if(wa(i[u],r,!0))return 0;let l=1/0;for(let u=t[0];u<t[1];++u){let p=i[u],m=i[u+1];for(let g of r)for(let b=0,w=g.length,S=w-1;b<w;S=b++){let T=g[S],P=g[b];if(us(p,m,T,P))return 0;l=Math.min(l,Al(p,m,T,P,a))}}return l}function gs(i,t){for(let r of i)for(let a of r)if(wa(a,t,!0))return!0;return!1}function Ct(i,t,r,a=1/0){let l=Tl(i),u=Tl(t);if(a!==1/0&&El(l,u,r)>=a)return a;if(bn(l,u)){if(gs(i,t))return 0}else if(gs(t,i))return 0;let p=1/0;for(let m of i)for(let g=0,b=m.length,w=b-1;g<b;w=g++){let S=m[w],T=m[g];for(let P of t)for(let L=0,R=P.length,N=R-1;L<R;N=L++){let $=P[N],ie=P[L];if(us(S,T,$,ie))return 0;p=Math.min(p,Al(S,T,$,ie,r))}}return p}function vt(i,t,r,a,l,u){if(!u)return;let p=El(Il(a,u),l,r);p<t&&i.push([p,u,[0,0]])}function Gn(i,t,r,a,l,u,p){if(!u||!p)return;let m=El(Il(a,u),Il(l,p),r);m<t&&i.push([m,u,p])}function xo(i,t,r,a,l=1/0){let u=Math.min(a.distance(i[0],r[0][0]),l);if(u===0)return u;let p=new Hc([[0,[0,i.length-1],[0,0]]],Jc),m=Tl(r);for(;p.length>0;){let g=p.pop();if(g[0]>=u)continue;let b=g[1],w=t?50:100;if(ms(b)<=w){if(!rn(b,i.length))return NaN;if(t){let S=it(i,b,r,a);if(isNaN(S)||S===0)return S;u=Math.min(u,S)}else for(let S=b[0];S<=b[1];++S){let T=Dd(i[S],r,a);if(u=Math.min(u,T),u===0)return 0}}else{let S=Ml(b,t);vt(p,u,a,i,m,S[0]),vt(p,u,a,i,m,S[1])}}return u}function bo(i,t,r,a,l,u=1/0){let p=Math.min(u,l.distance(i[0],r[0]));if(p===0)return p;let m=new Hc([[0,[0,i.length-1],[0,r.length-1]]],Jc);for(;m.length>0;){let g=m.pop();if(g[0]>=p)continue;let b=g[1],w=g[2],S=t?50:100,T=a?50:100;if(ms(b)<=S&&ms(w)<=T){if(!rn(b,i.length)&&rn(w,r.length))return NaN;let P;if(t&&a)P=Pd(i,b,r,w,l),p=Math.min(p,P);else if(t&&!a){let L=i.slice(b[0],b[1]+1);for(let R=w[0];R<=w[1];++R)if(P=Zn(r[R],L,l),p=Math.min(p,P),p===0)return p}else if(!t&&a){let L=r.slice(w[0],w[1]+1);for(let R=b[0];R<=b[1];++R)if(P=Zn(i[R],L,l),p=Math.min(p,P),p===0)return p}else P=Bt(i,b,r,w,l),p=Math.min(p,P)}else{let P=Ml(b,t),L=Ml(w,a);Gn(m,p,l,i,r,P[0],L[0]),Gn(m,p,l,i,r,P[0],L[1]),Gn(m,p,l,i,r,P[1],L[0]),Gn(m,p,l,i,r,P[1],L[1])}}return p}function Pl(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Hn{constructor(t,r){this.type=we,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Nn(t[1])){let a=t[1];if(a.type==="FeatureCollection")return new Hn(a,a.features.map(l=>Pl(l.geometry)).flat());if(a.type==="Feature")return new Hn(a,Pl(a.geometry));if("type"in a&&"coordinates"in a)return new Hn(a,Pl(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>kl([g.x,g.y],r.canonical));if(l.length===0)return NaN;let p=new Sl(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,bo(u,!1,[g.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,bo(u,!1,g.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,xo(u,!1,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>kl([g.x,g.y],r.canonical));if(l.length===0)return NaN;let p=new Sl(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,bo(u,!0,[g.coordinates],!1,p,m));break;case"LineString":m=Math.min(m,bo(u,!0,g.coordinates,!0,p,m));break;case"Polygon":m=Math.min(m,xo(u,!0,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,a){let l=r.geometry();if(l.length===0||l[0].length===0)return NaN;let u=ps(l,0).map(g=>g.map(b=>b.map(w=>kl([w.x,w.y],r.canonical)))),p=new Sl(u[0][0][0][1]),m=1/0;for(let g of a)for(let b of u){switch(g.type){case"Point":m=Math.min(m,xo([g.coordinates],!1,b,p,m));break;case"LineString":m=Math.min(m,xo(g.coordinates,!0,b,p,m));break;case"Polygon":m=Math.min(m,Ct(b,g.coordinates,p,m))}if(m===0)return m}return m}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let ka={"==":xd,"!=":Oc,">":bd,"<":Vc,">=":Nc,"<=":wd,array:yr,at:_l,boolean:yr,case:os,coalesce:cs,collator:yo,format:ds,image:bl,in:yl,"index-of":va,interpolate:zi,"interpolate-hcl":zi,"interpolate-lab":zi,length:wl,let:xn,literal:_r,match:vl,number:yr,"number-format":xl,object:yr,slice:go,step:xa,string:yr,"to-boolean":vr,"to-color":vr,"to-number":vr,"to-string":vr,var:mt,within:$n,distance:Hn};class ar{constructor(t,r,a,l){this.name=t,this.type=r,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let a=t[0],l=ar.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=p.filter(([b])=>!Array.isArray(b)||b.length===t.length-1),g=null;for(let[b,w]of m){g=new jn(r.registry,wo,r.path,null,r.scope);let S=[],T=!1;for(let P=1;P<t.length;P++){let L=t[P],R=Array.isArray(b)?b[P-1]:b.type,N=g.parse(L,1+S.length,R);if(!N){T=!0;break}S.push(N)}if(!T)if(Array.isArray(b)&&b.length!==S.length)g.error(`Expected ${b.length} arguments, but found ${S.length} instead.`);else{for(let P=0;P<S.length;P++){let L=Array.isArray(b)?b[P]:b.type,R=S[P];g.concat(P+1).checkSubtype(L,R.type)}if(g.errors.length===0)return new ar(a,u,w,S)}}if(m.length===1)r.errors.push(...g.errors);else{let b=(m.length?m:p).map(([S])=>{return T=S,Array.isArray(T)?`(${T.map(E).join(", ")})`:`(${E(T.type)}...)`;var T}).join(" | "),w=[];for(let S=1;S<t.length;S++){let T=r.parse(t[S],1+w.length);if(!T)return null;w.push(E(T.type))}r.error(`Expected arguments of type ${b}, but found (${w.join(", ")}) instead.`)}return null}static register(t,r){ar.definitions=r;for(let a in r)t[a]=ar}}function Dl(i,[t,r,a,l]){t=t.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);let u=l?l.evaluate(i):1,p=ya(t,r,a,u);if(p)throw new Ut(p);return new _t(t/255,r/255,a/255,u,!1)}function zl(i,t){return i in t}function Ll(i,t){let r=t[i];return r===void 0?null:r}function Wn(i){return{type:i}}function wo(i){if(i instanceof mt)return wo(i.boundExpression);if(i instanceof ar&&i.name==="error"||i instanceof yo||i instanceof $n||i instanceof Hn)return!1;let t=i instanceof vr||i instanceof yr,r=!0;return i.eachChild(a=>{r=t?r&&wo(a):r&&a instanceof _r}),!!r&&ko(i)&&Co(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ko(i){if(i instanceof ar&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof $n||i instanceof Hn)return!1;let t=!0;return i.eachChild(r=>{t&&!ko(r)&&(t=!1)}),t}function Ca(i){if(i instanceof ar&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Ca(r)&&(t=!1)}),t}function Co(i,t){if(i instanceof ar&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Co(a,t)&&(r=!1)}),r}function _s(i){return{result:"success",value:i}}function Sa(i){return{result:"error",value:i}}function Ma(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Qc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Rl(i){return!!i.expression&&i.expression.interpolated}function dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ys(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function zd(i){return i}function eh(i,t){let r=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",l=a||!(a||i.property!==void 0),u=i.type||(Rl(t)?"exponential":"interval");if(r||t.type==="padding"){let w=r?_t.parse:Hi.parse;(i=Fr({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],w(S[1])])),i.default=w(i.default?i.default:t.default)}if(i.colorSpace&&(p=i.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var p;let m,g,b;if(u==="exponential")m=ih;else if(u==="interval")m=vs;else if(u==="categorical"){m=th,g=Object.create(null);for(let w of i.stops)g[w[0]]=w[1];b=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=rh}if(a){let w={},S=[];for(let L=0;L<i.stops.length;L++){let R=i.stops[L],N=R[0].zoom;w[N]===void 0&&(w[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},S.push(N)),w[N].stops.push([R[0].value,R[1]])}let T=[];for(let L of S)T.push([w[L].zoom,eh(w[L],t)]);let P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:zi.interpolationFactor.bind(void 0,P),zoomStops:T.map(L=>L[0]),evaluate:({zoom:L},R)=>ih({stops:T,base:i.base},t,L).evaluate(L,R)}}if(l){let w=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:zi.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(i,t,S,g,b)}}return{kind:"source",evaluate(w,S){let T=S&&S.properties?S.properties[i.property]:void 0;return T===void 0?Ia(i.default,t.default):m(i,t,T,g,b)}}}function Ia(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function th(i,t,r,a,l){return Ia(typeof r===l?a[r]:void 0,i.default,t.default)}function vs(i,t,r){if(dt(r)!=="number")return Ia(i.default,t.default);let a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];let l=ss(i.stops.map(u=>u[0]),r);return i.stops[l][1]}function ih(i,t,r){let a=i.base!==void 0?i.base:1;if(dt(r)!=="number")return Ia(i.default,t.default);let l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];let u=ss(i.stops.map(w=>w[0]),r),p=function(w,S,T,P){let L=P-T,R=w-T;return L===0?0:S===1?R/L:(Math.pow(S,R)-1)/(Math.pow(S,L)-1)}(r,a,i.stops[u][0],i.stops[u+1][0]),m=i.stops[u][1],g=i.stops[u+1][1],b=Di[t.type]||zd;return typeof m.evaluate=="function"?{evaluate(...w){let S=m.evaluate.apply(void 0,w),T=g.evaluate.apply(void 0,w);if(S!==void 0&&T!==void 0)return b(S,T,p,i.colorSpace)}}:b(m,g,p,i.colorSpace)}function rh(i,t,r){switch(t.type){case"color":r=_t.parse(r);break;case"formatted":r=Gi.fromString(r.toString());break;case"resolvedImage":r=Wi.fromString(r.toString());break;case"padding":r=Hi.parse(r);break;default:dt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Ia(r,i.default,t.default)}ar.register(ka,{error:[{kind:"error"},[et],(i,[t])=>{throw new Ut(t.evaluate(i))}],typeof:[et,[Xe],(i,[t])=>E(Wt(t.evaluate(i)))],"to-rgba":[A(we,4),[Pi],(i,[t])=>{let[r,a,l,u]=t.evaluate(i).rgb;return[255*r,255*a,255*l,u]}],rgb:[Pi,[we,we,we],Dl],rgba:[Pi,[we,we,we,we],Dl],has:{type:Ze,overloads:[[[et],(i,[t])=>zl(t.evaluate(i),i.properties())],[[et,gr],(i,[t,r])=>zl(t.evaluate(i),r.evaluate(i))]]},get:{type:Xe,overloads:[[[et],(i,[t])=>Ll(t.evaluate(i),i.properties())],[[et,gr],(i,[t,r])=>Ll(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Xe,[et],(i,[t])=>Ll(t.evaluate(i),i.featureState||{})],properties:[gr,[],i=>i.properties()],"geometry-type":[et,[],i=>i.geometryType()],id:[Xe,[],i=>i.id()],zoom:[we,[],i=>i.globals.zoom],"heatmap-density":[we,[],i=>i.globals.heatmapDensity||0],"line-progress":[we,[],i=>i.globals.lineProgress||0],accumulated:[Xe,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[we,Wn(we),(i,t)=>{let r=0;for(let a of t)r+=a.evaluate(i);return r}],"*":[we,Wn(we),(i,t)=>{let r=1;for(let a of t)r*=a.evaluate(i);return r}],"-":{type:we,overloads:[[[we,we],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[we],(i,[t])=>-t.evaluate(i)]]},"/":[we,[we,we],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[we,[we,we],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[we,[],()=>Math.LN2],pi:[we,[],()=>Math.PI],e:[we,[],()=>Math.E],"^":[we,[we,we],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[we,[we],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[we,[we],(i,[t])=>Math.log(t.evaluate(i))],log2:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[we,[we],(i,[t])=>Math.sin(t.evaluate(i))],cos:[we,[we],(i,[t])=>Math.cos(t.evaluate(i))],tan:[we,[we],(i,[t])=>Math.tan(t.evaluate(i))],asin:[we,[we],(i,[t])=>Math.asin(t.evaluate(i))],acos:[we,[we],(i,[t])=>Math.acos(t.evaluate(i))],atan:[we,[we],(i,[t])=>Math.atan(t.evaluate(i))],min:[we,Wn(we),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[we,Wn(we),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[we,[we],(i,[t])=>Math.abs(t.evaluate(i))],round:[we,[we],(i,[t])=>{let r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[we,[we],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[we,[we],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ze,[et,Xe],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Ze,[Xe],(i,[t])=>i.id()===t.value],"filter-type-==":[Ze,[et],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Ze,[et,Xe],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[Ze,[Xe],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Ze,[Xe],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ze,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ze,[A(et)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ze,[A(Xe)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ze,[et,A(Xe)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ze,[et,A(Xe)],(i,[t,r])=>function(a,l,u,p){for(;u<=p;){let m=u+p>>1;if(l[m]===a)return!0;l[m]>a?p=m-1:u=m+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Wn(Ze),(i,t)=>{for(let r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Wn(Ze),(i,t)=>{for(let r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Ze,[Ze],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ze,[et],(i,[t])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[et,[et],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[et,[et],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[et,Wn(Xe),(i,t)=>t.map(r=>fo(r.evaluate(i))).join("")],"resolved-locale":[et,[Or],(i,[t])=>t.evaluate(i).resolvedLocale()]});class xs{constructor(t,r){var a;this.expression=t,this._warningHistory={},this._evaluator=new as,this._defaultValue=r?(a=r).type==="color"&&ys(a.default)?new _t(0,0,0,0):a.type==="color"?_t.parse(a.default)||null:a.type==="padding"?Hi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?nr.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,l,u,p){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null;try{let m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Ut(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function bs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ka}function Ta(i,t){let r=new jn(ka,wo,[],t?function(l){let u={color:Pi,string:et,number:we,enum:et,boolean:Ze,formatted:tn,padding:vn,resolvedImage:Vr,variableAnchorOffsetCollection:U};return l.type==="array"?A(u[l.value]||Xe,l.length):u[l.type]}(t):void 0),a=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?_s(new xs(a,t)):Sa(r.errors)}class Ea{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Ca(r.expression)}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,p)}evaluate(t,r,a,l,u,p){return this._styleExpression.evaluate(t,r,a,l,u,p)}}class Aa{constructor(t,r,a,l){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Ca(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,a,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,p)}evaluate(t,r,a,l,u,p){return this._styleExpression.evaluate(t,r,a,l,u,p)}interpolationFactor(t,r,a){return this.interpolationType?zi.interpolationFactor(this.interpolationType,t,r,a):0}}function Fl(i,t){let r=Ta(i,t);if(r.result==="error")return r;let a=r.value.expression,l=ko(a);if(!l&&!Ma(t))return Sa([new xi("","data expressions not supported")]);let u=Co(a,["zoom"]);if(!u&&!Qc(t))return Sa([new xi("","zoom expressions not supported")]);let p=So(a);return p||u?p instanceof xi?Sa([p]):p instanceof zi&&!Rl(t)?Sa([new xi("",'"interpolate" expressions cannot be used with this property')]):_s(p?new Aa(l?"camera":"composite",r.value,p.labels,p instanceof zi?p.interpolation:void 0):new Ea(l?"constant":"source",r.value)):Sa([new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pa{constructor(t,r){this._parameters=t,this._specification=r,Fr(this,eh(this._parameters,this._specification))}static deserialize(t){return new Pa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function So(i){let t=null;if(i instanceof xn)t=So(i.result);else if(i instanceof cs){for(let r of i.args)if(t=So(r),t)break}else(i instanceof xa||i instanceof zi)&&i.input instanceof ar&&i.input.name==="zoom"&&(t=i);return t instanceof xi||i.eachChild(r=>{let a=So(r);a instanceof xi?t=a:!t&&a?t=new xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ws(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!ws(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let ks={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Bl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ws(i)||(i=Cs(i));let t=Ta(i,ks);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,l)=>t.value.evaluate(r,a,{},l),needGeometry:nh(i)}}function Ld(i,t){return i<t?-1:i>t?1:0}function nh(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(nh(i[t]))return!0;return!1}function Cs(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?Ol(i[1],i[2],"=="):t==="!="?ci(Ol(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ol(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Cs))):t==="all"?["all"].concat(i.slice(1).map(Cs)):t==="none"?["all"].concat(i.slice(1).map(Cs).map(ci)):t==="in"?Mo(i[1],i.slice(2)):t==="!in"?ci(Mo(i[1],i.slice(2))):t==="has"?Io(i[1]):t!=="!has"||ci(Io(i[1]));var r}function Ol(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Mo(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Ld)]]:["filter-in-small",i,["literal",t]]}}function Io(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ci(i){return["!",i]}function Xn(i){let t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(let u of i)l+=`${Xn(u)},`;return`${l}]`}let r=Object.keys(i).sort(),a="{";for(let l=0;l<r.length;l++)a+=`${JSON.stringify(r[l])}:${Xn(i[r[l]])},`;return`${a}}`}function ah(i){let t="";for(let r of Vn)t+=`/${Xn(i[r])}`;return t}function oh(i){let t=i.value;return t?[new ye(i.key,t,"constants have been deprecated as of v8")]:[]}function Ot(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function xr(i){if(Array.isArray(i))return i.map(xr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let r in i)t[r]=xr(i[r]);return t}return Ot(i)}function Xi(i){let t=i.key,r=i.value,a=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec,m=i.validateSpec,g=[],b=dt(r);if(b!=="object")return[new ye(t,r,`object expected, ${b} found`)];for(let w in r){let S=w.split(".")[0],T=a[S]||a["*"],P;if(l[S])P=l[S];else if(a[S])P=m;else if(l["*"])P=l["*"];else{if(!a["*"]){g.push(new ye(t,r[w],`unknown property "${w}"`));continue}P=m}g=g.concat(P({key:(t&&`${t}.`)+w,value:r[w],valueSpec:T,style:u,styleSpec:p,object:r,objectKey:w,validateSpec:m},r))}for(let w in a)l[w]||a[w].required&&a[w].default===void 0&&r[w]===void 0&&g.push(new ye(t,r,`missing required property "${w}"`));return g}function To(i){let t=i.value,r=i.valueSpec,a=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||i.validateSpec;if(dt(t)!=="array")return[new ye(u,t,`array expected, ${dt(t)} found`)];if(r.length&&t.length!==r.length)return[new ye(u,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ye(u,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),dt(r.value)==="object"&&(m=r.value);let g=[];for(let b=0;b<t.length;b++)g=g.concat(p({array:t,arrayIndex:b,value:t[b],valueSpec:m,validateSpec:i.validateSpec,style:a,styleSpec:l,key:`${u}[${b}]`}));return g}function Vl(i){let t=i.key,r=i.value,a=i.valueSpec,l=dt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ye(t,r,`number expected, ${l} found`)]:"minimum"in a&&r<a.minimum?[new ye(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new ye(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Ss(i){let t=i.valueSpec,r=Ot(i.value.type),a,l,u,p={},m=r!=="categorical"&&i.value.property===void 0,g=!m,b=dt(i.value.stops)==="array"&&dt(i.value.stops[0])==="array"&&dt(i.value.stops[0][0])==="object",w=Xi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(r==="identity")return[new ye(P.key,P.value,'identity function may not have a "stops" property')];let L=[],R=P.value;return L=L.concat(To({key:P.key,value:R,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:S})),dt(R)==="array"&&R.length===0&&L.push(new ye(P.key,R,"array must have at least one stop")),L},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return r==="identity"&&m&&w.push(new ye(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||w.push(new ye(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Rl(i.valueSpec)&&w.push(new ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Ma(i.valueSpec)?w.push(new ye(i.key,i.value,"property functions not supported")):m&&!Qc(i.valueSpec)&&w.push(new ye(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!b||i.value.property!==void 0||w.push(new ye(i.key,i.value,'"property" property is required')),w;function S(P){let L=[],R=P.value,N=P.key;if(dt(R)!=="array")return[new ye(N,R,`array expected, ${dt(R)} found`)];if(R.length!==2)return[new ye(N,R,`array length 2 expected, length ${R.length} found`)];if(b){if(dt(R[0])!=="object")return[new ye(N,R,`object expected, ${dt(R[0])} found`)];if(R[0].zoom===void 0)return[new ye(N,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new ye(N,R,"object stop key must have value")];if(u&&u>Ot(R[0].zoom))return[new ye(N,R[0].zoom,"stop zoom values must appear in ascending order")];Ot(R[0].zoom)!==u&&(u=Ot(R[0].zoom),l=void 0,p={}),L=L.concat(Xi({key:`${N}[0]`,value:R[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:Vl,value:T}}))}else L=L.concat(T({key:`${N}[0]`,value:R[0],valueSpec:{},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},R));return bs(xr(R[1]))?L.concat([new ye(`${N}[1]`,R[1],"expressions are not allowed in function stops.")]):L.concat(P.validateSpec({key:`${N}[1]`,value:R[1],valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function T(P,L){let R=dt(P.value),N=Ot(P.value),$=P.value!==null?P.value:L;if(a){if(R!==a)return[new ye(P.key,$,`${R} stop domain type must match previous stop domain type ${a}`)]}else a=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new ye(P.key,$,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&r!=="categorical"){let ie=`number expected, ${R} found`;return Ma(t)&&r===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ye(P.key,$,ie)]}return r!=="categorical"||R!=="number"||isFinite(N)&&Math.floor(N)===N?r!=="categorical"&&R==="number"&&l!==void 0&&N<l?[new ye(P.key,$,"stop domain values must appear in ascending order")]:(l=N,r==="categorical"&&N in p?[new ye(P.key,$,"stop domain values must be unique")]:(p[N]=!0,[])):[new ye(P.key,$,`integer expected, found ${N}`)]}}function Da(i){let t=(i.expressionContext==="property"?Fl:Ta)(xr(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new ye(`${i.key}${a.key}`,i.value,a.message));let r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ca(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ca(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Co(r,["zoom","feature-state"]))return[new ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ko(r))return[new ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nn(i){let t=i.key,r=i.value,a=i.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Nl(i){return ws(xr(i.value))?Da(Fr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ms(i)}function Ms(i){let t=i.value,r=i.key;if(dt(t)!=="array")return[new ye(r,t,`array expected, ${dt(t)} found`)];let a=i.styleSpec,l,u=[];if(t.length<1)return[new ye(r,t,"filter array must have at least 1 element")];switch(u=u.concat(nn({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ot(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ot(t[1])==="$type"&&u.push(new ye(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&u.push(new ye(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=dt(t[1]),l!=="string"&&u.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=dt(t[p]),Ot(t[1])==="$type"?u=u.concat(nn({key:`${r}[${p}]`,value:t[p],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new ye(`${r}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)u=u.concat(Ms({key:`${r}[${p}]`,value:t[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=dt(t[1]),t.length!==2?u.push(new ye(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`))}return u}function jl(i,t){let r=i.key,a=i.validateSpec,l=i.style,u=i.styleSpec,p=i.value,m=i.objectKey,g=u[`${t}_${i.layerType}`];if(!g)return[];let b=m.match(/^(.*)-transition$/);if(t==="paint"&&b&&g[b[1]]&&g[b[1]].transition)return a({key:r,value:p,valueSpec:u.transition,style:l,styleSpec:u});let w=i.valueSpec||g[m];if(!w)return[new ye(r,p,`unknown property "${m}"`)];let S;if(dt(p)==="string"&&Ma(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(p)))return[new ye(r,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];let T=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&T.push(new ye(r,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&ys(xr(p))&&Ot(p.type)==="identity"&&T.push(new ye(r,p,'"text-font" does not support identity functions'))),T.concat(a({key:i.key,value:p,valueSpec:w,style:l,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Is(i){return jl(i,"paint")}function ql(i){return jl(i,"layout")}function Ul(i){let t=[],r=i.value,a=i.key,l=i.style,u=i.styleSpec;r.type||r.ref||t.push(new ye(a,r,'either "type" or "ref" is required'));let p=Ot(r.type),m=Ot(r.ref);if(r.id){let g=Ot(r.id);for(let b=0;b<i.arrayIndex;b++){let w=l.layers[b];Ot(w.id)===g&&t.push(new ye(a,r.id,`duplicate layer id "${r.id}", previously used at line ${w.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&t.push(new ye(a,r[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{Ot(b.id)===m&&(g=b)}),g?g.ref?t.push(new ye(a,r.ref,"ref cannot reference another ref layer")):p=Ot(g.type):t.push(new ye(a,r.ref,`ref layer "${m}" not found`))}else if(p!=="background")if(r.source){let g=l.sources&&l.sources[r.source],b=g&&Ot(g.type);g?b==="vector"&&p==="raster"?t.push(new ye(a,r.source,`layer "${r.id}" requires a raster source`)):b!=="raster-dem"&&p==="hillshade"?t.push(new ye(a,r.source,`layer "${r.id}" requires a raster-dem source`)):b==="raster"&&p!=="raster"?t.push(new ye(a,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&p!=="hillshade"?t.push(new ye(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||b==="geojson"&&g.lineMetrics||t.push(new ye(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ye(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ye(a,r.source,`source "${r.source}" not found`))}else t.push(new ye(a,r,'missing required property "source"'));return t=t.concat(Xi({key:a,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Nl,layout:g=>Xi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":b=>ql(Fr({layerType:p},b))}}),paint:g=>Xi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":b=>Is(Fr({layerType:p},b))}})}})),t}function Kn(i){let t=i.value,r=i.key,a=dt(t);return a!=="string"?[new ye(r,t,`string expected, ${a} found`)]:[]}let Ts={promoteId:function({key:i,value:t}){if(dt(t)==="string")return Kn({key:i,value:t});{let r=[];for(let a in t)r.push(...Kn({key:`${i}.${a}`,value:t[a]}));return r}}};function Eo(i){let t=i.value,r=i.key,a=i.styleSpec,l=i.style,u=i.validateSpec;if(!t.type)return[new ye(r,t,'"type" is required')];let p=Ot(t.type),m;switch(p){case"vector":case"raster":return m=Xi({key:r,value:t,valueSpec:a[`source_${p.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Ts,validateSpec:u}),m;case"raster-dem":return m=function(g){var b;let w=(b=g.sourceName)!==null&&b!==void 0?b:"",S=g.value,T=g.styleSpec,P=T.source_raster_dem,L=g.style,R=[],N=dt(S);if(S===void 0)return R;if(N!=="object")return R.push(new ye("source_raster_dem",S,`object expected, ${N} found`)),R;let $=Ot(S.encoding)==="custom",ie=["redFactor","greenFactor","blueFactor","baseShift"],X=g.value.encoding?`"${g.value.encoding}"`:"Default";for(let ee in S)!$&&ie.includes(ee)?R.push(new ye(ee,S[ee],`In "${w}": "${ee}" is only valid when "encoding" is set to "custom". ${X} encoding found`)):P[ee]?R=R.concat(g.validateSpec({key:ee,value:S[ee],valueSpec:P[ee],validateSpec:g.validateSpec,style:L,styleSpec:T})):R.push(new ye(ee,S[ee],`unknown property "${ee}"`));return R}({sourceName:r,value:t,style:i.style,styleSpec:a,validateSpec:u}),m;case"geojson":if(m=Xi({key:r,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:u,objectElementValidators:Ts}),t.cluster)for(let g in t.clusterProperties){let[b,w]=t.clusterProperties[g],S=typeof b=="string"?[b,["accumulated"],["get",g]]:b;m.push(...Da({key:`${r}.${g}.map`,value:w,validateSpec:u,expressionContext:"cluster-map"})),m.push(...Da({key:`${r}.${g}.reduce`,value:S,validateSpec:u,expressionContext:"cluster-reduce"}))}return m;case"video":return Xi({key:r,value:t,valueSpec:a.source_video,style:l,validateSpec:u,styleSpec:a});case"image":return Xi({key:r,value:t,valueSpec:a.source_image,style:l,validateSpec:u,styleSpec:a});case"canvas":return[new ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:u,styleSpec:a})}}function $l(i){let t=i.value,r=i.styleSpec,a=r.light,l=i.style,u=[],p=dt(t);if(t===void 0)return u;if(p!=="object")return u=u.concat([new ye("light",t,`object expected, ${p} found`)]),u;for(let m in t){let g=m.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?i.validateSpec({key:m,value:t[m],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)])}return u}function Zl(i){let t=i.value,r=i.styleSpec,a=r.sky,l=i.style,u=dt(t);if(t===void 0)return[];if(u!=="object")return[new ye("sky",t,`object expected, ${u} found`)];let p=[];for(let m in t)p=p.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return p}function Gl(i){let t=i.value,r=i.styleSpec,a=r.terrain,l=i.style,u=[],p=dt(t);if(t===void 0)return u;if(p!=="object")return u=u.concat([new ye("terrain",t,`object expected, ${p} found`)]),u;for(let m in t)u=u.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return u}function Hl(i){let t=[],r=i.value,a=i.key;if(Array.isArray(r)){let l=[],u=[];for(let p in r)r[p].id&&l.includes(r[p].id)&&t.push(new ye(a,r,`all the sprites' ids must be unique, but ${r[p].id} is duplicated`)),l.push(r[p].id),r[p].url&&u.includes(r[p].url)&&t.push(new ye(a,r,`all the sprites' URLs must be unique, but ${r[p].url} is duplicated`)),u.push(r[p].url),t=t.concat(Xi({key:`${a}[${p}]`,value:r[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Kn({key:a,value:r})}let Es={"*":()=>[],array:To,boolean:function(i){let t=i.value,r=i.key,a=dt(t);return a!=="boolean"?[new ye(r,t,`boolean expected, ${a} found`)]:[]},number:Vl,color:function(i){let t=i.key,r=i.value,a=dt(r);return a!=="string"?[new ye(t,r,`color expected, ${a} found`)]:_t.parse(String(r))?[]:[new ye(t,r,`color expected, "${r}" found`)]},constants:oh,enum:nn,filter:Nl,function:Ss,layer:Ul,object:Xi,source:Eo,light:$l,sky:Zl,terrain:Gl,projection:function(i){let t=i.value,r=i.styleSpec,a=r.projection,l=i.style,u=dt(t);if(t===void 0)return[];if(u!=="object")return[new ye("projection",t,`object expected, ${u} found`)];let p=[];for(let m in t)p=p.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new ye(m,t[m],`unknown property "${m}"`)]);return p},string:Kn,formatted:function(i){return Kn(i).length===0?[]:Da(i)},resolvedImage:function(i){return Kn(i).length===0?[]:Da(i)},padding:function(i){let t=i.key,r=i.value;if(dt(r)==="array"){if(r.length<1||r.length>4)return[new ye(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let a={type:"number"},l=[];for(let u=0;u<r.length;u++)l=l.concat(i.validateSpec({key:`${t}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:a}));return l}return Vl({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){let t=i.key,r=i.value,a=dt(r),l=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new ye(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let u=[];for(let p=0;p<r.length;p+=2)u=u.concat(nn({key:`${t}[${p}]`,value:r[p],valueSpec:l.layout_symbol["text-anchor"]})),u=u.concat(To({key:`${t}[${p+1}]`,value:r[p+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return u},sprite:Hl};function za(i){let t=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=za,r.expression&&ys(Ot(t))?Ss(i):r.expression&&bs(xr(t))?Da(i):r.type&&Es[r.type]?Es[r.type](i):Xi(Fr({},i,{valueSpec:r.type?a[r.type]:r}))}function sh(i){let t=i.value,r=i.key,a=Kn(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new ye(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new ye(r,t,'"glyphs" url must include a "{range}" token'))),a}function or(i,t=ae){let r=[];return r=r.concat(za({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:za,objectElementValidators:{glyphs:sh,"*":()=>[]}})),i.constants&&(r=r.concat(oh({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:za}))),Wl(r)}function jr(i){return function(t){return i(Tn(Kt({},t),{validateSpec:za}))}}function Wl(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function br(i){return function(...t){return Wl(i.apply(this,t))}}or.source=br(jr(Eo)),or.sprite=br(jr(Hl)),or.glyphs=br(jr(sh)),or.light=br(jr($l)),or.sky=br(jr(Zl)),or.terrain=br(jr(Gl)),or.layer=br(jr(Ul)),or.filter=br(jr(Nl)),or.paintProperty=br(jr(Is)),or.layoutProperty=br(jr(ql));let Yn=or,Rd=Yn.light,Fd=Yn.sky,lh=Yn.paintProperty,ch=Yn.layoutProperty;function Xl(i,t){let r=!1;if(t&&t.length)for(let a of t)i.fire(new gn(new Error(a.message))),r=!0;return r}class La{constructor(t,r,a){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(r=p[1])+2*(a=p[2]);for(let g=0;g<this.d*this.d;g++){let b=p[3+g],w=p[3+g+1];l.push(b===w?null:p.subarray(b,w))}let m=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],m),this.bboxes=p.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;let u=a/r*t;this.min=-u,this.max=t+u}insert(t,r,a,l,u){this._forEachCell(r,a,l,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,l,u,p){this.cells[u].push(p)}query(t,r,a,l,u){let p=this.min,m=this.max;if(t<=p&&r<=p&&m<=a&&m<=l&&!u)return Array.prototype.slice.call(this.keys);{let g=[];return this._forEachCell(t,r,a,l,this._queryCell,g,{},u),g}}_queryCell(t,r,a,l,u,p,m,g){let b=this.cells[u];if(b!==null){let w=this.keys,S=this.bboxes;for(let T=0;T<b.length;T++){let P=b[T];if(m[P]===void 0){let L=4*P;(g?g(S[L+0],S[L+1],S[L+2],S[L+3]):t<=S[L+2]&&r<=S[L+3]&&a>=S[L+0]&&l>=S[L+1])?(m[P]=!0,p.push(w[P])):m[P]=!1}}}}_forEachCell(t,r,a,l,u,p,m,g){let b=this._convertToCellCoord(t),w=this._convertToCellCoord(r),S=this._convertToCellCoord(a),T=this._convertToCellCoord(l);for(let P=b;P<=S;P++)for(let L=w;L<=T;L++){let R=this.d*L+P;if((!g||g(this._convertFromCellCoord(P),this._convertFromCellCoord(L),this._convertFromCellCoord(P+1),this._convertFromCellCoord(L+1)))&&u.call(this,t,r,a,l,R,p,m,g))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,a=0;for(let p=0;p<this.cells.length;p++)a+=this.cells[p].length;let l=new Int32Array(r+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let u=r;for(let p=0;p<t.length;p++){let m=t[p];l[3+p]=u,l.set(m,u),u+=m.length}return l[3+t.length]=u,l.set(this.keys,u),u+=this.keys.length,l[3+t.length+1]=u,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer}static serialize(t,r){let a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new La(t.buffer)}}let sr={};function De(i,t,r={}){if(sr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),sr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}De("Object",Object),De("TransferableGridIndex",La),De("Color",_t),De("Error",Error),De("AJAXError",Zi),De("ResolvedImage",Wi),De("StylePropertyFunction",Pa),De("StyleExpression",xs,{omit:["_evaluator"]}),De("ZoomDependentExpression",Aa),De("ZoomConstantExpression",Ea),De("CompoundExpression",ar,{omit:["_evaluate"]});for(let i in ka)ka[i]._classRegistryKey||De(`Expression_${i}`,ka[i]);function As(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Kl(i){return i.$name||i.constructor._classRegistryKey}function hh(i){return!function(t){if(t===null||typeof t!="object")return!1;let r=Kl(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||As(i)||Lr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ra(i,t){if(hh(i))return(As(i)||Lr(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let u=[];for(let p of i)u.push(Ra(p,t));return u}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);let r=Kl(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!sr[r])throw new Error(`${r} is not registered.`);let{klass:a}=sr[r],l=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let u in i){if(!i.hasOwnProperty(u)||sr[r].omit.indexOf(u)>=0)continue;let p=i[u];l[u]=sr[r].shallow.indexOf(u)>=0?p:Ra(p,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function Fa(i){if(hh(i))return i;if(Array.isArray(i))return i.map(Fa);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);let t=Kl(i)||"Object";if(!sr[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=sr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);let a=Object.create(r.prototype);for(let l of Object.keys(i)){if(l==="$name")continue;let u=i[l];a[l]=sr[t].shallow.indexOf(l)>=0?u:Fa(u)}return a}class Yl{constructor(){this.first=!0}update(t,r){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let st={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Jl(i){for(let t of i)if(ec(t.charCodeAt(0)))return!0;return!1}function Bd(i){for(let t of i)if(!Ba(t.charCodeAt(0)))return!1;return!0}function Ql(i){let t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}let Od=Ql(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ba(i){return!Od.test(String.fromCodePoint(i))}let dh=Ql(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ec(i){return!(i!==746&&i!==747&&(i<4352||!(st["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||st["CJK Compatibility"](i)||st["CJK Strokes"](i)||!(!st["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||st["Enclosed CJK Letters and Months"](i)||st["Ideographic Description Characters"](i)||st.Kanbun(i)||st.Katakana(i)&&i!==12540||!(!st["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!st["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||st["Vertical Forms"](i)||st["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||dh.test(String.fromCodePoint(i)))))}function uh(i){return!(ec(i)||function(t){return!!(st["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||st["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||st["Letterlike Symbols"](t)||st["Number Forms"](t)||st["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||st["Control Pictures"](t)&&t!==9251||st["Optical Character Recognition"](t)||st["Enclosed Alphanumerics"](t)||st["Geometric Shapes"](t)||st["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||st["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||st["CJK Symbols and Punctuation"](t)||st.Katakana(t)||st["Private Use Area"](t)||st["CJK Compatibility Forms"](t)||st["Small Form Variants"](t)||st["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}let Vd=Ql(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function tc(i){return Vd.test(String.fromCodePoint(i))}function Nd(i,t){return!(!t&&tc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||st.Khmer(i))}function jd(i){for(let t of i)if(tc(t.charCodeAt(0)))return!0;return!1}let Ki=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class It{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yl,this.transition={})}isSupportedScript(t){return function(r,a){for(let l of r)if(!Nd(l.charCodeAt(0),a))return!1;return!0}(t,Ki.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Oa{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,l){if(ys(a))return new Pa(a,l);if(bs(a)){let u=Fl(a,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=a;return l.type==="color"&&typeof a=="string"?u=_t.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(u=nr.parse(a)):u=Hi.parse(a),{kind:"constant",evaluate:()=>u}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class Ps{constructor(t){this.property=t,this.value=new Oa(t,void 0)}transitioned(t,r){return new ph(this.property,this.value,r,ir({},t.transition,this.transition),t.now)}untransitioned(){return new ph(this.property,this.value,null,{},0)}}class Ds{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return yt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ps(this._values[t].property)),this._values[t].value=new Oa(this._values[t].property,r===null?void 0:yt(r))}getTransition(t){return yt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ps(this._values[t].property)),this._values[t].transition=yt(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a);let l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){let a=new Ao(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,r._values[l]);return a}untransitioned(){let t=new Ao(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class ph{constructor(t,r,a,l,u){this.property=t,this.value=r,this.begin=u+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){let l=t.now||0,u=this.value.possiblyEvaluate(t,r,a),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(t,r,a);{let m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,r,a),u,function(g){if(g<=0)return 0;if(g>=1)return 1;let b=g*g,w=b*g;return 4*(g<.5?w:3*(g-b)+w-.75)}(m))}}return u}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){let l=new Do(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Po{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return yt(this._values[t].value)}setValue(t,r){this._values[t]=new Oa(this._values[t].property,r===null?void 0:yt(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){let l=new Do(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}}class qr{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,l){return this.property.evaluate(this.value,this.parameters,t,r,a,l)}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Le{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){let l=Di[this.specification.type];return l?l(t,r,a):t}}class Ue{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,l){return new qr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,l)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new qr(this,{kind:"constant",value:void 0},t.parameters);let l=Di[this.specification.type];if(l){let u=l(t.value.value,r.value.value,a);return new qr(this,{kind:"constant",value:u},t.parameters)}return t}evaluate(t,r,a,l,u,p){return t.kind==="constant"?t.value:t.evaluate(r,a,l,u,p)}}class zs extends Ue{possiblyEvaluate(t,r,a,l){if(t.value===void 0)return new qr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l),p=t.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,m=this._calculate(p,p,p,r);return new qr(this,{kind:"constant",value:m},r)}if(t.expression.kind==="camera"){let u=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new qr(this,{kind:"constant",value:u},r)}return new qr(this,t.expression,r)}evaluate(t,r,a,l,u,p){if(t.kind==="source"){let m=t.evaluate(r,a,l,u,p);return this._calculate(m,m,m,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,l),t.evaluate({zoom:Math.floor(r.zoom)},a,l),t.evaluate({zoom:Math.floor(r.zoom)+1},a,l),r):t.value}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class Ls{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l);return this._calculate(u,u,u,r)}return this._calculate(t.expression.evaluate(new It(Math.floor(r.zoom-1),r)),t.expression.evaluate(new It(Math.floor(r.zoom),r)),t.expression.evaluate(new It(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class ic{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){return!!t.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class d{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let a=t[r];a.specification.overridable&&this.overridableProperties.push(r);let l=this.defaultPropertyValues[r]=new Oa(a,void 0),u=this.defaultTransitionablePropertyValues[r]=new Ps(a);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}De("DataDrivenProperty",Ue),De("DataConstantProperty",Le),De("CrossFadedDataDrivenProperty",zs),De("CrossFadedProperty",Ls),De("ColorRampProperty",ic);let e="-transition";class n extends fa{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Po(r.layout)),r.paint)){this._transitionablePaint=new Ds(r.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(ch,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(lh,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let l=this._transitionablePaint._values[t],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let g=this._transitionablePaint._values[t].value;return g.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(t,m,g)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),lo(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,l,u={}){return(!u||u.validate!==!1)&&Xl(this,t.call(Yn,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof qr&&Ma(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class s{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function f(i,t=1){let r=0,a=0;return{members:i.map(l=>{let u=o[l.type].BYTES_PER_ELEMENT,p=r=_(r,Math.max(t,u)),m=l.components||1;return a=Math.max(a,u),r+=u*m,{name:l.name,type:l.type,components:m,offset:p}}),size:_(r,Math.max(a,t)),alignment:t}}function _(i,t){return Math.ceil(i/t)*t}class x extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.int16[l+0]=r,this.int16[l+1]=a,t}}x.prototype.bytesPerElement=4,De("StructArrayLayout2i4",x);class k extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.int16[u+0]=r,this.int16[u+1]=a,this.int16[u+2]=l,t}}k.prototype.bytesPerElement=6,De("StructArrayLayout3i6",k);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let p=4*t;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=l,this.int16[p+3]=u,t}}M.prototype.bytesPerElement=8,De("StructArrayLayout4i8",M);class I extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=m,t}}I.prototype.bytesPerElement=12,De("StructArrayLayout2i4i12",I);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=4*t,b=8*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.uint8[b+4]=l,this.uint8[b+5]=u,this.uint8[b+6]=p,this.uint8[b+7]=m,t}}z.prototype.bytesPerElement=8,De("StructArrayLayout2i4ub8",z);class F extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.float32[l+0]=r,this.float32[l+1]=a,t}}F.prototype.bytesPerElement=8,De("StructArrayLayout2f8",F);class O extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,b,w){let S=this.length;return this.resize(S+1),this.emplace(S,t,r,a,l,u,p,m,g,b,w)}emplace(t,r,a,l,u,p,m,g,b,w,S){let T=10*t;return this.uint16[T+0]=r,this.uint16[T+1]=a,this.uint16[T+2]=l,this.uint16[T+3]=u,this.uint16[T+4]=p,this.uint16[T+5]=m,this.uint16[T+6]=g,this.uint16[T+7]=b,this.uint16[T+8]=w,this.uint16[T+9]=S,t}}O.prototype.bytesPerElement=20,De("StructArrayLayout10ui20",O);class q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,b,w,S,T){let P=this.length;return this.resize(P+1),this.emplace(P,t,r,a,l,u,p,m,g,b,w,S,T)}emplace(t,r,a,l,u,p,m,g,b,w,S,T,P){let L=12*t;return this.int16[L+0]=r,this.int16[L+1]=a,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=p,this.uint16[L+5]=m,this.uint16[L+6]=g,this.uint16[L+7]=b,this.int16[L+8]=w,this.int16[L+9]=S,this.int16[L+10]=T,this.int16[L+11]=P,t}}q.prototype.bytesPerElement=24,De("StructArrayLayout4i4ui4i24",q);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.float32[u+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}Z.prototype.bytesPerElement=12,De("StructArrayLayout3f12",Z);class G extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}G.prototype.bytesPerElement=4,De("StructArrayLayout1ul4",G);class W extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,b){let w=this.length;return this.resize(w+1),this.emplace(w,t,r,a,l,u,p,m,g,b)}emplace(t,r,a,l,u,p,m,g,b,w){let S=10*t,T=5*t;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=l,this.int16[S+3]=u,this.int16[S+4]=p,this.int16[S+5]=m,this.uint32[T+3]=g,this.uint16[S+8]=b,this.uint16[S+9]=w,t}}W.prototype.bytesPerElement=20,De("StructArrayLayout6i1ul2ui20",W);class V extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=p,this.int16[g+5]=m,t}}V.prototype.bytesPerElement=12,De("StructArrayLayout2i2i2i12",V);class Y extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){let p=this.length;return this.resize(p+1),this.emplace(p,t,r,a,l,u)}emplace(t,r,a,l,u,p){let m=4*t,g=8*t;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=l,this.int16[g+6]=u,this.int16[g+7]=p,t}}Y.prototype.bytesPerElement=16,De("StructArrayLayout2f1f2i16",Y);class Q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,p)}emplace(t,r,a,l,u,p,m){let g=16*t,b=4*t,w=8*t;return this.uint8[g+0]=r,this.uint8[g+1]=a,this.float32[b+1]=l,this.float32[b+2]=u,this.int16[w+6]=p,this.int16[w+7]=m,t}}Q.prototype.bytesPerElement=16,De("StructArrayLayout2ub2f2i16",Q);class re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=a,this.uint16[u+2]=l,t}}re.prototype.bytesPerElement=6,De("StructArrayLayout3ui6",re);class ue extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$){let ie=this.length;return this.resize(ie+1),this.emplace(ie,t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$)}emplace(t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$,ie){let X=24*t,ee=12*t,oe=48*t;return this.int16[X+0]=r,this.int16[X+1]=a,this.uint16[X+2]=l,this.uint16[X+3]=u,this.uint32[ee+2]=p,this.uint32[ee+3]=m,this.uint32[ee+4]=g,this.uint16[X+10]=b,this.uint16[X+11]=w,this.uint16[X+12]=S,this.float32[ee+7]=T,this.float32[ee+8]=P,this.uint8[oe+36]=L,this.uint8[oe+37]=R,this.uint8[oe+38]=N,this.uint32[ee+10]=$,this.int16[X+22]=ie,t}}ue.prototype.bytesPerElement=48,De("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ue);class _e extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$,ie,X,ee,oe,fe,Te,qe,Me,Ce,Be,ze){let Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$,ie,X,ee,oe,fe,Te,qe,Me,Ce,Be,ze)}emplace(t,r,a,l,u,p,m,g,b,w,S,T,P,L,R,N,$,ie,X,ee,oe,fe,Te,qe,Me,Ce,Be,ze,Ae){let de=32*t,Oe=16*t;return this.int16[de+0]=r,this.int16[de+1]=a,this.int16[de+2]=l,this.int16[de+3]=u,this.int16[de+4]=p,this.int16[de+5]=m,this.int16[de+6]=g,this.int16[de+7]=b,this.uint16[de+8]=w,this.uint16[de+9]=S,this.uint16[de+10]=T,this.uint16[de+11]=P,this.uint16[de+12]=L,this.uint16[de+13]=R,this.uint16[de+14]=N,this.uint16[de+15]=$,this.uint16[de+16]=ie,this.uint16[de+17]=X,this.uint16[de+18]=ee,this.uint16[de+19]=oe,this.uint16[de+20]=fe,this.uint16[de+21]=Te,this.uint16[de+22]=qe,this.uint32[Oe+12]=Me,this.float32[Oe+13]=Ce,this.float32[Oe+14]=Be,this.uint16[de+30]=ze,this.uint16[de+31]=Ae,t}}_e.prototype.bytesPerElement=64,De("StructArrayLayout8i15ui1ul2f2ui64",_e);class Se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Se.prototype.bytesPerElement=4,De("StructArrayLayout1f4",Se);class Ee extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[6*t+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}Ee.prototype.bytesPerElement=12,De("StructArrayLayout1ui2f12",Ee);class be extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=4*t;return this.uint32[2*t+0]=r,this.uint16[u+2]=a,this.uint16[u+3]=l,t}}be.prototype.bytesPerElement=8,De("StructArrayLayout1ul2ui8",be);class xe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=a,t}}xe.prototype.bytesPerElement=4,De("StructArrayLayout2ui4",xe);class Re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Re.prototype.bytesPerElement=2,De("StructArrayLayout1ui2",Re);class We extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let p=4*t;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=l,this.float32[p+3]=u,t}}We.prototype.bytesPerElement=16,De("StructArrayLayout4f16",We);class ke extends s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}ke.prototype.size=20;class Ie extends W{get(t){return new ke(this,t)}}De("CollisionBoxArray",Ie);class Ge extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ge.prototype.size=48;class Tt extends ue{get(t){return new Ge(this,t)}}De("PlacedSymbolArray",Tt);class Qe extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Qe.prototype.size=64;class ot extends _e{get(t){return new Qe(this,t)}}De("SymbolInstanceArray",ot);class Et extends Se{getoffsetX(t){return this.float32[1*t+0]}}De("GlyphOffsetArray",Et);class hi extends k{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}De("SymbolLineVertexArray",hi);class wr extends s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}wr.prototype.size=12;class At extends Ee{get(t){return new wr(this,t)}}De("TextAnchorOffsetArray",At);class Li extends s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Li.prototype.size=8;class wi extends be{get(t){return new Li(this,t)}}De("FeatureIndexArray",wi);class di extends x{}class ki extends x{}class Ur extends x{}class Va extends I{}class Rs extends z{}class Na extends F{}class lr extends O{}class Fs extends q{}class rc extends Z{}class cr extends G{}class hr extends V{}class wn extends Q{}class kr extends re{}class ai extends xe{}let ui=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yi}=ui;class lt{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,l){let u=this.segments[this.segments.length-1];return t>lt.MAX_VERTEX_ARRAY_LENGTH&&li(`Max vertices per segment is ${lt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>lt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,l){return new lt([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function Jn(i,t){return 256*(i=pr(Math.floor(i),0,255))+pr(Math.floor(t),0,255)}lt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,De("SegmentVector",lt);let ja=f([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var qa={exports:{}},mh={exports:{}};mh.exports=function(i,t){var r,a,l,u,p,m,g,b;for(a=i.length-(r=3&i.length),l=t,p=3432918353,m=461845907,b=0;b<a;)g=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24,++b,l=27492+(65535&(u=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(b+2))<<16;case 2:g^=(255&i.charCodeAt(b+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(b)))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var qd=mh.exports,fh={exports:{}};fh.exports=function(i,t){for(var r,a=i.length,l=t^a,u=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:l^=(255&i.charCodeAt(u+2))<<16;case 2:l^=(255&i.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var kn=qd,gh=fh.exports;qa.exports=kn,qa.exports.murmur3=kn,qa.exports.murmur2=gh;var Bs=ce(qa.exports);class zo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,l){this.ids.push(Os(t)),this.positions.push(r,a,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Os(t),a=0,l=this.ids.length-1;for(;a<l;){let p=a+l>>1;this.ids[p]>=r?l=p:a=p+1}let u=[];for(;this.ids[a]===r;)u.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return u}static serialize(t,r){let a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Vs(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(t){let r=new zo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Os(i){let t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Bs(String(i))}function Vs(i,t,r,a){for(;r<a;){let l=i[r+a>>1],u=r-1,p=a+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;Ua(i,u,p),Ua(t,3*u,3*p),Ua(t,3*u+1,3*p+1),Ua(t,3*u+2,3*p+2)}p-r<a-p?(Vs(i,t,r,p),r=p+1):(Vs(i,t,p+1,a),a=p)}}function Ua(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}De("FeaturePositionMap",zo);class Lo{constructor(t,r){this.gl=t.gl,this.location=r}}class _h extends Lo{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class pp extends Lo{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class mp extends Lo{constructor(t,r){super(t,r),this.current=_t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let pg=new Float32Array(16);function Ud(i){return[Jn(255*i.r,255*i.g),Jn(255*i.b,255*i.a)]}class nc{constructor(t,r,a){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new mp(t,r):new _h(t,r)}}class Ns{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,l){let u=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&t.set(u)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new pp(t,r):new _h(t,r)}}class Qn{constructor(t,r,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,a,l,u){let p=this.paintVertexArray.length,m=this.expression.evaluate(new It(0),r,{},l,[],u);this.paintVertexArray.resize(t),this._setPaintValue(p,t,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:0},a,l);this._setPaintValue(t,r,u)}_setPaintValue(t,r,a){if(this.type==="color"){let l=Ud(a);for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class an{constructor(t,r,a,l,u,p){this.expression=t,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,a,l,u){let p=this.expression.evaluate(new It(this.zoom),r,{},l,[],u),m=this.expression.evaluate(new It(this.zoom+1),r,{},l,[],u),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,p,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:this.zoom},a,l),p=this.expression.evaluate({zoom:this.zoom+1},a,l);this._setPaintValue(t,r,u,p)}_setPaintValue(t,r,a,l){if(this.type==="color"){let u=Ud(a),p=Ud(l);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1],p[0],p[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=pr(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,a){return new _h(t,r)}}class $a{constructor(t,r,a,l,u,p){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(t,r,a){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,l,u){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],u)}_setPaintValues(t,r,a,l){if(!l||!a)return;let{min:u,mid:p,max:m}=a,g=l[u],b=l[p],w=l[m];if(g&&b&&w)for(let S=t;S<r;S++)this.zoomInPaintVertexArray.emplace(S,b.tl[0],b.tl[1],b.br[0],b.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],b.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(S,b.tl[0],b.tl[1],b.br[0],b.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],b.pixelRatio,w.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ja.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ja.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fp{constructor(t,r,a){this.binders={},this._buffers=[];let l=[];for(let u in t.paint._values){if(!a(u))continue;let p=t.paint.get(u);if(!(p instanceof qr&&Ma(p.property.specification)))continue;let m=mg(u,t.type),g=p.value,b=p.property.specification.type,w=p.property.useIntegerZoom,S=p.property.specification["property-type"],T=S==="cross-faded"||S==="cross-faded-data-driven";if(g.kind==="constant")this.binders[u]=T?new Ns(g.value,m):new nc(g.value,m,b),l.push(`/u_${u}`);else if(g.kind==="source"||T){let P=gp(u,b,"source");this.binders[u]=T?new $a(g,b,w,r,P,t.id):new Qn(g,m,b,P),l.push(`/a_${u}`)}else{let P=gp(u,b,"composite");this.binders[u]=new an(g,m,b,w,r,P),l.push(`/z_${u}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof Qn||r instanceof an?r.maxValue:0}populatePaintArrays(t,r,a,l,u){for(let p in this.binders){let m=this.binders[p];(m instanceof Qn||m instanceof an||m instanceof $a)&&m.populatePaintArray(t,r,a,l,u)}}setConstantPatternPositions(t,r){for(let a in this.binders){let l=this.binders[a];l instanceof Ns&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,l,u){let p=!1;for(let m in t){let g=r.getPositions(m);for(let b of g){let w=a.feature(b.index);for(let S in this.binders){let T=this.binders[S];if((T instanceof Qn||T instanceof an||T instanceof $a)&&T.expression.isStateDependent===!0){let P=l.paint.get(S);T.expression=P.value,T.updatePaintArray(b.start,b.end,w,t[m],u),p=!0}}}}return p}defines(){let t=[];for(let r in this.binders){let a=this.binders[r];(a instanceof nc||a instanceof Ns)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Qn||a instanceof an)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name);else if(a instanceof $a)for(let l=0;l<ja.members.length;l++)t.push(ja.members[l].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof nc||a instanceof Ns||a instanceof an)for(let l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let a=[];for(let l in this.binders){let u=this.binders[l];if(u instanceof nc||u instanceof Ns||u instanceof an){for(let p of u.uniformNames)if(r[p]){let m=u.getBinding(t,r[p],p);a.push({name:p,property:l,binding:m})}}}return a}setUniforms(t,r,a,l){for(let{name:u,property:p,binding:m}of r)this.binders[p].setUniform(m,l,a.get(p),u)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let a=this.binders[r];if(t&&a instanceof $a){let l=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof Qn||a instanceof an)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let r in this.binders){let a=this.binders[r];(a instanceof Qn||a instanceof an||a instanceof $a)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof Qn||r instanceof an||r instanceof $a)&&r.destroy()}}}class Ro{constructor(t,r,a=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new fp(l,r,a);this.needsUpload=!1,this._featureMap=new zo,this._bufferOffset=0}populatePaintArrays(t,r,a,l,u,p){for(let m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,u,p);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,l){for(let u of a)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(t,this._featureMap,r,u,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function mg(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function gp(i,t,r){let a={color:{source:F,composite:We},number:{source:Se,composite:F}},l=function(u){return{"line-pattern":{source:lr,composite:lr},"fill-pattern":{source:lr,composite:lr},"fill-extrusion-pattern":{source:lr,composite:lr}}[u]}(i);return l&&l[r]||a[t][r]}De("ConstantBinder",nc),De("CrossFadedConstantBinder",Ns),De("SourceExpressionBinder",Qn),De("CrossFadedCompositeBinder",$a),De("CompositeExpressionBinder",an),De("ProgramConfiguration",fp,{omit:["_buffers"]}),De("ProgramConfigurationSet",Ro);let Xt=8192,$d=Math.pow(2,14)-1,_p=-$d-1;function Fo(i){let t=Xt/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){let l=r[a];for(let u=0;u<l.length;u++){let p=l[u],m=Math.round(p.x*t),g=Math.round(p.y*t);p.x=pr(m,_p,$d),p.y=pr(g,_p,$d),(m<p.x||m>p.x+1||g<p.y||g>p.y+1)&&li("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Bo(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Fo(i):[]}}function yh(i,t,r,a,l){i.emplaceBack(2*t+(a+1)/2,2*r+(l+1)/2)}class Zd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new kr,this.segments=new lt,this.programConfigurations=new Ro(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){let l=this.layers[0],u=[],p=null,m=!1;l.type==="circle"&&(p=l.layout.get("circle-sort-key"),m=!p.isConstant());for(let{feature:g,id:b,index:w,sourceLayerIndex:S}of t){let T=this.layers[0]._featureFilter.needGeometry,P=Bo(g,T);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),P,a))continue;let L=m?p.evaluate(P,{},a):void 0,R={id:b,properties:g.properties,type:g.type,sourceLayerIndex:S,index:w,geometry:T?P.geometry:Fo(g),patterns:{},sortKey:L};u.push(R)}m&&u.sort((g,b)=>g.sortKey-b.sortKey);for(let g of u){let{geometry:b,index:w,sourceLayerIndex:S}=g,T=t[w].feature;this.addFeature(g,b,w,a),r.featureIndex.insert(T,b,w,S,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,l){for(let u of r)for(let p of u){let m=p.x,g=p.y;if(m<0||m>=Xt||g<0||g>=Xt)continue;let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),w=b.vertexLength;yh(this.layoutVertexArray,m,g,-1,-1),yh(this.layoutVertexArray,m,g,1,-1),yh(this.layoutVertexArray,m,g,1,1),yh(this.layoutVertexArray,m,g,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),b.vertexLength+=4,b.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l)}}function yp(i,t){for(let r=0;r<i.length;r++)if(js(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(js(i,t[r]))return!0;return!!Gd(i,t)}function fg(i,t,r){return!!js(i,t)||!!Hd(t,i,r)}function vp(i,t){if(i.length===1)return bp(t,i[0]);for(let r=0;r<t.length;r++){let a=t[r];for(let l=0;l<a.length;l++)if(js(i,a[l]))return!0}for(let r=0;r<i.length;r++)if(bp(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Gd(i,t[r]))return!0;return!1}function gg(i,t,r){if(i.length>1){if(Gd(i,t))return!0;for(let a=0;a<t.length;a++)if(Hd(t[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Hd(i[a],t,r))return!0;return!1}function Gd(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){let a=i[r],l=i[r+1];for(let u=0;u<t.length-1;u++)if(_g(a,l,t[u],t[u+1]))return!0}return!1}function _g(i,t,r,a){return vi(i,r,a)!==vi(t,r,a)&&vi(i,t,r)!==vi(i,t,a)}function Hd(i,t,r){let a=r*r;if(t.length===1)return i.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(xp(i,t[l-1],t[l])<a)return!0;return!1}function xp(i,t,r){let a=t.distSqr(r);if(a===0)return i.distSqr(t);let l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/a;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function bp(i,t){let r,a,l,u=!1;for(let p=0;p<i.length;p++){r=i[p];for(let m=0,g=r.length-1;m<r.length;g=m++)a=r[m],l=r[g],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(u=!u)}return u}function js(i,t){let r=!1;for(let a=0,l=i.length-1;a<i.length;l=a++){let u=i[a],p=i[l];u.y>t.y!=p.y>t.y&&t.x<(p.x-u.x)*(t.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function yg(i,t,r){let a=r[0],l=r[2];if(i.x<a.x&&t.x<a.x||i.x>l.x&&t.x>l.x||i.y<a.y&&t.y<a.y||i.y>l.y&&t.y>l.y)return!1;let u=vi(i,t,r[0]);return u!==vi(i,t,r[1])||u!==vi(i,t,r[2])||u!==vi(i,t,r[3])}function ac(i,t,r){let a=t.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(i)}function vh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function xh(i,t,r,a,l){if(!t[0]&&!t[1])return i;let u=ge.convert(t)._mult(l);r==="viewport"&&u._rotate(-a);let p=[];for(let m=0;m<i.length;m++)p.push(i[m].sub(u));return p}let wp,kp;De("CircleBucket",Zd,{omit:["layers"]});var vg={get paint(){return kp=kp||new d({"circle-radius":new Ue(ae.paint_circle["circle-radius"]),"circle-color":new Ue(ae.paint_circle["circle-color"]),"circle-blur":new Ue(ae.paint_circle["circle-blur"]),"circle-opacity":new Ue(ae.paint_circle["circle-opacity"]),"circle-translate":new Le(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new Le(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Le(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Le(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(ae.paint_circle["circle-stroke-opacity"])})},get layout(){return wp=wp||new d({"circle-sort-key":new Ue(ae.layout_circle["circle-sort-key"])})}},Ri=1e-6,qs=typeof Float32Array<"u"?Float32Array:Array;function Wd(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Cp(i,t,r){var a=t[0],l=t[1],u=t[2],p=t[3],m=t[4],g=t[5],b=t[6],w=t[7],S=t[8],T=t[9],P=t[10],L=t[11],R=t[12],N=t[13],$=t[14],ie=t[15],X=r[0],ee=r[1],oe=r[2],fe=r[3];return i[0]=X*a+ee*m+oe*S+fe*R,i[1]=X*l+ee*g+oe*T+fe*N,i[2]=X*u+ee*b+oe*P+fe*$,i[3]=X*p+ee*w+oe*L+fe*ie,i[4]=(X=r[4])*a+(ee=r[5])*m+(oe=r[6])*S+(fe=r[7])*R,i[5]=X*l+ee*g+oe*T+fe*N,i[6]=X*u+ee*b+oe*P+fe*$,i[7]=X*p+ee*w+oe*L+fe*ie,i[8]=(X=r[8])*a+(ee=r[9])*m+(oe=r[10])*S+(fe=r[11])*R,i[9]=X*l+ee*g+oe*T+fe*N,i[10]=X*u+ee*b+oe*P+fe*$,i[11]=X*p+ee*w+oe*L+fe*ie,i[12]=(X=r[12])*a+(ee=r[13])*m+(oe=r[14])*S+(fe=r[15])*R,i[13]=X*l+ee*g+oe*T+fe*N,i[14]=X*u+ee*b+oe*P+fe*$,i[15]=X*p+ee*w+oe*L+fe*ie,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var oc,xg=Cp;function bh(i,t,r){var a=t[0],l=t[1],u=t[2],p=t[3];return i[0]=r[0]*a+r[4]*l+r[8]*u+r[12]*p,i[1]=r[1]*a+r[5]*l+r[9]*u+r[13]*p,i[2]=r[2]*a+r[6]*l+r[10]*u+r[14]*p,i[3]=r[3]*a+r[7]*l+r[11]*u+r[15]*p,i}oc=new qs(4),qs!=Float32Array&&(oc[0]=0,oc[1]=0,oc[2]=0,oc[3]=0);class bg extends n{constructor(t){super(t,vg)}createBucket(t){return new Zd(t)}queryRadius(t){let r=t;return ac("circle-radius",this,r)+ac("circle-stroke-width",this,r)+vh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m,g){let b=xh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,m),w=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),S=this.paint.get("circle-pitch-alignment")==="map",T=S?b:function(L,R){return L.map(N=>Sp(N,R))}(b,g),P=S?w*m:w;for(let L of l)for(let R of L){let N=S?R:Sp(R,g),$=P,ie=bh([],[R.x,R.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$*=ie[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($*=p.cameraToCenterDistance/ie[3]),fg(T,N,$))return!0}return!1}}function Sp(i,t){let r=bh([],[i.x,i.y,0,1],t);return new ge(r[0]/r[3],r[1]/r[3])}class Mp extends Zd{}let Ip;De("HeatmapBucket",Mp,{omit:["layers"]});var wg={get paint(){return Ip=Ip||new d({"heatmap-radius":new Ue(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Le(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ic(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Le(ae.paint_heatmap["heatmap-opacity"])})}};function Xd(i,{width:t,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*a}`)}else l=new Uint8Array(t*r*a);return i.width=t,i.height=r,i.data=l,i}function Tp(i,{width:t,height:r},a){if(t===i.width&&r===i.height)return;let l=Xd({},{width:t,height:r},a);Kd(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},a),i.width=t,i.height=r,i.data=l.data}function Kd(i,t,r,a,l,u){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let p=i.data,m=t.data;if(p===m)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){let b=((r.y+g)*i.width+r.x)*u,w=((a.y+g)*t.width+a.x)*u;for(let S=0;S<l.width*u;S++)m[w+S]=p[b+S]}return t}class sc{constructor(t,r){Xd(this,t,1,r)}resize(t){Tp(this,t,1)}clone(){return new sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){Kd(t,r,a,l,u,1)}}class Cr{constructor(t,r){Xd(this,t,4,r)}resize(t){Tp(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){Kd(t,r,a,l,u,4)}}function Ep(i){let t={},r=i.resolution||256,a=i.clips?i.clips.length:1,l=i.image||new Cr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let u=(p,m,g)=>{t[i.evaluationKey]=g;let b=i.expression.evaluate(t);l.data[p+m+0]=Math.floor(255*b.r/b.a),l.data[p+m+1]=Math.floor(255*b.g/b.a),l.data[p+m+2]=Math.floor(255*b.b/b.a),l.data[p+m+3]=Math.floor(255*b.a)};if(i.clips)for(let p=0,m=0;p<a;++p,m+=4*r)for(let g=0,b=0;g<r;g++,b+=4){let w=g/(r-1),{start:S,end:T}=i.clips[p];u(m,b,S*(1-w)+T*w)}else for(let p=0,m=0;p<r;p++,m+=4)u(0,m,p/(r-1));return l}De("AlphaImage",sc),De("RGBAImage",Cr);let Yd="big-fb";class kg extends n{createBucket(t){return new Mp(t)}constructor(t){super(t,wg),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Yd)&&this.heatmapFbos.delete(Yd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ap;var Cg={get paint(){return Ap=Ap||new d({"hillshade-illumination-direction":new Le(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Le(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Le(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Le(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Le(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Le(ae.paint_hillshade["hillshade-accent-color"])})}};class Sg extends n{constructor(t){super(t,Cg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Mg=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ig}=Mg;function Pp(i,t,r=2){let a=t&&t.length,l=a?t[0]*r:i.length,u=Dp(i,0,l,r,!0),p=[];if(!u||u.next===u.prev)return p;let m,g,b;if(a&&(u=function(w,S,T,P){let L=[];for(let R=0,N=S.length;R<N;R++){let $=Dp(w,S[R]*P,R<N-1?S[R+1]*P:w.length,P,!1);$===$.next&&($.steiner=!0),L.push(Rg($))}L.sort(Dg);for(let R=0;R<L.length;R++)T=zg(L[R],T);return T}(i,t,u,r)),i.length>80*r){m=1/0,g=1/0;let w=-1/0,S=-1/0;for(let T=r;T<l;T+=r){let P=i[T],L=i[T+1];P<m&&(m=P),L<g&&(g=L),P>w&&(w=P),L>S&&(S=L)}b=Math.max(w-m,S-g),b=b!==0?32767/b:0}return lc(u,p,r,m,g,b,0),p}function Dp(i,t,r,a,l){let u;if(l===function(p,m,g,b){let w=0;for(let S=m,T=g-b;S<g;S+=b)w+=(p[T]-p[S])*(p[S+1]+p[T+1]),T=S;return w}(i,t,r,a)>0)for(let p=t;p<r;p+=a)u=Rp(p/a|0,i[p],i[p+1],u);else for(let p=r-a;p>=t;p-=a)u=Rp(p/a|0,i[p],i[p+1],u);return u&&wh(u,u.next)&&(hc(u),u=u.next),u}function Oo(i,t){if(!i)return i;t||(t=i);let r,a=i;do if(r=!1,a.steiner||!wh(a,a.next)&&$t(a.prev,a,a.next)!==0)a=a.next;else{if(hc(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function lc(i,t,r,a,l,u,p){if(!i)return;!p&&u&&function(g,b,w,S){let T=g;do T.z===0&&(T.z=Jd(T.x,T.y,b,w,S)),T.prevZ=T.prev,T.nextZ=T.next,T=T.next;while(T!==g);T.prevZ.nextZ=null,T.prevZ=null,function(P){let L,R=1;do{let N,$=P;P=null;let ie=null;for(L=0;$;){L++;let X=$,ee=0;for(let fe=0;fe<R&&(ee++,X=X.nextZ,X);fe++);let oe=R;for(;ee>0||oe>0&&X;)ee!==0&&(oe===0||!X||$.z<=X.z)?(N=$,$=$.nextZ,ee--):(N=X,X=X.nextZ,oe--),ie?ie.nextZ=N:P=N,N.prevZ=ie,ie=N;$=X}ie.nextZ=null,R*=2}while(L>1)}(T)}(i,a,l,u);let m=i;for(;i.prev!==i.next;){let g=i.prev,b=i.next;if(u?Eg(i,a,l,u):Tg(i))t.push(g.i,i.i,b.i),hc(i),i=b.next,m=b.next;else if((i=b)===m){p?p===1?lc(i=Ag(Oo(i),t),t,r,a,l,u,2):p===2&&Pg(i,t,r,a,l,u):lc(Oo(i),t,r,a,l,u,1);break}}}function Tg(i){let t=i.prev,r=i,a=i.next;if($t(t,r,a)>=0)return!1;let l=t.x,u=r.x,p=a.x,m=t.y,g=r.y,b=a.y,w=l<u?l<p?l:p:u<p?u:p,S=m<g?m<b?m:b:g<b?g:b,T=l>u?l>p?l:p:u>p?u:p,P=m>g?m>b?m:b:g>b?g:b,L=a.next;for(;L!==t;){if(L.x>=w&&L.x<=T&&L.y>=S&&L.y<=P&&Us(l,m,u,g,p,b,L.x,L.y)&&$t(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Eg(i,t,r,a){let l=i.prev,u=i,p=i.next;if($t(l,u,p)>=0)return!1;let m=l.x,g=u.x,b=p.x,w=l.y,S=u.y,T=p.y,P=m<g?m<b?m:b:g<b?g:b,L=w<S?w<T?w:T:S<T?S:T,R=m>g?m>b?m:b:g>b?g:b,N=w>S?w>T?w:T:S>T?S:T,$=Jd(P,L,t,r,a),ie=Jd(R,N,t,r,a),X=i.prevZ,ee=i.nextZ;for(;X&&X.z>=$&&ee&&ee.z<=ie;){if(X.x>=P&&X.x<=R&&X.y>=L&&X.y<=N&&X!==l&&X!==p&&Us(m,w,g,S,b,T,X.x,X.y)&&$t(X.prev,X,X.next)>=0||(X=X.prevZ,ee.x>=P&&ee.x<=R&&ee.y>=L&&ee.y<=N&&ee!==l&&ee!==p&&Us(m,w,g,S,b,T,ee.x,ee.y)&&$t(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;X&&X.z>=$;){if(X.x>=P&&X.x<=R&&X.y>=L&&X.y<=N&&X!==l&&X!==p&&Us(m,w,g,S,b,T,X.x,X.y)&&$t(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;ee&&ee.z<=ie;){if(ee.x>=P&&ee.x<=R&&ee.y>=L&&ee.y<=N&&ee!==l&&ee!==p&&Us(m,w,g,S,b,T,ee.x,ee.y)&&$t(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Ag(i,t){let r=i;do{let a=r.prev,l=r.next.next;!wh(a,l)&&zp(a,r,r.next,l)&&cc(a,l)&&cc(l,a)&&(t.push(a.i,r.i,l.i),hc(r),hc(r.next),r=i=l),r=r.next}while(r!==i);return Oo(r)}function Pg(i,t,r,a,l,u){let p=i;do{let m=p.next.next;for(;m!==p.prev;){if(p.i!==m.i&&Fg(p,m)){let g=Lp(p,m);return p=Oo(p,p.next),g=Oo(g,g.next),lc(p,t,r,a,l,u,0),void lc(g,t,r,a,l,u,0)}m=m.next}p=p.next}while(p!==i)}function Dg(i,t){return i.x-t.x}function zg(i,t){let r=function(l,u){let p=u,m=l.x,g=l.y,b,w=-1/0;do{if(g<=p.y&&g>=p.next.y&&p.next.y!==p.y){let R=p.x+(g-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(R<=m&&R>w&&(w=R,b=p.x<p.next.x?p:p.next,R===m))return b}p=p.next}while(p!==u);if(!b)return null;let S=b,T=b.x,P=b.y,L=1/0;p=b;do{if(m>=p.x&&p.x>=T&&m!==p.x&&Us(g<P?m:w,g,T,P,g<P?w:m,g,p.x,p.y)){let R=Math.abs(g-p.y)/(m-p.x);cc(p,l)&&(R<L||R===L&&(p.x>b.x||p.x===b.x&&Lg(b,p)))&&(b=p,L=R)}p=p.next}while(p!==S);return b}(i,t);if(!r)return t;let a=Lp(r,i);return Oo(a,a.next),Oo(r,r.next)}function Lg(i,t){return $t(i.prev,i,t.prev)<0&&$t(t.next,i,i.next)<0}function Jd(i,t,r,a,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Rg(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Us(i,t,r,a,l,u,p,m){return(l-p)*(t-m)>=(i-p)*(u-m)&&(i-p)*(a-m)>=(r-p)*(t-m)&&(r-p)*(u-m)>=(l-p)*(a-m)}function Fg(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,a){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&zp(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(cc(i,t)&&cc(t,i)&&function(r,a){let l=r,u=!1,p=(r.x+a.x)/2,m=(r.y+a.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&p<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(i,t)&&($t(i.prev,i,t.prev)||$t(i,t.prev,t))||wh(i,t)&&$t(i.prev,i,i.next)>0&&$t(t.prev,t,t.next)>0)}function $t(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function wh(i,t){return i.x===t.x&&i.y===t.y}function zp(i,t,r,a){let l=Ch($t(i,t,r)),u=Ch($t(i,t,a)),p=Ch($t(r,a,i)),m=Ch($t(r,a,t));return l!==u&&p!==m||!(l!==0||!kh(i,r,t))||!(u!==0||!kh(i,a,t))||!(p!==0||!kh(r,i,a))||!(m!==0||!kh(r,t,a))}function kh(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Ch(i){return i>0?1:i<0?-1:0}function cc(i,t){return $t(i.prev,i,i.next)<0?$t(i,t,i.next)>=0&&$t(i,i.prev,t)>=0:$t(i,t,i.prev)<0||$t(i,i.next,t)<0}function Lp(i,t){let r=Qd(i.i,i.x,i.y),a=Qd(t.i,t.x,t.y),l=i.next,u=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,a.next=r,r.prev=a,u.next=a,a.prev=u,a}function Rp(i,t,r,a){let l=Qd(i,t,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function hc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qd(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function eu(i,t,r){let a=r.patternDependencies,l=!1;for(let u of t){let p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);let m=p.constantOr(null);m&&(l=!0,a[m.to]=!0,a[m.from]=!0)}return l}function tu(i,t,r,a,l){let u=l.patternDependencies;for(let p of t){let m=p.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:a-1},r,{},l.availableImages),b=m.evaluate({zoom:a},r,{},l.availableImages),w=m.evaluate({zoom:a+1},r,{},l.availableImages);g=g&&g.name?g.name:g,b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,u[g]=!0,u[b]=!0,u[w]=!0,r.patterns[p.id]={min:g,mid:b,max:w}}}return r}class iu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ur,this.indexArray=new kr,this.indexArray2=new ai,this.programConfigurations=new Ro(t.layers,t.zoom),this.segments=new lt,this.segments2=new lt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=eu("fill",this.layers,r);let l=this.layers[0].layout.get("fill-sort-key"),u=!l.isConstant(),p=[];for(let{feature:m,id:g,index:b,sourceLayerIndex:w}of t){let S=this.layers[0]._featureFilter.needGeometry,T=Bo(m,S);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),T,a))continue;let P=u?l.evaluate(T,{},a,r.availableImages):void 0,L={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:b,geometry:S?T.geometry:Fo(m),patterns:{},sortKey:P};p.push(L)}u&&p.sort((m,g)=>m.sortKey-g.sortKey);for(let m of p){let{geometry:g,index:b,sourceLayerIndex:w}=m;if(this.hasPattern){let S=tu("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,g,b,a,{});r.featureIndex.insert(t[b].feature,g,b,w,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ig),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,l,u){for(let p of ps(r,500)){let m=0;for(let P of p)m+=P.length;let g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),b=g.vertexLength,w=[],S=[];for(let P of p){if(P.length===0)continue;P!==p[0]&&S.push(w.length/2);let L=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),R=L.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(R+P.length-1,R),w.push(P[0].x),w.push(P[0].y);for(let N=1;N<P.length;N++)this.layoutVertexArray.emplaceBack(P[N].x,P[N].y),this.indexArray2.emplaceBack(R+N-1,R+N),w.push(P[N].x),w.push(P[N].y);L.vertexLength+=P.length,L.primitiveLength+=P.length}let T=Pp(w,S);for(let P=0;P<T.length;P+=3)this.indexArray.emplaceBack(b+T[P],b+T[P+1],b+T[P+2]);g.vertexLength+=m,g.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}let Fp,Bp;De("FillBucket",iu,{omit:["layers","patternFeatures"]});var Bg={get paint(){return Bp=Bp||new d({"fill-antialias":new Le(ae.paint_fill["fill-antialias"]),"fill-opacity":new Ue(ae.paint_fill["fill-opacity"]),"fill-color":new Ue(ae.paint_fill["fill-color"]),"fill-outline-color":new Ue(ae.paint_fill["fill-outline-color"]),"fill-translate":new Le(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new Le(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new zs(ae.paint_fill["fill-pattern"])})},get layout(){return Fp=Fp||new d({"fill-sort-key":new Ue(ae.layout_fill["fill-sort-key"])})}};class Og extends n{constructor(t){super(t,Bg)}recalculate(t,r){super.recalculate(t,r);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new iu(t)}queryRadius(){return vh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m){return vp(xh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,m),l)}isTileClipped(){return!0}}let Vg=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ng=f([{name:"a_centroid",components:2,type:"Int16"}],4),{members:jg}=Vg;var Za={},qg=Pe,Op=$s;function $s(i,t,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=l,i.readFields(Ug,this,t)}function Ug(i,t,r){i==1?t.id=r.readVarint():i==2?function(a,l){for(var u=a.readVarint()+a.pos;a.pos<u;){var p=l._keys[a.readVarint()],m=l._values[a.readVarint()];l.properties[p]=m}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function $g(i){for(var t,r,a=0,l=0,u=i.length,p=u-1;l<u;p=l++)a+=((r=i[p]).x-(t=i[l]).x)*(t.y+r.y);return a}$s.types=["Unknown","Point","LineString","Polygon"],$s.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,a=1,l=0,u=0,p=0,m=[];i.pos<r;){if(l<=0){var g=i.readVarint();a=7&g,l=g>>3}if(l--,a===1||a===2)u+=i.readSVarint(),p+=i.readSVarint(),a===1&&(t&&m.push(t),t=[]),t.push(new qg(u,p));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&m.push(t),m},$s.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,a=0,l=0,u=0,p=1/0,m=-1/0,g=1/0,b=-1/0;i.pos<t;){if(a<=0){var w=i.readVarint();r=7&w,a=w>>3}if(a--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>m&&(m=l),(u+=i.readSVarint())<g&&(g=u),u>b&&(b=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,g,m,b]},$s.prototype.toGeoJSON=function(i,t,r){var a,l,u=this.extent*Math.pow(2,r),p=this.extent*i,m=this.extent*t,g=this.loadGeometry(),b=$s.types[this.type];function w(P){for(var L=0;L<P.length;L++){var R=P[L];P[L]=[360*(R.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(a=0;a<g.length;a++)S[a]=g[a][0];w(g=S);break;case 2:for(a=0;a<g.length;a++)w(g[a]);break;case 3:for(g=function(P){var L=P.length;if(L<=1)return[P];for(var R,N,$=[],ie=0;ie<L;ie++){var X=$g(P[ie]);X!==0&&(N===void 0&&(N=X<0),N===X<0?(R&&$.push(R),R=[P[ie]]):R.push(P[ie]))}return R&&$.push(R),$}(g),a=0;a<g.length;a++)for(l=0;l<g[a].length;l++)w(g[a][l])}g.length===1?g=g[0]:b="Multi"+b;var T={type:"Feature",geometry:{type:b,coordinates:g},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Zg=Op,Vp=Np;function Np(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Gg,this,t),this.length=this._features.length}function Gg(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(a){for(var l=null,u=a.readVarint()+a.pos;a.pos<u;){var p=a.readVarint()>>3;l=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}return l}(r))}Np.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Zg(this._pbf,t,this.extent,this._keys,this._values)};var Hg=Vp;function Wg(i,t,r){if(i===3){var a=new Hg(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}Za.VectorTile=function(i,t){this.layers=i.readFields(Wg,{},t)},Za.VectorTileFeature=Op,Za.VectorTileLayer=Vp;let Xg=Za.VectorTileFeature.types,ru=Math.pow(2,13);function dc(i,t,r,a,l,u,p,m){i.emplaceBack(t,r,2*Math.floor(a*ru)+p,l*ru*2,u*ru*2,Math.round(m))}class nu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Va,this.centroidVertexArray=new di,this.indexArray=new kr,this.programConfigurations=new Ro(t.layers,t.zoom),this.segments=new lt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.features=[],this.hasPattern=eu("fill-extrusion",this.layers,r);for(let{feature:l,id:u,index:p,sourceLayerIndex:m}of t){let g=this.layers[0]._featureFilter.needGeometry,b=Bo(l,g);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),b,a))continue;let w={id:u,sourceLayerIndex:m,index:p,geometry:g?b.geometry:Fo(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(tu("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,a,{}),r.featureIndex.insert(l,w.geometry,p,m,this.index,!0)}}addFeatures(t,r,a){for(let l of this.features){let{geometry:u}=l;this.addFeature(l,u,l.index,r,a)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jg),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ng.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,l,u){for(let p of ps(r,500)){let m={x:0,y:0,vertexCount:0},g=0;for(let L of p)g+=L.length;let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let L of p){if(L.length===0||Yg(L))continue;let R=0;for(let N=0;N<L.length;N++){let $=L[N];if(N>=1){let ie=L[N-1];if(!Kg($,ie)){b.vertexLength+4>lt.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let X=$.sub(ie)._perp()._unit(),ee=ie.dist($);R+ee>32768&&(R=0),dc(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,0,R),dc(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,1,R),m.x+=2*$.x,m.y+=2*$.y,m.vertexCount+=2,R+=ee,dc(this.layoutVertexArray,ie.x,ie.y,X.x,X.y,0,0,R),dc(this.layoutVertexArray,ie.x,ie.y,X.x,X.y,0,1,R),m.x+=2*ie.x,m.y+=2*ie.y,m.vertexCount+=2;let oe=b.vertexLength;this.indexArray.emplaceBack(oe,oe+2,oe+1),this.indexArray.emplaceBack(oe+1,oe+2,oe+3),b.vertexLength+=4,b.primitiveLength+=2}}}}if(b.vertexLength+g>lt.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),Xg[t.type]!=="Polygon")continue;let w=[],S=[],T=b.vertexLength;for(let L of p)if(L.length!==0){L!==p[0]&&S.push(w.length/2);for(let R=0;R<L.length;R++){let N=L[R];dc(this.layoutVertexArray,N.x,N.y,0,0,1,1,0),m.x+=N.x,m.y+=N.y,m.vertexCount+=1,w.push(N.x),w.push(N.y)}}let P=Pp(w,S);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(T+P[L],T+P[L+2],T+P[L+1]);b.primitiveLength+=P.length/3,b.vertexLength+=g;for(let L=0;L<m.vertexCount;L++){let R=Math.floor(m.x/m.vertexCount),N=Math.floor(m.y/m.vertexCount);this.centroidVertexArray.emplaceBack(R,N)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}function Kg(i,t){return i.x===t.x&&(i.x<0||i.x>Xt)||i.y===t.y&&(i.y<0||i.y>Xt)}function Yg(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Xt)||i.every(t=>t.y<0)||i.every(t=>t.y>Xt)}let jp;De("FillExtrusionBucket",nu,{omit:["layers","features"]});var Jg={get paint(){return jp=jp||new d({"fill-extrusion-opacity":new Le(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Le(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Le(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zs(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Le(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Qg extends n{constructor(t){super(t,Jg)}createBucket(t){return new nu(t)}queryRadius(){return vh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,a,l,u,p,m,g){let b=xh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,m),w=this.paint.get("fill-extrusion-height").evaluate(r,a),S=this.paint.get("fill-extrusion-base").evaluate(r,a),T=function(L,R,N,$){let ie=[];for(let X of L){let ee=[X.x,X.y,0,1];bh(ee,ee,R),ie.push(new ge(ee[0]/ee[3],ee[1]/ee[3]))}return ie}(b,g),P=function(L,R,N,$){let ie=[],X=[],ee=$[8]*R,oe=$[9]*R,fe=$[10]*R,Te=$[11]*R,qe=$[8]*N,Me=$[9]*N,Ce=$[10]*N,Be=$[11]*N;for(let ze of L){let Ae=[],de=[];for(let Oe of ze){let Fe=Oe.x,He=Oe.y,wt=$[0]*Fe+$[4]*He+$[12],bt=$[1]*Fe+$[5]*He+$[13],ti=$[2]*Fe+$[6]*He+$[14],$r=$[3]*Fe+$[7]*He+$[15],mi=ti+fe,ii=$r+Te,Fi=wt+qe,Bi=bt+Me,Oi=ti+Ce,Vt=$r+Be,ri=new ge((wt+ee)/ii,(bt+oe)/ii);ri.z=mi/ii,Ae.push(ri);let Ci=new ge(Fi/Vt,Bi/Vt);Ci.z=Oi/Vt,de.push(Ci)}ie.push(Ae),X.push(de)}return[ie,X]}(l,S,w,g);return function(L,R,N){let $=1/0;vp(N,R)&&($=qp(N,R[0]));for(let ie=0;ie<R.length;ie++){let X=R[ie],ee=L[ie];for(let oe=0;oe<X.length-1;oe++){let fe=X[oe],Te=[fe,X[oe+1],ee[oe+1],ee[oe],fe];yp(N,Te)&&($=Math.min($,qp(N,Te)))}}return $!==1/0&&$}(P[0],P[1],T)}}function uc(i,t){return i.x*t.x+i.y*t.y}function qp(i,t){if(i.length===1){let r=0,a=t[r++],l;for(;!l||a.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){let u=t[r],p=i[0],m=l.sub(a),g=u.sub(a),b=p.sub(a),w=uc(m,m),S=uc(m,g),T=uc(g,g),P=uc(b,m),L=uc(b,g),R=w*T-S*S,N=(T*P-S*L)/R,$=(w*L-S*P)/R,ie=a.z*(1-N-$)+l.z*N+u.z*$;if(isFinite(ie))return ie}return 1/0}{let r=1/0;for(let a of t)r=Math.min(r,a.z);return r}}let e_=f([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:t_}=e_,i_=f([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:r_}=i_,n_=Za.VectorTileFeature.types,a_=Math.cos(Math.PI/180*37.5),Up=Math.pow(2,14)/.5;class au{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Rs,this.layoutVertexArray2=new Na,this.indexArray=new kr,this.programConfigurations=new Ro(t.layers,t.zoom),this.segments=new lt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=eu("line",this.layers,r);let l=this.layers[0].layout.get("line-sort-key"),u=!l.isConstant(),p=[];for(let{feature:m,id:g,index:b,sourceLayerIndex:w}of t){let S=this.layers[0]._featureFilter.needGeometry,T=Bo(m,S);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),T,a))continue;let P=u?l.evaluate(T,{},a):void 0,L={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:b,geometry:S?T.geometry:Fo(m),patterns:{},sortKey:P};p.push(L)}u&&p.sort((m,g)=>m.sortKey-g.sortKey);for(let m of p){let{geometry:g,index:b,sourceLayerIndex:w}=m;if(this.hasPattern){let S=tu("line",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,g,b,a,{});r.featureIndex.insert(t[b].feature,g,b,w,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,r_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,t_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,l,u){let p=this.layers[0].layout,m=p.get("line-join").evaluate(t,{}),g=p.get("line-cap"),b=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let S of r)this.addLine(S,t,m,g,b,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}addLine(t,r,a,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<t.length-1;$++)this.totalDistance+=t[$].dist(t[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let m=n_[r.type]==="Polygon",g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let b=0;for(;b<g-1&&t[b].equals(t[b+1]);)b++;if(g<(m?3:2))return;a==="bevel"&&(u=1.05);let w=this.overscaling<=16?15*Xt/(512*this.overscaling):0,S=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray),T,P,L,R,N;this.e1=this.e2=-1,m&&(T=t[g-2],N=t[b].sub(T)._unit()._perp());for(let $=b;$<g;$++){if(L=$===g-1?m?t[b+1]:void 0:t[$+1],L&&t[$].equals(L))continue;N&&(R=N),T&&(P=T),T=t[$],N=L?L.sub(T)._unit()._perp():R,R=R||N;let ie=R.add(N);ie.x===0&&ie.y===0||ie._unit();let X=R.x*N.x+R.y*N.y,ee=ie.x*N.x+ie.y*N.y,oe=ee!==0?1/ee:1/0,fe=2*Math.sqrt(2-2*ee),Te=ee<a_&&P&&L,qe=R.x*N.y-R.y*N.x>0;if(Te&&$>b){let Be=T.dist(P);if(Be>2*w){let ze=T.sub(T.sub(P)._mult(w/Be)._round());this.updateDistance(P,ze),this.addCurrentVertex(ze,R,0,0,S),P=ze}}let Me=P&&L,Ce=Me?a:m?"butt":l;if(Me&&Ce==="round"&&(oe<p?Ce="miter":oe<=2&&(Ce="fakeround")),Ce==="miter"&&oe>u&&(Ce="bevel"),Ce==="bevel"&&(oe>2&&(Ce="flipbevel"),oe<u&&(Ce="miter")),P&&this.updateDistance(P,T),Ce==="miter")ie._mult(oe),this.addCurrentVertex(T,ie,0,0,S);else if(Ce==="flipbevel"){if(oe>100)ie=N.mult(-1);else{let Be=oe*R.add(N).mag()/R.sub(N).mag();ie._perp()._mult(Be*(qe?-1:1))}this.addCurrentVertex(T,ie,0,0,S),this.addCurrentVertex(T,ie.mult(-1),0,0,S)}else if(Ce==="bevel"||Ce==="fakeround"){let Be=-Math.sqrt(oe*oe-1),ze=qe?Be:0,Ae=qe?0:Be;if(P&&this.addCurrentVertex(T,R,ze,Ae,S),Ce==="fakeround"){let de=Math.round(180*fe/Math.PI/20);for(let Oe=1;Oe<de;Oe++){let Fe=Oe/de;if(Fe!==.5){let wt=Fe-.5;Fe+=Fe*wt*(Fe-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*wt*wt+(.848013+X*(.215638*X-1.06021)))}let He=N.sub(R)._mult(Fe)._add(R)._unit()._mult(qe?-1:1);this.addHalfVertex(T,He.x,He.y,!1,qe,0,S)}}L&&this.addCurrentVertex(T,N,-ze,-Ae,S)}else if(Ce==="butt")this.addCurrentVertex(T,ie,0,0,S);else if(Ce==="square"){let Be=P?1:-1;this.addCurrentVertex(T,ie,Be,Be,S)}else Ce==="round"&&(P&&(this.addCurrentVertex(T,R,0,0,S),this.addCurrentVertex(T,R,1,1,S,!0)),L&&(this.addCurrentVertex(T,N,-1,-1,S,!0),this.addCurrentVertex(T,N,0,0,S)));if(Te&&$<g-1){let Be=T.dist(L);if(Be>2*w){let ze=T.add(L.sub(T)._mult(w/Be)._round());this.updateDistance(T,ze),this.addCurrentVertex(ze,N,0,0,S),T=ze}}}}addCurrentVertex(t,r,a,l,u,p=!1){let m=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,p,!1,a,u),this.addHalfVertex(t,m,g,p,!0,-l,u),this.distance>Up/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,l,u,p))}addHalfVertex({x:t,y:r},a,l,u,p,m,g){let b=.5*(this.lineClips?this.scaledDistance*(Up-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&b)<<2,b>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let $p,Zp;De("LineBucket",au,{omit:["layers","patternFeatures"]});var Gp={get paint(){return Zp=Zp||new d({"line-opacity":new Ue(ae.paint_line["line-opacity"]),"line-color":new Ue(ae.paint_line["line-color"]),"line-translate":new Le(ae.paint_line["line-translate"]),"line-translate-anchor":new Le(ae.paint_line["line-translate-anchor"]),"line-width":new Ue(ae.paint_line["line-width"]),"line-gap-width":new Ue(ae.paint_line["line-gap-width"]),"line-offset":new Ue(ae.paint_line["line-offset"]),"line-blur":new Ue(ae.paint_line["line-blur"]),"line-dasharray":new Ls(ae.paint_line["line-dasharray"]),"line-pattern":new zs(ae.paint_line["line-pattern"]),"line-gradient":new ic(ae.paint_line["line-gradient"])})},get layout(){return $p=$p||new d({"line-cap":new Le(ae.layout_line["line-cap"]),"line-join":new Ue(ae.layout_line["line-join"]),"line-miter-limit":new Le(ae.layout_line["line-miter-limit"]),"line-round-limit":new Le(ae.layout_line["line-round-limit"]),"line-sort-key":new Ue(ae.layout_line["line-sort-key"])})}};class o_ extends Ue{possiblyEvaluate(t,r){return r=new It(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,l){return r=ir({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,l)}}let Sh;class s_ extends n{constructor(t){super(t,Gp),this.gradientVersion=0,Sh||(Sh=new o_(Gp.paint.properties["line-width"].specification),Sh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof xa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Sh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new au(t)}queryRadius(t){let r=t,a=Hp(ac("line-width",this,r),ac("line-gap-width",this,r)),l=ac("line-offset",this,r);return a/2+Math.abs(l)+vh(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,a,l,u,p,m){let g=xh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,m),b=m/2*Hp(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),w=this.paint.get("line-offset").evaluate(r,a);return w&&(l=function(S,T){let P=[];for(let L=0;L<S.length;L++){let R=S[L],N=[];for(let $=0;$<R.length;$++){let ie=R[$-1],X=R[$],ee=R[$+1],oe=$===0?new ge(0,0):X.sub(ie)._unit()._perp(),fe=$===R.length-1?new ge(0,0):ee.sub(X)._unit()._perp(),Te=oe._add(fe)._unit(),qe=Te.x*fe.x+Te.y*fe.y;qe!==0&&Te._mult(1/qe),N.push(Te._mult(T)._add(X))}P.push(N)}return P}(l,w*m)),function(S,T,P){for(let L=0;L<T.length;L++){let R=T[L];if(S.length>=3){for(let N=0;N<R.length;N++)if(js(S,R[N]))return!0}if(gg(S,R,P))return!0}return!1}(g,l,b)}isTileClipped(){return!0}}function Hp(i,t){return t>0?t+2*i:i}let l_=f([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),c_=f([{name:"a_projected_pos",components:3,type:"Float32"}],4);f([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let h_=f([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);f([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Wp=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),d_=f([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function u_(i,t,r){return i.sections.forEach(a=>{a.text=function(l,u,p){let m=u.layout.get("text-transform").evaluate(p,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Ki.applyArabicShaping&&(l=Ki.applyArabicShaping(l)),l}(a.text,t,r)}),i}f([{name:"triangle",components:3,type:"Uint16"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),f([{type:"Float32",name:"offsetX"}]),f([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),f([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let pc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Jt=24,Xp=xt,Kp=function(i,t,r,a,l){var u,p,m=8*l-a-1,g=(1<<m)-1,b=g>>1,w=-7,S=r?l-1:0,T=r?-1:1,P=i[t+S];for(S+=T,u=P&(1<<-w)-1,P>>=-w,w+=m;w>0;u=256*u+i[t+S],S+=T,w-=8);for(p=u&(1<<-w)-1,u>>=-w,w+=a;w>0;p=256*p+i[t+S],S+=T,w-=8);if(u===0)u=1-b;else{if(u===g)return p?NaN:1/0*(P?-1:1);p+=Math.pow(2,a),u-=b}return(P?-1:1)*p*Math.pow(2,u-a)},Yp=function(i,t,r,a,l,u){var p,m,g,b=8*u-l-1,w=(1<<b)-1,S=w>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=a?0:u-1,L=a?1:-1,R=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,p=w):(p=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-p))<1&&(p--,g*=2),(t+=p+S>=1?T/g:T*Math.pow(2,1-S))*g>=2&&(p++,g/=2),p+S>=w?(m=0,p=w):p+S>=1?(m=(t*g-1)*Math.pow(2,l),p+=S):(m=t*Math.pow(2,S-1)*Math.pow(2,l),p=0));l>=8;i[r+P]=255&m,P+=L,m/=256,l-=8);for(p=p<<l|m,b+=l;b>0;i[r+P]=255&p,P+=L,p/=256,b-=8);i[r+P-L]|=128*R};function xt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}xt.Varint=0,xt.Fixed64=1,xt.Bytes=2,xt.Fixed32=5;var ou=4294967296,Jp=1/ou,Qp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ea(i){return i.type===xt.Bytes?i.readVarint()+i.pos:i.pos+1}function Zs(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function em(i,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=i;l--)r.buf[l+a]=r.buf[l]}function p_(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function m_(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function f_(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function g_(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function __(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function y_(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function v_(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function x_(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function b_(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Mh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Gs(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function tm(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}xt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,u=this.pos;this.type=7&a,i(l,t,this),this.pos===u&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Mh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=tm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Mh(this.buf,this.pos)+Mh(this.buf,this.pos+4)*ou;return this.pos+=8,i},readSFixed64:function(){var i=Mh(this.buf,this.pos)+tm(this.buf,this.pos+4)*ou;return this.pos+=8,i},readFloat:function(){var i=Kp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Kp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(l,u,p){var m,g,b=p.buf;if(m=(112&(g=b[p.pos++]))>>4,g<128||(m|=(127&(g=b[p.pos++]))<<3,g<128)||(m|=(127&(g=b[p.pos++]))<<10,g<128)||(m|=(127&(g=b[p.pos++]))<<17,g<128)||(m|=(127&(g=b[p.pos++]))<<24,g<128)||(m|=(1&(g=b[p.pos++]))<<31,g<128))return Zs(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Qp?function(r,a,l){return Qp.decode(r.subarray(a,l))}(this.buf,t,i):function(r,a,l){for(var u="",p=a;p<l;){var m,g,b,w=r[p],S=null,T=w>239?4:w>223?3:w>191?2:1;if(p+T>l)break;T===1?w<128&&(S=w):T===2?(192&(m=r[p+1]))==128&&(S=(31&w)<<6|63&m)<=127&&(S=null):T===3?(g=r[p+2],(192&(m=r[p+1]))==128&&(192&g)==128&&((S=(15&w)<<12|(63&m)<<6|63&g)<=2047||S>=55296&&S<=57343)&&(S=null)):T===4&&(g=r[p+2],b=r[p+3],(192&(m=r[p+1]))==128&&(192&g)==128&&(192&b)==128&&((S=(15&w)<<18|(63&m)<<12|(63&g)<<6|63&b)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,T=1):S>65535&&(S-=65536,u+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),u+=String.fromCharCode(S),p+=T}return u}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==xt.Bytes)return i.push(this.readVarint(t));var r=ea(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==xt.Bytes)return i.push(this.readSVarint());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==xt.Bytes)return i.push(this.readBoolean());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==xt.Bytes)return i.push(this.readFloat());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==xt.Bytes)return i.push(this.readDouble());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==xt.Bytes)return i.push(this.readFixed32());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==xt.Bytes)return i.push(this.readSFixed32());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==xt.Bytes)return i.push(this.readFixed64());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==xt.Bytes)return i.push(this.readSFixed64());var t=ea(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===xt.Varint)for(;this.buf[this.pos++]>127;);else if(t===xt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===xt.Fixed32)this.pos+=4;else{if(t!==xt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Gs(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Gs(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Gs(this.buf,-1&i,this.pos),Gs(this.buf,Math.floor(i*Jp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Gs(this.buf,-1&i,this.pos),Gs(this.buf,Math.floor(i*Jp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var a,l;if(t>=0?(a=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(a,0,r),function(u,p){var m=(7&u)<<4;p.buf[p.pos++]|=m|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,l,u){for(var p,m,g=0;g<l.length;g++){if((p=l.charCodeAt(g))>55295&&p<57344){if(!m){p>56319||g+1===l.length?(a[u++]=239,a[u++]=191,a[u++]=189):m=p;continue}if(p<56320){a[u++]=239,a[u++]=191,a[u++]=189,m=p;continue}p=m-55296<<10|p-56320|65536,m=null}else m&&(a[u++]=239,a[u++]=191,a[u++]=189,m=null);p<128?a[u++]=p:(p<2048?a[u++]=p>>6|192:(p<65536?a[u++]=p>>12|224:(a[u++]=p>>18|240,a[u++]=p>>12&63|128),a[u++]=p>>6&63|128),a[u++]=63&p|128)}return u}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&em(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Yp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Yp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var a=this.pos-r;a>=128&&em(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,r){this.writeTag(i,xt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,p_,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,m_,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,__,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,f_,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,g_,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,y_,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,v_,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,x_,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,b_,t)},writeBytesField:function(i,t){this.writeTag(i,xt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,xt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,xt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,xt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,xt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,xt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,xt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,xt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,xt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,xt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var su=ce(Xp);let lu=3;function w_(i,t,r){i===1&&r.readMessage(k_,t)}function k_(i,t,r){if(i===3){let{id:a,bitmap:l,width:u,height:p,left:m,top:g,advance:b}=r.readMessage(C_,{});t.push({id:a,bitmap:new sc({width:u+2*lu,height:p+2*lu},l),metrics:{width:u,height:p,left:m,top:g,advance:b}})}}function C_(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}let im=lu;function rm(i){let t=0,r=0;for(let p of i)t+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,m)=>m.h-p.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],l=0,u=0;for(let p of i)for(let m=a.length-1;m>=0;m--){let g=a[m];if(!(p.w>g.w||p.h>g.h)){if(p.x=g.x,p.y=g.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===g.w&&p.h===g.h){let b=a.pop();m<a.length&&(a[m]=b)}else p.h===g.h?(g.x+=p.w,g.w-=p.w):p.w===g.w?(g.y+=p.h,g.h-=p.h):(a.push({x:g.x+p.w,y:g.y,w:g.w-p.w,h:p.h}),g.y+=p.h,g.h-=p.h);break}}return{w:l,h:u,fill:t/(l*u)||0}}let Ji=1;class cu{constructor(t,{pixelRatio:r,version:a,stretchX:l,stretchY:u,content:p,textFitWidth:m,textFitHeight:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=p,this.version=a,this.textFitWidth=m,this.textFitHeight=g}get tl(){return[this.paddedRect.x+Ji,this.paddedRect.y+Ji]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ji,this.paddedRect.y+this.paddedRect.h-Ji]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ji)/this.pixelRatio,(this.paddedRect.h-2*Ji)/this.pixelRatio]}}class nm{constructor(t,r){let a={},l={};this.haveRenderCallbacks=[];let u=[];this.addImages(t,a,u),this.addImages(r,l,u);let{w:p,h:m}=rm(u),g=new Cr({width:p||1,height:m||1});for(let b in t){let w=t[b],S=a[b].paddedRect;Cr.copy(w.data,g,{x:0,y:0},{x:S.x+Ji,y:S.y+Ji},w.data)}for(let b in r){let w=r[b],S=l[b].paddedRect,T=S.x+Ji,P=S.y+Ji,L=w.data.width,R=w.data.height;Cr.copy(w.data,g,{x:0,y:0},{x:T,y:P},w.data),Cr.copy(w.data,g,{x:0,y:R-1},{x:T,y:P-1},{width:L,height:1}),Cr.copy(w.data,g,{x:0,y:0},{x:T,y:P+R},{width:L,height:1}),Cr.copy(w.data,g,{x:L-1,y:0},{x:T-1,y:P},{width:1,height:R}),Cr.copy(w.data,g,{x:0,y:0},{x:T+L,y:P},{width:1,height:R})}this.image=g,this.iconPositions=a,this.patternPositions=l}addImages(t,r,a){for(let l in t){let u=t[l],p={x:0,y:0,w:u.data.width+2*Ji,h:u.data.height+2*Ji};a.push(p),r[l]=new cu(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;let[l,u]=t.tl;a.update(r.data,void 0,{x:l,y:u})}}var Ga;De("ImagePosition",cu),De("ImageAtlas",nm),v.ah=void 0,(Ga=v.ah||(v.ah={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";let mc=-17;class fc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){let a=new fc;return a.scale=t||1,a.fontStack=r,a}static forImage(t){let r=new fc;return r.imageName=t,r}}class Hs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let a=new Hs;for(let l=0;l<t.sections.length;l++){let u=t.sections[l];u.image?a.addImageSection(u):a.addTextSection(u,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let a=0;a<t.length;a++){let l=t.charCodeAt(a+1)||null,u=t.charCodeAt(a-1)||null;r+=l&&uh(l)&&!pc[t[a+1]]||u&&uh(u)&&!pc[t[a-1]]||!pc[t[a]]?t[a]:pc[t[a]]}return r}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Th[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Th[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let a=new Hs;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(fc.forText(t.scale,t.fontStack||r));let a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void li("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(fc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ih(i,t,r,a,l,u,p,m,g,b,w,S,T,P,L){let R=Hs.fromFeature(i,l),N;S===v.ah.vertical&&R.verticalizePunctuation();let{processBidirectionalText:$,processStyledBidirectionalText:ie}=Ki;if($&&R.sections.length===1){N=[];let oe=$(R.toString(),hu(R,b,u,t,a,P));for(let fe of oe){let Te=new Hs;Te.text=fe,Te.sections=R.sections;for(let qe=0;qe<fe.length;qe++)Te.sectionIndex.push(0);N.push(Te)}}else if(ie){N=[];let oe=ie(R.text,R.sectionIndex,hu(R,b,u,t,a,P));for(let fe of oe){let Te=new Hs;Te.text=fe[0],Te.sectionIndex=fe[1],Te.sections=R.sections,N.push(Te)}}else N=function(oe,fe){let Te=[],qe=oe.text,Me=0;for(let Ce of fe)Te.push(oe.substring(Me,Ce)),Me=Ce;return Me<qe.length&&Te.push(oe.substring(Me,qe.length)),Te}(R,hu(R,b,u,t,a,P));let X=[],ee={positionedLines:X,text:R.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:S,iconsInText:!1,verticalizable:!1};return function(oe,fe,Te,qe,Me,Ce,Be,ze,Ae,de,Oe,Fe){let He=0,wt=mc,bt=0,ti=0,$r=ze==="right"?1:ze==="left"?0:.5,mi=0;for(let Vt of Me){Vt.trim();let ri=Vt.getMaxScale(),Ci=(ri-1)*Jt,fi={positionedGlyphs:[],lineOffset:0};oe.positionedLines[mi]=fi;let Vi=fi.positionedGlyphs,gi=0;if(!Vt.length()){wt+=Ce,++mi;continue}for(let Qi=0;Qi<Vt.length();Qi++){let ut=Vt.getSection(Qi),St=Vt.getSectionIndex(Qi),Pt=Vt.getCharCode(Qi),dr=0,Ft=null,Ys=null,Sn=null,Mn=Jt,Zr=!(Ae===v.ah.horizontal||!Oe&&!ec(Pt)||Oe&&(Th[Pt]||(ii=Pt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ii)))));if(ut.imageName){let Ir=qe[ut.imageName];if(!Ir)continue;Sn=ut.imageName,oe.iconsInText=oe.iconsInText||!0,Ys=Ir.paddedRect;let oi=Ir.displaySize;ut.scale=ut.scale*Jt/Fe,Ft={width:oi[0],height:oi[1],left:Ji,top:-im,advance:Zr?oi[1]:oi[0]},dr=Ci+(Jt-oi[1]*ut.scale),Mn=Ft.advance;let ta=Zr?oi[0]*ut.scale-Jt*ri:oi[1]*ut.scale-Jt*ri;ta>0&&ta>gi&&(gi=ta)}else{let Ir=Te[ut.fontStack],oi=Ir&&Ir[Pt];if(oi&&oi.rect)Ys=oi.rect,Ft=oi.metrics;else{let ta=fe[ut.fontStack],bc=ta&&ta[Pt];if(!bc)continue;Ft=bc.metrics}dr=(ri-ut.scale)*Jt}Zr?(oe.verticalizable=!0,Vi.push({glyph:Pt,imageName:Sn,x:He,y:wt+dr,vertical:Zr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:St,metrics:Ft,rect:Ys}),He+=Mn*ut.scale+de):(Vi.push({glyph:Pt,imageName:Sn,x:He,y:wt+dr,vertical:Zr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:St,metrics:Ft,rect:Ys}),He+=Ft.advance*ut.scale+de)}Vi.length!==0&&(bt=Math.max(He-de,bt),T_(Vi,0,Vi.length-1,$r,gi)),He=0;let Mr=Ce*ri+gi;fi.lineOffset=Math.max(gi,Ci),wt+=Mr,ti=Math.max(Mr,ti),++mi}var ii;let Fi=wt-mc,{horizontalAlign:Bi,verticalAlign:Oi}=du(Be);(function(Vt,ri,Ci,fi,Vi,gi,Mr,Qi,ut){let St=(ri-Ci)*Vi,Pt=0;Pt=gi!==Mr?-Qi*fi-mc:(-fi*ut+.5)*Mr;for(let dr of Vt)for(let Ft of dr.positionedGlyphs)Ft.x+=St,Ft.y+=Pt})(oe.positionedLines,$r,Bi,Oi,bt,ti,Ce,Fi,Me.length),oe.top+=-Oi*Fi,oe.bottom=oe.top+Fi,oe.left+=-Bi*bt,oe.right=oe.left+bt}(ee,t,r,a,N,p,m,g,S,b,T,L),!function(oe){for(let fe of oe)if(fe.positionedGlyphs.length!==0)return!1;return!0}(X)&&ee}let Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},S_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},M_={40:!0};function am(i,t,r,a,l,u){if(t.imageName){let p=a[t.imageName];return p?p.displaySize[0]*t.scale*Jt/u+l:0}{let p=r[t.fontStack],m=p&&p[i];return m?m.metrics.advance*t.scale+l:0}}function om(i,t,r,a){let l=Math.pow(i-t,2);return a?i<t?l/2:2*l:l+Math.abs(r)*r}function I_(i,t,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function sm(i,t,r,a,l,u){let p=null,m=om(t,r,l,u);for(let g of a){let b=om(t-g.x,r,l,u)+g.badness;b<=m&&(p=g,m=b)}return{index:i,x:t,priorBreak:p,badness:m}}function lm(i){return i?lm(i.priorBreak).concat(i.index):[]}function hu(i,t,r,a,l,u){if(!i)return[];let p=[],m=function(S,T,P,L,R,N){let $=0;for(let ie=0;ie<S.length();ie++){let X=S.getSection(ie);$+=am(S.getCharCode(ie),X,L,R,T,N)}return $/Math.max(1,Math.ceil($/P))}(i,t,r,a,l,u),g=i.text.indexOf("\u200B")>=0,b=0;for(let S=0;S<i.length();S++){let T=i.getSection(S),P=i.getCharCode(S);if(Th[P]||(b+=am(P,T,a,l,t,u)),S<i.length()-1){let L=!((w=P)<11904)&&(!!st["CJK Compatibility Forms"](w)||!!st["CJK Compatibility"](w)||!!st["CJK Strokes"](w)||!!st["CJK Symbols and Punctuation"](w)||!!st["Enclosed CJK Letters and Months"](w)||!!st["Halfwidth and Fullwidth Forms"](w)||!!st["Ideographic Description Characters"](w)||!!st["Vertical Forms"](w)||dh.test(String.fromCodePoint(w)));(S_[P]||L||T.imageName||S!==i.length()-2&&M_[i.getCharCode(S+1)])&&p.push(sm(S+1,b,m,p,I_(P,i.getCharCode(S+1),L&&g),!1))}}var w;return lm(sm(i.length(),b,m,p,0,!0))}function du(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function T_(i,t,r,a,l){if(!a&&!l)return;let u=i[r],p=(i[r].x+u.metrics.advance*u.scale)*a;for(let m=t;m<=r;m++)i[m].x-=p,i[m].y+=l}function E_(i,t,r){let{horizontalAlign:a,verticalAlign:l}=du(r),u=t[0]-i.displaySize[0]*a,p=t[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function cm(i){var t,r;let a=i.left,l=i.top,u=i.right-a,p=i.bottom-l,m=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",b=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(m==="stretchOnly"&&u/p<b||m==="proportional"){let w=Math.ceil(p*b);a*=w/u,u=w}}else if(m==="proportional"&&g==="stretchOnly"&&b!==0&&u/p>b){let w=Math.ceil(u/b);l*=w/p,p=w}return{x1:a,y1:l,x2:a+u,y2:l+p}}function hm(i,t,r,a,l,u){let p=i.image,m;if(p.content){let N=p.content,$=p.pixelRatio||1;m=[N[0]/$,N[1]/$,p.displaySize[0]-N[2]/$,p.displaySize[1]-N[3]/$]}let g=t.left*u,b=t.right*u,w,S,T,P;r==="width"||r==="both"?(P=l[0]+g-a[3],S=l[0]+b+a[1]):(P=l[0]+(g+b-p.displaySize[0])/2,S=P+p.displaySize[0]);let L=t.top*u,R=t.bottom*u;return r==="height"||r==="both"?(w=l[1]+L-a[0],T=l[1]+R+a[2]):(w=l[1]+(L+R-p.displaySize[1])/2,T=w+p.displaySize[1]),{image:p,top:w,right:S,bottom:T,left:P,collisionPadding:m}}let gc=255,Cn=128,Ha=gc*Cn;function dm(i,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new It(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=r,u=0;for(;u<a.length&&a[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<a.length&&a[p]<i+1;)p++;p=Math.min(a.length-1,p);let m=a[u],g=a[p];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new It(m)),maxSize:r.evaluate(new It(g)),interpolationType:l}}}function uu(i,t,r){let a="never",l=i.get(t);return l?a=l:i.get(r)&&(a="always"),a}let A_=Za.VectorTileFeature.types,P_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Eh(i,t,r,a,l,u,p,m,g,b,w,S,T){let P=m?Math.min(Ha,Math.round(m[0])):0,L=m?Math.min(Ha,Math.round(m[1])):0;i.emplaceBack(t,r,Math.round(32*a),Math.round(32*l),u,p,(P<<1)+(g?1:0),L,16*b,16*w,256*S,256*T)}function pu(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function D_(i){for(let t of i.sections)if(jd(t.text))return!0;return!1}class mu{constructor(t){this.layoutVertexArray=new Fs,this.indexArray=new kr,this.programConfigurations=t,this.segments=new lt,this.dynamicLayoutVertexArray=new rc,this.opacityVertexArray=new cr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Tt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,c_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,P_,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}De("SymbolBuffers",mu);class fu{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new lt,this.collisionVertexArray=new wn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,h_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}De("CollisionBuffers",fu);class Ws{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(p=>p.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wd([]),this.placementViewportMatrix=Wd([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dm(this.zoom,r["text-size"]),this.iconSizeData=dm(this.zoom,r["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),u=a.get("symbol-z-order");this.canOverlap=uu(a,"text-overlap","text-allow-overlap")!=="never"||uu(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(p=>v.ah[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=t.sourceID}createArrays(){this.text=new mu(new Ro(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new mu(new Ro(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Et,this.lineVertexArray=new hi,this.symbolInstances=new ot,this.textAnchorOffsets=new At}calculateGlyphDependencies(t,r,a,l,u){for(let p=0;p<t.length;p++)if(r[t.charCodeAt(p)]=!0,(a||l)&&u){let m=pc[t.charAt(p)];m&&(r[m.charCodeAt(0)]=!0)}}populate(t,r,a){let l=this.layers[0],u=l.layout,p=u.get("text-font"),m=u.get("text-field"),g=u.get("icon-image"),b=(m.value.kind!=="constant"||m.value.value instanceof Gi&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,S=u.get("symbol-sort-key");if(this.features=[],!b&&!w)return;let T=r.iconDependencies,P=r.glyphDependencies,L=r.availableImages,R=new It(this.zoom);for(let{feature:N,id:$,index:ie,sourceLayerIndex:X}of t){let ee=l._featureFilter.needGeometry,oe=Bo(N,ee);if(!l._featureFilter.filter(R,oe,a))continue;let fe,Te;if(ee||(oe.geometry=Fo(N)),b){let Me=l.getValueAndResolveTokens("text-field",oe,a,L),Ce=Gi.factory(Me),Be=this.hasRTLText=this.hasRTLText||D_(Ce);(!Be||Ki.getRTLTextPluginStatus()==="unavailable"||Be&&Ki.isParsed())&&(fe=u_(Ce,l,oe))}if(w){let Me=l.getValueAndResolveTokens("icon-image",oe,a,L);Te=Me instanceof Wi?Me:Wi.fromString(Me)}if(!fe&&!Te)continue;let qe=this.sortFeaturesByKey?S.evaluate(oe,{},a):void 0;if(this.features.push({id:$,text:fe,icon:Te,index:ie,sourceLayerIndex:X,geometry:oe.geometry,properties:N.properties,type:A_[N.type],sortKey:qe}),Te&&(T[Te.name]=!0),fe){let Me=p.evaluate(oe,{},a).join(","),Ce=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.ah.vertical)>=0;for(let Be of fe.sections)if(Be.image)T[Be.image.name]=!0;else{let ze=Jl(fe.toString()),Ae=Be.fontStack||Me,de=P[Ae]=P[Ae]||{};this.calculateGlyphDependencies(Be.text,de,Ce,this.allowVerticalPlacement,ze)}}}u.get("symbol-placement")==="line"&&(this.features=function(N){let $={},ie={},X=[],ee=0;function oe(Me){X.push(N[Me]),ee++}function fe(Me,Ce,Be){let ze=ie[Me];return delete ie[Me],ie[Ce]=ze,X[ze].geometry[0].pop(),X[ze].geometry[0]=X[ze].geometry[0].concat(Be[0]),ze}function Te(Me,Ce,Be){let ze=$[Ce];return delete $[Ce],$[Me]=ze,X[ze].geometry[0].shift(),X[ze].geometry[0]=Be[0].concat(X[ze].geometry[0]),ze}function qe(Me,Ce,Be){let ze=Be?Ce[0][Ce[0].length-1]:Ce[0][0];return`${Me}:${ze.x}:${ze.y}`}for(let Me=0;Me<N.length;Me++){let Ce=N[Me],Be=Ce.geometry,ze=Ce.text?Ce.text.toString():null;if(!ze){oe(Me);continue}let Ae=qe(ze,Be),de=qe(ze,Be,!0);if(Ae in ie&&de in $&&ie[Ae]!==$[de]){let Oe=Te(Ae,de,Be),Fe=fe(Ae,de,X[Oe].geometry);delete $[Ae],delete ie[de],ie[qe(ze,X[Fe].geometry,!0)]=Fe,X[Oe].geometry=null}else Ae in ie?fe(Ae,de,Be):de in $?Te(Ae,de,Be):(oe(Me),$[Ae]=ee-1,ie[de]=ee-1)}return X.filter(Me=>Me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((N,$)=>N.sortKey-$.sortKey)}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let a=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),u=t.dist(r[t.segment]),p={};for(let m=t.segment+1;m<r.length;m++)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=t.segment||0;m>=0;m--)p[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:u},m>0&&(u+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){let g=p[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,l,u,p,m,g,b,w,S,T){let P=t.indexArray,L=t.layoutVertexArray,R=t.segments.prepareSegment(4*r.length,L,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,$=R.vertexLength,ie=this.allowVerticalPlacement&&m===v.ah.vertical?Math.PI/2:0,X=p.text&&p.text.sections;for(let ee=0;ee<r.length;ee++){let{tl:oe,tr:fe,bl:Te,br:qe,tex:Me,pixelOffsetTL:Ce,pixelOffsetBR:Be,minFontScaleX:ze,minFontScaleY:Ae,glyphOffset:de,isSDF:Oe,sectionIndex:Fe}=r[ee],He=R.vertexLength,wt=de[1];Eh(L,g.x,g.y,oe.x,wt+oe.y,Me.x,Me.y,a,Oe,Ce.x,Ce.y,ze,Ae),Eh(L,g.x,g.y,fe.x,wt+fe.y,Me.x+Me.w,Me.y,a,Oe,Be.x,Ce.y,ze,Ae),Eh(L,g.x,g.y,Te.x,wt+Te.y,Me.x,Me.y+Me.h,a,Oe,Ce.x,Be.y,ze,Ae),Eh(L,g.x,g.y,qe.x,wt+qe.y,Me.x+Me.w,Me.y+Me.h,a,Oe,Be.x,Be.y,ze,Ae),pu(t.dynamicLayoutVertexArray,g,ie),P.emplaceBack(He,He+1,He+2),P.emplaceBack(He+1,He+2,He+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(de[0]),ee!==r.length-1&&Fe===r[ee+1].sectionIndex||t.programConfigurations.populatePaintArrays(L.length,p,p.index,{},T,X&&X[Fe])}t.placedSymbolArray.emplaceBack(g.x,g.y,N,this.glyphOffsetArray.length-N,$,b,w,g.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],m,0,!1,0,S)}_addCollisionDebugVertex(t,r,a,l,u,p){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,l,u,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,r,a,l,u,p,m){let g=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),b=g.vertexLength,w=u.layoutVertexArray,S=u.collisionVertexArray,T=m.anchorX,P=m.anchorY;this._addCollisionDebugVertex(w,S,p,T,P,new ge(t,r)),this._addCollisionDebugVertex(w,S,p,T,P,new ge(a,r)),this._addCollisionDebugVertex(w,S,p,T,P,new ge(a,l)),this._addCollisionDebugVertex(w,S,p,T,P,new ge(t,l)),g.vertexLength+=4;let L=u.indexArray;L.emplaceBack(b,b+1),L.emplaceBack(b+1,b+2),L.emplaceBack(b+2,b+3),L.emplaceBack(b+3,b),g.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,l){for(let u=t;u<r;u++){let p=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fu(hr,Wp.members,ai),this.iconCollisionBox=new fu(hr,Wp.members,ai);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,l,u,p,m,g,b){let w={};for(let S=r;S<a;S++){let T=t.get(S);w.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.textFeatureIndex=T.featureIndex;break}for(let S=l;S<u;S++){let T=t.get(S);w.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.verticalTextFeatureIndex=T.featureIndex;break}for(let S=p;S<m;S++){let T=t.get(S);w.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.iconFeatureIndex=T.featureIndex;break}for(let S=g;S<b;S++){let T=t.get(S);w.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},w.verticalIconFeatureIndex=T.featureIndex;break}return w}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let a=t.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let u=a.vertexStartIndex;u<l;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),a=Math.cos(t),l=[],u=[],p=[];for(let m=0;m<this.symbolInstances.length;++m){p.push(m);let g=this.symbolInstances.get(m);l.push(0|Math.round(r*g.anchorX+a*g.anchorY)),u.push(g.featureIndex)}return p.sort((m,g)=>l[m]-l[g]||u[g]-u[m]),p}addToSortKeyRanges(t,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let um,pm;De("SymbolBucket",Ws,{omit:["layers","collisionBoxArray","features","compareText"]}),Ws.MAX_GLYPHS=65535,Ws.addDynamicAttributes=pu;var gu={get paint(){return pm=pm||new d({"icon-opacity":new Ue(ae.paint_symbol["icon-opacity"]),"icon-color":new Ue(ae.paint_symbol["icon-color"]),"icon-halo-color":new Ue(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new Le(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new Le(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue(ae.paint_symbol["text-opacity"]),"text-color":new Ue(ae.paint_symbol["text-color"],{runtimeType:Pi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ue(ae.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(ae.paint_symbol["text-halo-blur"]),"text-translate":new Le(ae.paint_symbol["text-translate"]),"text-translate-anchor":new Le(ae.paint_symbol["text-translate-anchor"])})},get layout(){return um=um||new d({"symbol-placement":new Le(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new Le(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Le(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Le(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Le(ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Le(ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Le(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new Le(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Le(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(ae.layout_symbol["icon-size"]),"icon-text-fit":new Le(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Le(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(ae.layout_symbol["icon-image"]),"icon-rotate":new Ue(ae.layout_symbol["icon-rotate"]),"icon-padding":new Ue(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new Le(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(ae.layout_symbol["icon-offset"]),"icon-anchor":new Ue(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Le(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Le(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Le(ae.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(ae.layout_symbol["text-field"]),"text-font":new Ue(ae.layout_symbol["text-font"]),"text-size":new Ue(ae.layout_symbol["text-size"]),"text-max-width":new Ue(ae.layout_symbol["text-max-width"]),"text-line-height":new Le(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(ae.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(ae.layout_symbol["text-justify"]),"text-radial-offset":new Ue(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Le(ae.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ue(ae.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ue(ae.layout_symbol["text-anchor"]),"text-max-angle":new Le(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new Le(ae.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(ae.layout_symbol["text-rotate"]),"text-padding":new Le(ae.layout_symbol["text-padding"]),"text-keep-upright":new Le(ae.layout_symbol["text-keep-upright"]),"text-transform":new Ue(ae.layout_symbol["text-transform"]),"text-offset":new Ue(ae.layout_symbol["text-offset"]),"text-allow-overlap":new Le(ae.layout_symbol["text-allow-overlap"]),"text-overlap":new Le(ae.layout_symbol["text-overlap"]),"text-ignore-placement":new Le(ae.layout_symbol["text-ignore-placement"]),"text-optional":new Le(ae.layout_symbol["text-optional"])})}};class mm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:yn,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}De("FormatSectionOverride",mm,{omit:["defaultValue"]});class Ah extends n{constructor(t){super(t,gu)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let u of a)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,l){let u=this.layout.get(t).evaluate(r,{},a,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||bs(p.value)||!u?u:function(m,g){return g.replace(/{([^{}]+)}/g,(b,w)=>m&&w in m?String(m[w]):"")}(r.properties,u)}createBucket(t){return new Ws(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of gu.paint.overridableProperties){if(!Ah.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),a=new mm(r),l=new xs(a,r.property.specification),u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Ea("source",l):new Aa("composite",l,r.value.zoomStops),this.paint._values[t]=new qr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Ah.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let a=t.get("text-field"),l=gu.paint.properties[r],u=!1,p=m=>{for(let g of m)if(l.overrides&&l.overrides.hasOverride(g))return void(u=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Gi)p(a.value.value.sections);else if(a.value.kind==="source"){let m=b=>{u||(b instanceof _r&&Wt(b.value)===tn?p(b.value.sections):b instanceof ds?p(b.sections):b.eachChild(m))},g=a.value;g._styleExpression&&m(g._styleExpression.expression)}return u}}let fm;var z_={get paint(){return fm=fm||new d({"background-color":new Le(ae.paint_background["background-color"]),"background-pattern":new Ls(ae.paint_background["background-pattern"]),"background-opacity":new Le(ae.paint_background["background-opacity"])})}};class L_ extends n{constructor(t){super(t,z_)}}let gm;var R_={get paint(){return gm=gm||new d({"raster-opacity":new Le(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new Le(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Le(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Le(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new Le(ae.paint_raster["raster-saturation"]),"raster-contrast":new Le(ae.paint_raster["raster-contrast"]),"raster-resampling":new Le(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new Le(ae.paint_raster["raster-fade-duration"])})}};class F_ extends n{constructor(t){super(t,R_)}}class B_ extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class O_{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let _u=63710088e-1;class Wa{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wa(Dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,a=this.lat*r,l=t.lat*r,u=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return _u*Math.acos(Math.min(u,1))}static convert(t){if(t instanceof Wa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Wa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Wa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let _m=2*Math.PI*_u;function ym(i){return _m*Math.cos(i*Math.PI/180)}function vm(i){return(180+i)/360}function xm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function bm(i,t){return i/ym(t)}function yu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class _c{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){let a=Wa.convert(t);return new _c(vm(a.lng),xm(a.lat),bm(r,a.lat))}toLngLat(){return new Wa(360*this.x-180,yu(this.y))}toAltitude(){return this.z*ym(yu(this.y))}meterInMercatorCoordinateUnits(){return 1/_m*(t=yu(this.y),1/Math.cos(t*Math.PI/180));var t}}function wm(i,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class vu{constructor(t,r,a){if(!function(l,u,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||u<0||u>=Math.pow(2,l))}(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=yc(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){let l=(p=this.y,m=this.z,g=wm(256*(u=this.x),256*(p=Math.pow(2,m)-p-1),m),b=wm(256*(u+1),256*(p+1),m),g[0]+","+g[1]+","+b[0]+","+b[1]);var u,p,m,g,b;let w=function(S,T,P){let L,R="";for(let N=S;N>0;N--)L=1<<N-1,R+=(T&L?1:0)+(P&L?2:0);return R}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,w).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new ge((t.x*r-this.x)*Xt,(t.y*r-this.y)*Xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class km{constructor(t,r){this.wrap=t,this.canonical=r,this.key=yc(t,r.z,r.z,r.x,r.y)}}class Sr{constructor(t,r,a,l,u){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new vu(a,+l,+u),this.key=yc(r,t,a,l,u)}clone(){return new Sr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new Sr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?yc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):yc(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Sr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new Sr(r,this.wrap,r,a,l),new Sr(r,this.wrap,r,a+1,l),new Sr(r,this.wrap,r,a,l+1),new Sr(r,this.wrap,r,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Sr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Sr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new km(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new _c(t.x-this.wrap,t.y))}}function yc(i,t,r,a,l){(i*=2)<0&&(i=-1*i-1);let u=1<<r;return(u*u*i+u*l+a).toString(36)+r.toString(36)+t.toString(36)}De("CanonicalTileID",vu),De("OverscaledTileID",Sr,{omit:["posMatrix"]});class Cm{constructor(t,r,a,l=1,u=1,p=1,m=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void li(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=u,this.blueFactor=p,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let b=0;b<g;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(g,b)]=this.data[this._idx(g-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,g)]=this.data[this._idx(b,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let b=0;b<g;b++)for(let w=0;w<g;w++){let S=this.get(b,w);S>this.max&&(this.max=S),S<this.min&&(this.min=S)}}get(t,r){let a=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Cr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,p=a*this.dim,m=a*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(a){case-1:p=m-1;break;case 1:m=p+1}let g=-r*this.dim,b=-a*this.dim;for(let w=p;w<m;w++)for(let S=l;S<u;S++)this.data[this._idx(S,w)]=t.data[this._idx(S+g,w+b)]}}De("DEMData",Cm);class Sm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Mm{constructor(t,r,a,l,u){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=l,this.properties=t.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Im{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new La(Xt,16,0),this.grid3D=new La(Xt,16,0),this.featureIndexArray=new wi,this.promoteId=r}insert(t,r,a,l,u,p){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,u);let g=p?this.grid3D:this.grid;for(let b=0;b<r.length;b++){let w=r[b],S=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){let P=w[T];S[0]=Math.min(S[0],P.x),S[1]=Math.min(S[1],P.y),S[2]=Math.max(S[2],P.x),S[3]=Math.max(S[3],P.y)}S[0]<Xt&&S[1]<Xt&&S[2]>=0&&S[3]>=0&&g.insert(m,S[0],S[1],S[2],S[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Za.VectorTile(new su(this.rawTileData)).layers,this.sourceLayerCoder=new Sm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,l){this.loadVTLayers();let u=t.params||{},p=Xt/t.tileSize/t.scale,m=Bl(u.filter),g=t.queryGeometry,b=t.queryPadding*p,w=Em(g),S=this.grid.query(w.minX-b,w.minY-b,w.maxX+b,w.maxY+b),T=Em(t.cameraQueryGeometry),P=this.grid3D.query(T.minX-b,T.minY-b,T.maxX+b,T.maxY+b,(N,$,ie,X)=>function(ee,oe,fe,Te,qe){for(let Ce of ee)if(oe<=Ce.x&&fe<=Ce.y&&Te>=Ce.x&&qe>=Ce.y)return!0;let Me=[new ge(oe,fe),new ge(oe,qe),new ge(Te,qe),new ge(Te,fe)];if(ee.length>2){for(let Ce of Me)if(js(ee,Ce))return!0}for(let Ce=0;Ce<ee.length-1;Ce++)if(yg(ee[Ce],ee[Ce+1],Me))return!0;return!1}(t.cameraQueryGeometry,N-b,$-b,ie+b,X+b));for(let N of P)S.push(N);S.sort(V_);let L={},R;for(let N=0;N<S.length;N++){let $=S[N];if($===R)continue;R=$;let ie=this.featureIndexArray.get($),X=null;this.loadMatchingFeature(L,ie.bucketIndex,ie.sourceLayerIndex,ie.featureIndex,m,u.layers,u.availableImages,r,a,l,(ee,oe,fe)=>(X||(X=Fo(ee)),oe.queryIntersectsFeature(g,ee,fe,X,this.z,t.transform,p,t.pixelPosMatrix)))}return L}loadMatchingFeature(t,r,a,l,u,p,m,g,b,w,S){let T=this.bucketLayerIDs[r];if(p&&!function(N,$){for(let ie=0;ie<N.length;ie++)if($.indexOf(N[ie])>=0)return!0;return!1}(p,T))return;let P=this.sourceLayerCoder.decode(a),L=this.vtLayers[P].feature(l);if(u.needGeometry){let N=Bo(L,!0);if(!u.filter(new It(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!u.filter(new It(this.tileID.overscaledZ),L))return;let R=this.getId(L,P);for(let N=0;N<T.length;N++){let $=T[N];if(p&&p.indexOf($)<0)continue;let ie=g[$];if(!ie)continue;let X={};R&&w&&(X=w.getState(ie.sourceLayer||"_geojsonTileLayer",R));let ee=ir({},b[$]);ee.paint=Tm(ee.paint,ie.paint,L,X,m),ee.layout=Tm(ee.layout,ie.layout,L,X,m);let oe=!S||S(L,ie,X);if(!oe)continue;let fe=new Mm(L,this.z,this.x,this.y,R);fe.layer=ee;let Te=t[$];Te===void 0&&(Te=t[$]=[]),Te.push({featureIndex:l,feature:fe,intersectionZ:oe})}}lookupSymbolFeatures(t,r,a,l,u,p,m,g){let b={};this.loadVTLayers();let w=Bl(u);for(let S of t)this.loadMatchingFeature(b,a,l,S,w,p,m,g,r);return b}hasLayer(t){for(let r of this.bucketLayerIDs)for(let a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Tm(i,t,r,a,l){return zr(i,(u,p)=>{let m=t instanceof Do?t.get(p):null;return m&&m.evaluate?m.evaluate(r,a,l):m})}function Em(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return{minX:t,minY:r,maxX:a,maxY:l}}function V_(i,t){return t-i}function Am(i,t,r,a,l){let u=[];for(let p=0;p<i.length;p++){let m=i[p],g;for(let b=0;b<m.length-1;b++){let w=m[b],S=m[b+1];w.x<t&&S.x<t||(w.x<t?w=new ge(t,w.y+(t-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x<t&&(S=new ge(t,w.y+(t-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y<r&&S.y<r||(w.y<r?w=new ge(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round():S.y<r&&(S=new ge(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round()),w.x>=a&&S.x>=a||(w.x>=a?w=new ge(a,w.y+(a-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x>=a&&(S=new ge(a,w.y+(a-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y>=l&&S.y>=l||(w.y>=l?w=new ge(w.x+(l-w.y)/(S.y-w.y)*(S.x-w.x),l)._round():S.y>=l&&(S=new ge(w.x+(l-w.y)/(S.y-w.y)*(S.x-w.x),l)._round()),g&&w.equals(g[g.length-1])||(g=[w],u.push(g)),g.push(S)))))}}return u}De("FeatureIndex",Im,{omit:["rawTileData","sourceLayerCoder"]});class Xa extends ge{constructor(t,r,a,l){super(t,r),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new Xa(this.x,this.y,this.angle,this.segment)}}function Pm(i,t,r,a,l){if(t.segment===void 0||r===0)return!0;let u=t,p=t.segment+1,m=0;for(;m>-r/2;){if(p--,p<0)return!1;m-=i[p].dist(u),u=i[p]}m+=i[p].dist(i[p+1]),p++;let g=[],b=0;for(;m<r/2;){let w=i[p],S=i[p+1];if(!S)return!1;let T=i[p-1].angleTo(w)-w.angleTo(S);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:T}),b+=T;m-g[0].distance>a;)b-=g.shift().angleDelta;if(b>l)return!1;p++,m+=w.dist(S)}return!0}function Dm(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function zm(i,t,r){return i?.6*t*r:0}function Lm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function N_(i,t,r,a,l,u){let p=zm(r,l,u),m=Lm(r,a)*u,g=0,b=Dm(i)/2;for(let w=0;w<i.length-1;w++){let S=i[w],T=i[w+1],P=S.dist(T);if(g+P>b){let L=(b-g)/P,R=Di.number(S.x,T.x,L),N=Di.number(S.y,T.y,L),$=new Xa(R,N,T.angleTo(S),w);return $._round(),!p||Pm(i,$,m,p,t)?$:void 0}g+=P}}function j_(i,t,r,a,l,u,p,m,g){let b=zm(a,u,p),w=Lm(a,l),S=w*p,T=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return t-S<t/4&&(t=S+t/4),Rm(i,T?t/2*m%t:(w/2+2*u)*p*m%t,t,b,r,S,T,!1,g)}function Rm(i,t,r,a,l,u,p,m,g){let b=u/2,w=Dm(i),S=0,T=t-r,P=[];for(let L=0;L<i.length-1;L++){let R=i[L],N=i[L+1],$=R.dist(N),ie=N.angleTo(R);for(;T+r<S+$;){T+=r;let X=(T-S)/$,ee=Di.number(R.x,N.x,X),oe=Di.number(R.y,N.y,X);if(ee>=0&&ee<g&&oe>=0&&oe<g&&T-b>=0&&T+b<=w){let fe=new Xa(ee,oe,ie,L);fe._round(),a&&!Pm(i,fe,u,a,l)||P.push(fe)}}S+=$}return m||P.length||p||(P=Rm(i,S/2,r,a,l,u,p,!0,g)),P}De("Anchor",Xa);let Xs=Ji;function Fm(i,t,r,a){let l=[],u=i.image,p=u.pixelRatio,m=u.paddedRect.w-2*Xs,g=u.paddedRect.h-2*Xs,b={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom},w=u.stretchX||[[0,m]],S=u.stretchY||[[0,g]],T=(de,Oe)=>de+Oe[1]-Oe[0],P=w.reduce(T,0),L=S.reduce(T,0),R=m-P,N=g-L,$=0,ie=P,X=0,ee=L,oe=0,fe=R,Te=0,qe=N;if(u.content&&a){let de=u.content,Oe=de[2]-de[0],Fe=de[3]-de[1];(u.textFitWidth||u.textFitHeight)&&(b=cm(i)),$=Ph(w,0,de[0]),X=Ph(S,0,de[1]),ie=Ph(w,de[0],de[2]),ee=Ph(S,de[1],de[3]),oe=de[0]-$,Te=de[1]-X,fe=Oe-ie,qe=Fe-ee}let Me=b.x1,Ce=b.y1,Be=b.x2-Me,ze=b.y2-Ce,Ae=(de,Oe,Fe,He)=>{let wt=Dh(de.stretch-$,ie,Be,Me),bt=zh(de.fixed-oe,fe,de.stretch,P),ti=Dh(Oe.stretch-X,ee,ze,Ce),$r=zh(Oe.fixed-Te,qe,Oe.stretch,L),mi=Dh(Fe.stretch-$,ie,Be,Me),ii=zh(Fe.fixed-oe,fe,Fe.stretch,P),Fi=Dh(He.stretch-X,ee,ze,Ce),Bi=zh(He.fixed-Te,qe,He.stretch,L),Oi=new ge(wt,ti),Vt=new ge(mi,ti),ri=new ge(mi,Fi),Ci=new ge(wt,Fi),fi=new ge(bt/p,$r/p),Vi=new ge(ii/p,Bi/p),gi=t*Math.PI/180;if(gi){let ut=Math.sin(gi),St=Math.cos(gi),Pt=[St,-ut,ut,St];Oi._matMult(Pt),Vt._matMult(Pt),Ci._matMult(Pt),ri._matMult(Pt)}let Mr=de.stretch+de.fixed,Qi=Oe.stretch+Oe.fixed;return{tl:Oi,tr:Vt,bl:Ci,br:ri,tex:{x:u.paddedRect.x+Xs+Mr,y:u.paddedRect.y+Xs+Qi,w:Fe.stretch+Fe.fixed-Mr,h:He.stretch+He.fixed-Qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:Vi,minFontScaleX:fe/p/Be,minFontScaleY:qe/p/ze,isSDF:r}};if(a&&(u.stretchX||u.stretchY)){let de=Bm(w,R,P),Oe=Bm(S,N,L);for(let Fe=0;Fe<de.length-1;Fe++){let He=de[Fe],wt=de[Fe+1];for(let bt=0;bt<Oe.length-1;bt++)l.push(Ae(He,Oe[bt],wt,Oe[bt+1]))}}else l.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return l}function Ph(i,t,r){let a=0;for(let l of i)a+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return a}function Bm(i,t,r){let a=[{fixed:-Xs,stretch:0}];for(let[l,u]of i){let p=a[a.length-1];a.push({fixed:l-p.stretch,stretch:p.stretch}),a.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return a.push({fixed:t+Xs,stretch:r}),a}function Dh(i,t,r,a){return i/t*r+a}function zh(i,t,r,a){return i-t*r/a}class Lh{constructor(t,r,a,l,u,p,m,g,b,w){var S;if(this.boxStartIndex=t.length,b){let T=p.top,P=p.bottom,L=p.collisionPadding;L&&(T-=L[1],P+=L[3]);let R=P-T;R>0&&(R=Math.max(10,R),this.circleDiameter=R)}else{let T=!((S=p.image)===null||S===void 0)&&S.content&&(p.image.textFitWidth||p.image.textFitHeight)?cm(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};T.y1=T.y1*m-g[0],T.y2=T.y2*m+g[2],T.x1=T.x1*m-g[3],T.x2=T.x2*m+g[1];let P=p.collisionPadding;if(P&&(T.x1-=P[0]*m,T.y1-=P[1]*m,T.x2+=P[2]*m,T.y2+=P[3]*m),w){let L=new ge(T.x1,T.y1),R=new ge(T.x2,T.y1),N=new ge(T.x1,T.y2),$=new ge(T.x2,T.y2),ie=w*Math.PI/180;L._rotate(ie),R._rotate(ie),N._rotate(ie),$._rotate(ie),T.x1=Math.min(L.x,R.x,N.x,$.x),T.x2=Math.max(L.x,R.x,N.x,$.x),T.y1=Math.min(L.y,R.y,N.y,$.y),T.y2=Math.max(L.y,R.y,N.y,$.y)}t.emplaceBack(r.x,r.y,T.x1,T.y1,T.x2,T.y2,a,l,u)}this.boxEndIndex=t.length}}class q_{constructor(t=[],r=(a,l)=>a<l?-1:a>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:a}=this,l=r[t];for(;t>0;){let u=t-1>>1,p=r[u];if(a(l,p)>=0)break;r[t]=p,t=u}r[t]=l}_down(t){let{data:r,compare:a}=this,l=this.length>>1,u=r[t];for(;t<l;){let p=1+(t<<1),m=p+1;if(m<this.length&&a(r[m],r[p])<0&&(p=m),a(r[p],u)>=0)break;r[t]=r[p],t=p}r[t]=u}}function U_(i,t=1,r=!1){let a=1/0,l=1/0,u=-1/0,p=-1/0,m=i[0];for(let P=0;P<m.length;P++){let L=m[P];(!P||L.x<a)&&(a=L.x),(!P||L.y<l)&&(l=L.y),(!P||L.x>u)&&(u=L.x),(!P||L.y>p)&&(p=L.y)}let g=Math.min(u-a,p-l),b=g/2,w=new q_([],$_);if(g===0)return new ge(a,l);for(let P=a;P<u;P+=g)for(let L=l;L<p;L+=g)w.push(new Ks(P+b,L+b,b,i));let S=function(P){let L=0,R=0,N=0,$=P[0];for(let ie=0,X=$.length,ee=X-1;ie<X;ee=ie++){let oe=$[ie],fe=$[ee],Te=oe.x*fe.y-fe.x*oe.y;R+=(oe.x+fe.x)*Te,N+=(oe.y+fe.y)*Te,L+=3*Te}return new Ks(R/L,N/L,0,P)}(i),T=w.length;for(;w.length;){let P=w.pop();(P.d>S.d||!S.d)&&(S=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,T)),P.max-S.d<=t||(b=P.h/2,w.push(new Ks(P.p.x-b,P.p.y-b,b,i)),w.push(new Ks(P.p.x+b,P.p.y-b,b,i)),w.push(new Ks(P.p.x-b,P.p.y+b,b,i)),w.push(new Ks(P.p.x+b,P.p.y+b,b,i)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${S.d}`)),S.p}function $_(i,t){return t.max-i.max}function Ks(i,t,r,a){this.p=new ge(i,t),this.h=r,this.d=function(l,u){let p=!1,m=1/0;for(let g=0;g<u.length;g++){let b=u[g];for(let w=0,S=b.length,T=S-1;w<S;T=w++){let P=b[w],L=b[T];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(p=!p),m=Math.min(m,xp(l,P,L))}}return(p?1:-1)*Math.sqrt(m)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var pi;v.aq=void 0,(pi=v.aq||(v.aq={}))[pi.center=1]="center",pi[pi.left=2]="left",pi[pi.right=3]="right",pi[pi.top=4]="top",pi[pi.bottom=5]="bottom",pi[pi["top-left"]=6]="top-left",pi[pi["top-right"]=7]="top-right",pi[pi["bottom-left"]=8]="bottom-left",pi[pi["bottom-right"]=9]="bottom-right";let Ka=7,xu=Number.POSITIVE_INFINITY;function Om(i,t){return t[1]!==xu?function(r,a,l){let u=0,p=0;switch(a=Math.abs(a),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-Ka;break;case"bottom-right":case"bottom-left":case"bottom":p=-l+Ka}switch(r){case"top-right":case"bottom-right":case"right":u=-a;break;case"top-left":case"bottom-left":case"left":u=a}return[u,p]}(i,t[0],t[1]):function(r,a){let l=0,u=0;a<0&&(a=0);let p=a/Math.SQRT2;switch(r){case"top-right":case"top-left":u=p-Ka;break;case"bottom-right":case"bottom-left":u=-p+Ka;break;case"bottom":u=-a+Ka;break;case"top":u=a-Ka}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=a;break;case"right":l=-a}return[l,u]}(i,t[0])}function Vm(i,t,r){var a;let l=i.layout,u=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(u){let m=u.values,g=[];for(let b=0;b<m.length;b+=2){let w=g[b]=m[b],S=m[b+1].map(T=>T*Jt);w.startsWith("top")?S[1]-=Ka:w.startsWith("bottom")&&(S[1]+=Ka),g[b+1]=S}return new nr(g)}let p=l.get("text-variable-anchor");if(p){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Jt,xu]:l.get("text-offset").evaluate(t,{},r).map(b=>b*Jt);let g=[];for(let b of p)g.push(b,Om(b,m));return new nr(g)}return null}function bu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Z_(i,t,r,a,l,u,p,m,g,b,w){let S=u.textMaxSize.evaluate(t,{});S===void 0&&(S=p);let T=i.layers[0].layout,P=T.get("icon-offset").evaluate(t,{},w),L=jm(r.horizontal),R=p/24,N=i.tilePixelRatio*R,$=i.tilePixelRatio*S/24,ie=i.tilePixelRatio*m,X=i.tilePixelRatio*T.get("symbol-spacing"),ee=T.get("text-padding")*i.tilePixelRatio,oe=function(de,Oe,Fe,He=1){let wt=de.get("icon-padding").evaluate(Oe,{},Fe),bt=wt&&wt.values;return[bt[0]*He,bt[1]*He,bt[2]*He,bt[3]*He]}(T,t,w,i.tilePixelRatio),fe=T.get("text-max-angle")/180*Math.PI,Te=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",qe=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Me=T.get("symbol-placement"),Ce=X/2,Be=T.get("icon-text-fit"),ze;a&&Be!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ze=hm(a,r.vertical,Be,T.get("icon-text-fit-padding"),P,R)),L&&(a=hm(a,L,Be,T.get("icon-text-fit-padding"),P,R)));let Ae=(de,Oe)=>{Oe.x<0||Oe.x>=Xt||Oe.y<0||Oe.y>=Xt||function(Fe,He,wt,bt,ti,$r,mi,ii,Fi,Bi,Oi,Vt,ri,Ci,fi,Vi,gi,Mr,Qi,ut,St,Pt,dr,Ft,Ys){let Sn=Fe.addToLineVertexArray(He,wt),Mn,Zr,Ir,oi,ta=0,bc=0,Zm=0,Gm=0,Eu=-1,Au=-1,ia={},Hm=Bs("");if(Fe.allowVerticalPlacement&&bt.vertical){let Si=ii.layout.get("text-rotate").evaluate(St,{},Ft)+90;Ir=new Lh(Fi,He,Bi,Oi,Vt,bt.vertical,ri,Ci,fi,Si),mi&&(oi=new Lh(Fi,He,Bi,Oi,Vt,mi,gi,Mr,fi,Si))}if(ti){let Si=ii.layout.get("icon-rotate").evaluate(St,{}),Tr=ii.layout.get("icon-text-fit")!=="none",Vo=Fm(ti,Si,dr,Tr),sn=mi?Fm(mi,Si,dr,Tr):void 0;Zr=new Lh(Fi,He,Bi,Oi,Vt,ti,gi,Mr,!1,Si),ta=4*Vo.length;let No=Fe.iconSizeData,In=null;No.kind==="source"?(In=[Cn*ii.layout.get("icon-size").evaluate(St,{})],In[0]>Ha&&li(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)):No.kind==="composite"&&(In=[Cn*Pt.compositeIconSizes[0].evaluate(St,{},Ft),Cn*Pt.compositeIconSizes[1].evaluate(St,{},Ft)],(In[0]>Ha||In[1]>Ha)&&li(`${Fe.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)),Fe.addSymbols(Fe.icon,Vo,In,ut,Qi,St,v.ah.none,He,Sn.lineStartIndex,Sn.lineLength,-1,Ft),Eu=Fe.icon.placedSymbolArray.length-1,sn&&(bc=4*sn.length,Fe.addSymbols(Fe.icon,sn,In,ut,Qi,St,v.ah.vertical,He,Sn.lineStartIndex,Sn.lineLength,-1,Ft),Au=Fe.icon.placedSymbolArray.length-1)}let Wm=Object.keys(bt.horizontal);for(let Si of Wm){let Tr=bt.horizontal[Si];if(!Mn){Hm=Bs(Tr.text);let sn=ii.layout.get("text-rotate").evaluate(St,{},Ft);Mn=new Lh(Fi,He,Bi,Oi,Vt,Tr,ri,Ci,fi,sn)}let Vo=Tr.positionedLines.length===1;if(Zm+=Nm(Fe,He,Tr,$r,ii,fi,St,Vi,Sn,bt.vertical?v.ah.horizontal:v.ah.horizontalOnly,Vo?Wm:[Si],ia,Eu,Pt,Ft),Vo)break}bt.vertical&&(Gm+=Nm(Fe,He,bt.vertical,$r,ii,fi,St,Vi,Sn,v.ah.vertical,["vertical"],ia,Au,Pt,Ft));let W_=Mn?Mn.boxStartIndex:Fe.collisionBoxArray.length,X_=Mn?Mn.boxEndIndex:Fe.collisionBoxArray.length,K_=Ir?Ir.boxStartIndex:Fe.collisionBoxArray.length,Y_=Ir?Ir.boxEndIndex:Fe.collisionBoxArray.length,J_=Zr?Zr.boxStartIndex:Fe.collisionBoxArray.length,Q_=Zr?Zr.boxEndIndex:Fe.collisionBoxArray.length,e0=oi?oi.boxStartIndex:Fe.collisionBoxArray.length,t0=oi?oi.boxEndIndex:Fe.collisionBoxArray.length,on=-1,Fh=(Si,Tr)=>Si&&Si.circleDiameter?Math.max(Si.circleDiameter,Tr):Tr;on=Fh(Mn,on),on=Fh(Ir,on),on=Fh(Zr,on),on=Fh(oi,on);let Xm=on>-1?1:0;Xm&&(on*=Ys/Jt),Fe.glyphOffsetArray.length>=Ws.MAX_GLYPHS&&li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),St.sortKey!==void 0&&Fe.addToSortKeyRanges(Fe.symbolInstances.length,St.sortKey);let i0=Vm(ii,St,Ft),[r0,n0]=function(Si,Tr){let Vo=Si.length,sn=Tr?.values;if(sn?.length>0)for(let No=0;No<sn.length;No+=2){let In=sn[No+1];Si.emplaceBack(v.aq[sn[No]],In[0],In[1])}return[Vo,Si.length]}(Fe.textAnchorOffsets,i0);Fe.symbolInstances.emplaceBack(He.x,He.y,ia.right>=0?ia.right:-1,ia.center>=0?ia.center:-1,ia.left>=0?ia.left:-1,ia.vertical||-1,Eu,Au,Hm,W_,X_,K_,Y_,J_,Q_,e0,t0,Bi,Zm,Gm,ta,bc,Xm,0,ri,on,r0,n0)}(i,Oe,de,r,a,l,ze,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,N,[ee,ee,ee,ee],Te,g,ie,oe,qe,P,t,u,b,w,p)};if(Me==="line")for(let de of Am(t.geometry,0,0,Xt,Xt)){let Oe=j_(de,X,fe,r.vertical||L,a,24,$,i.overscaling,Xt);for(let Fe of Oe)L&&G_(i,L.text,Ce,Fe)||Ae(de,Fe)}else if(Me==="line-center"){for(let de of t.geometry)if(de.length>1){let Oe=N_(de,fe,r.vertical||L,a,24,$);Oe&&Ae(de,Oe)}}else if(t.type==="Polygon")for(let de of ps(t.geometry,0)){let Oe=U_(de,16);Ae(de[0],new Xa(Oe.x,Oe.y,0))}else if(t.type==="LineString")for(let de of t.geometry)Ae(de,new Xa(de[0].x,de[0].y,0));else if(t.type==="Point")for(let de of t.geometry)for(let Oe of de)Ae([Oe],new Xa(Oe.x,Oe.y,0))}function Nm(i,t,r,a,l,u,p,m,g,b,w,S,T,P,L){let R=function(ie,X,ee,oe,fe,Te,qe,Me){let Ce=oe.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Be=[];for(let ze of X.positionedLines)for(let Ae of ze.positionedGlyphs){if(!Ae.rect)continue;let de=Ae.rect||{},Oe=im+1,Fe=!0,He=1,wt=0,bt=(fe||Me)&&Ae.vertical,ti=Ae.metrics.advance*Ae.scale/2;if(Me&&X.verticalizable&&(wt=ze.lineOffset/2-(Ae.imageName?-(Jt-Ae.metrics.width*Ae.scale)/2:(Ae.scale-1)*Jt)),Ae.imageName){let ut=qe[Ae.imageName];Fe=ut.sdf,He=ut.pixelRatio,Oe=Ji/He}let $r=fe?[Ae.x+ti,Ae.y]:[0,0],mi=fe?[0,0]:[Ae.x+ti+ee[0],Ae.y+ee[1]-wt],ii=[0,0];bt&&(ii=mi,mi=[0,0]);let Fi=Ae.metrics.isDoubleResolution?2:1,Bi=(Ae.metrics.left-Oe)*Ae.scale-ti+mi[0],Oi=(-Ae.metrics.top-Oe)*Ae.scale+mi[1],Vt=Bi+de.w/Fi*Ae.scale/He,ri=Oi+de.h/Fi*Ae.scale/He,Ci=new ge(Bi,Oi),fi=new ge(Vt,Oi),Vi=new ge(Bi,ri),gi=new ge(Vt,ri);if(bt){let ut=new ge(-ti,ti-mc),St=-Math.PI/2,Pt=Jt/2-ti,dr=new ge(5-mc-Pt,-(Ae.imageName?Pt:0)),Ft=new ge(...ii);Ci._rotateAround(St,ut)._add(dr)._add(Ft),fi._rotateAround(St,ut)._add(dr)._add(Ft),Vi._rotateAround(St,ut)._add(dr)._add(Ft),gi._rotateAround(St,ut)._add(dr)._add(Ft)}if(Ce){let ut=Math.sin(Ce),St=Math.cos(Ce),Pt=[St,-ut,ut,St];Ci._matMult(Pt),fi._matMult(Pt),Vi._matMult(Pt),gi._matMult(Pt)}let Mr=new ge(0,0),Qi=new ge(0,0);Be.push({tl:Ci,tr:fi,bl:Vi,br:gi,tex:de,writingMode:X.writingMode,glyphOffset:$r,sectionIndex:Ae.sectionIndex,isSDF:Fe,pixelOffsetTL:Mr,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}return Be}(0,r,m,l,u,p,a,i.allowVerticalPlacement),N=i.textSizeData,$=null;N.kind==="source"?($=[Cn*l.layout.get("text-size").evaluate(p,{})],$[0]>Ha&&li(`${i.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)):N.kind==="composite"&&($=[Cn*P.compositeTextSizes[0].evaluate(p,{},L),Cn*P.compositeTextSizes[1].evaluate(p,{},L)],($[0]>Ha||$[1]>Ha)&&li(`${i.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)),i.addSymbols(i.text,R,$,m,u,p,b,t,g.lineStartIndex,g.lineLength,T,L);for(let ie of w)S[ie]=i.text.placedSymbolArray.length-1;return 4*R.length}function jm(i){for(let t in i)return i[t];return null}function G_(i,t,r,a){let l=i.compareText;if(t in l){let u=l[t];for(let p=u.length-1;p>=0;p--)if(a.dist(u[p])<r)return!0}else l[t]=[];return l[t].push(a),!1}let qm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let u=qm[15&a];if(!u)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(t,2,1),[m]=new Uint32Array(t,4,1);return new wu(m,p,u,t)}constructor(t,r=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let u=qm.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,m=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-m%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+m+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return ku(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:p,nodeSize:m}=this,g=[0,u.length-1,0],b=[];for(;g.length;){let w=g.pop()||0,S=g.pop()||0,T=g.pop()||0;if(S-T<=m){for(let N=T;N<=S;N++){let $=p[2*N],ie=p[2*N+1];$>=t&&$<=a&&ie>=r&&ie<=l&&b.push(u[N])}continue}let P=T+S>>1,L=p[2*P],R=p[2*P+1];L>=t&&L<=a&&R>=r&&R<=l&&b.push(u[P]),(w===0?t<=L:r<=R)&&(g.push(T),g.push(P-1),g.push(1-w)),(w===0?a>=L:l>=R)&&(g.push(P+1),g.push(S),g.push(1-w))}return b}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:p}=this,m=[0,l.length-1,0],g=[],b=a*a;for(;m.length;){let w=m.pop()||0,S=m.pop()||0,T=m.pop()||0;if(S-T<=p){for(let N=T;N<=S;N++)$m(u[2*N],u[2*N+1],t,r)<=b&&g.push(l[N]);continue}let P=T+S>>1,L=u[2*P],R=u[2*P+1];$m(L,R,t,r)<=b&&g.push(l[P]),(w===0?t-a<=L:r-a<=R)&&(m.push(T),m.push(P-1),m.push(1-w)),(w===0?t+a>=L:r+a>=R)&&(m.push(P+1),m.push(S),m.push(1-w))}return g}}function ku(i,t,r,a,l,u){if(l-a<=r)return;let p=a+l>>1;Um(i,t,p,a,l,u),ku(i,t,r,a,p-1,1-u),ku(i,t,r,p+1,l,1-u)}function Um(i,t,r,a,l,u){for(;l>a;){if(l-a>600){let b=l-a+1,w=r-a+1,S=Math.log(b),T=.5*Math.exp(2*S/3),P=.5*Math.sqrt(S*T*(b-T)/b)*(w-b/2<0?-1:1);Um(i,t,r,Math.max(a,Math.floor(r-w*T/b+P)),Math.min(l,Math.floor(r+(b-w)*T/b+P)),u)}let p=t[2*r+u],m=a,g=l;for(vc(i,t,a,r),t[2*l+u]>p&&vc(i,t,a,l);m<g;){for(vc(i,t,m,g),m++,g--;t[2*m+u]<p;)m++;for(;t[2*g+u]>p;)g--}t[2*a+u]===p?vc(i,t,a,g):(g++,vc(i,t,g,l)),g<=r&&(a=g+1),r<=g&&(l=g-1)}}function vc(i,t,r,a){Cu(i,r,a),Cu(t,2*r,2*a),Cu(t,2*r+1,2*a+1)}function Cu(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}function $m(i,t,r,a){let l=i-r,u=t-a;return l*l+u*u}var Su;v.bg=void 0,(Su=v.bg||(v.bg={})).create="create",Su.load="load",Su.fullLoad="fullLoad";let Rh=null,xc=[],Mu=1e3/60,Iu="loadTime",Tu="fullLoadTime",H_={mark(i){performance.mark(i)},frame(i){let t=i;Rh!=null&&xc.push(t-Rh),Rh=t},clearMetrics(){Rh=null,xc=[],performance.clearMeasures(Iu),performance.clearMeasures(Tu);for(let i in v.bg)performance.clearMarks(v.bg[i])},getPerformanceMetrics(){performance.measure(Iu,v.bg.create,v.bg.load),performance.measure(Tu,v.bg.create,v.bg.fullLoad);let i=performance.getEntriesByName(Iu)[0].duration,t=performance.getEntriesByName(Tu)[0].duration,r=xc.length,a=1/(xc.reduce((u,p)=>u+p,0)/r/1e3),l=xc.filter(u=>u>Mu).reduce((u,p)=>u+(p-Mu)/Mu,0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};v.$=class extends M{},v.A=qs,v.B=Fd,v.C=function(i){if(ua==null){let t=i.navigator?i.navigator.userAgent:null;ua=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ua},v.D=Le,v.E=fa,v.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new O_(()=>this.process()),this.subscription=function(r,a,l,u){return r.addEventListener(a,l,!1),{unsubscribe:()=>{r.removeEventListener(a,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Yr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,a)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];let m={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(m)},{once:!0});let u=[],p=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Ra(i.data,u)});this.target.postMessage(p,{transfer:u})})}receive(i){let t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(Yr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(Fa(t.error)):l.resolve(Fa(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=Fa(t.data),a=new AbortController;this.abortControllers[i]=a;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){let a=[];delete this.abortControllers[i];let l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ra(t):null,data:Ra(r,a)};this.target.postMessage(l,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},v.G=ma,v.H=function(){var i=new qs(16);return qs!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},v.I=cu,v.J=function(i,t,r){var a,l,u,p,m,g,b,w,S,T,P,L,R=r[0],N=r[1],$=r[2];return t===i?(i[12]=t[0]*R+t[4]*N+t[8]*$+t[12],i[13]=t[1]*R+t[5]*N+t[9]*$+t[13],i[14]=t[2]*R+t[6]*N+t[10]*$+t[14],i[15]=t[3]*R+t[7]*N+t[11]*$+t[15]):(l=t[1],u=t[2],p=t[3],m=t[4],g=t[5],b=t[6],w=t[7],S=t[8],T=t[9],P=t[10],L=t[11],i[0]=a=t[0],i[1]=l,i[2]=u,i[3]=p,i[4]=m,i[5]=g,i[6]=b,i[7]=w,i[8]=S,i[9]=T,i[10]=P,i[11]=L,i[12]=a*R+m*N+S*$+t[12],i[13]=l*R+g*N+T*$+t[13],i[14]=u*R+b*N+P*$+t[14],i[15]=p*R+w*N+L*$+t[15]),i},v.K=function(i,t,r){var a=r[0],l=r[1],u=r[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*u,i[9]=t[9]*u,i[10]=t[10]*u,i[11]=t[11]*u,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},v.L=Cp,v.M=function(i,t){let r={};for(let a=0;a<t.length;a++){let l=t[a];l in i&&(r[l]=i[l])}return r},v.N=Wa,v.O=vm,v.P=ge,v.Q=xm,v.R=Cr,v.S=Sr,v.T=Ds,v.U=Kr,v.V=so,v.W=Fn,v.X=Xt,v.Y=f,v.Z=_c,v._=c,v.a=mn,v.a$=function(i,t){var r=i[0],a=i[1],l=i[2],u=i[3],p=i[4],m=i[5],g=i[6],b=i[7],w=i[8],S=i[9],T=i[10],P=i[11],L=i[12],R=i[13],N=i[14],$=i[15],ie=t[0],X=t[1],ee=t[2],oe=t[3],fe=t[4],Te=t[5],qe=t[6],Me=t[7],Ce=t[8],Be=t[9],ze=t[10],Ae=t[11],de=t[12],Oe=t[13],Fe=t[14],He=t[15];return Math.abs(r-ie)<=Ri*Math.max(1,Math.abs(r),Math.abs(ie))&&Math.abs(a-X)<=Ri*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(l-ee)<=Ri*Math.max(1,Math.abs(l),Math.abs(ee))&&Math.abs(u-oe)<=Ri*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(p-fe)<=Ri*Math.max(1,Math.abs(p),Math.abs(fe))&&Math.abs(m-Te)<=Ri*Math.max(1,Math.abs(m),Math.abs(Te))&&Math.abs(g-qe)<=Ri*Math.max(1,Math.abs(g),Math.abs(qe))&&Math.abs(b-Me)<=Ri*Math.max(1,Math.abs(b),Math.abs(Me))&&Math.abs(w-Ce)<=Ri*Math.max(1,Math.abs(w),Math.abs(Ce))&&Math.abs(S-Be)<=Ri*Math.max(1,Math.abs(S),Math.abs(Be))&&Math.abs(T-ze)<=Ri*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(P-Ae)<=Ri*Math.max(1,Math.abs(P),Math.abs(Ae))&&Math.abs(L-de)<=Ri*Math.max(1,Math.abs(L),Math.abs(de))&&Math.abs(R-Oe)<=Ri*Math.max(1,Math.abs(R),Math.abs(Oe))&&Math.abs(N-Fe)<=Ri*Math.max(1,Math.abs(N),Math.abs(Fe))&&Math.abs($-He)<=Ri*Math.max(1,Math.abs($),Math.abs(He))},v.a0=lt,v.a1=vu,v.a2=ye,v.a3=i=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(let a of i){let l=window.document.createElement("source");On(a)||(t.crossOrigin="Anonymous"),l.src=a,t.appendChild(l)}})},v.a4=function(){return ts++},v.a5=Ie,v.a6=Ws,v.a7=Bl,v.a8=Bo,v.a9=Mm,v.aA=function(i){if(i.type==="custom")return new B_(i);switch(i.type){case"background":return new L_(i);case"circle":return new bg(i);case"fill":return new Og(i);case"fill-extrusion":return new Qg(i);case"heatmap":return new kg(i);case"hillshade":return new Sg(i);case"line":return new s_(i);case"raster":return new F_(i);case"symbol":return new Ah(i)}},v.aB=yt,v.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!pt(i.version,t.version))return[{command:"setStyle",args:[t]}];pt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),pt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),pt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),pt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),pt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),pt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),pt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),pt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),pt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),pt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),pt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let a={},l=[];(function(p,m,g,b){let w;for(w in m=m||{},p=p||{})Object.prototype.hasOwnProperty.call(p,w)&&(Object.prototype.hasOwnProperty.call(m,w)||_n(w,g,b));for(w in m)Object.prototype.hasOwnProperty.call(m,w)&&(Object.prototype.hasOwnProperty.call(p,w)?pt(p[w],m[w])||(p[w].type==="geojson"&&m[w].type==="geojson"&&ga(p,m,w)?Lt(g,{command:"setGeoJSONSourceData",args:[w,m[w].data]}):en(w,m,g,b)):uo(w,m,g))})(i.sources,t.sources,l,a);let u=[];i.layers&&i.layers.forEach(p=>{"source"in p&&a[p.source]?r.push({command:"removeLayer",args:[p.id]}):u.push(p)}),r=r.concat(l),function(p,m,g){m=m||[];let b=(p=p||[]).map(po),w=m.map(po),S=p.reduce(mo,{}),T=m.reduce(mo,{}),P=b.slice(),L=Object.create(null),R,N,$,ie,X;for(let ee=0,oe=0;ee<b.length;ee++)R=b[ee],Object.prototype.hasOwnProperty.call(T,R)?oe++:(Lt(g,{command:"removeLayer",args:[R]}),P.splice(P.indexOf(R,oe),1));for(let ee=0,oe=0;ee<w.length;ee++)R=w[w.length-1-ee],P[P.length-1-ee]!==R&&(Object.prototype.hasOwnProperty.call(S,R)?(Lt(g,{command:"removeLayer",args:[R]}),P.splice(P.lastIndexOf(R,P.length-oe),1)):oe++,ie=P[P.length-ee],Lt(g,{command:"addLayer",args:[T[R],ie]}),P.splice(P.length-ee,0,R),L[R]=!0);for(let ee=0;ee<w.length;ee++)if(R=w[ee],N=S[R],$=T[R],!L[R]&&!pt(N,$))if(pt(N.source,$.source)&&pt(N["source-layer"],$["source-layer"])&&pt(N.type,$.type)){for(X in rr(N.layout,$.layout,g,R,null,"setLayoutProperty"),rr(N.paint,$.paint,g,R,null,"setPaintProperty"),pt(N.filter,$.filter)||Lt(g,{command:"setFilter",args:[R,$.filter]}),pt(N.minzoom,$.minzoom)&&pt(N.maxzoom,$.maxzoom)||Lt(g,{command:"setLayerZoomRange",args:[R,$.minzoom,$.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?rr(N[X],$[X],g,R,X.slice(6),"setPaintProperty"):pt(N[X],$[X])||Lt(g,{command:"setLayerProperty",args:[R,X,$[X]]}));for(X in $)Object.prototype.hasOwnProperty.call($,X)&&!Object.prototype.hasOwnProperty.call(N,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?rr(N[X],$[X],g,R,X.slice(6),"setPaintProperty"):pt(N[X],$[X])||Lt(g,{command:"setLayerProperty",args:[R,X,$[X]]}))}else Lt(g,{command:"removeLayer",args:[R]}),ie=P[P.lastIndexOf(R)+1],Lt(g,{command:"addLayer",args:[$,ie]})}(u,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},v.aD=function(i){let t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},v.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let a in t)if(!i(t[a],r[a]))return!1;return!0}return t===r},v.aF=zr,v.aG=lo,v.aH=class extends Lo{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},v.aI=_h,v.aJ=class extends Lo{constructor(i,t){super(i,t),this.current=pg}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},v.aK=pp,v.aL=mp,v.aM=_t,v.aN=class extends Lo{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},v.aO=class extends Lo{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},v.aP=function(i,t,r,a,l,u,p){var m=1/(t-r),g=1/(a-l),b=1/(u-p);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(t+r)*m,i[13]=(l+a)*g,i[14]=(p+u)*b,i[15]=1,i},v.aQ=xg,v.aR=class extends Y{},v.aS=d_,v.aT=class extends re{},v.aU=Yd,v.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},v.aW=Ep,v.aX=di,v.aY=kr,v.aZ=class extends Re{},v.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},v.aa=function(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,u)=>{let p=l||u;return t[a]=!p||p.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},v.ab=function(i,t){let r=[];for(let a in i)a in t||r.push(a);return r},v.ac=pr,v.ad=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[0],p=t[1],m=t[2],g=t[3],b=t[4],w=t[5],S=t[6],T=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=u*l+b*a,i[1]=p*l+w*a,i[2]=m*l+S*a,i[3]=g*l+T*a,i[4]=b*l-u*a,i[5]=w*l-p*a,i[6]=S*l-m*a,i[7]=T*l-g*a,i},v.ae=function(i){var t=new qs(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},v.af=bh,v.ag=function(i,t){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:l,minZoom:u,maxZoom:p}=i,m=l?pr(zi.interpolationFactor(l,t,u,p),0,1):0;i.kind==="camera"?a=Di.number(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:a}},v.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:l}){return i.kind==="source"?a/Cn:i.kind==="composite"?Di.number(a/Cn,l/Cn,r):t},v.aj=pu,v.ak=function(i,t,r,a){let l=t.y-i.y,u=t.x-i.x,p=a.y-r.y,m=a.x-r.x,g=p*u-m*l;if(g===0)return null;let b=(m*(i.y-r.y)-p*(i.x-r.x))/g;return new ge(i.x+b*u,i.y+b*l)},v.al=Am,v.am=yp,v.an=Wd,v.ao=function(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return[t,r,a,l]},v.ap=Jt,v.ar=uu,v.as=function(i,t){var r=t[0],a=t[1],l=t[2],u=t[3],p=t[4],m=t[5],g=t[6],b=t[7],w=t[8],S=t[9],T=t[10],P=t[11],L=t[12],R=t[13],N=t[14],$=t[15],ie=r*m-a*p,X=r*g-l*p,ee=r*b-u*p,oe=a*g-l*m,fe=a*b-u*m,Te=l*b-u*g,qe=w*R-S*L,Me=w*N-T*L,Ce=w*$-P*L,Be=S*N-T*R,ze=S*$-P*R,Ae=T*$-P*N,de=ie*Ae-X*ze+ee*Be+oe*Ce-fe*Me+Te*qe;return de?(i[0]=(m*Ae-g*ze+b*Be)*(de=1/de),i[1]=(l*ze-a*Ae-u*Be)*de,i[2]=(R*Te-N*fe+$*oe)*de,i[3]=(T*fe-S*Te-P*oe)*de,i[4]=(g*Ce-p*Ae-b*Me)*de,i[5]=(r*Ae-l*Ce+u*Me)*de,i[6]=(N*ee-L*Te-$*X)*de,i[7]=(w*Te-T*ee+P*X)*de,i[8]=(p*ze-m*Ce+b*qe)*de,i[9]=(a*Ce-r*ze-u*qe)*de,i[10]=(L*fe-R*ee+$*ie)*de,i[11]=(S*ee-w*fe-P*ie)*de,i[12]=(m*Me-p*Be-g*qe)*de,i[13]=(r*Be-a*Me+l*qe)*de,i[14]=(R*X-L*oe-N*ie)*de,i[15]=(w*oe-S*X+T*ie)*de,i):null},v.at=bu,v.au=du,v.av=wu,v.aw=function(){let i={},t=ae.$version;for(let r in ae.$root){let a=ae.$root[r];if(a.required){let l=null;l=r==="version"?t:a.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},v.ax=Yl,v.ay=fr,v.az=function(i){i=i.slice();let t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=ho(i[r],t[i[r].ref]));return i},v.b=Lr,v.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},v.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},v.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},v.b3=Dr,v.b4=km,v.b5=bm,v.b6=function(i,t,r,a,l){var u,p=1/Math.tan(t/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+a)*(u=1/(a-l)),i[14]=2*l*a*u):(i[10]=-1,i[14]=-2*a),i},v.b7=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[4],p=t[5],m=t[6],g=t[7],b=t[8],w=t[9],S=t[10],T=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=u*l+b*a,i[5]=p*l+w*a,i[6]=m*l+S*a,i[7]=g*l+T*a,i[8]=b*l-u*a,i[9]=w*l-p*a,i[10]=S*l-m*a,i[11]=T*l-g*a,i},v.b8=$i,v.b9=pl,v.bA=Xp,v.bB=function(i){return i.message===mr},v.bC=Ta,v.bD=Ki,v.ba=function(i){return i*Math.PI/180},v.bb=function(i,t){let{x:r,y:a}=_c.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||r<0||r>=1)},v.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.bd=class extends k{},v.be=_u,v.bf=H_,v.bh=Zi,v.bi=function(i,t){mn.REGISTERED_PROTOCOLS[i]=t},v.bj=function(i){delete mn.REGISTERED_PROTOCOLS[i]},v.bk=function(i,t){let r={};for(let l=0;l<i.length;l++){let u=t&&t[i[l].id]||ah(i[l]);t&&(t[i[l].id]=u);let p=r[u];p||(p=r[u]=[]),p.push(i[l])}let a=[];for(let l in r)a.push(r[l]);return a},v.bl=De,v.bm=Sm,v.bn=Im,v.bo=nm,v.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Xt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;let t=i.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new It(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new It(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new It(18))};if(i.bucket.textSizeData.kind==="composite"){let{minZoom:b,maxZoom:w}=i.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new It(b),i.canonical),a["text-size"].possiblyEvaluate(new It(w),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){let{minZoom:b,maxZoom:w}=i.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new It(b),i.canonical),a["icon-size"].possiblyEvaluate(new It(w),i.canonical)]}let u=r.get("text-line-height")*Jt,p=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),g=r.get("text-size");for(let b of i.bucket.features){let w=r.get("text-font").evaluate(b,{},i.canonical).join(","),S=g.evaluate(b,{},i.canonical),T=l.layoutTextSize.evaluate(b,{},i.canonical),P=l.layoutIconSize.evaluate(b,{},i.canonical),L={horizontal:{},vertical:void 0},R=b.text,N,$=[0,0];if(R){let ee=R.toString(),oe=r.get("text-letter-spacing").evaluate(b,{},i.canonical)*Jt,fe=Bd(ee)?oe:0,Te=r.get("text-anchor").evaluate(b,{},i.canonical),qe=Vm(t,b,i.canonical);if(!qe){let ze=r.get("text-radial-offset").evaluate(b,{},i.canonical);$=ze?Om(Te,[ze*Jt,xu]):r.get("text-offset").evaluate(b,{},i.canonical).map(Ae=>Ae*Jt)}let Me=p?"center":r.get("text-justify").evaluate(b,{},i.canonical),Ce=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(b,{},i.canonical)*Jt:1/0,Be=()=>{i.bucket.allowVerticalPlacement&&Jl(ee)&&(L.vertical=Ih(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,"left",fe,$,v.ah.vertical,!0,T,S))};if(!p&&qe){let ze=new Set;if(Me==="auto")for(let de=0;de<qe.values.length;de+=2)ze.add(bu(qe.values[de]));else ze.add(Me);let Ae=!1;for(let de of ze)if(!L.horizontal[de])if(Ae)L.horizontal[de]=L.horizontal[0];else{let Oe=Ih(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,"center",de,fe,$,v.ah.horizontal,!1,T,S);Oe&&(L.horizontal[de]=Oe,Ae=Oe.positionedLines.length===1)}Be()}else{Me==="auto"&&(Me=bu(Te));let ze=Ih(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,Me,fe,$,v.ah.horizontal,!1,T,S);ze&&(L.horizontal[Me]=ze),Be(),Jl(ee)&&p&&m&&(L.vertical=Ih(R,i.glyphMap,i.glyphPositions,i.imagePositions,w,Ce,u,Te,Me,fe,$,v.ah.vertical,!1,T,S))}}let ie=!1;if(b.icon&&b.icon.name){let ee=i.imageMap[b.icon.name];ee&&(N=E_(i.imagePositions[b.icon.name],r.get("icon-offset").evaluate(b,{},i.canonical),r.get("icon-anchor").evaluate(b,{},i.canonical)),ie=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ie:i.bucket.sdfIcons!==ie&&li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}let X=jm(L.horizontal)||L.vertical;i.bucket.iconsInText=!!X&&X.iconsInText,(X||N)&&Z_(i.bucket,b,L,N,i.imageMap,l,T,P,$,ie,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},v.bq=au,v.br=iu,v.bs=nu,v.bt=Za,v.bu=su,v.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},v.bw=function(i,t,r,a,l){return c(this,void 0,void 0,function*(){if(so())try{return yield Fn(i,t,r,a,l)}catch{}return function(u,p,m,g,b){let w=u.width,S=u.height;Jr&&Ai||(Jr=new OffscreenCanvas(w,S),Ai=Jr.getContext("2d",{willReadFrequently:!0})),Jr.width=w,Jr.height=S,Ai.drawImage(u,0,0,w,S);let T=Ai.getImageData(p,m,g,b);return Ai.clearRect(0,0,w,S),T.data}(i,t,r,a,l)})},v.bx=Cm,v.by=ce,v.bz=Pe,v.c=pa,v.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),v.e=ir,v.f=i=>new Promise((t,r)=>{let a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=rs})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(l):rs}),v.g=Rr,v.h=(i,t)=>Bn(ir(i,{type:"json"}),t),v.i=Yr,v.j=gn,v.k=fn,v.l=(i,t)=>Bn(ir(i,{type:"arrayBuffer"}),t),v.m=Bn,v.n=function(i){return new su(i).readFields(w_,[])},v.o=sc,v.p=rm,v.q=d,v.r=Rd,v.s=On,v.t=Xl,v.u=Yn,v.v=ae,v.w=li,v.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},v.y=Di,v.z=It}),y("worker",["./shared"],function(v){"use strict";class c{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,E){for(let j of A){this._layerConfigs[j.id]=j;let K=this._layers[j.id]=v.aA(j);K._featureFilter=v.a7(K.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(let j of E)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};let B=v.bk(Object.values(this._layerConfigs),this.keyCache);for(let j of B){let K=j.map(ne=>this._layers[ne.id]),J=K[0];if(J.visibility==="none")continue;let te=J.source||"",H=this.familiesBySource[te];H||(H=this.familiesBySource[te]={});let le=J.sourceLayer||"_geojsonTileLayer",pe=H[le];pe||(pe=H[le]=[]),pe.push(K)}}}class ce{constructor(A){let E={},B=[];for(let te in A){let H=A[te],le=E[te]={};for(let pe in H){let ne=H[+pe];if(!ne||ne.bitmap.width===0||ne.bitmap.height===0)continue;let ve={x:0,y:0,w:ne.bitmap.width+2,h:ne.bitmap.height+2};B.push(ve),le[pe]={rect:ve,metrics:ne.metrics}}}let{w:j,h:K}=v.p(B),J=new v.o({width:j||1,height:K||1});for(let te in A){let H=A[te];for(let le in H){let pe=H[+le];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;let ne=E[te][le].rect;v.o.copy(pe.bitmap,J,{x:0,y:0},{x:ne.x+1,y:ne.y+1},pe.bitmap)}}this.image=J,this.positions=E}}v.bl("GlyphAtlas",ce);class Pe{constructor(A){this.tileID=new v.S(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId,this.inFlightDependencies=[]}parse(A,E,B,j){return v._(this,void 0,void 0,function*(){this.status="parsing",this.data=A,this.collisionBoxArray=new v.a5;let K=new v.bm(Object.keys(A.layers).sort()),J=new v.bn(this.tileID,this.promoteId);J.bucketLayerIDs=[];let te={},H={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:B},le=E.familiesBySource[this.source];for(let tt in le){let gt=A.layers[tt];if(!gt)continue;gt.version===1&&v.w(`Vector tile source "${this.source}" layer "${tt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let zt=K.encode(tt),ei=[];for(let ni=0;ni<gt.length;ni++){let bi=gt.feature(ni),_a=J.getId(bi,tt);ei.push({feature:bi,id:_a,index:ni,sourceLayerIndex:zt})}for(let ni of le[tt]){let bi=ni[0];bi.source!==this.source&&v.w(`layer.source = ${bi.source} does not equal this.source = ${this.source}`),bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility!=="none"&&(Je(ni,this.zoom,B),(te[bi.id]=bi.createBucket({index:J.bucketLayerIDs.length,layers:ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source})).populate(ei,H,this.tileID.canonical),J.bucketLayerIDs.push(ni.map(_a=>_a.id)))}}let pe=v.aF(H.glyphDependencies,tt=>Object.keys(tt).map(Number));this.inFlightDependencies.forEach(tt=>tt?.abort()),this.inFlightDependencies=[];let ne=Promise.resolve({});if(Object.keys(pe).length){let tt=new AbortController;this.inFlightDependencies.push(tt),ne=j.sendAsync({type:"GG",data:{stacks:pe,source:this.source,tileID:this.tileID,type:"glyphs"}},tt)}let ve=Object.keys(H.iconDependencies),Ve=Promise.resolve({});if(ve.length){let tt=new AbortController;this.inFlightDependencies.push(tt),Ve=j.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"icons"}},tt)}let je=Object.keys(H.patternDependencies),ct=Promise.resolve({});if(je.length){let tt=new AbortController;this.inFlightDependencies.push(tt),ct=j.sendAsync({type:"GI",data:{icons:je,source:this.source,tileID:this.tileID,type:"patterns"}},tt)}let[Ke,ht,at]=yield Promise.all([ne,Ve,ct]),Ht=new ce(Ke),Rt=new v.bo(ht,at);for(let tt in te){let gt=te[tt];gt instanceof v.a6?(Je(gt.layers,this.zoom,B),v.bp({bucket:gt,glyphMap:Ke,glyphPositions:Ht.positions,imageMap:ht,imagePositions:Rt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):gt.hasPattern&&(gt instanceof v.bq||gt instanceof v.br||gt instanceof v.bs)&&(Je(gt.layers,this.zoom,B),gt.addFeatures(H,this.tileID.canonical,Rt.patternPositions))}return this.status="done",{buckets:Object.values(te).filter(tt=>!tt.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ht.image,imageAtlas:Rt,glyphMap:this.returnDependencies?Ke:null,iconMap:this.returnDependencies?ht:null,glyphPositions:this.returnDependencies?Ht.positions:null}})}}function Je(U,A,E){let B=new v.z(A);for(let j of U)j.recalculate(B,E)}class ge{constructor(A,E,B){this.actor=A,this.layerIndex=E,this.availableImages=B,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(A,E){return v._(this,void 0,void 0,function*(){let B=yield v.l(A.request,E);try{return{vectorTile:new v.bt.VectorTile(new v.bu(B.data)),rawData:B.data,cacheControl:B.cacheControl,expires:B.expires}}catch(j){let K=new Uint8Array(B.data),J=`Unable to parse the tile at ${A.request.url}, `;throw J+=K[0]===31&&K[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${j.message}`,new Error(J)}})}loadTile(A){return v._(this,void 0,void 0,function*(){let E=A.uid,B=!!(A&&A.request&&A.request.collectResourceTiming)&&new v.bv(A.request),j=new Pe(A);this.loading[E]=j;let K=new AbortController;j.abort=K;try{let J=yield this.loadVectorTile(A,K);if(delete this.loading[E],!J)return null;let te=J.rawData,H={};J.expires&&(H.expires=J.expires),J.cacheControl&&(H.cacheControl=J.cacheControl);let le={};if(B){let ne=B.finish();ne&&(le.resourceTiming=JSON.parse(JSON.stringify(ne)))}j.vectorTile=J.vectorTile;let pe=j.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[E]=j,this.fetching[E]={rawTileData:te,cacheControl:H,resourceTiming:le};try{let ne=yield pe;return v.e({rawTileData:te.slice(0)},ne,H,le)}finally{delete this.fetching[E]}}catch(J){throw delete this.loading[E],j.status="done",this.loaded[E]=j,J}})}reloadTile(A){return v._(this,void 0,void 0,function*(){let E=A.uid;if(!this.loaded||!this.loaded[E])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let B=this.loaded[E];if(B.showCollisionBoxes=A.showCollisionBoxes,B.status==="parsing"){let j=yield B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor),K;if(this.fetching[E]){let{rawTileData:J,cacheControl:te,resourceTiming:H}=this.fetching[E];delete this.fetching[E],K=v.e({rawTileData:J.slice(0)},j,te,H)}else K=j;return K}if(B.status==="done"&&B.vectorTile)return B.parse(B.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(A){return v._(this,void 0,void 0,function*(){let E=this.loading,B=A.uid;E&&E[B]&&E[B].abort&&(E[B].abort.abort(),delete E[B])})}removeTile(A){return v._(this,void 0,void 0,function*(){this.loaded&&this.loaded[A.uid]&&delete this.loaded[A.uid]})}}class se{constructor(){this.loaded={}}loadTile(A){return v._(this,void 0,void 0,function*(){let{uid:E,encoding:B,rawImageData:j,redFactor:K,greenFactor:J,blueFactor:te,baseShift:H}=A,le=j.width+2,pe=j.height+2,ne=v.b(j)?new v.R({width:le,height:pe},yield v.bw(j,-1,-1,le,pe)):j,ve=new v.bx(E,ne,B,K,J,te,H);return this.loaded=this.loaded||{},this.loaded[E]=ve,ve})}removeTile(A){let E=this.loaded,B=A.uid;E&&E[B]&&delete E[B]}}function ur(U,A){if(U.length!==0){Ei(U[0],A);for(var E=1;E<U.length;E++)Ei(U[E],!A)}}function Ei(U,A){for(var E=0,B=0,j=0,K=U.length,J=K-1;j<K;J=j++){var te=(U[j][0]-U[J][0])*(U[J][1]+U[j][1]),H=E+te;B+=Math.abs(E)>=Math.abs(te)?E-H+te:te-H+E,E=H}E+B>=0!=!!A&&U.reverse()}var Ui=v.by(function U(A,E){var B,j=A&&A.type;if(j==="FeatureCollection")for(B=0;B<A.features.length;B++)U(A.features[B],E);else if(j==="GeometryCollection")for(B=0;B<A.geometries.length;B++)U(A.geometries[B],E);else if(j==="Feature")U(A.geometry,E);else if(j==="Polygon")ur(A.coordinates,E);else if(j==="MultiPolygon")for(B=0;B<A.coordinates.length;B++)ur(A.coordinates[B],E);return A});let pn=v.bt.VectorTileFeature.prototype.toGeoJSON;var Kr={exports:{}},so=v.bz,$i=v.bt.VectorTileFeature,pl=pr;function pr(U,A){this.options=A||{},this.features=U,this.length=U.length}function Dr(U,A){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=A||4096}pr.prototype.feature=function(U){return new Dr(this.features[U],this.options.extent)},Dr.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var A=0;A<U.length;A++){for(var E=U[A],B=[],j=0;j<E.length;j++)B.push(new so(E[j][0],E[j][1]));this.geometry.push(B)}return this.geometry},Dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,A=1/0,E=-1/0,B=1/0,j=-1/0,K=0;K<U.length;K++)for(var J=U[K],te=0;te<J.length;te++){var H=J[te];A=Math.min(A,H.x),E=Math.max(E,H.x),B=Math.min(B,H.y),j=Math.max(j,H.y)}return[A,B,E,j]},Dr.prototype.toGeoJSON=$i.prototype.toGeoJSON;var ir=v.bA,ts=pl;function zr(U){var A=new ir;return function(E,B){for(var j in E.layers)B.writeMessage(3,lo,E.layers[j])}(U,A),A.finish()}function lo(U,A){var E;A.writeVarintField(15,U.version||1),A.writeStringField(1,U.name||""),A.writeVarintField(5,U.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(E=0;E<U.length;E++)B.feature=U.feature(E),A.writeMessage(2,yt,B);var j=B.keys;for(E=0;E<j.length;E++)A.writeStringField(3,j[E]);var K=B.values;for(E=0;E<K.length;E++)A.writeMessage(4,ua,K[E])}function yt(U,A){var E=U.feature;E.id!==void 0&&A.writeVarintField(1,E.id),A.writeMessage(2,is,U),A.writeVarintField(3,E.type),A.writeMessage(4,Yr,E)}function is(U,A){var E=U.feature,B=U.keys,j=U.values,K=U.keycache,J=U.valuecache;for(var te in E.properties){var H=E.properties[te],le=K[te];if(H!==null){le===void 0&&(B.push(te),K[te]=le=B.length-1),A.writeVarint(le);var pe=typeof H;pe!=="string"&&pe!=="boolean"&&pe!=="number"&&(H=JSON.stringify(H));var ne=pe+":"+H,ve=J[ne];ve===void 0&&(j.push(H),J[ne]=ve=j.length-1),A.writeVarint(ve)}}}function li(U,A){return(A<<3)+(7&U)}function vi(U){return U<<1^U>>31}function Yr(U,A){for(var E=U.loadGeometry(),B=U.type,j=0,K=0,J=E.length,te=0;te<J;te++){var H=E[te],le=1;B===1&&(le=H.length),A.writeVarint(li(1,le));for(var pe=B===3?H.length-1:H.length,ne=0;ne<pe;ne++){ne===1&&B!==1&&A.writeVarint(li(2,pe-1));var ve=H[ne].x-j,Ve=H[ne].y-K;A.writeVarint(vi(ve)),A.writeVarint(vi(Ve)),j+=ve,K+=Ve}B===3&&A.writeVarint(li(7,1))}}function ua(U,A){var E=typeof U;E==="string"?A.writeStringField(1,U):E==="boolean"?A.writeBooleanField(7,U):E==="number"&&(U%1!=0?A.writeDoubleField(3,U):U<0?A.writeSVarintField(6,U):A.writeVarintField(5,U))}Kr.exports=zr,Kr.exports.fromVectorTileJs=zr,Kr.exports.fromGeojsonVt=function(U,A){A=A||{};var E={};for(var B in U)E[B]=new ts(U[B].features,A),E[B].name=B,E[B].version=A.version,E[B].extent=A.extent;return zr({layers:E})},Kr.exports.GeoJSONWrapper=ts;var Lr=v.by(Kr.exports);let rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:U=>U},Fn=Math.fround||(Jr=new Float32Array(1),U=>(Jr[0]=+U,Jr[0]));var Jr;let Ai=3,mr=5,pa=6;class mn{constructor(A){this.options=Object.assign(Object.create(rs),A),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(A){let{log:E,minZoom:B,maxZoom:j}=this.options;E&&console.time("total time");let K=`prepare ${A.length} points`;E&&console.time(K),this.points=A;let J=[];for(let H=0;H<A.length;H++){let le=A[H];if(!le.geometry)continue;let[pe,ne]=le.geometry.coordinates,ve=Fn(Zi(pe)),Ve=Fn(fr(ne));J.push(ve,Ve,1/0,H,-1,1),this.options.reduce&&J.push(0)}let te=this.trees[j+1]=this._createTree(J);E&&console.timeEnd(K);for(let H=j;H>=B;H--){let le=+Date.now();te=this.trees[H]=this._createTree(this._cluster(te,H)),E&&console.log("z%d: %d clusters in %dms",H,te.numItems,+Date.now()-le)}return E&&console.timeEnd("total time"),this}getClusters(A,E){let B=((A[0]+180)%360+360)%360-180,j=Math.max(-90,Math.min(90,A[1])),K=A[2]===180?180:((A[2]+180)%360+360)%360-180,J=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)B=-180,K=180;else if(B>K){let ne=this.getClusters([B,j,180,J],E),ve=this.getClusters([-180,j,K,J],E);return ne.concat(ve)}let te=this.trees[this._limitZoom(E)],H=te.range(Zi(B),fr(J),Zi(K),fr(j)),le=te.data,pe=[];for(let ne of H){let ve=this.stride*ne;pe.push(le[ve+mr]>1?Rr(le,ve,this.clusterProps):this.points[le[ve+Ai]])}return pe}getChildren(A){let E=this._getOriginId(A),B=this._getOriginZoom(A),j="No cluster with the specified id.",K=this.trees[B];if(!K)throw new Error(j);let J=K.data;if(E*this.stride>=J.length)throw new Error(j);let te=this.options.radius/(this.options.extent*Math.pow(2,B-1)),H=K.within(J[E*this.stride],J[E*this.stride+1],te),le=[];for(let pe of H){let ne=pe*this.stride;J[ne+4]===A&&le.push(J[ne+mr]>1?Rr(J,ne,this.clusterProps):this.points[J[ne+Ai]])}if(le.length===0)throw new Error(j);return le}getLeaves(A,E,B){let j=[];return this._appendLeaves(j,A,E=E||10,B=B||0,0),j}getTile(A,E,B){let j=this.trees[this._limitZoom(A)],K=Math.pow(2,A),{extent:J,radius:te}=this.options,H=te/J,le=(B-H)/K,pe=(B+1+H)/K,ne={features:[]};return this._addTileFeatures(j.range((E-H)/K,le,(E+1+H)/K,pe),j.data,E,B,K,ne),E===0&&this._addTileFeatures(j.range(1-H/K,le,1,pe),j.data,K,B,K,ne),E===K-1&&this._addTileFeatures(j.range(0,le,H/K,pe),j.data,-1,B,K,ne),ne.features.length?ne:null}getClusterExpansionZoom(A){let E=this._getOriginZoom(A)-1;for(;E<=this.options.maxZoom;){let B=this.getChildren(A);if(E++,B.length!==1)break;A=B[0].properties.cluster_id}return E}_appendLeaves(A,E,B,j,K){let J=this.getChildren(E);for(let te of J){let H=te.properties;if(H&&H.cluster?K+H.point_count<=j?K+=H.point_count:K=this._appendLeaves(A,H.cluster_id,B,j,K):K<j?K++:A.push(te),A.length===B)break}return K}_createTree(A){let E=new v.av(A.length/this.stride|0,this.options.nodeSize,Float32Array);for(let B=0;B<A.length;B+=this.stride)E.add(A[B],A[B+1]);return E.finish(),E.data=A,E}_addTileFeatures(A,E,B,j,K,J){for(let te of A){let H=te*this.stride,le=E[H+mr]>1,pe,ne,ve;if(le)pe=ma(E,H,this.clusterProps),ne=E[H],ve=E[H+1];else{let ct=this.points[E[H+Ai]];pe=ct.properties;let[Ke,ht]=ct.geometry.coordinates;ne=Zi(Ke),ve=fr(ht)}let Ve={type:1,geometry:[[Math.round(this.options.extent*(ne*K-B)),Math.round(this.options.extent*(ve*K-j))]],tags:pe},je;je=le||this.options.generateId?E[H+Ai]:this.points[E[H+Ai]].id,je!==void 0&&(Ve.id=je),J.features.push(Ve)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(Math.floor(+A),this.options.maxZoom+1))}_cluster(A,E){let{radius:B,extent:j,reduce:K,minPoints:J}=this.options,te=B/(j*Math.pow(2,E)),H=A.data,le=[],pe=this.stride;for(let ne=0;ne<H.length;ne+=pe){if(H[ne+2]<=E)continue;H[ne+2]=E;let ve=H[ne],Ve=H[ne+1],je=A.within(H[ne],H[ne+1],te),ct=H[ne+mr],Ke=ct;for(let ht of je){let at=ht*pe;H[at+2]>E&&(Ke+=H[at+mr])}if(Ke>ct&&Ke>=J){let ht,at=ve*ct,Ht=Ve*ct,Rt=-1,tt=((ne/pe|0)<<5)+(E+1)+this.points.length;for(let gt of je){let zt=gt*pe;if(H[zt+2]<=E)continue;H[zt+2]=E;let ei=H[zt+mr];at+=H[zt]*ei,Ht+=H[zt+1]*ei,H[zt+4]=tt,K&&(ht||(ht=this._map(H,ne,!0),Rt=this.clusterProps.length,this.clusterProps.push(ht)),K(ht,this._map(H,zt)))}H[ne+4]=tt,le.push(at/Ke,Ht/Ke,1/0,tt,-1,Ke),K&&le.push(Rt)}else{for(let ht=0;ht<pe;ht++)le.push(H[ne+ht]);if(Ke>1)for(let ht of je){let at=ht*pe;if(!(H[at+2]<=E)){H[at+2]=E;for(let Ht=0;Ht<pe;Ht++)le.push(H[at+Ht])}}}}return le}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,E,B){if(A[E+mr]>1){let J=this.clusterProps[A[E+pa]];return B?Object.assign({},J):J}let j=this.points[A[E+Ai]].properties,K=this.options.map(j);return B&&K===j?Object.assign({},K):K}}function Rr(U,A,E){return{type:"Feature",id:U[A+Ai],properties:ma(U,A,E),geometry:{type:"Point",coordinates:[(B=U[A],360*(B-.5)),Bn(U[A+1])]}};var B}function ma(U,A,E){let B=U[A+mr],j=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B,K=U[A+pa],J=K===-1?{}:Object.assign({},E[K]);return Object.assign(J,{cluster:!0,cluster_id:U[A+Ai],point_count:B,point_count_abbreviated:j})}function Zi(U){return U/360+.5}function fr(U){let A=Math.sin(U*Math.PI/180),E=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return E<0?0:E>1?1:E}function Bn(U){let A=(180-360*U)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function On(U,A,E,B){let j=B,K=A+(E-A>>1),J,te=E-A,H=U[A],le=U[A+1],pe=U[E],ne=U[E+1];for(let ve=A+3;ve<E;ve+=3){let Ve=co(U[ve],U[ve+1],H,le,pe,ne);if(Ve>j)J=ve,j=Ve;else if(Ve===j){let je=Math.abs(ve-K);je<te&&(J=ve,te=je)}}j>B&&(J-A>3&&On(U,A,J,B),U[J+2]=j,E-J>3&&On(U,J,E,B))}function co(U,A,E,B,j,K){let J=j-E,te=K-B;if(J!==0||te!==0){let H=((U-E)*J+(A-B)*te)/(J*J+te*te);H>1?(E=j,B=K):H>0&&(E+=J*H,B+=te*H)}return J=U-E,te=A-B,J*J+te*te}function Qr(U,A,E,B){let j={id:U??null,type:A,geometry:E,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(A==="Point"||A==="MultiPoint"||A==="LineString")fn(j,E);else if(A==="Polygon")fn(j,E[0]);else if(A==="MultiLineString")for(let K of E)fn(j,K);else if(A==="MultiPolygon")for(let K of E)fn(j,K[0]);return j}function fn(U,A){for(let E=0;E<A.length;E+=3)U.minX=Math.min(U.minX,A[E]),U.minY=Math.min(U.minY,A[E+1]),U.maxX=Math.max(U.maxX,A[E]),U.maxY=Math.max(U.maxY,A[E+1])}function gn(U,A,E,B){if(!A.geometry)return;let j=A.geometry.coordinates;if(j&&j.length===0)return;let K=A.geometry.type,J=Math.pow(E.tolerance/((1<<E.maxZoom)*E.extent),2),te=[],H=A.id;if(E.promoteId?H=A.properties[E.promoteId]:E.generateId&&(H=B||0),K==="Point")fa(j,te);else if(K==="MultiPoint")for(let le of j)fa(le,te);else if(K==="LineString")ae(j,te,J,!1);else if(K==="MultiLineString"){if(E.lineMetrics){for(let le of j)te=[],ae(le,te,J,!1),U.push(Qr(H,"LineString",te,A.properties));return}Vn(j,te,J,!1)}else if(K==="Polygon")Vn(j,te,J,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(let le of A.geometry.geometries)gn(U,{id:H,geometry:le,properties:A.properties},E,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let le of j){let pe=[];Vn(le,pe,J,!0),te.push(pe)}}U.push(Qr(H,K,te,A.properties))}function fa(U,A){A.push(ho(U[0]),pt(U[1]),0)}function ae(U,A,E,B){let j,K,J=0;for(let H=0;H<U.length;H++){let le=ho(U[H][0]),pe=pt(U[H][1]);A.push(le,pe,0),H>0&&(J+=B?(j*pe-le*K)/2:Math.sqrt(Math.pow(le-j,2)+Math.pow(pe-K,2))),j=le,K=pe}let te=A.length-3;A[2]=1,On(A,0,te,E),A[te+2]=1,A.size=Math.abs(J),A.start=0,A.end=A.size}function Vn(U,A,E,B){for(let j=0;j<U.length;j++){let K=[];ae(U[j],K,E,B),A.push(K)}}function ho(U){return U/360+.5}function pt(U){let A=Math.sin(U*Math.PI/180),E=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return E<0?0:E>1?1:E}function Lt(U,A,E,B,j,K,J,te){if(B/=A,K>=(E/=A)&&J<B)return U;if(J<E||K>=B)return null;let H=[];for(let le of U){let pe=le.geometry,ne=le.type,ve=j===0?le.minX:le.minY,Ve=j===0?le.maxX:le.maxY;if(ve>=E&&Ve<B){H.push(le);continue}if(Ve<E||ve>=B)continue;let je=[];if(ne==="Point"||ne==="MultiPoint")uo(pe,je,E,B,j);else if(ne==="LineString")_n(pe,je,E,B,j,!1,te.lineMetrics);else if(ne==="MultiLineString")ga(pe,je,E,B,j,!1);else if(ne==="Polygon")ga(pe,je,E,B,j,!0);else if(ne==="MultiPolygon")for(let ct of pe){let Ke=[];ga(ct,Ke,E,B,j,!0),Ke.length&&je.push(Ke)}if(je.length){if(te.lineMetrics&&ne==="LineString"){for(let ct of je)H.push(Qr(le.id,ne,ct,le.tags));continue}ne!=="LineString"&&ne!=="MultiLineString"||(je.length===1?(ne="LineString",je=je[0]):ne="MultiLineString"),ne!=="Point"&&ne!=="MultiPoint"||(ne=je.length===3?"Point":"MultiPoint"),H.push(Qr(le.id,ne,je,le.tags))}}return H.length?H:null}function uo(U,A,E,B,j){for(let K=0;K<U.length;K+=3){let J=U[K+j];J>=E&&J<=B&&rr(A,U[K],U[K+1],U[K+2])}}function _n(U,A,E,B,j,K,J){let te=en(U),H=j===0?po:mo,le,pe,ne=U.start;for(let Ke=0;Ke<U.length-3;Ke+=3){let ht=U[Ke],at=U[Ke+1],Ht=U[Ke+2],Rt=U[Ke+3],tt=U[Ke+4],gt=j===0?ht:at,zt=j===0?Rt:tt,ei=!1;J&&(le=Math.sqrt(Math.pow(ht-Rt,2)+Math.pow(at-tt,2))),gt<E?zt>E&&(pe=H(te,ht,at,Rt,tt,E),J&&(te.start=ne+le*pe)):gt>B?zt<B&&(pe=H(te,ht,at,Rt,tt,B),J&&(te.start=ne+le*pe)):rr(te,ht,at,Ht),zt<E&&gt>=E&&(pe=H(te,ht,at,Rt,tt,E),ei=!0),zt>B&&gt<=B&&(pe=H(te,ht,at,Rt,tt,B),ei=!0),!K&&ei&&(J&&(te.end=ne+le*pe),A.push(te),te=en(U)),J&&(ne+=le)}let ve=U.length-3,Ve=U[ve],je=U[ve+1],ct=j===0?Ve:je;ct>=E&&ct<=B&&rr(te,Ve,je,U[ve+2]),ve=te.length-3,K&&ve>=3&&(te[ve]!==te[0]||te[ve+1]!==te[1])&&rr(te,te[0],te[1],te[2]),te.length&&A.push(te)}function en(U){let A=[];return A.size=U.size,A.start=U.start,A.end=U.end,A}function ga(U,A,E,B,j,K){for(let J of U)_n(J,A,E,B,j,K,!1)}function rr(U,A,E,B){U.push(A,E,B)}function po(U,A,E,B,j,K){let J=(K-A)/(B-A);return rr(U,K,E+(j-E)*J,1),J}function mo(U,A,E,B,j,K){let J=(K-E)/(j-E);return rr(U,A+(B-A)*J,K,1),J}function ye(U,A){let E=[];for(let B=0;B<U.length;B++){let j=U[B],K=j.type,J;if(K==="Point"||K==="MultiPoint"||K==="LineString")J=Fr(j.geometry,A);else if(K==="MultiLineString"||K==="Polygon"){J=[];for(let te of j.geometry)J.push(Fr(te,A))}else if(K==="MultiPolygon"){J=[];for(let te of j.geometry){let H=[];for(let le of te)H.push(Fr(le,A));J.push(H)}}E.push(Qr(j.id,K,J,j.tags))}return E}function Fr(U,A){let E=[];E.size=U.size,U.start!==void 0&&(E.start=U.start,E.end=U.end);for(let B=0;B<U.length;B+=3)E.push(U[B]+A,U[B+1],U[B+2]);return E}function xi(U,A){if(U.transformed)return U;let E=1<<U.z,B=U.x,j=U.y;for(let K of U.features){let J=K.geometry,te=K.type;if(K.geometry=[],te===1)for(let H=0;H<J.length;H+=2)K.geometry.push(Br(J[H],J[H+1],A,E,B,j));else for(let H=0;H<J.length;H++){let le=[];for(let pe=0;pe<J[H].length;pe+=2)le.push(Br(J[H][pe],J[H][pe+1],A,E,B,j));K.geometry.push(le)}}return U.transformed=!0,U}function Br(U,A,E,B,j,K){return[Math.round(E*(U*B-j)),Math.round(E*(A*B-K))]}function yn(U,A,E,B,j){let K=A===j.maxZoom?0:j.tolerance/((1<<A)*j.extent),J={features:[],numPoints:0,numSimplified:0,numFeatures:U.length,source:null,x:E,y:B,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let te of U)we(J,te,K,j);return J}function we(U,A,E,B){let j=A.geometry,K=A.type,J=[];if(U.minX=Math.min(U.minX,A.minX),U.minY=Math.min(U.minY,A.minY),U.maxX=Math.max(U.maxX,A.maxX),U.maxY=Math.max(U.maxY,A.maxY),K==="Point"||K==="MultiPoint")for(let te=0;te<j.length;te+=3)J.push(j[te],j[te+1]),U.numPoints++,U.numSimplified++;else if(K==="LineString")et(J,j,U,E,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(let te=0;te<j.length;te++)et(J,j[te],U,E,K==="Polygon",te===0);else if(K==="MultiPolygon")for(let te=0;te<j.length;te++){let H=j[te];for(let le=0;le<H.length;le++)et(J,H[le],U,E,!0,le===0)}if(J.length){let te=A.tags||null;if(K==="LineString"&&B.lineMetrics){te={};for(let le in A.tags)te[le]=A.tags[le];te.mapbox_clip_start=j.start/j.size,te.mapbox_clip_end=j.end/j.size}let H={geometry:J,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:te};A.id!==null&&(H.id=A.id),U.features.push(H)}}function et(U,A,E,B,j,K){let J=B*B;if(B>0&&A.size<(j?J:B))return void(E.numPoints+=A.length/3);let te=[];for(let H=0;H<A.length;H+=3)(B===0||A[H+2]>J)&&(E.numSimplified++,te.push(A[H],A[H+1])),E.numPoints++;j&&function(H,le){let pe=0;for(let ne=0,ve=H.length,Ve=ve-2;ne<ve;Ve=ne,ne+=2)pe+=(H[ne]-H[Ve])*(H[ne+1]+H[Ve+1]);if(pe>0===le)for(let ne=0,ve=H.length;ne<ve/2;ne+=2){let Ve=H[ne],je=H[ne+1];H[ne]=H[ve-2-ne],H[ne+1]=H[ve-1-ne],H[ve-2-ne]=Ve,H[ve-1-ne]=je}}(te,K),U.push(te)}let Ze={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pi{constructor(A,E){let B=(E=this.options=function(K,J){for(let te in J)K[te]=J[te];return K}(Object.create(Ze),E)).debug;if(B&&console.time("preprocess data"),E.maxZoom<0||E.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(E.promoteId&&E.generateId)throw new Error("promoteId and generateId cannot be used together.");let j=function(K,J){let te=[];if(K.type==="FeatureCollection")for(let H=0;H<K.features.length;H++)gn(te,K.features[H],J,H);else gn(te,K.type==="Feature"?K:{geometry:K},J);return te}(A,E);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",E.indexMaxZoom,E.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(K,J){let te=J.buffer/J.extent,H=K,le=Lt(K,1,-1-te,te,0,-1,2,J),pe=Lt(K,1,1-te,2+te,0,-1,2,J);return(le||pe)&&(H=Lt(K,1,-te,1+te,0,-1,2,J)||[],le&&(H=ye(le,1).concat(H)),pe&&(H=H.concat(ye(pe,-1)))),H}(j,E),j.length&&this.splitTile(j,0,0,0),B&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(A,E,B,j,K,J,te){let H=[A,E,B,j],le=this.options,pe=le.debug;for(;H.length;){j=H.pop(),B=H.pop(),E=H.pop(),A=H.pop();let ne=1<<E,ve=gr(E,B,j),Ve=this.tiles[ve];if(!Ve&&(pe>1&&console.time("creation"),Ve=this.tiles[ve]=yn(A,E,B,j,le),this.tileCoords.push({z:E,x:B,y:j}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",E,B,j,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));let ei=`z${E}`;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(Ve.source=A,K==null){if(E===le.indexMaxZoom||Ve.numPoints<=le.indexMaxPoints)continue}else{if(E===le.maxZoom||E===K)continue;if(K!=null){let ei=K-E;if(B!==J>>ei||j!==te>>ei)continue}}if(Ve.source=null,A.length===0)continue;pe>1&&console.time("clipping");let je=.5*le.buffer/le.extent,ct=.5-je,Ke=.5+je,ht=1+je,at=null,Ht=null,Rt=null,tt=null,gt=Lt(A,ne,B-je,B+Ke,0,Ve.minX,Ve.maxX,le),zt=Lt(A,ne,B+ct,B+ht,0,Ve.minX,Ve.maxX,le);A=null,gt&&(at=Lt(gt,ne,j-je,j+Ke,1,Ve.minY,Ve.maxY,le),Ht=Lt(gt,ne,j+ct,j+ht,1,Ve.minY,Ve.maxY,le),gt=null),zt&&(Rt=Lt(zt,ne,j-je,j+Ke,1,Ve.minY,Ve.maxY,le),tt=Lt(zt,ne,j+ct,j+ht,1,Ve.minY,Ve.maxY,le),zt=null),pe>1&&console.timeEnd("clipping"),H.push(at||[],E+1,2*B,2*j),H.push(Ht||[],E+1,2*B,2*j+1),H.push(Rt||[],E+1,2*B+1,2*j),H.push(tt||[],E+1,2*B+1,2*j+1)}}getTile(A,E,B){A=+A,E=+E,B=+B;let j=this.options,{extent:K,debug:J}=j;if(A<0||A>24)return null;let te=1<<A,H=gr(A,E=E+te&te-1,B);if(this.tiles[H])return xi(this.tiles[H],K);J>1&&console.log("drilling down to z%d-%d-%d",A,E,B);let le,pe=A,ne=E,ve=B;for(;!le&&pe>0;)pe--,ne>>=1,ve>>=1,le=this.tiles[gr(pe,ne,ve)];return le&&le.source?(J>1&&(console.log("found parent tile z%d-%d-%d",pe,ne,ve),console.time("drilling down")),this.splitTile(le.source,pe,ne,ve,A,E,B),J>1&&console.timeEnd("drilling down"),this.tiles[H]?xi(this.tiles[H],K):null):null}}function gr(U,A,E){return 32*((1<<U)*E+A)+U}function Xe(U,A){return A?U.properties[A]:U.id}function Or(U,A){if(U==null)return!0;if(U.type==="Feature")return Xe(U,A)!=null;if(U.type==="FeatureCollection"){let E=new Set;for(let B of U.features){let j=Xe(B,A);if(j==null||E.has(j))return!1;E.add(j)}return!0}return!1}function tn(U,A){let E=new Map;if(U!=null)if(U.type==="Feature")E.set(Xe(U,A),U);else for(let B of U.features)E.set(Xe(B,A),B);return E}class vn extends ge{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(A,E){return v._(this,void 0,void 0,function*(){let B=A.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let j=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!j)return null;let K=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.X,this.length=te.length,this._features=te}feature(te){return new class{constructor(H){this._feature=H,this.extent=v.X,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){let H=[];for(let le of this._feature.geometry)H.push([new v.P(le[0],le[1])]);return H}{let H=[];for(let le of this._feature.geometry){let pe=[];for(let ne of le)pe.push(new v.P(ne[0],ne[1]));H.push(pe)}return H}}toGeoJSON(H,le,pe){return pn.call(this,H,le,pe)}}(this._features[te])}}(j.features),J=Lr(K);return J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),{vectorTile:K,rawData:J.buffer}})}loadData(A){return v._(this,void 0,void 0,function*(){var E;(E=this._pendingRequest)===null||E===void 0||E.abort();let B=!!(A&&A.request&&A.request.collectResourceTiming)&&new v.bv(A.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(A,this._pendingRequest),this._geoJSONIndex=A.cluster?new mn(function({superclusterOptions:J,clusterProperties:te}){if(!te||!J)return J;let H={},le={},pe={accumulated:null,zoom:0},ne={properties:null},ve=Object.keys(te);for(let Ve of ve){let[je,ct]=te[Ve],Ke=v.bC(ct),ht=v.bC(typeof je=="string"?[je,["accumulated"],["get",Ve]]:je);H[Ve]=Ke.value,le[Ve]=ht.value}return J.map=Ve=>{ne.properties=Ve;let je={};for(let ct of ve)je[ct]=H[ct].evaluate(pe,ne);return je},J.reduce=(Ve,je)=>{ne.properties=je;for(let ct of ve)pe.accumulated=Ve[ct],Ve[ct]=le[ct].evaluate(pe,ne)},J}(A)).load((yield this._pendingData).features):(j=yield this._pendingData,new Pi(j,A.geojsonVtOptions)),this.loaded={};let K={};if(B){let J=B.finish();J&&(K.resourceTiming={},K.resourceTiming[A.source]=JSON.parse(JSON.stringify(J)))}return K}catch(K){if(delete this._pendingRequest,v.bB(K))return{abandoned:!0};throw K}var j})}getData(){return v._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(A){let E=this.loaded;return E&&E[A.uid]?super.reloadTile(A):this.loadTile(A)}loadAndProcessGeoJSON(A,E){return v._(this,void 0,void 0,function*(){let B=yield this.loadGeoJSON(A,E);if(delete this._pendingRequest,typeof B!="object")throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(Ui(B,!0),A.filter){let j=v.bC(A.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(j.result==="error")throw new Error(j.value.map(J=>`${J.key}: ${J.message}`).join(", "));B={type:"FeatureCollection",features:B.features.filter(J=>j.value.evaluate({zoom:0},J))}}return B})}loadGeoJSON(A,E){return v._(this,void 0,void 0,function*(){let{promoteId:B}=A;if(A.request){let j=yield v.h(A.request,E);return this._dataUpdateable=Or(j.data,B)?tn(j.data,B):void 0,j.data}if(typeof A.data=="string")try{let j=JSON.parse(A.data);return this._dataUpdateable=Or(j,B)?tn(j,B):void 0,j}catch{throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`)}if(!A.dataDiff)throw new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${A.source}`);return function(j,K,J){var te,H,le,pe;if(K.removeAll&&j.clear(),K.remove)for(let ne of K.remove)j.delete(ne);if(K.add)for(let ne of K.add){let ve=Xe(ne,J);ve!=null&&j.set(ve,ne)}if(K.update)for(let ne of K.update){let ve=j.get(ne.id);if(ve==null)continue;let Ve=!ne.removeAllProperties&&(((te=ne.removeProperties)===null||te===void 0?void 0:te.length)>0||((H=ne.addOrUpdateProperties)===null||H===void 0?void 0:H.length)>0);if((ne.newGeometry||ne.removeAllProperties||Ve)&&(ve=Object.assign({},ve),j.set(ne.id,ve),Ve&&(ve.properties=Object.assign({},ve.properties))),ne.newGeometry&&(ve.geometry=ne.newGeometry),ne.removeAllProperties)ve.properties={};else if(((le=ne.removeProperties)===null||le===void 0?void 0:le.length)>0)for(let je of ne.removeProperties)Object.prototype.hasOwnProperty.call(ve.properties,je)&&delete ve.properties[je];if(((pe=ne.addOrUpdateProperties)===null||pe===void 0?void 0:pe.length)>0)for(let{key:je,value:ct}of ne.addOrUpdateProperties)ve.properties[je]=ct}}(this._dataUpdateable,A.dataDiff,B),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(A){return v._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(A){return this._geoJSONIndex.getClusterExpansionZoom(A.clusterId)}getClusterChildren(A){return this._geoJSONIndex.getChildren(A.clusterId)}getClusterLeaves(A){return this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset)}}class Vr{constructor(A){this.self=A,this.actor=new v.F(A),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(E,B)=>{if(this.externalWorkerSourceTypes[E])throw new Error(`Worker source with name "${E}" already registered.`);this.externalWorkerSourceTypes[E]=B},this.self.addProtocol=v.bi,this.self.removeProtocol=v.bj,this.self.registerRTLTextPlugin=E=>{if(v.bD.isParsed())throw new Error("RTL text plugin already registered.");v.bD.setMethods(E)},this.actor.registerMessageHandler("LDT",(E,B)=>this._getDEMWorkerSource(E,B.source).loadTile(B)),this.actor.registerMessageHandler("RDT",(E,B)=>v._(this,void 0,void 0,function*(){this._getDEMWorkerSource(E,B.source).removeTile(B)})),this.actor.registerMessageHandler("GCEZ",(E,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterExpansionZoom(B)})),this.actor.registerMessageHandler("GCC",(E,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterChildren(B)})),this.actor.registerMessageHandler("GCL",(E,B)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(E,B.type,B.source).getClusterLeaves(B)})),this.actor.registerMessageHandler("LD",(E,B)=>this._getWorkerSource(E,B.type,B.source).loadData(B)),this.actor.registerMessageHandler("GD",(E,B)=>this._getWorkerSource(E,B.type,B.source).getData()),this.actor.registerMessageHandler("LT",(E,B)=>this._getWorkerSource(E,B.type,B.source).loadTile(B)),this.actor.registerMessageHandler("RT",(E,B)=>this._getWorkerSource(E,B.type,B.source).reloadTile(B)),this.actor.registerMessageHandler("AT",(E,B)=>this._getWorkerSource(E,B.type,B.source).abortTile(B)),this.actor.registerMessageHandler("RMT",(E,B)=>this._getWorkerSource(E,B.type,B.source).removeTile(B)),this.actor.registerMessageHandler("RS",(E,B)=>v._(this,void 0,void 0,function*(){if(!this.workerSources[E]||!this.workerSources[E][B.type]||!this.workerSources[E][B.type][B.source])return;let j=this.workerSources[E][B.type][B.source];delete this.workerSources[E][B.type][B.source],j.removeSource!==void 0&&j.removeSource(B)})),this.actor.registerMessageHandler("RM",E=>v._(this,void 0,void 0,function*(){delete this.layerIndexes[E],delete this.availableImages[E],delete this.workerSources[E],delete this.demWorkerSources[E]})),this.actor.registerMessageHandler("SR",(E,B)=>v._(this,void 0,void 0,function*(){this.referrer=B})),this.actor.registerMessageHandler("SRPS",(E,B)=>this._syncRTLPluginState(E,B)),this.actor.registerMessageHandler("IS",(E,B)=>v._(this,void 0,void 0,function*(){this.self.importScripts(B)})),this.actor.registerMessageHandler("SI",(E,B)=>this._setImages(E,B)),this.actor.registerMessageHandler("UL",(E,B)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(E).update(B.layers,B.removedIds)})),this.actor.registerMessageHandler("SL",(E,B)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(E).replace(B)}))}_setImages(A,E){return v._(this,void 0,void 0,function*(){this.availableImages[A]=E;for(let B in this.workerSources[A]){let j=this.workerSources[A][B];for(let K in j)j[K].availableImages=E}})}_syncRTLPluginState(A,E){return v._(this,void 0,void 0,function*(){if(v.bD.isParsed())return v.bD.getState();if(E.pluginStatus!=="loading")return v.bD.setState(E),E;let B=E.pluginURL;if(this.self.importScripts(B),v.bD.isParsed()){let j={pluginStatus:"loaded",pluginURL:B};return v.bD.setState(j),j}throw v.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${B}`)})}_getAvailableImages(A){let E=this.availableImages[A];return E||(E=[]),E}_getLayerIndex(A){let E=this.layerIndexes[A];return E||(E=this.layerIndexes[A]=new c),E}_getWorkerSource(A,E,B){if(this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][E]||(this.workerSources[A][E]={}),!this.workerSources[A][E][B]){let j={sendAsync:(K,J)=>(K.targetMapId=A,this.actor.sendAsync(K,J))};switch(E){case"vector":this.workerSources[A][E][B]=new ge(j,this._getLayerIndex(A),this._getAvailableImages(A));break;case"geojson":this.workerSources[A][E][B]=new vn(j,this._getLayerIndex(A),this._getAvailableImages(A));break;default:this.workerSources[A][E][B]=new this.externalWorkerSourceTypes[E](j,this._getLayerIndex(A),this._getAvailableImages(A))}}return this.workerSources[A][E][B]}_getDEMWorkerSource(A,E){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][E]||(this.demWorkerSources[A][E]=new se),this.demWorkerSources[A][E]}}return v.i(self)&&(self.worker=new Vr(self)),Vr}),y("index",["exports","./shared"],function(v,c){"use strict";var ce="4.7.1";let Pe,Je,ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((e,n)=>{let o=requestAnimationFrame(e);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(o),n(c.c())})}),getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){let e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(Pe||(Pe=document.createElement("a")),Pe.href=d,Pe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Je==null&&(Je=matchMedia("(prefers-reduced-motion: reduce)")),Je.matches)}};class se{static testProp(e){if(!se.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in se.docStyle)return e[n];return e[0]}static create(e,n,o){let s=window.document.createElement(e);return n!==void 0&&(s.className=n),o&&o.appendChild(s),s}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){se.docStyle&&se.selectProp&&(se.userSelect=se.docStyle[se.selectProp],se.docStyle[se.selectProp]="none")}static enableDrag(){se.docStyle&&se.selectProp&&(se.docStyle[se.selectProp]=se.userSelect)}static setTransform(e,n){e.style[se.transformProp]=n}static addEventListener(e,n,o,s={}){e.addEventListener(n,o,"passive"in s?s:s.capture)}static removeEventListener(e,n,o,s={}){e.removeEventListener(n,o,"passive"in s?s:s.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",se.suppressClickInternal,!0)},0)}static getScale(e){let n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,o){let s=n.boundingClientRect;return new c.P((o.clientX-s.left)/n.x-e.clientLeft,(o.clientY-s.top)/n.y-e.clientTop)}static mousePos(e,n){let o=se.getScale(e);return se.getPoint(e,o,n)}static touchPos(e,n){let o=[],s=se.getScale(e);for(let h=0;h<n.length;h++)o.push(se.getPoint(e,s,n[h]));return o}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,se.selectProp=se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),se.transformProp=se.testProp(["transform","WebkitTransform"]);let ur={supported:!1,testSupport:function(d){!pn&&Ui&&(Kr?so(d):Ei=d)}},Ei,Ui,pn=!1,Kr=!1;function so(d){let e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,Ui),d.isContextLost())return;ur.supported=!0}catch{}d.deleteTexture(e),pn=!0}var $i;typeof document<"u"&&(Ui=document.createElement("img"),Ui.onload=()=>{Ei&&so(Ei),Ei=null,Kr=!0},Ui.onerror=()=>{pn=!0,Ei=null},Ui.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,o,s;d.resetRequestQueue=()=>{e=[],n=0,o=0,s={}},d.addThrottleControl=x=>{let k=o++;return s[k]=x,k},d.removeThrottleControl=x=>{delete s[x],f()},d.getImage=(x,k,M=!0)=>new Promise((I,z)=>{ur.supported&&(x.headers||(x.headers={}),x.headers.accept="image/webp,*/*"),c.e(x,{type:"image"}),e.push({abortController:k,requestParameters:x,supportImageRefresh:M,state:"queued",onError:F=>{z(F)},onSuccess:F=>{I(F)}}),f()});let h=x=>c._(this,void 0,void 0,function*(){x.state="running";let{requestParameters:k,supportImageRefresh:M,onError:I,onSuccess:z,abortController:F}=x,O=M===!1&&!c.i(self)&&!c.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((G,W)=>G&&W==="accept",!0));n++;let q=O?_(k,F):c.m(k,F);try{let G=yield q;delete x.abortController,x.state="completed",G.data instanceof HTMLImageElement||c.b(G.data)?z(G):G.data&&z({data:yield(Z=G.data,typeof createImageBitmap=="function"?c.d(Z):c.f(Z)),cacheControl:G.cacheControl,expires:G.expires})}catch(G){delete x.abortController,I(G)}finally{n--,f()}var Z}),f=()=>{let x=(()=>{for(let k of Object.keys(s))if(s[k]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=n;k<x&&e.length>0;k++){let M=e.shift();M.abortController.signal.aborted?k--:h(M)}},_=(x,k)=>new Promise((M,I)=>{let z=new Image,F=x.url,O=x.credentials;O&&O==="include"?z.crossOrigin="use-credentials":(O&&O==="same-origin"||!c.s(F))&&(z.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{z.src="",I(c.c())}),z.fetchPriority="high",z.onload=()=>{z.onerror=z.onload=null,M({data:z})},z.onerror=()=>{z.onerror=z.onload=null,k.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},z.src=F})}($i||($i={})),$i.resetRequestQueue();class pl{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function pr(d){var e=new c.A(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var Dr,ir=function(d,e,n){return d[0]=e[0]-n[0],d[1]=e[1]-n[1],d[2]=e[2]-n[2],d};Dr=new c.A(3),c.A!=Float32Array&&(Dr[0]=0,Dr[1]=0,Dr[2]=0);var ts=function(d){var e=d[0],n=d[1];return e*e+n*n};function zr(d){let e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){let n=[];for(let{id:o,url:s}of d){let h=`${o}${s}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:o,url:s}))}}return e}function lo(d,e,n){let o=d.split("?");return o[0]+=`${e}${n}`,o.join("?")}(function(){var d=new c.A(2);c.A!=Float32Array&&(d[0]=0,d[1]=0)})();class yt{constructor(e,n,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,o){let{width:s,height:h}=e,f=!(this.size&&this.size[0]===s&&this.size[1]===h||o),{context:_}=this,{gl:x}=_;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[s,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,s,h,0,this.format,x.UNSIGNED_BYTE,e.data);else{let{x:k,y:M}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?x.texSubImage2D(x.TEXTURE_2D,0,k,M,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,k,M,s,h,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(e,n,o){let{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),o!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function is(d){let{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class li extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:n,promiseResolve:o}of this.requestors)o(this._getImagesForIds(n));this.requestors=[]}}getImage(e){let n=this.images[e];if(n&&!n.data&&n.spriteData){let o=n.spriteData;n.data=new c.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let o=!0,s=n.data||n.spriteData;return this._validateStretch(n.stretchX,s&&s.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,s&&s.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),o=!1),o}_validateStretch(e,n){if(!e)return!0;let o=0;for(let s of e){if(s[0]<o||s[1]<s[0]||n<s[1])return!1;o=s[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;let o=n.spriteData,s=o&&o.width||n.data.width,h=o&&o.height||n.data.height;return!(e[0]<0||s<e[0]||e[1]<0||h<e[1]||e[2]<0||s<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,o=!0){let s=this.getImage(e);if(o&&(s.data.width!==n.data.width||s.data.height!==n.data.height))throw new Error(`size mismatch between old image (${s.data.width}x${s.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=s.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){let n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,o)=>{let s=!0;if(!this.isLoaded())for(let h of e)this.images[h]||(s=!1);this.isLoaded()||s?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){let n={};for(let o of e){let s=this.getImage(o);s||(this.fire(new c.k("styleimagemissing",{id:o})),s=this.getImage(o)),s?n[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,textFitWidth:s.textFitWidth,textFitHeight:s.textFitHeight,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:c.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){let{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){let n=this.patterns[e],o=this.getImage(e);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{let s={w:o.data.width+2,h:o.data.height+2,x:0,y:0},h=new c.I(s,o);this.patterns[e]={bin:s,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new yt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let h in this.patterns)e.push(this.patterns[h].bin);let{w:n,h:o}=c.p(e),s=this.atlasImage;s.resize({width:n||1,height:o||1});for(let h in this.patterns){let{bin:f}=this.patterns[h],_=f.x+1,x=f.y+1,k=this.getImage(h).data,M=k.width,I=k.height;c.R.copy(k,s,{x:0,y:0},{x:_,y:x},{width:M,height:I}),c.R.copy(k,s,{x:0,y:I-1},{x:_,y:x-1},{width:M,height:1}),c.R.copy(k,s,{x:0,y:0},{x:_,y:x+I},{width:M,height:1}),c.R.copy(k,s,{x:M-1,y:0},{x:_-1,y:x},{width:1,height:I}),c.R.copy(k,s,{x:0,y:0},{x:_+M,y:x},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;let o=this.getImage(n);o||c.w(`Image with ID: "${n}" was not found`),is(o)&&this.updateImage(n,o)}}}let vi=1e20;function Yr(d,e,n,o,s,h,f,_,x){for(let k=e;k<e+o;k++)ua(d,n*h+k,h,s,f,_,x);for(let k=n;k<n+s;k++)ua(d,k*h+e,1,o,f,_,x)}function ua(d,e,n,o,s,h,f){h[0]=0,f[0]=-vi,f[1]=vi,s[0]=d[e];for(let _=1,x=0,k=0;_<o;_++){s[_]=d[e+_*n];let M=_*_;do{let I=h[x];k=(s[_]-s[I]+M-I*I)/(_-I)/2}while(k<=f[x]&&--x>-1);x++,h[x]=_,f[x]=k,f[x+1]=vi}for(let _=0,x=0;_<o;_++){for(;f[x+1]<_;)x++;let k=h[x],M=_-k;d[e+_*n]=s[k]+M*M}}class Lr{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){let n=[];for(let h in e)for(let f of e[h])n.push(this._getAndCacheGlyphsPromise(h,f));let o=yield Promise.all(n),s={};for(let{stack:h,id:f,glyph:_}of o)s[h]||(s[h]={}),s[h][f]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return s})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let o=this.entries[e];o||(o=this.entries[e]={glyphs:{},requests:{},ranges:{}});let s=o.glyphs[n];if(s!==void 0)return{stack:e,id:n,glyph:s};if(s=this._tinySDF(o,e,n),s)return o.glyphs[n]=s,{stack:e,id:n,glyph:s};let h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(o.ranges[h])return{stack:e,id:n,glyph:s};if(!this.url)throw new Error("glyphsUrl is not set");if(!o.requests[h]){let _=Lr.loadGlyphRange(e,h,this.url,this.requestManager);o.requests[h]=_}let f=yield o.requests[h];for(let _ in f)this._doesCharSupportLocalGlyph(+_)||(o.glyphs[+_]=f[+_]);return o.ranges[h]=!0,{stack:e,id:n,glyph:f[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,o){let s=this.localIdeographFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),h=e.tinySDF=new Lr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:s,fontWeight:_})}let f=h.draw(String.fromCharCode(o));return{id:o,bitmap:new c.o({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}Lr.loadGlyphRange=function(d,e,n,o){return c._(this,void 0,void 0,function*(){let s=256*e,h=s+255,f=o.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${s}-${h}`),"Glyphs"),_=yield c.l(f,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${e}, ${s}-${h}`);let x={};for(let k of c.n(_.data))x[k.id]=k;return x})},Lr.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:h="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let _=this.size=d+4*e,x=this._createCanvas(_),k=this.ctx=x.getContext("2d",{willReadFrequently:!0});k.font=`${f} ${h} ${d}px ${s}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(d){let e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:h}=this.ctx.measureText(d),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-s))),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),k=_+2*this.buffer,M=x+2*this.buffer,I=Math.max(k*M,0),z=new Uint8ClampedArray(I),F={data:z,width:k,height:M,glyphWidth:_,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return F;let{ctx:O,buffer:q,gridInner:Z,gridOuter:G}=this;O.clearRect(q,q,_,x),O.fillText(d,q,q+f);let W=O.getImageData(q,q,_,x);G.fill(vi,0,I),Z.fill(0,0,I);for(let V=0;V<x;V++)for(let Y=0;Y<_;Y++){let Q=W.data[4*(V*_+Y)+3]/255;if(Q===0)continue;let re=(V+q)*k+Y+q;if(Q===1)G[re]=0,Z[re]=vi;else{let ue=.5-Q;G[re]=ue>0?ue*ue:0,Z[re]=ue<0?ue*ue:0}}Yr(G,0,0,k,M,k,this.f,this.v,this.z),Yr(Z,q,q,_,x,k,this.f,this.v,this.z);for(let V=0;V<I;V++){let Y=Math.sqrt(G[V])-Math.sqrt(Z[V]);z[V]=Math.round(255-255*(Y/this.radius+this.cutoff))}return F}};class rs{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,o){return{x:c.y.number(e.x,n.x,o),y:c.y.number(e.y,n.y,o),z:c.y.number(e.z,n.z,o)}}}let Fn;class Jr extends c.E{constructor(e){super(),Fn=Fn||new c.q({anchor:new c.D(c.v.light.anchor),position:new rs,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Fn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o){return(!o||o.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}let Ai=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class mr extends c.E{constructor(e){super(),this._transitionable=new c.T(Ai),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o={}){return o?.validate!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class pa{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){let o=e.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(e,n)),this.dashEntry[o]}getDashRanges(e,n,o){let s=[],h=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,_=!0;s.push({left:h,right:f,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let k=1;k<e.length;k++){_=!_;let M=e[k];h=x*o,x+=M,f=x*o,s.push({left:h,right:f,isDash:_,zeroLength:M===0})}return s}addRoundDash(e,n,o){let s=n/2;for(let h=-o;h<=o;h++){let f=this.width*(this.nextRow+o+h),_=0,x=e[_];for(let k=0;k<this.width;k++){k/x.right>1&&(x=e[++_]);let M=Math.abs(k-x.left),I=Math.abs(k-x.right),z=Math.min(M,I),F,O=h/o*(s+1);if(x.isDash){let q=s-Math.abs(O);F=Math.sqrt(z*z+q*q)}else F=s-Math.sqrt(z*z+O*O);this.data[f+k]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e){for(let _=e.length-1;_>=0;--_){let x=e[_],k=e[_+1];x.zeroLength?e.splice(_,1):k&&k.isDash===x.isDash&&(k.left=x.left,e.splice(_,1))}let n=e[0],o=e[e.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);let s=this.width*this.nextRow,h=0,f=e[h];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++h]);let x=Math.abs(_-f.left),k=Math.abs(_-f.right),M=Math.min(x,k);this.data[s+_]=Math.max(0,Math.min(255,(f.isDash?M:-M)+128))}}addDash(e,n){let o=n?7:0,s=2*o+1;if(this.nextRow+s>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let _=0;_<e.length;_++)h+=e[_];if(h!==0){let _=this.width/h,x=this.getDashRanges(e,this.width,_);n?this.addRoundDash(x,_,o):this.addRegularDash(x)}let f={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:h};return this.nextRow+=s,this.dirty=!0,f}bind(e){let n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}let mn="maplibre_preloaded_worker_pool";class Rr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mn]}numActive(){return Object.keys(this.active).length}}let ma=Math.floor(ge.hardwareConcurrency/2),Zi,fr;function Bn(){return Zi||(Zi=new Rr),Zi}Rr.workerCount=c.C(globalThis)?Math.max(Math.min(ma,3),1):1;class On{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;let o=this.workerPool.acquire(n);for(let s=0;s<o.length;s++){let h=new c.F(o[s],n);h.name=`Worker ${s}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){let o=[];for(let s of this.actors)o.push(s.sendAsync({type:e,data:n}));return Promise.all(o)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(let o of this.actors)o.registerMessageHandler(e,n)}}function co(){return fr||(fr=new On(Bn(),c.G),fr.registerMessageHandler("GR",(d,e,n)=>c.m(e,n))),fr}function Qr(d,e){let n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*d.width,.5*d.height,1]),c.L(n,n,d.calculatePosMatrix(e.toUnwrapped()))}function fn(d,e,n,o,s,h){let f=function(I,z,F){if(I)for(let O of I){let q=z[O];if(q&&q.source===F&&q.type==="fill-extrusion")return!0}else for(let O in z){let q=z[O];if(q.source===F&&q.type==="fill-extrusion")return!0}return!1}(s&&s.layers,e,d.id),_=h.maxPitchScaleFactor(),x=d.tilesIn(o,_,f);x.sort(gn);let k=[];for(let I of x)k.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(e,n,d._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,s,h,_,Qr(d.transform,I.tileID))});let M=function(I){let z={},F={};for(let O of I){let q=O.queryResults,Z=O.wrappedTileID,G=F[Z]=F[Z]||{};for(let W in q){let V=q[W],Y=G[W]=G[W]||{},Q=z[W]=z[W]||[];for(let re of V)Y[re.featureIndex]||(Y[re.featureIndex]=!0,Q.push(re))}}return z}(k);for(let I in M)M[I].forEach(z=>{let F=z.feature,O=d.getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=O});return M}function gn(d,e){let n=d.tileID,o=e.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}function fa(d,e,n){return c._(this,void 0,void 0,function*(){let o=d;if(d.url?o=(yield c.h(e.transformRequest(d.url,"Source"),n)).data:yield ge.frameAsync(n),!o)return null;let s=c.M(c.e(o,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in o&&o.vector_layers&&(s.vectorLayerIds=o.vector_layers.map(h=>h.id)),s})}class ae{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){let n=this._sw,o=this._ne,s,h;if(e instanceof c.N)s=e,h=e;else{if(!(e instanceof ae))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ae.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(s=e._sw,h=e._ne,!s||!h)return this}return n||o?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new c.N(s.lng,s.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=c.N.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return e instanceof ae?e:e&&new ae(e)}static fromLngLat(e,n=0){let o=360*n/40075017,s=o/Math.cos(Math.PI/180*e.lat);return new ae(new c.N(e.lng-s,e.lat-o),new c.N(e.lng+s,e.lat+o))}adjustAntiMeridian(){let e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new ae(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class Vn{constructor(e,n,o){this.bounds=ae.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),o=Math.floor(c.O(this.bounds.getWest())*n),s=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),f=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=o&&e.x<h&&e.y>=s&&e.y<f}}class ho extends c.E{constructor(e,n,o,s){if(super(),this.id=e,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield fa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Vn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request.collectResourceTiming=this._collectResourceTiming;let s="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,f)=>{e.reloadPromise={resolve:h,reject:f}})}else e.actor=this.dispatcher.getActor(),s="LT";e.abortController=new AbortController;try{let h=yield e.actor.sendAsync({type:s,data:o},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){let o=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(o.resolve).catch(o.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pt extends c.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield fa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Vn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let o=yield $i.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});let s=this.map.painter.context,h=s.gl,f=o.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new yt(s,f,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Lt extends pt{constructor(e,n,o,s){super(e,n,o,s),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let s=yield $i.getImage(o,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){let h=s.data;this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let f=c.b(h)&&c.U()?h:yield this.readImageNow(h),_={type:this.type,uid:e.uid,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let x=yield e.actor.sendAsync({type:"LDT",data:_});e.dem=x,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){let n=e.width+2,o=e.height+2;try{return new c.R({width:n,height:o},yield c.W(e,-1,-1,n,o))}catch{}}return ge.getImageData(e,1)})}_getNeighboringTiles(e){let n=e.canonical,o=Math.pow(2,n.z),s=(n.x-1+o)%o,h=n.x===0?e.wrap-1:e.wrap,f=(n.x+1+o)%o,_=n.x+1===o?e.wrap+1:e.wrap,x={};return x[new c.S(e.overscaledZ,h,n.z,s,n.y).key]={backfilled:!1},x[new c.S(e.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(x[new c.S(e.overscaledZ,h,n.z,s,n.y-1).key]={backfilled:!1},x[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},x[new c.S(e.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(x[new c.S(e.overscaledZ,h,n.z,s,n.y+1).key]={backfilled:!1},x[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},x[new c.S(e.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1}),x}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class uo extends c.E{constructor(e,n,o,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(s),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){let e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,o){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:o}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){let n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(ge.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{let o=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||o.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let s=null;o.resourceTiming&&o.resourceTiming[this.id]&&(s=o.resourceTiming[this.id].slice(0));let h={dataType:"source"};this._collectResourceTiming&&s&&s.length>0&&c.e(h,{resourceTiming:s}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(o){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(o))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){let n=e.actor?"RT":"LT";e.actor=this.actor;let o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;let s=yield this.actor.sendAsync({type:n,data:o},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(s,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var _n=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class en extends c.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let n=yield $i.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let n=e.map(c.Z.fromLngLat);this.tileID=function(s){let h=1/0,f=1/0,_=-1/0,x=-1/0;for(let z of s)h=Math.min(h,z.x),f=Math.min(f,z.y),_=Math.max(_,z.x),x=Math.max(x,z.y);let k=Math.max(_-h,x-f),M=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),I=Math.pow(2,M);return new c.a1(M,Math.floor((h+_)/2*I),Math.floor((f+x)/2*I))}(n),this.minzoom=this.maxzoom=this.tileID.z;let o=n.map(s=>this.tileID.getTilePoint(s)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,c.X,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,c.X),this._boundsArray.emplaceBack(o[2].x,o[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new yt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let h=this.tiles[s];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ga extends en{constructor(e,n,o,s){super(e,n,o,s),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{let n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new yt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let h=this.tiles[s];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class rr extends en{constructor(e,n,o,s){super(e,n,o,s),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(f=>typeof f!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new yt(n,this.canvas,o.RGBA,{premultiply:!0});let s=!1;for(let h in this.tiles){let f=this.tiles[h];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,s=!0)}s&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let po={},mo=d=>{switch(d){case"geojson":return uo;case"image":return en;case"raster":return pt;case"raster-dem":return Lt;case"vector":return ho;case"video":return ga;case"canvas":return rr}return po[d]},ye="RTLPluginLoaded";class Fr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=co()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,o=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!o)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ye))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xi=null;function Br(){return xi||(xi=new Fr),xi}class yn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,h){let f={};if(!h)return f;for(let _ of s){let x=_.layerIds.map(k=>h.getLayer(k)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(k=>x.filter(M=>M.id===k)[0]));for(let k of x)f[k.id]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let h=this.buckets[s];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!o)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let h=this.buckets[s];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,Br().lazyLoad();break}}this.queryPadding=0;for(let s in this.buckets){let h=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(s).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let o in this.buckets){let s=this.buckets[o];s.uploadPending()&&s.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,s,h,f,_,x,k,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:h,scale:f,tileSize:this.tileSize,pixelPosMatrix:M,transform:x,params:_,queryPadding:this.queryPadding*k},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let s=o.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",f=s._geojsonTileLayer||s[h];if(!f)return;let _=c.a7(n&&n.filter),{z:x,x:k,y:M}=this.tileID.canonical,I={z:x,x:k,y:M};for(let z=0;z<f.length;z++){let F=f.feature(z);if(_.needGeometry){let Z=c.a8(F,!0);if(!_.filter(new c.z(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!_.filter(new c.z(this.tileID.overscaledZ),F))continue;let O=o.getId(F,h),q=new c.a9(F,x,k,M,O);q.tile=I,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=c.aa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),s=!1;if(this.expirationTime>o)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let h=this.expirationTime-n;h?this.expirationTime=o+Math.max(h,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let o=this.latestFeatureIndex.loadVTLayers();for(let s in this.buckets){if(!n.style.hasLayer(s))continue;let h=this.buckets[s],f=h.layers[0].sourceLayer||"_geojsonTileLayer",_=o[f],x=e[f];if(!_||!x||Object.keys(x).length===0)continue;h.update(x,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});let k=n&&n.style&&n.style.getLayer(s);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ge.now()+e}setDependencies(e,n){let o={};for(let s of n)o[s]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let s=this.dependencies[o];if(s){for(let h of n)if(s[h])return!0}}return!1}}class we{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let h={value:n,timeout:void 0};if(o!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},o)),this.data[s].push(h),this.order.push(s),this.order.length>this.max){let f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,s=n===void 0?0:this.data[o].indexOf(n),h=this.data[o][s];return this.data[o].splice(s,1),h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(h.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let s of this.data[o])e(s.value)||n.push(s);for(let o of n)this.remove(o.value.tileID,o)}}class et{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},c.e(this.stateChanges[e][s],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let h in this.state[e])h!==s&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let h in this.state[e][s])o[h]||(this.deletedStates[e][s][h]=null)}else for(let h in o)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][h]===null&&delete this.deletedStates[e][s][h]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(o in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][o]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),s=c.e({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let h=this.deletedStates[e][n];if(h===null)return{};for(let f in h)delete s[f]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let h={};for(let f in this.stateChanges[s])this.state[s][f]||(this.state[s][f]={}),c.e(this.state[s][f],this.stateChanges[s][f]),h[f]=this.state[s][f];o[s]=h}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let h={};if(this.deletedStates[s]===null)for(let f in this.state[s])h[f]={},this.state[s][f]={};else for(let f in this.deletedStates[s]){if(this.deletedStates[s][f]===null)this.state[s][f]={};else for(let _ of Object.keys(this.deletedStates[s][f]))delete this.state[s][f][_];h[f]=this.state[s][f]}o[s]=o[s]||{},c.e(o[s],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let s in e)e[s].setFeatureState(o,n)}}class Ze extends c.E{constructor(e,n,o){super(),this.id=e,this.dispatcher=o,this.on("data",s=>this._dataHandler(s)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((s,h,f,_)=>{let x=new(mo(h.type))(s,h,f,_);if(x.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${x.id}`);return x})(e,n,o,this),this._tiles={},this._cache=new we(0,s=>this._unloadTile(s)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new et,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,o){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,o)}catch(s){e.state="errored",s.status!==404?this._source.fire(new c.j(s,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Pi).map(e=>e.key)}getRenderableIds(e){let n=[];for(let o in this._tiles)this._isIdRenderable(o,e)&&n.push(this._tiles[o]);return e?n.sort((o,s)=>{let h=o.tileID,f=s.tileID,_=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),x=new c.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-f.overscaledZ||x.y-_.y||x.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Pi).map(o=>o.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),yield this._loadTile(o,e,n))})}_tileLoaded(e,n,o){e.timeAdded=ge.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let h=n[s];if(e.neighboringTiles&&e.neighboringTiles[h]){let f=this.getTileByID(h);o(e,f),o(f,e)}}function o(s,h){s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0;let f=h.tileID.canonical.x-s.tileID.canonical.x,_=h.tileID.canonical.y-s.tileID.canonical.y,x=Math.pow(2,s.tileID.canonical.z),k=h.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+x)===1?f+=x:Math.abs(f-x)===1&&(f-=x)),h.dem&&s.dem&&(s.dem.backfillBorder(h.dem,f,_),s.neighboringTiles&&s.neighboringTiles[k]&&(s.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,s){for(let h in this._tiles){let f=this._tiles[h];if(s[h]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){let k=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[k.key],f&&f.hasData()&&(_=k)}let x=_;for(;x.overscaledZ>n;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){s[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let s=e.scaledTo(o),h=this._getLoadedTile(s);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let n=Math.ceil(e.width/this._source.tileSize)+1,o=Math.ceil(e.height/this._source.tileSize)+1,s=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(h)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let s in this._tiles){let h=this._tiles[s];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),o[h.tileID.key]=h}this._tiles=o;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}}_updateCoveredAndRetainedTiles(e,n,o,s,h,f){let _={},x={},k=Object.keys(e),M=ge.now();for(let I of k){let z=e[I],F=this._tiles[I];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=M)continue;let O=this.findLoadedParent(z,n),q=this.findLoadedSibling(z),Z=O||q||null;Z&&(this._addTile(Z.tileID),_[Z.tileID.key]=Z.tileID),x[I]=z}this._retainLoadedChildren(x,s,o,e);for(let I in _)e[I]||(this._coveredTiles[I]=!0,e[I]=_[I]);if(f){let I={},z={};for(let F of h)this._tiles[F.key].hasData()?I[F.key]=F:z[F.key]=F;for(let F in z){let O=z[F].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(I[O[0].key]=e[O[0].key]=O[0],I[O[1].key]=e[O[1].key]=O[1],I[O[2].key]=e[O[2].key]=O[2],I[O[3].key]=e[O[3].key]=O[3],delete z[F])}for(let F in z){let O=z[F],q=this.findLoadedParent(O,this._source.minzoom),Z=this.findLoadedSibling(O),G=q||Z||null;if(G){I[G.tileID.key]=e[G.tileID.key]=G.tileID;for(let W in I)I[W].isChildOf(G.tileID)&&delete I[W]}}for(let F in this._tiles)I[F]||(this._coveredTiles[F]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let o;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(o=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(M=>this._source.hasTile(M)))):o=[];let s=e.coveringZoomLevel(this._source),h=Math.max(s-Ze.maxOverzooming,this._source.minzoom),f=Math.max(s+Ze.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let M={};for(let I of o)if(I.canonical.z>this._source.minzoom){let z=I.scaledTo(I.canonical.z-1);M[z.key]=z;let F=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));M[F.key]=F}o=o.concat(Object.values(M))}let _=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let x=this._updateRetainedTiles(o,s);gr(this._source.type)&&this._updateCoveredAndRetainedTiles(x,h,f,s,o,n);for(let M in x)this._tiles[M].clearFadeHold();let k=c.ab(this._tiles,x);for(let M of k){let I=this._tiles[M];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var o;let s={},h={},f=Math.max(n-Ze.maxOverzooming,this._source.minzoom),_=Math.max(n+Ze.maxUnderzooming,this._source.minzoom),x={};for(let k of e){let M=this._addTile(k);s[k.key]=k,M.hasData()||n<this._source.maxzoom&&(x[k.key]=k)}this._retainLoadedChildren(x,n,_,s);for(let k of e){let M=this._tiles[k.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){let z=k.children(this._source.maxzoom)[0],F=this.getTile(z);if(F&&F.hasData()){s[z.key]=z;continue}}else{let z=k.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let I=M.wasRequested();for(let z=k.overscaledZ-1;z>=f;--z){let F=k.scaledTo(z);if(h[F.key])break;if(h[F.key]=!0,M=this.getTile(F),!M&&I&&(M=this._addTile(F)),M){let O=M.hasData();if((O||!(!((o=this.map)===null||o===void 0)&&o.cancelPendingTileRequestsWhileZooming)||I)&&(s[F.key]=F),I=M.wasRequested(),O)break}}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){o=this._loadedParentTiles[s.key];break}n.push(s.key);let h=s.scaledTo(s.overscaledZ-1);if(o=this._getLoadedTile(h),o)break;s=h}for(let h of n)this._loadedParentTiles[h]=o}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let n=this._tiles[e].tileID,o=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=n;return n||(n=new yn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,o||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){let n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,o){let s=[],h=this.transform;if(!h)return s;let f=o?h.getCameraQueryGeometry(e):e,_=e.map(O=>h.pointCoordinate(O,this.terrain)),x=f.map(O=>h.pointCoordinate(O,this.terrain)),k=this.getIds(),M=1/0,I=1/0,z=-1/0,F=-1/0;for(let O of x)M=Math.min(M,O.x),I=Math.min(I,O.y),z=Math.max(z,O.x),F=Math.max(F,O.y);for(let O=0;O<k.length;O++){let q=this._tiles[k[O]];if(q.holdingForFade())continue;let Z=q.tileID,G=Math.pow(2,h.zoom-q.tileID.overscaledZ),W=n*q.queryPadding*c.X/q.tileSize/G,V=[Z.getTilePoint(new c.Z(M,I)),Z.getTilePoint(new c.Z(z,F))];if(V[0].x-W<c.X&&V[0].y-W<c.X&&V[1].x+W>=0&&V[1].y+W>=0){let Y=_.map(re=>Z.getTilePoint(re)),Q=x.map(re=>Z.getTilePoint(re));s.push({tile:q,tileID:Z,queryGeometry:Y,cameraQueryGeometry:Q,scale:G})}}return s}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(let o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(gr(this._source.type)){let e=ge.now();for(let n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let s=this._tiles[e];s&&s.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}}function Pi(d,e){let n=Math.abs(2*d.wrap)-+(d.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||o-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function gr(d){return d==="raster"||d==="image"||d==="video"}Ze.maxOverzooming=10,Ze.maxUnderzooming=3;class Xe{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,o=this._distances[n],s=e*this.paddedLength+this.padding;for(;o<s&&n<this._distances.length;)o=this._distances[++n];let h=n-1,f=this._distances[h],_=o-f,x=_>0?(s-f)/_:0;return this.points[h].mult(1-x).add(this.points[n].mult(x))}}function Or(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class tn{constructor(e,n,o){let s=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/o),this.yCellCount=Math.ceil(n/o);for(let f=0;f<this.xCellCount*this.yCellCount;f++)s.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,o,s,h){this._forEachCell(n,o,s,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(h)}insertCircle(e,n,o,s){this._forEachCell(n-s,o-s,n+s,o+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(o),this.circles.push(s)}_insertBoxCell(e,n,o,s,h,f){this.boxCells[h].push(f)}_insertCircleCell(e,n,o,s,h,f){this.circleCells[h].push(f)}_query(e,n,o,s,h,f,_){if(o<0||e>this.width||s<0||n>this.height)return[];let x=[];if(e<=0&&n<=0&&this.width<=o&&this.height<=s){if(h)return[{key:null,x1:e,y1:n,x2:o,y2:s}];for(let k=0;k<this.boxKeys.length;k++)x.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let M=this.circles[3*k],I=this.circles[3*k+1],z=this.circles[3*k+2];x.push({key:this.circleKeys[k],x1:M-z,y1:I-z,x2:M+z,y2:I+z})}}else this._forEachCell(e,n,o,s,this._queryCell,x,{hitTest:h,overlapMode:f,seenUids:{box:{},circle:{}}},_);return x}query(e,n,o,s){return this._query(e,n,o,s,!1,null)}hitTest(e,n,o,s,h,f){return this._query(e,n,o,s,!0,h,f).length>0}hitTestCircle(e,n,o,s,h){let f=e-o,_=e+o,x=n-o,k=n+o;if(_<0||f>this.width||k<0||x>this.height)return!1;let M=[];return this._forEachCell(f,x,_,k,this._queryCellCircle,M,{hitTest:!0,overlapMode:s,circle:{x:e,y:n,radius:o},seenUids:{box:{},circle:{}}},h),M.length>0}_queryCell(e,n,o,s,h,f,_,x){let{seenUids:k,hitTest:M,overlapMode:I}=_,z=this.boxCells[h];if(z!==null){let O=this.bboxes;for(let q of z)if(!k.box[q]){k.box[q]=!0;let Z=4*q,G=this.boxKeys[q];if(e<=O[Z+2]&&n<=O[Z+3]&&o>=O[Z+0]&&s>=O[Z+1]&&(!x||x(G))&&(!M||!Or(I,G.overlapMode))&&(f.push({key:G,x1:O[Z],y1:O[Z+1],x2:O[Z+2],y2:O[Z+3]}),M))return!0}}let F=this.circleCells[h];if(F!==null){let O=this.circles;for(let q of F)if(!k.circle[q]){k.circle[q]=!0;let Z=3*q,G=this.circleKeys[q];if(this._circleAndRectCollide(O[Z],O[Z+1],O[Z+2],e,n,o,s)&&(!x||x(G))&&(!M||!Or(I,G.overlapMode))){let W=O[Z],V=O[Z+1],Y=O[Z+2];if(f.push({key:G,x1:W-Y,y1:V-Y,x2:W+Y,y2:V+Y}),M)return!0}}}return!1}_queryCellCircle(e,n,o,s,h,f,_,x){let{circle:k,seenUids:M,overlapMode:I}=_,z=this.boxCells[h];if(z!==null){let O=this.bboxes;for(let q of z)if(!M.box[q]){M.box[q]=!0;let Z=4*q,G=this.boxKeys[q];if(this._circleAndRectCollide(k.x,k.y,k.radius,O[Z+0],O[Z+1],O[Z+2],O[Z+3])&&(!x||x(G))&&!Or(I,G.overlapMode))return f.push(!0),!0}}let F=this.circleCells[h];if(F!==null){let O=this.circles;for(let q of F)if(!M.circle[q]){M.circle[q]=!0;let Z=3*q,G=this.circleKeys[q];if(this._circlesCollide(O[Z],O[Z+1],O[Z+2],k.x,k.y,k.radius)&&(!x||x(G))&&!Or(I,G.overlapMode))return f.push(!0),!0}}}_forEachCell(e,n,o,s,h,f,_,x){let k=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),I=this._convertToXCellCoord(o),z=this._convertToYCellCoord(s);for(let F=k;F<=I;F++)for(let O=M;O<=z;O++)if(h.call(this,e,n,o,s,this.xCellCount*O+F,f,_,x))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,o,s,h,f){let _=s-e,x=h-n,k=o+f;return k*k>_*_+x*x}_circleAndRectCollide(e,n,o,s,h,f,_){let x=(f-s)/2,k=Math.abs(e-(s+x));if(k>x+o)return!1;let M=(_-h)/2,I=Math.abs(n-(h+M));if(I>M+o)return!1;if(k<=x||I<=M)return!0;let z=k-x,F=I-M;return z*z+F*F<=o*o}}function vn(d,e,n,o,s){let h=c.H();return e?(c.K(h,h,[1/s,1/s,1]),n||c.ad(h,h,o.angle)):c.L(h,o.labelPlaneMatrix,d),h}function Vr(d,e,n,o,s){if(e){let h=c.ae(d);return c.K(h,h,[s,s,1]),n||c.ad(h,h,-o.angle),h}return o.glCoordMatrix}function U(d,e,n,o){let s;o?(s=[d,e,o(d,e),1],c.af(s,s,n)):(s=[d,e,0,1],ct(s,s,n));let h=s[3];return{point:new c.P(s[0]/h,s[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function A(d,e){return .5+d/e*.5}function E(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function B(d,e,n,o,s,h,f,_,x,k,M,I,z,F,O){let q=o?d.textSizeData:d.iconSizeData,Z=c.ag(q,n.transform.zoom),G=[256/n.width*2+1,256/n.height*2+1],W=o?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;W.clear();let V=d.lineVertexArray,Y=o?d.text.placedSymbolArray:d.icon.placedSymbolArray,Q=n.transform.width/n.transform.height,re=!1;for(let ue=0;ue<Y.length;ue++){let _e=Y.get(ue);if(_e.hidden||_e.writingMode===c.ah.vertical&&!re){je(_e.numGlyphs,W);continue}re=!1;let Se=U(_e.anchorX,_e.anchorY,e,O);if(!E(Se.point,G)){je(_e.numGlyphs,W);continue}let Ee=A(n.transform.cameraToCenterDistance,Se.signedDistanceFromCamera),be=c.ai(q,Z,_e),xe=f?be/Ee:be*Ee,Re={getElevation:O,labelPlaneMatrix:s,lineVertexArray:V,pitchWithMap:f,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:k,tileAnchorPoint:new c.P(_e.anchorX,_e.anchorY),unwrappedTileID:M,width:I,height:z,translation:F},We=J(Re,_e,xe,!1,_,e,h,d.glyphOffsetArray,W,Q,x);re=We.useVertical,(We.notEnoughRoom||re||We.needsFlipping&&J(Re,_e,xe,!0,_,e,h,d.glyphOffsetArray,W,Q,x).notEnoughRoom)&&je(_e.numGlyphs,W)}o?d.text.dynamicLayoutVertexBuffer.updateData(W):d.icon.dynamicLayoutVertexBuffer.updateData(W)}function j(d,e,n,o,s,h,f,_){let x=h.glyphStartIndex+h.numGlyphs,k=h.lineStartIndex,M=h.lineStartIndex+h.lineLength,I=e.getoffsetX(h.glyphStartIndex),z=e.getoffsetX(x-1),F=ve(d*I,n,o,s,h.segment,k,M,_,f);if(!F)return null;let O=ve(d*z,n,o,s,h.segment,k,M,_,f);return O?_.projectionCache.anyProjectionOccluded?null:{first:F,last:O}:null}function K(d,e,n,o){return d===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*o?{useVertical:!0}:(d===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function J(d,e,n,o,s,h,f,_,x,k,M){let I=n/24,z=e.lineOffsetX*I,F=e.lineOffsetY*I,O;if(e.numGlyphs>1){let q=e.glyphStartIndex+e.numGlyphs,Z=e.lineStartIndex,G=e.lineStartIndex+e.lineLength,W=j(I,_,z,F,o,e,M,d);if(!W)return{notEnoughRoom:!0};let V=U(W.first.point.x,W.first.point.y,f,d.getElevation).point,Y=U(W.last.point.x,W.last.point.y,f,d.getElevation).point;if(s&&!o){let Q=K(e.writingMode,V,Y,k);if(Q)return Q}O=[W.first];for(let Q=e.glyphStartIndex+1;Q<q-1;Q++)O.push(ve(I*_.getoffsetX(Q),z,F,o,e.segment,Z,G,d,M));O.push(W.last)}else{if(s&&!o){let Z=U(d.tileAnchorPoint.x,d.tileAnchorPoint.y,h,d.getElevation).point,G=e.lineStartIndex+e.segment+1,W=new c.P(d.lineVertexArray.getx(G),d.lineVertexArray.gety(G)),V=U(W.x,W.y,h,d.getElevation),Y=V.signedDistanceFromCamera>0?V.point:function(re,ue,_e,Se,Ee,be){return te(re,ue,_e,1,Ee,be)}(d.tileAnchorPoint,W,Z,0,h,d),Q=K(e.writingMode,Z,Y,k);if(Q)return Q}let q=ve(I*_.getoffsetX(e.glyphStartIndex),z,F,o,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,d,M);if(!q||d.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};O=[q]}for(let q of O)c.aj(x,q.point,q.angle);return{}}function te(d,e,n,o,s,h){let f=d.add(d.sub(e)._unit()),_=s!==void 0?U(f.x,f.y,s,h.getElevation).point:le(f.x,f.y,h).point,x=n.sub(_);return n.add(x._mult(o/x.mag()))}function H(d,e,n){let o=e.projectionCache;if(o.projections[d])return o.projections[d];let s=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),h=le(s.x,s.y,e);if(h.signedDistanceFromCamera>0)return o.projections[d]=h.point,o.anyProjectionOccluded=o.anyProjectionOccluded||h.isOccluded,h.point;let f=d-n.direction;return function(_,x,k,M,I){return te(_,x,k,M,void 0,I)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),s,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function le(d,e,n){let o=d+n.translation[0],s=e+n.translation[1],h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(o,s,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=U(o,s,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function pe(d,e,n){return d._unit()._perp()._mult(e*n)}function ne(d,e,n,o,s,h,f,_,x){if(_.projectionCache.offsets[d])return _.projectionCache.offsets[d];let k=n.add(e);if(d+x.direction<o||d+x.direction>=s)return _.projectionCache.offsets[d]=k,k;let M=H(d+x.direction,_,x),I=pe(M.sub(n),f,x.direction),z=n.add(I),F=M.add(I);return _.projectionCache.offsets[d]=c.ak(h,k,z,F)||k,_.projectionCache.offsets[d]}function ve(d,e,n,o,s,h,f,_,x){let k=o?d-e:d+e,M=k>0?1:-1,I=0;o&&(M*=-1,I=Math.PI),M<0&&(I+=Math.PI);let z,F=M>0?h+s:h+s+1;_.projectionCache.cachedAnchorPoint?z=_.projectionCache.cachedAnchorPoint:(z=le(_.tileAnchorPoint.x,_.tileAnchorPoint.y,_).point,_.projectionCache.cachedAnchorPoint=z);let O,q,Z=z,G=z,W=0,V=0,Y=Math.abs(k),Q=[],re;for(;W+V<=Y;){if(F+=M,F<h||F>=f)return null;W+=V,G=Z,q=O;let Se={absOffsetX:Y,direction:M,distanceFromAnchor:W,previousVertex:G};if(Z=H(F,_,Se),n===0)Q.push(G),re=Z.sub(G);else{let Ee,be=Z.sub(G);Ee=be.mag()===0?pe(H(F+M,_,Se).sub(Z),n,M):pe(be,n,M),q||(q=G.add(Ee)),O=ne(F,Ee,Z,h,f,q,n,_,Se),Q.push(q),re=O.sub(q)}V=re.mag()}let ue=re._mult((Y-W)/V)._add(q||G),_e=I+Math.atan2(Z.y-G.y,Z.x-G.x);return Q.push(ue),{point:ue,angle:x?_e:0,path:Q}}let Ve=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function je(d,e){for(let n=0;n<d;n++){let o=e.length;e.resize(o+4),e.float32.set(Ve,3*o)}}function ct(d,e,n){let o=e[0],s=e[1];return d[0]=n[0]*o+n[4]*s+n[12],d[1]=n[1]*o+n[5]*s+n[13],d[3]=n[3]*o+n[7]*s+n[15],d}let Ke=100;class ht{constructor(e,n,o=new tn(e.width+200,e.height+200,25),s=new tn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=o,this.ignoredGrid=s,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ke,this.screenBottomBoundary=e.height+Ke,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,o,s,h,f,_,x,k,M,I){let z=e.anchorPointX+x[0],F=e.anchorPointY+x[1],O=this.projectAndGetPerspectiveRatio(s,z,F,h,M),q=o*O.perspectiveRatio,Z;if(f||_)Z=this._projectCollisionBox(e,q,s,h,f,_,x,O,M,I);else{let Q=O.point.x+(I?I.x*q:0),re=O.point.y+(I?I.y*q:0);Z={allPointsOccluded:!1,box:[Q+e.x1*q,re+e.y1*q,Q+e.x2*q,re+e.y2*q]}}let[G,W,V,Y]=Z.box;return this.mapProjection.useSpecialProjectionForSymbols&&(f?Z.allPointsOccluded:this.mapProjection.isOccluded(z,F,h))||O.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(G,W,V,Y)||n!=="always"&&this.grid.hitTest(G,W,V,Y,n,k)?{box:[G,W,V,Y],placeable:!1,offscreen:!1}:{box:[G,W,V,Y],placeable:!0,offscreen:this.isOffscreen(G,W,V,Y)}}placeCollisionCircles(e,n,o,s,h,f,_,x,k,M,I,z,F,O,q,Z){let G=[],W=new c.P(n.anchorX,n.anchorY),V=this.getPerspectiveRatio(f,W.x,W.y,_,Z),Y=(I?h/V:h*V)/c.ap,Q={getElevation:Z,labelPlaneMatrix:x,lineVertexArray:o,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:W,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:q},re=j(Y,s,n.lineOffsetX*Y,n.lineOffsetY*Y,!1,n,!1,Q),ue=!1,_e=!1,Se=!0;if(re){let Ee=.5*F*V+O,be=new c.P(-100,-100),xe=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new Xe,We=re.first,ke=re.last,Ie=[];for(let Qe=We.path.length-1;Qe>=1;Qe--)Ie.push(We.path[Qe]);for(let Qe=1;Qe<ke.path.length;Qe++)Ie.push(ke.path[Qe]);let Ge=2.5*Ee;if(k){let Qe=this.projectPathToScreenSpace(Ie,Q,k);Ie=Qe.some(ot=>ot.signedDistanceFromCamera<=0)?[]:Qe.map(ot=>ot.point)}let Tt=[];if(Ie.length>0){let Qe=Ie[0].clone(),ot=Ie[0].clone();for(let Et=1;Et<Ie.length;Et++)Qe.x=Math.min(Qe.x,Ie[Et].x),Qe.y=Math.min(Qe.y,Ie[Et].y),ot.x=Math.max(ot.x,Ie[Et].x),ot.y=Math.max(ot.y,Ie[Et].y);Tt=Qe.x>=be.x&&ot.x<=xe.x&&Qe.y>=be.y&&ot.y<=xe.y?[Ie]:ot.x<be.x||Qe.x>xe.x||ot.y<be.y||Qe.y>xe.y?[]:c.al([Ie],be.x,be.y,xe.x,xe.y)}for(let Qe of Tt){Re.reset(Qe,.25*Ee);let ot=0;ot=Re.length<=.5*Ee?1:Math.ceil(Re.paddedLength/Ge)+1;for(let Et=0;Et<ot;Et++){let hi=Et/Math.max(ot-1,1),wr=Re.lerp(hi),At=wr.x+Ke,Li=wr.y+Ke;G.push(At,Li,Ee,0);let wi=At-Ee,di=Li-Ee,ki=At+Ee,Ur=Li+Ee;if(Se=Se&&this.isOffscreen(wi,di,ki,Ur),_e=_e||this.isInsideGrid(wi,di,ki,Ur),e!=="always"&&this.grid.hitTestCircle(At,Li,Ee,e,z)&&(ue=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ue}}}}return{circles:!M&&ue||!_e||V<this.perspectiveRatioCutoff?[]:G,offscreen:Se,collisionDetected:ue}}projectPathToScreenSpace(e,n,o){return e.map(s=>U(s.x,s.y,o,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],o=1/0,s=1/0,h=-1/0,f=-1/0;for(let M of e){let I=new c.P(M.x+Ke,M.y+Ke);o=Math.min(o,I.x),s=Math.min(s,I.y),h=Math.max(h,I.x),f=Math.max(f,I.y),n.push(I)}let _=this.grid.query(o,s,h,f).concat(this.ignoredGrid.query(o,s,h,f)),x={},k={};for(let M of _){let I=M.key;if(x[I.bucketInstanceId]===void 0&&(x[I.bucketInstanceId]={}),x[I.bucketInstanceId][I.featureIndex])continue;let z=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(n,z)&&(x[I.bucketInstanceId][I.featureIndex]=!0,k[I.bucketInstanceId]===void 0&&(k[I.bucketInstanceId]=[]),k[I.bucketInstanceId].push(I.featureIndex))}return k}insertCollisionBox(e,n,o,s,h,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:h,collisionGroupID:f,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,o,s,h,f){let _=o?this.ignoredGrid:this.grid,x={bucketInstanceId:s,featureIndex:h,collisionGroupID:f,overlapMode:n};for(let k=0;k<e.length;k+=4)_.insertCircle(x,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,n,o,s,h){let f;h?(f=[n,o,h(n,o),1],c.af(f,f,e)):(f=[n,o,0,1],ct(f,f,e));let _=f[3];return{point:new c.P((f[0]/_+1)/2*this.transform.width+Ke,(-f[1]/_+1)/2*this.transform.height+Ke),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_*.5,isOccluded:!1,signedDistanceFromCamera:_}}getPerspectiveRatio(e,n,o,s,h){let f=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,o,s,h):U(n,o,e,h);return .5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5}isOffscreen(e,n,o,s){return o<Ke||e>=this.screenRightBoundary||s<Ke||n>this.screenBottomBoundary}isInsideGrid(e,n,o,s){return o>=0&&e<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,o,s,h,f,_,x,k,M){let I=new c.P(1,0),z=new c.P(0,1),F=new c.P(e.anchorPointX+_[0],e.anchorPointY+_[1]);if(f&&!h){let Se=this.projectAndGetPerspectiveRatio(o,F.x+1,F.y,s,k).point.sub(x.point).unit(),Ee=Math.atan(Se.y/Se.x)+(Se.x<0?Math.PI:0),be=Math.sin(Ee),xe=Math.cos(Ee);I=new c.P(xe,be),z=new c.P(-be,xe)}else if(!f&&h){let Se=-this.transform.angle,Ee=Math.sin(Se),be=Math.cos(Se);I=new c.P(be,Ee),z=new c.P(-Ee,be)}let O=x.point,q=n;if(h){O=F;let Se=this.transform.zoom-Math.floor(this.transform.zoom);q=Math.pow(2,-Se),q*=this.mapProjection.getPitchedTextCorrection(this.transform,F,s),M||(q*=c.ac(.5+x.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(O=O.add(I.mult(M.x*q)).add(z.mult(M.y*q)));let Z=e.x1*q,G=e.x2*q,W=(Z+G)/2,V=e.y1*q,Y=e.y2*q,Q=(V+Y)/2,re=[{offsetX:Z,offsetY:V},{offsetX:W,offsetY:V},{offsetX:G,offsetY:V},{offsetX:G,offsetY:Q},{offsetX:G,offsetY:Y},{offsetX:W,offsetY:Y},{offsetX:Z,offsetY:Y},{offsetX:Z,offsetY:Q}],ue=[];for(let{offsetX:Se,offsetY:Ee}of re)ue.push(new c.P(O.x+I.x*Se+z.x*Ee,O.y+I.y*Se+z.y*Ee));let _e=!1;if(h){let Se=ue.map(Ee=>this.projectAndGetPerspectiveRatio(o,Ee.x,Ee.y,s,k));_e=Se.some(Ee=>!Ee.isOccluded),ue=Se.map(Ee=>Ee.point)}else _e=!0;return{box:c.ao(ue),allPointsOccluded:!_e}}}function at(d,e,n){return e*(c.X/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class Ht{constructor(e,n,o,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):s&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Rt{constructor(e,n,o,s,h){this.text=new Ht(e?e.text:null,n,o,h),this.icon=new Ht(e?e.icon:null,n,s,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tt{constructor(e,n,o){this.text=e,this.icon=n,this.skipFade=o}}class gt{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class zt{constructor(e,n,o,s,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=s,this.tileID=h}}class ei{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[e]}}function ni(d,e,n,o,s){let{horizontalAlign:h,verticalAlign:f}=c.au(d);return new c.P(-(h-.5)*e+o[0]*s,-(f-.5)*n+o[1]*s)}class bi{constructor(e,n,o,s,h,f){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new ht(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new ei(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let n=this.terrain;return n?(o,s)=>n.getElevation(e,o,s):null}getBucketParts(e,n,o,s){let h=o.getBucket(n),f=o.latestFeatureIndex;if(!h||!f||n.id!==h.layerIds[0])return;let _=o.collisionBoxArray,x=h.layers[0].layout,k=h.layers[0].paint,M=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),I=o.tileSize/c.X,z=o.tileID.toUnwrapped(),F=this.transform.calculatePosMatrix(z),O=x.get("text-pitch-alignment")==="map",q=x.get("text-rotation-alignment")==="map",Z=at(o,1,this.transform.zoom),G=this.collisionIndex.mapProjection.translatePosition(this.transform,o,k.get("text-translate"),k.get("text-translate-anchor")),W=this.collisionIndex.mapProjection.translatePosition(this.transform,o,k.get("icon-translate"),k.get("icon-translate-anchor")),V=vn(F,O,q,this.transform,Z),Y=null;if(O){let re=Vr(F,O,q,this.transform,Z);Y=c.L([],this.transform.labelPlaneMatrix,re)}this.retainedQueryData[h.bucketInstanceId]=new zt(h.bucketInstanceId,f,h.sourceLayerIndex,h.index,o.tileID);let Q={bucket:h,layout:x,translationText:G,translationIcon:W,posMatrix:F,unwrappedTileID:z,textLabelPlaneMatrix:V,labelToScreenMatrix:Y,scale:M,textPixelRatio:I,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(s)for(let re of h.sortKeyRanges){let{sortKey:ue,symbolInstanceStart:_e,symbolInstanceEnd:Se}=re;e.push({sortKey:ue,symbolInstanceStart:_e,symbolInstanceEnd:Se,parameters:Q})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(e,n,o,s,h,f,_,x,k,M,I,z,F,O,q,Z,G,W,V){let Y=c.aq[e.textAnchor],Q=[e.textOffset0,e.textOffset1],re=ni(Y,o,s,Q,h),ue=this.collisionIndex.placeCollisionBox(n,z,x,k,M,_,f,Z,I.predicate,V,re);if((!W||this.collisionIndex.placeCollisionBox(W,z,x,k,M,_,f,G,I.predicate,V,re).placeable)&&ue.placeable){let _e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(_e=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:Q,width:o,height:s,anchor:Y,textBoxScale:h,prevAnchor:_e},this.markUsedJustification(O,Y,F,q),O.allowVerticalPlacement&&(this.markUsedOrientation(O,q,F),this.placedOrientations[F.crossTileID]=q),{shift:re,placedGlyphBoxes:ue}}}placeLayerBucketPart(e,n,o){let{bucket:s,layout:h,translationText:f,translationIcon:_,posMatrix:x,unwrappedTileID:k,textLabelPlaneMatrix:M,labelToScreenMatrix:I,textPixelRatio:z,holdingForFade:F,collisionBoxArray:O,partiallyEvaluatedTextSize:q,collisionGroup:Z}=e.parameters,G=h.get("text-optional"),W=h.get("icon-optional"),V=c.ar(h,"text-overlap","text-allow-overlap"),Y=V==="always",Q=c.ar(h,"icon-overlap","icon-allow-overlap"),re=Q==="always",ue=h.get("text-rotation-alignment")==="map",_e=h.get("text-pitch-alignment")==="map",Se=h.get("icon-text-fit")!=="none",Ee=h.get("symbol-z-order")==="viewport-y",be=Y&&(re||!s.hasIconData()||W),xe=re&&(Y||!s.hasTextData()||G);!s.collisionArrays&&O&&s.deserializeCollisionBoxes(O);let Re=this._getTerrainElevationFunc(this.retainedQueryData[s.bucketInstanceId].tileID),We=(ke,Ie,Ge)=>{var Tt,Qe;if(n[ke.crossTileID])return;if(F)return void(this.placements[ke.crossTileID]=new tt(!1,!1,!1));let ot=!1,Et=!1,hi=!0,wr=null,At={box:null,placeable:!1,offscreen:null},Li={box:null,placeable:!1,offscreen:null},wi=null,di=null,ki=null,Ur=0,Va=0,Rs=0;Ie.textFeatureIndex?Ur=Ie.textFeatureIndex:ke.useRuntimeCollisionCircles&&(Ur=ke.featureIndex),Ie.verticalTextFeatureIndex&&(Va=Ie.verticalTextFeatureIndex);let Na=Ie.textBox;if(Na){let cr=ai=>{let ui=c.ah.horizontal;if(s.allowVerticalPlacement&&!ai&&this.prevPlacement){let Yi=this.prevPlacement.placedOrientations[ke.crossTileID];Yi&&(this.placedOrientations[ke.crossTileID]=Yi,ui=Yi,this.markUsedOrientation(s,ui,ke))}return ui},hr=(ai,ui)=>{if(s.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(let Yi of s.writingModes)if(Yi===c.ah.vertical?(At=ui(),Li=At):At=ai(),At&&At.placeable)break}else At=ai()},wn=ke.textAnchorOffsetStartIndex,kr=ke.textAnchorOffsetEndIndex;if(kr===wn){let ai=(ui,Yi)=>{let lt=this.collisionIndex.placeCollisionBox(ui,V,z,x,k,_e,ue,f,Z.predicate,Re);return lt&&lt.placeable&&(this.markUsedOrientation(s,Yi,ke),this.placedOrientations[ke.crossTileID]=Yi),lt};hr(()=>ai(Na,c.ah.horizontal),()=>{let ui=Ie.verticalTextBox;return s.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&ui?ai(ui,c.ah.vertical):{box:null,offscreen:null}}),cr(At&&At.placeable)}else{let ai=c.aq[(Qe=(Tt=this.prevPlacement)===null||Tt===void 0?void 0:Tt.variableOffsets[ke.crossTileID])===null||Qe===void 0?void 0:Qe.anchor],ui=(lt,Jn,ja)=>{let qa=lt.x2-lt.x1,mh=lt.y2-lt.y1,qd=ke.textBoxScale,fh=Se&&Q==="never"?Jn:null,kn=null,gh=V==="never"?1:2,Bs="never";ai&&gh++;for(let zo=0;zo<gh;zo++){for(let Os=wn;Os<kr;Os++){let Vs=s.textAnchorOffsets.get(Os);if(ai&&Vs.textAnchor!==ai)continue;let Ua=this.attemptAnchorPlacement(Vs,lt,qa,mh,qd,ue,_e,z,x,k,Z,Bs,ke,s,ja,f,_,fh,Re);if(Ua&&(kn=Ua.placedGlyphBoxes,kn&&kn.placeable))return ot=!0,wr=Ua.shift,kn}ai?ai=null:Bs=V}return o&&!kn&&(kn={box:this.collisionIndex.placeCollisionBox(Na,"always",z,x,k,_e,ue,f,Z.predicate,Re,new c.P(0,0)).box,offscreen:!1,placeable:!1}),kn};hr(()=>ui(Na,Ie.iconBox,c.ah.horizontal),()=>{let lt=Ie.verticalTextBox;return s.allowVerticalPlacement&&(!At||!At.placeable)&&ke.numVerticalGlyphVertices>0&&lt?ui(lt,Ie.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),At&&(ot=At.placeable,hi=At.offscreen);let Yi=cr(At&&At.placeable);if(!ot&&this.prevPlacement){let lt=this.prevPlacement.variableOffsets[ke.crossTileID];lt&&(this.variableOffsets[ke.crossTileID]=lt,this.markUsedJustification(s,lt.anchor,ke,Yi))}}}if(wi=At,ot=wi&&wi.placeable,hi=wi&&wi.offscreen,ke.useRuntimeCollisionCircles){let cr=s.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex),hr=c.ai(s.textSizeData,q,cr),wn=h.get("text-padding");di=this.collisionIndex.placeCollisionCircles(V,cr,s.lineVertexArray,s.glyphOffsetArray,hr,x,k,M,I,o,_e,Z.predicate,ke.collisionCircleDiameter,wn,f,Re),di.circles.length&&di.collisionDetected&&!o&&c.w("Collisions detected, but collision boxes are not shown"),ot=Y||di.circles.length>0&&!di.collisionDetected,hi=hi&&di.offscreen}if(Ie.iconFeatureIndex&&(Rs=Ie.iconFeatureIndex),Ie.iconBox){let cr=hr=>this.collisionIndex.placeCollisionBox(hr,Q,z,x,k,_e,ue,_,Z.predicate,Re,Se&&wr?wr:void 0);Li&&Li.placeable&&Ie.verticalIconBox?(ki=cr(Ie.verticalIconBox),Et=ki.placeable):(ki=cr(Ie.iconBox),Et=ki.placeable),hi=hi&&ki.offscreen}let lr=G||ke.numHorizontalGlyphVertices===0&&ke.numVerticalGlyphVertices===0,Fs=W||ke.numIconVertices===0;lr||Fs?Fs?lr||(Et=Et&&ot):ot=Et&&ot:Et=ot=Et&&ot;let rc=Et&&ki.placeable;if(ot&&wi.placeable&&this.collisionIndex.insertCollisionBox(wi.box,V,h.get("text-ignore-placement"),s.bucketInstanceId,Li&&Li.placeable&&Va?Va:Ur,Z.ID),rc&&this.collisionIndex.insertCollisionBox(ki.box,Q,h.get("icon-ignore-placement"),s.bucketInstanceId,Rs,Z.ID),di&&ot&&this.collisionIndex.insertCollisionCircles(di.circles,V,h.get("text-ignore-placement"),s.bucketInstanceId,Ur,Z.ID),o&&this.storeCollisionData(s.bucketInstanceId,Ge,Ie,wi,ki,di),ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(s.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ke.crossTileID]=new tt(ot||be,Et||xe,hi||s.justReloaded),n[ke.crossTileID]=!0};if(Ee){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let ke=s.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ke.length-1;Ie>=0;--Ie){let Ge=ke[Ie];We(s.symbolInstances.get(Ge),s.collisionArrays[Ge],Ge)}}else for(let ke=e.symbolInstanceStart;ke<e.symbolInstanceEnd;ke++)We(s.symbolInstances.get(ke),s.collisionArrays[ke],ke);if(o&&s.bucketInstanceId in this.collisionCircleArrays){let ke=this.collisionCircleArrays[s.bucketInstanceId];c.as(ke.invProjMatrix,x),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}storeCollisionData(e,n,o,s,h,f){if(o.textBox||o.iconBox){let _,x;this.collisionBoxArrays.has(e)?_=this.collisionBoxArrays.get(e):(_=new Map,this.collisionBoxArrays.set(e,_)),_.has(n)?x=_.get(n):(x={text:null,icon:null},_.set(n,x)),o.textBox&&(x.text=s.box),o.iconBox&&(x.icon=h.box)}if(f){let _=this.collisionCircleArrays[e];_===void 0&&(_=this.collisionCircleArrays[e]=new gt);for(let x=0;x<f.circles.length;x+=4)_.circles.push(f.circles[x+0]),_.circles.push(f.circles[x+1]),_.circles.push(f.circles[x+2]),_.circles.push(f.collisionDetected?1:0)}}markUsedJustification(e,n,o,s){let h;h=s===c.ah.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[c.at(n)];let f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(let _ of f)_>=0&&(e.text.placedSymbolArray.get(_).crossTileID=h>=0&&_!==h?0:o.crossTileID)}markUsedOrientation(e,n,o){let s=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(let _ of f)e.text.placedSymbolArray.get(_).placedOrientation=s;o.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let s=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},f=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(let x in this.placements){let k=this.placements[x],M=h[x];M?(this.opacities[x]=new Rt(M,s,k.text,k.icon),o=o||k.text!==M.text.placed||k.icon!==M.icon.placed):(this.opacities[x]=new Rt(null,s,k.text,k.icon,k.skipFade),o=o||k.text||k.icon)}for(let x in h){let k=h[x];if(!this.opacities[x]){let M=new Rt(k,s,!1,!1);M.isHidden()||(this.opacities[x]=M,o=o||k.text.placed||k.icon.placed)}}for(let x in f)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=f[x]);for(let x in _)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=_[x]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let o={};for(let s of n){let h=s.getBucket(e);h&&s.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,s.tileID,o,s.collisionBoxArray)}}updateBucketOpacities(e,n,o,s){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let h=e.layers[0],f=h.layout,_=new Rt(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),k=f.get("icon-allow-overlap"),M=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=f.get("text-rotation-alignment")==="map",z=f.get("text-pitch-alignment")==="map",F=f.get("icon-text-fit")!=="none",O=new Rt(null,0,x&&(k||!e.hasIconData()||f.get("icon-optional")),k&&(x||!e.hasTextData()||f.get("text-optional")),!0);!e.collisionArrays&&s&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(s);let q=(G,W,V)=>{for(let Y=0;Y<W/4;Y++)G.opacityVertexArray.emplaceBack(V);G.hasVisibleVertices=G.hasVisibleVertices||V!==ya},Z=this.collisionBoxArrays.get(e.bucketInstanceId);for(let G=0;G<e.symbolInstances.length;G++){let W=e.symbolInstances.get(G),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:Y,crossTileID:Q}=W,re=this.opacities[Q];o[Q]?re=_:re||(re=O,this.opacities[Q]=re),o[Q]=!0;let ue=W.numIconVertices>0,_e=this.placedOrientations[W.crossTileID],Se=_e===c.ah.vertical,Ee=_e===c.ah.horizontal||_e===c.ah.horizontalOnly;if(V>0||Y>0){let xe=Wi(re.text);q(e.text,V,Se?ya:xe),q(e.text,Y,Ee?ya:xe);let Re=re.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Ie=>{Ie>=0&&(e.text.placedSymbolArray.get(Ie).hidden=Re||Se?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Re||Ee?1:0);let We=this.variableOffsets[W.crossTileID];We&&this.markUsedJustification(e,We.anchor,W,_e);let ke=this.placedOrientations[W.crossTileID];ke&&(this.markUsedJustification(e,"left",W,ke),this.markUsedOrientation(e,ke,W))}if(ue){let xe=Wi(re.icon),Re=!(F&&W.verticalPlacedIconSymbolIndex&&Se);W.placedIconSymbolIndex>=0&&(q(e.icon,W.numIconVertices,Re?xe:ya),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=re.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,W.numVerticalIconVertices,Re?ya:xe),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}let be=Z&&Z.has(G)?Z.get(G):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let xe=e.collisionArrays[G];if(xe){let Re=new c.P(0,0);if(xe.textBox||xe.verticalTextBox){let We=!0;if(M){let ke=this.variableOffsets[Q];ke?(Re=ni(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textBoxScale),I&&Re._rotate(z?this.transform.angle:-this.transform.angle)):We=!1}if(xe.textBox||xe.verticalTextBox){let ke;xe.textBox&&(ke=Se),xe.verticalTextBox&&(ke=Ee),_a(e.textCollisionBox.collisionVertexArray,re.text.placed,!We||ke,be.text,Re.x,Re.y)}}if(xe.iconBox||xe.verticalIconBox){let We=!!(!Ee&&xe.verticalIconBox),ke;xe.iconBox&&(ke=We),xe.verticalIconBox&&(ke=!We),_a(e.iconCollisionBox.collisionVertexArray,re.icon.placed,ke,be.icon,F?Re.x:0,F?Re.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=G.invProjMatrix,e.placementViewportMatrix=G.viewportMatrix,e.collisionCircleArray=G.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>e}setStale(){this.stale=!0}}function _a(d,e,n,o,s,h){o&&o.length!==0||(o=[0,0,0,0]);let f=o[0]-Ke,_=o[1]-Ke,x=o[2]-Ke,k=o[3]-Ke;d.emplaceBack(e?1:0,n?1:0,s||0,h||0,f,_),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,x,_),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,x,k),d.emplaceBack(e?1:0,n?1:0,s||0,h||0,f,k)}let _t=Math.pow(2,25),ml=Math.pow(2,24),fl=Math.pow(2,17),Gi=Math.pow(2,16),Hi=Math.pow(2,9),gd=Math.pow(2,8),nr=Math.pow(2,1);function Wi(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*_t+e*ml+n*fl+e*Gi+n*Hi+e*gd+n*nr+e}let ya=0;function Nn(){return{isOccluded:(d,e,n)=>!1,getPitchedTextCorrection:(d,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(d,e,n,o){throw new Error("Not implemented.")},translatePosition:(d,e,n,o)=>function(s,h,f,_,x=!1){if(!f[0]&&!f[1])return[0,0];let k=x?_==="map"?s.angle:0:_==="viewport"?-s.angle:0;if(k){let M=Math.sin(k),I=Math.cos(k);f=[f[0]*I-f[1]*M,f[0]*M+f[1]*I]}return[x?f[0]:at(h,f[0],s.zoom),x?f[1]:at(h,f[1],s.zoom)]}(d,e,n,o),getCircleRadiusCorrection:d=>1}}class Wt{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,o,s,h){let f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(f,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((_,x)=>_.sortKey-x.sortKey));this._currentPartIndex<f.length;)if(n.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,h())return!0;return!1}}class fo{constructor(e,n,o,s,h,f,_,x){this.placement=new bi(e,Nn(),n,f,_,x),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,o){let s=ge.now(),h=()=>!this._forceFullPlacement&&ge.now()-s>2;for(;this._currentPlacementIndex>=0;){let f=n[e[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Wt(f)),this._inProgressLayer.continuePlacement(o[f.source],this.placement,this._showCollisionBoxes,f,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let _r=512/c.X/2;class Ut{constructor(e,n,o){this.tileID=e,this.bucketInstanceId=o,this._symbolsByKey={};let s=new Map;for(let h=0;h<n.length;h++){let f=n.get(h),_=f.key,x=s.get(_);x?x.push(f):s.set(_,[f])}for(let[h,f]of s){let _={positions:f.map(x=>({x:Math.floor(x.anchorX*_r),y:Math.floor(x.anchorY*_r)})),crossTileIDs:f.map(x=>x.crossTileID)};if(_.positions.length>128){let x=new c.av(_.positions.length,16,Uint16Array);for(let{x:k,y:M}of _.positions)x.add(k,M);x.finish(),delete _.positions,_.index=x}this._symbolsByKey[h]=_}}getScaledCoordinates(e,n){let{x:o,y:s,z:h}=this.tileID.canonical,{x:f,y:_,z:x}=n.canonical,k=_r/Math.pow(2,x-h),M=(_*c.X+e.anchorY)*k,I=s*c.X*_r;return{x:Math.floor((f*c.X+e.anchorX)*k-o*c.X*_r),y:Math.floor(M-I)}}findMatches(e,n,o){let s=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){let f=e.get(h);if(f.crossTileID)continue;let _=this._symbolsByKey[f.key];if(!_)continue;let x=this.getScaledCoordinates(f,n);if(_.index){let k=_.index.range(x.x-s,x.y-s,x.x+s,x.y+s).sort();for(let M of k){let I=_.crossTileIDs[M];if(!o[I]){o[I]=!0,f.crossTileID=I;break}}}else if(_.positions)for(let k=0;k<_.positions.length;k++){let M=_.positions[k],I=_.crossTileIDs[k];if(Math.abs(M.x-x.x)<=s&&Math.abs(M.y-x.y)<=s&&!o[I]){o[I]=!0,f.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ns{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let o in this.indexes){let s=this.indexes[o],h={};for(let f in s){let _=s[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),h[_.tileID.key]=_}this.indexes[o]=h}this.lng=e}addBucket(e,n,o){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let s=this.usedCrossTileIDs[e.overscaledZ];for(let h in this.indexes){let f=this.indexes[h];if(Number(h)>e.overscaledZ)for(let _ in f){let x=f[_];x.tileID.isChildOf(e)&&x.findMatches(n.symbolInstances,e,s)}else{let _=f[e.scaledTo(Number(h)).key];_&&_.findMatches(n.symbolInstances,e,s)}}for(let h=0;h<n.symbolInstances.length;h++){let f=n.symbolInstances.get(h);f.crossTileID||(f.crossTileID=o.generate(),s[f.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ut(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let o of n.getCrossTileIDsLists())for(let s of o)delete this.usedCrossTileIDs[e][s]}removeStaleBuckets(e){let n=!1;for(let o in this.indexes){let s=this.indexes[o];for(let h in s)e[s[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,s[h]),delete s[h],n=!0)}return n}}class gl{constructor(){this.layerIndexes={},this.crossTileIDs=new ns,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,o){let s=this.layerIndexes[e.id];s===void 0&&(s=this.layerIndexes[e.id]=new yr);let h=!1,f={};s.handleWrapJump(o);for(let _ of n){let x=_.getBucket(e);x&&e.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(_.tileID,x,this.crossTileIDs)&&(h=!0),f[x.bucketInstanceId]=!0)}return s.removeStaleBuckets(f)&&(h=!0),h}pruneUnusedLayers(e){let n={};e.forEach(o=>{n[o]=!0});for(let o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}let vr=(d,e)=>c.t(d,e&&e.filter(n=>n.identifier!=="source.canvas")),_d=c.aw();class as extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(let o in this.sourceCaches){let s=this.sourceCaches[o].getSource().type;s!=="vector"&&s!=="geojson"||this.sourceCaches[o].reload()}},this.map=e,this.dispatcher=new On(Bn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(o,s)=>this.getGlyphs(o,s)),this.dispatcher.registerMessageHandler("GI",(o,s)=>this.getImages(o,s)),this.imageManager=new li,this.imageManager.setEventedParent(this),this.glyphManager=new Lr(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new pa(256,512),this.crossTileSymbolIndex=new gl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Br().on(ye,this._rtlPluginLoaded),this.on("data",o=>{if(o.dataType!=="source"||o.sourceDataType!=="metadata")return;let s=this.sourceCaches[o.sourceId];if(!s)return;let h=s.getSource();if(h&&h.vectorLayerIds)for(let f in this._layers){let _=this._layers[f];_.source===h.id&&this._validateLayer(_)}})}loadURL(e,n={},o){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;let s=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let h=this._loadStyleRequest;c.h(s,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,n,o)}).catch(f=>{this._loadStyleRequest=null,f&&!h.signal.aborted&&this.fire(new c.j(f))})}loadJSON(e,n={},o){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,o)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(_d,{validate:!1})}_load(e,n,o){var s;let h=n.transformStyle?n.transformStyle(o,e):e;if(!n.validate||!vr(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(let f in h.sources)this.addSource(f,h.sources[f],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new Jr(this.stylesheet.light),this.sky=new mr(this.stylesheet.sky),this.map.setTerrain((s=this.stylesheet.terrain)!==null&&s!==void 0?s:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){let e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(let n of e){let o=c.aA(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(e,n=!1,o=void 0){let s;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,f,_,x){return c._(this,void 0,void 0,function*(){let k=zr(h),M=_>1?"@2x":"",I={},z={};for(let{id:F,url:O}of k){let q=f.transformRequest(lo(O,M,".json"),"SpriteJSON");I[F]=c.h(q,x);let Z=f.transformRequest(lo(O,M,".png"),"SpriteImage");z[F]=$i.getImage(Z,x)}return yield Promise.all([...Object.values(I),...Object.values(z)]),function(F,O){return c._(this,void 0,void 0,function*(){let q={};for(let Z in F){q[Z]={};let G=ge.getImageCanvasContext((yield O[Z]).data),W=(yield F[Z]).data;for(let V in W){let{width:Y,height:Q,x:re,y:ue,sdf:_e,pixelRatio:Se,stretchX:Ee,stretchY:be,content:xe,textFitWidth:Re,textFitHeight:We}=W[V];q[Z][V]={data:null,pixelRatio:Se,sdf:_e,stretchX:Ee,stretchY:be,content:xe,textFitWidth:Re,textFitHeight:We,spriteData:{width:Y,height:Q,x:re,y:ue,context:G}}}}return q})}(I,z)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(let f in h){this._spritesImagesIds[f]=[];let _=this._spritesImagesIds[f]?this._spritesImagesIds[f].filter(x=>!(x in h)):[];for(let x of _)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(let x in h[f]){let k=f==="default"?x:`${f}:${x}`;this._spritesImagesIds[f].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,h[f][x],!1):this.imageManager.addImage(k,h[f][x]),n&&(this._changedImages[k]=!0)}}}).catch(h=>{this._spriteRequest=null,s=h,this.fire(new c.j(s))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),o&&o(s)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){let n=this.sourceCaches[e.source];if(!n)return;let o=e.sourceLayer;if(!o)return;let s=n.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(o)===-1)&&this.fire(new c.j(new Error(`Source layer "${o}" does not exist on source "${s.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){let o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(o):o);let s=[];for(let h of e)if(o[h]){let f=n?c.aB(o[h]):o[h];s.push(f)}return s}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let n=Object.keys(this._layers);for(let o of n){let s=this._layers[o];s.type!=="custom"&&(e[o]=s.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let n=this._changed;if(n){let s=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(s.length||h.length)&&this._updateWorkerLayers(s,h);for(let f in this._updatedSources){let _=this._updatedSources[f];if(_==="reload")this._reloadSource(f);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(f)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let f in this._updatedPaintProps)this._layers[f].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let o={};for(let s in this.sourceCaches){let h=this.sourceCaches[s];o[s]=h.used,h.used=!1}for(let s of this._order){let h=this._layers[s];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(let s in o){let h=this.sourceCaches[s];!!o[s]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var o;this._checkLoaded();let s=this.serialize();if(e=n.transformStyle?n.transformStyle(s,e):e,((o=n.validate)===null||o===void 0||o)&&vr(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);let h=c.aC(s,e),f=this._getOperationsToPerform(h);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(let _ of f.operations)_();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let n=[],o=[];for(let s of e)switch(s.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,s.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,s.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,s.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,s.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,s.args));break;case"addSource":n.push(()=>this.addSource.apply(this,s.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,s.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,s.args));break;case"setLight":n.push(()=>this.setLight.apply(this,s.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,s.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,s.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,s.args));break;case"setSky":n.push(()=>this.setSky.apply(this,s.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,s.args));break;case"setTransition":n.push(()=>{});break;default:o.push(s.command)}return{operations:n,unimplemented:o}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,o={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let s=this.sourceCaches[e]=new Ze(e,n,this.dispatcher);s.style=this,s.setEventedParent(this,()=>({isSourceLoaded:s.loaded(),source:s.serialize(),sourceId:e})),s.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let o in this._layers)if(this._layers[o].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${o}" is using it.`)));let n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let o=this.sourceCaches[e].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,o={}){this._checkLoaded();let s=e.id;if(this.getLayer(s))return void this.fire(new c.j(new Error(`Layer "${s}" already exists on this map.`)));let h;if(e.type==="custom"){if(vr(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(s,e.source),e=c.aB(e),e=c.e(e,{source:s})),this._validate(c.u.layer,`layers.${s}`,e,{arrayIndex:-1},o))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:s}})}let f=n?this._order.indexOf(n):this._order.length;if(n&&f===-1)this.fire(new c.j(new Error(`Cannot add layer "${s}" before non-existing layer "${n}".`)));else{if(this._order.splice(f,0,s),this._layerOrderChanged=!0,this._layers[s]=h,this._removedLayers[s]&&h.source&&h.type!=="custom"){let _=this._removedLayers[s];delete this._removedLayers[s],_.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;let o=this._order.indexOf(e);this._order.splice(o,1);let s=n?this._order.indexOf(n):this._order.length;n&&s===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);let o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,o){this._checkLoaded();let s=this.getLayer(e);s?s.minzoom===n&&s.maxzoom===o||(n!=null&&(s.minzoom=n),o!=null&&(s.maxzoom=o),this._updateLayer(s)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,o={}){this._checkLoaded();let s=this.getLayer(e);if(s){if(!c.aE(s.filter,n))return n==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(c.u.filter,`layers.${s.id}.filter`,n,null,o)||(s.filter=c.aB(n),this._updateLayer(s)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,o,s={}){this._checkLoaded();let h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),o)||(h.setLayoutProperty(n,o,s),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){let o=this.getLayer(e);if(o)return o.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,o,s={}){this._checkLoaded();let h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),o)||(h.setPaintProperty(n,o,s)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let o=e.source,s=e.sourceLayer,h=this.sourceCaches[o];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)));let f=h.getSource().type;f==="geojson"&&s?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||s?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(s,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();let o=e.source,s=this.sourceCaches[o];if(s===void 0)return void this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)));let h=s.getSource().type,f=h==="vector"?e.sourceLayer:void 0;h!=="vector"||f?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(f,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let n=e.source,o=e.sourceLayer,s=this.sourceCaches[n];if(s!==void 0)return s.getSource().type!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),s.getFeatureState(o,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),o=this.map.getTerrain()||void 0,s=this.stylesheet;return c.aG({version:s.version,name:s.name,metadata:s.metadata,light:s.light,sky:s.sky,center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,sprite:s.sprite,glyphs:s.glyphs,transition:s.transition,sources:e,layers:n,terrain:o},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let n=f=>this._layers[f].type==="fill-extrusion",o={},s=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_)){o[_]=f;for(let x of e){let k=x[_];if(k)for(let M of k)s.push(M)}}}s.sort((f,_)=>_.intersectionZ-f.intersectionZ);let h=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_))for(let x=s.length-1;x>=0;x--){let k=s[x].feature;if(o[k.layer.id]<f)break;h.push(k),s.pop()}else for(let x of e){let k=x[_];if(k)for(let M of k)h.push(M.feature)}}return h}queryRenderedFeatures(e,n,o){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);let s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(let _ of n.layers){let x=this._layers[_];if(!x)return this.fire(new c.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];s[x.source]=!0}}let h=[];n.availableImages=this._availableImages;let f=this._serializedAllLayers();for(let _ in this.sourceCaches)n.layers&&!s[_]||h.push(fn(this.sourceCaches[_],this._layers,f,e,n,o));return this.placement&&h.push(function(_,x,k,M,I,z,F){let O={},q=z.queryRenderedSymbols(M),Z=[];for(let G of Object.keys(q).map(Number))Z.push(F[G]);Z.sort(gn);for(let G of Z){let W=G.featureIndex.lookupSymbolFeatures(q[G.bucketInstanceId],x,G.bucketIndex,G.sourceLayerIndex,I.filter,I.layers,I.availableImages,_);for(let V in W){let Y=O[V]=O[V]||[],Q=W[V];Q.sort((re,ue)=>{let _e=G.featureSortOrder;if(_e){let Se=_e.indexOf(re.featureIndex);return _e.indexOf(ue.featureIndex)-Se}return ue.featureIndex-re.featureIndex});for(let re of Q)Y.push(re)}}for(let G in O)O[G].forEach(W=>{let V=W.feature,Y=k[_[G].source].getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=Y});return O}(this._layers,f,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);let o=this.sourceCaches[e];return o?function(s,h){let f=s.getRenderableIds().map(k=>s.getTileByID(k)),_=[],x={};for(let k=0;k<f.length;k++){let M=f[k],I=M.tileID.canonical.key;x[I]||(x[I]=!0,M.querySourceFeatures(_,h))}return _}(o,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();let o=this.light.getLight(),s=!1;for(let f in e)if(!c.aE(e[f],o[f])){s=!0;break}if(!s)return;let h={now:ge.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){let o=this.getSky(),s=!1;if(!e&&!o)return;if(e&&!o)s=!0;else if(!e&&o)s=!0;else for(let f in e)if(!c.aE(e[f],o[f])){s=!0;break}if(!s)return;let h={now:ge.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,o,s,h={}){return(!h||h.validate!==!1)&&vr(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:o,styleSpec:c.v},s)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Br().off(ye,this._rtlPluginLoaded);for(let n in this._layers)this._layers[n].setEventedParent(null);for(let n in this.sourceCaches){let o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,o,s,h=!1){let f=!1,_=!1,x={};for(let k of this._order){let M=this._layers[k];if(M.type!=="symbol")continue;if(!x[M.source]){let z=this.sourceCaches[M.source];x[M.source]=z.getRenderableIds(!0).map(F=>z.getTileByID(F)).sort((F,O)=>O.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(O.tileID)?-1:1))}let I=this.crossTileSymbolIndex.addLayer(M,x[M.source],e.center.lng);f=f||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ge.now(),e.zoom))&&(this.pauseablePlacement=new fo(e,this.map.terrain,this._order,h,n,o,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ge.now()),_=!0),f&&this.pauseablePlacement.placement.setStale()),_||f)for(let k of this._order){let M=this._layers[k];M.type==="symbol"&&this.placement.updateLayerOpacities(M,x[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ge.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){let o=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();let s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,n.icons),o})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){let o=yield this.glyphManager.getGlyphs(n.stacks),s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,[""]),o})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,o={},s){this._checkLoaded();let h=[{id:e,url:n}],f=[...zr(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",f,null,o)||(this.stylesheet.sprite=f,this._loadSprite(h,!0,s))}removeSprite(e){this._checkLoaded();let n=zr(this.stylesheet.sprite);if(n.find(o=>o.id===e)){if(this._spritesImagesIds[e])for(let o of this._spritesImagesIds[e])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return zr(this.stylesheet.sprite)}setSprite(e,n={},o){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,o):(this._unloadSprite(),o&&o(null)))}}var jn=c.Y([{name:"a_pos",type:"Int16",components:2}]);let xn={prelude:mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:mt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mt(d,e){let n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=e.match(/attribute ([\w]+) ([\w]+)/g),s=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=h?h.concat(s):s,_={};return{fragmentSource:d=d.replace(n,(x,k,M,I,z)=>(_[z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${M} ${I} ${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = u_${z};
#endif
`)),vertexSource:e=e.replace(n,(x,k,M,I,z)=>{let F=I==="float"?"vec2":"vec4",O=z.match(/color/)?"color":F;return _[z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${M} ${F} a_${z};
varying ${M} ${I} ${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${M} ${F} a_${z};
#else
uniform ${M} ${I} u_${z};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = a_${z};
#else
    ${M} ${I} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${M} ${I} ${z} = unpack_mix_${O}(a_${z}, u_${z}_t);
#else
    ${M} ${I} ${z} = u_${z};
#endif
`}),staticAttributes:o,staticUniforms:f}}class _l{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,o,s,h,f,_,x,k){this.context=e;let M=this.boundPaintVertexBuffers.length!==s.length;for(let I=0;!M&&I<s.length;I++)this.boundPaintVertexBuffers[I]!==s[I]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||M||this.boundIndexBuffer!==h||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==k?this.freshBind(n,o,s,h,f,_,x,k):(e.bindVertexArray.set(this.vao),_&&_.bind(),h&&h.dynamicDraw&&h.bind(),x&&x.bind(),k&&k.bind())}freshBind(e,n,o,s,h,f,_,x){let k=e.numAttributes,M=this.context,I=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=s,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=x,n.enableAttributes(I,e);for(let z of o)z.enableAttributes(I,e);f&&f.enableAttributes(I,e),_&&_.enableAttributes(I,e),x&&x.enableAttributes(I,e),n.bind(),n.setVertexAttribPointers(I,e,h);for(let z of o)z.bind(),z.setVertexAttribPointers(I,e,h);f&&(f.bind(),f.setVertexAttribPointers(I,e,h)),s&&s.bind(),_&&(_.bind(),_.setVertexAttribPointers(I,e,h)),x&&(x.bind(),x.setVertexAttribPointers(I,e,h)),M.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let yl=(d,e,n,o,s)=>({u_matrix:d,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:o?o.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?o.calculateFogBlendOpacity(s):0,u_horizon_color:o?o.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1});function va(d){let e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;let o=d[n].split(" ");e.push(o.pop())}return e}class vl{constructor(e,n,o,s,h,f){let _=e.gl;this.program=_.createProgram();let x=va(n.staticAttributes),k=o?o.getBinderAttributes():[],M=x.concat(k),I=xn.prelude.staticUniforms?va(xn.prelude.staticUniforms):[],z=n.staticUniforms?va(n.staticUniforms):[],F=o?o.getBinderUniforms():[],O=I.concat(z).concat(F),q=[];for(let re of O)q.indexOf(re)<0&&q.push(re);let Z=o?o.defines():[];h&&Z.push("#define OVERDRAW_INSPECTOR;"),f&&Z.push("#define TERRAIN3D;");let G=Z.concat(xn.prelude.fragmentSource,n.fragmentSource).join(`
`),W=Z.concat(xn.prelude.vertexSource,n.vertexSource).join(`
`),V=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(V,G),_.compileShader(V),!_.getShaderParameter(V,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(V)}`);_.attachShader(this.program,V);let Y=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(Y,W),_.compileShader(Y),!_.getShaderParameter(Y,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(Y)}`);_.attachShader(this.program,Y),this.attributes={};let Q={};this.numAttributes=M.length;for(let re=0;re<this.numAttributes;re++)M[re]&&(_.bindAttribLocation(this.program,re,M[re]),this.attributes[M[re]]=re);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(Y),_.deleteShader(V);for(let re=0;re<q.length;re++){let ue=q[re];if(ue&&!Q[ue]){let _e=_.getUniformLocation(this.program,ue);_e&&(Q[ue]=_e)}}this.fixedUniforms=s(e,Q),this.terrainUniforms=((re,ue)=>({u_depth:new c.aH(re,ue.u_depth),u_terrain:new c.aH(re,ue.u_terrain),u_terrain_dim:new c.aI(re,ue.u_terrain_dim),u_terrain_matrix:new c.aJ(re,ue.u_terrain_matrix),u_terrain_unpack:new c.aK(re,ue.u_terrain_unpack),u_terrain_exaggeration:new c.aI(re,ue.u_terrain_exaggeration)}))(e,Q),this.binderUniforms=o?o.getUniforms(e,Q):[]}draw(e,n,o,s,h,f,_,x,k,M,I,z,F,O,q,Z,G,W){let V=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(o),e.setStencilMode(s),e.setColorMode(h),e.setCullFace(f),x){e.activeTexture.set(V.TEXTURE2),V.bindTexture(V.TEXTURE_2D,x.depthTexture),e.activeTexture.set(V.TEXTURE3),V.bindTexture(V.TEXTURE_2D,x.texture);for(let Q in this.terrainUniforms)this.terrainUniforms[Q].set(x[Q])}for(let Q in this.fixedUniforms)this.fixedUniforms[Q].set(_[Q]);q&&q.setUniforms(e,this.binderUniforms,F,{zoom:O});let Y=0;switch(n){case V.LINES:Y=2;break;case V.TRIANGLES:Y=3;break;case V.LINE_STRIP:Y=1}for(let Q of z.get()){let re=Q.vaos||(Q.vaos={});(re[k]||(re[k]=new _l)).bind(e,this,M,q?q.getPaintVertexBuffers():[],I,Q.vertexOffset,Z,G,W),V.drawElements(n,Q.primitiveLength*Y,V.UNSIGNED_SHORT,Q.primitiveOffset*Y*2)}}}function os(d,e,n){let o=1/at(n,1,e.transform.tileZoom),s=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/s,f=h*(n.tileID.canonical.x+n.tileID.wrap*s),_=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}let go=(d,e,n,o)=>{let s=e.style.light,h=s.properties.get("position"),f=[h.x,h.y,h.z],_=function(){var k=new c.A(9);return c.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();s.properties.get("anchor")==="viewport"&&function(k,M){var I=Math.sin(M),z=Math.cos(M);k[0]=z,k[1]=I,k[2]=0,k[3]=-I,k[4]=z,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(_,-e.transform.angle),function(k,M,I){var z=M[0],F=M[1],O=M[2];k[0]=z*I[0]+F*I[3]+O*I[6],k[1]=z*I[1]+F*I[4]+O*I[7],k[2]=z*I[2]+F*I[5]+O*I[8]}(f,f,_);let x=s.properties.get("color");return{u_matrix:d,u_lightpos:f,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+n,u_opacity:o}},ss=(d,e,n,o,s,h,f)=>c.e(go(d,e,n,o),os(h,e,f),{u_height_factor:-Math.pow(2,s.overscaledZ)/f.tileSize/8}),xa=d=>({u_matrix:d}),Rc=(d,e,n,o)=>c.e(xa(d),os(n,e,o)),yd=(d,e)=>({u_matrix:d,u_world:e}),Fc=(d,e,n,o,s)=>c.e(Rc(d,e,n,o),{u_world:s}),vd=(d,e,n,o)=>{let s=d.transform,h,f;if(o.paint.get("circle-pitch-alignment")==="map"){let _=at(n,1,s.zoom);h=!0,f=[_,_]}else h=!1,f=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:f}},qn=(d,e,n)=>({u_matrix:d,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),_o=(d,e,n=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:n}),Di=d=>({u_matrix:d}),zi=(d,e,n,o)=>({u_matrix:d,u_extrude_scale:at(e,1,n),u_intensity:o}),ls=(d,e,n,o)=>{let s=c.H();c.aP(s,0,d.width,d.height,0,0,1);let h=d.context.gl;return{u_matrix:s,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:o,u_opacity:e.paint.get("heatmap-opacity")}};function cs(d,e){let n=Math.pow(2,e.canonical.z),o=e.canonical.y;return[new c.Z(0,o/n).toLngLat().lat,new c.Z(0,(o+1)/n).toLngLat().lat]}let hs=(d,e,n,o)=>{let s=d.transform;return{u_matrix:Vc(d,e,n,o),u_ratio:1/at(e,1,s.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Bc=(d,e,n,o,s)=>c.e(hs(d,e,n,s),{u_image:0,u_image_height:o}),ba=(d,e,n,o,s)=>{let h=d.transform,f=Oc(e,h);return{u_matrix:Vc(d,e,n,s),u_texsize:e.imageAtlasTexture.size,u_ratio:1/at(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},xd=(d,e,n,o,s,h)=>{let f=d.lineAtlas,_=Oc(e,d.transform),x=n.layout.get("line-cap")==="round",k=f.getDash(o.from,x),M=f.getDash(o.to,x),I=k.width*s.fromScale,z=M.width*s.toScale;return c.e(hs(d,e,n,h),{u_patternscale_a:[_/I,-k.height/2],u_patternscale_b:[_/z,-M.height/2],u_sdfgamma:f.width/(256*Math.min(I,z)*d.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:M.y,u_mix:s.t})};function Oc(d,e){return 1/at(d,1,e.tileZoom)}function Vc(d,e,n,o){return d.translatePosMatrix(o?o.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let bd=(d,e,n,o,s)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(f=s.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(h=s.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:wd(s.paint.get("raster-hue-rotate"))};var h,f};function wd(d){d*=Math.PI/180;let e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}let Nc=(d,e,n,o,s,h,f,_,x,k,M,I,z,F)=>{let O=f.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:O.width/O.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:k,u_is_text:+I,u_pitch_with_map:+o,u_is_along_line:s,u_is_variable_anchor:h,u_texsize:z,u_texture:0,u_translation:M,u_pitched_scale:F}},yo=(d,e,n,o,s,h,f,_,x,k,M,I,z,F,O)=>{let q=f.transform;return c.e(Nc(d,e,n,o,s,h,f,_,x,k,M,I,z,O),{u_gamma_scale:o?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+F})},xl=(d,e,n,o,s,h,f,_,x,k,M,I,z,F)=>c.e(yo(d,e,n,o,s,h,f,_,x,k,M,!0,I,!0,F),{u_texsize_icon:z,u_texture_icon:1}),ds=(d,e,n)=>({u_matrix:d,u_opacity:e,u_color:n}),bl=(d,e,n,o,s,h)=>c.e(function(f,_,x,k){let M=x.imageManager.getPattern(f.from.toString()),I=x.imageManager.getPattern(f.to.toString()),{width:z,height:F}=x.imageManager.getPixelSize(),O=Math.pow(2,k.tileID.overscaledZ),q=k.tileSize*Math.pow(2,x.transform.tileZoom)/O,Z=q*(k.tileID.canonical.x+k.tileID.wrap*O),G=q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[z,F],u_mix:_.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/at(k,1,x.transform.tileZoom),u_pixel_coord_upper:[Z>>16,G>>16],u_pixel_coord_lower:[65535&Z,65535&G]}}(o,h,n,s),{u_matrix:d,u_opacity:e}),wl={fillExtrusion:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_opacity:new c.aI(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_height_factor:new c.aI(d,e.u_height_factor),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade),u_opacity:new c.aI(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(d,e.u_scale_with_map),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_extrude_scale:new c.aO(d,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_matrix:new c.aJ(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_pixel_extrude_scale:new c.aO(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_inv_matrix:new c.aJ(d,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_viewport_size:new c.aO(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.aL(d,e.u_color),u_matrix:new c.aJ(d,e.u_matrix),u_overlay:new c.aH(d,e.u_overlay),u_overlay_scale:new c.aI(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new c.aI(d,e.u_extrude_scale),u_intensity:new c.aI(d,e.u_intensity),u_matrix:new c.aJ(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_color_ramp:new c.aH(d,e.u_color_ramp),u_opacity:new c.aI(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_latrange:new c.aO(d,e.u_latrange),u_light:new c.aO(d,e.u_light),u_shadow:new c.aL(d,e.u_shadow),u_highlight:new c.aL(d,e.u_highlight),u_accent:new c.aL(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_dimension:new c.aO(d,e.u_dimension),u_zoom:new c.aI(d,e.u_zoom),u_unpack:new c.aK(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_image:new c.aH(d,e.u_image),u_image_height:new c.aI(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texsize:new c.aO(d,e.u_texsize),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_image:new c.aH(d,e.u_image),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_patternscale_a:new c.aO(d,e.u_patternscale_a),u_patternscale_b:new c.aO(d,e.u_patternscale_b),u_sdfgamma:new c.aI(d,e.u_sdfgamma),u_image:new c.aH(d,e.u_image),u_tex_y_a:new c.aI(d,e.u_tex_y_a),u_tex_y_b:new c.aI(d,e.u_tex_y_b),u_mix:new c.aI(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_tl_parent:new c.aO(d,e.u_tl_parent),u_scale_parent:new c.aI(d,e.u_scale_parent),u_buffer_scale:new c.aI(d,e.u_buffer_scale),u_fade_t:new c.aI(d,e.u_fade_t),u_opacity:new c.aI(d,e.u_opacity),u_image0:new c.aH(d,e.u_image0),u_image1:new c.aH(d,e.u_image1),u_brightness_low:new c.aI(d,e.u_brightness_low),u_brightness_high:new c.aI(d,e.u_brightness_high),u_saturation_factor:new c.aI(d,e.u_saturation_factor),u_contrast_factor:new c.aI(d,e.u_contrast_factor),u_spin_weights:new c.aN(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texsize_icon:new c.aO(d,e.u_texsize_icon),u_texture:new c.aH(d,e.u_texture),u_texture_icon:new c.aH(d,e.u_texture_icon),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),background:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_color:new c.aL(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_image:new c.aH(d,e.u_image),u_pattern_tl_a:new c.aO(d,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(d,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(d,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(d,e.u_pattern_br_b),u_texsize:new c.aO(d,e.u_texsize),u_mix:new c.aI(d,e.u_mix),u_pattern_size_a:new c.aO(d,e.u_pattern_size_a),u_pattern_size_b:new c.aO(d,e.u_pattern_size_b),u_scale_a:new c.aI(d,e.u_scale_a),u_scale_b:new c.aI(d,e.u_scale_b),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_ele_delta:new c.aI(d,e.u_ele_delta),u_fog_matrix:new c.aJ(d,e.u_fog_matrix),u_fog_color:new c.aL(d,e.u_fog_color),u_fog_ground_blend:new c.aI(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon_fog_blend:new c.aI(d,e.u_horizon_fog_blend)}),terrainDepth:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ele_delta:new c.aI(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_terrain_coords_id:new c.aI(d,e.u_terrain_coords_id),u_ele_delta:new c.aI(d,e.u_ele_delta)}),sky:(d,e)=>({u_sky_color:new c.aL(d,e.u_sky_color),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon:new c.aI(d,e.u_horizon),u_sky_horizon_blend:new c.aI(d,e.u_sky_horizon_blend)})};class Nr{constructor(e,n,o){this.context=e;let s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kl{constructor(e,n,o,s){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=s,this.context=e;let h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let o=0;o<this.attributes.length;o++){let s=n.attributes[this.attributes[o].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,n,o){for(let s=0;s<this.attributes.length;s++){let h=this.attributes[s],f=n.attributes[h.name];f!==void 0&&e.vertexAttribPointer(f,h.components,e[kd[h.type]],!1,this.itemSize,h.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Un=new WeakMap;function bn(d){var e;if(Un.has(d))return Un.get(d);{let n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Un.set(d,n),n}}class ft{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class us extends ft{getDefault(){return c.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Cd extends ft{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class wa extends ft{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sd extends ft{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jc extends ft{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Md extends ft{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class qc extends ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Cl extends ft{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Uc extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class $c extends ft{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Zc extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Gc extends ft{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class $n extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Hc extends ft{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Id extends ft{getDefault(){return c.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wc extends ft{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class vo extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Td extends ft{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ps extends ft{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ed extends ft{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ad extends ft{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Xc extends ft{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Kc extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Yc extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Sl extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Jc extends ft{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ms extends ft{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rn extends ft{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;let o=this.gl;bn(o)?o.bindVertexArray(e):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ml extends ft{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Il extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Tl extends ft{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fs extends ft{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class El extends fs{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Zn extends fs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Al extends fs{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pd{constructor(e,n,o,s,h){this.context=e,this.width=n,this.height=o;let f=e.gl,_=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new El(e,_),s)this.depthAttachment=h?new Al(e,_):new Zn(e,_);else if(h)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){let o=this.depthAttachment.get();o&&e.deleteRenderbuffer(o)}e.deleteFramebuffer(this.framebuffer)}}class Bt{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}Bt.Replace=[1,0],Bt.disabled=new Bt(Bt.Replace,c.aM.transparent,[!1,!1,!1,!1]),Bt.unblended=new Bt(Bt.Replace,c.aM.transparent,[!0,!0,!0,!0]),Bt.alphaBlended=new Bt([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Dd{constructor(e){var n,o;if(this.gl=e,this.clearColor=new us(this),this.clearDepth=new Cd(this),this.clearStencil=new wa(this),this.colorMask=new Sd(this),this.depthMask=new jc(this),this.stencilMask=new Md(this),this.stencilFunc=new qc(this),this.stencilOp=new Cl(this),this.stencilTest=new Uc(this),this.depthRange=new $c(this),this.depthTest=new Zc(this),this.depthFunc=new Gc(this),this.blend=new $n(this),this.blendFunc=new Hc(this),this.blendColor=new Id(this),this.blendEquation=new Wc(this),this.cullFace=new vo(this),this.cullFaceSide=new Td(this),this.frontFace=new ps(this),this.program=new Ed(this),this.activeTexture=new Ad(this),this.viewport=new Xc(this),this.bindFramebuffer=new Kc(this),this.bindRenderbuffer=new Yc(this),this.bindTexture=new Sl(this),this.bindVertexBuffer=new Jc(this),this.bindElementBuffer=new ms(this),this.bindVertexArray=new rn(this),this.pixelStoreUnpack=new Ml(this),this.pixelStoreUnpackPremultiplyAlpha=new Il(this),this.pixelStoreUnpackFlipY=new Tl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),bn(e)){this.HALF_FLOAT=e.HALF_FLOAT;let s=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:s?.RGBA16F_EXT,this.RGB16F=(o=e.RGB16F)!==null&&o!==void 0?o:s?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let s=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=s?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Nr(this,e,n)}createVertexBuffer(e,n,o){return new kl(this,e,n,o)}createRenderbuffer(e,n,o){let s=this.gl,h=s.createRenderbuffer();return this.bindRenderbuffer.set(h),s.renderbufferStorage(s.RENDERBUFFER,e,n,o),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,o,s){return new Pd(this,e,n,o,s)}clear({color:e,depth:n,stencil:o}){let s=this.gl,h=0;e&&(h|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(h|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),s.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Bt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return bn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return bn(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class it{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}it.ReadOnly=!1,it.ReadWrite=!0,it.disabled=new it(519,it.ReadOnly,[0,1]);let gs=7680;class Ct{constructor(e,n,o,s,h,f){this.test=e,this.ref=n,this.mask=o,this.fail=s,this.depthFail=h,this.pass=f}}Ct.disabled=new Ct({func:519,mask:0},0,0,gs,gs,gs);class vt{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}let Gn;function xo(d,e,n,o,s){let h=d.context,f=h.gl,_=d.useProgram("collisionBox"),x=[],k=0,M=0;for(let G=0;G<o.length;G++){let W=o[G],V=e.getTile(W).getBucket(n);if(!V)continue;let Y=s?V.textCollisionBox:V.iconCollisionBox,Q=V.collisionCircleArray;if(Q.length>0){let re=c.H();c.aQ(re,V.placementInvProjMatrix,d.transform.glCoordMatrix),c.aQ(re,re,V.placementViewportMatrix),x.push({circleArray:Q,circleOffset:M,transform:W.posMatrix,invTransform:re,coord:W}),k+=Q.length/4,M=k}Y&&_.draw(h,f.LINES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,{u_matrix:W.posMatrix,u_pixel_extrude_scale:[1/(I=d.transform).width,1/I.height]},d.style.map.terrain&&d.style.map.terrain.getTerrainData(W),n.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,null,d.transform.zoom,null,null,Y.collisionVertexBuffer)}var I;if(!s||!x.length)return;let z=d.useProgram("collisionCircle"),F=new c.aR;F.resize(4*k),F._trim();let O=0;for(let G of x)for(let W=0;W<G.circleArray.length/4;W++){let V=4*W,Y=G.circleArray[V+0],Q=G.circleArray[V+1],re=G.circleArray[V+2],ue=G.circleArray[V+3];F.emplace(O++,Y,Q,re,ue,0),F.emplace(O++,Y,Q,re,ue,1),F.emplace(O++,Y,Q,re,ue,2),F.emplace(O++,Y,Q,re,ue,3)}(!Gn||Gn.length<2*k)&&(Gn=function(G){let W=2*G,V=new c.aT;V.resize(W),V._trim();for(let Y=0;Y<W;Y++){let Q=6*Y;V.uint16[Q+0]=4*Y+0,V.uint16[Q+1]=4*Y+1,V.uint16[Q+2]=4*Y+2,V.uint16[Q+3]=4*Y+2,V.uint16[Q+4]=4*Y+3,V.uint16[Q+5]=4*Y+0}return V}(k));let q=h.createIndexBuffer(Gn,!0),Z=h.createVertexBuffer(F,c.aS.members,!0);for(let G of x){let W=qn(G.transform,G.invTransform,d.transform);z.draw(h,f.TRIANGLES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,W,d.style.map.terrain&&d.style.map.terrain.getTerrainData(G.coord),n.id,Z,q,c.a0.simpleSegment(0,2*G.circleOffset,G.circleArray.length,G.circleArray.length/2),null,d.transform.zoom,null,null,null)}Z.destroy(),q.destroy()}vt.disabled=new vt(!1,1029,2305),vt.backCCW=new vt(!0,1029,2305);let bo=c.an(new Float32Array(16));function Pl(d,e,n,o,s,h){let{horizontalAlign:f,verticalAlign:_}=c.au(d);return new c.P((-(f-.5)*e/s+o[0])*h,(-(_-.5)*n/s+o[1])*h)}function Hn(d,e,n,o,s,h){let f=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let _=o.mult(h);n||(_=_.rotate(-s));let x=f.add(_);return U(x.x,x.y,e.labelPlaneMatrix,e.getElevation).point}if(n){let _=le(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),x=Math.atan(_.y/_.x)+(_.x<0?Math.PI:0);return d.add(o.rotate(x))}return d.add(o)}function ka(d,e,n,o,s,h,f,_,x,k,M,I,z,F){let O=d.text.placedSymbolArray,q=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,G={};q.clear();for(let W=0;W<O.length;W++){let V=O.get(W),Y=V.hidden||!V.crossTileID||d.allowVerticalPlacement&&!V.placedOrientation?null:o[V.crossTileID];if(Y){let Q=new c.P(V.anchorX,V.anchorY),re={getElevation:F,width:s.width,height:s.height,labelPlaneMatrix:h,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:Q,translation:I,unwrappedTileID:z},ue=n?U(Q.x,Q.y,f,F):le(Q.x,Q.y,re),_e=A(s.cameraToCenterDistance,ue.signedDistanceFromCamera),Se=c.ai(d.textSizeData,x,V)*_e/c.ap;n&&(Se*=d.tilePixelRatio/_);let{width:Ee,height:be,anchor:xe,textOffset:Re,textBoxScale:We}=Y,ke=Pl(xe,Ee,be,Re,We,Se),Ie=M.getPitchedTextCorrection(s,Q.add(new c.P(I[0],I[1])),z),Ge=Hn(ue.point,re,e,ke,s.angle,Ie),Tt=d.allowVerticalPlacement&&V.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Qe=0;Qe<V.numGlyphs;Qe++)c.aj(q,Ge,Tt);k&&V.associatedIconIndex>=0&&(G[V.associatedIconIndex]={shiftedAnchor:Ge,angle:Tt})}else je(V.numGlyphs,q)}if(k){Z.clear();let W=d.icon.placedSymbolArray;for(let V=0;V<W.length;V++){let Y=W.get(V);if(Y.hidden)je(Y.numGlyphs,Z);else{let Q=G[V];if(Q)for(let re=0;re<Y.numGlyphs;re++)c.aj(Z,Q.shiftedAnchor,Q.angle);else je(Y.numGlyphs,Z)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(q)}function ar(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Dl(d,e,n,o,s,h,f,_,x,k,M,I){let z=d.context,F=z.gl,O=d.transform,q=Nn(),Z=_==="map",G=x==="map",W=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",V=Z&&!G&&!W,Y=!G&&W,Q=!n.layout.get("symbol-sort-key").isConstant(),re=!1,ue=d.depthModeForSublayer(0,it.ReadOnly),_e=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],Ee=q.getCircleRadiusCorrection(O);for(let be of o){let xe=e.getTile(be),Re=xe.getBucket(n);if(!Re)continue;let We=s?Re.text:Re.icon;if(!We||!We.segments.get().length||!We.hasVisibleVertices)continue;let ke=We.programConfigurations.get(n.id),Ie=s||Re.sdfIcons,Ge=s?Re.textSizeData:Re.iconSizeData,Tt=G||O.pitch!==0,Qe=d.useProgram(ar(Ie,s,Re),ke),ot=c.ag(Ge,O.zoom),Et=d.style.map.terrain&&d.style.map.terrain.getTerrainData(be),hi,wr,At,Li,wi=[0,0],di=null;if(s)wr=xe.glyphAtlasTexture,At=F.LINEAR,hi=xe.glyphAtlasTexture.size,Re.iconsInText&&(wi=xe.imageAtlasTexture.size,di=xe.imageAtlasTexture,Li=Tt||d.options.rotating||d.options.zooming||Ge.kind==="composite"||Ge.kind==="camera"?F.LINEAR:F.NEAREST);else{let lt=n.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;wr=xe.imageAtlasTexture,At=Ie||d.options.rotating||d.options.zooming||lt||Tt?F.LINEAR:F.NEAREST,hi=xe.imageAtlasTexture.size}let ki=at(xe,1,d.transform.zoom),Ur=Y?be.posMatrix:bo,Va=vn(Ur,G,Z,d.transform,ki),Rs=Vr(Ur,G,Z,d.transform,ki),Na=Vr(be.posMatrix,G,Z,d.transform,ki),lr=q.translatePosition(d.transform,xe,h,f),Fs=_e&&Re.hasTextData(),rc=n.layout.get("icon-text-fit")!=="none"&&Fs&&Re.hasIconData();if(W){let lt=d.style.map.terrain?(ja,qa)=>d.style.map.terrain.getElevation(be,ja,qa):null,Jn=n.layout.get("text-rotation-alignment")==="map";B(Re,be.posMatrix,d,s,Va,Na,G,k,Jn,q,be.toUnwrapped(),O.width,O.height,lr,lt)}let cr=be.posMatrix,hr=s&&_e||rc,wn=W||hr?bo:Va,kr=Rs,ai=Ie&&n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ui;ui=Ie?Re.iconsInText?xl(Ge.kind,ot,V,G,W,hr,d,cr,wn,kr,lr,hi,wi,Ee):yo(Ge.kind,ot,V,G,W,hr,d,cr,wn,kr,lr,s,hi,!0,Ee):Nc(Ge.kind,ot,V,G,W,hr,d,cr,wn,kr,lr,s,hi,Ee);let Yi={program:Qe,buffers:We,uniformValues:ui,atlasTexture:wr,atlasTextureIcon:di,atlasInterpolation:At,atlasInterpolationIcon:Li,isSDF:Ie,hasHalo:ai};if(Q&&Re.canOverlap){re=!0;let lt=We.segments.get();for(let Jn of lt)Se.push({segments:new c.a0([Jn]),sortKey:Jn.sortKey,state:Yi,terrainData:Et})}else Se.push({segments:We.segments,sortKey:0,state:Yi,terrainData:Et})}re&&Se.sort((be,xe)=>be.sortKey-xe.sortKey);for(let be of Se){let xe=be.state;if(z.activeTexture.set(F.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,F.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(z.activeTexture.set(F.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),xe.isSDF){let Re=xe.uniformValues;xe.hasHalo&&(Re.u_is_halo=1,zl(xe.buffers,be.segments,n,d,xe.program,ue,M,I,Re,be.terrainData)),Re.u_is_halo=0}zl(xe.buffers,be.segments,n,d,xe.program,ue,M,I,xe.uniformValues,be.terrainData)}}function zl(d,e,n,o,s,h,f,_,x,k){let M=o.context;s.draw(M,M.gl.TRIANGLES,h,f,_,vt.disabled,x,k,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,o.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Ll(d,e,n,o){let s=d.context,h=s.gl,f=Ct.disabled,_=new Bt([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),x=e.getBucket(n);if(!x)return;let k=o.key,M=n.heatmapFbos.get(k);M||(M=wo(s,e.tileSize,e.tileSize),n.heatmapFbos.set(k,M)),s.bindFramebuffer.set(M.framebuffer),s.viewport.set([0,0,e.tileSize,e.tileSize]),s.clear({color:c.aM.transparent});let I=x.programConfigurations.get(n.id),z=d.useProgram("heatmap",I),F=d.style.map.terrain.getTerrainData(o);z.draw(s,h.TRIANGLES,it.disabled,f,_,vt.disabled,zi(o.posMatrix,e,d.transform.zoom,n.paint.get("heatmap-intensity")),F,n.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,n.paint,d.transform.zoom,I)}function Wn(d,e,n){let o=d.context,s=o.gl;o.setColorMode(d.colorModeForRenderPass());let h=ko(o,e),f=n.key,_=e.heatmapFbos.get(f);_&&(o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,_.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),h.bind(s.LINEAR,s.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(o,s.TRIANGLES,it.disabled,Ct.disabled,d.colorModeForRenderPass(),vt.disabled,ls(d,e,0,1),null,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,d.transform.zoom),_.destroy(),e.heatmapFbos.delete(f))}function wo(d,e,n){var o,s;let h=d.gl,f=h.createTexture();h.bindTexture(h.TEXTURE_2D,f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);let _=(o=d.HALF_FLOAT)!==null&&o!==void 0?o:h.UNSIGNED_BYTE,x=(s=d.RGBA16F)!==null&&s!==void 0?s:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,x,e,n,0,h.RGBA,_,null);let k=d.createFramebuffer(e,n,!1,!1);return k.colorAttachment.set(f),k}function ko(d,e){return e.colorRampTexture||(e.colorRampTexture=new yt(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function Ca(d,e,n,o,s){if(!n||!o||!o.imageAtlas)return;let h=o.imageAtlas.patternPositions,f=h[n.to.toString()],_=h[n.from.toString()];if(!f&&_&&(f=_),!_&&f&&(_=f),!f||!_){let x=s.getPaintProperty(e);f=h[x],_=h[x]}f&&_&&d.setConstantPatternPositions(f,_)}function Co(d,e,n,o,s,h,f){let _=d.context.gl,x="fill-pattern",k=n.paint.get(x),M=k&&k.constantOr(1),I=n.getCrossfadeParameters(),z,F,O,q,Z;f?(F=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=_.LINES):(F=M?"fillPattern":"fill",z=_.TRIANGLES);let G=k.constantOr(null);for(let W of o){let V=e.getTile(W);if(M&&!V.patternsLoaded())continue;let Y=V.getBucket(n);if(!Y)continue;let Q=Y.programConfigurations.get(n.id),re=d.useProgram(F,Q),ue=d.style.map.terrain&&d.style.map.terrain.getTerrainData(W);M&&(d.context.activeTexture.set(_.TEXTURE0),V.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),Q.updatePaintBuffers(I)),Ca(Q,x,G,V,n);let _e=ue?W:null,Se=d.translatePosMatrix(_e?_e.posMatrix:W.posMatrix,V,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(f){q=Y.indexBuffer2,Z=Y.segments2;let Ee=[_.drawingBufferWidth,_.drawingBufferHeight];O=F==="fillOutlinePattern"&&M?Fc(Se,d,I,V,Ee):yd(Se,Ee)}else q=Y.indexBuffer,Z=Y.segments,O=M?Rc(Se,d,I,V):xa(Se);re.draw(d.context,z,s,d.stencilModeForClipping(W),h,vt.disabled,O,ue,n.id,Y.layoutVertexBuffer,q,Z,n.paint,d.transform.zoom,Q)}}function _s(d,e,n,o,s,h,f){let _=d.context,x=_.gl,k="fill-extrusion-pattern",M=n.paint.get(k),I=M.constantOr(1),z=n.getCrossfadeParameters(),F=n.paint.get("fill-extrusion-opacity"),O=M.constantOr(null);for(let q of o){let Z=e.getTile(q),G=Z.getBucket(n);if(!G)continue;let W=d.style.map.terrain&&d.style.map.terrain.getTerrainData(q),V=G.programConfigurations.get(n.id),Y=d.useProgram(I?"fillExtrusionPattern":"fillExtrusion",V);I&&(d.context.activeTexture.set(x.TEXTURE0),Z.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),V.updatePaintBuffers(z)),Ca(V,k,O,Z,n);let Q=d.translatePosMatrix(q.posMatrix,Z,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),re=n.paint.get("fill-extrusion-vertical-gradient"),ue=I?ss(Q,d,re,F,q,z,Z):go(Q,d,re,F);Y.draw(_,_.gl.TRIANGLES,s,h,f,vt.backCCW,ue,W,n.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,n.paint,d.transform.zoom,V,d.style.map.terrain&&G.centroidVertexBuffer)}}function Sa(d,e,n,o,s,h,f){let _=d.context,x=_.gl,k=n.fbo;if(!k)return;let M=d.useProgram("hillshade"),I=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,k.colorAttachment.get()),M.draw(_,x.TRIANGLES,s,h,f,vt.disabled,((z,F,O,q)=>{let Z=O.paint.get("hillshade-shadow-color"),G=O.paint.get("hillshade-highlight-color"),W=O.paint.get("hillshade-accent-color"),V=O.paint.get("hillshade-illumination-direction")*(Math.PI/180);O.paint.get("hillshade-illumination-anchor")==="viewport"&&(V-=z.transform.angle);let Y=!z.options.moving;return{u_matrix:q?q.posMatrix:z.transform.calculatePosMatrix(F.tileID.toUnwrapped(),Y),u_image:0,u_latrange:cs(0,F.tileID),u_light:[O.paint.get("hillshade-exaggeration"),V],u_shadow:Z,u_highlight:G,u_accent:W}})(d,n,o,I?e:null),I,o.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Ma(d,e,n,o,s,h){let f=d.context,_=f.gl,x=e.dem;if(x&&x.data){let k=x.dim,M=x.stride,I=x.getPixels();if(f.activeTexture.set(_.TEXTURE1),f.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(M),e.demTexture){let F=e.demTexture;F.update(I,{premultiply:!1}),F.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else e.demTexture=new yt(f,I,_.RGBA,{premultiply:!1}),e.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);f.activeTexture.set(_.TEXTURE0);let z=e.fbo;if(!z){let F=new yt(f,{width:k,height:k,data:null},_.RGBA);F.bind(_.LINEAR,_.CLAMP_TO_EDGE),z=e.fbo=f.createFramebuffer(k,k,!0,!1),z.colorAttachment.set(F.texture)}f.bindFramebuffer.set(z.framebuffer),f.viewport.set([0,0,k,k]),d.useProgram("hillshadePrepare").draw(f,_.TRIANGLES,o,s,h,vt.disabled,((F,O)=>{let q=O.stride,Z=c.H();return c.aP(Z,0,c.X,-c.X,0,0,1),c.J(Z,Z,[0,-c.X,0]),{u_matrix:Z,u_image:1,u_dimension:[q,q],u_zoom:F.overscaledZ,u_unpack:O.getUnpackVector()}})(e.tileID,x),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Qc(d,e,n,o,s,h){let f=o.paint.get("raster-fade-duration");if(!h&&f>0){let _=ge.now(),x=(_-d.timeAdded)/f,k=e?(_-e.timeAdded)/f:-1,M=n.getSource(),I=s.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),z=!e||Math.abs(e.tileID.overscaledZ-I)>Math.abs(d.tileID.overscaledZ-I),F=z&&d.refreshedUponExpiration?1:c.ac(z?x:1-k,0,1);return d.refreshedUponExpiration&&x>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}let Rl=new c.aM(1,0,0,1),dt=new c.aM(0,1,0,1),ys=new c.aM(0,0,1,1),zd=new c.aM(1,0,1,1),eh=new c.aM(0,1,1,1);function Ia(d,e,n,o){vs(d,0,e+n/2,d.transform.width,n,o)}function th(d,e,n,o){vs(d,e-n/2,0,n,d.transform.height,o)}function vs(d,e,n,o,s,h){let f=d.context,_=f.gl;_.enable(_.SCISSOR_TEST),_.scissor(e*d.pixelRatio,n*d.pixelRatio,o*d.pixelRatio,s*d.pixelRatio),f.clear({color:h}),_.disable(_.SCISSOR_TEST)}function ih(d,e,n){let o=d.context,s=o.gl,h=n.posMatrix,f=d.useProgram("debug"),_=it.disabled,x=Ct.disabled,k=d.colorModeForRenderPass(),M="$debug",I=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);o.activeTexture.set(s.TEXTURE0);let z=e.getTileByID(n.key).latestRawTileData,F=Math.floor((z&&z.byteLength||0)/1024),O=e.getTile(n).tileSize,q=512/Math.min(O,512)*(n.overscaledZ/d.transform.zoom)*.5,Z=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Z+=` => ${n.overscaledZ}`),function(G,W){G.initDebugOverlayCanvas();let V=G.debugOverlayCanvas,Y=G.context.gl,Q=G.debugOverlayCanvas.getContext("2d");Q.clearRect(0,0,V.width,V.height),Q.shadowColor="white",Q.shadowBlur=2,Q.lineWidth=1.5,Q.strokeStyle="white",Q.textBaseline="top",Q.font="bold 36px Open Sans, sans-serif",Q.fillText(W,5,5),Q.strokeText(W,5,5),G.debugOverlayTexture.update(V),G.debugOverlayTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}(d,`${Z} ${F}kB`),f.draw(o,s.TRIANGLES,_,x,Bt.alphaBlended,vt.disabled,_o(h,c.aM.transparent,q),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),f.draw(o,s.LINE_STRIP,_,x,k,vt.disabled,_o(h,c.aM.red),I,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function rh(d,e,n){let o=d.context,s=o.gl,h=d.colorModeForRenderPass(),f=new it(s.LEQUAL,it.ReadWrite,d.depthRangeFor3D),_=d.useProgram("terrain"),x=e.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,d.width,d.height]);for(let k of n){let M=d.renderToTexture.getTexture(k),I=e.getTerrainData(k.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,M.texture);let z=d.transform.calculatePosMatrix(k.tileID.toUnwrapped()),F=e.getMeshFrameDelta(d.transform.zoom),O=d.transform.calculateFogMatrix(k.tileID.toUnwrapped()),q=yl(z,F,O,d.style.sky,d.transform.pitch);_.draw(o,s.TRIANGLES,f,Ct.disabled,h,vt.backCCW,q,I,"terrain",x.vertexBuffer,x.indexBuffer,x.segments)}}class xs{constructor(e,n,o){this.vertexBuffer=e,this.indexBuffer=n,this.segments=o}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class bs{constructor(e,n){this.context=new Dd(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ze.maxUnderzooming+Ze.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gl}resize(e,n,o){if(this.width=Math.floor(e*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let s of this.style._order)this.style._layers[s].resize()}setup(){let e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,jn.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);let o=new c.aX;o.emplaceBack(0,0),o.emplaceBack(c.X,0),o.emplaceBack(0,c.X),o.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(o,jn.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);let s=new c.$;s.emplaceBack(0,0,0,0),s.emplaceBack(c.X,0,c.X,0),s.emplaceBack(0,c.X,0,c.X),s.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(s,_n.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);let h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,jn.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);let f=new c.aZ;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(f);let _=new c.aY;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(_);let x=this.context.gl;this.stencilClearMode=new Ct({func:x.ALWAYS,mask:0},0,255,x.ZERO,x.ZERO,x.ZERO)}clearStencil(){let e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let o=c.H();c.aP(o,0,this.width,this.height,0,0,1),c.K(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,it.disabled,this.stencilClearMode,Bt.disabled,vt.disabled,Di(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;let o=this.context,s=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Bt.disabled),o.setDepthMode(it.disabled);let h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let f of n){let _=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,x=this.style.map.terrain&&this.style.map.terrain.getTerrainData(f);h.draw(o,s.TRIANGLES,it.disabled,new Ct({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),Bt.disabled,vt.disabled,Di(f.posMatrix),x,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new Ct({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){let n=this.context.gl;return new Ct({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){let n=this.context.gl,o=e.sort((f,_)=>_.overscaledZ-f.overscaledZ),s=o[o.length-1].overscaledZ,h=o[0].overscaledZ-s+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();let f={};for(let _=0;_<h;_++)f[_+s]=new Ct({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[f,o]}return[{[s]:Ct.disabled},o]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Bt([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Bt.unblended:Bt.alphaBlended}depthModeForSublayer(e,n,o){if(!this.opaquePassEnabledForLayer())return it.disabled;let s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new it(o||this.context.gl.LEQUAL,n,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ge.now()),this.imageManager.beginFrame();let o=this.style._order,s=this.style.sourceCaches,h={},f={},_={};for(let x in s){let k=s[x];k.used&&k.prepare(this.context),h[x]=k.getVisibleCoordinates(),f[x]=h[x].slice().reverse(),_[x]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let x=0;x<o.length;x++)if(this.style._layers[o[x]].is3D()){this.opaquePassCutoff=x;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let x of o){let k=this.style._layers[x];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;let M=f[k.source];(k.type==="custom"||M.length)&&this.renderLayer(this,s[k.source],k,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(x,k){let M=x.context,I=M.gl,z=((G,W,V)=>({u_sky_color:G.properties.get("sky-color"),u_horizon_color:G.properties.get("horizon-color"),u_horizon:(W.height/2+W.getHorizon())*V,u_sky_horizon_blend:G.properties.get("sky-horizon-blend")*W.height/2*V}))(k,x.style.map.transform,x.pixelRatio),F=new it(I.LEQUAL,it.ReadWrite,[0,1]),O=Ct.disabled,q=x.colorModeForRenderPass(),Z=x.useProgram("sky");if(!k.mesh){let G=new c.aX;G.emplaceBack(-1,-1),G.emplaceBack(1,-1),G.emplaceBack(1,1),G.emplaceBack(-1,1);let W=new c.aY;W.emplaceBack(0,1,2),W.emplaceBack(0,2,3),k.mesh=new xs(M.createVertexBuffer(G,jn.members),M.createIndexBuffer(W),c.a0.simpleSegment(0,0,G.length,W.length))}Z.draw(M,I.TRIANGLES,F,O,q,vt.disabled,z,void 0,"sky",k.mesh.vertexBuffer,k.mesh.indexBuffer,k.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){let x=this.style._layers[o[this.currentLayer]],k=s[x.source],M=h[x.source];this._renderTileClippingMasks(x,M),this.renderLayer(this,k,x,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){let x=this.style._layers[o[this.currentLayer]],k=s[x.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(x))continue;let M=(x.type==="symbol"?_:f)[x.source];this._renderTileClippingMasks(x,h[x.source]),this.renderLayer(this,k,x,M)}if(this.options.showTileBoundaries){let x=function(k,M){let I=null,z=Object.values(k._layers).flatMap(Z=>Z.source&&!Z.isHidden(M)?[k.sourceCaches[Z.source]]:[]),F=z.filter(Z=>Z.getSource().type==="vector"),O=z.filter(Z=>Z.getSource().type!=="vector"),q=Z=>{(!I||I.getSource().maxzoom<Z.getSource().maxzoom)&&(I=Z)};return F.forEach(Z=>q(Z)),I||O.forEach(Z=>q(Z)),I}(this.style,this.transform.zoom);x&&function(k,M,I){for(let z=0;z<I.length;z++)ih(k,M,I[z])}(this,x,x.getVisibleCoordinates())}this.options.showPadding&&function(x){let k=x.transform.padding;Ia(x,x.transform.height-(k.top||0),3,Rl),Ia(x,k.bottom||0,3,dt),th(x,k.left||0,3,ys),th(x,x.transform.width-(k.right||0),3,zd);let M=x.transform.centerPoint;(function(I,z,F,O){vs(I,z-1,F-10,2,20,O),vs(I,z-10,F-1,20,2,O)})(x,M.x,x.transform.height-M.y,eh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let n=this.terrainFacilitator.matrix,o=this.transform.modelViewProjectionMatrix,s=this.terrainFacilitator.dirty;s||(s=e?!c.a_(n,o):!c.a$(n,o)),s||(s=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),s&&(c.b0(n,o),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,f){let _=h.context,x=_.gl,k=Bt.unblended,M=new it(x.LEQUAL,it.ReadWrite,[0,1]),I=f.getTerrainMesh(),z=f.sourceCache.getRenderableTiles(),F=h.useProgram("terrainDepth");_.bindFramebuffer.set(f.getFramebuffer("depth").framebuffer),_.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),_.clear({color:c.aM.transparent,depth:1});for(let O of z){let q=f.getTerrainData(O.tileID),Z={u_matrix:h.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_ele_delta:f.getMeshFrameDelta(h.transform.zoom)};F.draw(_,x.TRIANGLES,M,Ct.disabled,k,vt.backCCW,Z,q,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,f){let _=h.context,x=_.gl,k=Bt.unblended,M=new it(x.LEQUAL,it.ReadWrite,[0,1]),I=f.getTerrainMesh(),z=f.getCoordsTexture(),F=f.sourceCache.getRenderableTiles(),O=h.useProgram("terrainCoords");_.bindFramebuffer.set(f.getFramebuffer("coords").framebuffer),_.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),_.clear({color:c.aM.transparent,depth:1}),f.coordsIndex=[];for(let q of F){let Z=f.getTerrainData(q.tileID);_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,z.texture);let G={u_matrix:h.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-f.coordsIndex.length)/255,u_texture:0,u_ele_delta:f.getMeshFrameDelta(h.transform.zoom)};O.draw(_,x.TRIANGLES,M,Ct.disabled,k,vt.backCCW,G,Z,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),f.coordsIndex.push(q.tileID.key)}_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,o,s){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(s||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(h,f,_,x,k){if(h.renderPass!=="translucent")return;let M=Ct.disabled,I=h.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(z,F,O,q,Z,G,W,V,Y){let Q=F.transform,re=Nn(),ue=Z==="map",_e=G==="map";for(let Se of z){let Ee=q.getTile(Se),be=Ee.getBucket(O);if(!be||!be.text||!be.text.segments.get().length)continue;let xe=c.ag(be.textSizeData,Q.zoom),Re=at(Ee,1,F.transform.zoom),We=vn(Se.posMatrix,_e,ue,F.transform,Re),ke=O.layout.get("icon-text-fit")!=="none"&&be.hasIconData();if(xe){let Ie=Math.pow(2,Q.zoom-Ee.tileID.overscaledZ),Ge=F.style.map.terrain?(Qe,ot)=>F.style.map.terrain.getElevation(Se,Qe,ot):null,Tt=re.translatePosition(Q,Ee,W,V);ka(be,ue,_e,Y,Q,We,Se.posMatrix,Ie,xe,ke,re,Tt,Se.toUnwrapped(),Ge)}}}(x,h,_,f,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),k),_.paint.get("icon-opacity").constantOr(1)!==0&&Dl(h,f,_,x,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),M,I),_.paint.get("text-opacity").constantOr(1)!==0&&Dl(h,f,_,x,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),M,I),f.map.showCollisionBoxes&&(xo(h,f,_,x,!0),xo(h,f,_,x,!1))})(e,n,o,s,this.style.placement.variableOffsets);break;case"circle":(function(h,f,_,x){if(h.renderPass!=="translucent")return;let k=_.paint.get("circle-opacity"),M=_.paint.get("circle-stroke-width"),I=_.paint.get("circle-stroke-opacity"),z=!_.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(M.constantOr(1)===0||I.constantOr(1)===0))return;let F=h.context,O=F.gl,q=h.depthModeForSublayer(0,it.ReadOnly),Z=Ct.disabled,G=h.colorModeForRenderPass(),W=[];for(let V=0;V<x.length;V++){let Y=x[V],Q=f.getTile(Y),re=Q.getBucket(_);if(!re)continue;let ue=re.programConfigurations.get(_.id),_e=h.useProgram("circle",ue),Se=re.layoutVertexBuffer,Ee=re.indexBuffer,be=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Y),xe={programConfiguration:ue,program:_e,layoutVertexBuffer:Se,indexBuffer:Ee,uniformValues:vd(h,Y,Q,_),terrainData:be};if(z){let Re=re.segments.get();for(let We of Re)W.push({segments:new c.a0([We]),sortKey:We.sortKey,state:xe})}else W.push({segments:re.segments,sortKey:0,state:xe})}z&&W.sort((V,Y)=>V.sortKey-Y.sortKey);for(let V of W){let{programConfiguration:Y,program:Q,layoutVertexBuffer:re,indexBuffer:ue,uniformValues:_e,terrainData:Se}=V.state;Q.draw(F,O.TRIANGLES,q,Z,G,vt.disabled,_e,Se,_.id,re,ue,V.segments,_.paint,h.transform.zoom,Y)}})(e,n,o,s);break;case"heatmap":(function(h,f,_,x){if(_.paint.get("heatmap-opacity")===0)return;let k=h.context;if(h.style.map.terrain){for(let M of x){let I=f.getTile(M);f.hasRenderableParent(M)||(h.renderPass==="offscreen"?Ll(h,I,_,M):h.renderPass==="translucent"&&Wn(h,_,M))}k.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(M,I,z,F){let O=M.context,q=O.gl,Z=Ct.disabled,G=new Bt([q.ONE,q.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(W,V,Y){let Q=W.gl;W.activeTexture.set(Q.TEXTURE1),W.viewport.set([0,0,V.width/4,V.height/4]);let re=Y.heatmapFbos.get(c.aU);re?(Q.bindTexture(Q.TEXTURE_2D,re.colorAttachment.get()),W.bindFramebuffer.set(re.framebuffer)):(re=wo(W,V.width/4,V.height/4),Y.heatmapFbos.set(c.aU,re))})(O,M,z),O.clear({color:c.aM.transparent});for(let W=0;W<F.length;W++){let V=F[W];if(I.hasRenderableParent(V))continue;let Y=I.getTile(V),Q=Y.getBucket(z);if(!Q)continue;let re=Q.programConfigurations.get(z.id),ue=M.useProgram("heatmap",re),{zoom:_e}=M.transform;ue.draw(O,q.TRIANGLES,it.disabled,Z,G,vt.disabled,zi(V.posMatrix,Y,_e,z.paint.get("heatmap-intensity")),null,z.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,z.paint,M.transform.zoom,re)}O.viewport.set([0,0,M.width,M.height])}(h,f,_,x):h.renderPass==="translucent"&&function(M,I){let z=M.context,F=z.gl;z.setColorMode(M.colorModeForRenderPass());let O=I.heatmapFbos.get(c.aU);O&&(z.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,O.colorAttachment.get()),z.activeTexture.set(F.TEXTURE1),ko(z,I).bind(F.LINEAR,F.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(z,F.TRIANGLES,it.disabled,Ct.disabled,M.colorModeForRenderPass(),vt.disabled,ls(M,I,0,1),null,I.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,I.paint,M.transform.zoom))}(h,_)})(e,n,o,s);break;case"line":(function(h,f,_,x){if(h.renderPass!=="translucent")return;let k=_.paint.get("line-opacity"),M=_.paint.get("line-width");if(k.constantOr(1)===0||M.constantOr(1)===0)return;let I=h.depthModeForSublayer(0,it.ReadOnly),z=h.colorModeForRenderPass(),F=_.paint.get("line-dasharray"),O=_.paint.get("line-pattern"),q=O.constantOr(1),Z=_.paint.get("line-gradient"),G=_.getCrossfadeParameters(),W=q?"linePattern":F?"lineSDF":Z?"lineGradient":"line",V=h.context,Y=V.gl,Q=!0;for(let re of x){let ue=f.getTile(re);if(q&&!ue.patternsLoaded())continue;let _e=ue.getBucket(_);if(!_e)continue;let Se=_e.programConfigurations.get(_.id),Ee=h.context.program.get(),be=h.useProgram(W,Se),xe=Q||be.program!==Ee,Re=h.style.map.terrain&&h.style.map.terrain.getTerrainData(re),We=O.constantOr(null);if(We&&ue.imageAtlas){let Ge=ue.imageAtlas,Tt=Ge.patternPositions[We.to.toString()],Qe=Ge.patternPositions[We.from.toString()];Tt&&Qe&&Se.setConstantPatternPositions(Tt,Qe)}let ke=Re?re:null,Ie=q?ba(h,ue,_,G,ke):F?xd(h,ue,_,F,G,ke):Z?Bc(h,ue,_,_e.lineClipsArray.length,ke):hs(h,ue,_,ke);if(q)V.activeTexture.set(Y.TEXTURE0),ue.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Se.updatePaintBuffers(G);else if(F&&(xe||h.lineAtlas.dirty))V.activeTexture.set(Y.TEXTURE0),h.lineAtlas.bind(V);else if(Z){let Ge=_e.gradients[_.id],Tt=Ge.texture;if(_.gradientVersion!==Ge.version){let Qe=256;if(_.stepInterpolant){let ot=f.getSource().maxzoom,Et=re.canonical.z===ot?Math.ceil(1<<h.transform.maxZoom-re.canonical.z):1;Qe=c.ac(c.aV(_e.maxLineLength/c.X*1024*Et),256,V.maxTextureSize)}Ge.gradient=c.aW({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:Ge.gradient||void 0,clips:_e.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new yt(V,Ge.gradient,Y.RGBA),Ge.version=_.gradientVersion,Tt=Ge.texture}V.activeTexture.set(Y.TEXTURE0),Tt.bind(_.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}be.draw(V,Y.TRIANGLES,I,h.stencilModeForClipping(re),z,vt.disabled,Ie,Re,_.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,_.paint,h.transform.zoom,Se,_e.layoutVertexBuffer2),Q=!1}})(e,n,o,s);break;case"fill":(function(h,f,_,x){let k=_.paint.get("fill-color"),M=_.paint.get("fill-opacity");if(M.constantOr(1)===0)return;let I=h.colorModeForRenderPass(),z=_.paint.get("fill-pattern"),F=h.opaquePassEnabledForLayer()&&!z.constantOr(1)&&k.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===F){let O=h.depthModeForSublayer(1,h.renderPass==="opaque"?it.ReadWrite:it.ReadOnly);Co(h,f,_,x,O,I,!1)}if(h.renderPass==="translucent"&&_.paint.get("fill-antialias")){let O=h.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,it.ReadOnly);Co(h,f,_,x,O,I,!0)}})(e,n,o,s);break;case"fill-extrusion":(function(h,f,_,x){let k=_.paint.get("fill-extrusion-opacity");if(k!==0&&h.renderPass==="translucent"){let M=new it(h.context.gl.LEQUAL,it.ReadWrite,h.depthRangeFor3D);if(k!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))_s(h,f,_,x,M,Ct.disabled,Bt.disabled),_s(h,f,_,x,M,h.stencilModeFor3D(),h.colorModeForRenderPass());else{let I=h.colorModeForRenderPass();_s(h,f,_,x,M,Ct.disabled,I)}}})(e,n,o,s);break;case"hillshade":(function(h,f,_,x){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;let k=h.context,M=h.depthModeForSublayer(0,it.ReadOnly),I=h.colorModeForRenderPass(),[z,F]=h.renderPass==="translucent"?h.stencilConfigForOverlap(x):[{},x];for(let O of F){let q=f.getTile(O);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&h.renderPass==="offscreen"?Ma(h,q,_,M,Ct.disabled,I):h.renderPass==="translucent"&&Sa(h,O,q,_,M,z[O.overscaledZ],I)}k.viewport.set([0,0,h.width,h.height])})(e,n,o,s);break;case"raster":(function(h,f,_,x){if(h.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!x.length)return;let k=h.context,M=k.gl,I=f.getSource(),z=h.useProgram("raster"),F=h.colorModeForRenderPass(),[O,q]=I instanceof en?[{},x]:h.stencilConfigForOverlap(x),Z=q[q.length-1].overscaledZ,G=!h.options.moving;for(let W of q){let V=h.depthModeForSublayer(W.overscaledZ-Z,_.paint.get("raster-opacity")===1?it.ReadWrite:it.ReadOnly,M.LESS),Y=f.getTile(W);Y.registerFadeDuration(_.paint.get("raster-fade-duration"));let Q=f.findLoadedParent(W,0),re=f.findLoadedSibling(W),ue=Qc(Y,Q||re||null,f,_,h.transform,h.style.map.terrain),_e,Se,Ee=_.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;k.activeTexture.set(M.TEXTURE0),Y.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(M.TEXTURE1),Q?(Q.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,Q.tileID.overscaledZ-Y.tileID.overscaledZ),Se=[Y.tileID.canonical.x*_e%1,Y.tileID.canonical.y*_e%1]):Y.texture.bind(Ee,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Y.texture.useMipmap&&k.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let be=h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),xe=be?W:null,Re=xe?xe.posMatrix:h.transform.calculatePosMatrix(W.toUnwrapped(),G),We=bd(Re,Se||[0,0],_e||1,ue,_);I instanceof en?z.draw(k,M.TRIANGLES,V,Ct.disabled,F,vt.disabled,We,be,_.id,I.boundsBuffer,h.quadTriangleIndexBuffer,I.boundsSegments):z.draw(k,M.TRIANGLES,V,O[W.overscaledZ],F,vt.disabled,We,be,_.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,o,s);break;case"background":(function(h,f,_,x){let k=_.paint.get("background-color"),M=_.paint.get("background-opacity");if(M===0)return;let I=h.context,z=I.gl,F=h.transform,O=F.tileSize,q=_.paint.get("background-pattern");if(h.isPatternMissing(q))return;let Z=!q&&k.a===1&&M===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==Z)return;let G=Ct.disabled,W=h.depthModeForSublayer(0,Z==="opaque"?it.ReadWrite:it.ReadOnly),V=h.colorModeForRenderPass(),Y=h.useProgram(q?"backgroundPattern":"background"),Q=x||F.coveringTiles({tileSize:O,terrain:h.style.map.terrain});q&&(I.activeTexture.set(z.TEXTURE0),h.imageManager.bind(h.context));let re=_.getCrossfadeParameters();for(let ue of Q){let _e=x?ue.posMatrix:h.transform.calculatePosMatrix(ue.toUnwrapped()),Se=q?bl(_e,M,h,q,{tileID:ue,tileSize:O},re):ds(_e,M,k),Ee=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ue);Y.draw(I,z.TRIANGLES,W,G,V,vt.disabled,Se,Ee,_.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,o,s);break;case"custom":(function(h,f,_){let x=h.context,k=_.implementation;if(h.renderPass==="offscreen"){let M=k.prerender;M&&(h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),M.call(k,x.gl,h.transform.customLayerMatrix()),x.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),x.setColorMode(h.colorModeForRenderPass()),x.setStencilMode(Ct.disabled);let M=k.renderingMode==="3d"?new it(h.context.gl.LEQUAL,it.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,it.ReadOnly);x.setDepthMode(M),k.render(x.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),x.setDirty(),h.setBaseState(),x.bindFramebuffer.set(null)}})(e,0,o)}}translatePosMatrix(e,n,o,s,h){if(!o[0]&&!o[1])return e;let f=h?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(f){let k=Math.sin(f),M=Math.cos(f);o=[o[0]*M-o[1]*k,o[0]*k+o[1]*M]}let _=[h?o[0]:at(n,o[0],this.transform.zoom),h?o[1]:at(n,o[1],this.transform.zoom),0],x=new Float32Array(16);return c.J(x,e,_),x}saveTileTexture(e){let n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let n=this.imageManager.getPattern(e.from.toString()),o=this.imageManager.getPattern(e.to.toString());return!n||!o}useProgram(e,n){this.cache=this.cache||{};let o=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new vl(this.context,xn[e],n,wl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new yt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class Ta{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o){let s=Math.pow(2,o),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{let x=1/(_=c.af([],_,e))[3]/n*s;return c.b1(_,_,[x,x,1/_[3],x])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{let x=function(z,F){var O=F[0],q=F[1],Z=F[2],G=O*O+q*q+Z*Z;return G>0&&(G=1/Math.sqrt(G)),z[0]=F[0]*G,z[1]=F[1]*G,z[2]=F[2]*G,z}([],function(z,F,O){var q=F[0],Z=F[1],G=F[2],W=O[0],V=O[1],Y=O[2];return z[0]=Z*Y-G*V,z[1]=G*W-q*Y,z[2]=q*V-Z*W,z}([],ir([],h[_[0]],h[_[1]]),ir([],h[_[2]],h[_[1]]))),k=-((M=x)[0]*(I=h[_[1]])[0]+M[1]*I[1]+M[2]*I[2]);var M,I;return x.concat(k)});return new Ta(h,f)}}class Ea{constructor(e,n){this.min=e,this.max=n,this.center=function(o,s,h){return o[0]=.5*s[0],o[1]=.5*s[1],o[2]=.5*s[2],o}([],function(o,s,h){return o[0]=s[0]+h[0],o[1]=s[1]+h[1],o[2]=s[2]+h[2],o}([],this.min,this.max))}quadrant(e){let n=[e%2==0,e<2],o=pr(this.min),s=pr(this.max);for(let h=0;h<n.length;h++)o[h]=n[h]?this.min[h]:this.center[h],s[h]=n[h]?this.center[h]:this.max[h];return s[2]=this.max[2],new Ea(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],o=!0;for(let s=0;s<e.planes.length;s++){let h=e.planes[s],f=0;for(let _=0;_<n.length;_++)c.b2(h,n[_])>=0&&f++;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let s=0;s<3;s++){let h=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){let x=e.points[_][s]-this.min[s];h=Math.min(h,x),f=Math.max(f,x)}if(f<0||h>this.max[s]-this.min[s])return 0}return 1}}class Aa{constructor(e=0,n=0,o=0,s=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=o,this.right=s}interpolate(e,n,o){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,o)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,o)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,o)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,o)),this}getCenter(e,n){let o=c.ac((this.left+e-this.right)/2,0,e),s=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(o,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Fl=85.051129;class Pa{constructor(e,n,o,s,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=s??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Aa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){let e=new Pa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new c.A(4);return c.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,s,h){var f=s[0],_=s[1],x=s[2],k=s[3],M=Math.sin(h),I=Math.cos(h);o[0]=f*I+x*M,o[1]=_*I+k*M,o[2]=f*-M+x*I,o[3]=_*-M+k*I}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,o){this._unmodified=!1,this._edgeInsets.interpolate(e,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){let n=[new c.b4(0,e)];if(this._renderWorldCopies){let o=this.pointCoordinate(new c.P(0,0)),s=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),f=this.pointCoordinate(new c.P(0,this.height)),_=Math.floor(Math.min(o.x,s.x,h.x,f.x)),x=Math.floor(Math.max(o.x,s.x,h.x,f.x)),k=1;for(let M=_-k;M<=x+k;M++)M!==0&&n.push(new c.b4(M,e))}return n}coveringTiles(e){var n,o;let s=this.coveringZoomLevel(e),h=s;if(e.minzoom!==void 0&&s<e.minzoom)return[];e.maxzoom!==void 0&&s>e.maxzoom&&(s=e.maxzoom);let f=this.pointCoordinate(this.getCameraPoint()),_=c.Z.fromLngLat(this.center),x=Math.pow(2,s),k=[x*f.x,x*f.y,0],M=[x*_.x,x*_.y,0],I=Ta.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,s),z=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(z=s);let F=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,O=V=>({aabb:new Ea([V*x,0,0],[(V+1)*x,x,0]),zoom:0,x:0,y:0,wrap:V,fullyVisible:!1}),q=[],Z=[],G=s,W=e.reparseOverscaled?h:s;if(this._renderWorldCopies)for(let V=1;V<=3;V++)q.push(O(-V)),q.push(O(V));for(q.push(O(0));q.length>0;){let V=q.pop(),Y=V.x,Q=V.y,re=V.fullyVisible;if(!re){let be=V.aabb.intersects(I);if(be===0)continue;re=be===2}let ue=e.terrain?k:M,_e=V.aabb.distanceX(ue),Se=V.aabb.distanceY(ue),Ee=Math.max(Math.abs(_e),Math.abs(Se));if(V.zoom===G||Ee>F+(1<<G-V.zoom)-2&&V.zoom>=z){let be=G-V.zoom,xe=k[0]-.5-(Y<<be),Re=k[1]-.5-(Q<<be);Z.push({tileID:new c.S(V.zoom===G?W:V.zoom,V.wrap,V.zoom,Y,Q),distanceSq:ts([M[0]-.5-Y,M[1]-.5-Q]),tileDistanceToCamera:Math.sqrt(xe*xe+Re*Re)})}else for(let be=0;be<4;be++){let xe=(Y<<1)+be%2,Re=(Q<<1)+(be>>1),We=V.zoom+1,ke=V.aabb.quadrant(be);if(e.terrain){let Ie=new c.S(We,V.wrap,We,xe,Re),Ge=e.terrain.getMinMaxElevation(Ie),Tt=(n=Ge.minElevation)!==null&&n!==void 0?n:this.elevation,Qe=(o=Ge.maxElevation)!==null&&o!==void 0?o:this.elevation;ke=new Ea([ke.min[0],ke.min[1],Tt],[ke.max[0],ke.max[1],Qe])}q.push({aabb:ke,zoom:We,x:xe,y:Re,wrap:V.wrap,fullyVisible:re})}}return Z.sort((V,Y)=>V.distanceSq-Y.distanceSq).map(V=>V.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let n=c.ac(e.lat,-85.051129,Fl);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let n=this.elevation,o=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,s=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-h))return;let f=o+n-h,_=Math.cos(this._pitch)*this.cameraToCenterDistance/f/c.b5(1,s.lat),x=this.scaleZoom(_/this.tileSize);this._elevation=h,this._center=s,this.zoom=x}setLocationAtPoint(e,n){let o=this.pointCoordinate(n),s=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),f=new c.Z(h.x-(o.x-s.x),h.y-(o.y-s.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){let z=n.pointCoordinate(e);if(z!=null)return z}let o=[e.x,e.y,0,1],s=[e.x,e.y,1,1];c.af(o,o,this.pixelMatrixInverse),c.af(s,s,this.pixelMatrixInverse);let h=o[3],f=s[3],_=o[1]/h,x=s[1]/f,k=o[2]/h,M=s[2]/f,I=k===M?0:(0-k)/(M-k);return new c.Z(c.y.number(o[0]/h,s[0]/f,I)/this.worldSize,c.y.number(_,x,I)/this.worldSize)}coordinatePoint(e,n=0,o=this.pixelMatrix){let s=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(s,s,o),new c.P(s[0]/s[3],s[1]/s[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new ae().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ae([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Fl])}calculateTileMatrix(e){let n=e.canonical,o=this.worldSize/this.zoomScale(n.z),s=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[s*o,n.y*o,0]),c.K(h,h,[o/c.X,o/c.X,1]),h}calculatePosMatrix(e,n=!1){let o=e.key,s=n?this._alignedPosMatrixCache:this._posMatrixCache;if(s[o])return s[o];let h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),s[o]=new Float32Array(h),s[o]}calculateFogMatrix(e){let n=e.key,o=this._fogMatrixCache;if(o[n])return o[n];let s=this.calculateTileMatrix(e);return c.L(s,this.fogMatrix,s),o[n]=new Float32Array(s),o[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);let o={center:new c.N(e.lng,e.lat),zoom:n},s=this.lngRange;if(!this._renderWorldCopies&&s===null){let V=179.9999999999;s=[-V,V]}let h=this.tileSize*this.zoomScale(o.zoom),f=0,_=h,x=0,k=h,M=0,I=0,{x:z,y:F}=this.size;if(this.latRange){let V=this.latRange;f=c.Q(V[1])*h,_=c.Q(V[0])*h,_-f<F&&(M=F/(_-f))}s&&(x=c.b3(c.O(s[0])*h,0,h),k=c.b3(c.O(s[1])*h,0,h),k<x&&(k+=h),k-x<z&&(I=z/(k-x)));let{x:O,y:q}=this.project.call({worldSize:h},e),Z,G,W=Math.max(I||0,M||0);if(W){let V=new c.P(I?(k+x)/2:O,M?(_+f)/2:q);return o.center=this.unproject.call({worldSize:h},V).wrap(),o.zoom+=this.scaleZoom(W),o}if(this.latRange){let V=F/2;q-V<f&&(G=f+V),q+V>_&&(G=_-V)}if(s){let V=(x+k)/2,Y=O;this._renderWorldCopies&&(Y=c.b3(O,V-h/2,V+h/2));let Q=z/2;Y-Q<x&&(Z=x+Q),Y+Q>k&&(Z=k-Q)}if(Z!==void 0||G!==void 0){let V=new c.P(Z??O,G??q);o.center=this.unproject.call({worldSize:h},V).wrap()}return o}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:n,zoom:o}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=o,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let s=c.an(new Float64Array(16));c.K(s,s,[this.width/2,-this.height/2,1]),c.J(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=c.an(new Float64Array(16)),c.K(s,s,[1,-1,1]),c.J(s,s,[-1,-1,0]),c.K(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s;let h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),f=Math.min(this.elevation,this.minElevationForCurrentTile),_=h-f*this._pixelPerMeter/Math.cos(this._pitch),x=f<0?_:h,k=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),I=Math.sin(M)*x/Math.sin(c.ac(Math.PI-k-M,.01,Math.PI-.01)),z=this.getHorizon(),F=2*Math.atan(z/this.cameraToCenterDistance)*(.5+e.y/(2*z)),O=Math.sin(F)*x/Math.sin(c.ac(Math.PI-k-F,.01,Math.PI-.01)),q=Math.min(I,O);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*q+x),this.nearZ=this.height/50,s=new Float64Array(16),c.b6(s,this._fov,this.width/this.height,this.nearZ,this.farZ),s[8]=2*-e.x/this.width,s[9]=2*e.y/this.height,this.projectionMatrix=c.ae(s),c.K(s,s,[1,-1,1]),c.J(s,s,[0,0,-this.cameraToCenterDistance]),c.b7(s,s,this._pitch),c.ad(s,s,this.angle),c.J(s,s,[-n,-o,0]),this.mercatorMatrix=c.K([],s,[this.worldSize,this.worldSize,this.worldSize]),c.K(s,s,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,s),c.J(s,s,[0,0,-this.elevation]),this.modelViewProjectionMatrix=s,this.invModelViewProjectionMatrix=c.as([],s),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-o,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,s);let Z=this.width%2/2,G=this.height%2/2,W=Math.cos(this.angle),V=Math.sin(this.angle),Y=n-Math.round(n)+W*Z+V*G,Q=o-Math.round(o)+W*G+V*Z,re=new Float64Array(s);if(c.J(re,re,[Y>.5?Y-1:Y,Q>.5?Q-1:Q,0]),this.alignedModelViewProjectionMatrix=re,s=c.as(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){let n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let o=n.x,s=n.y,h=n.x,f=n.y;for(let _ of e)o=Math.min(o,_.x),s=Math.min(s,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return[new c.P(o,s),new c.P(h,s),new c.P(h,f),new c.P(o,f),new c.P(o,s)]}}lngLatToCameraDepth(e,n){let o=this.locationCoordinate(e),s=[o.x*this.worldSize,o.y*this.worldSize,n,1];return c.af(s,s,this.modelViewProjectionMatrix),s[2]/s[3]}}function So(d,e){let n,o=!1,s=null,h=null,f=()=>{s=null,o&&(d.apply(h,n),s=setTimeout(f,e),o=!1)};return(..._)=>(o=!0,h=this,n=_,s||f(),s)}class ws{constructor(e){this._getCurrentHash=()=>{let n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(o=s)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{let n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){let o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{let n=this._getCurrentHash();if(n.length===0)return;let o=n.join("/"),s=o;s.split("&").length>0&&(s=s.split("&")[0]),this._hashName&&(s=`${this._hashName}=${o}`);let h=window.location.hash.replace(s,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let f=window.location.href.replace(/(#.+)?$/,h);f=f.replace("&&","&"),window.history.replaceState(window.history.state,null,f)},this._updateHash=So(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,s=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,s),f=Math.round(n.lng*h)/h,_=Math.round(n.lat*h)/h,x=this._map.getBearing(),k=this._map.getPitch(),M="";if(M+=e?`/${f}/${_}/${o}`:`${o}/${_}/${f}`,(x||k)&&(M+="/"+Math.round(10*x)/10),k&&(M+=`/${Math.round(k)}`),this._hashName){let I=this._hashName,z=!1,F=window.location.hash.slice(1).split("&").map(O=>{let q=O.split("=")[0];return q===I?(z=!0,`${q}=${M}`):O}).filter(O=>O);return z||F.push(`${I}=${M}`),`#${F.join("&")}`}return`#${M}`}}let ks={linearity:.3,easing:c.b8(0,0,.3,1)},Bl=c.e({deceleration:2500,maxSpeed:1400},ks),Ld=c.e({deceleration:20,maxSpeed:1400},ks),nh=c.e({deceleration:1e3,maxSpeed:360},ks),Cs=c.e({deceleration:1e3,maxSpeed:90},ks);class Ol{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ge.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=ge.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){let h=Io(n.pan.mag(),o,c.e({},Bl,e||{}));s.offset=n.pan.mult(h.amount/n.pan.mag()),s.center=this._map.transform.center,Mo(s,h)}if(n.zoom){let h=Io(n.zoom,o,Ld);s.zoom=this._map.transform.zoom+h.amount,Mo(s,h)}if(n.bearing){let h=Io(n.bearing,o,nh);s.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),Mo(s,h)}if(n.pitch){let h=Io(n.pitch,o,Cs);s.pitch=this._map.transform.pitch+h.amount,Mo(s,h)}if(s.zoom||s.bearing){let h=n.pinchAround===void 0?n.around:n.pinchAround;s.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(s,{noMoveStart:!0})}}function Mo(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function Io(d,e,n){let{maxSpeed:o,linearity:s,deceleration:h}=n,f=c.ac(d*s/(e/1e3),-o,o),_=Math.abs(f)/(h*s);return{easing:n.easing,duration:1e3*_,amount:f*(_/2)}}class ci extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o,s={}){let h=se.mousePos(n.getCanvas(),o),f=n.unproject(h);super(e,c.e({point:h,lngLat:f,originalEvent:o},s)),this._defaultPrevented=!1,this.target=n}}class Xn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){let s=e==="touchend"?o.changedTouches:o.touches,h=se.touchPos(n.getCanvasContainer(),s),f=h.map(x=>n.unproject(x)),_=h.reduce((x,k,M,I)=>x.add(k.div(I.length)),new c.P(0,0));super(e,{points:h,point:_,lngLats:f,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}}class ah extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){super(e,{originalEvent:o}),this._defaultPrevented=!1}}class oh{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ah(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ci(e.type,this._map,e))}mouseup(e){this._map.fire(new ci(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ci(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ci(e.type,this._map,e))}mouseover(e){this._map.fire(new ci(e.type,this._map,e))}mouseout(e){this._map.fire(new ci(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Xn(e.type,this._map,e))}touchmove(e){this._map.fire(new Xn(e.type,this._map,e))}touchend(e){this._map.fire(new Xn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Xn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ot{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ci(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ci("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ci(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Xi{constructor(e,n){this._map=e,this._tr=new xr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(se.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;let s=this._startPos;this._lastPos=o,this._box||(this._box=se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let h=Math.min(s.x,o.x),f=Math.max(s.x,o.x),_=Math.min(s.y,o.y),x=Math.max(s.y,o.y);se.setTransform(this._box,`translate(${h}px,${_}px)`),this._box.style.width=f-h+"px",this._box.style.height=x-_+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;let o=this._startPos,s=n;if(this.reset(),se.suppressClick(),o.x!==s.x||o.y!==s.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(o,s,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(se.remove(this._box),this._box=null),se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function To(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);let n={};for(let o=0;o<d.length;o++)n[d[o].identifier]=e[o];return n}class Vl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),o.length===this.numTouches&&(this.centroid=function(s){let h=new c.P(0,0);for(let f of s)h._add(f);return h.div(s.length)}(n),this.touches=To(o,n)))}touchmove(e,n,o){if(this.aborted||!this.centroid)return;let s=To(o,n);for(let h in this.touches){let f=s[h];(!f||f.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,o){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class Ss{constructor(e){this.singleTap=new Vl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,o){this.singleTap.touchstart(e,n,o)}touchmove(e,n,o){this.singleTap.touchmove(e,n,o)}touchend(e,n,o){let s=this.singleTap.touchend(e,n,o);if(s){let h=e.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(s)<30;if(h&&f||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class Da{constructor(e){this._tr=new xr(e),this._zoomIn=new Ss({numTouches:1,numTaps:2}),this._zoomOut=new Ss({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,o){this._zoomIn.touchstart(e,n,o),this._zoomOut.touchstart(e,n,o)}touchmove(e,n,o){this._zoomIn.touchmove(e,n,o),this._zoomOut.touchmove(e,n,o)}touchend(e,n,o){let s=this._zoomIn.touchend(e,n,o),h=this._zoomOut.touchend(e,n,o),f=this._tr;return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom+1,around:f.unproject(s)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom-1,around:f.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;let o=this._lastPoint;if(!o)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let s=n.length?n[0]:n;return!this._moved&&s.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=s,this._move(o,s))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&se.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Nl={0:1,2:2};class Ms{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let n=se.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,o){let s=Nl[o];return n.buttons===void 0||(n.buttons&s)!==s}(e,this._eventButton)}isValidEndEvent(e){return se.mouseButton(e)===this._eventButton}}class jl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let Is=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}},ql=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{let o=new Ms({checkCorrectEvent:s=>se.mouseButton(s)===0&&s.ctrlKey||se.mouseButton(s)===2});return new nn({clickTolerance:e,move:(s,h)=>({bearingDelta:(h.x-s.x)*n}),moveStateManager:o,enable:d,assignEvents:Is})},Ul=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{let o=new Ms({checkCorrectEvent:s=>se.mouseButton(s)===0&&s.ctrlKey||se.mouseButton(s)===2});return new nn({clickTolerance:e,move:(s,h)=>({pitchDelta:(h.y-s.y)*n}),moveStateManager:o,enable:d,assignEvents:Is})};class Kn{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,o){return this._calculateTransform(e,n,o)}touchmove(e,n,o){if(this._active){if(!this._shouldBePrevented(o.length))return e.preventDefault(),this._calculateTransform(e,n,o);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,o){this._calculateTransform(e,n,o),this._active&&this._shouldBePrevented(o.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,o){o.length>0&&(this._active=!0);let s=To(o,n),h=new c.P(0,0),f=new c.P(0,0),_=0;for(let k in s){let M=s[k],I=this._touches[k];I&&(h._add(M),f._add(M.sub(I)),_++,s[k]=M)}if(this._touches=s,this._shouldBePrevented(_)||!f.mag())return;let x=f.div(_);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(_),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ts{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,o){if(!this._firstTwoTouches)return;e.preventDefault();let[s,h]=this._firstTwoTouches,f=Eo(o,n,s),_=Eo(o,n,h);if(!f||!_)return;let x=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],x,e)}touchend(e,n,o){if(!this._firstTwoTouches)return;let[s,h]=this._firstTwoTouches,f=Eo(o,n,s),_=Eo(o,n,h);f&&_||(this._active&&se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Eo(d,e,n){for(let o=0;o<d.length;o++)if(d[o].identifier===n)return e[o]}function $l(d,e){return Math.log(d/e)/Math.LN2}class Zl extends Ts{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let o=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs($l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$l(this._distance,o),pinchAround:n}}}function Gl(d,e){return 180*d.angleWith(e)/Math.PI}class Hl extends Ts{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,o){let s=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gl(this._vector,s),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,o=Gl(e,this._startVector);return Math.abs(o)<n}}function Es(d){return Math.abs(d.y)>Math.abs(d.x)}class za extends Ts{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,o){super.touchstart(e,n,o),this._currentTouchCount=o.length}_start(e){this._lastPoints=e,Es(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,o){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let s=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(s,h,o.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,o){if(this._valid!==void 0)return this._valid;let s=e.mag()>=2,h=n.mag()>=2;if(!s&&!h)return;if(!s||!h)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;let f=e.y>0==n.y>0;return Es(e)&&Es(n)&&f}}let sh={panStep:100,bearingStep:15,pitchStep:10};class or{constructor(e){this._tr=new xr(e);let n=sh;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,o=0,s=0,h=0,f=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?o=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?o=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),f=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(o=0,s=0),{cameraAnimation:_=>{let x=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:jr,zoom:n?Math.round(x.zoom)+n*(e.shiftKey?2:1):x.zoom,bearing:x.bearing+o*this._bearingStep,pitch:x.pitch+s*this._pitchStep,offset:[-h*this._panStep,-f*this._panStep],center:x.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jr(d){return d*(2-d)}let Wl=4.000244140625;class br{constructor(e,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=e,this._tr=new xr(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=ge.now(),s=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%Wl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=se.mousePos(this._map.getCanvas(),e),o=this._tr;this._around=n.y>o.transform.height/2-o.transform.getHorizon()?c.N.convert(this._aroundCenter?o.center:o.unproject(n)):c.N.convert(o.center),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let x=this._type==="wheel"&&Math.abs(this._delta)>Wl?this._wheelZoomRate:this._defaultZoomRate,k=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&k!==0&&(k=1/k);let M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*k))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,o=this._startZoom,s=this._easing,h,f=!1,_=ge.now()-this._lastWheelEventTime;if(this._type==="wheel"&&o&&s&&_){let x=Math.min(_/200,1),k=s(x);h=c.y.number(o,n,k),x<1?this._frameId||(this._frameId=!0):f=!0}else h=n,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){let o=this._prevEase,s=(ge.now()-o.start)/o.duration,h=o.easing(s+.01)-o.easing(s),f=.27/Math.sqrt(h*h+1e-4)*.01,_=Math.sqrt(.0729-f*f);n=c.b8(f,_,.25,1)}return this._prevEase={start:ge.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yn{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rd{constructor(e){this._tr=new xr(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fd{constructor(){this._tap=new Ss({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,o){if(!this._swipePoint)if(this._tapTime){let s=n[0],h=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(s)<30;h&&f?o.length>0&&(this._swipePoint=s,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(e,n,o)}touchmove(e,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let s=n[0],h=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,o)}touchend(e,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{let s=this._tap.touchend(e,n,o);s&&(this._tapTime=e.timeStamp,this._tapPoint=s)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lh{constructor(e,n,o){this._el=e,this._mousePan=n,this._touchPan=o}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ch{constructor(e,n,o){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xl{constructor(e,n,o,s){this._el=e,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class La{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=se.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let o=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),s=document.createElement("div");s.className="maplibregl-desktop-message",s.textContent=n,this._container.appendChild(s);let h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=o,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let sr=d=>d.zoom||d.drag||d.pitch||d.rotate;class De extends c.k{}function As(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Kl{constructor(e,n){this.handleWindowEvent=s=>{this.handleEvent(s,`${s.type}Window`)},this.handleEvent=(s,h)=>{if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let f=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},x={},k={},M=s.touches,I=M?this._getMapTouches(M):void 0,z=I?se.touchPos(this._map.getCanvas(),I):se.mousePos(this._map.getCanvas(),s);for(let{handlerName:q,handler:Z,allowed:G}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(k,G,q)?Z.reset():Z[h||s.type]&&(W=Z[h||s.type](s,z,I),this.mergeHandlerResult(_,x,W,q,f),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(k[q]=Z)}let F={};for(let q in this._previousActiveHandlers)k[q]||(F[q]=f);this._previousActiveHandlers=k,(Object.keys(F).length||As(_))&&(this._changes.push([_,x,F]),this._triggerRenderFrame()),(Object.keys(k).length||As(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ol(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(let[s,h,f]of this._listeners)se.addEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(let[e,n,o]of this._listeners)se.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(e){let n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new oh(n,e));let s=n.boxZoom=new Xi(n,e);this._add("boxZoom",s),e.interactive&&e.boxZoom&&s.enable();let h=n.cooperativeGestures=new La(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();let f=new Da(n),_=new Rd(n);n.doubleClickZoom=new Yn(_,f),this._add("tapZoom",f),this._add("clickZoom",_),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();let x=new Fd;this._add("tapDragZoom",x);let k=n.touchPitch=new za(n);this._add("touchPitch",k),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);let M=ql(e),I=Ul(e);n.dragRotate=new ch(e,M,I),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();let z=(({enable:W,clickTolerance:V})=>{let Y=new Ms({checkCorrectEvent:Q=>se.mouseButton(Q)===0&&!Q.ctrlKey});return new nn({clickTolerance:V,move:(Q,re)=>({around:re,panDelta:re.sub(Q)}),activateOnStart:!0,moveStateManager:Y,enable:W,assignEvents:Is})})(e),F=new Kn(e,n);n.dragPan=new lh(o,z,F),this._add("mousePan",z),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);let O=new Hl,q=new Zl;n.touchZoomRotate=new Xl(o,q,O,x),this._add("touchRotate",O,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);let Z=n.scrollZoom=new br(n,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);let G=n.keyboard=new or(n);this._add("keyboard",G),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Ot(n))}_add(e,n,o){this._handlers.push({handlerName:e,handler:n,allowed:o}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,o){for(let s in e)if(s!==o&&(!n||n.indexOf(s)<0))return!0;return!1}_getMapTouches(e){let n=[];for(let o of e)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(e,n,o,s,h){if(!o)return;c.e(e,o);let f={handlerName:s,originalEvent:o.originalEvent||h};o.zoomDelta!==void 0&&(n.zoom=f),o.panDelta!==void 0&&(n.drag=f),o.pitchDelta!==void 0&&(n.pitch=f),o.bearingDelta!==void 0&&(n.rotate=f)}_applyChanges(){let e={},n={},o={};for(let[s,h,f]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(e.around=s.around),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),c.e(n,h),c.e(o,f);this._updateMapTransform(e,n,o),this._changes=[]}_updateMapTransform(e,n,o){let s=this._map,h=s._getTransformForUpdate(),f=s.terrain;if(!(As(e)||f&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:x,bearingDelta:k,pitchDelta:M,around:I,pinchAround:z}=e;z!==void 0&&(I=z),s._stop(!0),I=I||s.transform.centerPoint;let F=h.pointLocation(_?I.sub(_):I);k&&(h.bearing+=k),M&&(h.pitch+=M),x&&(h.zoom+=x),f?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(_)):h.setLocationAtPoint(F,I):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(F,I)):h.setLocationAtPoint(F,I),s._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,o,!0)}_fireEvents(e,n,o){let s=sr(this._eventsInProgress),h=sr(e),f={};for(let I in e){let{originalEvent:z}=e[I];this._eventsInProgress[I]||(f[`${I}start`]=z),this._eventsInProgress[I]=e[I]}!s&&h&&this._fireEvent("movestart",h.originalEvent);for(let I in f)this._fireEvent(I,f[I]);h&&this._fireEvent("move",h.originalEvent);for(let I in e){let{originalEvent:z}=e[I];this._fireEvent(I,z)}let _={},x;for(let I in this._eventsInProgress){let{handlerName:z,originalEvent:F}=this._eventsInProgress[I];this._handlersById[z].isActive()||(delete this._eventsInProgress[I],x=n[z]||F,_[`${I}end`]=x)}for(let I in _)this._fireEvent(I,_[I]);let k=sr(this._eventsInProgress),M=(s||h)&&!k;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let I=this._map._getTransformForUpdate();I.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(I)}if(o&&M){this._updatingCamera=!0;let I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!I||!I.essential&&ge.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:x})),z(this._map.getBearing())&&this._map.resetNorth()):(z(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new De("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class hh extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{let o=Math.min((ge.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,o){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),o)}panTo(e,n,o){return this.easeTo(c.e({center:e},n),o)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,o){return this.easeTo(c.e({zoom:e},n),o)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,o){return this.easeTo(c.e({bearing:e},n),o)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=ae.convert(e).adjustAntiMeridian();let o=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),o,n)}_cameraForBoxAndBearing(e,n,o,s){let h={top:0,bottom:0,right:0,left:0};if(typeof(s=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){let be=s.padding;s.padding={top:be,bottom:be,right:be,left:be}}s.padding=c.e(h,s.padding);let f=this.transform,_=f.padding,x=new ae(e,n),k=f.project(x.getNorthWest()),M=f.project(x.getNorthEast()),I=f.project(x.getSouthEast()),z=f.project(x.getSouthWest()),F=c.ba(-o),O=k.rotate(F),q=M.rotate(F),Z=I.rotate(F),G=z.rotate(F),W=new c.P(Math.max(O.x,q.x,G.x,Z.x),Math.max(O.y,q.y,G.y,Z.y)),V=new c.P(Math.min(O.x,q.x,G.x,Z.x),Math.min(O.y,q.y,G.y,Z.y)),Y=W.sub(V),Q=(f.width-(_.left+_.right+s.padding.left+s.padding.right))/Y.x,re=(f.height-(_.top+_.bottom+s.padding.top+s.padding.bottom))/Y.y;if(re<0||Q<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ue=Math.min(f.scaleZoom(f.scale*Math.min(Q,re)),s.maxZoom),_e=c.P.convert(s.offset),Se=new c.P((s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2).rotate(c.ba(o)),Ee=_e.add(Se).mult(f.scale/f.zoomScale(ue));return{center:f.unproject(k.add(I).div(2).sub(Ee)),zoom:ue,bearing:o}}fitBounds(e,n,o){return this._fitInternal(this.cameraForBounds(e,n),n,o)}fitScreenCoordinates(e,n,o,s,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),o,s),s,h)}_fitInternal(e,n,o){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(e,n){this.stop();let o=this._getTransformForUpdate(),s=!1,h=!1,f=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(s=!0,o.zoom=+e.zoom),e.center!==void 0&&(o.center=c.N.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(h=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(f=!0,o.pitch=+e.pitch),e.padding==null||o.isPaddingEqual(e.padding)||(o.padding=e.padding),this._applyUpdatedTransform(o),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),s&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),f&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,o,s=0){let h=c.Z.fromLngLat(e,n),f=c.Z.fromLngLat(o,s),_=f.x-h.x,x=f.y-h.y,k=f.z-h.z,M=Math.hypot(_,x,k);if(M===0)throw new Error("Can't calculate camera options with same From and To");let I=Math.hypot(_,x),z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),F=180*Math.atan2(_,-x)/Math.PI,O=180*Math.acos(I/M)/Math.PI;return O=k<0?90-O:90+O,{center:f.toLngLat(),zoom:z,pitch:O,bearing:F}}easeTo(e,n){var o;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);let s=this._getTransformForUpdate(),h=s.zoom,f=s.bearing,_=s.pitch,x=s.padding,k="bearing"in e?this._normalizeBearing(e.bearing,f):f,M="pitch"in e?+e.pitch:_,I="padding"in e?e.padding:s.padding,z=c.P.convert(e.offset),F=s.centerPoint.add(z),O=s.pointLocation(F),{center:q,zoom:Z}=s.getConstrained(c.N.convert(e.center||O),(o=e.zoom)!==null&&o!==void 0?o:h);this._normalizeCenter(q,s);let G=s.project(O),W=s.project(q).sub(G),V=s.zoomScale(Z-h),Y,Q;e.around&&(Y=c.N.convert(e.around),Q=s.locationPoint(Y));let re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==h,this._rotating=this._rotating||f!==k,this._pitching=this._pitching||M!==_,this._padding=!s.isPaddingEqual(I),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,re),this.terrain&&this._prepareElevation(q),this._ease(ue=>{if(this._zooming&&(s.zoom=c.y.number(h,Z,ue)),this._rotating&&(s.bearing=c.y.number(f,k,ue)),this._pitching&&(s.pitch=c.y.number(_,M,ue)),this._padding&&(s.interpolatePadding(x,I,ue),F=s.centerPoint.add(z)),this.terrain&&!e.freezeElevation&&this._updateElevation(ue),Y)s.setLocationAtPoint(Y,Q);else{let _e=s.zoomScale(s.zoom-h),Se=Z>h?Math.min(2,V):Math.max(.5,V),Ee=Math.pow(Se,1-ue),be=s.unproject(G.add(W.mult(ue*Ee)).mult(_e));s.setLocationAtPoint(s.renderWorldCopies?be.wrap():be,F)}this._applyUpdatedTransform(s),this._fireMoveEvents(n)},ue=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ue)},e),this}_prepareEase(e,n,o={}){this._moving=!0,n||o.moving||this.fire(new c.k("movestart",e)),this._zooming&&!o.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!o.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!o.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){let o=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(o-(n-(o*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){let n=e.getCameraPosition(),o=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<o){let s=this.calculateCameraOptionsFromTo(n.lngLat,o,e.center,e.elevation);return{pitch:s.pitch,zoom:s.zoom}}return{}}_applyUpdatedTransform(e){let n=[];if(this.terrain&&n.push(s=>this._elevateCameraIfInsideTerrain(s)),this.transformCameraUpdate&&n.push(s=>this.transformCameraUpdate(s)),!n.length)return;let o=e.clone();for(let s of n){let h=o.clone(),{center:f,zoom:_,pitch:x,bearing:k,elevation:M}=s(h);f&&(h.center=f),_!==void 0&&(h.zoom=_),x!==void 0&&(h.pitch=x),k!==void 0&&(h.bearing=k),M!==void 0&&(h.elevation=M),o.apply(h)}this.transform.apply(o)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;let o=this._zooming,s=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new c.k("zoomend",e)),s&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var o;if(!e.essential&&ge.prefersReducedMotion){let Ie=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ie,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);let s=this._getTransformForUpdate(),h=s.zoom,f=s.bearing,_=s.pitch,x=s.padding,k="bearing"in e?this._normalizeBearing(e.bearing,f):f,M="pitch"in e?+e.pitch:_,I="padding"in e?e.padding:s.padding,z=c.P.convert(e.offset),F=s.centerPoint.add(z),O=s.pointLocation(F),{center:q,zoom:Z}=s.getConstrained(c.N.convert(e.center||O),(o=e.zoom)!==null&&o!==void 0?o:h);this._normalizeCenter(q,s);let G=s.zoomScale(Z-h),W=s.project(O),V=s.project(q).sub(W),Y=e.curve,Q=Math.max(s.width,s.height),re=Q/G,ue=V.mag();if("minZoom"in e){let Ie=c.ac(Math.min(e.minZoom,h,Z),s.minZoom,s.maxZoom),Ge=Q/s.zoomScale(Ie-h);Y=Math.sqrt(Ge/ue*2)}let _e=Y*Y;function Se(Ie){let Ge=(re*re-Q*Q+(Ie?-1:1)*_e*_e*ue*ue)/(2*(Ie?re:Q)*_e*ue);return Math.log(Math.sqrt(Ge*Ge+1)-Ge)}function Ee(Ie){return(Math.exp(Ie)-Math.exp(-Ie))/2}function be(Ie){return(Math.exp(Ie)+Math.exp(-Ie))/2}let xe=Se(!1),Re=function(Ie){return be(xe)/be(xe+Y*Ie)},We=function(Ie){return Q*((be(xe)*(Ee(Ge=xe+Y*Ie)/be(Ge))-Ee(xe))/_e)/ue;var Ge},ke=(Se(!0)-xe)/Y;if(Math.abs(ue)<1e-6||!isFinite(ke)){if(Math.abs(Q-re)<1e-6)return this.easeTo(e,n);let Ie=re<Q?-1:1;ke=Math.abs(Math.log(re/Q))/Y,We=()=>0,Re=Ge=>Math.exp(Ie*Y*Ge)}return e.duration="duration"in e?+e.duration:1e3*ke/("screenSpeed"in e?+e.screenSpeed/Y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==k,this._pitching=M!==_,this._padding=!s.isPaddingEqual(I),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(q),this._ease(Ie=>{let Ge=Ie*ke,Tt=1/Re(Ge);s.zoom=Ie===1?Z:h+s.scaleZoom(Tt),this._rotating&&(s.bearing=c.y.number(f,k,Ie)),this._pitching&&(s.pitch=c.y.number(_,M,Ie)),this._padding&&(s.interpolatePadding(x,I,Ie),F=s.centerPoint.add(z)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ie);let Qe=Ie===1?q:s.unproject(W.add(V.mult(We(Ge))).mult(Tt));s.setLocationAtPoint(s.renderWorldCopies?Qe.wrap():Qe,F),this._applyUpdatedTransform(s),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var o;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,n)}return e||(o=this.handlers)===null||o===void 0||o.stop(!1),this}_ease(e,n,o){o.animate===!1||o.duration===0?(e(1),n()):(this._easeStart=ge.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);let o=Math.abs(e-n);return Math.abs(e-360-n)<o&&(e-=360),Math.abs(e+360-n)<o&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;let o=e.lng-n.center.lng;e.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}let Ra={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fa{constructor(e=Ra){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let o=this._map._getUIString(`AttributionControl.${n}`);e.title=o,e.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(s=>typeof s!="string"?"":s)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}let n=this._map.style.sourceCaches;for(let s in n){let h=n[s];if(h.used||h.usedForTerrain){let f=h.getSource();f.attribution&&e.indexOf(f.attribution)<0&&e.push(f.attribution)}}e=e.filter(s=>String(s).trim()),e.sort((s,h)=>s.length-h.length),e=e.filter((s,h)=>{for(let f=h+1;f<e.length;f++)if(e[f].indexOf(s)>=0)return!1;return!0});let o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yl{constructor(e={}){this._updateCompact=()=>{let n=this._container.children;if(n.length){let o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=se.create("div","maplibregl-ctrl");let n=se.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class st{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(let s of o)if(s.id===e)return void(s.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let n=this._currentlyRunning=this._queue;this._queue=[];for(let o of n)if(!o.cancelled&&(o.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Jl=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Bd extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];let o={};for(let s of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[s.key]=!0,this._renderableTilesKeys.push(s.key),this._tiles[s.key]||(s.posMatrix=new Float64Array(16),c.aP(s.posMatrix,0,c.X,0,c.X,0,1),this._tiles[s.key]=new yn(s,this.tileSize));for(let s in this._tiles)o[s]||delete this._tiles[s]}freeRtt(e){for(let n in this._tiles){let o=this._tiles[n];(!e||o.tileID.equals(e)||o.tileID.isChildOf(e)||e.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let n={};for(let o of this._renderableTilesKeys){let s=this._tiles[o].tileID;if(s.canonical.equals(e.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[o]=h}else if(s.canonical.isChildOf(e.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16);let f=s.canonical.z-e.canonical.z,_=s.canonical.x-(s.canonical.x>>f<<f),x=s.canonical.y-(s.canonical.y>>f<<f),k=c.X>>f;c.aP(h.posMatrix,0,k,0,k,0,1),c.J(h.posMatrix,h.posMatrix,[-_*k,-x*k,0]),n[o]=h}else if(e.canonical.isChildOf(s.canonical)){let h=e.clone();h.posMatrix=new Float64Array(16);let f=e.canonical.z-s.canonical.z,_=e.canonical.x-(e.canonical.x>>f<<f),x=e.canonical.y-(e.canonical.y>>f<<f),k=c.X>>f;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[_*k,x*k,0]),c.K(h.posMatrix,h.posMatrix,[1/2**f,1/2**f,0]),n[o]=h}}return n}getSourceTile(e,n){let o=this.sourceCache._source,s=e.overscaledZ-this.deltaZoom;if(s>o.maxzoom&&(s=o.maxzoom),s<o.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(s).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;s>=o.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(s--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class Ql{constructor(e,n,o){this.painter=e,this.sourceCache=new Bd(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,o,s=c.X){var h;if(!(n>=0&&n<s&&o>=0&&o<s))return 0;let f=this.getTerrainData(e),_=(h=f.tile)===null||h===void 0?void 0:h.dem;if(!_)return 0;let x=function(O,q,Z){var G=q[0],W=q[1];return O[0]=Z[0]*G+Z[4]*W+Z[12],O[1]=Z[1]*G+Z[5]*W+Z[13],O}([],[n/s*c.X,o/s*c.X],f.u_terrain_matrix),k=[x[0]*_.dim,x[1]*_.dim],M=Math.floor(k[0]),I=Math.floor(k[1]),z=k[0]-M,F=k[1]-I;return _.get(M,I)*(1-z)*(1-F)+_.get(M+1,I)*z*(1-F)+_.get(M,I+1)*(1-z)*F+_.get(M+1,I+1)*z*F}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;let{tileID:o,mercatorX:s,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(o,s%c.X,h%c.X,c.X)}getElevation(e,n,o,s=c.X){return this.getDEMElevation(e,n,o,s)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let s=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new yt(s,h,s.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new yt(s,new c.R({width:1,height:1}),s.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}let n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){let s=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new yt(s,n.dem.getPixels(),s.gl.RGBA,{premultiply:!1}),n.demTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}let o=n&&n+n.tileID.key+e.key;if(o&&!this._demMatrixCache[o]){let s=this.sourceCache.sourceCache._source.maxzoom,h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=s?h=e.canonical.z-s:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let f=e.canonical.x-(e.canonical.x>>h<<h),_=e.canonical.y-(e.canonical.y>>h<<h),x=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(x,x,[f*c.X,_*c.X,0]),this._demMatrixCache[e.key]={matrix:x,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){let n=this.painter,o=n.width/devicePixelRatio,s=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===s||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new yt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new yt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,s,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,s))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,f=0;h<this._coordsTextureSize;h++)for(let _=0;_<this._coordsTextureSize;_++,f+=4)n[f+0]=255&_,n[f+1]=255&h,n[f+2]=_>>8<<4|h>>8,n[f+3]=0;let o=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),s=new yt(e,o,e.gl.RGBA,{premultiply:!1});return s.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=s,s}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let n=new Uint8Array(4),o=this.painter.context,s=o.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),f=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),_=Math.round(this.painter.height/devicePixelRatio);o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),s.readPixels(h,_-f-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);let x=n[0]+(n[2]>>4<<8),k=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],I=M&&this.sourceCache.getTileByID(M);if(!I)return null;let z=this._coordsTextureSize,F=(1<<I.tileID.canonical.z)*z;return new c.Z((I.tileID.canonical.x*z+x)/F+I.tileID.wrap,(I.tileID.canonical.y*z+k)/F,this.getElevation(I.tileID,x,k,z))}depthAtPoint(e){let n=new Uint8Array(4),o=this.painter.context,s=o.gl;return o.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),s.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,n=new c.bd,o=new c.aY,s=this.meshSize,h=c.X/s,f=s*s;for(let I=0;I<=s;I++)for(let z=0;z<=s;z++)n.emplaceBack(z*h,I*h,0);for(let I=0;I<f;I+=s+1)for(let z=0;z<s;z++)o.emplaceBack(z+I,s+z+I+1,s+z+I+2),o.emplaceBack(z+I,s+z+I+2,z+I+1);let _=n.length,x=_+2*(s+1);for(let I of[0,1])for(let z=0;z<=s;z++)for(let F of[0,1])n.emplaceBack(z*h,I*c.X,F);for(let I=0;I<2*s;I+=2)o.emplaceBack(x+I,x+I+1,x+I+3),o.emplaceBack(x+I,x+I+3,x+I+2),o.emplaceBack(_+I,_+I+3,_+I+1),o.emplaceBack(_+I,_+I+2,_+I+3);let k=n.length,M=k+2*(s+1);for(let I of[0,1])for(let z=0;z<=s;z++)for(let F of[0,1])n.emplaceBack(I*c.X,z*h,F);for(let I=0;I<2*s;I+=2)o.emplaceBack(k+I,k+I+1,k+I+3),o.emplaceBack(k+I,k+I+3,k+I+2),o.emplaceBack(M+I,M+I+3,M+I+1),o.emplaceBack(M+I,M+I+2,M+I+3);return this._mesh=new xs(e.createVertexBuffer(n,Jl.members),e.createIndexBuffer(o),c.a0.simpleSegment(0,0,n.length,o.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var o;let{tileID:s}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(o=this.getMinMaxElevation(s).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(e){let n=this.getTerrainData(e).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(e,n){let o=c.Z.fromLngLat(e.wrap()),s=(1<<n)*c.X,h=o.x*s,f=o.y*s,_=Math.floor(h/c.X),x=Math.floor(f/c.X);return{tileID:new c.S(n,0,n,_,x),mercatorX:h,mercatorY:f}}}class Od{constructor(e,n,o){this._context=e,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new yt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:e,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let Ba={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class dh{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new Od(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(o=>!e._layers[o].isHidden(n)),this._coordsDescendingInv={};for(let o in e.sourceCaches){this._coordsDescendingInv[o]={};let s=e.sourceCaches[o].getVisibleCoordinates();for(let h of s){let f=this.terrain.sourceCache.getTerrainCoords(h);for(let _ in f)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(f[_])}}this._coordsDescendingInvStr={};for(let o of e._order){let s=e._layers[o],h=s.source;if(Ba[s.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(let f in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][f]=this._coordsDescendingInv[h][f].map(_=>_.key).sort().join()}}for(let o of this._renderableTiles)for(let s in this._coordsDescendingInvStr){let h=this._coordsDescendingInvStr[s][o.tileID.key];h&&h!==o.rttCoords[s]&&(o.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let n=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ba[n]&&(this._prevType&&Ba[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(Ba[this._prevType]||Ba[n]&&s){this._prevType=n;let h=this._stacks.length-1,f=this._stacks[h]||[];for(let _ of this._renderableTiles){if(this.pool.isFull()&&(rh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[h]){let k=this.pool.getObjectForId(_.rtt[h].id);if(k.stamp===_.rtt[h].stamp){this.pool.useObject(k);continue}}let x=this.pool.getOrCreateFreeObject();this.pool.useObject(x),this.pool.stampObject(x),_.rtt[h]={id:x.id,stamp:x.stamp},o.context.bindFramebuffer.set(x.fbo.framebuffer),o.context.clear({color:c.aM.transparent,stencil:0}),o.currentStencilSource=void 0;for(let k=0;k<f.length;k++){let M=o.style._layers[f[k]],I=M.source?this._coordsDescendingInv[M.source][_.tileID.key]:[_.tileID];o.context.viewport.set([0,0,x.fbo.width,x.fbo.height]),o._renderTileClippingMasks(M,I),o.renderLayer(o,o.style.sourceCaches[M.source],M,I),M.source&&(_.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][_.tileID.key])}}return rh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ba[n]}return!1}}let ec={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},uh=ce,Vd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ra,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},tc=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},Nd={showCompass:!0,showZoom:!0,visualizePitch:!1};class jd{constructor(e,n,o=!1){this.mousedown=f=>{this.startMouse(c.e({},f,{ctrlKey:!0,preventDefault:()=>f.preventDefault()}),se.mousePos(this.element,f)),se.addEventListener(window,"mousemove",this.mousemove),se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=f=>{this.moveMouse(f,se.mousePos(this.element,f))},this.mouseup=f=>{this.mouseRotate.dragEnd(f),this.mousePitch&&this.mousePitch.dragEnd(f),this.offTemp()},this.touchstart=f=>{f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se.touchPos(this.element,f.targetTouches)[0],this.startTouch(f,this._startPos),se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.addEventListener(window,"touchend",this.touchend))},this.touchmove=f=>{f.targetTouches.length!==1?this.reset():(this._lastPos=se.touchPos(this.element,f.targetTouches)[0],this.moveTouch(f,this._lastPos))},this.touchend=f=>{f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let s=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=ql({clickTolerance:s,enable:!0}),this.touchRotate=(({enable:f,clickTolerance:_,bearingDegreesPerPixelMoved:x=.8})=>{let k=new jl;return new nn({clickTolerance:_,move:(M,I)=>({bearingDelta:(I.x-M.x)*x}),moveStateManager:k,enable:f,assignEvents:tc})})({clickTolerance:s,enable:!0}),this.map=e,o&&(this.mousePitch=Ul({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:f,clickTolerance:_,pitchDegreesPerPixelMoved:x=-.5})=>{let k=new jl;return new nn({clickTolerance:_,move:(M,I)=>({pitchDelta:(I.y-M.y)*x}),moveStateManager:k,enable:f,assignEvents:tc})})({clickTolerance:h,enable:!0})),se.addEventListener(n,"mousedown",this.mousedown),se.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),se.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),se.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),se.disableDrag()}moveMouse(e,n){let o=this.map,{bearingDelta:s}=this.mouseRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.mousePitch){let{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&o.setPitch(o.getPitch()+h)}}moveTouch(e,n){let o=this.map,{bearingDelta:s}=this.touchRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.touchPitch){let{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&o.setPitch(o.getPitch()+h)}}off(){let e=this.element;se.removeEventListener(e,"mousedown",this.mousedown),se.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend),se.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){se.enableDrag(),se.removeEventListener(window,"mousemove",this.mousemove),se.removeEventListener(window,"mouseup",this.mouseup),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend)}}let Ki;function It(d,e,n){let o=new c.N(d.lng,d.lat);if(d=new c.N(d.lng,d.lat),e){let s=new c.N(d.lng-360,d.lat),h=new c.N(d.lng+360,d.lat),f=n.locationPoint(d).distSqr(e);n.locationPoint(s).distSqr(e)<f?d=s:n.locationPoint(h).distSqr(e)<f&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){let s=n.locationPoint(d);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==o.lng&&n.locationPoint(d).y>n.height/2-n.getHorizon()?d:o}let Oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ps(d,e,n){let o=d.classList;for(let s in Oa)o.remove(`maplibregl-${n}-anchor-${s}`);o.add(`maplibregl-${n}-anchor-${e}`)}class Ds extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{let o=n.code,s=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&s!==32&&s!==13||this.togglePopup()},this._onMapClick=n=>{let o=n.originalEvent.target,s=this._element;this._popup&&(o===s||s.contains(o))&&this.togglePopup()},this._update=n=>{var o;if(!this._map)return;let s=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?It(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),se.setTransform(this._element,`${Oa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${h}`),ge.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){let o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=se.create("div");let n=se.createNS("http://www.w3.org/2000/svg","svg"),o=41,s=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${s}px`),n.setAttributeNS(null,"viewBox",`0 0 ${s} ${o}`);let h=se.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");let f=se.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");let _=se.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");let x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let G of x){let W=se.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",G.rx),W.setAttributeNS(null,"ry",G.ry),_.appendChild(W)}let k=se.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let M=se.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(M);let I=se.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");let z=se.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(z);let F=se.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");let O=se.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");let q=se.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");let Z=se.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),O.appendChild(q),O.appendChild(Z),f.appendChild(_),f.appendChild(k),f.appendChild(I),f.appendChild(F),f.appendChild(O),n.appendChild(f),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ps(this._element,this._anchor,"marker"),e&&e.className)for(let n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let s=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,o;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let s=this._map,h=s.terrain.depthAtPoint(this._pos),f=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,f)-h<.006)return void(this._element.style.opacity=this._opacity);let _=-this._offset.y/s.transform._pixelPerMeter,x=Math.sin(s.getPitch()*Math.PI/180)*_,k=s.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=s.transform.lngLatToCameraDepth(this._lngLat,f+x)-k>.006;!((o=this._popup)===null||o===void 0)&&o.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}let ph={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ao=0,Po=!1,qr={maxWidth:100,unit:"metric"};function Do(d,e,n){let o=n&&n.maxWidth||100,s=d._container.clientHeight/2,h=d.unproject([0,s]),f=d.unproject([o,s]),_=h.distanceTo(f);if(n&&n.unit==="imperial"){let x=3.2808*_;x>5280?Le(e,o,x/5280,d._getUIString("ScaleControl.Miles")):Le(e,o,x,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Le(e,o,_/1852,d._getUIString("ScaleControl.NauticalMiles")):_>=1e3?Le(e,o,_/1e3,d._getUIString("ScaleControl.Kilometers")):Le(e,o,_,d._getUIString("ScaleControl.Meters"))}function Le(d,e,n,o){let s=function(h){let f=Math.pow(10,`${Math.floor(h)}`.length-1),_=h/f;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(x){let k=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*k)/k}(_),f*_}(n);d.style.width=e*(s/n)+"px",d.innerHTML=`${s}&nbsp;${o}`}let Ue={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},zs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ls(d){if(d){if(typeof d=="number"){let e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){let e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return Ls(new c.P(0,0))}let ic=ce;v.AJAXError=c.bh,v.Evented=c.E,v.LngLat=c.N,v.MercatorCoordinate=c.Z,v.Point=c.P,v.addProtocol=c.bi,v.config=c.a,v.removeProtocol=c.bj,v.AttributionControl=Fa,v.BoxZoomHandler=Xi,v.CanvasSource=rr,v.CooperativeGesturesHandler=La,v.DoubleClickZoomHandler=Yn,v.DragPanHandler=lh,v.DragRotateHandler=ch,v.EdgeInsets=Aa,v.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let d=this._fullscreenButton=se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);se.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},v.GeoJSONSource=uo,v.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let n=new c.N(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy,s=this._map.getBearing(),h=c.e({bearing:s},this.options.fitBoundsOptions),f=ae.fromLngLat(n,o);this._map.fitBounds(f,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Po)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=se.create("button","maplibregl-ctrl-geolocate",this._container),se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ds({element:this._dotElement}),this._circleElement=se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ds({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},ph,d)}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Ki!==void 0&&!e)return Ki;if(window.navigator.permissions===void 0)return Ki=!!window.navigator.geolocation,Ki;try{Ki=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ki=!!window.navigator.geolocation}return Ki})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),se.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ao=0,Po=!1}_isOutOfMapMaxBounds(d){let e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),o=e.distanceTo(n),s=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ao--,Po=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ao++,Ao>1?(d={maximumAge:6e5,timeout:0},Po=!0):(d=this.options.positionOptions,Po=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},v.Hash=ws,v.ImageSource=en,v.KeyboardHandler=or,v.LngLatBounds=ae,v.LogoControl=Yl,v.Map=class extends hh{constructor(d){c.bf.mark(c.bg.create);let e=Object.assign(Object.assign({},Vd),d);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Pa(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new st,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ec),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$i.addThrottleControl(()=>this.isMoving()),this._requestManager=new pl(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1,o=So(s=>{this._trackResize&&!this._removed&&(this.resize(s),this.redraw())},50);this._resizeObserver=new ResizeObserver(s=>{n?o(s):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Kl(this,e),this._hash=e.hash&&new ws(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Fa(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Yl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=d.onAdd(this);this._controls.push(d);let o=this._controlPositions[e];return e.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,o)}resize(d){var e;let n=this._containerDimensions(),o=n[0],s=n[1],h=this._getClampedPixelRatio(o,s);if(this._resizeCanvas(o,s,h),this.painter.resize(o,s,h),this.painter.overLimit()){let _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];let x=this._getClampedPixelRatio(o,s);this._resizeCanvas(o,s,x),this.painter.resize(o,s,x)}this.transform.resize(o,s),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,s);let f=!this._moving;return f&&(this.stop(),this.fire(new c.k("movestart",d)).fire(new c.k("move",d))),this.fire(new c.k("resize",d)),f&&this.fire(new c.k("moveend",d)),this}_getClampedPixelRatio(d,e){let{0:n,1:o}=this._maxCanvasSize,s=this.getPixelRatio(),h=d*s,f=e*s;return Math.min(h>n?n/h:1,f>o?o/f:1)*s}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ae.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(c.N.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{let f=e.filter(x=>this.getLayer(x)),_=f.length!==0?this.queryRenderedFeatures(h.point,{layers:f}):[];_.length?o||(o=!0,n.call(this,new ci(d,this,h.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(d==="mouseleave"||d==="mouseout"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:f=>{let _=e.filter(x=>this.getLayer(x));(_.length!==0?this.queryRenderedFeatures(f.point,{layers:_}):[]).length?o=!0:o&&(o=!1,n.call(this,new ci(d,this,f.originalEvent)))},mouseout:f=>{o&&(o=!1,n.call(this,new ci(d,this,f.originalEvent)))}}}}{let o=s=>{let h=e.filter(_=>this.getLayer(_)),f=h.length!==0?this.queryRenderedFeatures(s.point,{layers:h}):[];f.length&&(s.features=f,n.call(this,s),delete s.features)};return{layers:e,listener:n,delegates:{[d]:o}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;let o=this._delegatedListeners[d];for(let s=0;s<o.length;s++){let h=o[s];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(f=>e.includes(f))){for(let f in h.delegates)this.off(f,h.delegates[f]);return void o.splice(s,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);let o=this._createDelegatedListener(d,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(d,o);for(let s in o.delegates)this.on(s,o.delegates[s]);return this}once(d,e,n){if(n===void 0)return super.once(d,e);let o=typeof e=="string"?[e]:e,s=this._createDelegatedListener(d,o,n);for(let h in s.delegates){let f=s.delegates[h];s.delegates[h]=(..._)=>{this._removeDelegatedListener(d,o,n),f(..._)}}this._saveDelegatedListener(d,s);for(let h in s.delegates)this.once(h,s.delegates[h]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n,o=d instanceof c.P||Array.isArray(d),s=o?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(o?{}:d)||{},s instanceof c.P||typeof s[0]=="number")n=[c.P.convert(s)];else{let h=c.P.convert(s[0]),f=c.P.convert(s[1]);n=[h,new c.P(f.x,h.y),f,new c.P(h.x,f.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){let e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));let n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new as(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,n):this.style.loadJSON(d,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new as(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){let n=this._requestManager.transformRequest(d,"Style");c.h(n,new AbortController).then(o=>{this._updateDiff(o.data,e)}).catch(o=>{o&&this.fire(new c.j(o))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){let e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){let e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(let n in this.style._layers){let o=this.style._layers[n];o.type==="hillshade"&&o.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ql(this.painter,e,d),this.painter.renderToTexture=new dh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let d=this.style&&this.style.sourceCaches;for(let e in d){let n=d[e]._tiles;for(let o in n){let s=n[o];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,n={}){let{pixelRatio:o=1,sdf:s=!1,stretchX:h,stretchY:f,content:_,textFitWidth:x,textFitHeight:k}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:M,height:I,data:z}=e,F=e;return this.style.addImage(d,{data:new c.R({width:M,height:I},new Uint8Array(z)),pixelRatio:o,stretchX:h,stretchY:f,content:_,textFitWidth:x,textFitHeight:k,sdf:s,version:0,userImage:F}),F.onAdd&&F.onAdd(this,d),this}}{let{width:M,height:I,data:z}=ge.getImageData(e);this.style.addImage(d,{data:new c.R({width:M,height:I},z),pixelRatio:o,stretchX:h,stretchY:f,content:_,textFitWidth:x,textFitHeight:k,sdf:s,version:0})}}updateImage(d,e){let n=this.style.getImage(d);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=e instanceof HTMLImageElement||c.b(e)?ge.getImageData(e):e,{width:s,height:h,data:f}=o;if(s===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let _=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(f,_),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return $i.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,o={}){return this.style.setPaintProperty(d,e,n,o),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,o={}){return this.style.setLayoutProperty(d,e,n,o),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,o=>{o||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d){return this._lazyInitEmptyStyle(),this.style.setSky(d),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){let d=this._container;d.classList.add("maplibregl-map");let e=this._canvasContainer=se.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=se.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);let s=this._controlContainer=se.create("div","maplibregl-control-container",d),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{h[f]=se.create("div",`maplibregl-ctrl-${f} `,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{e={requestedAttributes:d},o&&(e.statusMessage=o.statusMessage,e.type=o.type)},{once:!0});let n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){let o="Failed to initialize WebGL";throw e?(e.message=o,new Error(JSON.stringify(e))):new Error(o)}this.painter=new bs(n,this.transform),ur.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let s=this.transform.zoom,h=ge.now();this.style.zoomHistory.update(s,h);let f=new c.z(s,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=f.crossFadingFactor();_===1&&_===this._crossFadingFactor||(n=!0,this._crossFadingFactor=_),this.style.update(f)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$i.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),se.remove(this._canvasContainer),se.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(d=>{c.bf.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return uh}getCameraTargetElevation(){return this.transform.elevation}},v.MapMouseEvent=ci,v.MapTouchEvent=Xn,v.MapWheelEvent=ah,v.Marker=Ds,v.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{let e=this._map.getZoom(),n=e===this._map.getMaxZoom(),o=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{let o=this._map._getUIString(`NavigationControl.${n}`);e.title=o,e.setAttribute("aria-label",o)},this.options=c.e({},Nd,d),this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){let n=se.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},v.Popup=class extends c.E{constructor(d){super(),this.remove=()=>(this._content&&se.remove(this._content),this._container&&(se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?It(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;let o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let s=this.options.anchor,h=Ls(this.options.offset);if(!s){let _=this._container.offsetWidth,x=this._container.offsetHeight,k;k=o.y+h.bottom.y<x?["top"]:o.y>this._map.transform.height-x?["bottom"]:[],o.x<_/2?k.push("left"):o.x>this._map.transform.width-_/2&&k.push("right"),s=k.length===0?"bottom":k.join("-")}let f=o.add(h[s]);this.options.subpixelPositioning||(f=f.round()),se.setTransform(this._container,`${Oa[s]} translate(${f.x}px,${f.y}px)`),Ps(this._container,s,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ue),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.N.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let e=document.createDocumentFragment(),n=document.createElement("body"),o;for(n.innerHTML=d;o=n.firstChild,o;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(zs);d&&d.focus()}},v.RasterDEMTileSource=Lt,v.RasterTileSource=pt,v.ScaleControl=class{constructor(d){this._onMove=()=>{Do(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Do(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},qr),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},v.ScrollZoomHandler=br,v.Style=as,v.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=se.create("button","maplibregl-ctrl-terrain",this._container),se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},v.TwoFingersTouchPitchHandler=za,v.TwoFingersTouchRotateHandler=Hl,v.TwoFingersTouchZoomHandler=Zl,v.TwoFingersTouchZoomRotateHandler=Xl,v.VectorTileSource=ho,v.VideoSource=ga,v.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(mo(d))throw new Error(`A source type called "${d}" already exists.`);((n,o)=>{po[n]=o})(d,e)}),v.clearPrewarmedResources=function(){let d=Zi;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(mn),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},v.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},v.getRTLTextPluginStatus=function(){return Br().getRTLTextPluginStatus()},v.getVersion=function(){return ic},v.getWorkerCount=function(){return Rr.workerCount},v.getWorkerUrl=function(){return c.a.WORKER_URL},v.importScriptInWorkers=function(d){return co().broadcast("IS",d)},v.prewarm=function(){Bn().acquire(mn)},v.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},v.setRTLTextPlugin=function(d,e){return Br().setRTLTextPlugin(d,e)},v.setWorkerCount=function(d){Rr.workerCount=d},v.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var C=D;return C})});function o0(D,he){}var ao=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var Tc=(()=>{class D extends Tf{_elementRef=me(Ar);_focusTrapFactory=me(vf);_config;_interactivityChecker=me(yf);_ngZone=me(Qs);_overlayRef=me(Xu);_focusMonitor=me(Xo);_renderer=me(Nh);_platform=me(Gh);_document=me(Ho,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=me(to);_injector=me(Qa);_isDestroyed=!1;constructor(){super(),this._config=me(ao,{optional:!0})||new ao,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(y){this._ariaLabelledByQueue.push(y),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(y){let C=this._ariaLabelledByQueue.indexOf(y);C>-1&&(this._ariaLabelledByQueue.splice(C,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(y){this._portalOutlet.hasAttached();let C=this._portalOutlet.attachComponentPortal(y);return this._contentAttached(),C}attachTemplatePortal(y){this._portalOutlet.hasAttached();let C=this._portalOutlet.attachTemplatePortal(y);return this._contentAttached(),C}attachDomPortal=y=>{this._portalOutlet.hasAttached();let C=this._portalOutlet.attachDomPortal(y);return this._contentAttached(),C};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(y,C){this._interactivityChecker.isFocusable(y)||(y.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let v=()=>{c(),ce(),y.removeAttribute("tabindex")},c=this._renderer.listen(y,"blur",v),ce=this._renderer.listen(y,"mousedown",v)})),y.focus(C)}_focusByCssSelector(y,C){let v=this._elementRef.nativeElement.querySelector(y);v&&this._forceFocus(v,C)}_trapFocus(){this._isDestroyed||tl(()=>{let y=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||y.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let y=this._config.restoreFocus,C=null;if(typeof y=="string"?C=this._document.querySelector(y):typeof y=="boolean"?C=y?this._elementFocusedBeforeDialogWasOpened:null:y&&(C=y),this._config.restoreFocus&&C&&typeof C.focus=="function"){let v=Hh(),c=this._elementRef.nativeElement;(!v||v===this._document.body||v===c||c.contains(v))&&(this._focusMonitor?(this._focusMonitor.focusVia(C,this._closeInteractionType),this._closeInteractionType=null):C.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let y=this._elementRef.nativeElement,C=Hh();return y===C||y.contains(C)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Hh()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["cdk-dialog-container"]],viewQuery:function(C,v){if(C&1&&aa(ca,7),C&2){let c;ji(c=qi())&&(v._portalOutlet=c.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(C,v){C&2&&Zt("id",v._config.id||null)("role",v._config.role)("aria-modal",v._config.ariaModal)("aria-labelledby",v._config.ariaLabel?null:v._ariaLabelledByQueue[0])("aria-label",v._config.ariaLabel)("aria-describedby",v._config.ariaDescribedBy||null)},features:[er],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(C,v){C&1&&Mt(0,o0,0,0,"ng-template",0)},dependencies:[ca],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return D})(),Jo=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new Mi;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(he,y){this.overlayRef=he,this.config=y,this.disableClose=y.disableClose,this.backdropClick=he.backdropClick(),this.keydownEvents=he.keydownEvents(),this.outsidePointerEvents=he.outsidePointerEvents(),this.id=y.id,this.keydownEvents.subscribe(C=>{C.keyCode===27&&!this.disableClose&&!ro(C)&&(C.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=he.detachments().subscribe(()=>{y.closeOnOverlayDetachments!==!1&&this.close()})}close(he,y){if(this.containerInstance){let C=this.closed;this.containerInstance._closeInteractionType=y?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),C.next(he),C.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(he="",y=""){return this.overlayRef.updateSize({width:he,height:y}),this}addPanelClass(he){return this.overlayRef.addPanelClass(he),this}removePanelClass(he){return this.overlayRef.removePanelClass(he),this}},s0=new si("DialogScrollStrategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.block()}}),l0=new si("DialogData"),c0=new si("DefaultDialogConfig");var Ec=(()=>{class D{_overlay=me(Xr);_injector=me(Qa);_defaultOptions=me(c0,{optional:!0});_parentDialog=me(D,{optional:!0,skipSelf:!0});_overlayContainer=me(Ef);_idGenerator=me(Ko);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Mi;_afterOpenedAtThisLevel=new Mi;_ariaHiddenElements=new Map;_scrollStrategy=me(s0);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=Bh(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ln(void 0)));constructor(){}open(y,C){let v=this._defaultOptions||new ao;C=Kt(Kt({},v),C),C.id=C.id||this._idGenerator.getId("cdk-dialog-"),C.id&&this.getDialogById(C.id);let c=this._getOverlayConfig(C),ce=this._overlay.create(c),Pe=new Jo(ce,C),Je=this._attachContainer(ce,Pe,C);return Pe.containerInstance=Je,this._attachDialogContent(y,Pe,Je,C),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(Pe),Pe.closed.subscribe(()=>this._removeOpenDialog(Pe,!0)),this.afterOpened.next(Pe),Pe}closeAll(){Ku(this.openDialogs,y=>y.close())}getDialogById(y){return this.openDialogs.find(C=>C.id===y)}ngOnDestroy(){Ku(this._openDialogsAtThisLevel,y=>{y.config.closeOnDestroy===!1&&this._removeOpenDialog(y,!1)}),Ku(this._openDialogsAtThisLevel,y=>y.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(y){let C=new Kh({positionStrategy:y.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:y.scrollStrategy||this._scrollStrategy(),panelClass:y.panelClass,hasBackdrop:y.hasBackdrop,direction:y.direction,minWidth:y.minWidth,minHeight:y.minHeight,maxWidth:y.maxWidth,maxHeight:y.maxHeight,width:y.width,height:y.height,disposeOnNavigation:y.closeOnNavigation});return y.backdropClass&&(C.backdropClass=y.backdropClass),C}_attachContainer(y,C,v){let c=v.injector||v.viewContainerRef?.injector,ce=[{provide:ao,useValue:v},{provide:Jo,useValue:C},{provide:Xu,useValue:y}],Pe;v.container?typeof v.container=="function"?Pe=v.container:(Pe=v.container.type,ce.push(...v.container.providers(v))):Pe=Tc;let Je=new Hu(Pe,v.viewContainerRef,Qa.create({parent:c||this._injector,providers:ce}));return y.attach(Je).instance}_attachDialogContent(y,C,v,c){if(y instanceof qo){let ce=this._createInjector(c,C,v,void 0),Pe={$implicit:c.data,dialogRef:C};c.templateContext&&(Pe=Kt(Kt({},Pe),typeof c.templateContext=="function"?c.templateContext():c.templateContext)),v.attachTemplatePortal(new ll(y,null,Pe,ce))}else{let ce=this._createInjector(c,C,v,this._injector),Pe=v.attachComponentPortal(new Hu(y,c.viewContainerRef,ce));C.componentRef=Pe,C.componentInstance=Pe.instance}}_createInjector(y,C,v,c){let ce=y.injector||y.viewContainerRef?.injector,Pe=[{provide:l0,useValue:y.data},{provide:Jo,useValue:C}];return y.providers&&(typeof y.providers=="function"?Pe.push(...y.providers(C,y,v)):Pe.push(...y.providers)),y.direction&&(!ce||!ce.get(Sc,null,{optional:!0}))&&Pe.push({provide:Sc,useValue:{value:y.direction,change:Er()}}),Qa.create({parent:ce||c,providers:Pe})}_removeOpenDialog(y,C){let v=this.openDialogs.indexOf(y);v>-1&&(this.openDialogs.splice(v,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((c,ce)=>{c?ce.setAttribute("aria-hidden",c):ce.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),C&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let y=this._overlayContainer.getContainerElement();if(y.parentElement){let C=y.parentElement.children;for(let v=C.length-1;v>-1;v--){let c=C[v];c!==y&&c.nodeName!=="SCRIPT"&&c.nodeName!=="STYLE"&&!c.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(c,c.getAttribute("aria-hidden")),c.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let y=this._parentDialog;return y?y._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function Ku(D,he){let y=D.length;for(;y--;)he(D[y])}var Yh=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[Ec],imports:[cl,ha,wf,ha]})}return D})();function h0(D,he){}var Qh=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},Yu="mdc-dialog--open",Df="mdc-dialog--opening",zf="mdc-dialog--closing",d0=150,u0=75,p0=(()=>{class D extends Tc{_animationMode=me(el,{optional:!0});_animationStateChanged=new Pn;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?Rf(this._config.enterAnimationDuration)??d0:0;_exitAnimationDuration=this._animationsEnabled?Rf(this._config.exitAnimationDuration)??u0:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(Lf,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Df,Yu)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(Yu),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(Yu),this._animationsEnabled?(this._hostElement.style.setProperty(Lf,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(zf)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(y){this._actionSectionCount+=y,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(Df,zf)}_waitForAnimationToComplete(y,C){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(C,y)}_requestAnimationFrame(y){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(y):y()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(y){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:y})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(y){let C=super.attachComponentPortal(y);return C.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),C}static \u0275fac=(()=>{let y;return function(v){return(y||(y=ra(D)))(v||D)}})();static \u0275cmp=kt({type:D,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(C,v){C&2&&(qh("id",v._config.id),Zt("aria-modal",v._config.ariaModal)("role",v._config.role)("aria-labelledby",v._config.ariaLabel?null:v._ariaLabelledByQueue[0])("aria-label",v._config.ariaLabel)("aria-describedby",v._config.ariaDescribedBy||null),Qt("_mat-animation-noopable",!v._animationsEnabled)("mat-mdc-dialog-container-with-actions",v._actionSectionCount>0))},features:[er],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(C,v){C&1&&(Ne(0,"div",0)(1,"div",1),Mt(2,h0,0,0,"ng-template",2),$e()())},dependencies:[ca],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return D})(),Lf="--mat-dialog-transition-duration";function Rf(D){return D==null?null:typeof D=="number"?D:D.endsWith("ms")?Vu(D.substring(0,D.length-2)):D.endsWith("s")?Vu(D.substring(0,D.length-1))*1e3:D==="0"?0:null}var Jh=function(D){return D[D.OPEN=0]="OPEN",D[D.CLOSING=1]="CLOSING",D[D.CLOSED=2]="CLOSED",D}(Jh||{}),Ac=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new Mi;_beforeClosed=new Mi;_result;_closeFallbackTimeout;_state=Jh.OPEN;_closeInteractionType;constructor(he,y,C){this._ref=he,this._containerInstance=C,this.disableClose=y.disableClose,this.id=he.id,he.addPanelClass("mat-mdc-dialog-panel"),C._animationStateChanged.pipe(Gr(v=>v.state==="opened"),Hr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),C._animationStateChanged.pipe(Gr(v=>v.state==="closed"),Hr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),he.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Ja(this.backdropClick(),this.keydownEvents().pipe(Gr(v=>v.keyCode===27&&!this.disableClose&&!ro(v)))).subscribe(v=>{this.disableClose||(v.preventDefault(),Ff(this,v.type==="keydown"?"keyboard":"mouse"))})}close(he){this._result=he,this._containerInstance._animationStateChanged.pipe(Gr(y=>y.state==="closing"),Hr(1)).subscribe(y=>{this._beforeClosed.next(he),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),y.totalTime+100)}),this._state=Jh.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(he){let y=this._ref.config.positionStrategy;return he&&(he.left||he.right)?he.left?y.left(he.left):y.right(he.right):y.centerHorizontally(),he&&(he.top||he.bottom)?he.top?y.top(he.top):y.bottom(he.bottom):y.centerVertically(),this._ref.updatePosition(),this}updateSize(he="",y=""){return this._ref.updateSize(he,y),this}addPanelClass(he){return this._ref.addPanelClass(he),this}removePanelClass(he){return this._ref.removePanelClass(he),this}getState(){return this._state}_finishDialogClose(){this._state=Jh.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function Ff(D,he,y){return D._closeInteractionType=he,D.close(y)}var Ju=new si("MatMdcDialogData"),m0=new si("mat-mdc-dialog-default-options"),f0=new si("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.block()}});var es=(()=>{class D{_overlay=me(Xr);_defaultOptions=me(m0,{optional:!0});_scrollStrategy=me(f0);_parentDialog=me(D,{optional:!0,skipSelf:!0});_idGenerator=me(Ko);_dialog=me(Ec);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Mi;_afterOpenedAtThisLevel=new Mi;dialogConfigClass=Qh;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let y=this._parentDialog;return y?y._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=Bh(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ln(void 0)));constructor(){this._dialogRefConstructor=Ac,this._dialogContainerType=p0,this._dialogDataToken=Ju}open(y,C){let v;C=Kt(Kt({},this._defaultOptions||new Qh),C),C.id=C.id||this._idGenerator.getId("mat-mdc-dialog-"),C.scrollStrategy=C.scrollStrategy||this._scrollStrategy();let c=this._dialog.open(y,Tn(Kt({},C),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:C},{provide:ao,useValue:C}]},templateContext:()=>({dialogRef:v}),providers:(ce,Pe,Je)=>(v=new this._dialogRefConstructor(ce,C,Je),v.updatePosition(C?.position),[{provide:this._dialogContainerType,useValue:Je},{provide:this._dialogDataToken,useValue:Pe.data},{provide:this._dialogRefConstructor,useValue:v}])}));return v.componentRef=c.componentRef,v.componentInstance=c.componentInstance,this.openDialogs.push(v),this.afterOpened.next(v),v.afterClosed().subscribe(()=>{let ce=this.openDialogs.indexOf(v);ce>-1&&(this.openDialogs.splice(ce,1),this.openDialogs.length||this._getAfterAllClosed().next())}),v}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(y){return this.openDialogs.find(C=>C.id===y)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(y){let C=y.length;for(;C--;)y[C].close()}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),ed=(()=>{class D{dialogRef=me(Ac,{optional:!0});_elementRef=me(Ar);_dialog=me(es);ariaLabel;type="button";dialogResult;_matDialogClose;constructor(){}ngOnInit(){this.dialogRef||(this.dialogRef=Of(this._elementRef,this._dialog.openDialogs))}ngOnChanges(y){let C=y._matDialogClose||y._matDialogCloseResult;C&&(this.dialogResult=C.currentValue)}_onButtonClick(y){Ff(this.dialogRef,y.screenX===0&&y.screenY===0?"keyboard":"mouse",this.dialogResult)}static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-close",""],["","matDialogClose",""]],hostVars:2,hostBindings:function(C,v){C&1&&qt("click",function(ce){return v._onButtonClick(ce)}),C&2&&Zt("aria-label",v.ariaLabel||null)("type",v.type)},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],type:"type",dialogResult:[0,"mat-dialog-close","dialogResult"],_matDialogClose:[0,"matDialogClose","_matDialogClose"]},exportAs:["matDialogClose"],features:[zu]})}return D})(),Bf=(()=>{class D{_dialogRef=me(Ac,{optional:!0});_elementRef=me(Ar);_dialog=me(es);constructor(){}ngOnInit(){this._dialogRef||(this._dialogRef=Of(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{this._onAdd()})}ngOnDestroy(){this._dialogRef?._containerInstance&&Promise.resolve().then(()=>{this._onRemove()})}static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D})}return D})(),td=(()=>{class D extends Bf{id=me(Ko).getId("mat-mdc-dialog-title-");_onAdd(){this._dialogRef._containerInstance?._addAriaLabelledBy?.(this.id)}_onRemove(){this._dialogRef?._containerInstance?._removeAriaLabelledBy?.(this.id)}static \u0275fac=(()=>{let y;return function(v){return(y||(y=ra(D)))(v||D)}})();static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-mdc-dialog-title","mdc-dialog__title"],hostVars:1,hostBindings:function(C,v){C&2&&qh("id",v.id)},inputs:{id:"id"},exportAs:["matDialogTitle"],features:[er]})}return D})(),id=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-mdc-dialog-content","mdc-dialog__content"],features:[of([Wu])]})}return D})(),rd=(()=>{class D extends Bf{align;_onAdd(){this._dialogRef._containerInstance?._updateActionSectionCount?.(1)}_onRemove(){this._dialogRef._containerInstance?._updateActionSectionCount?.(-1)}static \u0275fac=(()=>{let y;return function(v){return(y||(y=ra(D)))(v||D)}})();static \u0275dir=Pr({type:D,selectors:[["","mat-dialog-actions",""],["mat-dialog-actions"],["","matDialogActions",""]],hostAttrs:[1,"mat-mdc-dialog-actions","mdc-dialog__actions"],hostVars:6,hostBindings:function(C,v){C&2&&Qt("mat-mdc-dialog-actions-align-start",v.align==="start")("mat-mdc-dialog-actions-align-center",v.align==="center")("mat-mdc-dialog-actions-align-end",v.align==="end")},inputs:{align:"align"},features:[er]})}return D})();function Of(D,he){let y=D.nativeElement.parentElement;for(;y&&!y.classList.contains("mat-mdc-dialog-container");)y=y.parentElement;return y?he.find(C=>C.id===y.id):null}var nd=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[es],imports:[Yh,cl,ha,Gt,Gt]})}return D})();var g0=["*"],ad;function _0(){if(ad===void 0&&(ad=null,typeof window<"u")){let D=window;D.trustedTypes!==void 0&&(ad=D.trustedTypes.createPolicy("angular#components",{createHTML:he=>he}))}return ad}function Pc(D){return _0()?.createHTML(D)||D}function Nf(D){return Error(`Unable to find icon with the name "${D}"`)}function y0(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function jf(D){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${D}".`)}function qf(D){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${D}".`)}var da=class{url;svgText;options;svgElement;constructor(he,y,C){this.url=he,this.svgText=y,this.options=C}},v0=(()=>{class D{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(y,C,v,c){this._httpClient=y,this._sanitizer=C,this._errorHandler=c,this._document=v}addSvgIcon(y,C,v){return this.addSvgIconInNamespace("",y,C,v)}addSvgIconLiteral(y,C,v){return this.addSvgIconLiteralInNamespace("",y,C,v)}addSvgIconInNamespace(y,C,v,c){return this._addSvgIconConfig(y,C,new da(v,null,c))}addSvgIconResolver(y){return this._resolvers.push(y),this}addSvgIconLiteralInNamespace(y,C,v,c){let ce=this._sanitizer.sanitize(il.HTML,v);if(!ce)throw qf(v);let Pe=Pc(ce);return this._addSvgIconConfig(y,C,new da("",Pe,c))}addSvgIconSet(y,C){return this.addSvgIconSetInNamespace("",y,C)}addSvgIconSetLiteral(y,C){return this.addSvgIconSetLiteralInNamespace("",y,C)}addSvgIconSetInNamespace(y,C,v){return this._addSvgIconSetConfig(y,new da(C,null,v))}addSvgIconSetLiteralInNamespace(y,C,v){let c=this._sanitizer.sanitize(il.HTML,C);if(!c)throw qf(C);let ce=Pc(c);return this._addSvgIconSetConfig(y,new da("",ce,v))}registerFontClassAlias(y,C=y){return this._fontCssClassesByAlias.set(y,C),this}classNameForFontAlias(y){return this._fontCssClassesByAlias.get(y)||y}setDefaultFontSetClass(...y){return this._defaultFontSetClass=y,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(y){let C=this._sanitizer.sanitize(il.RESOURCE_URL,y);if(!C)throw jf(y);let v=this._cachedIconsByUrl.get(C);return v?Er(od(v)):this._loadSvgIconFromConfig(new da(y,null)).pipe(An(c=>this._cachedIconsByUrl.set(C,c)),En(c=>od(c)))}getNamedSvgIcon(y,C=""){let v=Uf(C,y),c=this._svgIconConfigs.get(v);if(c)return this._getSvgFromConfig(c);if(c=this._getIconConfigFromResolvers(C,y),c)return this._svgIconConfigs.set(v,c),this._getSvgFromConfig(c);let ce=this._iconSetConfigs.get(C);return ce?this._getSvgFromIconSetConfigs(y,ce):Ym(Nf(v))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(y){return y.svgText?Er(od(this._svgElementFromConfig(y))):this._loadSvgIconFromConfig(y).pipe(En(C=>od(C)))}_getSvgFromIconSetConfigs(y,C){let v=this._extractIconWithNameFromAnySet(y,C);if(v)return Er(v);let c=C.filter(ce=>!ce.svgText).map(ce=>this._loadSvgIconSetFromConfig(ce).pipe(Qm(Pe=>{let ge=`Loading icon set URL: ${this._sanitizer.sanitize(il.RESOURCE_URL,ce.url)} failed: ${Pe.message}`;return this._errorHandler.handleError(new Error(ge)),Er(null)})));return Jm(c).pipe(En(()=>{let ce=this._extractIconWithNameFromAnySet(y,C);if(!ce)throw Nf(y);return ce}))}_extractIconWithNameFromAnySet(y,C){for(let v=C.length-1;v>=0;v--){let c=C[v];if(c.svgText&&c.svgText.toString().indexOf(y)>-1){let ce=this._svgElementFromConfig(c),Pe=this._extractSvgIconFromSet(ce,y,c.options);if(Pe)return Pe}}return null}_loadSvgIconFromConfig(y){return this._fetchIcon(y).pipe(An(C=>y.svgText=C),En(()=>this._svgElementFromConfig(y)))}_loadSvgIconSetFromConfig(y){return y.svgText?Er(null):this._fetchIcon(y).pipe(An(C=>y.svgText=C))}_extractSvgIconFromSet(y,C,v){let c=y.querySelector(`[id="${C}"]`);if(!c)return null;let ce=c.cloneNode(!0);if(ce.removeAttribute("id"),ce.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(ce,v);if(ce.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(ce),v);let Pe=this._svgElementFromString(Pc("<svg></svg>"));return Pe.appendChild(ce),this._setSvgAttributes(Pe,v)}_svgElementFromString(y){let C=this._document.createElement("DIV");C.innerHTML=y;let v=C.querySelector("svg");if(!v)throw Error("<svg> tag not found");return v}_toSvgElement(y){let C=this._svgElementFromString(Pc("<svg></svg>")),v=y.attributes;for(let c=0;c<v.length;c++){let{name:ce,value:Pe}=v[c];ce!=="id"&&C.setAttribute(ce,Pe)}for(let c=0;c<y.childNodes.length;c++)y.childNodes[c].nodeType===this._document.ELEMENT_NODE&&C.appendChild(y.childNodes[c].cloneNode(!0));return C}_setSvgAttributes(y,C){return y.setAttribute("fit",""),y.setAttribute("height","100%"),y.setAttribute("width","100%"),y.setAttribute("preserveAspectRatio","xMidYMid meet"),y.setAttribute("focusable","false"),C&&C.viewBox&&y.setAttribute("viewBox",C.viewBox),y}_fetchIcon(y){let{url:C,options:v}=y,c=v?.withCredentials??!1;if(!this._httpClient)throw y0();if(C==null)throw Error(`Cannot fetch icon from URL "${C}".`);let ce=this._sanitizer.sanitize(il.RESOURCE_URL,C);if(!ce)throw jf(C);let Pe=this._inProgressUrlFetches.get(ce);if(Pe)return Pe;let Je=this._httpClient.get(ce,{responseType:"text",withCredentials:c}).pipe(En(ge=>Pc(ge)),ef(()=>this._inProgressUrlFetches.delete(ce)),tf());return this._inProgressUrlFetches.set(ce,Je),Je}_addSvgIconConfig(y,C,v){return this._svgIconConfigs.set(Uf(y,C),v),this}_addSvgIconSetConfig(y,C){let v=this._iconSetConfigs.get(y);return v?v.push(C):this._iconSetConfigs.set(y,[C]),this}_svgElementFromConfig(y){if(!y.svgElement){let C=this._svgElementFromString(y.svgText);this._setSvgAttributes(C,y.options),y.svgElement=C}return y.svgElement}_getIconConfigFromResolvers(y,C){for(let v=0;v<this._resolvers.length;v++){let c=this._resolvers[v](C,y);if(c)return x0(c)?new da(c.url,null,c.options):new da(c,null)}}static \u0275fac=function(C){return new(C||D)(wc(Zh,8),wc(uf),wc(Ho,8),wc(Oh))};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function od(D){return D.cloneNode(!0)}function Uf(D,he){return D+":"+he}function x0(D){return!!(D.url&&D.options)}var b0=new si("MAT_ICON_DEFAULT_OPTIONS"),w0=new si("mat-icon-location",{providedIn:"root",factory:k0});function k0(){let D=me(Ho),he=D?D.location:null;return{getPathname:()=>he?he.pathname+he.search:""}}var $f=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],C0=$f.map(D=>`[${D}]`).join(", "),S0=/^url\(['"]?#(.*?)['"]?\)$/,Ln=(()=>{class D{_elementRef=me(Ar);_iconRegistry=me(v0);_location=me(w0);_errorHandler=me(Oh);_defaultColor;get color(){return this._color||this._defaultColor}set color(y){this._color=y}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(y){y!==this._svgIcon&&(y?this._updateSvgIcon(y):this._svgIcon&&this._clearSvgElement(),this._svgIcon=y)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(y){let C=this._cleanupFontValue(y);C!==this._fontSet&&(this._fontSet=C,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(y){let C=this._cleanupFontValue(y);C!==this._fontIcon&&(this._fontIcon=C,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=Ya.EMPTY;constructor(){let y=me(new nf("aria-hidden"),{optional:!0}),C=me(b0,{optional:!0});C&&(C.color&&(this.color=this._defaultColor=C.color),C.fontSet&&(this.fontSet=C.fontSet)),y||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(y){if(!y)return["",""];let C=y.split(":");switch(C.length){case 1:return["",C[0]];case 2:return C;default:throw Error(`Invalid icon name: "${y}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let y=this._elementsWithExternalReferences;if(y&&y.size){let C=this._location.getPathname();C!==this._previousPath&&(this._previousPath=C,this._prependPathToReferences(C))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(y){this._clearSvgElement();let C=this._location.getPathname();this._previousPath=C,this._cacheChildrenWithExternalReferences(y),this._prependPathToReferences(C),this._elementRef.nativeElement.appendChild(y)}_clearSvgElement(){let y=this._elementRef.nativeElement,C=y.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();C--;){let v=y.childNodes[C];(v.nodeType!==1||v.nodeName.toLowerCase()==="svg")&&v.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let y=this._elementRef.nativeElement,C=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(v=>v.length>0);this._previousFontSetClass.forEach(v=>y.classList.remove(v)),C.forEach(v=>y.classList.add(v)),this._previousFontSetClass=C,this.fontIcon!==this._previousFontIconClass&&!C.includes("mat-ligature-font")&&(this._previousFontIconClass&&y.classList.remove(this._previousFontIconClass),this.fontIcon&&y.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(y){return typeof y=="string"?y.trim().split(" ")[0]:y}_prependPathToReferences(y){let C=this._elementsWithExternalReferences;C&&C.forEach((v,c)=>{v.forEach(ce=>{c.setAttribute(ce.name,`url('${y}#${ce.value}')`)})})}_cacheChildrenWithExternalReferences(y){let C=y.querySelectorAll(C0),v=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let c=0;c<C.length;c++)$f.forEach(ce=>{let Pe=C[c],Je=Pe.getAttribute(ce),ge=Je?Je.match(S0):null;if(ge){let se=v.get(Pe);se||(se=[],v.set(Pe,se)),se.push({name:ce,value:ge[1]})}})}_updateSvgIcon(y){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),y){let[C,v]=this._splitIconName(y);C&&(this._svgNamespace=C),v&&(this._svgName=v),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(v,C).pipe(Hr(1)).subscribe(c=>this._setSvgElement(c),c=>{let ce=`Error retrieving icon ${C}:${v}! ${c.message}`;this._errorHandler.handleError(new Error(ce))})}}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(C,v){C&2&&(Zt("data-mat-icon-type",v._usingFontIcon()?"font":"svg")("data-mat-icon-name",v._svgName||v.fontIcon)("data-mat-icon-namespace",v._svgNamespace||v.fontSet)("fontIcon",v._usingFontIcon()?v.fontIcon:null),Uo(v.color?"mat-"+v.color:""),Qt("mat-icon-inline",v.inline)("mat-icon-no-color",v.color!=="primary"&&v.color!=="accent"&&v.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Go],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[kc],ngContentSelectors:g0,decls:1,vars:0,template:function(C,v){C&1&&(Dn(),hn(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return D})(),Rn=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Gt]})}return D})();var A0=["mat-menu-item",""],P0=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],D0=["mat-icon, [matMenuItemIcon]","*"];function z0(D,he){D&1&&(Lu(),Ne(0,"svg",2),cn(1,"polygon",3),$e())}var L0=["*"];function R0(D,he){if(D&1){let y=Ii();Ne(0,"div",0),qt("click",function(){Nt(y);let v=rt();return jt(v.closed.emit("click"))})("animationstart",function(v){Nt(y);let c=rt();return jt(c._onAnimationStart(v.animationName))})("animationend",function(v){Nt(y);let c=rt();return jt(c._onAnimationDone(v.animationName))})("animationcancel",function(v){Nt(y);let c=rt();return jt(c._onAnimationDone(v.animationName))}),Ne(1,"div",1),hn(2),$e()()}if(D&2){let y=rt();Uo(y._classList),Qt("mat-menu-panel-animations-disabled",y._animationsDisabled)("mat-menu-panel-exit-animation",y._panelAnimationState==="void")("mat-menu-panel-animating",y._isAnimating),Dt("id",y.panelId),Zt("aria-label",y.ariaLabel||null)("aria-labelledby",y.ariaLabelledby||null)("aria-describedby",y.ariaDescribedby||null)}}var ep=new si("MAT_MENU_PANEL"),zc=(()=>{class D{_elementRef=me(Ar);_document=me(Ho);_focusMonitor=me(Xo);_parentMenu=me(ep,{optional:!0});_changeDetectorRef=me(to);role="menuitem";disabled=!1;disableRipple=!1;_hovered=new Mi;_focused=new Mi;_highlighted=!1;_triggersSubmenu=!1;constructor(){me(Cc).load(Mc),this._parentMenu?.addItem?.(this)}focus(y,C){this._focusMonitor&&y?this._focusMonitor.focusVia(this._getHostElement(),y,C):this._getHostElement().focus(C),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(y){this.disabled&&(y.preventDefault(),y.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let y=this._elementRef.nativeElement.cloneNode(!0),C=y.querySelectorAll("mat-icon, .material-icons");for(let v=0;v<C.length;v++)C[v].remove();return y.textContent?.trim()||""}_setHighlighted(y){this._highlighted=y,this._changeDetectorRef.markForCheck()}_setTriggersSubmenu(y){this._triggersSubmenu=y,this._changeDetectorRef.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-focus-indicator"],hostVars:8,hostBindings:function(C,v){C&1&&qt("click",function(ce){return v._checkDisabled(ce)})("mouseenter",function(){return v._handleMouseEnter()}),C&2&&(Zt("role",v.role)("tabindex",v._getTabIndex())("aria-disabled",v.disabled)("disabled",v.disabled||null),Qt("mat-mdc-menu-item-highlighted",v._highlighted)("mat-mdc-menu-item-submenu-trigger",v._triggersSubmenu))},inputs:{role:"role",disabled:[2,"disabled","disabled",Go],disableRipple:[2,"disableRipple","disableRipple",Go]},exportAs:["matMenuItem"],features:[kc],attrs:A0,ngContentSelectors:D0,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(C,v){C&1&&(Dn(P0),hn(0),Ne(1,"span",0),hn(2,1),$e(),cn(3,"div",1),Mt(4,z0,2,0,":svg:svg",2)),C&2&&(Ye(3),Dt("matRippleDisabled",v.disableRipple||v.disabled)("matRippleTrigger",v._getHostElement()),Ye(),Yt(v._triggersSubmenu?4:-1))},dependencies:[Xh],encapsulation:2,changeDetection:0})}return D})();var F0=new si("MatMenuContent");var B0=new si("mat-menu-default-options",{providedIn:"root",factory:O0});function O0(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var Qu="_mat-menu-enter",ld="_mat-menu-exit",hl=(()=>{class D{_elementRef=me(Ar);_changeDetectorRef=me(to);_injector=me(Qa);_keyManager;_xPosition;_yPosition;_firstItemFocusRef;_exitFallbackTimeout;_animationsDisabled;_allItems;_directDescendantItems=new Vh;_classList={};_panelAnimationState="void";_animationDone=new Mi;_isAnimating=!1;parentMenu;direction;overlayPanelClass;backdropClass;ariaLabel;ariaLabelledby;ariaDescribedby;get xPosition(){return this._xPosition}set xPosition(y){this._xPosition=y,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(y){this._yPosition=y,this.setPositionClasses()}templateRef;items;lazyContent;overlapTrigger;hasBackdrop;set panelClass(y){let C=this._previousPanelClass,v=Kt({},this._classList);C&&C.length&&C.split(" ").forEach(c=>{v[c]=!1}),this._previousPanelClass=y,y&&y.length&&(y.split(" ").forEach(c=>{v[c]=!0}),this._elementRef.nativeElement.className=""),this._classList=v}_previousPanelClass;get classList(){return this.panelClass}set classList(y){this.panelClass=y}closed=new Pn;close=this.closed;panelId=me(Ko).getId("mat-menu-panel-");constructor(){let y=me(B0);this.overlayPanelClass=y.overlayPanelClass||"",this._xPosition=y.xPosition,this._yPosition=y.yPosition,this.backdropClass=y.backdropClass,this.overlapTrigger=y.overlapTrigger,this.hasBackdrop=y.hasBackdrop,this._animationsDisabled=me(el,{optional:!0})==="NoopAnimations"}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new _f(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(ln(this._directDescendantItems),jo(y=>Ja(...y.map(C=>C._focused)))).subscribe(y=>this._keyManager.updateActiveItem(y)),this._directDescendantItems.changes.subscribe(y=>{let C=this._keyManager;if(this._panelAnimationState==="enter"&&C.activeItem?._hasFocus()){let v=y.toArray(),c=Math.max(0,Math.min(v.length-1,C.activeItemIndex||0));v[c]&&!v[c].disabled?C.setActiveItem(c):C.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusRef?.destroy(),clearTimeout(this._exitFallbackTimeout)}_hovered(){return this._directDescendantItems.changes.pipe(ln(this._directDescendantItems),jo(C=>Ja(...C.map(v=>v._hovered))))}addItem(y){}removeItem(y){}_handleKeydown(y){let C=y.keyCode,v=this._keyManager;switch(C){case 27:ro(y)||(y.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(C===38||C===40)&&v.setFocusOrigin("keyboard"),v.onKeydown(y);return}}focusFirstItem(y="program"){this._firstItemFocusRef?.destroy(),this._firstItemFocusRef=tl(()=>{let C=this._resolvePanel();if(!C||!C.contains(document.activeElement)){let v=this._keyManager;v.setFocusOrigin(y).setFirstItemActive(),!v.activeItem&&C&&C.focus()}},{injector:this._injector})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(y){}setPositionClasses(y=this.xPosition,C=this.yPosition){this._classList=Tn(Kt({},this._classList),{"mat-menu-before":y==="before","mat-menu-after":y==="after","mat-menu-above":C==="above","mat-menu-below":C==="below"}),this._changeDetectorRef.markForCheck()}_onAnimationDone(y){let C=y===ld;(C||y===Qu)&&(C&&(clearTimeout(this._exitFallbackTimeout),this._exitFallbackTimeout=void 0),this._animationDone.next(C?"void":"enter"),this._isAnimating=!1)}_onAnimationStart(y){(y===Qu||y===ld)&&(this._isAnimating=!0)}_setIsOpen(y){if(this._panelAnimationState=y?"enter":"void",y){if(this._keyManager.activeItemIndex===0){let C=this._resolvePanel();C&&(C.scrollTop=0)}}else this._animationsDisabled||(this._exitFallbackTimeout=setTimeout(()=>this._onAnimationDone(ld),200));this._animationsDisabled&&setTimeout(()=>{this._onAnimationDone(y?Qu:ld)}),this._changeDetectorRef.markForCheck()}_updateDirectDescendants(){this._allItems.changes.pipe(ln(this._allItems)).subscribe(y=>{this._directDescendantItems.reset(y.filter(C=>C._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}_resolvePanel(){let y=null;return this._directDescendantItems.length&&(y=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),y}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["mat-menu"]],contentQueries:function(C,v,c){if(C&1&&(dn(c,F0,5),dn(c,zc,5),dn(c,zc,4)),C&2){let ce;ji(ce=qi())&&(v.lazyContent=ce.first),ji(ce=qi())&&(v._allItems=ce),ji(ce=qi())&&(v.items=ce)}},viewQuery:function(C,v){if(C&1&&aa(qo,5),C&2){let c;ji(c=qi())&&(v.templateRef=c.first)}},hostVars:3,hostBindings:function(C,v){C&2&&Zt("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[2,"overlapTrigger","overlapTrigger",Go],hasBackdrop:[2,"hasBackdrop","hasBackdrop",y=>y==null?null:Go(y)],panelClass:[0,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],features:[Zo([{provide:ep,useExisting:D}]),kc],ngContentSelectors:L0,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel",3,"click","animationstart","animationend","animationcancel","id"],[1,"mat-mdc-menu-content"]],template:function(C,v){C&1&&(Dn(),Mt(0,R0,3,12,"ng-template"))},styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;outline:0}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-menu-item-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-menu-item-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-menu-item-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-menu-item-label-text-weight, var(--mat-sys-label-large-weight))}@keyframes _mat-menu-enter{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:none}}@keyframes _mat-menu-exit{from{opacity:1}to{opacity:0}}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;box-sizing:border-box;outline:0;animation:_mat-menu-enter 120ms cubic-bezier(0, 0, 0.2, 1);border-radius:var(--mat-menu-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-menu-container-color, var(--mat-sys-surface-container));box-shadow:var(--mat-menu-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));will-change:transform,opacity}.mat-mdc-menu-panel.mat-menu-panel-exit-animation{animation:_mat-menu-exit 100ms 25ms linear forwards}.mat-mdc-menu-panel.mat-menu-panel-animations-disabled{animation:none}.mat-mdc-menu-panel.mat-menu-panel-animating{pointer-events:none}.mat-mdc-menu-panel.mat-menu-panel-animating:has(.mat-mdc-menu-content:empty){display:none}@media(forced-colors: active){.mat-mdc-menu-panel{outline:solid 1px}}.mat-mdc-menu-panel .mat-divider{color:var(--mat-menu-divider-color, var(--mat-sys-surface-variant));margin-bottom:var(--mat-menu-divider-bottom-spacing, 8px);margin-top:var(--mat-menu-divider-top-spacing, 8px)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;min-height:48px;padding-left:var(--mat-menu-item-leading-spacing, 12px);padding-right:var(--mat-menu-item-trailing-spacing, 12px);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-menu-item::-moz-focus-inner{border:0}[dir=rtl] .mat-mdc-menu-item{padding-left:var(--mat-menu-item-trailing-spacing, 12px);padding-right:var(--mat-menu-item-leading-spacing, 12px)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-trailing-spacing, 12px)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-trailing-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-leading-spacing, 12px)}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color, var(--mat-sys-on-surface))}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item:focus{outline:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing, 12px);height:var(--mat-menu-item-icon-size, 24px);width:var(--mat-menu-item-icon-size, 24px)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing, 12px)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent))}@media(forced-colors: active){.mat-mdc-menu-item{margin-top:1px}}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size, 24px);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing, 12px)}[dir=rtl] .mat-mdc-menu-submenu-icon{padding-right:var(--mat-menu-item-spacing, 12px);padding-left:0}[dir=rtl] .mat-mdc-menu-submenu-icon polygon{transform:scaleX(-1);transform-origin:center}@media(forced-colors: active){.mat-mdc-menu-submenu-icon{fill:CanvasText}}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,changeDetection:0})}return D})(),Wf=new si("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let D=me(Xr);return()=>D.scrollStrategies.reposition()}});function V0(D){return()=>D.scrollStrategies.reposition()}var N0={provide:Wf,deps:[Xr],useFactory:V0},Zf=pf({passive:!0});var Dc=new WeakMap,Xf=(()=>{class D{_overlay=me(Xr);_element=me(Ar);_viewContainerRef=me(jh);_menuItemInstance=me(zc,{optional:!0,self:!0});_dir=me(Sc,{optional:!0});_focusMonitor=me(Xo);_ngZone=me(Qs);_scrollStrategy=me(Wf);_changeDetectorRef=me(to);_portal;_overlayRef=null;_menuOpen=!1;_closingActionsSubscription=Ya.EMPTY;_hoverSubscription=Ya.EMPTY;_menuCloseSubscription=Ya.EMPTY;_pendingRemoval;_parentMaterialMenu;_parentInnerPadding;_handleTouchStart=y=>{bf(y)||(this._openedBy="touch")};_openedBy=void 0;get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(y){this.menu=y}get menu(){return this._menu}set menu(y){y!==this._menu&&(this._menu=y,this._menuCloseSubscription.unsubscribe(),y&&(this._parentMaterialMenu,this._menuCloseSubscription=y.close.subscribe(C=>{this._destroyMenu(C),(C==="click"||C==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(C)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}_menu;menuData;restoreFocus=!0;menuOpened=new Pn;onMenuOpen=this.menuOpened;menuClosed=new Pn;onMenuClose=this.menuClosed;constructor(){let y=me(ep,{optional:!0});this._parentMaterialMenu=y instanceof hl?y:void 0,this._element.nativeElement.addEventListener("touchstart",this._handleTouchStart,Zf)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this.menu&&this._ownsMenu(this.menu)&&Dc.delete(this.menu),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,Zf),this._pendingRemoval?.unsubscribe(),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe(),this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null)}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let y=this.menu;if(this._menuOpen||!y)return;this._pendingRemoval?.unsubscribe();let C=Dc.get(y);Dc.set(y,this),C&&C!==this&&C.closeMenu();let v=this._createOverlay(y),c=v.getConfig(),ce=c.positionStrategy;this._setPosition(y,ce),c.hasBackdrop=y.hasBackdrop==null?!this.triggersSubmenu():y.hasBackdrop,v.hasAttached()||(v.attach(this._getPortal(y)),y.lazyContent?.attach(this.menuData)),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),y.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,y.direction=this.dir,y.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0),y instanceof hl&&(y._setIsOpen(!0),y._directDescendantItems.changes.pipe(Js(y.close)).subscribe(()=>{ce.withLockedPosition(!1).reapplyLastPosition(),ce.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(y,C){this._focusMonitor&&y?this._focusMonitor.focusVia(this._element,y,C):this._element.nativeElement.focus(C)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(y){let C=this._overlayRef,v=this._menu;!C||!this.menuOpen||(this._closingActionsSubscription.unsubscribe(),this._pendingRemoval?.unsubscribe(),v instanceof hl&&this._ownsMenu(v)?(this._pendingRemoval=v._animationDone.pipe(Hr(1)).subscribe(()=>{C.detach(),v.lazyContent?.detach()}),v._setIsOpen(!1)):(C.detach(),v?.lazyContent?.detach()),v&&this._ownsMenu(v)&&Dc.delete(v),this.restoreFocus&&(y==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,this._setIsMenuOpen(!1))}_setIsMenuOpen(y){y!==this._menuOpen&&(this._menuOpen=y,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(y),this._changeDetectorRef.markForCheck())}_createOverlay(y){if(!this._overlayRef){let C=this._getOverlayConfig(y);this._subscribeToPositions(y,C.positionStrategy),this._overlayRef=this._overlay.create(C),this._overlayRef.keydownEvents().subscribe(v=>{this.menu instanceof hl&&this.menu._handleKeydown(v)})}return this._overlayRef}_getOverlayConfig(y){return new Kh({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:y.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:y.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir||"ltr"})}_subscribeToPositions(y,C){y.setPositionClasses&&C.positionChanges.subscribe(v=>{this._ngZone.run(()=>{let c=v.connectionPair.overlayX==="start"?"after":"before",ce=v.connectionPair.overlayY==="top"?"below":"above";y.setPositionClasses(c,ce)})})}_setPosition(y,C){let[v,c]=y.xPosition==="before"?["end","start"]:["start","end"],[ce,Pe]=y.yPosition==="above"?["bottom","top"]:["top","bottom"],[Je,ge]=[ce,Pe],[se,ur]=[v,c],Ei=0;if(this.triggersSubmenu()){if(ur=v=y.xPosition==="before"?"start":"end",c=se=v==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let Ui=this._parentMaterialMenu.items.first;this._parentInnerPadding=Ui?Ui._getHostElement().offsetTop:0}Ei=ce==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else y.overlapTrigger||(Je=ce==="top"?"bottom":"top",ge=Pe==="top"?"bottom":"top");C.withPositions([{originX:v,originY:Je,overlayX:se,overlayY:ce,offsetY:Ei},{originX:c,originY:Je,overlayX:ur,overlayY:ce,offsetY:Ei},{originX:v,originY:ge,overlayX:se,overlayY:Pe,offsetY:-Ei},{originX:c,originY:ge,overlayX:ur,overlayY:Pe,offsetY:-Ei}])}_menuClosingActions(){let y=this._overlayRef.backdropClick(),C=this._overlayRef.detachments(),v=this._parentMaterialMenu?this._parentMaterialMenu.closed:Er(),c=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(Gr(ce=>this._menuOpen&&ce!==this._menuItemInstance)):Er();return Ja(y,v,c,C)}_handleMousedown(y){xf(y)||(this._openedBy=y.button===0?"mouse":void 0,this.triggersSubmenu()&&y.preventDefault())}_handleKeydown(y){let C=y.keyCode;(C===13||C===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(C===39&&this.dir==="ltr"||C===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(y){this.triggersSubmenu()?(y.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){this.triggersSubmenu()&&this._parentMaterialMenu&&(this._hoverSubscription=this._parentMaterialMenu._hovered().subscribe(y=>{y===this._menuItemInstance&&!y.disabled&&(this._openedBy="mouse",this.openMenu())}))}_getPortal(y){return(!this._portal||this._portal.templateRef!==y.templateRef)&&(this._portal=new ll(y.templateRef,this._viewContainerRef)),this._portal}_ownsMenu(y){return Dc.get(y)===this}static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(C,v){C&1&&qt("click",function(ce){return v._handleClick(ce)})("mousedown",function(ce){return v._handleMousedown(ce)})("keydown",function(ce){return v._handleKeydown(ce)}),C&2&&Zt("aria-haspopup",v.menu?"menu":null)("aria-expanded",v.menuOpen)("aria-controls",v.menuOpen?v.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[0,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[0,"matMenuTriggerFor","menu"],menuData:[0,"matMenuTriggerData","menuData"],restoreFocus:[0,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"]})}return D})(),cd=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[N0],imports:[ol,Gt,cl,Ic,Gt]})}return D})(),Kf={transformMenu:Yo("transformMenu",[sl("void",Wr({opacity:0,transform:"scale(0.8)"})),la("void => enter",sa("120ms cubic-bezier(0, 0, 0.2, 1)",Wr({opacity:1,transform:"scale(1)"}))),la("* => void",sa("100ms 25ms linear",Wr({opacity:0})))]),fadeInItems:Yo("fadeInItems",[sl("showing",Wr({opacity:1})),la("void => *",[Wr({opacity:0}),sa("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},tv=Kf.fadeInItems,iv=Kf.transformMenu;var Yf=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Ic,Ic,Gt]})}return D})();function q0(D,he){if(D&1&&$o(0,2),D&2){let y=rt();Dt("ngTemplateOutlet",y.iconOverrides[y.state])("ngTemplateOutletContext",y._getIconContext())}}function U0(D,he){if(D&1&&(Ne(0,"span",7),nt(1),$e()),D&2){let y=rt(2);Ye(),tr(y._getDefaultTextForState(y.state))}}function $0(D,he){if(D&1&&(Ne(0,"span",8),nt(1),$e()),D&2){let y=rt(3);Ye(),tr(y._intl.completedLabel)}}function Z0(D,he){if(D&1&&(Ne(0,"span",8),nt(1),$e()),D&2){let y=rt(3);Ye(),tr(y._intl.editableLabel)}}function G0(D,he){if(D&1&&(Mt(0,$0,2,1,"span",8)(1,Z0,2,1,"span",8),Ne(2,"mat-icon",7),nt(3),$e()),D&2){let y=rt(2);Yt(y.state==="done"?0:y.state==="edit"?1:-1),Ye(3),tr(y._getDefaultTextForState(y.state))}}function H0(D,he){if(D&1&&Mt(0,U0,2,1,"span",7)(1,G0,4,2),D&2){let y,C=rt();Yt((y=C.state)==="number"?0:1)}}function W0(D,he){D&1&&(Ne(0,"div",4),$o(1,9),$e()),D&2&&(Ye(),Dt("ngTemplateOutlet",he.template))}function X0(D,he){if(D&1&&(Ne(0,"div",4),nt(1),$e()),D&2){let y=rt();Ye(),tr(y.label)}}function K0(D,he){if(D&1&&(Ne(0,"div",5),nt(1),$e()),D&2){let y=rt();Ye(),tr(y._intl.optionalLabel)}}function Y0(D,he){if(D&1&&(Ne(0,"div",6),nt(1),$e()),D&2){let y=rt();Ye(),tr(y.errorMessage)}}var Jf=["*"];function J0(D,he){}function Q0(D,he){if(D&1&&(hn(0),Mt(1,J0,0,0,"ng-template",0)),D&2){let y=rt();Ye(),Dt("cdkPortalOutlet",y._portal)}}var e1=["animatedContainer"],Qf=(D,he)=>({step:D,i:he});function t1(D,he){D&1&&hn(0)}function i1(D,he){D&1&&cn(0,"div",7)}function r1(D,he){if(D&1&&($o(0,6),Mt(1,i1,1,0,"div",7)),D&2){let y=he.$implicit,C=he.$index,v=he.$index,c=he.$count;rt(2);let ce=oa(4);Dt("ngTemplateOutlet",ce)("ngTemplateOutletContext",Fu(3,Qf,y,C)),Ye(),Yt(v!==c-1?1:-1)}}function n1(D,he){if(D&1&&(Ne(0,"div",8,1),$o(2,9),$e()),D&2){let y=he.$implicit,C=he.$index,v=rt(2);Uo("mat-horizontal-stepper-content-"+v._getAnimationDirection(C)),Dt("id",v._getStepContentId(C)),Zt("aria-labelledby",v._getStepLabelId(C))("inert",v.selectedIndex===C?null:""),Ye(2),Dt("ngTemplateOutlet",y.content)}}function a1(D,he){if(D&1&&(Ne(0,"div",2)(1,"div",3),nl(2,r1,2,6,null,null,rl),$e(),Ne(4,"div",4),nl(5,n1,3,6,"div",5,rl),$e()()),D&2){let y=rt();Ye(2),al(y.steps),Ye(3),al(y.steps)}}function o1(D,he){if(D&1&&(Ne(0,"div",10),$o(1,6),Ne(2,"div",11,1)(4,"div",12)(5,"div",13),$o(6,9),$e()()()()),D&2){let y=he.$implicit,C=he.$index,v=he.$index,c=he.$count,ce=rt(2),Pe=oa(4);Ye(),Dt("ngTemplateOutlet",Pe)("ngTemplateOutletContext",Fu(10,Qf,y,C)),Ye(),Qt("mat-stepper-vertical-line",v!==c-1)("mat-vertical-content-container-active",ce.selectedIndex===C),Zt("inert",ce.selectedIndex===C?null:""),Ye(2),Dt("id",ce._getStepContentId(C)),Zt("aria-labelledby",ce._getStepLabelId(C)),Ye(2),Dt("ngTemplateOutlet",y.content)}}function s1(D,he){if(D&1&&nl(0,o1,7,13,"div",10,rl),D&2){let y=rt();al(y.steps)}}function l1(D,he){if(D&1){let y=Ii();Ne(0,"mat-step-header",14),qt("click",function(){let v=Nt(y).step;return jt(v.select())})("keydown",function(v){Nt(y);let c=rt();return jt(c._onKeydown(v))}),$e()}if(D&2){let y=he.step,C=he.i,v=rt();Qt("mat-horizontal-stepper-header",v.orientation==="horizontal")("mat-vertical-stepper-header",v.orientation==="vertical"),Dt("tabIndex",v._getFocusIndex()===C?0:-1)("id",v._getStepLabelId(C))("index",C)("state",v._getIndicatorType(C,y.state))("label",y.stepLabel||y.label)("selected",v.selectedIndex===C)("active",v._stepIsNavigable(C,y))("optional",y.optional)("errorMessage",y.errorMessage)("iconOverrides",v._iconOverrides)("disableRipple",v.disableRipple||!v._stepIsNavigable(C,y))("color",y.color||v.color),Zt("aria-posinset",C+1)("aria-setsize",v.steps.length)("aria-controls",v._getStepContentId(C))("aria-selected",v.selectedIndex==C)("aria-label",y.ariaLabel||null)("aria-labelledby",!y.ariaLabel&&y.ariaLabelledby?y.ariaLabelledby:null)("aria-disabled",v._stepIsNavigable(C,y)?null:!0)}}var tp=(()=>{class D extends Cf{static \u0275fac=(()=>{let y;return function(v){return(y||(y=ra(D)))(v||D)}})();static \u0275dir=Pr({type:D,selectors:[["","matStepLabel",""]],features:[er]})}return D})(),hd=(()=>{class D{changes=new Mi;optionalLabel="Optional";completedLabel="Completed";editableLabel="Editable";static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function c1(D){return D||new hd}var h1={provide:hd,deps:[[new Pu,new Du,hd]],useFactory:c1},ip=(()=>{class D extends kf{_intl=me(hd);_focusMonitor=me(Xo);_intlSubscription;state;label;errorMessage;iconOverrides;index;selected;active;optional;disableRipple;color;constructor(){super(),me(Cc).load(Mc),me(Cc).load(mf);let y=me(to);this._intlSubscription=this._intl.changes.subscribe(()=>y.markForCheck())}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._intlSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._elementRef)}focus(y,C){y?this._focusMonitor.focusVia(this._elementRef,y,C):this._elementRef.nativeElement.focus(C)}_stringLabel(){return this.label instanceof tp?null:this.label}_templateLabel(){return this.label instanceof tp?this.label:null}_getHostElement(){return this._elementRef.nativeElement}_getIconContext(){return{index:this.index,active:this.active,optional:this.optional}}_getDefaultTextForState(y){return y=="number"?`${this.index+1}`:y=="edit"?"create":y=="error"?"warning":y}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["mat-step-header"]],hostAttrs:["role","tab",1,"mat-step-header"],hostVars:2,hostBindings:function(C,v){C&2&&Uo("mat-"+(v.color||"primary"))},inputs:{state:"state",label:"label",errorMessage:"errorMessage",iconOverrides:"iconOverrides",index:"index",selected:"selected",active:"active",optional:"optional",disableRipple:"disableRipple",color:"color"},features:[er],decls:10,vars:17,consts:[["matRipple","",1,"mat-step-header-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-step-icon-content"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-step-label"],[1,"mat-step-text-label"],[1,"mat-step-optional"],[1,"mat-step-sub-label-error"],["aria-hidden","true"],[1,"cdk-visually-hidden"],[3,"ngTemplateOutlet"]],template:function(C,v){if(C&1&&(cn(0,"div",0),Ne(1,"div")(2,"div",1),Mt(3,q0,1,2,"ng-container",2)(4,H0,2,1),$e()(),Ne(5,"div",3),Mt(6,W0,2,1,"div",4)(7,X0,2,1,"div",4)(8,K0,2,1,"div",5)(9,Y0,2,1,"div",6),$e()),C&2){let c;Dt("matRippleTrigger",v._getHostElement())("matRippleDisabled",v.disableRipple),Ye(),sf("mat-step-icon-state-",v.state," mat-step-icon"),Qt("mat-step-icon-selected",v.selected),Ye(2),Yt(v.iconOverrides&&v.iconOverrides[v.state]?3:4),Ye(2),Qt("mat-step-label-active",v.active)("mat-step-label-selected",v.selected)("mat-step-label-error",v.state=="error"),Ye(),Yt((c=v._templateLabel())?6:v._stringLabel()?7:-1,c),Ye(2),Yt(v.optional&&v.state!="error"?8:-1),Ye(),Yt(v.state==="error"?9:-1)}},dependencies:[Xh,Ou,Ln],styles:['.mat-step-header{overflow:hidden;outline:none;cursor:pointer;position:relative;box-sizing:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-step-header:focus .mat-focus-indicator::before{content:""}.mat-step-header:hover[aria-disabled=true]{cursor:default}.mat-step-header:hover:not([aria-disabled]),.mat-step-header:hover[aria-disabled=false]{background-color:var(--mat-stepper-header-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-hover-state-layer-shape, var(--mat-sys-corner-medium))}.mat-step-header.cdk-keyboard-focused,.mat-step-header.cdk-program-focused{background-color:var(--mat-stepper-header-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-focus-state-layer-shape, var(--mat-sys-corner-medium))}@media(hover: none){.mat-step-header:hover{background:none}}@media(forced-colors: active){.mat-step-header{outline:solid 1px}.mat-step-header[aria-selected=true] .mat-step-label{text-decoration:underline}.mat-step-header[aria-disabled=true]{outline-color:GrayText}.mat-step-header[aria-disabled=true] .mat-step-label,.mat-step-header[aria-disabled=true] .mat-step-icon,.mat-step-header[aria-disabled=true] .mat-step-optional{color:GrayText}}.mat-step-optional{font-size:12px;color:var(--mat-stepper-header-optional-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-sub-label-error{font-size:12px;font-weight:normal}.mat-step-icon{border-radius:50%;height:24px;width:24px;flex-shrink:0;position:relative;color:var(--mat-stepper-header-icon-foreground-color, var(--mat-sys-surface));background-color:var(--mat-stepper-header-icon-background-color, var(--mat-sys-on-surface-variant))}.mat-step-icon-content{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex}.mat-step-icon .mat-icon{font-size:16px;height:16px;width:16px}.mat-step-icon-state-error{background-color:var(--mat-stepper-header-error-state-icon-background-color, transparent);color:var(--mat-stepper-header-error-state-icon-foreground-color, var(--mat-sys-error))}.mat-step-icon-state-error .mat-icon{font-size:24px;height:24px;width:24px}.mat-step-label{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:50px;vertical-align:middle;font-family:var(--mat-stepper-header-label-text-font, var(--mat-sys-title-small-font));font-size:var(--mat-stepper-header-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-label-text-weight, var(--mat-sys-title-small-weight));color:var(--mat-stepper-header-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-active{color:var(--mat-stepper-header-selected-state-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-error{color:var(--mat-stepper-header-error-state-label-text-color, var(--mat-sys-error));font-size:var(--mat-stepper-header-error-state-label-text-size, var(--mat-sys-title-small-size))}.mat-step-label.mat-step-label-selected{font-size:var(--mat-stepper-header-selected-state-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-selected-state-label-text-weight, var(--mat-sys-title-small-weight))}.mat-step-text-label{text-overflow:ellipsis;overflow:hidden}.mat-step-header .mat-step-header-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-step-icon-selected{background-color:var(--mat-stepper-header-selected-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-selected-state-icon-foreground-color, var(--mat-sys-on-primary))}.mat-step-icon-state-done{background-color:var(--mat-stepper-header-done-state-icon-background-color);color:var(--mat-stepper-header-done-state-icon-foreground-color)}.mat-step-icon-state-edit{background-color:var(--mat-stepper-header-edit-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-edit-state-icon-foreground-color, var(--mat-sys-on-primary))}'],encapsulation:2,changeDetection:0})}return D})(),rp=(()=>{class D{templateRef=me(qo);name;constructor(){}static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D,selectors:[["ng-template","matStepperIcon",""]],inputs:{name:[0,"matStepperIcon","name"]}})}return D})(),d1=(()=>{class D{_template=me(qo);constructor(){}static \u0275fac=function(C){return new(C||D)};static \u0275dir=Pr({type:D,selectors:[["ng-template","matStepContent",""]]})}return D})(),np=(()=>{class D extends Nu{_errorStateMatcher=me(Wh,{skipSelf:!0});_viewContainerRef=me(jh);_isSelected=Ya.EMPTY;stepLabel=void 0;color;_lazyContent;_portal;ngAfterContentInit(){this._isSelected=this._stepper.steps.changes.pipe(jo(()=>this._stepper.selectionChange.pipe(En(y=>y.selectedStep===this),ln(this._stepper.selected===this)))).subscribe(y=>{y&&this._lazyContent&&!this._portal&&(this._portal=new ll(this._lazyContent._template,this._viewContainerRef))})}ngOnDestroy(){this._isSelected.unsubscribe()}isErrorState(y,C){let v=this._errorStateMatcher.isErrorState(y,C),c=!!(y&&y.invalid&&this.interacted);return v||c}static \u0275fac=(()=>{let y;return function(v){return(y||(y=ra(D)))(v||D)}})();static \u0275cmp=kt({type:D,selectors:[["mat-step"]],contentQueries:function(C,v,c){if(C&1&&(dn(c,tp,5),dn(c,d1,5)),C&2){let ce;ji(ce=qi())&&(v.stepLabel=ce.first),ji(ce=qi())&&(v._lazyContent=ce.first)}},hostAttrs:["hidden",""],inputs:{color:"color"},exportAs:["matStep"],features:[Zo([{provide:Wh,useExisting:D},{provide:Nu,useExisting:D}]),er],ngContentSelectors:Jf,decls:1,vars:0,consts:[[3,"cdkPortalOutlet"]],template:function(C,v){C&1&&(Dn(),Mt(0,Q0,2,1,"ng-template"))},dependencies:[ca],encapsulation:2,changeDetection:0})}return D})(),ap=(()=>{class D extends ju{_ngZone=me(Qs);_renderer=me(Nh);_animationsModule=me(el,{optional:!0});_cleanupTransition;_isAnimating=na(!1);_stepHeader=void 0;_animatedContainers;_steps=void 0;steps=new Vh;_icons;animationDone=new Pn;disableRipple;color;labelPosition="end";headerPosition="top";_iconOverrides={};get animationDuration(){return this._animationDuration}set animationDuration(y){this._animationDuration=/^\d+$/.test(y)?y+"ms":y}_animationDuration="";_isServer=!me(Gh).isBrowser;constructor(){super();let C=me(Ar).nativeElement.nodeName.toLowerCase();this.orientation=C==="mat-vertical-stepper"?"vertical":"horizontal"}ngAfterContentInit(){super.ngAfterContentInit(),this._icons.forEach(({name:y,templateRef:C})=>this._iconOverrides[y]=C),this.steps.changes.pipe(Js(this._destroyed)).subscribe(()=>this._stateChanged()),this.selectedIndexChange.pipe(Js(this._destroyed)).subscribe(()=>{let y=this._getAnimationDuration();y==="0ms"||y==="0s"?this._onAnimationDone():this._isAnimating.set(!0)}),this._ngZone.runOutsideAngular(()=>{this._animationsModule!=="NoopAnimations"&&setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-stepper-animations-enabled"),this._cleanupTransition=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._handleTransitionend)},200)})}ngAfterViewInit(){if(super.ngAfterViewInit(),typeof queueMicrotask=="function"){let y=!1;this._animatedContainers.changes.pipe(ln(null),Js(this._destroyed)).subscribe(()=>queueMicrotask(()=>{y||(y=!0,this.animationDone.emit()),this._stateChanged()}))}}ngOnDestroy(){super.ngOnDestroy(),this._cleanupTransition?.()}_stepIsNavigable(y,C){return C.completed||this.selectedIndex===y||!this.linear}_getAnimationDuration(){return this._animationsModule==="NoopAnimations"?"0ms":this.animationDuration?this.animationDuration:this.orientation==="horizontal"?"500ms":"225ms"}_handleTransitionend=y=>{let C=y.target;if(!C)return;let v=this.orientation==="horizontal"&&y.propertyName==="transform"&&C.classList.contains("mat-horizontal-stepper-content-current"),c=this.orientation==="vertical"&&y.propertyName==="grid-template-rows"&&C.classList.contains("mat-vertical-content-container-active");(v||c)&&this._animatedContainers.find(Pe=>Pe.nativeElement===C)&&this._onAnimationDone()};_onAnimationDone(){this._isAnimating.set(!1),this.animationDone.emit()}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["mat-stepper"],["mat-vertical-stepper"],["mat-horizontal-stepper"],["","matStepper",""]],contentQueries:function(C,v,c){if(C&1&&(dn(c,np,5),dn(c,rp,5)),C&2){let ce;ji(ce=qi())&&(v._steps=ce),ji(ce=qi())&&(v._icons=ce)}},viewQuery:function(C,v){if(C&1&&(aa(ip,5),aa(e1,5)),C&2){let c;ji(c=qi())&&(v._stepHeader=c),ji(c=qi())&&(v._animatedContainers=c)}},hostAttrs:["role","tablist"],hostVars:15,hostBindings:function(C,v){C&2&&(Zt("aria-orientation",v.orientation),Ru("--mat-stepper-animation-duration",v._getAnimationDuration()),Qt("mat-stepper-horizontal",v.orientation==="horizontal")("mat-stepper-vertical",v.orientation==="vertical")("mat-stepper-label-position-end",v.orientation==="horizontal"&&v.labelPosition=="end")("mat-stepper-label-position-bottom",v.orientation==="horizontal"&&v.labelPosition=="bottom")("mat-stepper-header-position-bottom",v.headerPosition==="bottom")("mat-stepper-animating",v._isAnimating()))},inputs:{disableRipple:"disableRipple",color:"color",labelPosition:"labelPosition",headerPosition:"headerPosition",animationDuration:"animationDuration"},outputs:{animationDone:"animationDone"},exportAs:["matStepper","matVerticalStepper","matHorizontalStepper"],features:[Zo([{provide:ju,useExisting:D}]),er],ngContentSelectors:Jf,decls:5,vars:2,consts:[["stepTemplate",""],["animatedContainer",""],[1,"mat-horizontal-stepper-wrapper"],[1,"mat-horizontal-stepper-header-container"],[1,"mat-horizontal-content-container"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id","class"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-stepper-horizontal-line"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id"],[3,"ngTemplateOutlet"],[1,"mat-step"],[1,"mat-vertical-content-container"],["role","tabpanel",1,"mat-vertical-stepper-content",3,"id"],[1,"mat-vertical-content"],[3,"click","keydown","tabIndex","id","index","state","label","selected","active","optional","errorMessage","iconOverrides","disableRipple","color"]],template:function(C,v){if(C&1&&(Dn(),Mt(0,t1,1,0)(1,a1,7,0,"div",2)(2,s1,2,0)(3,l1,1,23,"ng-template",null,0,Bu)),C&2){let c;Yt(v._isServer?0:-1),Ye(),Yt((c=v.orientation)==="horizontal"?1:c==="vertical"?2:-1)}},dependencies:[Ou,ip],styles:['.mat-stepper-vertical,.mat-stepper-horizontal{display:block;font-family:var(--mat-stepper-container-text-font, var(--mat-sys-body-medium-font));background:var(--mat-stepper-container-color, var(--mat-sys-surface))}.mat-horizontal-stepper-header-container{white-space:nowrap;display:flex;align-items:center}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header-container{align-items:flex-start}.mat-stepper-header-position-bottom .mat-horizontal-stepper-header-container{order:1}.mat-stepper-horizontal-line{border-top-width:1px;border-top-style:solid;flex:auto;height:0;margin:0 -16px;min-width:32px;border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-stepper-horizontal-line{margin:0;min-width:0;position:relative;top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{border-top-width:1px;border-top-style:solid;content:"";display:inline-block;height:0;position:absolute;width:calc(50% - 20px)}.mat-horizontal-stepper-header{display:flex;height:72px;overflow:hidden;align-items:center;padding:0 24px;height:var(--mat-stepper-header-height, 72px)}.mat-horizontal-stepper-header .mat-step-icon{margin-right:8px;flex:none}[dir=rtl] .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:8px}.mat-horizontal-stepper-header::before,.mat-horizontal-stepper-header::after{border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::after{top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{box-sizing:border-box;flex-direction:column;height:auto}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{right:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before{left:0}[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:last-child::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:first-child::after{display:none}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-label{padding:16px 0 0 0;text-align:center;width:100%}.mat-vertical-stepper-header{display:flex;align-items:center;height:24px;padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-vertical-stepper-header .mat-step-icon{margin-right:12px}[dir=rtl] .mat-vertical-stepper-header .mat-step-icon{margin-right:0;margin-left:12px}.mat-horizontal-stepper-wrapper{display:flex;flex-direction:column}.mat-horizontal-stepper-content{visibility:hidden;overflow:hidden;outline:0;height:0}.mat-stepper-animations-enabled .mat-horizontal-stepper-content{transition:transform var(--mat-stepper-animation-duration, 0) cubic-bezier(0.35, 0, 0.25, 1)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-previous{transform:translate3d(-100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-next{transform:translate3d(100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{visibility:visible;transform:none;height:auto}.mat-stepper-horizontal:not(.mat-stepper-animating) .mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{overflow:visible}.mat-horizontal-content-container{overflow:hidden;padding:0 24px 24px 24px}@media(forced-colors: active){.mat-horizontal-content-container{outline:solid 1px}}.mat-stepper-header-position-bottom .mat-horizontal-content-container{padding:24px 24px 0 24px}.mat-vertical-content-container{display:grid;grid-template-rows:0fr;grid-template-columns:100%;margin-left:36px;border:0;position:relative}.mat-stepper-animations-enabled .mat-vertical-content-container{transition:grid-template-rows var(--mat-stepper-animation-duration, 0) cubic-bezier(0.4, 0, 0.2, 1)}.mat-vertical-content-container.mat-vertical-content-container-active{grid-template-rows:1fr}.mat-step:last-child .mat-vertical-content-container{border:none}@media(forced-colors: active){.mat-vertical-content-container{outline:solid 1px}}[dir=rtl] .mat-vertical-content-container{margin-left:0;margin-right:36px}@supports not (grid-template-rows: 0fr){.mat-vertical-content-container{height:0}.mat-vertical-content-container.mat-vertical-content-container-active{height:auto}}.mat-stepper-vertical-line::before{content:"";position:absolute;left:0;border-left-width:1px;border-left-style:solid;border-left-color:var(--mat-stepper-line-color, var(--mat-sys-outline));top:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2));bottom:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2))}[dir=rtl] .mat-stepper-vertical-line::before{left:auto;right:0}.mat-vertical-stepper-content{overflow:hidden;outline:0;visibility:hidden}.mat-stepper-animations-enabled .mat-vertical-stepper-content{transition:visibility var(--mat-stepper-animation-duration, 0) linear}.mat-vertical-content-container-active>.mat-vertical-stepper-content{visibility:visible}.mat-vertical-content{padding:0 24px 24px 24px}'],encapsulation:2,changeDetection:0})}return D})();var eg=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[h1,Wh],imports:[Gt,ha,Sf,Rn,ol,ap,ip,Gt]})}return D})();function p1(D,he){if(D&1&&nt(0),D&2){let y=he.index;eo(" ",y+1," ")}}function m1(D,he){if(D&1&&nt(0),D&2){let y=he.index;eo(" ",y+1," ")}}function f1(D,he){if(D&1&&nt(0),D&2){let y=he.index;eo(" ",y+1," ")}}var tg=(()=>{class D{_dialogRef=me(Jo);constructor(){this._dialogRef.addPanelClass("dialog-fullscreen")}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-guide-dialog"]],decls:23,vars:0,consts:[["stepper",""],["mat-dialog-title",""],["mat-dialog-close",""],[1,"content"],["matStepperIcon","edit"],["matStepperIcon","done"],["matStepperIcon","number"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","",3,"click"]],template:function(C,v){if(C&1){let c=Ii();Ne(0,"div",1)(1,"span"),nt(2,"Install Angular"),$e(),Ne(3,"mat-icon",2),nt(4,"close"),$e()(),Ne(5,"mat-stepper",null,0)(7,"mat-step")(8,"div",3),nt(9," Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque? "),$e()(),Ne(10,"mat-step"),nt(11,"asd "),$e(),Ne(12,"mat-step"),nt(13," asd"),$e(),Mt(14,p1,1,1,"ng-template",4)(15,m1,1,1,"ng-template",5)(16,f1,1,1,"ng-template",6),$e(),cn(17,"mat-dialog-content"),Ne(18,"mat-dialog-actions",7)(19,"button",8),qt("click",function(){Nt(c);let Pe=oa(6);return jt(Pe.previous())}),nt(20,"Poprzednie"),$e(),Ne(21,"button",9),qt("click",function(){Nt(c);let Pe=oa(6);return jt(Pe.next())}),nt(22,"Nast\u0119pne"),$e()()}},dependencies:[eg,np,ap,rp,zn,no,nd,ed,td,rd,id,Rn,Ln],styles:[`.mat-step-label{display:none!important}  .mat-horizontal-stepper-header-container{position:sticky;top:0;background-color:var(--mat-sys-surface)}.content[_ngcontent-%COMP%]{overflow:hidden;flex:1}mat-dialog-actions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface);position:sticky;bottom:0}
/*# sourceMappingURL=guide-dialog.component-4WLZEMEU.css.map */`],changeDetection:0})}return D})();var dl=Km(lp());var rg=Km(lp());var oo={geocodeApi:"https://services.gugik.gov.pl/uug",primaryColor:"#0078bd",apiUrl:"https://parkowanko.onrender.com/api"};var ng=(()=>{class D{prepareMarker(){let y=document.createElement("div");return y.className="marker",new rg.Marker({element:y})}async preparePoiLayers(y,C){y.addSource("parkings",{type:"geojson",data:{type:"FeatureCollection",features:[]},cluster:!0,clusterMaxZoom:14,clusterRadius:50});let v=await y.loadImage("https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Cyprus_road_sign_parking.svg/212px-Cyprus_road_sign_parking.svg.png?20130416124154");y.addImage("parking",v.data),y.addSource("point",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[0,0]}}]}}),y.addLayer({id:"unclustered-point",type:"symbol",source:"parkings",filter:["!",["has","point_count"]],layout:{"icon-image":"parking","icon-size":.1}}),y.addLayer({id:"clusters",type:"circle",source:C,filter:["has","point_count"],paint:{"circle-color":oo.primaryColor,"circle-radius":["step",["get","point_count"],20,100,30,750,40],"circle-stroke-color":"#FFFFFF","circle-stroke-width":2}}),y.addLayer({id:"cluster-count",type:"symbol",source:C,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Roboto Regular"],"text-size":16},paint:{"text-color":"#FFFFFF"}}),y.addSource("line-source",{type:"geojson",data:this.getLineGeoJson()}),y.addLayer({id:"line-layer",type:"line",source:"line-source",paint:{"line-color":oo.primaryColor,"line-width":3,"line-dasharray":[2,2]}})}getLineGeoJson(y,C){let v=[];return y&&C&&(v=[[y.lng,y.lat],[C.lng,C.lat]]),{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:v},properties:[]}]}}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();var Lc=[14,48,24.5,56],g1=[Lc[0]-3,Lc[1]-3,Lc[2]+3,Lc[3]+3],_1=16,ud=(()=>{class D{_mapRendererService=me(ng);_markerMoveListener;_markerRef=this._mapRendererService.prepareMarker();_map;_selectingMode="enabled";selectedParking=na(null);_isMapLoaded=na(!1);isMapLoaded=this._isMapLoaded.asReadonly();constructor(){this._prepareAdditionalFeaturesOnLoadMap()}_prepareAdditionalFeaturesOnLoadMap(){$h(()=>{this.isMapLoaded()&&io(()=>{this._listenForPoiClick(),this._mapRendererService.preparePoiLayers(this._map,"parkings")})})}getMarkerLatLng(){return this._markerRef?.getLngLat()}setSelectingMode(y){this._selectingMode=y}getMap(){return this._map}async initialRenderMap(){let y=await import("./chunk-WITXWRDT.js");this._map=new dl.Map({container:"map",maxBounds:g1,bounds:Lc,style:y}).addControl(new dl.NavigationControl({showCompass:!1})).addControl(new dl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,fitBoundsOptions:{maxZoom:17}})).on("load",()=>this._isMapLoaded.set(!0))}_listenForPoiClick(){this._map.on("click","unclustered-point",y=>{if(this._selectingMode==="disabled")return;let C=y.features?.[0]?.properties;this.selectedParking.set(JSON.parse(C.parking))})}renderPoiList(y){this._map.getSource("parkings").setData({type:"FeatureCollection",features:y.map(c=>({type:"Feature",geometry:{type:"Point",coordinates:[c.location.lng,c.location.lat]},properties:{parking:c}}))})}renderMarkerForFocusPoi(y){this.removeMarkerForFocusPoi(),this._markerRef.setLngLat(y).addTo(this._map)}removeMarkerForFocusPoi(){this._markerRef.remove()}renderMoveableMarker(){this.removeMoveableMarker(),this._markerRef.setLngLat(this._map.getCenter()).addTo(this._map),this._markerMoveListener=y=>{this._markerRef.setLngLat(y.target.getCenter()),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson(this.selectedParking()?.location,this._markerRef.getLngLat()))},this._map.on("move",this._markerMoveListener)}removeMoveableMarker(){this._markerRef.remove(),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson()),this._map.off("move",this._markerMoveListener)}jumpToPoi(y){this._map.jumpTo({center:[y.lng,y.lat],zoom:_1})}ngOnDestroy(){this._map?.remove()}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();var ag=(()=>{class D{_mapService=me(ud);parkingsList=af([]);constructor(){tl(()=>this._mapService.initialRenderMap()),$h(()=>{this._mapService.isMapLoaded()&&(this.parkingsList(),io(()=>this._mapService.renderPoiList(this.parkingsList())))})}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-map"]],hostAttrs:["id","map"],inputs:{parkingsList:[1,"parkingsList"]},decls:0,vars:0,template:function(C,v){},styles:[`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors: active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors: active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors: active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors: active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover: none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}#map{height:100vh;width:100%;display:flex}#map .maplibregl-ctrl-attrib{display:none}#map .maplibregl-ctrl-group{border-radius:var(--mat-sys-corner-medium)}#map .maplibregl-ctrl-group button{width:40px;height:40px}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.marker{background-image:url("./media/parking-poi-KLDG7L2W.svg");background-size:cover;width:60px;aspect-ratio:1/1;translate:0px -50%;position:relative;animation:fadeIn .5s}
/*# sourceMappingURL=map.component-PYBCT4E7.css.map */
`],encapsulation:2,changeDetection:0})}return D})();function y1(D,he){}var v1={bottomSheetState:Yo("state",[sl("void, hidden",Wr({transform:"translateY(100%)"})),sl("visible",Wr({transform:"translateY(0%)"})),la("visible => void, visible => hidden",$u([sa(`${Uu.COMPLEX} ${qu.ACCELERATION_CURVE}`),Gu("@*",Zu(),{optional:!0})])),la("void => visible",$u([sa(`${Uu.EXITING} ${qu.DECELERATION_CURVE}`),Gu("@*",Zu(),{optional:!0})]))])},x1=(()=>{class D extends Tc{_breakpointSubscription;_animationState="void";_animationStateChanged=new Pn;_destroyed;constructor(){super();let y=me(gf);this._breakpointSubscription=y.observe([Wo.Medium,Wo.Large,Wo.XLarge]).subscribe(()=>{let C=this._elementRef.nativeElement.classList;C.toggle("mat-bottom-sheet-container-medium",y.isMatched(Wo.Medium)),C.toggle("mat-bottom-sheet-container-large",y.isMatched(Wo.Large)),C.toggle("mat-bottom-sheet-container-xlarge",y.isMatched(Wo.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(y){y.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(y)}_onAnimationStart(y){this._animationStateChanged.emit(y)}_captureInitialFocus(){}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(C,v){C&1&&cf("@state.start",function(ce){return v._onAnimationStart(ce)})("@state.done",function(ce){return v._onAnimationDone(ce)}),C&2&&(lf("@state",v._animationState),Zt("role",v._config.role)("aria-modal",v._config.ariaModal)("aria-label",v._config.ariaLabel))},features:[er],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(C,v){C&1&&Mt(0,y1,0,0,"ng-template",0)},dependencies:[ca],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color, var(--mat-sys-surface-container-low));color:var(--mat-bottom-sheet-container-text-color, var(--mat-sys-on-surface));font-family:var(--mat-bottom-sheet-container-text-font, var(--mat-sys-body-large-font));font-size:var(--mat-bottom-sheet-container-text-size, var(--mat-sys-body-large-size));line-height:var(--mat-bottom-sheet-container-text-line-height, var(--mat-sys-body-large-line-height));font-weight:var(--mat-bottom-sheet-container-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mat-bottom-sheet-container-text-tracking, var(--mat-sys-body-large-tracking))}@media(forced-colors: active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape, 28px);border-top-right-radius:var(--mat-bottom-sheet-container-shape, 28px)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[v1.bottomSheetState]}})}return D})(),hp=new si("MatBottomSheetData"),cp=class{viewContainerRef;panelClass;direction;data=null;hasBackdrop=!0;backdropClass;disableClose=!1;ariaLabel=null;ariaModal=!0;closeOnNavigation=!0;autoFocus="dialog";restoreFocus=!0;scrollStrategy;height="";minHeight;maxHeight},ul=class{_ref;get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}containerInstance;disableClose;_afterOpened=new Mi;_result;_closeFallbackTimeout;constructor(he,y,C){this._ref=he,this.containerInstance=C,this.disableClose=y.disableClose,C._animationStateChanged.pipe(Gr(v=>v.phaseName==="done"&&v.toState==="visible"),Hr(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),C._animationStateChanged.pipe(Gr(v=>v.phaseName==="done"&&v.toState==="hidden"),Hr(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),he.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),Ja(this.backdropClick(),this.keydownEvents().pipe(Gr(v=>v.keyCode===27))).subscribe(v=>{!this.disableClose&&(v.type!=="keydown"||!ro(v))&&(v.preventDefault(),this.dismiss())})}dismiss(he){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(Gr(y=>y.phaseName==="start"),Hr(1)).subscribe(y=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},y.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=he,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},b1=new si("mat-bottom-sheet-default-options"),dp=(()=>{class D{_overlay=me(Xr);_parentBottomSheet=me(D,{optional:!0,skipSelf:!0});_defaultOptions=me(b1,{optional:!0});_bottomSheetRefAtThisLevel=null;_dialog=me(Ec);get _openedBottomSheetRef(){let y=this._parentBottomSheet;return y?y._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(y){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=y:this._bottomSheetRefAtThisLevel=y}constructor(){}open(y,C){let v=Kt(Kt({},this._defaultOptions||new cp),C),c;return this._dialog.open(y,Tn(Kt({},v),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:x1,scrollStrategy:v.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:c}),providers:(ce,Pe,Je)=>(c=new ul(ce,v,Je),[{provide:ul,useValue:c},{provide:hp,useValue:v.data}])})),c.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===c&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>c.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):c.containerInstance.enter(),this._openedBottomSheetRef=c,c}dismiss(y){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(y)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})(),og=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({providers:[dp],imports:[Yh,Gt,ha,Gt]})}return D})();var sg=Yo("enterFadeAnimation",[la(":enter",[Wr({opacity:0}),sa("200ms",Wr({opacity:1}))])]);function up(D){return D?.injector||rf(up),df(Tn(Kt({},D),{stream:he=>{let y,C=()=>y.unsubscribe();he.abortSignal.addEventListener("abort",C);let v=na({value:void 0}),c,ce=new Promise(Je=>c=Je);function Pe(Je){v.set(Je),c?.(v),c=void 0}return y=D.loader(he).subscribe({next:Je=>Pe({value:Je}),error:Je=>Pe({error:Je}),complete:()=>{c&&Pe({error:new Error("Resource completed before producing a value")}),he.abortSignal.removeEventListener("abort",C)}}),ce}}))}var pd=class{id;created_at;updated_at};var md=class extends pd{location;name;description;constructor(he){super(),Object.entries(he).forEach(([y,C])=>{["created_at","updated_at"].includes(y)?this[y]=new Date(C):this[y]=C})}};var fd=(()=>{class D{_httpClient=me(Zh);parkingsList=up({loader:()=>this.getParkings(),defaultValue:[]});getParkings(){return this._httpClient.get(`${oo.apiUrl}/parkings/?format=json`).pipe(En(y=>y.map(C=>new md(C))))}postParking(y){return this._httpClient.post(`${oo.apiUrl}/parkings`,y).pipe(An(()=>this.parkingsList.reload()))}patchParking(y,C){return this._httpClient.patch(`${oo.apiUrl}/parkings/${y}`,C).pipe(An(()=>this.parkingsList.reload()))}deleteParking(y){return this._httpClient.delete(`${oo.apiUrl}/parkings/${y}`).pipe(An(()=>this.parkingsList.reload()))}static \u0275fac=function(C){return new(C||D)};static \u0275prov=Ni({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})();function w1(D,he){if(D&1&&(Ne(0,"button",1),nt(1),$e()),D&2){let y=rt();Dt("mat-dialog-close",!1),Ye(),eo(" ",y.dialogData.cancelButtonLabel," ")}}function k1(D,he){if(D&1&&(Ne(0,"button",3),nt(1),$e()),D&2){let y=rt();Qt("error-theme",y.dialogData.isConfirmErrorButton),Dt("mat-dialog-close",!0),Ye(),eo(" ",y.dialogData.confirmButtonLabel," ")}}var lg=(()=>{class D{dialogData=me(Ju);constructor(){this._setInitialData()}_setInitialData(){this.dialogData=Kt({title:this.dialogData.title,content:"",cancelButtonLabel:"Anuluj",confirmButtonLabel:"Potwierd\u017A",hideCancelButton:!1,hideConfirmButton:!1,isConfirmErrorButton:!0},this.dialogData)}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-title",""],["mat-button","",3,"mat-dialog-close"],["mat-flat-button","",3,"mat-dialog-close","error-theme"],["mat-flat-button","",3,"mat-dialog-close"]],template:function(C,v){C&1&&(Ne(0,"div",0),nt(1),$e(),Ne(2,"mat-dialog-content"),nt(3),$e(),Ne(4,"mat-dialog-actions"),Mt(5,w1,2,2,"button",1)(6,k1,2,4,"button",2),$e()),C&2&&(Ye(),tr(v.dialogData.title),Ye(2),eo(" ",v.dialogData.content,`
`),Ye(2),Yt(v.dialogData.hideCancelButton?-1:5),Ye(),Yt(v.dialogData.hideConfirmButton?-1:6))},dependencies:[nd,ed,td,rd,id,zn,no],encapsulation:2,changeDetection:0})}return D})();var cg=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[Gt,Gt]})}return D})();var hg=(()=>{class D{static \u0275fac=function(C){return new(C||D)};static \u0275mod=yi({type:D});static \u0275inj=_i({imports:[ff,Gt,ol,Mf,cg]})}return D})();function C1(D,he){if(D&1){let y=Ii();Ne(0,"button",3),qt("click",function(){Nt(y);let v=rt().$implicit,c=rt();return jt(c.choose(v.result))}),Ne(1,"mat-icon"),nt(2),$e(),Ne(3,"div"),nt(4),$e()()}if(D&2){let y=rt().$implicit;Qt("error-theme",y.isError),Ye(2),tr(y.icon),Ye(2),tr(y.label)}}function S1(D,he){if(D&1){let y=Ii();Ne(0,"button",4),qt("click",function(){Nt(y);let v=rt().$implicit,c=rt();return jt(c.choose(v.result))}),Ne(1,"mat-icon"),nt(2),$e(),Ne(3,"div"),nt(4),$e()()}if(D&2){let y=rt().$implicit;Ye(2),tr(y.icon),Ye(2),tr(y.label)}}function M1(D,he){if(D&1&&Mt(0,C1,5,4,"button",1)(1,S1,5,2,"button",2),D&2){let y=he.$implicit;Yt(y.isPrimary||y.isError?0:1)}}var dg=(()=>{class D{sheetData=me(hp);sheetRef=me(ul);choose(y){this.sheetRef.dismiss(y)}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-menu-sheet"]],decls:3,vars:0,consts:[[1,"items-list"],["mat-flat-button","",1,"item",3,"error-theme"],["mat-stroked-button","",1,"item"],["mat-flat-button","",1,"item",3,"click"],["mat-stroked-button","",1,"item",3,"click"]],template:function(C,v){C&1&&(Ne(0,"div",0),nl(1,M1,2,1,null,null,rl),$e()),C&2&&(Ye(),al(v.sheetData.menuItems))},dependencies:[hg,Rn,Ln,zn,no],styles:[`.title[_ngcontent-%COMP%]{padding:20px}.items-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.items-list[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}
/*# sourceMappingURL=menu-sheet.component-FZYNZGGY.css.map */`],changeDetection:0})}return D})();function I1(D,he){if(D&1){let y=Ii();Ne(0,"button",2),qt("click",function(){Nt(y);let v=rt(2);return jt(v.startAddingPoi())}),Ne(1,"mat-icon"),nt(2,"local_parking"),$e(),nt(3," Dodaj bezp\u0142atny parking "),$e()}D&2&&Dt("@enterFadeAnimation",void 0)}function T1(D,he){if(D&1){let y=Ii();Ne(0,"button",3),qt("click",function(){Nt(y);let v=rt(2);return jt(v.stopAddingPoi())}),nt(1," Anuluj "),$e(),Ne(2,"button",2),qt("click",function(){Nt(y);let v=rt(2);return jt(v.confirmAddedPoi())}),Ne(3,"mat-icon"),nt(4,"check"),$e(),nt(5," Zatwierd\u017A "),$e()}D&2&&(Dt("@enterFadeAnimation",void 0),Ye(2),Dt("@enterFadeAnimation",void 0))}function E1(D,he){if(D&1){let y=Ii();Ne(0,"button",3),qt("click",function(){Nt(y);let v=rt(2);return jt(v.stopUpdatingPoiPosition())}),nt(1," Anuluj "),$e(),Ne(2,"button",2),qt("click",function(){Nt(y);let v=rt(2);return jt(v.confirmUpdatedPoiPosition())}),Ne(3,"mat-icon"),nt(4,"check"),$e(),nt(5," Zatwierd\u017A "),$e()}D&2&&(Dt("@enterFadeAnimation",void 0),Ye(2),Dt("@enterFadeAnimation",void 0))}function A1(D,he){if(D&1&&(Ne(0,"div",0),Mt(1,I1,4,1,"button",1)(2,T1,6,2)(3,E1,6,2),$e()),D&2){let y,C=rt();Ye(),Yt((y=C.activeMode())===C.ACTIVE_MODE_ENUM.DEFAULT?1:y===C.ACTIVE_MODE_ENUM.ADDING_POI?2:y===C.ACTIVE_MODE_ENUM.UPDATING_POI_POSITION?3:-1)}}var un=function(D){return D.DEFAULT="DEFAULT",D.ADDING_POI="ADDING_POI",D.EDITING_POI="EDITING_POI",D.UPDATING_POI_POSITION="UPDATE_POI_POSITION",D}(un||{}),ug=(()=>{class D{_mapService=me(ud);_matDialog=me(es);_snackBar=me(Af);_sheet=me(dp);_parkingsService=me(fd);ACTIVE_MODE_ENUM=un;activeMode=na(un.DEFAULT);isMapLoaded=this._mapService.isMapLoaded;constructor(){Uh(()=>this._listenForSelectedPoiToStartEdit()),Uh(()=>this._listenForActiveModeToSetMapState())}_listenForSelectedPoiToStartEdit(){this._mapService.selectedParking(),io(()=>this.startEditingPoi())}_listenForActiveModeToSetMapState(){this.activeMode(),io(()=>{this.activeMode()===un.DEFAULT?(this._mapService.selectedParking.set(null),this._mapService.setSelectingMode("enabled")):this._mapService.setSelectingMode("disabled")})}startAddingPoi(){this.activeMode.set(un.ADDING_POI),this._mapService.renderMoveableMarker()}stopAddingPoi(){this._mapService.removeMoveableMarker(),this.activeMode.set(un.DEFAULT)}confirmAddedPoi(){let y=this._mapService.getMarkerLatLng();this._parkingsService.postParking({location:y}).subscribe({next:()=>{this._snackBar.open(`Gotowe!
Oznaczenie bezp\u0142atnego parkingu zosta\u0142o dodane`,void 0,{verticalPosition:"top"})},complete:()=>{this.stopAddingPoi()}})}startEditingPoi(){this._mapService.selectedParking()&&(this.activeMode.set(un.EDITING_POI),this._sheet.open(dg,{data:{menuItems:[{label:"Popraw pozycj\u0119 na mapie",icon:"edit_location_alt",result:"UPDATE"},{label:"Usu\u0144 znacznik",icon:"wrong_location",result:"REMOVE"},{label:"Anuluj",icon:"close",result:"CANCEL"}]}}).afterDismissed().subscribe(y=>{(y==="CANCEL"||!y)&&this.activeMode.set(un.DEFAULT),y==="UPDATE"&&this.startUpdatingPoiPosition(),y==="REMOVE"&&this.removePoi()}))}startUpdatingPoiPosition(){let y=this._mapService.selectedParking();y&&(this.activeMode.set(un.UPDATING_POI_POSITION),this._mapService.renderMoveableMarker(),this._mapService.jumpToPoi(y?.location))}stopUpdatingPoiPosition(){this._mapService.removeMoveableMarker(),this.startEditingPoi()}confirmUpdatedPoiPosition(){let y=this._mapService.selectedParking();if(!y)return;let C=this._mapService.getMarkerLatLng();this._parkingsService.patchParking(y.id,{location:C}).subscribe({next:()=>{this._snackBar.open(`Gotowe!
Pozycja bezp\u0142atnego parkingu zosta\u0142a poprawiona`,void 0,{verticalPosition:"top"})},complete:()=>{this._mapService.removeMoveableMarker(),this.activeMode.set(un.DEFAULT)}})}removePoi(){let y=this._mapService.selectedParking();y&&(this._mapService.jumpToPoi(y.location),this._mapService.getMap().panBy([0,200]),this._mapService.renderMarkerForFocusPoi(y.location),this._matDialog.open(lg,{data:{title:"Usuwanie punktu",content:"Czy na pewno chcesz usun\u0105\u0107 obszar p\u0142atnego parkingu?"}}).afterClosed().pipe(jo(C=>C?this._parkingsService.deleteParking(y.id).pipe(An(()=>{this._snackBar.open(`Gotowe!
Usuni\u0119to znacznik bezp\u0142atnego parkingu`,void 0,{verticalPosition:"top"})})):Er(null))).subscribe({next:()=>{this._mapService.removeMarkerForFocusPoi(),this.activeMode.set(un.DEFAULT)}}))}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-poi-controller"]],decls:1,vars:1,consts:[[1,"menu-buttons-wrapper"],["mat-flat-button","",1,"menu-button"],["mat-flat-button","",1,"menu-button",3,"click"],["mat-raised-button","",1,"menu-button",3,"click"]],template:function(C,v){C&1&&Mt(0,A1,4,1,"div",0),C&2&&Yt(v.isMapLoaded()?0:-1)},dependencies:[cd,Rn,Ln,zn,no,Pf,og],styles:[`.menu-buttons-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;gap:10px;position:fixed;z-index:100;left:0;right:0;bottom:0;white-space:nowrap;padding:10px}.menu-buttons-wrapper[_ngcontent-%COMP%]   .menu-button[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #fff,0 0 2px 2px #00000080}
/*# sourceMappingURL=poi-controller.component-XALMS3VG.css.map */`],data:{animation:[sg]},changeDetection:0})}return D})();var P1=()=>[],h2=(()=>{class D{_matDialog=me(es);_parkingsService=me(fd);parkingsList=this._parkingsService.parkingsList;openHelpDialog(){this._matDialog.open(tg)}static \u0275fac=function(C){return new(C||D)};static \u0275cmp=kt({type:D,selectors:[["app-main-page"]],decls:12,vars:3,consts:[["menu","matMenu"],["mat-mini-fab","",1,"menu-button",3,"matMenuTriggerFor"],[3,"parkingsList"],["mat-menu-item","",3,"click"]],template:function(C,v){if(C&1){let c=Ii();Ne(0,"button",1)(1,"mat-icon"),nt(2,"menu"),$e()(),cn(3,"app-poi-controller")(4,"app-map",2),Ne(5,"mat-menu",null,0)(7,"button",3),qt("click",function(){return Nt(c),jt(v.openHelpDialog())}),Ne(8,"mat-icon"),nt(9,"not_listed_location"),$e(),Ne(10,"span"),nt(11,"Poradnik"),$e()()()}if(C&2){let c=oa(6);Dt("matMenuTriggerFor",c),Ye(4),Dt("parkingsList",v.parkingsList.value()||hf(2,P1))}},dependencies:[ag,ug,zn,If,Yf,Rn,Ln,cd,hl,zc,Xf],styles:[`.menu-button[_ngcontent-%COMP%]{position:fixed;z-index:100;left:10px;top:10px;box-shadow:0 0 2px #00000080}.menu-button[_ngcontent-%COMP%]:hover, .menu-button[_ngcontent-%COMP%]:focus:active, .menu-button[_ngcontent-%COMP%]:active, .menu-button[_ngcontent-%COMP%]:focus{box-shadow:0 0 2px #00000080}
/*# sourceMappingURL=main-page.component-ULZROXK3.css.map */`],changeDetection:0})}return D})();export{h2 as MainPageComponent};
//# sourceMappingURL=chunk-IKTYNFQP.js.map
