import{$ as zm,A as dh,B as ph,C as mh,D as fh,E as gh,F as ym,G as Ss,H as _h,I as vm,J as xm,K as Hl,L as bm,M as yh,N as wm,P as Sm,Q as Sa,R as Cm,S as Mm,T as Tm,U as km,V as Im,W as Em,X as Pm,Y as Am,Z as Ca,_ as Ma,b as am,i as om,j as sm,k as $l,l as lm,m as cm,n as hm,o as um,p as dm,q as Zl,r as pm,s as mm,t as fm,u as gm,w as Wu,x as Xu,y as _m,z as Pn}from"./chunk-6YJSQ5NP.js";import{$ as Jp,A as Wp,Ab as co,Ba as nh,Bb as va,Cb as sn,Db as xs,Eb as fr,Fb as gr,Gb as xa,Hb as ft,Ib as ba,J as oo,Jb as ch,K as so,Kb as bs,L as ds,Lb as Gu,M as ps,Mb as im,Na as ht,O as ya,P as ms,Qa as Nl,Qb as ws,R as ql,Sa as em,Sb as Ul,Ta as ah,U as je,Ub as wa,V as Xp,Vb as hh,W as Kp,Wb as uh,Xa as Ii,Xb as rm,Ya as _s,Za as ys,_a as vs,a as cs,ab as $u,ac as nm,ba as Wt,bb as li,ca as Xt,da as Yp,dc as Hu,ea as eh,f as hs,fa as Uu,gb as Ar,hb as Bt,ib as Zu,j as Vl,jb as an,ka as fs,kb as jl,kc as Gl,la as th,lb as tm,lc as Cs,mb as Ei,n as us,na as Qp,nb as oh,oa as gs,ob as sh,oc as An,pb as lh,pc as Ku,qb as Xe,qc as Ms,ra as En,rb as Ye,sa as ih,sb as on,t as Qc,tb as lo,u as Hp,ub as mr,xa as rh,xb as ci,zb as mt}from"./chunk-652YPCJC.js";import{a as ao,b as ls,d as Ug,e as Gp}from"./chunk-C6Q5SG76.js";var sd=Ug((ad,od)=>{"use strict";(function(J,ce){typeof ad=="object"&&typeof od<"u"?od.exports=ce():typeof define=="function"&&define.amd?define(ce):(J=typeof globalThis<"u"?globalThis:J||self,J.maplibregl=ce())})(ad,function(){"use strict";var J={},ce={};function z(w,p,Fe){if(ce[w]=Fe,w==="index"){var Pt="var sharedModule = {}; ("+ce.shared+")(sharedModule); ("+ce.worker+")(sharedModule);",bt={};return ce.shared(bt),ce.index(J,bt),typeof window<"u"&&J.setWorkerUrl(window.URL.createObjectURL(new Blob([Pt],{type:"text/javascript"}))),J}}z("shared",["exports"],function(w){"use strict";function p(i,t,r,a){return new(r||(r=Promise))(function(l,u){function d(v){try{g(a.next(v))}catch(x){u(x)}}function m(v){try{g(a.throw(v))}catch(x){u(x)}}function g(v){var x;v.done?l(v.value):(x=v.value,x instanceof r?x:new r(function(S){S(x)})).then(d,m)}g((a=a.apply(i,t||[])).next())})}function Fe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Pt=bt;function bt(i,t){this.x=i,this.y=t}bt.prototype={clone:function(){return new bt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,t){var r=Math.cos(i),a=Math.sin(i),l=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},bt.convert=function(i){return i instanceof bt?i:Array.isArray(i)?new bt(i[0],i[1]):i};var ge=Fe(Pt),le=Ji;function Ji(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}Ji.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var d=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var _i=Fe(le);let Pi,Ur;function zr(){return Pi==null&&(Pi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pi}function Ta(){if(Ur==null&&(Ur=!1,zr())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){let l=4*a;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}let r=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){Ur=!0;break}}}return Ur||!1}function Ai(i,t,r,a){let l=new _i(i,t,r,a);return u=>l.solve(u)}let Ps=Ai(.25,.1,.25,1);function Yi(i,t,r){return Math.min(r,Math.max(t,i))}function _r(i,t,r){let a=r-t,l=((i-t)%a+a)%a+t;return l===t?r:l}function Ni(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}let ho=1;function yr(i,t,r){let a={};for(let l in i)a[l]=t.call(this,i[l],l,i);return a}function ka(i,t,r){let a={};for(let l in i)t.call(this,i[l],l,i)&&(a[l]=i[l]);return a}function gt(i){return Array.isArray(i)?i.map(gt):typeof i=="object"&&i?yr(i,gt):i}let uo={};function Qt(i){uo[i]||(typeof console<"u"&&console.warn(i),uo[i]=!0)}function hi(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Dr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Dn=null;function vr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}let po="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ln(i,t,r,a,l){return p(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let u=new VideoFrame(i,{timestamp:0});try{let d=u?.format;if(!d||!d.startsWith("BGR")&&!d.startsWith("RGB"))throw new Error(`Unrecognized format ${d}`);let m=d.startsWith("BGR"),g=new Uint8ClampedArray(a*l*4);if(yield u.copyTo(g,function(v,x,S,T,E){let A=4*Math.max(-x,0),D=(Math.max(0,S)-S)*T*4+A,O=4*T,j=Math.max(0,x),ie=Math.max(0,S);return{rect:{x:j,y:ie,width:Math.min(v.width,x+T)-j,height:Math.min(v.height,S+E)-ie},layout:[{offset:D,stride:O}]}}(i,t,r,a,l)),m)for(let v=0;v<g.length;v+=4){let x=g[v];g[v]=g[v+2],g[v+2]=x}return g}finally{u.close()}})}let Lr,yi,Qi="AbortError";function Ln(){return new Error(Qi)}let $r={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function xr(i){return $r.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}let Rn="global-dispatcher";class zi extends Error{constructor(t,r,a,l){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=l}}let er=()=>Dr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,cn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){let a=xr(i.url);if(a)return a(i,t);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Rn},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(er())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,l){return p(this,void 0,void 0,function*(){let u=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:er(),signal:l.signal});a.type!=="json"||u.headers.has("Accept")||u.headers.set("Accept","application/json");let d=yield fetch(u);if(!d.ok){let v=yield d.blob();throw new zi(d.status,d.statusText,a.url,v)}let m;m=a.type==="arrayBuffer"||a.type==="image"?d.arrayBuffer():a.type==="json"?d.json():d.text();let g=yield m;if(l.signal.aborted)throw Ln();return{data:g,cacheControl:d.headers.get("Cache-Control"),expires:d.headers.get("Expires")}})}(i,t);if(Dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Rn},t)}var r;return function(a,l){return new Promise((u,d)=>{var m;let g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(g.responseType="arraybuffer");for(let v in a.headers)g.setRequestHeader(v,a.headers[v]);a.type==="json"&&(g.responseType="text",!((m=a.headers)===null||m===void 0)&&m.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(a.type==="json")try{v=JSON.parse(g.response)}catch(x){return void d(x)}u({data:v,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{let v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});d(new zi(g.status,g.statusText,a.url,v))}},l.signal.addEventListener("abort",()=>{g.abort(),d(Ln())}),g.send(a.body)})}(i,t)};function hn(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;let t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Ia(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Rr(i,t,r){if(r&&r[i]){let a=r[i].indexOf(t);a!==-1&&r[i].splice(a,1)}}class Zr{constructor(t,r={}){Ni(this,r),this.type=t}}class Gr extends Zr{constructor(t,r={}){super("error",Ni({error:t},r))}}class Fn{on(t,r){return this._listeners=this._listeners||{},Ia(t,r,this._listeners),this}off(t,r){return Rr(t,r,this._listeners),Rr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ia(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new Zr(t,r||{}));let a=t.type;if(this.listens(a)){t.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let m of l)m.call(this,t);let u=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let m of u)Rr(a,m,this._oneTimeListeners),m.call(this,t);let d=this._eventedParent;d&&(Ni(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof Gr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let un=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ea(i,t){let r={};for(let a in i)a!=="ref"&&(r[a]=i[a]);return un.forEach(a=>{a in t&&(r[a]=t[a])}),r}function lt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!lt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(let r in i)if(!lt(i[r],t[r]))return!1;return!0}return i===t}function At(i,t){i.push(t)}function Pa(i,t,r){At(r,{command:"addSource",args:[i,t[i]]})}function Hr(i,t,r){At(t,{command:"removeSource",args:[i]}),r[i]=!0}function Fr(i,t,r,a){Hr(i,r,a),Pa(i,t,r)}function Bn(i,t,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!lt(i[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!lt(i[r][a],t[r][a]))return!1;return!0}function ji(i,t,r,a,l,u){i=i||{},t=t||{};for(let d in i)Object.prototype.hasOwnProperty.call(i,d)&&(lt(i[d],t[d])||r.push({command:u,args:[a,d,t[d],l]}));for(let d in t)Object.prototype.hasOwnProperty.call(t,d)&&!Object.prototype.hasOwnProperty.call(i,d)&&(lt(i[d],t[d])||r.push({command:u,args:[a,d,t[d],l]}))}function Aa(i){return i.id}function za(i,t){return i[t.id]=t,i}class fe{constructor(t,r,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function br(i,...t){for(let r of t)for(let a in r)i[a]=r[a];return i}class ui extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class wr{constructor(t,r=[]){this.parent=t,this.bindings={};for(let[a,l]of r)this.bindings[a]=l}concat(t){return new wr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Wr={kind:"null"},xe={kind:"number"},Ke={kind:"string"},Ne={kind:"boolean"},vi={kind:"color"},tr={kind:"object"},Ge={kind:"value"},Sr={kind:"collator"},Br={kind:"formatted"},Xr={kind:"padding"},Cr={kind:"resolvedImage"},N={kind:"variableAnchorOffsetCollection"};function I(i,t){return{kind:"array",itemType:i,N:t}}function k(i){if(i.kind==="array"){let t=k(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}let R=[Wr,xe,Ke,Ne,vi,Br,tr,I(Ge),Xr,Cr,N];function V(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!V(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(let r of R)if(!V(r,t))return null}}return`Expected ${k(i)} but found ${k(t)} instead.`}function X(i,t){return t.some(r=>r.kind===i.kind)}function Y(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function te(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}let Z=.96422,se=.82521,de=4/29,ne=6/29,_e=3*ne*ne,Be=ne*ne*ne,Oe=Math.PI/180,nt=180/Math.PI;function He(i){return(i%=360)<0&&(i+=360),i}function at([i,t,r,a]){let l,u,d=qt((.2225045*(i=et(i))+.7168786*(t=et(t))+.0606169*(r=et(r)))/1);i===t&&t===r?l=u=d:(l=qt((.4360747*i+.3850649*t+.1430804*r)/Z),u=qt((.0139322*i+.0971045*t+.7141733*r)/se));let m=116*d-16;return[m<0?0:m,500*(l-d),200*(d-u),a]}function et(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function qt(i){return i>Be?Math.pow(i,1/3):i/_e+de}function zt([i,t,r,a]){let l=(i+16)/116,u=isNaN(t)?l:l+t/500,d=isNaN(r)?l:l-r/200;return l=1*dt(l),u=Z*dt(u),d=se*dt(d),[Je(3.1338561*u-1.6168667*l-.4906146*d),Je(-.9787684*u+1.9161415*l+.033454*d),Je(.0719453*u-.2289914*l+1.4052427*d),a]}function Je(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function dt(i){return i>ne?i*i*i:_e*(i-de)}function Et(i){return parseInt(i.padEnd(2,i),16)/255}function $t(i,t){return Kt(t?i/100:i,0,1)}function Kt(i,t,r){return Math.min(Math.max(t,i),r)}function di(i){return!i.some(Number.isNaN)}let On={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class pt{constructor(t,r,a,l=1,u=!0){this.r=t,this.g=r,this.b=a,this.a=l,u||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,a,l]))}static parse(t){if(t instanceof pt)return t;if(typeof t!="string")return;let r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=On[a];if(l){let[d,m,g]=l;return[d/255,m/255,g/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let d=a.length<6?1:2,m=1;return[Et(a.slice(m,m+=d)),Et(a.slice(m,m+=d)),Et(a.slice(m,m+=d)),Et(a.slice(m,m+d)||"ff")]}if(a.startsWith("rgb")){let d=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){let[m,g,v,x,S,T,E,A,D,O,j,ie]=d,W=[x||" ",E||" ",O].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){let ee=[v,T,D].join(""),oe=ee==="%%%"?100:ee===""?255:0;if(oe){let pe=[Kt(+g/oe,0,1),Kt(+S/oe,0,1),Kt(+A/oe,0,1),j?$t(+j,ie):1];if(di(pe))return pe}}return}}let u=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(u){let[d,m,g,v,x,S,T,E,A]=u,D=[g||" ",x||" ",T].join("");if(D==="  "||D==="  /"||D===",,"||D===",,,"){let O=[+m,Kt(+v,0,100),Kt(+S,0,100),E?$t(+E,A):1];if(di(O))return function([j,ie,W,ee]){function oe(pe){let Te=(pe+j/30)%12,Ve=ie*Math.min(W,1-W);return W-Ve*Math.max(-1,Math.min(Te-3,9-Te,1))}return j=He(j),ie/=100,W/=100,[oe(0),oe(8),oe(4),ee]}(O)}}}(t);return r?new pt(...r,!1):void 0}get rgb(){let{r:t,g:r,b:a,a:l}=this,u=l||1/0;return this.overwriteGetter("rgb",[t/u,r/u,a/u,l])}get hcl(){return this.overwriteGetter("hcl",function(t){let[r,a,l,u]=at(t),d=Math.sqrt(a*a+l*l);return[Math.round(1e4*d)?He(Math.atan2(l,a)*nt):NaN,d,r,u]}(this.rgb))}get lab(){return this.overwriteGetter("lab",at(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){let[t,r,a,l]=this.rgb;return`rgba(${[t,r,a].map(u=>Math.round(255*u)).join(",")},${l})`}}pt.black=new pt(0,0,0,1),pt.white=new pt(1,1,1,1),pt.transparent=new pt(0,0,0,0),pt.red=new pt(1,0,0,1);class As{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zs{constructor(t,r,a,l,u){this.text=t,this.image=r,this.scale=a,this.fontStack=l,this.textColor=u}}class Di{constructor(t){this.sections=t}static fromString(t){return new Di([new zs(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Di?t:Di.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Li{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Li)return t;if(typeof t=="number")return new Li([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Li(t)}}toString(){return JSON.stringify(this.values)}}let Ih=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ui)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){let a=t[r],l=t[r+1];if(typeof a!="string"||!Ih.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Ui(t)}}toString(){return JSON.stringify(this.values)}}class Ri{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ri({name:t,available:!1}):null}}function Vn(i,t,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,r,a]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function dn(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof pt||i instanceof As||i instanceof Di||i instanceof Li||i instanceof Ui||i instanceof Ri)return!0;if(Array.isArray(i)){for(let t of i)if(!dn(t))return!1;return!0}if(typeof i=="object"){for(let t in i)if(!dn(i[t]))return!1;return!0}return!1}function Nt(i){if(i===null)return Wr;if(typeof i=="string")return Ke;if(typeof i=="boolean")return Ne;if(typeof i=="number")return xe;if(i instanceof pt)return vi;if(i instanceof As)return Sr;if(i instanceof Di)return Br;if(i instanceof Li)return Xr;if(i instanceof Ui)return N;if(i instanceof Ri)return Cr;if(Array.isArray(i)){let t=i.length,r;for(let a of i){let l=Nt(a);if(r){if(r===l)continue;r=Ge;break}r=l}return I(r||Ge,t)}return tr}function Da(i){let t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof pt||i instanceof Di||i instanceof Li||i instanceof Ui||i instanceof Ri?i.toString():JSON.stringify(i)}class ir{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!dn(t[1]))return r.error("invalid value");let a=t[1],l=Nt(a),u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new ir(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ot{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let mo={string:Ke,number:xe,boolean:Ne,object:tr};class rr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,l=1,u=t[0];if(u==="array"){let m,g;if(t.length>2){let v=t[1];if(typeof v!="string"||!(v in mo)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=mo[v],l++}else m=Ge;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],l++}a=I(m,g)}else{if(!mo[u])throw new Error(`Types doesn't contain name = ${u}`);a=mo[u]}let d=[];for(;l<t.length;l++){let m=r.parse(t[l],l,Ge);if(!m)return null;d.push(m)}return new rr(a,d)}evaluate(t){for(let r=0;r<this.args.length;r++){let a=this.args[r].evaluate(t);if(!V(this.type,Nt(a)))return a;if(r===this.args.length-1)throw new Ot(`Expected value to be of type ${k(this.type)}, but found ${k(Nt(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let Ds={"to-boolean":Ne,"to-color":vi,"to-number":xe,"to-string":Ke};class nr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[0];if(!Ds[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");let l=Ds[a],u=[];for(let d=1;d<t.length;d++){let m=r.parse(t[d],d,Ge);if(!m)return null;u.push(m)}return new nr(l,u)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(let l of this.args){if(r=l.evaluate(t),a=null,r instanceof pt)return r;if(typeof r=="string"){let u=t.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Vn(r[0],r[1],r[2],r[3]),!a))return new pt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ot(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(let a of this.args){r=a.evaluate(t);let l=Li.parse(r);if(l)return l}throw new Ot(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(let a of this.args){r=a.evaluate(t);let l=Ui.parse(r);if(l)return l}throw new Ot(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(let a of this.args){if(r=a.evaluate(t),r===null)return 0;let l=Number(r);if(!isNaN(l))return l}throw new Ot(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Di.fromString(Da(this.args[0].evaluate(t)));case"resolvedImage":return Ri.fromString(Da(this.args[0].evaluate(t)));default:return Da(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let Eh=["Unknown","Point","LineString","Polygon"];class fo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Eh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=pt.parse(t)),r}}class pn{constructor(t,r,a=[],l,u=new wr,d=[]){this.registry=t,this.path=a,this.key=a.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=d,this.expectedType=l,this._isConstant=r}parse(t,r,a,l,u={}){return r?this.concat(r,a,l)._parse(t,u):this._parse(t,u)}_parse(t,r){function a(l,u,d){return d==="assert"?new rr(u,[l]):d==="coerce"?new nr(u,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let u=this.registry[l];if(u){let d=u.parse(t,this);if(!d)return null;if(this.expectedType){let m=this.expectedType,g=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||g.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(m.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(m.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(m,g))return null}else d=a(d,m,r.typeAnnotation||"coerce");else d=a(d,m,r.typeAnnotation||"coerce");else d=a(d,m,r.typeAnnotation||"coerce");else d=a(d,m,r.typeAnnotation||"assert")}if(!(d instanceof ir)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){let m=new fo;try{d=new ir(d.type,d.evaluate(m))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){let l=typeof t=="number"?this.path.concat(t):this.path,u=a?this.scope.concat(a):this.scope;return new pn(this.registry,this._isConstant,l,r||null,u,this.errors)}error(t,...r){let a=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new ui(a,t))}checkSubtype(t,r){let a=V(t,r);return a&&this.error(a),a}}class Kr{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let u=1;u<t.length-1;u+=2){let d=t[u];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,u);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);let m=r.parse(t[u+1],u+1);if(!m)return null;a.push([d,m])}let l=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return l?new Kr(a,l):null}outputDefined(){return this.result.outputDefined()}}class ct{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let a=t[1];return r.scope.has(a)?new ct(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ls{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,xe),l=r.parse(t[2],2,I(r.expectedType||Ge));return a&&l?new Ls(l.type.itemType,a,l):null}evaluate(t){let r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Ot(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ot(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ot(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Rs{constructor(t,r){this.type=Ne,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ge),l=r.parse(t[2],2,Ge);return a&&l?X(a.type,[Ne,Ke,xe,Wr,Ge])?new Rs(a,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(a.type)} instead`):null}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Y(r,["boolean","string","number","null"]))throw new Ot(`Expected first argument to be of type boolean, string, number or null, but found ${k(Nt(r))} instead.`);if(!Y(a,["string","array"]))throw new Ot(`Expected second argument to be of type array or string, but found ${k(Nt(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class qn{constructor(t,r,a){this.type=xe,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ge),l=r.parse(t[2],2,Ge);if(!a||!l)return null;if(!X(a.type,[Ne,Ke,xe,Wr,Ge]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,xe);return u?new qn(a,l,u):null}return new qn(a,l)}evaluate(t){let r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Y(r,["boolean","string","number","null"]))throw new Ot(`Expected first argument to be of type boolean, string, number or null, but found ${k(Nt(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Y(a,["string"])){let u=a.indexOf(r,l);return u===-1?-1:[...a.slice(0,u)].length}if(Y(a,["array"]))return a.indexOf(r,l);throw new Ot(`Expected second argument to be of type array or string, but found ${k(Nt(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Fs{constructor(t,r,a,l,u,d){this.inputType=t,this.type=r,this.input=a,this.cases=l,this.outputs=u,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);let u={},d=[];for(let v=2;v<t.length-1;v+=2){let x=t[v],S=t[v+1];Array.isArray(x)||(x=[x]);let T=r.concat(v);if(x.length===0)return T.error("Expected at least one branch label.");for(let A of x){if(typeof A!="number"&&typeof A!="string")return T.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return T.error("Numeric branch labels must be integer values.");if(a){if(T.checkSubtype(a,Nt(A)))return null}else a=Nt(A);if(u[String(A)]!==void 0)return T.error("Branch labels must be unique.");u[String(A)]=d.length}let E=r.parse(S,v,l);if(!E)return null;l=l||E.type,d.push(E)}let m=r.parse(t[1],1,Ge);if(!m)return null;let g=r.parse(t[t.length-1],t.length-1,l);return g?m.type.kind!=="value"&&r.concat(1).checkSubtype(a,m.type)?null:new Fs(a,l,m,u,d,g):null}evaluate(t){let r=this.input.evaluate(t);return(Nt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class go{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let l=[];for(let d=1;d<t.length-1;d+=2){let m=r.parse(t[d],d,Ne);if(!m)return null;let g=r.parse(t[d+1],d+1,a);if(!g)return null;l.push([m,g]),a=a||g.type}let u=r.parse(t[t.length-1],t.length-1,a);if(!u)return null;if(!a)throw new Error("Can't infer output type");return new go(a,l,u)}evaluate(t){for(let[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class La{constructor(t,r,a,l){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=r.parse(t[1],1,Ge),l=r.parse(t[2],2,xe);if(!a||!l)return null;if(!X(a.type,[I(Ge),Ke,Ge]))return r.error(`Expected first argument to be of type array or string, but found ${k(a.type)} instead`);if(t.length===4){let u=r.parse(t[3],3,xe);return u?new La(a.type,a,l,u):null}return new La(a.type,a,l)}evaluate(t){let r=this.input.evaluate(t),a=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Y(r,["string"]))return[...r].slice(a,l).join("");if(Y(r,["array"]))return r.slice(a,l);throw new Ot(`Expected first argument to be of type array or string, but found ${k(Nt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function _o(i,t){let r=i.length-1,a,l,u=0,d=r,m=0;for(;u<=d;)if(m=Math.floor((u+d)/2),a=i[m],l=i[m+1],a<=t){if(m===r||t<l)return m;u=m+1}else{if(!(a>t))throw new Ot("Input is not a number.");d=m-1}return 0}class Nn{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(let[l,u]of a)this.labels.push(l),this.outputs.push(u)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");let a=r.parse(t[1],1,xe);if(!a)return null;let l=[],u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let d=1;d<t.length;d+=2){let m=d===1?-1/0:t[d],g=t[d+1],v=d,x=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);let S=r.parse(g,x,u);if(!S)return null;u=u||S.type,l.push([m,S])}return new Nn(u,a,l)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;return l>=r[u-1]?a[u-1].evaluate(t):a[_o(r,l)].evaluate(t)}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ph=Yl;function Yl(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}Yl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var u=this.sampleCurveDerivativeX(r);if(Math.abs(u)<1e-6)break;r-=l/u}var d=0,m=1;for(r=i,a=0;a<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));a++)i>l?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ah=Jl(Ph);function mn(i,t,r){return i+r*(t-i)}function Ra(i,t,r){return i.map((a,l)=>mn(a,t[l],r))}let xi={number:mn,color:function(i,t,r,a="rgb"){switch(a){case"rgb":{let[l,u,d,m]=Ra(i.rgb,t.rgb,r);return new pt(l,u,d,m,!1)}case"hcl":{let[l,u,d,m]=i.hcl,[g,v,x,S]=t.hcl,T,E;if(isNaN(l)||isNaN(g))isNaN(l)?isNaN(g)?T=NaN:(T=g,d!==1&&d!==0||(E=v)):(T=l,x!==1&&x!==0||(E=u));else{let ie=g-l;g>l&&ie>180?ie-=360:g<l&&l-g>180&&(ie+=360),T=l+r*ie}let[A,D,O,j]=function([ie,W,ee,oe]){return ie=isNaN(ie)?0:ie*Oe,zt([ee,Math.cos(ie)*W,Math.sin(ie)*W,oe])}([T,E??mn(u,v,r),mn(d,x,r),mn(m,S,r)]);return new pt(A,D,O,j,!1)}case"lab":{let[l,u,d,m]=zt(Ra(i.lab,t.lab,r));return new pt(l,u,d,m,!1)}}},array:Ra,padding:function(i,t,r){return new Li(Ra(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){let a=i.values,l=t.values;if(a.length!==l.length)throw new Ot(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);let u=[];for(let d=0;d<a.length;d+=2){if(a[d]!==l[d])throw new Ot(`Cannot interpolate values containing mismatched anchors. from[${d}]: ${a[d]}, to[${d}]: ${l[d]}`);u.push(a[d]);let[m,g]=a[d+1],[v,x]=l[d+1];u.push([mn(m,v,r),mn(g,x,r)])}return new Ui(u)}};class bi{constructor(t,r,a,l,u){this.type=t,this.operator=r,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[d,m]of u)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(t,r,a,l){let u=0;if(t.name==="exponential")u=yo(r,t.base,a,l);else if(t.name==="linear")u=yo(r,1,a,l);else if(t.name==="cubic-bezier"){let d=t.controlPoints;u=new Ah(d[0],d[1],d[2],d[3]).solve(yo(r,1,a,l))}return u}static parse(t,r){let[a,l,u,...d]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let v=l.slice(1);if(v.length!==4||v.some(x=>typeof x!="number"||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,xe),!u)return null;let m=[],g=null;a==="interpolate-hcl"||a==="interpolate-lab"?g=vi:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let v=0;v<d.length;v+=2){let x=d[v],S=d[v+1],T=v+3,E=v+4;if(typeof x!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(m.length&&m[m.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);let A=r.parse(S,E,g);if(!A)return null;g=g||A.type,m.push([x,A])}return te(g,xe)||te(g,vi)||te(g,Xr)||te(g,N)||te(g,I(xe))?new bi(g,a,l,u,m):r.error(`Type ${k(g)} is not interpolatable.`)}evaluate(t){let r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=r[0])return a[0].evaluate(t);let u=r.length;if(l>=r[u-1])return a[u-1].evaluate(t);let d=_o(r,l),m=bi.interpolationFactor(this.interpolation,l,r[d],r[d+1]),g=a[d].evaluate(t),v=a[d+1].evaluate(t);switch(this.operator){case"interpolate":return xi[this.type.kind](g,v,m);case"interpolate-hcl":return xi.color(g,v,m,"hcl");case"interpolate-lab":return xi.color(g,v,m,"lab")}}eachChild(t){t(this.input);for(let r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function yo(i,t,r,a){let l=a-r,u=i-r;return l===0?0:t===1?u/l:(Math.pow(t,u)-1)/(Math.pow(t,l)-1)}class vo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null,l=r.expectedType;l&&l.kind!=="value"&&(a=l);let u=[];for(let m of t.slice(1)){let g=r.parse(m,1+u.length,a,void 0,{typeAnnotation:"omit"});if(!g)return null;a=a||g.type,u.push(g)}if(!a)throw new Error("No output type");let d=l&&u.some(m=>V(l,m.type));return new vo(d?Ge:a,u)}evaluate(t){let r,a=null,l=0;for(let u of this.args)if(l++,a=u.evaluate(t),a&&a instanceof Ri&&!a.available&&(r||(r=a.name),a=null,l===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function xo(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ql(i,t,r,a){return a.compare(t,r)===0}function jn(i,t,r){let a=i!=="=="&&i!=="!=";return class Zm{constructor(u,d,m){this.type=Ne,this.lhs=u,this.rhs=d,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||d.type.kind==="value"}static parse(u,d){if(u.length!==3&&u.length!==4)return d.error("Expected two or three arguments.");let m=u[0],g=d.parse(u[1],1,Ge);if(!g)return null;if(!xo(m,g.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${k(g.type)}'.`);let v=d.parse(u[2],2,Ge);if(!v)return null;if(!xo(m,v.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${k(v.type)}'.`);if(g.type.kind!==v.type.kind&&g.type.kind!=="value"&&v.type.kind!=="value")return d.error(`Cannot compare types '${k(g.type)}' and '${k(v.type)}'.`);a&&(g.type.kind==="value"&&v.type.kind!=="value"?g=new rr(v.type,[g]):g.type.kind!=="value"&&v.type.kind==="value"&&(v=new rr(g.type,[v])));let x=null;if(u.length===4){if(g.type.kind!=="string"&&v.type.kind!=="string"&&g.type.kind!=="value"&&v.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(x=d.parse(u[3],3,Sr),!x)return null}return new Zm(g,v,x)}evaluate(u){let d=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(a&&this.hasUntypedArgument){let g=Nt(d),v=Nt(m);if(g.kind!==v.kind||g.kind!=="string"&&g.kind!=="number")throw new Ot(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${v.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let g=Nt(d),v=Nt(m);if(g.kind!=="string"||v.kind!=="string")return t(u,d,m)}return this.collator?r(u,d,m,this.collator.evaluate(u)):t(u,d,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}}}let zh=jn("==",function(i,t,r){return t===r},Ql),ec=jn("!=",function(i,t,r){return t!==r},function(i,t,r,a){return!Ql(0,t,r,a)}),tc=jn("<",function(i,t,r){return t<r},function(i,t,r,a){return a.compare(t,r)<0}),Dh=jn(">",function(i,t,r){return t>r},function(i,t,r,a){return a.compare(t,r)>0}),Lh=jn("<=",function(i,t,r){return t<=r},function(i,t,r,a){return a.compare(t,r)<=0}),ic=jn(">=",function(i,t,r){return t>=r},function(i,t,r,a){return a.compare(t,r)>=0});class Fa{constructor(t,r,a){this.type=Sr,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");let l=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Ne);if(!l)return null;let u=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Ne);if(!u)return null;let d=null;return a.locale&&(d=r.parse(a.locale,1,Ke),!d)?null:new Fa(l,u,d)}evaluate(t){return new As(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Bs{constructor(t,r,a,l,u){this.type=Ke,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");let a=r.parse(t[1],1,xe);if(!a)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,Ke),!u))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,Ke),!d))return null;let m=null;if(l["min-fraction-digits"]&&(m=r.parse(l["min-fraction-digits"],1,xe),!m))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,xe),!g)?null:new Bs(a,u,d,m,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class bo{constructor(t){this.type=Br,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");let l=[],u=!1;for(let d=1;d<=t.length-1;++d){let m=t[d];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let g=null;if(m["font-scale"]&&(g=r.parse(m["font-scale"],1,xe),!g))return null;let v=null;if(m["text-font"]&&(v=r.parse(m["text-font"],1,I(Ke)),!v))return null;let x=null;if(m["text-color"]&&(x=r.parse(m["text-color"],1,vi),!x))return null;let S=l[l.length-1];S.scale=g,S.font=v,S.textColor=x}else{let g=r.parse(t[d],1,Ge);if(!g)return null;let v=g.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new bo(l)}evaluate(t){return new Di(this.sections.map(r=>{let a=r.content.evaluate(t);return Nt(a)===Cr?new zs("",a,null,null,null):new zs(Da(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(let r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Os{constructor(t){this.type=Cr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");let a=r.parse(t[1],1,Ke);return a?new Os(a):r.error("No image name provided.")}evaluate(t){let r=this.input.evaluate(t),a=Ri.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Vs{constructor(t){this.type=xe,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${k(a.type)} instead.`):new Vs(a):null}evaluate(t){let r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Ot(`Expected value to be of type string or array, but found ${k(Nt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Mr=8192;function Rh(i,t){let r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*Mr),Math.round(a*l*Mr)]}function qs(i,t){let r=Math.pow(2,t.z);return[(l=(i[0]/Mr+t.x)/r,360*l-180),(a=(i[1]/Mr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function fn(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Jr(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function ut(i,t,r){let a=i[0]-t[0],l=i[1]-t[1],u=i[0]-r[0],d=i[1]-r[1];return a*d-u*l==0&&a*u<=0&&l*d<=0}function wo(i,t,r,a){return(l=[a[0]-r[0],a[1]-r[1]])[0]*(u=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*u[0]!=0&&!(!nc(i,t,r,a)||!nc(r,a,i,t));var l,u}function Fh(i,t,r){for(let a of r)for(let l=0;l<a.length-1;++l)if(wo(i,t,a[l],a[l+1]))return!0;return!1}function Un(i,t,r=!1){let a=!1;for(let m of t)for(let g=0;g<m.length-1;g++){if(ut(i,m[g],m[g+1]))return r;(u=m[g])[1]>(l=i)[1]!=(d=m[g+1])[1]>l[1]&&l[0]<(d[0]-u[0])*(l[1]-u[1])/(d[1]-u[1])+u[0]&&(a=!a)}var l,u,d;return a}function Bh(i,t){for(let r of t)if(Un(i,r))return!0;return!1}function rc(i,t){for(let r of i)if(!Un(r,t))return!1;for(let r=0;r<i.length-1;++r)if(Fh(i[r],i[r+1],t))return!1;return!0}function Oh(i,t){for(let r of t)if(rc(i,r))return!0;return!1}function nc(i,t,r,a){let l=a[0]-r[0],u=a[1]-r[1],d=(i[0]-r[0])*u-l*(i[1]-r[1]),m=(t[0]-r[0])*u-l*(t[1]-r[1]);return d>0&&m<0||d<0&&m>0}function Ns(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=[];for(let d=0;d<i[l].length;d++){let m=Rh(i[l][d],r);fn(t,m),u.push(m)}a.push(u)}return a}function ac(i,t,r){let a=[];for(let l=0;l<i.length;l++){let u=Ns(i[l],t,r);a.push(u)}return a}function oc(i,t,r,a){if(i[0]<r[0]||i[0]>r[2]){let l=.5*a,u=i[0]-r[0]>l?-a:r[0]-i[0]>l?a:0;u===0&&(u=i[0]-r[2]>l?-a:r[2]-i[0]>l?a:0),i[0]+=u}fn(t,i)}function sc(i,t,r,a){let l=Math.pow(2,a.z)*Mr,u=[a.x*Mr,a.y*Mr],d=[];for(let m of i)for(let g of m){let v=[g.x+u[0],g.y+u[1]];oc(v,t,r,l),d.push(v)}return d}function lc(i,t,r,a){let l=Math.pow(2,a.z)*Mr,u=[a.x*Mr,a.y*Mr],d=[];for(let g of i){let v=[];for(let x of g){let S=[x.x+u[0],x.y+u[1]];fn(t,S),v.push(S)}d.push(v)}if(t[2]-t[0]<=l/2){(m=t)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let g of d)for(let v of g)oc(v,t,r,l)}var m;return d}class gn{constructor(t,r){this.type=Ne,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(dn(t[1])){let a=t[1];if(a.type==="FeatureCollection"){let l=[];for(let u of a.features){let{type:d,coordinates:m}=u.geometry;d==="Polygon"&&l.push(m),d==="MultiPolygon"&&l.push(...m)}if(l.length)return new gn(a,{type:"MultiPolygon",coordinates:l})}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new gn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new gn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(a.type==="Polygon"){let m=Ns(a.coordinates,u,d),g=sc(r.geometry(),l,u,d);if(!Jr(l,u))return!1;for(let v of g)if(!Un(v,m))return!1}if(a.type==="MultiPolygon"){let m=ac(a.coordinates,u,d),g=sc(r.geometry(),l,u,d);if(!Jr(l,u))return!1;for(let v of g)if(!Bh(v,m))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(a.type==="Polygon"){let m=Ns(a.coordinates,u,d),g=lc(r.geometry(),l,u,d);if(!Jr(l,u))return!1;for(let v of g)if(!rc(v,m))return!1}if(a.type==="MultiPolygon"){let m=ac(a.coordinates,u,d),g=lc(r.geometry(),l,u,d);if(!Jr(l,u))return!1;for(let v of g)if(!Oh(v,m))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let cc=class{constructor(i=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:t,compare:r}=this,a=t[i];for(;i>0;){let l=i-1>>1,u=t[l];if(r(a,u)>=0)break;t[i]=u,i=l}t[i]=a}_down(i){let{data:t,compare:r}=this,a=this.length>>1,l=t[i];for(;i<a;){let u=1+(i<<1),d=u+1;if(d<this.length&&r(t[d],t[u])<0&&(u=d),r(t[u],l)>=0)break;t[i]=t[u],i=u}t[i]=l}};function Vh(i,t,r,a,l){hc(i,t,r,a||i.length-1,l||qh)}function hc(i,t,r,a,l){for(;a>r;){if(a-r>600){var u=a-r+1,d=t-r+1,m=Math.log(u),g=.5*Math.exp(2*m/3),v=.5*Math.sqrt(m*g*(u-g)/u)*(d-u/2<0?-1:1);hc(i,t,Math.max(r,Math.floor(t-d*g/u+v)),Math.min(a,Math.floor(t+(u-d)*g/u+v)),l)}var x=i[t],S=r,T=a;for(Ba(i,r,t),l(i[a],x)>0&&Ba(i,r,a);S<T;){for(Ba(i,S,T),S++,T--;l(i[S],x)<0;)S++;for(;l(i[T],x)>0;)T--}l(i[r],x)===0?Ba(i,r,T):Ba(i,++T,a),T<=t&&(r=T+1),t<=T&&(a=T-1)}}function Ba(i,t,r){var a=i[t];i[t]=i[r],i[r]=a}function qh(i,t){return i<t?-1:i>t?1:0}function So(i,t){if(i.length<=1)return[i];let r=[],a,l;for(let u of i){let d=jh(u);d!==0&&(u.area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(a&&r.push(a),a=[u]):a.push(u))}if(a&&r.push(a),t>1)for(let u=0;u<r.length;u++)r[u].length<=t||(Vh(r[u],t,1,r[u].length-1,Nh),r[u]=r[u].slice(0,t));return r}function Nh(i,t){return t.area-i.area}function jh(i){let t=0;for(let r,a,l=0,u=i.length,d=u-1;l<u;d=l++)r=i[l],a=i[d],t+=(a.x-r.x)*(r.y+a.y);return t}let uc=1/298.257223563,dc=uc*(2-uc),pc=Math.PI/180;class js{constructor(t){let r=6378.137*pc*1e3,a=Math.cos(t*pc),l=1/(1-dc*(1-a*a)),u=Math.sqrt(l);this.kx=r*u*a,this.ky=r*u*l*(1-dc)}distance(t,r){let a=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+l*l)}pointOnLine(t,r){let a,l,u,d,m=1/0;for(let g=0;g<t.length-1;g++){let v=t[g][0],x=t[g][1],S=this.wrap(t[g+1][0]-v)*this.kx,T=(t[g+1][1]-x)*this.ky,E=0;S===0&&T===0||(E=(this.wrap(r[0]-v)*this.kx*S+(r[1]-x)*this.ky*T)/(S*S+T*T),E>1?(v=t[g+1][0],x=t[g+1][1]):E>0&&(v+=S/this.kx*E,x+=T/this.ky*E)),S=this.wrap(r[0]-v)*this.kx,T=(r[1]-x)*this.ky;let A=S*S+T*T;A<m&&(m=A,a=v,l=x,u=g,d=E)}return{point:[a,l],index:u,t:Math.max(0,Math.min(1,d))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function mc(i,t){return t[0]-i[0]}function Co(i){return i[1]-i[0]+1}function Or(i,t){return i[1]>=i[0]&&i[1]<t}function Us(i,t){if(i[0]>i[1])return[null,null];let r=Co(i);if(t){if(r===2)return[i,null];let l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];let a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function $s(i,t){if(!Or(t,i.length))return[1/0,1/0,-1/0,-1/0];let r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)fn(r,i[a]);return r}function Zs(i){let t=[1/0,1/0,-1/0,-1/0];for(let r of i)for(let a of r)fn(t,a);return t}function Mo(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Gs(i,t,r){if(!Mo(i)||!Mo(t))return NaN;let a=0,l=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[a,l])}function _n(i,t,r){let a=r.pointOnLine(t,i);return r.distance(i,a.point)}function Hs(i,t,r,a,l){let u=Math.min(_n(i,[r,a],l),_n(t,[r,a],l)),d=Math.min(_n(r,[i,t],l),_n(a,[i,t],l));return Math.min(u,d)}function Uh(i,t,r,a,l){if(!Or(t,i.length)||!Or(a,r.length))return 1/0;let u=1/0;for(let d=t[0];d<t[1];++d){let m=i[d],g=i[d+1];for(let v=a[0];v<a[1];++v){let x=r[v],S=r[v+1];if(wo(m,g,x,S))return 0;u=Math.min(u,Hs(m,g,x,S,l))}}return u}function Lt(i,t,r,a,l){if(!Or(t,i.length)||!Or(a,r.length))return NaN;let u=1/0;for(let d=t[0];d<=t[1];++d)for(let m=a[0];m<=a[1];++m)if(u=Math.min(u,l.distance(i[d],r[m])),u===0)return u;return u}function $h(i,t,r){if(Un(i,t,!0))return 0;let a=1/0;for(let l of t){let u=l[0],d=l[l.length-1];if(u!==d&&(a=Math.min(a,_n(i,[d,u],r)),a===0))return a;let m=r.pointOnLine(l,i);if(a=Math.min(a,r.distance(i,m.point)),a===0)return a}return a}function Qe(i,t,r,a){if(!Or(t,i.length))return NaN;for(let u=t[0];u<=t[1];++u)if(Un(i[u],r,!0))return 0;let l=1/0;for(let u=t[0];u<t[1];++u){let d=i[u],m=i[u+1];for(let g of r)for(let v=0,x=g.length,S=x-1;v<x;S=v++){let T=g[S],E=g[v];if(wo(d,m,T,E))return 0;l=Math.min(l,Hs(d,m,T,E,a))}}return l}function To(i,t){for(let r of i)for(let a of r)if(Un(a,t,!0))return!0;return!1}function wt(i,t,r,a=1/0){let l=Zs(i),u=Zs(t);if(a!==1/0&&Gs(l,u,r)>=a)return a;if(Jr(l,u)){if(To(i,t))return 0}else if(To(t,i))return 0;let d=1/0;for(let m of i)for(let g=0,v=m.length,x=v-1;g<v;x=g++){let S=m[x],T=m[g];for(let E of t)for(let A=0,D=E.length,O=D-1;A<D;O=A++){let j=E[O],ie=E[A];if(wo(S,T,j,ie))return 0;d=Math.min(d,Hs(S,T,j,ie,r))}}return d}function _t(i,t,r,a,l,u){if(!u)return;let d=Gs($s(a,u),l,r);d<t&&i.push([d,u,[0,0]])}function yn(i,t,r,a,l,u,d){if(!u||!d)return;let m=Gs($s(a,u),$s(l,d),r);m<t&&i.push([m,u,d])}function Oa(i,t,r,a,l=1/0){let u=Math.min(a.distance(i[0],r[0][0]),l);if(u===0)return u;let d=new cc([[0,[0,i.length-1],[0,0]]],mc),m=Zs(r);for(;d.length>0;){let g=d.pop();if(g[0]>=u)continue;let v=g[1],x=t?50:100;if(Co(v)<=x){if(!Or(v,i.length))return NaN;if(t){let S=Qe(i,v,r,a);if(isNaN(S)||S===0)return S;u=Math.min(u,S)}else for(let S=v[0];S<=v[1];++S){let T=$h(i[S],r,a);if(u=Math.min(u,T),u===0)return 0}}else{let S=Us(v,t);_t(d,u,a,i,m,S[0]),_t(d,u,a,i,m,S[1])}}return u}function Va(i,t,r,a,l,u=1/0){let d=Math.min(u,l.distance(i[0],r[0]));if(d===0)return d;let m=new cc([[0,[0,i.length-1],[0,r.length-1]]],mc);for(;m.length>0;){let g=m.pop();if(g[0]>=d)continue;let v=g[1],x=g[2],S=t?50:100,T=a?50:100;if(Co(v)<=S&&Co(x)<=T){if(!Or(v,i.length)&&Or(x,r.length))return NaN;let E;if(t&&a)E=Uh(i,v,r,x,l),d=Math.min(d,E);else if(t&&!a){let A=i.slice(v[0],v[1]+1);for(let D=x[0];D<=x[1];++D)if(E=_n(r[D],A,l),d=Math.min(d,E),d===0)return d}else if(!t&&a){let A=r.slice(x[0],x[1]+1);for(let D=v[0];D<=v[1];++D)if(E=_n(i[D],A,l),d=Math.min(d,E),d===0)return d}else E=Lt(i,v,r,x,l),d=Math.min(d,E)}else{let E=Us(v,t),A=Us(x,a);yn(m,d,l,i,r,E[0],A[0]),yn(m,d,l,i,r,E[0],A[1]),yn(m,d,l,i,r,E[1],A[0]),yn(m,d,l,i,r,E[1],A[1])}}return d}function Ws(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class vn{constructor(t,r){this.type=xe,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(dn(t[1])){let a=t[1];if(a.type==="FeatureCollection")return new vn(a,a.features.map(l=>Ws(l.geometry)).flat());if(a.type==="Feature")return new vn(a,Ws(a.geometry));if("type"in a&&"coordinates"in a)return new vn(a,Ws(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>qs([g.x,g.y],r.canonical));if(l.length===0)return NaN;let d=new js(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,Va(u,!1,[g.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,Va(u,!1,g.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,Oa(u,!1,g.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){let l=r.geometry(),u=l.flat().map(g=>qs([g.x,g.y],r.canonical));if(l.length===0)return NaN;let d=new js(u[0][1]),m=1/0;for(let g of a){switch(g.type){case"Point":m=Math.min(m,Va(u,!0,[g.coordinates],!1,d,m));break;case"LineString":m=Math.min(m,Va(u,!0,g.coordinates,!0,d,m));break;case"Polygon":m=Math.min(m,Oa(u,!0,g.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,a){let l=r.geometry();if(l.length===0||l[0].length===0)return NaN;let u=So(l,0).map(g=>g.map(v=>v.map(x=>qs([x.x,x.y],r.canonical)))),d=new js(u[0][0][0][1]),m=1/0;for(let g of a)for(let v of u){switch(g.type){case"Point":m=Math.min(m,Oa([g.coordinates],!1,v,d,m));break;case"LineString":m=Math.min(m,Oa(g.coordinates,!0,v,d,m));break;case"Polygon":m=Math.min(m,wt(v,g.coordinates,d,m))}if(m===0)return m}return m}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let $n={"==":zh,"!=":ec,">":Dh,"<":tc,">=":ic,"<=":Lh,array:rr,at:Ls,boolean:rr,case:go,coalesce:vo,collator:Fa,format:bo,image:Os,in:Rs,"index-of":qn,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:Vs,let:Kr,literal:ir,match:Fs,number:rr,"number-format":Bs,object:rr,slice:La,step:Nn,string:rr,"to-boolean":nr,"to-color":nr,"to-number":nr,"to-string":nr,var:ct,within:gn,distance:vn};class $i{constructor(t,r,a,l){this.name=t,this.type=r,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){let a=t[0],l=$i.definitions[a];if(!l)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=d.filter(([v])=>!Array.isArray(v)||v.length===t.length-1),g=null;for(let[v,x]of m){g=new pn(r.registry,qa,r.path,null,r.scope);let S=[],T=!1;for(let E=1;E<t.length;E++){let A=t[E],D=Array.isArray(v)?v[E-1]:v.type,O=g.parse(A,1+S.length,D);if(!O){T=!0;break}S.push(O)}if(!T)if(Array.isArray(v)&&v.length!==S.length)g.error(`Expected ${v.length} arguments, but found ${S.length} instead.`);else{for(let E=0;E<S.length;E++){let A=Array.isArray(v)?v[E]:v.type,D=S[E];g.concat(E+1).checkSubtype(A,D.type)}if(g.errors.length===0)return new $i(a,u,x,S)}}if(m.length===1)r.errors.push(...g.errors);else{let v=(m.length?m:d).map(([S])=>{return T=S,Array.isArray(T)?`(${T.map(k).join(", ")})`:`(${k(T.type)}...)`;var T}).join(" | "),x=[];for(let S=1;S<t.length;S++){let T=r.parse(t[S],1+x.length);if(!T)return null;x.push(k(T.type))}r.error(`Expected arguments of type ${v}, but found (${x.join(", ")}) instead.`)}return null}static register(t,r){$i.definitions=r;for(let a in r)t[a]=$i}}function Xs(i,[t,r,a,l]){t=t.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);let u=l?l.evaluate(i):1,d=Vn(t,r,a,u);if(d)throw new Ot(d);return new pt(t/255,r/255,a/255,u,!1)}function Ks(i,t){return i in t}function Js(i,t){let r=t[i];return r===void 0?null:r}function xn(i){return{type:i}}function qa(i){if(i instanceof ct)return qa(i.boundExpression);if(i instanceof $i&&i.name==="error"||i instanceof Fa||i instanceof gn||i instanceof vn)return!1;let t=i instanceof nr||i instanceof rr,r=!0;return i.eachChild(a=>{r=t?r&&qa(a):r&&a instanceof ir}),!!r&&Na(i)&&ja(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Na(i){if(i instanceof $i&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof gn||i instanceof vn)return!1;let t=!0;return i.eachChild(r=>{t&&!Na(r)&&(t=!1)}),t}function Zn(i){if(i instanceof $i&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Zn(r)&&(t=!1)}),t}function ja(i,t){if(i instanceof $i&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!ja(a,t)&&(r=!1)}),r}function ko(i){return{result:"success",value:i}}function Gn(i){return{result:"error",value:i}}function Hn(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function fc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ys(i){return!!i.expression&&i.expression.interpolated}function ot(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Io(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Zh(i){return i}function gc(i,t){let r=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",l=a||!(a||i.property!==void 0),u=i.type||(Ys(t)?"exponential":"interval");if(r||t.type==="padding"){let x=r?pt.parse:Li.parse;(i=br({},i)).stops&&(i.stops=i.stops.map(S=>[S[0],x(S[1])])),i.default=x(i.default?i.default:t.default)}if(i.colorSpace&&(d=i.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var d;let m,g,v;if(u==="exponential")m=yc;else if(u==="interval")m=Eo;else if(u==="categorical"){m=_c,g=Object.create(null);for(let x of i.stops)g[x[0]]=x[1];v=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=vc}if(a){let x={},S=[];for(let A=0;A<i.stops.length;A++){let D=i.stops[A],O=D[0].zoom;x[O]===void 0&&(x[O]={zoom:O,type:i.type,property:i.property,default:i.default,stops:[]},S.push(O)),x[O].stops.push([D[0].value,D[1]])}let T=[];for(let A of S)T.push([x[A].zoom,gc(x[A],t)]);let E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:bi.interpolationFactor.bind(void 0,E),zoomStops:T.map(A=>A[0]),evaluate:({zoom:A},D)=>yc({stops:T,base:i.base},t,A).evaluate(A,D)}}if(l){let x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:bi.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(i,t,S,g,v)}}return{kind:"source",evaluate(x,S){let T=S&&S.properties?S.properties[i.property]:void 0;return T===void 0?Wn(i.default,t.default):m(i,t,T,g,v)}}}function Wn(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function _c(i,t,r,a,l){return Wn(typeof r===l?a[r]:void 0,i.default,t.default)}function Eo(i,t,r){if(ot(r)!=="number")return Wn(i.default,t.default);let a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];let l=_o(i.stops.map(u=>u[0]),r);return i.stops[l][1]}function yc(i,t,r){let a=i.base!==void 0?i.base:1;if(ot(r)!=="number")return Wn(i.default,t.default);let l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];let u=_o(i.stops.map(x=>x[0]),r),d=function(x,S,T,E){let A=E-T,D=x-T;return A===0?0:S===1?D/A:(Math.pow(S,D)-1)/(Math.pow(S,A)-1)}(r,a,i.stops[u][0],i.stops[u+1][0]),m=i.stops[u][1],g=i.stops[u+1][1],v=xi[t.type]||Zh;return typeof m.evaluate=="function"?{evaluate(...x){let S=m.evaluate.apply(void 0,x),T=g.evaluate.apply(void 0,x);if(S!==void 0&&T!==void 0)return v(S,T,d,i.colorSpace)}}:v(m,g,d,i.colorSpace)}function vc(i,t,r){switch(t.type){case"color":r=pt.parse(r);break;case"formatted":r=Di.fromString(r.toString());break;case"resolvedImage":r=Ri.fromString(r.toString());break;case"padding":r=Li.parse(r);break;default:ot(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Wn(r,i.default,t.default)}$i.register($n,{error:[{kind:"error"},[Ke],(i,[t])=>{throw new Ot(t.evaluate(i))}],typeof:[Ke,[Ge],(i,[t])=>k(Nt(t.evaluate(i)))],"to-rgba":[I(xe,4),[vi],(i,[t])=>{let[r,a,l,u]=t.evaluate(i).rgb;return[255*r,255*a,255*l,u]}],rgb:[vi,[xe,xe,xe],Xs],rgba:[vi,[xe,xe,xe,xe],Xs],has:{type:Ne,overloads:[[[Ke],(i,[t])=>Ks(t.evaluate(i),i.properties())],[[Ke,tr],(i,[t,r])=>Ks(t.evaluate(i),r.evaluate(i))]]},get:{type:Ge,overloads:[[[Ke],(i,[t])=>Js(t.evaluate(i),i.properties())],[[Ke,tr],(i,[t,r])=>Js(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ge,[Ke],(i,[t])=>Js(t.evaluate(i),i.featureState||{})],properties:[tr,[],i=>i.properties()],"geometry-type":[Ke,[],i=>i.geometryType()],id:[Ge,[],i=>i.id()],zoom:[xe,[],i=>i.globals.zoom],"heatmap-density":[xe,[],i=>i.globals.heatmapDensity||0],"line-progress":[xe,[],i=>i.globals.lineProgress||0],accumulated:[Ge,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[xe,xn(xe),(i,t)=>{let r=0;for(let a of t)r+=a.evaluate(i);return r}],"*":[xe,xn(xe),(i,t)=>{let r=1;for(let a of t)r*=a.evaluate(i);return r}],"-":{type:xe,overloads:[[[xe,xe],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[xe],(i,[t])=>-t.evaluate(i)]]},"/":[xe,[xe,xe],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[xe,[xe,xe],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[xe,[],()=>Math.LN2],pi:[xe,[],()=>Math.PI],e:[xe,[],()=>Math.E],"^":[xe,[xe,xe],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[xe,[xe],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))],log2:[xe,[xe],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[xe,[xe],(i,[t])=>Math.sin(t.evaluate(i))],cos:[xe,[xe],(i,[t])=>Math.cos(t.evaluate(i))],tan:[xe,[xe],(i,[t])=>Math.tan(t.evaluate(i))],asin:[xe,[xe],(i,[t])=>Math.asin(t.evaluate(i))],acos:[xe,[xe],(i,[t])=>Math.acos(t.evaluate(i))],atan:[xe,[xe],(i,[t])=>Math.atan(t.evaluate(i))],min:[xe,xn(xe),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[xe,xn(xe),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[xe,[xe],(i,[t])=>Math.abs(t.evaluate(i))],round:[xe,[xe],(i,[t])=>{let r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[xe,[xe],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[xe,[xe],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ne,[Ke,Ge],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Ne,[Ge],(i,[t])=>i.id()===t.value],"filter-type-==":[Ne,[Ke],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ne,[Ke,Ge],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<l}],"filter-id-<":[Ne,[Ge],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[Ne,[Ke,Ge],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>l}],"filter-id->":[Ne,[Ge],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[Ne,[Ke,Ge],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[Ne,[Ge],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[Ne,[Ke,Ge],(i,[t,r])=>{let a=i.properties()[t.value],l=r.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[Ne,[Ge],(i,[t])=>{let r=i.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[Ne,[Ge],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ne,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ne,[I(Ke)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ne,[I(Ge)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ne,[Ke,I(Ge)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ne,[Ke,I(Ge)],(i,[t,r])=>function(a,l,u,d){for(;u<=d;){let m=u+d>>1;if(l[m]===a)return!0;l[m]>a?d=m-1:u=m+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ne,overloads:[[[Ne,Ne],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[xn(Ne),(i,t)=>{for(let r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ne,overloads:[[[Ne,Ne],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[xn(Ne),(i,t)=>{for(let r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Ne,[Ne],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ne,[Ke],(i,[t])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Ke,[Ke],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ke,[Ke],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ke,xn(Ge),(i,t)=>t.map(r=>Da(r.evaluate(i))).join("")],"resolved-locale":[Ke,[Sr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Po{constructor(t,r){var a;this.expression=t,this._warningHistory={},this._evaluator=new fo,this._defaultValue=r?(a=r).type==="color"&&Io(a.default)?new pt(0,0,0,0):a.type==="color"?pt.parse(a.default)||null:a.type==="padding"?Li.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Ui.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,l,u,d){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,l,u,d){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d||null;try{let m=this.expression.evaluate(this._evaluator);if(m==null||typeof m=="number"&&m!=m)return this._defaultValue;if(this._enumValues&&!(m in this._enumValues))throw new Ot(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(m)} instead.`);return m}catch(m){return this._warningHistory[m.message]||(this._warningHistory[m.message]=!0,typeof console<"u"&&console.warn(m.message)),this._defaultValue}}}function Ao(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in $n}function Xn(i,t){let r=new pn($n,qa,[],t?function(l){let u={color:vi,string:Ke,number:xe,enum:Ke,boolean:Ne,formatted:Br,padding:Xr,resolvedImage:Cr,variableAnchorOffsetCollection:N};return l.type==="array"?I(u[l.value]||Ge,l.length):u[l.type]}(t):void 0),a=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ko(new Po(a,t)):Gn(r.errors)}class Kn{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Zn(r.expression)}evaluateWithoutErrorHandling(t,r,a,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,d)}evaluate(t,r,a,l,u,d){return this._styleExpression.evaluate(t,r,a,l,u,d)}}class Jn{constructor(t,r,a,l){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Zn(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,a,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,l,u,d)}evaluate(t,r,a,l,u,d){return this._styleExpression.evaluate(t,r,a,l,u,d)}interpolationFactor(t,r,a){return this.interpolationType?bi.interpolationFactor(this.interpolationType,t,r,a):0}}function Qs(i,t){let r=Xn(i,t);if(r.result==="error")return r;let a=r.value.expression,l=Na(a);if(!l&&!Hn(t))return Gn([new ui("","data expressions not supported")]);let u=ja(a,["zoom"]);if(!u&&!fc(t))return Gn([new ui("","zoom expressions not supported")]);let d=Ua(a);return d||u?d instanceof ui?Gn([d]):d instanceof bi&&!Ys(t)?Gn([new ui("",'"interpolate" expressions cannot be used with this property')]):ko(d?new Jn(l?"camera":"composite",r.value,d.labels,d instanceof bi?d.interpolation:void 0):new Kn(l?"constant":"source",r.value)):Gn([new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yn{constructor(t,r){this._parameters=t,this._specification=r,br(this,gc(this._parameters,this._specification))}static deserialize(t){return new Yn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ua(i){let t=null;if(i instanceof Kr)t=Ua(i.result);else if(i instanceof vo){for(let r of i.args)if(t=Ua(r),t)break}else(i instanceof Nn||i instanceof bi)&&i.input instanceof $i&&i.input.name==="zoom"&&(t=i);return t instanceof ui||i.eachChild(r=>{let a=Ua(r);a instanceof ui?t=a:!t&&a?t=new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function zo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let t of i.slice(1))if(!zo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let Do={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function el(i){if(i==null)return{filter:()=>!0,needGeometry:!1};zo(i)||(i=Lo(i));let t=Xn(i,Do);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,l)=>t.value.evaluate(r,a,{},l),needGeometry:xc(i)}}function Gh(i,t){return i<t?-1:i>t?1:0}function xc(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(xc(i[t]))return!0;return!1}function Lo(i){if(!i)return!0;let t=i[0];return i.length<=1?t!=="any":t==="=="?tl(i[1],i[2],"=="):t==="!="?ei(tl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?tl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Lo))):t==="all"?["all"].concat(i.slice(1).map(Lo)):t==="none"?["all"].concat(i.slice(1).map(Lo).map(ei)):t==="in"?$a(i[1],i.slice(2)):t==="!in"?ei($a(i[1],i.slice(2))):t==="has"?Za(i[1]):t!=="!has"||ei(Za(i[1]));var r}function tl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function $a(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Gh)]]:["filter-in-small",i,["literal",t]]}}function Za(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ei(i){return["!",i]}function bn(i){let t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(let u of i)l+=`${bn(u)},`;return`${l}]`}let r=Object.keys(i).sort(),a="{";for(let l=0;l<r.length;l++)a+=`${JSON.stringify(r[l])}:${bn(i[r[l]])},`;return`${a}}`}function bc(i){let t="";for(let r of un)t+=`/${bn(i[r])}`;return t}function wc(i){let t=i.value;return t?[new fe(i.key,t,"constants have been deprecated as of v8")]:[]}function Rt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ar(i){if(Array.isArray(i))return i.map(ar);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let t={};for(let r in i)t[r]=ar(i[r]);return t}return Rt(i)}function Fi(i){let t=i.key,r=i.value,a=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,d=i.styleSpec,m=i.validateSpec,g=[],v=ot(r);if(v!=="object")return[new fe(t,r,`object expected, ${v} found`)];for(let x in r){let S=x.split(".")[0],T=a[S]||a["*"],E;if(l[S])E=l[S];else if(a[S])E=m;else if(l["*"])E=l["*"];else{if(!a["*"]){g.push(new fe(t,r[x],`unknown property "${x}"`));continue}E=m}g=g.concat(E({key:(t&&`${t}.`)+x,value:r[x],valueSpec:T,style:u,styleSpec:d,object:r,objectKey:x,validateSpec:m},r))}for(let x in a)l[x]||a[x].required&&a[x].default===void 0&&r[x]===void 0&&g.push(new fe(t,r,`missing required property "${x}"`));return g}function Ga(i){let t=i.value,r=i.valueSpec,a=i.style,l=i.styleSpec,u=i.key,d=i.arrayElementValidator||i.validateSpec;if(ot(t)!=="array")return[new fe(u,t,`array expected, ${ot(t)} found`)];if(r.length&&t.length!==r.length)return[new fe(u,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new fe(u,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let m={type:r.value,values:r.values};l.$version<7&&(m.function=r.function),ot(r.value)==="object"&&(m=r.value);let g=[];for(let v=0;v<t.length;v++)g=g.concat(d({array:t,arrayIndex:v,value:t[v],valueSpec:m,validateSpec:i.validateSpec,style:a,styleSpec:l,key:`${u}[${v}]`}));return g}function il(i){let t=i.key,r=i.value,a=i.valueSpec,l=ot(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new fe(t,r,`number expected, ${l} found`)]:"minimum"in a&&r<a.minimum?[new fe(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new fe(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Ro(i){let t=i.valueSpec,r=Rt(i.value.type),a,l,u,d={},m=r!=="categorical"&&i.value.property===void 0,g=!m,v=ot(i.value.stops)==="array"&&ot(i.value.stops[0])==="array"&&ot(i.value.stops[0][0])==="object",x=Fi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(E){if(r==="identity")return[new fe(E.key,E.value,'identity function may not have a "stops" property')];let A=[],D=E.value;return A=A.concat(Ga({key:E.key,value:D,valueSpec:E.valueSpec,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:S})),ot(D)==="array"&&D.length===0&&A.push(new fe(E.key,D,"array must have at least one stop")),A},default:function(E){return E.validateSpec({key:E.key,value:E.value,valueSpec:t,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec})}}});return r==="identity"&&m&&x.push(new fe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||x.push(new fe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Ys(i.valueSpec)&&x.push(new fe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Hn(i.valueSpec)?x.push(new fe(i.key,i.value,"property functions not supported")):m&&!fc(i.valueSpec)&&x.push(new fe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!v||i.value.property!==void 0||x.push(new fe(i.key,i.value,'"property" property is required')),x;function S(E){let A=[],D=E.value,O=E.key;if(ot(D)!=="array")return[new fe(O,D,`array expected, ${ot(D)} found`)];if(D.length!==2)return[new fe(O,D,`array length 2 expected, length ${D.length} found`)];if(v){if(ot(D[0])!=="object")return[new fe(O,D,`object expected, ${ot(D[0])} found`)];if(D[0].zoom===void 0)return[new fe(O,D,"object stop key must have zoom")];if(D[0].value===void 0)return[new fe(O,D,"object stop key must have value")];if(u&&u>Rt(D[0].zoom))return[new fe(O,D[0].zoom,"stop zoom values must appear in ascending order")];Rt(D[0].zoom)!==u&&(u=Rt(D[0].zoom),l=void 0,d={}),A=A.concat(Fi({key:`${O}[0]`,value:D[0],valueSpec:{zoom:{}},validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{zoom:il,value:T}}))}else A=A.concat(T({key:`${O}[0]`,value:D[0],valueSpec:{},validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec},D));return Ao(ar(D[1]))?A.concat([new fe(`${O}[1]`,D[1],"expressions are not allowed in function stops.")]):A.concat(E.validateSpec({key:`${O}[1]`,value:D[1],valueSpec:t,validateSpec:E.validateSpec,style:E.style,styleSpec:E.styleSpec}))}function T(E,A){let D=ot(E.value),O=Rt(E.value),j=E.value!==null?E.value:A;if(a){if(D!==a)return[new fe(E.key,j,`${D} stop domain type must match previous stop domain type ${a}`)]}else a=D;if(D!=="number"&&D!=="string"&&D!=="boolean")return[new fe(E.key,j,"stop domain value must be a number, string, or boolean")];if(D!=="number"&&r!=="categorical"){let ie=`number expected, ${D} found`;return Hn(t)&&r===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new fe(E.key,j,ie)]}return r!=="categorical"||D!=="number"||isFinite(O)&&Math.floor(O)===O?r!=="categorical"&&D==="number"&&l!==void 0&&O<l?[new fe(E.key,j,"stop domain values must appear in ascending order")]:(l=O,r==="categorical"&&O in d?[new fe(E.key,j,"stop domain values must be unique")]:(d[O]=!0,[])):[new fe(E.key,j,`integer expected, found ${O}`)]}}function Qn(i){let t=(i.expressionContext==="property"?Qs:Xn)(ar(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new fe(`${i.key}${a.key}`,i.value,a.message));let r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new fe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zn(r))return[new fe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Zn(r))return[new fe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ja(r,["zoom","feature-state"]))return[new fe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Na(r))return[new fe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vr(i){let t=i.key,r=i.value,a=i.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(Rt(r))===-1&&l.push(new fe(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Rt(r))===-1&&l.push(new fe(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function rl(i){return zo(ar(i.value))?Qn(br({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fo(i)}function Fo(i){let t=i.value,r=i.key;if(ot(t)!=="array")return[new fe(r,t,`array expected, ${ot(t)} found`)];let a=i.styleSpec,l,u=[];if(t.length<1)return[new fe(r,t,"filter array must have at least 1 element")];switch(u=u.concat(Vr({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Rt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Rt(t[1])==="$type"&&u.push(new fe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&u.push(new fe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=ot(t[1]),l!=="string"&&u.push(new fe(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=ot(t[d]),Rt(t[1])==="$type"?u=u.concat(Vr({key:`${r}[${d}]`,value:t[d],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new fe(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)u=u.concat(Fo({key:`${r}[${d}]`,value:t[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=ot(t[1]),t.length!==2?u.push(new fe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new fe(`${r}[1]`,t[1],`string expected, ${l} found`))}return u}function nl(i,t){let r=i.key,a=i.validateSpec,l=i.style,u=i.styleSpec,d=i.value,m=i.objectKey,g=u[`${t}_${i.layerType}`];if(!g)return[];let v=m.match(/^(.*)-transition$/);if(t==="paint"&&v&&g[v[1]]&&g[v[1]].transition)return a({key:r,value:d,valueSpec:u.transition,style:l,styleSpec:u});let x=i.valueSpec||g[m];if(!x)return[new fe(r,d,`unknown property "${m}"`)];let S;if(ot(d)==="string"&&Hn(x)&&!x.tokens&&(S=/^{([^}]+)}$/.exec(d)))return[new fe(r,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];let T=[];return i.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&T.push(new fe(r,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Io(ar(d))&&Rt(d.type)==="identity"&&T.push(new fe(r,d,'"text-font" does not support identity functions'))),T.concat(a({key:i.key,value:d,valueSpec:x,style:l,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Bo(i){return nl(i,"paint")}function al(i){return nl(i,"layout")}function ol(i){let t=[],r=i.value,a=i.key,l=i.style,u=i.styleSpec;r.type||r.ref||t.push(new fe(a,r,'either "type" or "ref" is required'));let d=Rt(r.type),m=Rt(r.ref);if(r.id){let g=Rt(r.id);for(let v=0;v<i.arrayIndex;v++){let x=l.layers[v];Rt(x.id)===g&&t.push(new fe(a,r.id,`duplicate layer id "${r.id}", previously used at line ${x.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(v=>{v in r&&t.push(new fe(a,r[v],`"${v}" is prohibited for ref layers`))}),l.layers.forEach(v=>{Rt(v.id)===m&&(g=v)}),g?g.ref?t.push(new fe(a,r.ref,"ref cannot reference another ref layer")):d=Rt(g.type):t.push(new fe(a,r.ref,`ref layer "${m}" not found`))}else if(d!=="background")if(r.source){let g=l.sources&&l.sources[r.source],v=g&&Rt(g.type);g?v==="vector"&&d==="raster"?t.push(new fe(a,r.source,`layer "${r.id}" requires a raster source`)):v!=="raster-dem"&&d==="hillshade"?t.push(new fe(a,r.source,`layer "${r.id}" requires a raster-dem source`)):v==="raster"&&d!=="raster"?t.push(new fe(a,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&d!=="hillshade"?t.push(new fe(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||v==="geojson"&&g.lineMetrics||t.push(new fe(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new fe(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new fe(a,r.source,`source "${r.source}" not found`))}else t.push(new fe(a,r,'missing required property "source"'));return t=t.concat(Fi({key:a,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:rl,layout:g=>Fi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":v=>al(br({layerType:d},v))}}),paint:g=>Fi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":v=>Bo(br({layerType:d},v))}})}})),t}function wn(i){let t=i.value,r=i.key,a=ot(t);return a!=="string"?[new fe(r,t,`string expected, ${a} found`)]:[]}let Oo={promoteId:function({key:i,value:t}){if(ot(t)==="string")return wn({key:i,value:t});{let r=[];for(let a in t)r.push(...wn({key:`${i}.${a}`,value:t[a]}));return r}}};function Ha(i){let t=i.value,r=i.key,a=i.styleSpec,l=i.style,u=i.validateSpec;if(!t.type)return[new fe(r,t,'"type" is required')];let d=Rt(t.type),m;switch(d){case"vector":case"raster":return m=Fi({key:r,value:t,valueSpec:a[`source_${d.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Oo,validateSpec:u}),m;case"raster-dem":return m=function(g){var v;let x=(v=g.sourceName)!==null&&v!==void 0?v:"",S=g.value,T=g.styleSpec,E=T.source_raster_dem,A=g.style,D=[],O=ot(S);if(S===void 0)return D;if(O!=="object")return D.push(new fe("source_raster_dem",S,`object expected, ${O} found`)),D;let j=Rt(S.encoding)==="custom",ie=["redFactor","greenFactor","blueFactor","baseShift"],W=g.value.encoding?`"${g.value.encoding}"`:"Default";for(let ee in S)!j&&ie.includes(ee)?D.push(new fe(ee,S[ee],`In "${x}": "${ee}" is only valid when "encoding" is set to "custom". ${W} encoding found`)):E[ee]?D=D.concat(g.validateSpec({key:ee,value:S[ee],valueSpec:E[ee],validateSpec:g.validateSpec,style:A,styleSpec:T})):D.push(new fe(ee,S[ee],`unknown property "${ee}"`));return D}({sourceName:r,value:t,style:i.style,styleSpec:a,validateSpec:u}),m;case"geojson":if(m=Fi({key:r,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:u,objectElementValidators:Oo}),t.cluster)for(let g in t.clusterProperties){let[v,x]=t.clusterProperties[g],S=typeof v=="string"?[v,["accumulated"],["get",g]]:v;m.push(...Qn({key:`${r}.${g}.map`,value:x,validateSpec:u,expressionContext:"cluster-map"})),m.push(...Qn({key:`${r}.${g}.reduce`,value:S,validateSpec:u,expressionContext:"cluster-reduce"}))}return m;case"video":return Fi({key:r,value:t,valueSpec:a.source_video,style:l,validateSpec:u,styleSpec:a});case"image":return Fi({key:r,value:t,valueSpec:a.source_image,style:l,validateSpec:u,styleSpec:a});case"canvas":return[new fe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vr({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,validateSpec:u,styleSpec:a})}}function sl(i){let t=i.value,r=i.styleSpec,a=r.light,l=i.style,u=[],d=ot(t);if(t===void 0)return u;if(d!=="object")return u=u.concat([new fe("light",t,`object expected, ${d} found`)]),u;for(let m in t){let g=m.match(/^(.*)-transition$/);u=u.concat(g&&a[g[1]]&&a[g[1]].transition?i.validateSpec({key:m,value:t[m],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new fe(m,t[m],`unknown property "${m}"`)])}return u}function ll(i){let t=i.value,r=i.styleSpec,a=r.sky,l=i.style,u=ot(t);if(t===void 0)return[];if(u!=="object")return[new fe("sky",t,`object expected, ${u} found`)];let d=[];for(let m in t)d=d.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new fe(m,t[m],`unknown property "${m}"`)]);return d}function cl(i){let t=i.value,r=i.styleSpec,a=r.terrain,l=i.style,u=[],d=ot(t);if(t===void 0)return u;if(d!=="object")return u=u.concat([new fe("terrain",t,`object expected, ${d} found`)]),u;for(let m in t)u=u.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new fe(m,t[m],`unknown property "${m}"`)]);return u}function hl(i){let t=[],r=i.value,a=i.key;if(Array.isArray(r)){let l=[],u=[];for(let d in r)r[d].id&&l.includes(r[d].id)&&t.push(new fe(a,r,`all the sprites' ids must be unique, but ${r[d].id} is duplicated`)),l.push(r[d].id),r[d].url&&u.includes(r[d].url)&&t.push(new fe(a,r,`all the sprites' URLs must be unique, but ${r[d].url} is duplicated`)),u.push(r[d].url),t=t.concat(Fi({key:`${a}[${d}]`,value:r[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return wn({key:a,value:r})}let Vo={"*":()=>[],array:Ga,boolean:function(i){let t=i.value,r=i.key,a=ot(t);return a!=="boolean"?[new fe(r,t,`boolean expected, ${a} found`)]:[]},number:il,color:function(i){let t=i.key,r=i.value,a=ot(r);return a!=="string"?[new fe(t,r,`color expected, ${a} found`)]:pt.parse(String(r))?[]:[new fe(t,r,`color expected, "${r}" found`)]},constants:wc,enum:Vr,filter:rl,function:Ro,layer:ol,object:Fi,source:Ha,light:sl,sky:ll,terrain:cl,projection:function(i){let t=i.value,r=i.styleSpec,a=r.projection,l=i.style,u=ot(t);if(t===void 0)return[];if(u!=="object")return[new fe("projection",t,`object expected, ${u} found`)];let d=[];for(let m in t)d=d.concat(a[m]?i.validateSpec({key:m,value:t[m],valueSpec:a[m],style:l,styleSpec:r}):[new fe(m,t[m],`unknown property "${m}"`)]);return d},string:wn,formatted:function(i){return wn(i).length===0?[]:Qn(i)},resolvedImage:function(i){return wn(i).length===0?[]:Qn(i)},padding:function(i){let t=i.key,r=i.value;if(ot(r)==="array"){if(r.length<1||r.length>4)return[new fe(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];let a={type:"number"},l=[];for(let u=0;u<r.length;u++)l=l.concat(i.validateSpec({key:`${t}[${u}]`,value:r[u],validateSpec:i.validateSpec,valueSpec:a}));return l}return il({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){let t=i.key,r=i.value,a=ot(r),l=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new fe(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let u=[];for(let d=0;d<r.length;d+=2)u=u.concat(Vr({key:`${t}[${d}]`,value:r[d],valueSpec:l.layout_symbol["text-anchor"]})),u=u.concat(Ga({key:`${t}[${d+1}]`,value:r[d+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return u},sprite:hl};function ea(i){let t=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=ea,r.expression&&Io(Rt(t))?Ro(i):r.expression&&Ao(ar(t))?Qn(i):r.type&&Vo[r.type]?Vo[r.type](i):Fi(br({},i,{valueSpec:r.type?a[r.type]:r}))}function Sc(i){let t=i.value,r=i.key,a=wn(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new fe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new fe(r,t,'"glyphs" url must include a "{range}" token'))),a}function Zi(i,t=ae){let r=[];return r=r.concat(ea({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ea,objectElementValidators:{glyphs:Sc,"*":()=>[]}})),i.constants&&(r=r.concat(wc({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:ea}))),ul(r)}function Tr(i){return function(t){return i(ls(ao({},t),{validateSpec:ea}))}}function ul(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function or(i){return function(...t){return ul(i.apply(this,t))}}Zi.source=or(Tr(Ha)),Zi.sprite=or(Tr(hl)),Zi.glyphs=or(Tr(Sc)),Zi.light=or(Tr(sl)),Zi.sky=or(Tr(ll)),Zi.terrain=or(Tr(cl)),Zi.layer=or(Tr(ol)),Zi.filter=or(Tr(rl)),Zi.paintProperty=or(Tr(Bo)),Zi.layoutProperty=or(Tr(al));let Sn=Zi,Hh=Sn.light,Wh=Sn.sky,Cc=Sn.paintProperty,Mc=Sn.layoutProperty;function dl(i,t){let r=!1;if(t&&t.length)for(let a of t)i.fire(new Gr(new Error(a.message))),r=!0;return r}class ta{constructor(t,r,a){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(r=d[1])+2*(a=d[2]);for(let g=0;g<this.d*this.d;g++){let v=d[3+g],x=d[3+g+1];l.push(v===x?null:d.subarray(v,x))}let m=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],m),this.bboxes=d.subarray(m),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let d=0;d<this.d*this.d;d++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;let u=a/r*t;this.min=-u,this.max=t+u}insert(t,r,a,l,u){this._forEachCell(r,a,l,u,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(u)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,l,u,d){this.cells[u].push(d)}query(t,r,a,l,u){let d=this.min,m=this.max;if(t<=d&&r<=d&&m<=a&&m<=l&&!u)return Array.prototype.slice.call(this.keys);{let g=[];return this._forEachCell(t,r,a,l,this._queryCell,g,{},u),g}}_queryCell(t,r,a,l,u,d,m,g){let v=this.cells[u];if(v!==null){let x=this.keys,S=this.bboxes;for(let T=0;T<v.length;T++){let E=v[T];if(m[E]===void 0){let A=4*E;(g?g(S[A+0],S[A+1],S[A+2],S[A+3]):t<=S[A+2]&&r<=S[A+3]&&a>=S[A+0]&&l>=S[A+1])?(m[E]=!0,d.push(x[E])):m[E]=!1}}}}_forEachCell(t,r,a,l,u,d,m,g){let v=this._convertToCellCoord(t),x=this._convertToCellCoord(r),S=this._convertToCellCoord(a),T=this._convertToCellCoord(l);for(let E=v;E<=S;E++)for(let A=x;A<=T;A++){let D=this.d*A+E;if((!g||g(this._convertFromCellCoord(E),this._convertFromCellCoord(A),this._convertFromCellCoord(E+1),this._convertFromCellCoord(A+1)))&&u.call(this,t,r,a,l,D,d,m,g))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,r=3+this.cells.length+1+1,a=0;for(let d=0;d<this.cells.length;d++)a+=this.cells[d].length;let l=new Int32Array(r+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let u=r;for(let d=0;d<t.length;d++){let m=t[d];l[3+d]=u,l.set(m,u),u+=m.length}return l[3+t.length]=u,l.set(this.keys,u),u+=this.keys.length,l[3+t.length+1]=u,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer}static serialize(t,r){let a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new ta(t.buffer)}}let Gi={};function Ee(i,t,r={}){if(Gi[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Gi[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Ee("Object",Object),Ee("TransferableGridIndex",ta),Ee("Color",pt),Ee("Error",Error),Ee("AJAXError",zi),Ee("ResolvedImage",Ri),Ee("StylePropertyFunction",Yn),Ee("StyleExpression",Po,{omit:["_evaluator"]}),Ee("ZoomDependentExpression",Jn),Ee("ZoomConstantExpression",Kn),Ee("CompoundExpression",$i,{omit:["_evaluate"]});for(let i in $n)$n[i]._classRegistryKey||Ee(`Expression_${i}`,$n[i]);function qo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function pl(i){return i.$name||i.constructor._classRegistryKey}function Tc(i){return!function(t){if(t===null||typeof t!="object")return!1;let r=pl(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||qo(i)||vr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function ia(i,t){if(Tc(i))return(qo(i)||vr(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){let u=[];for(let d of i)u.push(ia(d,t));return u}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);let r=pl(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Gi[r])throw new Error(`${r} is not registered.`);let{klass:a}=Gi[r],l=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let u in i){if(!i.hasOwnProperty(u)||Gi[r].omit.indexOf(u)>=0)continue;let d=i[u];l[u]=Gi[r].shallow.indexOf(u)>=0?d:ia(d,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function ra(i){if(Tc(i))return i;if(Array.isArray(i))return i.map(ra);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);let t=pl(i)||"Object";if(!Gi[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:r}=Gi[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);let a=Object.create(r.prototype);for(let l of Object.keys(i)){if(l==="$name")continue;let u=i[l];a[l]=Gi[t].shallow.indexOf(l)>=0?u:ra(u)}return a}class ml{constructor(){this.first=!0}update(t,r){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let it={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function fl(i){for(let t of i)if(_l(t.charCodeAt(0)))return!0;return!1}function Xh(i){for(let t of i)if(!na(t.charCodeAt(0)))return!1;return!0}function gl(i){let t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}let Kh=gl(["Arab","Dupl","Mong","Ougr","Syrc"]);function na(i){return!Kh.test(String.fromCodePoint(i))}let kc=gl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function _l(i){return!(i!==746&&i!==747&&(i<4352||!(it["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||it["CJK Compatibility"](i)||it["CJK Strokes"](i)||!(!it["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||it["Enclosed CJK Letters and Months"](i)||it["Ideographic Description Characters"](i)||it.Kanbun(i)||it.Katakana(i)&&i!==12540||!(!it["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!it["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||it["Vertical Forms"](i)||it["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||kc.test(String.fromCodePoint(i)))))}function Ic(i){return!(_l(i)||function(t){return!!(it["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||it["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||it["Letterlike Symbols"](t)||it["Number Forms"](t)||it["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||it["Control Pictures"](t)&&t!==9251||it["Optical Character Recognition"](t)||it["Enclosed Alphanumerics"](t)||it["Geometric Shapes"](t)||it["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||it["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||it["CJK Symbols and Punctuation"](t)||it.Katakana(t)||it["Private Use Area"](t)||it["CJK Compatibility Forms"](t)||it["Small Form Variants"](t)||it["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}let Jh=gl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yl(i){return Jh.test(String.fromCodePoint(i))}function Yh(i,t){return!(!t&&yl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||it.Khmer(i))}function Qh(i){for(let t of i)if(yl(t.charCodeAt(0)))return!0;return!1}let Bi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ct{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ml,this.transition={})}isSupportedScript(t){return function(r,a){for(let l of r)if(!Yh(l.charCodeAt(0),a))return!1;return!0}(t,Bi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class aa{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,l){if(Io(a))return new Yn(a,l);if(Ao(a)){let u=Qs(a,l);if(u.result==="error")throw new Error(u.value.map(d=>`${d.key}: ${d.message}`).join(", "));return u.value}{let u=a;return l.type==="color"&&typeof a=="string"?u=pt.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(u=Ui.parse(a)):u=Li.parse(a),{kind:"constant",evaluate:()=>u}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class No{constructor(t){this.property=t,this.value=new aa(t,void 0)}transitioned(t,r){return new Ec(this.property,this.value,r,Ni({},t.transition,this.transition),t.now)}untransitioned(){return new Ec(this.property,this.value,null,{},0)}}class jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new No(this._values[t].property)),this._values[t].value=new aa(this._values[t].property,r===null?void 0:gt(r))}getTransition(t){return gt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new No(this._values[t].property)),this._values[t].transition=gt(r)||void 0}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a);let l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){let a=new Wa(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,r._values[l]);return a}untransitioned(){let t=new Wa(this._properties);for(let r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Ec{constructor(t,r,a,l,u){this.property=t,this.value=r,this.begin=u+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){let l=t.now||0,u=this.value.possiblyEvaluate(t,r,a),d=this.prior;if(d){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return d.possiblyEvaluate(t,r,a);{let m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,a),u,function(g){if(g<=0)return 0;if(g>=1)return 1;let v=g*g,x=v*g;return 4*(g<.5?x:3*(g-v)+x-.75)}(m))}}return u}}class Wa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){let l=new Ka(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Xa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gt(this._values[t].value)}setValue(t,r){this._values[t]=new aa(this._values[t].property,r===null?void 0:gt(r))}serialize(){let t={};for(let r of Object.keys(this._values)){let a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){let l=new Ka(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(t,r,a);return l}}class kr{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,l){return this.property.evaluate(this.value,this.parameters,t,r,a,l)}}class Ka{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ae{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){let l=xi[this.specification.type];return l?l(t,r,a):t}}class qe{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,l){return new kr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,l)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new kr(this,{kind:"constant",value:void 0},t.parameters);let l=xi[this.specification.type];if(l){let u=l(t.value.value,r.value.value,a);return new kr(this,{kind:"constant",value:u},t.parameters)}return t}evaluate(t,r,a,l,u,d){return t.kind==="constant"?t.value:t.evaluate(r,a,l,u,d)}}class Uo extends qe{possiblyEvaluate(t,r,a,l){if(t.value===void 0)return new kr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l),d=t.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,m=this._calculate(d,d,d,r);return new kr(this,{kind:"constant",value:m},r)}if(t.expression.kind==="camera"){let u=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new kr(this,{kind:"constant",value:u},r)}return new kr(this,t.expression,r)}evaluate(t,r,a,l,u,d){if(t.kind==="source"){let m=t.evaluate(r,a,l,u,d);return this._calculate(m,m,m,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,l),t.evaluate({zoom:Math.floor(r.zoom)},a,l),t.evaluate({zoom:Math.floor(r.zoom)+1},a,l),r):t.value}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class $o{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let u=t.expression.evaluate(r,null,{},a,l);return this._calculate(u,u,u,r)}return this._calculate(t.expression.evaluate(new Ct(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ct(Math.floor(r.zoom),r)),t.expression.evaluate(new Ct(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class vl{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,l){return!!t.expression.evaluate(r,null,{},a,l)}interpolate(){return!1}}class h{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let r in t){let a=t[r];a.specification.overridable&&this.overridableProperties.push(r);let l=this.defaultPropertyValues[r]=new aa(a,void 0),u=this.defaultTransitionablePropertyValues[r]=new No(a);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Ee("DataDrivenProperty",qe),Ee("DataConstantProperty",Ae),Ee("CrossFadedDataDrivenProperty",Uo),Ee("CrossFadedProperty",$o),Ee("ColorRampProperty",vl);let e="-transition";class n extends Fn{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Xa(r.layout)),r.paint)){this._transitionablePaint=new jo(r.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ka(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(Mc,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(Cc,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{let l=this._transitionablePaint._values[t],u=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);let g=this._transitionablePaint._values[t].value;return g.isDataDriven()||d||u||this._handleOverridablePaintPropertyUpdate(t,m,g)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ka(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,l,u={}){return(!u||u.validate!==!1)&&dl(this,t.call(Sn,{key:r,layerType:this.type,objectKey:a,value:l,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let r=this.paint.get(t);if(r instanceof kr&&Hn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class s{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class c{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function f(i,t=1){let r=0,a=0;return{members:i.map(l=>{let u=o[l.type].BYTES_PER_ELEMENT,d=r=_(r,Math.max(t,u)),m=l.components||1;return a=Math.max(a,u),r+=u*m,{name:l.name,type:l.type,components:m,offset:d}}),size:_(r,Math.max(a,t)),alignment:t}}function _(i,t){return Math.ceil(i/t)*t}class y extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.int16[l+0]=r,this.int16[l+1]=a,t}}y.prototype.bytesPerElement=4,Ee("StructArrayLayout2i4",y);class b extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.int16[u+0]=r,this.int16[u+1]=a,this.int16[u+2]=l,t}}b.prototype.bytesPerElement=6,Ee("StructArrayLayout3i6",b);class C extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let d=4*t;return this.int16[d+0]=r,this.int16[d+1]=a,this.int16[d+2]=l,this.int16[d+3]=u,t}}C.prototype.bytesPerElement=8,Ee("StructArrayLayout4i8",C);class M extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=d,this.int16[g+5]=m,t}}M.prototype.bytesPerElement=12,Ee("StructArrayLayout2i4i12",M);class P extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,m){let g=4*t,v=8*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.uint8[v+4]=l,this.uint8[v+5]=u,this.uint8[v+6]=d,this.uint8[v+7]=m,t}}P.prototype.bytesPerElement=8,Ee("StructArrayLayout2i4ub8",P);class L extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.float32[l+0]=r,this.float32[l+1]=a,t}}L.prototype.bytesPerElement=8,Ee("StructArrayLayout2f8",L);class F extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,m,g,v,x){let S=this.length;return this.resize(S+1),this.emplace(S,t,r,a,l,u,d,m,g,v,x)}emplace(t,r,a,l,u,d,m,g,v,x,S){let T=10*t;return this.uint16[T+0]=r,this.uint16[T+1]=a,this.uint16[T+2]=l,this.uint16[T+3]=u,this.uint16[T+4]=d,this.uint16[T+5]=m,this.uint16[T+6]=g,this.uint16[T+7]=v,this.uint16[T+8]=x,this.uint16[T+9]=S,t}}F.prototype.bytesPerElement=20,Ee("StructArrayLayout10ui20",F);class q extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,m,g,v,x,S,T){let E=this.length;return this.resize(E+1),this.emplace(E,t,r,a,l,u,d,m,g,v,x,S,T)}emplace(t,r,a,l,u,d,m,g,v,x,S,T,E){let A=12*t;return this.int16[A+0]=r,this.int16[A+1]=a,this.int16[A+2]=l,this.int16[A+3]=u,this.uint16[A+4]=d,this.uint16[A+5]=m,this.uint16[A+6]=g,this.uint16[A+7]=v,this.int16[A+8]=x,this.int16[A+9]=S,this.int16[A+10]=T,this.int16[A+11]=E,t}}q.prototype.bytesPerElement=24,Ee("StructArrayLayout4i4ui4i24",q);class U extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.float32[u+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}U.prototype.bytesPerElement=12,Ee("StructArrayLayout3f12",U);class $ extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}$.prototype.bytesPerElement=4,Ee("StructArrayLayout1ul4",$);class G extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,m,g,v){let x=this.length;return this.resize(x+1),this.emplace(x,t,r,a,l,u,d,m,g,v)}emplace(t,r,a,l,u,d,m,g,v,x){let S=10*t,T=5*t;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=l,this.int16[S+3]=u,this.int16[S+4]=d,this.int16[S+5]=m,this.uint32[T+3]=g,this.uint16[S+8]=v,this.uint16[S+9]=x,t}}G.prototype.bytesPerElement=20,Ee("StructArrayLayout6i1ul2ui20",G);class B extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,m){let g=6*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=l,this.int16[g+3]=u,this.int16[g+4]=d,this.int16[g+5]=m,t}}B.prototype.bytesPerElement=12,Ee("StructArrayLayout2i2i2i12",B);class K extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u){let d=this.length;return this.resize(d+1),this.emplace(d,t,r,a,l,u)}emplace(t,r,a,l,u,d){let m=4*t,g=8*t;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=l,this.int16[g+6]=u,this.int16[g+7]=d,t}}K.prototype.bytesPerElement=16,Ee("StructArrayLayout2f1f2i16",K);class Q extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d){let m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,l,u,d)}emplace(t,r,a,l,u,d,m){let g=16*t,v=4*t,x=8*t;return this.uint8[g+0]=r,this.uint8[g+1]=a,this.float32[v+1]=l,this.float32[v+2]=u,this.int16[x+6]=d,this.int16[x+7]=m,t}}Q.prototype.bytesPerElement=16,Ee("StructArrayLayout2ub2f2i16",Q);class re extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[u+0]=r,this.uint16[u+1]=a,this.uint16[u+2]=l,t}}re.prototype.bytesPerElement=6,Ee("StructArrayLayout3ui6",re);class ue extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j){let ie=this.length;return this.resize(ie+1),this.emplace(ie,t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j)}emplace(t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j,ie){let W=24*t,ee=12*t,oe=48*t;return this.int16[W+0]=r,this.int16[W+1]=a,this.uint16[W+2]=l,this.uint16[W+3]=u,this.uint32[ee+2]=d,this.uint32[ee+3]=m,this.uint32[ee+4]=g,this.uint16[W+10]=v,this.uint16[W+11]=x,this.uint16[W+12]=S,this.float32[ee+7]=T,this.float32[ee+8]=E,this.uint8[oe+36]=A,this.uint8[oe+37]=D,this.uint8[oe+38]=O,this.uint32[ee+10]=j,this.int16[W+22]=ie,t}}ue.prototype.bytesPerElement=48,Ee("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ue);class me extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j,ie,W,ee,oe,pe,Te,Ve,Ce,we,Le,Pe){let Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j,ie,W,ee,oe,pe,Te,Ve,Ce,we,Le,Pe)}emplace(t,r,a,l,u,d,m,g,v,x,S,T,E,A,D,O,j,ie,W,ee,oe,pe,Te,Ve,Ce,we,Le,Pe,Ie){let he=32*t,Re=16*t;return this.int16[he+0]=r,this.int16[he+1]=a,this.int16[he+2]=l,this.int16[he+3]=u,this.int16[he+4]=d,this.int16[he+5]=m,this.int16[he+6]=g,this.int16[he+7]=v,this.uint16[he+8]=x,this.uint16[he+9]=S,this.uint16[he+10]=T,this.uint16[he+11]=E,this.uint16[he+12]=A,this.uint16[he+13]=D,this.uint16[he+14]=O,this.uint16[he+15]=j,this.uint16[he+16]=ie,this.uint16[he+17]=W,this.uint16[he+18]=ee,this.uint16[he+19]=oe,this.uint16[he+20]=pe,this.uint16[he+21]=Te,this.uint16[he+22]=Ve,this.uint32[Re+12]=Ce,this.float32[Re+13]=we,this.float32[Re+14]=Le,this.uint16[he+30]=Pe,this.uint16[he+31]=Ie,t}}me.prototype.bytesPerElement=64,Ee("StructArrayLayout8i15ui1ul2f2ui64",me);class Se extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Se.prototype.bytesPerElement=4,Ee("StructArrayLayout1f4",Se);class ke extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=3*t;return this.uint16[6*t+0]=r,this.float32[u+1]=a,this.float32[u+2]=l,t}}ke.prototype.bytesPerElement=12,Ee("StructArrayLayout1ui2f12",ke);class ve extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,r,a)}emplace(t,r,a,l){let u=4*t;return this.uint32[2*t+0]=r,this.uint16[u+2]=a,this.uint16[u+3]=l,t}}ve.prototype.bytesPerElement=8,Ee("StructArrayLayout1ul2ui8",ve);class ye extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){let a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){let l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=a,t}}ye.prototype.bytesPerElement=4,Ee("StructArrayLayout2ui4",ye);class ze extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}ze.prototype.bytesPerElement=2,Ee("StructArrayLayout1ui2",ze);class Ze extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,l){let u=this.length;return this.resize(u+1),this.emplace(u,t,r,a,l)}emplace(t,r,a,l,u){let d=4*t;return this.float32[d+0]=r,this.float32[d+1]=a,this.float32[d+2]=l,this.float32[d+3]=u,t}}Ze.prototype.bytesPerElement=16,Ee("StructArrayLayout4f16",Ze);class be extends s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}be.prototype.size=20;class Me extends G{get(t){return new be(this,t)}}Ee("CollisionBoxArray",Me);class Ue extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ue.prototype.size=48;class Mt extends ue{get(t){return new Ue(this,t)}}Ee("PlacedSymbolArray",Mt);class We extends s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}We.prototype.size=64;class tt extends me{get(t){return new We(this,t)}}Ee("SymbolInstanceArray",tt);class Tt extends Se{getoffsetX(t){return this.float32[1*t+0]}}Ee("GlyphOffsetArray",Tt);class ti extends b{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ee("SymbolLineVertexArray",ti);class sr extends s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}sr.prototype.size=12;class kt extends ke{get(t){return new sr(this,t)}}Ee("TextAnchorOffsetArray",kt);class wi extends s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}wi.prototype.size=8;class pi extends ve{get(t){return new wi(this,t)}}Ee("FeatureIndexArray",pi);class ii extends y{}class mi extends y{}class Ir extends y{}class oa extends M{}class Zo extends P{}class sa extends L{}class Hi extends F{}class Go extends q{}class xl extends U{}class Wi extends ${}class Xi extends B{}class Yr extends Q{}class lr extends re{}class Jt extends ye{}let ri=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oi}=ri;class rt{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,l){let u=this.segments[this.segments.length-1];return t>rt.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!u||u.vertexLength+t>rt.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(let t of this.segments)for(let r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,l){return new rt([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function Cn(i,t){return 256*(i=Yi(Math.floor(i),0,255))+Yi(Math.floor(t),0,255)}rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ee("SegmentVector",rt);let la=f([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ca={exports:{}},Pc={exports:{}};Pc.exports=function(i,t){var r,a,l,u,d,m,g,v;for(a=i.length-(r=3&i.length),l=t,d=3432918353,m=461845907,v=0;v<a;)g=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24,++v,l=27492+(65535&(u=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(v+2))<<16;case 2:g^=(255&i.charCodeAt(v+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(v)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*m+(((g>>>16)*m&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var eu=Pc.exports,Ac={exports:{}};Ac.exports=function(i,t){for(var r,a=i.length,l=t^a,u=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(u)|(255&i.charCodeAt(++u))<<8|(255&i.charCodeAt(++u))<<16|(255&i.charCodeAt(++u))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++u;switch(a){case 3:l^=(255&i.charCodeAt(u+2))<<16;case 2:l^=(255&i.charCodeAt(u+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(u)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Qr=eu,zc=Ac.exports;ca.exports=Qr,ca.exports.murmur3=Qr,ca.exports.murmur2=zc;var Ho=Fe(ca.exports);class Ja{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,l){this.ids.push(Wo(t)),this.positions.push(r,a,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let r=Wo(t),a=0,l=this.ids.length-1;for(;a<l;){let d=a+l>>1;this.ids[d]>=r?l=d:a=d+1}let u=[];for(;this.ids[a]===r;)u.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return u}static serialize(t,r){let a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Xo(a,l,0,a.length-1),r&&r.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(t){let r=new Ja;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Wo(i){let t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ho(String(i))}function Xo(i,t,r,a){for(;r<a;){let l=i[r+a>>1],u=r-1,d=a+1;for(;;){do u++;while(i[u]<l);do d--;while(i[d]>l);if(u>=d)break;ha(i,u,d),ha(t,3*u,3*d),ha(t,3*u+1,3*d+1),ha(t,3*u+2,3*d+2)}d-r<a-d?(Xo(i,t,r,d),r=d+1):(Xo(i,t,d+1,a),a=d)}}function ha(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}Ee("FeaturePositionMap",Ja);class Ya{constructor(t,r){this.gl=t.gl,this.location=r}}class Dc extends Ya{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class cd extends Ya{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class hd extends Ya{constructor(t,r){super(t,r),this.current=pt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Km=new Float32Array(16);function tu(i){return[Cn(255*i.r,255*i.g),Cn(255*i.b,255*i.a)]}class bl{constructor(t,r,a){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new hd(t,r):new Dc(t,r)}}class Ko{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,l){let u=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&t.set(u)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new cd(t,r):new Dc(t,r)}}class Mn{constructor(t,r,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,a,l,u){let d=this.paintVertexArray.length,m=this.expression.evaluate(new Ct(0),r,{},l,[],u);this.paintVertexArray.resize(t),this._setPaintValue(d,t,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:0},a,l);this._setPaintValue(t,r,u)}_setPaintValue(t,r,a){if(this.type==="color"){let l=tu(a);for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qr{constructor(t,r,a,l,u,d){this.expression=t,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,a,l,u){let d=this.expression.evaluate(new Ct(this.zoom),r,{},l,[],u),m=this.expression.evaluate(new Ct(this.zoom+1),r,{},l,[],u),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,d,m)}updatePaintArray(t,r,a,l){let u=this.expression.evaluate({zoom:this.zoom},a,l),d=this.expression.evaluate({zoom:this.zoom+1},a,l);this._setPaintValue(t,r,u,d)}_setPaintValue(t,r,a,l){if(this.type==="color"){let u=tu(a),d=tu(l);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1],d[0],d[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){let a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Yi(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,a){return new Dc(t,r)}}class ua{constructor(t,r,a,l,u,d){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=l,this.layerId=d,this.zoomInPaintVertexArray=new u,this.zoomOutPaintVertexArray=new u}populatePaintArray(t,r,a){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,l,u){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],u)}_setPaintValues(t,r,a,l){if(!l||!a)return;let{min:u,mid:d,max:m}=a,g=l[u],v=l[d],x=l[m];if(g&&v&&x)for(let S=t;S<r;S++)this.zoomInPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],v.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(S,v.tl[0],v.tl[1],v.br[0],v.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],v.pixelRatio,x.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,la.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,la.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ud{constructor(t,r,a){this.binders={},this._buffers=[];let l=[];for(let u in t.paint._values){if(!a(u))continue;let d=t.paint.get(u);if(!(d instanceof kr&&Hn(d.property.specification)))continue;let m=Jm(u,t.type),g=d.value,v=d.property.specification.type,x=d.property.useIntegerZoom,S=d.property.specification["property-type"],T=S==="cross-faded"||S==="cross-faded-data-driven";if(g.kind==="constant")this.binders[u]=T?new Ko(g.value,m):new bl(g.value,m,v),l.push(`/u_${u}`);else if(g.kind==="source"||T){let E=dd(u,v,"source");this.binders[u]=T?new ua(g,v,x,r,E,t.id):new Mn(g,m,v,E),l.push(`/a_${u}`)}else{let E=dd(u,v,"composite");this.binders[u]=new qr(g,m,v,x,r,E),l.push(`/z_${u}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let r=this.binders[t];return r instanceof Mn||r instanceof qr?r.maxValue:0}populatePaintArrays(t,r,a,l,u){for(let d in this.binders){let m=this.binders[d];(m instanceof Mn||m instanceof qr||m instanceof ua)&&m.populatePaintArray(t,r,a,l,u)}}setConstantPatternPositions(t,r){for(let a in this.binders){let l=this.binders[a];l instanceof Ko&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,l,u){let d=!1;for(let m in t){let g=r.getPositions(m);for(let v of g){let x=a.feature(v.index);for(let S in this.binders){let T=this.binders[S];if((T instanceof Mn||T instanceof qr||T instanceof ua)&&T.expression.isStateDependent===!0){let E=l.paint.get(S);T.expression=E.value,T.updatePaintArray(v.start,v.end,x,t[m],u),d=!0}}}}return d}defines(){let t=[];for(let r in this.binders){let a=this.binders[r];(a instanceof bl||a instanceof Ko)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof Mn||a instanceof qr)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name);else if(a instanceof ua)for(let l=0;l<la.members.length;l++)t.push(la.members[l].name)}return t}getBinderUniforms(){let t=[];for(let r in this.binders){let a=this.binders[r];if(a instanceof bl||a instanceof Ko||a instanceof qr)for(let l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){let a=[];for(let l in this.binders){let u=this.binders[l];if(u instanceof bl||u instanceof Ko||u instanceof qr){for(let d of u.uniformNames)if(r[d]){let m=u.getBinding(t,r[d],d);a.push({name:d,property:l,binding:m})}}}return a}setUniforms(t,r,a,l){for(let{name:u,property:d,binding:m}of r)this.binders[d].setUniform(m,l,a.get(d),u)}updatePaintBuffers(t){this._buffers=[];for(let r in this.binders){let a=this.binders[r];if(t&&a instanceof ua){let l=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof Mn||a instanceof qr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let r in this.binders){let a=this.binders[r];(a instanceof Mn||a instanceof qr||a instanceof ua)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let r=this.binders[t];(r instanceof Mn||r instanceof qr||r instanceof ua)&&r.destroy()}}}class Qa{constructor(t,r,a=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new ud(l,r,a);this.needsUpload=!1,this._featureMap=new Ja,this._bufferOffset=0}populatePaintArrays(t,r,a,l,u,d){for(let m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,l,u,d);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,l){for(let u of a)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(t,this._featureMap,r,u,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Jm(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function dd(i,t,r){let a={color:{source:L,composite:Ze},number:{source:Se,composite:L}},l=function(u){return{"line-pattern":{source:Hi,composite:Hi},"fill-pattern":{source:Hi,composite:Hi},"fill-extrusion-pattern":{source:Hi,composite:Hi}}[u]}(i);return l&&l[r]||a[t][r]}Ee("ConstantBinder",bl),Ee("CrossFadedConstantBinder",Ko),Ee("SourceExpressionBinder",Mn),Ee("CrossFadedCompositeBinder",ua),Ee("CompositeExpressionBinder",qr),Ee("ProgramConfiguration",ud,{omit:["_buffers"]}),Ee("ProgramConfigurationSet",Qa);let jt=8192,iu=Math.pow(2,14)-1,pd=-iu-1;function eo(i){let t=jt/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){let l=r[a];for(let u=0;u<l.length;u++){let d=l[u],m=Math.round(d.x*t),g=Math.round(d.y*t);d.x=Yi(m,pd,iu),d.y=Yi(g,pd,iu),(m<d.x||m>d.x+1||g<d.y||g>d.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function to(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?eo(i):[]}}function Lc(i,t,r,a,l){i.emplaceBack(2*t+(a+1)/2,2*r+(l+1)/2)}class ru{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new mi,this.indexArray=new lr,this.segments=new rt,this.programConfigurations=new Qa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){let l=this.layers[0],u=[],d=null,m=!1;l.type==="circle"&&(d=l.layout.get("circle-sort-key"),m=!d.isConstant());for(let{feature:g,id:v,index:x,sourceLayerIndex:S}of t){let T=this.layers[0]._featureFilter.needGeometry,E=to(g,T);if(!this.layers[0]._featureFilter.filter(new Ct(this.zoom),E,a))continue;let A=m?d.evaluate(E,{},a):void 0,D={id:v,properties:g.properties,type:g.type,sourceLayerIndex:S,index:x,geometry:T?E.geometry:eo(g),patterns:{},sortKey:A};u.push(D)}m&&u.sort((g,v)=>g.sortKey-v.sortKey);for(let g of u){let{geometry:v,index:x,sourceLayerIndex:S}=g,T=t[x].feature;this.addFeature(g,v,x,a),r.featureIndex.insert(T,v,x,S,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,l){for(let u of r)for(let d of u){let m=d.x,g=d.y;if(m<0||m>=jt||g<0||g>=jt)continue;let v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=v.vertexLength;Lc(this.layoutVertexArray,m,g,-1,-1),Lc(this.layoutVertexArray,m,g,1,-1),Lc(this.layoutVertexArray,m,g,1,1),Lc(this.layoutVertexArray,m,g,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+3,x+2),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l)}}function md(i,t){for(let r=0;r<i.length;r++)if(Jo(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Jo(i,t[r]))return!0;return!!nu(i,t)}function Ym(i,t,r){return!!Jo(i,t)||!!au(t,i,r)}function fd(i,t){if(i.length===1)return _d(t,i[0]);for(let r=0;r<t.length;r++){let a=t[r];for(let l=0;l<a.length;l++)if(Jo(i,a[l]))return!0}for(let r=0;r<i.length;r++)if(_d(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(nu(i,t[r]))return!0;return!1}function Qm(i,t,r){if(i.length>1){if(nu(i,t))return!0;for(let a=0;a<t.length;a++)if(au(t[a],i,r))return!0}for(let a=0;a<i.length;a++)if(au(i[a],t,r))return!0;return!1}function nu(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){let a=i[r],l=i[r+1];for(let u=0;u<t.length-1;u++)if(ef(a,l,t[u],t[u+1]))return!0}return!1}function ef(i,t,r,a){return hi(i,r,a)!==hi(t,r,a)&&hi(i,t,r)!==hi(i,t,a)}function au(i,t,r){let a=r*r;if(t.length===1)return i.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(gd(i,t[l-1],t[l])<a)return!0;return!1}function gd(i,t,r){let a=t.distSqr(r);if(a===0)return i.distSqr(t);let l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/a;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function _d(i,t){let r,a,l,u=!1;for(let d=0;d<i.length;d++){r=i[d];for(let m=0,g=r.length-1;m<r.length;g=m++)a=r[m],l=r[g],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(u=!u)}return u}function Jo(i,t){let r=!1;for(let a=0,l=i.length-1;a<i.length;l=a++){let u=i[a],d=i[l];u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(r=!r)}return r}function tf(i,t,r){let a=r[0],l=r[2];if(i.x<a.x&&t.x<a.x||i.x>l.x&&t.x>l.x||i.y<a.y&&t.y<a.y||i.y>l.y&&t.y>l.y)return!1;let u=hi(i,t,r[0]);return u!==hi(i,t,r[1])||u!==hi(i,t,r[2])||u!==hi(i,t,r[3])}function wl(i,t,r){let a=t.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Rc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Fc(i,t,r,a,l){if(!t[0]&&!t[1])return i;let u=ge.convert(t)._mult(l);r==="viewport"&&u._rotate(-a);let d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(u));return d}let yd,vd;Ee("CircleBucket",ru,{omit:["layers"]});var rf={get paint(){return vd=vd||new h({"circle-radius":new qe(ae.paint_circle["circle-radius"]),"circle-color":new qe(ae.paint_circle["circle-color"]),"circle-blur":new qe(ae.paint_circle["circle-blur"]),"circle-opacity":new qe(ae.paint_circle["circle-opacity"]),"circle-translate":new Ae(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new Ae(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ae(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ae(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qe(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qe(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qe(ae.paint_circle["circle-stroke-opacity"])})},get layout(){return yd=yd||new h({"circle-sort-key":new qe(ae.layout_circle["circle-sort-key"])})}},Si=1e-6,Yo=typeof Float32Array<"u"?Float32Array:Array;function ou(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function xd(i,t,r){var a=t[0],l=t[1],u=t[2],d=t[3],m=t[4],g=t[5],v=t[6],x=t[7],S=t[8],T=t[9],E=t[10],A=t[11],D=t[12],O=t[13],j=t[14],ie=t[15],W=r[0],ee=r[1],oe=r[2],pe=r[3];return i[0]=W*a+ee*m+oe*S+pe*D,i[1]=W*l+ee*g+oe*T+pe*O,i[2]=W*u+ee*v+oe*E+pe*j,i[3]=W*d+ee*x+oe*A+pe*ie,i[4]=(W=r[4])*a+(ee=r[5])*m+(oe=r[6])*S+(pe=r[7])*D,i[5]=W*l+ee*g+oe*T+pe*O,i[6]=W*u+ee*v+oe*E+pe*j,i[7]=W*d+ee*x+oe*A+pe*ie,i[8]=(W=r[8])*a+(ee=r[9])*m+(oe=r[10])*S+(pe=r[11])*D,i[9]=W*l+ee*g+oe*T+pe*O,i[10]=W*u+ee*v+oe*E+pe*j,i[11]=W*d+ee*x+oe*A+pe*ie,i[12]=(W=r[12])*a+(ee=r[13])*m+(oe=r[14])*S+(pe=r[15])*D,i[13]=W*l+ee*g+oe*T+pe*O,i[14]=W*u+ee*v+oe*E+pe*j,i[15]=W*d+ee*x+oe*A+pe*ie,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Sl,nf=xd;function Bc(i,t,r){var a=t[0],l=t[1],u=t[2],d=t[3];return i[0]=r[0]*a+r[4]*l+r[8]*u+r[12]*d,i[1]=r[1]*a+r[5]*l+r[9]*u+r[13]*d,i[2]=r[2]*a+r[6]*l+r[10]*u+r[14]*d,i[3]=r[3]*a+r[7]*l+r[11]*u+r[15]*d,i}Sl=new Yo(4),Yo!=Float32Array&&(Sl[0]=0,Sl[1]=0,Sl[2]=0,Sl[3]=0);class af extends n{constructor(t){super(t,rf)}createBucket(t){return new ru(t)}queryRadius(t){let r=t;return wl("circle-radius",this,r)+wl("circle-stroke-width",this,r)+Rc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,a,l,u,d,m,g){let v=Fc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,m),x=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),S=this.paint.get("circle-pitch-alignment")==="map",T=S?v:function(A,D){return A.map(O=>bd(O,D))}(v,g),E=S?x*m:x;for(let A of l)for(let D of A){let O=S?D:bd(D,g),j=E,ie=Bc([],[D.x,D.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?j*=ie[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(j*=d.cameraToCenterDistance/ie[3]),Ym(T,O,j))return!0}return!1}}function bd(i,t){let r=Bc([],[i.x,i.y,0,1],t);return new ge(r[0]/r[3],r[1]/r[3])}class wd extends ru{}let Sd;Ee("HeatmapBucket",wd,{omit:["layers"]});var of={get paint(){return Sd=Sd||new h({"heatmap-radius":new qe(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qe(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ae(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vl(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ae(ae.paint_heatmap["heatmap-opacity"])})}};function su(i,{width:t,height:r},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*a}`)}else l=new Uint8Array(t*r*a);return i.width=t,i.height=r,i.data=l,i}function Cd(i,{width:t,height:r},a){if(t===i.width&&r===i.height)return;let l=su({},{width:t,height:r},a);lu(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},a),i.width=t,i.height=r,i.data=l.data}function lu(i,t,r,a,l,u){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let d=i.data,m=t.data;if(d===m)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){let v=((r.y+g)*i.width+r.x)*u,x=((a.y+g)*t.width+a.x)*u;for(let S=0;S<l.width*u;S++)m[x+S]=d[v+S]}return t}class Cl{constructor(t,r){su(this,t,1,r)}resize(t){Cd(this,t,1)}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){lu(t,r,a,l,u,1)}}class cr{constructor(t,r){su(this,t,4,r)}resize(t){Cd(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,l,u){lu(t,r,a,l,u,4)}}function Md(i){let t={},r=i.resolution||256,a=i.clips?i.clips.length:1,l=i.image||new cr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);let u=(d,m,g)=>{t[i.evaluationKey]=g;let v=i.expression.evaluate(t);l.data[d+m+0]=Math.floor(255*v.r/v.a),l.data[d+m+1]=Math.floor(255*v.g/v.a),l.data[d+m+2]=Math.floor(255*v.b/v.a),l.data[d+m+3]=Math.floor(255*v.a)};if(i.clips)for(let d=0,m=0;d<a;++d,m+=4*r)for(let g=0,v=0;g<r;g++,v+=4){let x=g/(r-1),{start:S,end:T}=i.clips[d];u(m,v,S*(1-x)+T*x)}else for(let d=0,m=0;d<r;d++,m+=4)u(0,m,d/(r-1));return l}Ee("AlphaImage",Cl),Ee("RGBAImage",cr);let cu="big-fb";class sf extends n{createBucket(t){return new wd(t)}constructor(t){super(t,of),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Md({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(cu)&&this.heatmapFbos.delete(cu)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Td;var lf={get paint(){return Td=Td||new h({"hillshade-illumination-direction":new Ae(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ae(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ae(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ae(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ae(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ae(ae.paint_hillshade["hillshade-accent-color"])})}};class cf extends n{constructor(t){super(t,lf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let hf=f([{name:"a_pos",components:2,type:"Int16"}],4),{members:uf}=hf;function kd(i,t,r=2){let a=t&&t.length,l=a?t[0]*r:i.length,u=Id(i,0,l,r,!0),d=[];if(!u||u.next===u.prev)return d;let m,g,v;if(a&&(u=function(x,S,T,E){let A=[];for(let D=0,O=S.length;D<O;D++){let j=Id(x,S[D]*E,D<O-1?S[D+1]*E:x.length,E,!1);j===j.next&&(j.steiner=!0),A.push(vf(j))}A.sort(gf);for(let D=0;D<A.length;D++)T=_f(A[D],T);return T}(i,t,u,r)),i.length>80*r){m=1/0,g=1/0;let x=-1/0,S=-1/0;for(let T=r;T<l;T+=r){let E=i[T],A=i[T+1];E<m&&(m=E),A<g&&(g=A),E>x&&(x=E),A>S&&(S=A)}v=Math.max(x-m,S-g),v=v!==0?32767/v:0}return Ml(u,d,r,m,g,v,0),d}function Id(i,t,r,a,l){let u;if(l===function(d,m,g,v){let x=0;for(let S=m,T=g-v;S<g;S+=v)x+=(d[T]-d[S])*(d[S+1]+d[T+1]),T=S;return x}(i,t,r,a)>0)for(let d=t;d<r;d+=a)u=Ad(d/a|0,i[d],i[d+1],u);else for(let d=r-a;d>=t;d-=a)u=Ad(d/a|0,i[d],i[d+1],u);return u&&Oc(u,u.next)&&(kl(u),u=u.next),u}function io(i,t){if(!i)return i;t||(t=i);let r,a=i;do if(r=!1,a.steiner||!Oc(a,a.next)&&Vt(a.prev,a,a.next)!==0)a=a.next;else{if(kl(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function Ml(i,t,r,a,l,u,d){if(!i)return;!d&&u&&function(g,v,x,S){let T=g;do T.z===0&&(T.z=hu(T.x,T.y,v,x,S)),T.prevZ=T.prev,T.nextZ=T.next,T=T.next;while(T!==g);T.prevZ.nextZ=null,T.prevZ=null,function(E){let A,D=1;do{let O,j=E;E=null;let ie=null;for(A=0;j;){A++;let W=j,ee=0;for(let pe=0;pe<D&&(ee++,W=W.nextZ,W);pe++);let oe=D;for(;ee>0||oe>0&&W;)ee!==0&&(oe===0||!W||j.z<=W.z)?(O=j,j=j.nextZ,ee--):(O=W,W=W.nextZ,oe--),ie?ie.nextZ=O:E=O,O.prevZ=ie,ie=O;j=W}ie.nextZ=null,D*=2}while(A>1)}(T)}(i,a,l,u);let m=i;for(;i.prev!==i.next;){let g=i.prev,v=i.next;if(u?pf(i,a,l,u):df(i))t.push(g.i,i.i,v.i),kl(i),i=v.next,m=v.next;else if((i=v)===m){d?d===1?Ml(i=mf(io(i),t),t,r,a,l,u,2):d===2&&ff(i,t,r,a,l,u):Ml(io(i),t,r,a,l,u,1);break}}}function df(i){let t=i.prev,r=i,a=i.next;if(Vt(t,r,a)>=0)return!1;let l=t.x,u=r.x,d=a.x,m=t.y,g=r.y,v=a.y,x=l<u?l<d?l:d:u<d?u:d,S=m<g?m<v?m:v:g<v?g:v,T=l>u?l>d?l:d:u>d?u:d,E=m>g?m>v?m:v:g>v?g:v,A=a.next;for(;A!==t;){if(A.x>=x&&A.x<=T&&A.y>=S&&A.y<=E&&Qo(l,m,u,g,d,v,A.x,A.y)&&Vt(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function pf(i,t,r,a){let l=i.prev,u=i,d=i.next;if(Vt(l,u,d)>=0)return!1;let m=l.x,g=u.x,v=d.x,x=l.y,S=u.y,T=d.y,E=m<g?m<v?m:v:g<v?g:v,A=x<S?x<T?x:T:S<T?S:T,D=m>g?m>v?m:v:g>v?g:v,O=x>S?x>T?x:T:S>T?S:T,j=hu(E,A,t,r,a),ie=hu(D,O,t,r,a),W=i.prevZ,ee=i.nextZ;for(;W&&W.z>=j&&ee&&ee.z<=ie;){if(W.x>=E&&W.x<=D&&W.y>=A&&W.y<=O&&W!==l&&W!==d&&Qo(m,x,g,S,v,T,W.x,W.y)&&Vt(W.prev,W,W.next)>=0||(W=W.prevZ,ee.x>=E&&ee.x<=D&&ee.y>=A&&ee.y<=O&&ee!==l&&ee!==d&&Qo(m,x,g,S,v,T,ee.x,ee.y)&&Vt(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;W&&W.z>=j;){if(W.x>=E&&W.x<=D&&W.y>=A&&W.y<=O&&W!==l&&W!==d&&Qo(m,x,g,S,v,T,W.x,W.y)&&Vt(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ee&&ee.z<=ie;){if(ee.x>=E&&ee.x<=D&&ee.y>=A&&ee.y<=O&&ee!==l&&ee!==d&&Qo(m,x,g,S,v,T,ee.x,ee.y)&&Vt(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function mf(i,t){let r=i;do{let a=r.prev,l=r.next.next;!Oc(a,l)&&Ed(a,r,r.next,l)&&Tl(a,l)&&Tl(l,a)&&(t.push(a.i,r.i,l.i),kl(r),kl(r.next),r=i=l),r=r.next}while(r!==i);return io(r)}function ff(i,t,r,a,l,u){let d=i;do{let m=d.next.next;for(;m!==d.prev;){if(d.i!==m.i&&xf(d,m)){let g=Pd(d,m);return d=io(d,d.next),g=io(g,g.next),Ml(d,t,r,a,l,u,0),void Ml(g,t,r,a,l,u,0)}m=m.next}d=d.next}while(d!==i)}function gf(i,t){return i.x-t.x}function _f(i,t){let r=function(l,u){let d=u,m=l.x,g=l.y,v,x=-1/0;do{if(g<=d.y&&g>=d.next.y&&d.next.y!==d.y){let D=d.x+(g-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(D<=m&&D>x&&(x=D,v=d.x<d.next.x?d:d.next,D===m))return v}d=d.next}while(d!==u);if(!v)return null;let S=v,T=v.x,E=v.y,A=1/0;d=v;do{if(m>=d.x&&d.x>=T&&m!==d.x&&Qo(g<E?m:x,g,T,E,g<E?x:m,g,d.x,d.y)){let D=Math.abs(g-d.y)/(m-d.x);Tl(d,l)&&(D<A||D===A&&(d.x>v.x||d.x===v.x&&yf(v,d)))&&(v=d,A=D)}d=d.next}while(d!==S);return v}(i,t);if(!r)return t;let a=Pd(r,i);return io(a,a.next),io(r,r.next)}function yf(i,t){return Vt(i.prev,i,t.prev)<0&&Vt(t.next,i,i.next)<0}function hu(i,t,r,a,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function vf(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Qo(i,t,r,a,l,u,d,m){return(l-d)*(t-m)>=(i-d)*(u-m)&&(i-d)*(a-m)>=(r-d)*(t-m)&&(r-d)*(u-m)>=(l-d)*(a-m)}function xf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,a){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==a.i&&l.next.i!==a.i&&Ed(l,l.next,r,a))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(Tl(i,t)&&Tl(t,i)&&function(r,a){let l=r,u=!1,d=(r.x+a.x)/2,m=(r.y+a.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&d<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(i,t)&&(Vt(i.prev,i,t.prev)||Vt(i,t.prev,t))||Oc(i,t)&&Vt(i.prev,i,i.next)>0&&Vt(t.prev,t,t.next)>0)}function Vt(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Oc(i,t){return i.x===t.x&&i.y===t.y}function Ed(i,t,r,a){let l=qc(Vt(i,t,r)),u=qc(Vt(i,t,a)),d=qc(Vt(r,a,i)),m=qc(Vt(r,a,t));return l!==u&&d!==m||!(l!==0||!Vc(i,r,t))||!(u!==0||!Vc(i,a,t))||!(d!==0||!Vc(r,i,a))||!(m!==0||!Vc(r,t,a))}function Vc(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function qc(i){return i>0?1:i<0?-1:0}function Tl(i,t){return Vt(i.prev,i,i.next)<0?Vt(i,t,i.next)>=0&&Vt(i,i.prev,t)>=0:Vt(i,t,i.prev)<0||Vt(i,i.next,t)<0}function Pd(i,t){let r=uu(i.i,i.x,i.y),a=uu(t.i,t.x,t.y),l=i.next,u=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,a.next=r,r.prev=a,u.next=a,a.prev=u,a}function Ad(i,t,r,a){let l=uu(i,t,r);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function kl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function uu(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function du(i,t,r){let a=r.patternDependencies,l=!1;for(let u of t){let d=u.paint.get(`${i}-pattern`);d.isConstant()||(l=!0);let m=d.constantOr(null);m&&(l=!0,a[m.to]=!0,a[m.from]=!0)}return l}function pu(i,t,r,a,l){let u=l.patternDependencies;for(let d of t){let m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:a-1},r,{},l.availableImages),v=m.evaluate({zoom:a},r,{},l.availableImages),x=m.evaluate({zoom:a+1},r,{},l.availableImages);g=g&&g.name?g.name:g,v=v&&v.name?v.name:v,x=x&&x.name?x.name:x,u[g]=!0,u[v]=!0,u[x]=!0,r.patterns[d.id]={min:g,mid:v,max:x}}}return r}class mu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ir,this.indexArray=new lr,this.indexArray2=new Jt,this.programConfigurations=new Qa(t.layers,t.zoom),this.segments=new rt,this.segments2=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=du("fill",this.layers,r);let l=this.layers[0].layout.get("fill-sort-key"),u=!l.isConstant(),d=[];for(let{feature:m,id:g,index:v,sourceLayerIndex:x}of t){let S=this.layers[0]._featureFilter.needGeometry,T=to(m,S);if(!this.layers[0]._featureFilter.filter(new Ct(this.zoom),T,a))continue;let E=u?l.evaluate(T,{},a,r.availableImages):void 0,A={id:g,properties:m.properties,type:m.type,sourceLayerIndex:x,index:v,geometry:S?T.geometry:eo(m),patterns:{},sortKey:E};d.push(A)}u&&d.sort((m,g)=>m.sortKey-g.sortKey);for(let m of d){let{geometry:g,index:v,sourceLayerIndex:x}=m;if(this.hasPattern){let S=pu("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,g,v,a,{});r.featureIndex.insert(t[v].feature,g,v,x,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,uf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,l,u){for(let d of So(r,500)){let m=0;for(let E of d)m+=E.length;let g=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),v=g.vertexLength,x=[],S=[];for(let E of d){if(E.length===0)continue;E!==d[0]&&S.push(x.length/2);let A=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),D=A.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(D+E.length-1,D),x.push(E[0].x),x.push(E[0].y);for(let O=1;O<E.length;O++)this.layoutVertexArray.emplaceBack(E[O].x,E[O].y),this.indexArray2.emplaceBack(D+O-1,D+O),x.push(E[O].x),x.push(E[O].y);A.vertexLength+=E.length,A.primitiveLength+=E.length}let T=kd(x,S);for(let E=0;E<T.length;E+=3)this.indexArray.emplaceBack(v+T[E],v+T[E+1],v+T[E+2]);g.vertexLength+=m,g.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}let zd,Dd;Ee("FillBucket",mu,{omit:["layers","patternFeatures"]});var bf={get paint(){return Dd=Dd||new h({"fill-antialias":new Ae(ae.paint_fill["fill-antialias"]),"fill-opacity":new qe(ae.paint_fill["fill-opacity"]),"fill-color":new qe(ae.paint_fill["fill-color"]),"fill-outline-color":new qe(ae.paint_fill["fill-outline-color"]),"fill-translate":new Ae(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new Ae(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uo(ae.paint_fill["fill-pattern"])})},get layout(){return zd=zd||new h({"fill-sort-key":new qe(ae.layout_fill["fill-sort-key"])})}};class wf extends n{constructor(t){super(t,bf)}recalculate(t,r){super.recalculate(t,r);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new mu(t)}queryRadius(){return Rc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,a,l,u,d,m){return fd(Fc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,m),l)}isTileClipped(){return!0}}let Sf=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Cf=f([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Mf}=Sf;var da={},Tf=Pt,Ld=es;function es(i,t,r,a,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=l,i.readFields(kf,this,t)}function kf(i,t,r){i==1?t.id=r.readVarint():i==2?function(a,l){for(var u=a.readVarint()+a.pos;a.pos<u;){var d=l._keys[a.readVarint()],m=l._values[a.readVarint()];l.properties[d]=m}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function If(i){for(var t,r,a=0,l=0,u=i.length,d=u-1;l<u;d=l++)a+=((r=i[d]).x-(t=i[l]).x)*(t.y+r.y);return a}es.types=["Unknown","Point","LineString","Polygon"],es.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,a=1,l=0,u=0,d=0,m=[];i.pos<r;){if(l<=0){var g=i.readVarint();a=7&g,l=g>>3}if(l--,a===1||a===2)u+=i.readSVarint(),d+=i.readSVarint(),a===1&&(t&&m.push(t),t=[]),t.push(new Tf(u,d));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&m.push(t),m},es.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,a=0,l=0,u=0,d=1/0,m=-1/0,g=1/0,v=-1/0;i.pos<t;){if(a<=0){var x=i.readVarint();r=7&x,a=x>>3}if(a--,r===1||r===2)(l+=i.readSVarint())<d&&(d=l),l>m&&(m=l),(u+=i.readSVarint())<g&&(g=u),u>v&&(v=u);else if(r!==7)throw new Error("unknown command "+r)}return[d,g,m,v]},es.prototype.toGeoJSON=function(i,t,r){var a,l,u=this.extent*Math.pow(2,r),d=this.extent*i,m=this.extent*t,g=this.loadGeometry(),v=es.types[this.type];function x(E){for(var A=0;A<E.length;A++){var D=E[A];E[A]=[360*(D.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(D.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(a=0;a<g.length;a++)S[a]=g[a][0];x(g=S);break;case 2:for(a=0;a<g.length;a++)x(g[a]);break;case 3:for(g=function(E){var A=E.length;if(A<=1)return[E];for(var D,O,j=[],ie=0;ie<A;ie++){var W=If(E[ie]);W!==0&&(O===void 0&&(O=W<0),O===W<0?(D&&j.push(D),D=[E[ie]]):D.push(E[ie]))}return D&&j.push(D),j}(g),a=0;a<g.length;a++)for(l=0;l<g[a].length;l++)x(g[a][l])}g.length===1?g=g[0]:v="Multi"+v;var T={type:"Feature",geometry:{type:v,coordinates:g},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Ef=Ld,Rd=Fd;function Fd(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Pf,this,t),this.length=this._features.length}function Pf(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(a){for(var l=null,u=a.readVarint()+a.pos;a.pos<u;){var d=a.readVarint()>>3;l=d===1?a.readString():d===2?a.readFloat():d===3?a.readDouble():d===4?a.readVarint64():d===5?a.readVarint():d===6?a.readSVarint():d===7?a.readBoolean():null}return l}(r))}Fd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Ef(this._pbf,t,this.extent,this._keys,this._values)};var Af=Rd;function zf(i,t,r){if(i===3){var a=new Af(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}da.VectorTile=function(i,t){this.layers=i.readFields(zf,{},t)},da.VectorTileFeature=Ld,da.VectorTileLayer=Rd;let Df=da.VectorTileFeature.types,fu=Math.pow(2,13);function Il(i,t,r,a,l,u,d,m){i.emplaceBack(t,r,2*Math.floor(a*fu)+d,l*fu*2,u*fu*2,Math.round(m))}class gu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new oa,this.centroidVertexArray=new ii,this.indexArray=new lr,this.programConfigurations=new Qa(t.layers,t.zoom),this.segments=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.features=[],this.hasPattern=du("fill-extrusion",this.layers,r);for(let{feature:l,id:u,index:d,sourceLayerIndex:m}of t){let g=this.layers[0]._featureFilter.needGeometry,v=to(l,g);if(!this.layers[0]._featureFilter.filter(new Ct(this.zoom),v,a))continue;let x={id:u,sourceLayerIndex:m,index:d,geometry:g?v.geometry:eo(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(pu("fill-extrusion",this.layers,x,this.zoom,r)):this.addFeature(x,x.geometry,d,a,{}),r.featureIndex.insert(l,x.geometry,d,m,this.index,!0)}}addFeatures(t,r,a){for(let l of this.features){let{geometry:u}=l;this.addFeature(l,u,l.index,r,a)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Cf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,l,u){for(let d of So(r,500)){let m={x:0,y:0,vertexCount:0},g=0;for(let A of d)g+=A.length;let v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let A of d){if(A.length===0||Rf(A))continue;let D=0;for(let O=0;O<A.length;O++){let j=A[O];if(O>=1){let ie=A[O-1];if(!Lf(j,ie)){v.vertexLength+4>rt.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let W=j.sub(ie)._perp()._unit(),ee=ie.dist(j);D+ee>32768&&(D=0),Il(this.layoutVertexArray,j.x,j.y,W.x,W.y,0,0,D),Il(this.layoutVertexArray,j.x,j.y,W.x,W.y,0,1,D),m.x+=2*j.x,m.y+=2*j.y,m.vertexCount+=2,D+=ee,Il(this.layoutVertexArray,ie.x,ie.y,W.x,W.y,0,0,D),Il(this.layoutVertexArray,ie.x,ie.y,W.x,W.y,0,1,D),m.x+=2*ie.x,m.y+=2*ie.y,m.vertexCount+=2;let oe=v.vertexLength;this.indexArray.emplaceBack(oe,oe+2,oe+1),this.indexArray.emplaceBack(oe+1,oe+2,oe+3),v.vertexLength+=4,v.primitiveLength+=2}}}}if(v.vertexLength+g>rt.MAX_VERTEX_ARRAY_LENGTH&&(v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),Df[t.type]!=="Polygon")continue;let x=[],S=[],T=v.vertexLength;for(let A of d)if(A.length!==0){A!==d[0]&&S.push(x.length/2);for(let D=0;D<A.length;D++){let O=A[D];Il(this.layoutVertexArray,O.x,O.y,0,0,1,1,0),m.x+=O.x,m.y+=O.y,m.vertexCount+=1,x.push(O.x),x.push(O.y)}}let E=kd(x,S);for(let A=0;A<E.length;A+=3)this.indexArray.emplaceBack(T+E[A],T+E[A+2],T+E[A+1]);v.primitiveLength+=E.length/3,v.vertexLength+=g;for(let A=0;A<m.vertexCount;A++){let D=Math.floor(m.x/m.vertexCount),O=Math.floor(m.y/m.vertexCount);this.centroidVertexArray.emplaceBack(D,O)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}}function Lf(i,t){return i.x===t.x&&(i.x<0||i.x>jt)||i.y===t.y&&(i.y<0||i.y>jt)}function Rf(i){return i.every(t=>t.x<0)||i.every(t=>t.x>jt)||i.every(t=>t.y<0)||i.every(t=>t.y>jt)}let Bd;Ee("FillExtrusionBucket",gu,{omit:["layers","features"]});var Ff={get paint(){return Bd=Bd||new h({"fill-extrusion-opacity":new Ae(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qe(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ae(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ae(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uo(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qe(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qe(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ae(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Bf extends n{constructor(t){super(t,Ff)}createBucket(t){return new gu(t)}queryRadius(){return Rc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,a,l,u,d,m,g){let v=Fc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,m),x=this.paint.get("fill-extrusion-height").evaluate(r,a),S=this.paint.get("fill-extrusion-base").evaluate(r,a),T=function(A,D,O,j){let ie=[];for(let W of A){let ee=[W.x,W.y,0,1];Bc(ee,ee,D),ie.push(new ge(ee[0]/ee[3],ee[1]/ee[3]))}return ie}(v,g),E=function(A,D,O,j){let ie=[],W=[],ee=j[8]*D,oe=j[9]*D,pe=j[10]*D,Te=j[11]*D,Ve=j[8]*O,Ce=j[9]*O,we=j[10]*O,Le=j[11]*O;for(let Pe of A){let Ie=[],he=[];for(let Re of Pe){let De=Re.x,$e=Re.y,xt=j[0]*De+j[4]*$e+j[12],vt=j[1]*De+j[5]*$e+j[13],Zt=j[2]*De+j[6]*$e+j[14],Er=j[3]*De+j[7]*$e+j[15],ai=Zt+pe,Gt=Er+Te,Ci=xt+Ve,Mi=vt+Ce,Ti=Zt+we,Ft=Er+Le,Ht=new ge((xt+ee)/Gt,(vt+oe)/Gt);Ht.z=ai/Gt,Ie.push(Ht);let fi=new ge(Ci/Ft,Mi/Ft);fi.z=Ti/Ft,he.push(fi)}ie.push(Ie),W.push(he)}return[ie,W]}(l,S,x,g);return function(A,D,O){let j=1/0;fd(O,D)&&(j=Od(O,D[0]));for(let ie=0;ie<D.length;ie++){let W=D[ie],ee=A[ie];for(let oe=0;oe<W.length-1;oe++){let pe=W[oe],Te=[pe,W[oe+1],ee[oe+1],ee[oe],pe];md(O,Te)&&(j=Math.min(j,Od(O,Te)))}}return j!==1/0&&j}(E[0],E[1],T)}}function El(i,t){return i.x*t.x+i.y*t.y}function Od(i,t){if(i.length===1){let r=0,a=t[r++],l;for(;!l||a.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){let u=t[r],d=i[0],m=l.sub(a),g=u.sub(a),v=d.sub(a),x=El(m,m),S=El(m,g),T=El(g,g),E=El(v,m),A=El(v,g),D=x*T-S*S,O=(T*E-S*A)/D,j=(x*A-S*E)/D,ie=a.z*(1-O-j)+l.z*O+u.z*j;if(isFinite(ie))return ie}return 1/0}{let r=1/0;for(let a of t)r=Math.min(r,a.z);return r}}let Of=f([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Vf}=Of,qf=f([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Nf}=qf,jf=da.VectorTileFeature.types,Uf=Math.cos(Math.PI/180*37.5),Vd=Math.pow(2,14)/.5;class _u{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Zo,this.layoutVertexArray2=new sa,this.indexArray=new lr,this.programConfigurations=new Qa(t.layers,t.zoom),this.segments=new rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=du("line",this.layers,r);let l=this.layers[0].layout.get("line-sort-key"),u=!l.isConstant(),d=[];for(let{feature:m,id:g,index:v,sourceLayerIndex:x}of t){let S=this.layers[0]._featureFilter.needGeometry,T=to(m,S);if(!this.layers[0]._featureFilter.filter(new Ct(this.zoom),T,a))continue;let E=u?l.evaluate(T,{},a):void 0,A={id:g,properties:m.properties,type:m.type,sourceLayerIndex:x,index:v,geometry:S?T.geometry:eo(m),patterns:{},sortKey:E};d.push(A)}u&&d.sort((m,g)=>m.sortKey-g.sortKey);for(let m of d){let{geometry:g,index:v,sourceLayerIndex:x}=m;if(this.hasPattern){let S=pu("line",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,g,v,a,{});r.featureIndex.insert(t[v].feature,g,v,x,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Nf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,l,u){let d=this.layers[0].layout,m=d.get("line-join").evaluate(t,{}),g=d.get("line-cap"),v=d.get("line-miter-limit"),x=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let S of r)this.addLine(S,t,m,g,v,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,l)}addLine(t,r,a,l,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<t.length-1;j++)this.totalDistance+=t[j].dist(t[j+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let m=jf[r.type]==="Polygon",g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let v=0;for(;v<g-1&&t[v].equals(t[v+1]);)v++;if(g<(m?3:2))return;a==="bevel"&&(u=1.05);let x=this.overscaling<=16?15*jt/(512*this.overscaling):0,S=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray),T,E,A,D,O;this.e1=this.e2=-1,m&&(T=t[g-2],O=t[v].sub(T)._unit()._perp());for(let j=v;j<g;j++){if(A=j===g-1?m?t[v+1]:void 0:t[j+1],A&&t[j].equals(A))continue;O&&(D=O),T&&(E=T),T=t[j],O=A?A.sub(T)._unit()._perp():D,D=D||O;let ie=D.add(O);ie.x===0&&ie.y===0||ie._unit();let W=D.x*O.x+D.y*O.y,ee=ie.x*O.x+ie.y*O.y,oe=ee!==0?1/ee:1/0,pe=2*Math.sqrt(2-2*ee),Te=ee<Uf&&E&&A,Ve=D.x*O.y-D.y*O.x>0;if(Te&&j>v){let Le=T.dist(E);if(Le>2*x){let Pe=T.sub(T.sub(E)._mult(x/Le)._round());this.updateDistance(E,Pe),this.addCurrentVertex(Pe,D,0,0,S),E=Pe}}let Ce=E&&A,we=Ce?a:m?"butt":l;if(Ce&&we==="round"&&(oe<d?we="miter":oe<=2&&(we="fakeround")),we==="miter"&&oe>u&&(we="bevel"),we==="bevel"&&(oe>2&&(we="flipbevel"),oe<u&&(we="miter")),E&&this.updateDistance(E,T),we==="miter")ie._mult(oe),this.addCurrentVertex(T,ie,0,0,S);else if(we==="flipbevel"){if(oe>100)ie=O.mult(-1);else{let Le=oe*D.add(O).mag()/D.sub(O).mag();ie._perp()._mult(Le*(Ve?-1:1))}this.addCurrentVertex(T,ie,0,0,S),this.addCurrentVertex(T,ie.mult(-1),0,0,S)}else if(we==="bevel"||we==="fakeround"){let Le=-Math.sqrt(oe*oe-1),Pe=Ve?Le:0,Ie=Ve?0:Le;if(E&&this.addCurrentVertex(T,D,Pe,Ie,S),we==="fakeround"){let he=Math.round(180*pe/Math.PI/20);for(let Re=1;Re<he;Re++){let De=Re/he;if(De!==.5){let xt=De-.5;De+=De*xt*(De-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*xt*xt+(.848013+W*(.215638*W-1.06021)))}let $e=O.sub(D)._mult(De)._add(D)._unit()._mult(Ve?-1:1);this.addHalfVertex(T,$e.x,$e.y,!1,Ve,0,S)}}A&&this.addCurrentVertex(T,O,-Pe,-Ie,S)}else if(we==="butt")this.addCurrentVertex(T,ie,0,0,S);else if(we==="square"){let Le=E?1:-1;this.addCurrentVertex(T,ie,Le,Le,S)}else we==="round"&&(E&&(this.addCurrentVertex(T,D,0,0,S),this.addCurrentVertex(T,D,1,1,S,!0)),A&&(this.addCurrentVertex(T,O,-1,-1,S,!0),this.addCurrentVertex(T,O,0,0,S)));if(Te&&j<g-1){let Le=T.dist(A);if(Le>2*x){let Pe=T.add(A.sub(T)._mult(x/Le)._round());this.updateDistance(T,Pe),this.addCurrentVertex(Pe,O,0,0,S),T=Pe}}}}addCurrentVertex(t,r,a,l,u,d=!1){let m=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,d,!1,a,u),this.addHalfVertex(t,m,g,d,!0,-l,u),this.distance>Vd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,l,u,d))}addHalfVertex({x:t,y:r},a,l,u,d,m,g){let v=.5*(this.lineClips?this.scaledDistance*(Vd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(u?1:0),(r<<1)+(d?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1)|(63&v)<<2,v>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let x=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),g.primitiveLength++),d?this.e2=x:this.e1=x}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let qd,Nd;Ee("LineBucket",_u,{omit:["layers","patternFeatures"]});var jd={get paint(){return Nd=Nd||new h({"line-opacity":new qe(ae.paint_line["line-opacity"]),"line-color":new qe(ae.paint_line["line-color"]),"line-translate":new Ae(ae.paint_line["line-translate"]),"line-translate-anchor":new Ae(ae.paint_line["line-translate-anchor"]),"line-width":new qe(ae.paint_line["line-width"]),"line-gap-width":new qe(ae.paint_line["line-gap-width"]),"line-offset":new qe(ae.paint_line["line-offset"]),"line-blur":new qe(ae.paint_line["line-blur"]),"line-dasharray":new $o(ae.paint_line["line-dasharray"]),"line-pattern":new Uo(ae.paint_line["line-pattern"]),"line-gradient":new vl(ae.paint_line["line-gradient"])})},get layout(){return qd=qd||new h({"line-cap":new Ae(ae.layout_line["line-cap"]),"line-join":new qe(ae.layout_line["line-join"]),"line-miter-limit":new Ae(ae.layout_line["line-miter-limit"]),"line-round-limit":new Ae(ae.layout_line["line-round-limit"]),"line-sort-key":new qe(ae.layout_line["line-sort-key"])})}};class $f extends qe{possiblyEvaluate(t,r){return r=new Ct(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,l){return r=Ni({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,l)}}let Nc;class Zf extends n{constructor(t){super(t,jd),this.gradientVersion=0,Nc||(Nc=new $f(jd.paint.properties["line-width"].specification),Nc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Nn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Nc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new _u(t)}queryRadius(t){let r=t,a=Ud(wl("line-width",this,r),wl("line-gap-width",this,r)),l=wl("line-offset",this,r);return a/2+Math.abs(l)+Rc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,a,l,u,d,m){let g=Fc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,m),v=m/2*Ud(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),x=this.paint.get("line-offset").evaluate(r,a);return x&&(l=function(S,T){let E=[];for(let A=0;A<S.length;A++){let D=S[A],O=[];for(let j=0;j<D.length;j++){let ie=D[j-1],W=D[j],ee=D[j+1],oe=j===0?new ge(0,0):W.sub(ie)._unit()._perp(),pe=j===D.length-1?new ge(0,0):ee.sub(W)._unit()._perp(),Te=oe._add(pe)._unit(),Ve=Te.x*pe.x+Te.y*pe.y;Ve!==0&&Te._mult(1/Ve),O.push(Te._mult(T)._add(W))}E.push(O)}return E}(l,x*m)),function(S,T,E){for(let A=0;A<T.length;A++){let D=T[A];if(S.length>=3){for(let O=0;O<D.length;O++)if(Jo(S,D[O]))return!0}if(Qm(S,D,E))return!0}return!1}(g,l,v)}isTileClipped(){return!0}}function Ud(i,t){return t>0?t+2*i:i}let Gf=f([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hf=f([{name:"a_projected_pos",components:3,type:"Float32"}],4);f([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Wf=f([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);f([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let $d=f([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xf=f([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Kf(i,t,r){return i.sections.forEach(a=>{a.text=function(l,u,d){let m=u.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Bi.applyArabicShaping&&(l=Bi.applyArabicShaping(l)),l}(a.text,t,r)}),i}f([{name:"triangle",components:3,type:"Uint16"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),f([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),f([{type:"Float32",name:"offsetX"}]),f([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),f([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let Pl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Ut=24,Zd=yt,Gd=function(i,t,r,a,l){var u,d,m=8*l-a-1,g=(1<<m)-1,v=g>>1,x=-7,S=r?l-1:0,T=r?-1:1,E=i[t+S];for(S+=T,u=E&(1<<-x)-1,E>>=-x,x+=m;x>0;u=256*u+i[t+S],S+=T,x-=8);for(d=u&(1<<-x)-1,u>>=-x,x+=a;x>0;d=256*d+i[t+S],S+=T,x-=8);if(u===0)u=1-v;else{if(u===g)return d?NaN:1/0*(E?-1:1);d+=Math.pow(2,a),u-=v}return(E?-1:1)*d*Math.pow(2,u-a)},Hd=function(i,t,r,a,l,u){var d,m,g,v=8*u-l-1,x=(1<<v)-1,S=x>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=a?0:u-1,A=a?1:-1,D=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,d=x):(d=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-d))<1&&(d--,g*=2),(t+=d+S>=1?T/g:T*Math.pow(2,1-S))*g>=2&&(d++,g/=2),d+S>=x?(m=0,d=x):d+S>=1?(m=(t*g-1)*Math.pow(2,l),d+=S):(m=t*Math.pow(2,S-1)*Math.pow(2,l),d=0));l>=8;i[r+E]=255&m,E+=A,m/=256,l-=8);for(d=d<<l|m,v+=l;v>0;i[r+E]=255&d,E+=A,d/=256,v-=8);i[r+E-A]|=128*D};function yt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}yt.Varint=0,yt.Fixed64=1,yt.Bytes=2,yt.Fixed32=5;var yu=4294967296,Wd=1/yu,Xd=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Tn(i){return i.type===yt.Bytes?i.readVarint()+i.pos:i.pos+1}function ts(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Kd(i,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var l=r.pos-1;l>=i;l--)r.buf[l+a]=r.buf[l]}function Jf(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Yf(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function Qf(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function eg(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function tg(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function ig(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function rg(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function ng(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function ag(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function jc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function is(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Jd(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}yt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),l=a>>3,u=this.pos;this.type=7&a,i(l,t,this),this.pos===u&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=jc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Jd(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=jc(this.buf,this.pos)+jc(this.buf,this.pos+4)*yu;return this.pos+=8,i},readSFixed64:function(){var i=jc(this.buf,this.pos)+Jd(this.buf,this.pos+4)*yu;return this.pos+=8,i},readFloat:function(){var i=Gd(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Gd(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(l,u,d){var m,g,v=d.buf;if(m=(112&(g=v[d.pos++]))>>4,g<128||(m|=(127&(g=v[d.pos++]))<<3,g<128)||(m|=(127&(g=v[d.pos++]))<<10,g<128)||(m|=(127&(g=v[d.pos++]))<<17,g<128)||(m|=(127&(g=v[d.pos++]))<<24,g<128)||(m|=(1&(g=v[d.pos++]))<<31,g<128))return ts(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Xd?function(r,a,l){return Xd.decode(r.subarray(a,l))}(this.buf,t,i):function(r,a,l){for(var u="",d=a;d<l;){var m,g,v,x=r[d],S=null,T=x>239?4:x>223?3:x>191?2:1;if(d+T>l)break;T===1?x<128&&(S=x):T===2?(192&(m=r[d+1]))==128&&(S=(31&x)<<6|63&m)<=127&&(S=null):T===3?(g=r[d+2],(192&(m=r[d+1]))==128&&(192&g)==128&&((S=(15&x)<<12|(63&m)<<6|63&g)<=2047||S>=55296&&S<=57343)&&(S=null)):T===4&&(g=r[d+2],v=r[d+3],(192&(m=r[d+1]))==128&&(192&g)==128&&(192&v)==128&&((S=(15&x)<<18|(63&m)<<12|(63&g)<<6|63&v)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,T=1):S>65535&&(S-=65536,u+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),u+=String.fromCharCode(S),d+=T}return u}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==yt.Bytes)return i.push(this.readVarint(t));var r=Tn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==yt.Bytes)return i.push(this.readSVarint());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==yt.Bytes)return i.push(this.readBoolean());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==yt.Bytes)return i.push(this.readFloat());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==yt.Bytes)return i.push(this.readDouble());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==yt.Bytes)return i.push(this.readFixed32());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==yt.Bytes)return i.push(this.readSFixed32());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==yt.Bytes)return i.push(this.readFixed64());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==yt.Bytes)return i.push(this.readSFixed64());var t=Tn(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===yt.Varint)for(;this.buf[this.pos++]>127;);else if(t===yt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===yt.Fixed32)this.pos+=4;else{if(t!==yt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),is(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),is(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),is(this.buf,-1&i,this.pos),is(this.buf,Math.floor(i*Wd),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),is(this.buf,-1&i,this.pos),is(this.buf,Math.floor(i*Wd),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var a,l;if(t>=0?(a=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,d,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(a,0,r),function(u,d){var m=(7&u)<<4;d.buf[d.pos++]|=m|((u>>>=3)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,l,u){for(var d,m,g=0;g<l.length;g++){if((d=l.charCodeAt(g))>55295&&d<57344){if(!m){d>56319||g+1===l.length?(a[u++]=239,a[u++]=191,a[u++]=189):m=d;continue}if(d<56320){a[u++]=239,a[u++]=191,a[u++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(a[u++]=239,a[u++]=191,a[u++]=189,m=null);d<128?a[u++]=d:(d<2048?a[u++]=d>>6|192:(d<65536?a[u++]=d>>12|224:(a[u++]=d>>18|240,a[u++]=d>>12&63|128),a[u++]=d>>6&63|128),a[u++]=63&d|128)}return u}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Kd(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Hd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Hd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var a=this.pos-r;a>=128&&Kd(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,r){this.writeTag(i,yt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Jf,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Yf,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,tg,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Qf,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,eg,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,ig,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,rg,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,ng,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,ag,t)},writeBytesField:function(i,t){this.writeTag(i,yt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,yt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,yt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,yt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,yt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,yt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,yt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,yt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,yt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,yt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var vu=Fe(Zd);let xu=3;function og(i,t,r){i===1&&r.readMessage(sg,t)}function sg(i,t,r){if(i===3){let{id:a,bitmap:l,width:u,height:d,left:m,top:g,advance:v}=r.readMessage(lg,{});t.push({id:a,bitmap:new Cl({width:u+2*xu,height:d+2*xu},l),metrics:{width:u,height:d,left:m,top:g,advance:v}})}}function lg(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}let Yd=xu;function Qd(i){let t=0,r=0;for(let d of i)t+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,m)=>m.h-d.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],l=0,u=0;for(let d of i)for(let m=a.length-1;m>=0;m--){let g=a[m];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,u=Math.max(u,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===g.w&&d.h===g.h){let v=a.pop();m<a.length&&(a[m]=v)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(a.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:l,h:u,fill:t/(l*u)||0}}let Vi=1;class bu{constructor(t,{pixelRatio:r,version:a,stretchX:l,stretchY:u,content:d,textFitWidth:m,textFitHeight:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=d,this.version=a,this.textFitWidth=m,this.textFitHeight=g}get tl(){return[this.paddedRect.x+Vi,this.paddedRect.y+Vi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vi,this.paddedRect.y+this.paddedRect.h-Vi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vi)/this.pixelRatio,(this.paddedRect.h-2*Vi)/this.pixelRatio]}}class ep{constructor(t,r){let a={},l={};this.haveRenderCallbacks=[];let u=[];this.addImages(t,a,u),this.addImages(r,l,u);let{w:d,h:m}=Qd(u),g=new cr({width:d||1,height:m||1});for(let v in t){let x=t[v],S=a[v].paddedRect;cr.copy(x.data,g,{x:0,y:0},{x:S.x+Vi,y:S.y+Vi},x.data)}for(let v in r){let x=r[v],S=l[v].paddedRect,T=S.x+Vi,E=S.y+Vi,A=x.data.width,D=x.data.height;cr.copy(x.data,g,{x:0,y:0},{x:T,y:E},x.data),cr.copy(x.data,g,{x:0,y:D-1},{x:T,y:E-1},{width:A,height:1}),cr.copy(x.data,g,{x:0,y:0},{x:T,y:E+D},{width:A,height:1}),cr.copy(x.data,g,{x:A-1,y:0},{x:T-1,y:E},{width:1,height:D}),cr.copy(x.data,g,{x:0,y:0},{x:T+A,y:E},{width:1,height:D})}this.image=g,this.iconPositions=a,this.patternPositions=l}addImages(t,r,a){for(let l in t){let u=t[l],d={x:0,y:0,w:u.data.width+2*Vi,h:u.data.height+2*Vi};a.push(d),r[l]=new bu(d,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;let[l,u]=t.tl;a.update(r.data,void 0,{x:l,y:u})}}var pa;Ee("ImagePosition",bu),Ee("ImageAtlas",ep),w.ah=void 0,(pa=w.ah||(w.ah={}))[pa.none=0]="none",pa[pa.horizontal=1]="horizontal",pa[pa.vertical=2]="vertical",pa[pa.horizontalOnly=3]="horizontalOnly";let Al=-17;class zl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){let a=new zl;return a.scale=t||1,a.fontStack=r,a}static forImage(t){let r=new zl;return r.imageName=t,r}}class rs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){let a=new rs;for(let l=0;l<t.sections.length;l++){let u=t.sections[l];u.image?a.addImageSection(u):a.addTextSection(u,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let a=0;a<t.length;a++){let l=t.charCodeAt(a+1)||null,u=t.charCodeAt(a-1)||null;r+=l&&Ic(l)&&!Pl[t[a+1]]||u&&Ic(u)&&!Pl[t[a-1]]||!Pl[t[a]]?t[a]:Pl[t[a]]}return r}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&$c[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&$c[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){let a=new rs;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(zl.forText(t.scale,t.fontStack||r));let a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){let r=t.image?t.image.name:"";if(r.length===0)return void Qt("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(zl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uc(i,t,r,a,l,u,d,m,g,v,x,S,T,E,A){let D=rs.fromFeature(i,l),O;S===w.ah.vertical&&D.verticalizePunctuation();let{processBidirectionalText:j,processStyledBidirectionalText:ie}=Bi;if(j&&D.sections.length===1){O=[];let oe=j(D.toString(),wu(D,v,u,t,a,E));for(let pe of oe){let Te=new rs;Te.text=pe,Te.sections=D.sections;for(let Ve=0;Ve<pe.length;Ve++)Te.sectionIndex.push(0);O.push(Te)}}else if(ie){O=[];let oe=ie(D.text,D.sectionIndex,wu(D,v,u,t,a,E));for(let pe of oe){let Te=new rs;Te.text=pe[0],Te.sectionIndex=pe[1],Te.sections=D.sections,O.push(Te)}}else O=function(oe,pe){let Te=[],Ve=oe.text,Ce=0;for(let we of pe)Te.push(oe.substring(Ce,we)),Ce=we;return Ce<Ve.length&&Te.push(oe.substring(Ce,Ve.length)),Te}(D,wu(D,v,u,t,a,E));let W=[],ee={positionedLines:W,text:D.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:S,iconsInText:!1,verticalizable:!1};return function(oe,pe,Te,Ve,Ce,we,Le,Pe,Ie,he,Re,De){let $e=0,xt=Al,vt=0,Zt=0,Er=Pe==="right"?1:Pe==="left"?0:.5,ai=0;for(let Ft of Ce){Ft.trim();let Ht=Ft.getMaxScale(),fi=(Ht-1)*Ut,oi={positionedGlyphs:[],lineOffset:0};oe.positionedLines[ai]=oi;let ki=oi.positionedGlyphs,si=0;if(!Ft.length()){xt+=we,++ai;continue}for(let qi=0;qi<Ft.length();qi++){let st=Ft.getSection(qi),St=Ft.getSectionIndex(qi),It=Ft.getCharCode(qi),Ki=0,Dt=null,ss=null,tn=null,rn=Ut,Pr=!(Ie===w.ah.horizontal||!Re&&!_l(It)||Re&&($c[It]||(Gt=It,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Gt)))));if(st.imageName){let dr=Ve[st.imageName];if(!dr)continue;tn=st.imageName,oe.iconsInText=oe.iconsInText||!0,ss=dr.paddedRect;let Yt=dr.displaySize;st.scale=st.scale*Ut/De,Dt={width:Yt[0],height:Yt[1],left:Vi,top:-Yd,advance:Pr?Yt[1]:Yt[0]},Ki=fi+(Ut-Yt[1]*st.scale),rn=Dt.advance;let kn=Pr?Yt[0]*st.scale-Ut*Ht:Yt[1]*st.scale-Ut*Ht;kn>0&&kn>si&&(si=kn)}else{let dr=Te[st.fontStack],Yt=dr&&dr[It];if(Yt&&Yt.rect)ss=Yt.rect,Dt=Yt.metrics;else{let kn=pe[st.fontStack],Ol=kn&&kn[It];if(!Ol)continue;Dt=Ol.metrics}Ki=(Ht-st.scale)*Ut}Pr?(oe.verticalizable=!0,ki.push({glyph:It,imageName:tn,x:$e,y:xt+Ki,vertical:Pr,scale:st.scale,fontStack:st.fontStack,sectionIndex:St,metrics:Dt,rect:ss}),$e+=rn*st.scale+he):(ki.push({glyph:It,imageName:tn,x:$e,y:xt+Ki,vertical:Pr,scale:st.scale,fontStack:st.fontStack,sectionIndex:St,metrics:Dt,rect:ss}),$e+=Dt.advance*st.scale+he)}ki.length!==0&&(vt=Math.max($e-he,vt),dg(ki,0,ki.length-1,Er,si)),$e=0;let ur=we*Ht+si;oi.lineOffset=Math.max(si,fi),xt+=ur,Zt=Math.max(ur,Zt),++ai}var Gt;let Ci=xt-Al,{horizontalAlign:Mi,verticalAlign:Ti}=Su(Le);(function(Ft,Ht,fi,oi,ki,si,ur,qi,st){let St=(Ht-fi)*ki,It=0;It=si!==ur?-qi*oi-Al:(-oi*st+.5)*ur;for(let Ki of Ft)for(let Dt of Ki.positionedGlyphs)Dt.x+=St,Dt.y+=It})(oe.positionedLines,Er,Mi,Ti,vt,Zt,we,Ci,Ce.length),oe.top+=-Ti*Ci,oe.bottom=oe.top+Ci,oe.left+=-Mi*vt,oe.right=oe.left+vt}(ee,t,r,a,O,d,m,g,S,v,T,A),!function(oe){for(let pe of oe)if(pe.positionedGlyphs.length!==0)return!1;return!0}(W)&&ee}let $c={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cg={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hg={40:!0};function tp(i,t,r,a,l,u){if(t.imageName){let d=a[t.imageName];return d?d.displaySize[0]*t.scale*Ut/u+l:0}{let d=r[t.fontStack],m=d&&d[i];return m?m.metrics.advance*t.scale+l:0}}function ip(i,t,r,a){let l=Math.pow(i-t,2);return a?i<t?l/2:2*l:l+Math.abs(r)*r}function ug(i,t,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function rp(i,t,r,a,l,u){let d=null,m=ip(t,r,l,u);for(let g of a){let v=ip(t-g.x,r,l,u)+g.badness;v<=m&&(d=g,m=v)}return{index:i,x:t,priorBreak:d,badness:m}}function np(i){return i?np(i.priorBreak).concat(i.index):[]}function wu(i,t,r,a,l,u){if(!i)return[];let d=[],m=function(S,T,E,A,D,O){let j=0;for(let ie=0;ie<S.length();ie++){let W=S.getSection(ie);j+=tp(S.getCharCode(ie),W,A,D,T,O)}return j/Math.max(1,Math.ceil(j/E))}(i,t,r,a,l,u),g=i.text.indexOf("\u200B")>=0,v=0;for(let S=0;S<i.length();S++){let T=i.getSection(S),E=i.getCharCode(S);if($c[E]||(v+=tp(E,T,a,l,t,u)),S<i.length()-1){let A=!((x=E)<11904)&&(!!it["CJK Compatibility Forms"](x)||!!it["CJK Compatibility"](x)||!!it["CJK Strokes"](x)||!!it["CJK Symbols and Punctuation"](x)||!!it["Enclosed CJK Letters and Months"](x)||!!it["Halfwidth and Fullwidth Forms"](x)||!!it["Ideographic Description Characters"](x)||!!it["Vertical Forms"](x)||kc.test(String.fromCodePoint(x)));(cg[E]||A||T.imageName||S!==i.length()-2&&hg[i.getCharCode(S+1)])&&d.push(rp(S+1,v,m,d,ug(E,i.getCharCode(S+1),A&&g),!1))}}var x;return np(rp(i.length(),v,m,d,0,!0))}function Su(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function dg(i,t,r,a,l){if(!a&&!l)return;let u=i[r],d=(i[r].x+u.metrics.advance*u.scale)*a;for(let m=t;m<=r;m++)i[m].x-=d,i[m].y+=l}function pg(i,t,r){let{horizontalAlign:a,verticalAlign:l}=Su(r),u=t[0]-i.displaySize[0]*a,d=t[1]-i.displaySize[1]*l;return{image:i,top:d,bottom:d+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function ap(i){var t,r;let a=i.left,l=i.top,u=i.right-a,d=i.bottom-l,m=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",v=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(m==="stretchOnly"&&u/d<v||m==="proportional"){let x=Math.ceil(d*v);a*=x/u,u=x}}else if(m==="proportional"&&g==="stretchOnly"&&v!==0&&u/d>v){let x=Math.ceil(u/v);l*=x/d,d=x}return{x1:a,y1:l,x2:a+u,y2:l+d}}function op(i,t,r,a,l,u){let d=i.image,m;if(d.content){let O=d.content,j=d.pixelRatio||1;m=[O[0]/j,O[1]/j,d.displaySize[0]-O[2]/j,d.displaySize[1]-O[3]/j]}let g=t.left*u,v=t.right*u,x,S,T,E;r==="width"||r==="both"?(E=l[0]+g-a[3],S=l[0]+v+a[1]):(E=l[0]+(g+v-d.displaySize[0])/2,S=E+d.displaySize[0]);let A=t.top*u,D=t.bottom*u;return r==="height"||r==="both"?(x=l[1]+A-a[0],T=l[1]+D+a[2]):(x=l[1]+(A+D-d.displaySize[1])/2,T=x+d.displaySize[1]),{image:d,top:x,right:S,bottom:T,left:E,collisionPadding:m}}let Dl=255,en=128,ma=Dl*en;function sp(i,t){let{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ct(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=r,u=0;for(;u<a.length&&a[u]<=i;)u++;u=Math.max(0,u-1);let d=u;for(;d<a.length&&a[d]<i+1;)d++;d=Math.min(a.length-1,d);let m=a[u],g=a[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:g,minSize:r.evaluate(new Ct(m)),maxSize:r.evaluate(new Ct(g)),interpolationType:l}}}function Cu(i,t,r){let a="never",l=i.get(t);return l?a=l:i.get(r)&&(a="always"),a}let mg=da.VectorTileFeature.types,fg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zc(i,t,r,a,l,u,d,m,g,v,x,S,T){let E=m?Math.min(ma,Math.round(m[0])):0,A=m?Math.min(ma,Math.round(m[1])):0;i.emplaceBack(t,r,Math.round(32*a),Math.round(32*l),u,d,(E<<1)+(g?1:0),A,16*v,16*x,256*S,256*T)}function Mu(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function gg(i){for(let t of i.sections)if(Qh(t.text))return!0;return!1}class Tu{constructor(t){this.layoutVertexArray=new Go,this.indexArray=new lr,this.programConfigurations=t,this.segments=new rt,this.dynamicLayoutVertexArray=new xl,this.opacityVertexArray=new Wi,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gf.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Hf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,fg,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ee("SymbolBuffers",Tu);class ku{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new rt,this.collisionVertexArray=new Yr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Wf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ee("CollisionBuffers",ku);class ns{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ou([]),this.placementViewportMatrix=ou([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sp(this.zoom,r["text-size"]),this.iconSizeData=sp(this.zoom,r["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),u=a.get("symbol-z-order");this.canOverlap=Cu(a,"text-overlap","text-allow-overlap")!=="never"||Cu(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(d=>w.ah[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID}createArrays(){this.text=new Tu(new Qa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Tu(new Qa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Tt,this.lineVertexArray=new ti,this.symbolInstances=new tt,this.textAnchorOffsets=new kt}calculateGlyphDependencies(t,r,a,l,u){for(let d=0;d<t.length;d++)if(r[t.charCodeAt(d)]=!0,(a||l)&&u){let m=Pl[t.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(t,r,a){let l=this.layers[0],u=l.layout,d=u.get("text-font"),m=u.get("text-field"),g=u.get("icon-image"),v=(m.value.kind!=="constant"||m.value.value instanceof Di&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),x=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,S=u.get("symbol-sort-key");if(this.features=[],!v&&!x)return;let T=r.iconDependencies,E=r.glyphDependencies,A=r.availableImages,D=new Ct(this.zoom);for(let{feature:O,id:j,index:ie,sourceLayerIndex:W}of t){let ee=l._featureFilter.needGeometry,oe=to(O,ee);if(!l._featureFilter.filter(D,oe,a))continue;let pe,Te;if(ee||(oe.geometry=eo(O)),v){let Ce=l.getValueAndResolveTokens("text-field",oe,a,A),we=Di.factory(Ce),Le=this.hasRTLText=this.hasRTLText||gg(we);(!Le||Bi.getRTLTextPluginStatus()==="unavailable"||Le&&Bi.isParsed())&&(pe=Kf(we,l,oe))}if(x){let Ce=l.getValueAndResolveTokens("icon-image",oe,a,A);Te=Ce instanceof Ri?Ce:Ri.fromString(Ce)}if(!pe&&!Te)continue;let Ve=this.sortFeaturesByKey?S.evaluate(oe,{},a):void 0;if(this.features.push({id:j,text:pe,icon:Te,index:ie,sourceLayerIndex:W,geometry:oe.geometry,properties:O.properties,type:mg[O.type],sortKey:Ve}),Te&&(T[Te.name]=!0),pe){let Ce=d.evaluate(oe,{},a).join(","),we=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(let Le of pe.sections)if(Le.image)T[Le.image.name]=!0;else{let Pe=fl(pe.toString()),Ie=Le.fontStack||Ce,he=E[Ie]=E[Ie]||{};this.calculateGlyphDependencies(Le.text,he,we,this.allowVerticalPlacement,Pe)}}}u.get("symbol-placement")==="line"&&(this.features=function(O){let j={},ie={},W=[],ee=0;function oe(Ce){W.push(O[Ce]),ee++}function pe(Ce,we,Le){let Pe=ie[Ce];return delete ie[Ce],ie[we]=Pe,W[Pe].geometry[0].pop(),W[Pe].geometry[0]=W[Pe].geometry[0].concat(Le[0]),Pe}function Te(Ce,we,Le){let Pe=j[we];return delete j[we],j[Ce]=Pe,W[Pe].geometry[0].shift(),W[Pe].geometry[0]=Le[0].concat(W[Pe].geometry[0]),Pe}function Ve(Ce,we,Le){let Pe=Le?we[0][we[0].length-1]:we[0][0];return`${Ce}:${Pe.x}:${Pe.y}`}for(let Ce=0;Ce<O.length;Ce++){let we=O[Ce],Le=we.geometry,Pe=we.text?we.text.toString():null;if(!Pe){oe(Ce);continue}let Ie=Ve(Pe,Le),he=Ve(Pe,Le,!0);if(Ie in ie&&he in j&&ie[Ie]!==j[he]){let Re=Te(Ie,he,Le),De=pe(Ie,he,W[Re].geometry);delete j[Ie],delete ie[he],ie[Ve(Pe,W[De].geometry,!0)]=De,W[Re].geometry=null}else Ie in ie?pe(Ie,he,Le):he in j?Te(Ie,he,Le):(oe(Ce),j[Ie]=ee-1,ie[he]=ee-1)}return W.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((O,j)=>O.sortKey-j.sortKey)}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){let a=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),u=t.dist(r[t.segment]),d={};for(let m=t.segment+1;m<r.length;m++)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:l},m<r.length-1&&(l+=r[m+1].dist(r[m]));for(let m=t.segment||0;m>=0;m--)d[m]={x:r[m].x,y:r[m].y,tileUnitDistanceFromAnchor:u},m>0&&(u+=r[m-1].dist(r[m]));for(let m=0;m<r.length;m++){let g=d[m];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,l,u,d,m,g,v,x,S,T){let E=t.indexArray,A=t.layoutVertexArray,D=t.segments.prepareSegment(4*r.length,A,E,this.canOverlap?d.sortKey:void 0),O=this.glyphOffsetArray.length,j=D.vertexLength,ie=this.allowVerticalPlacement&&m===w.ah.vertical?Math.PI/2:0,W=d.text&&d.text.sections;for(let ee=0;ee<r.length;ee++){let{tl:oe,tr:pe,bl:Te,br:Ve,tex:Ce,pixelOffsetTL:we,pixelOffsetBR:Le,minFontScaleX:Pe,minFontScaleY:Ie,glyphOffset:he,isSDF:Re,sectionIndex:De}=r[ee],$e=D.vertexLength,xt=he[1];Zc(A,g.x,g.y,oe.x,xt+oe.y,Ce.x,Ce.y,a,Re,we.x,we.y,Pe,Ie),Zc(A,g.x,g.y,pe.x,xt+pe.y,Ce.x+Ce.w,Ce.y,a,Re,Le.x,we.y,Pe,Ie),Zc(A,g.x,g.y,Te.x,xt+Te.y,Ce.x,Ce.y+Ce.h,a,Re,we.x,Le.y,Pe,Ie),Zc(A,g.x,g.y,Ve.x,xt+Ve.y,Ce.x+Ce.w,Ce.y+Ce.h,a,Re,Le.x,Le.y,Pe,Ie),Mu(t.dynamicLayoutVertexArray,g,ie),E.emplaceBack($e,$e+1,$e+2),E.emplaceBack($e+1,$e+2,$e+3),D.vertexLength+=4,D.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(he[0]),ee!==r.length-1&&De===r[ee+1].sectionIndex||t.programConfigurations.populatePaintArrays(A.length,d,d.index,{},T,W&&W[De])}t.placedSymbolArray.emplaceBack(g.x,g.y,O,this.glyphOffsetArray.length-O,j,v,x,g.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],m,0,!1,0,S)}_addCollisionDebugVertex(t,r,a,l,u,d){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,l,u,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(t,r,a,l,u,d,m){let g=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),v=g.vertexLength,x=u.layoutVertexArray,S=u.collisionVertexArray,T=m.anchorX,E=m.anchorY;this._addCollisionDebugVertex(x,S,d,T,E,new ge(t,r)),this._addCollisionDebugVertex(x,S,d,T,E,new ge(a,r)),this._addCollisionDebugVertex(x,S,d,T,E,new ge(a,l)),this._addCollisionDebugVertex(x,S,d,T,E,new ge(t,l)),g.vertexLength+=4;let A=u.indexArray;A.emplaceBack(v,v+1),A.emplaceBack(v+1,v+2),A.emplaceBack(v+2,v+3),A.emplaceBack(v+3,v),g.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,l){for(let u=t;u<r;u++){let d=this.collisionBoxArray.get(u);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,l?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ku(Xi,$d.members,Jt),this.iconCollisionBox=new ku(Xi,$d.members,Jt);for(let t=0;t<this.symbolInstances.length;t++){let r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,l,u,d,m,g,v){let x={};for(let S=r;S<a;S++){let T=t.get(S);x.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.textFeatureIndex=T.featureIndex;break}for(let S=l;S<u;S++){let T=t.get(S);x.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalTextFeatureIndex=T.featureIndex;break}for(let S=d;S<m;S++){let T=t.get(S);x.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.iconFeatureIndex=T.featureIndex;break}for(let S=g;S<v;S++){let T=t.get(S);x.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalIconFeatureIndex=T.featureIndex;break}return x}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){let a=t.placedSymbolArray.get(r),l=a.vertexStartIndex+4*a.numGlyphs;for(let u=a.vertexStartIndex;u<l;u+=4)t.indexArray.emplaceBack(u,u+1,u+2),t.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(t),a=Math.cos(t),l=[],u=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);let g=this.symbolInstances.get(m);l.push(0|Math.round(r*g.anchorX+a*g.anchorY)),u.push(g.featureIndex)}return d.sort((m,g)=>l[m]-l[g]||u[g]-u[m]),d}addToSortKeyRanges(t,r){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,u,d)=>{l>=0&&d.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let lp,cp;Ee("SymbolBucket",ns,{omit:["layers","collisionBoxArray","features","compareText"]}),ns.MAX_GLYPHS=65535,ns.addDynamicAttributes=Mu;var Iu={get paint(){return cp=cp||new h({"icon-opacity":new qe(ae.paint_symbol["icon-opacity"]),"icon-color":new qe(ae.paint_symbol["icon-color"]),"icon-halo-color":new qe(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new qe(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qe(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new Ae(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ae(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new qe(ae.paint_symbol["text-opacity"]),"text-color":new qe(ae.paint_symbol["text-color"],{runtimeType:vi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new qe(ae.paint_symbol["text-halo-color"]),"text-halo-width":new qe(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new qe(ae.paint_symbol["text-halo-blur"]),"text-translate":new Ae(ae.paint_symbol["text-translate"]),"text-translate-anchor":new Ae(ae.paint_symbol["text-translate-anchor"])})},get layout(){return lp=lp||new h({"symbol-placement":new Ae(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new Ae(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ae(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qe(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ae(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ae(ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ae(ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ae(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ae(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ae(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new qe(ae.layout_symbol["icon-size"]),"icon-text-fit":new Ae(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ae(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new qe(ae.layout_symbol["icon-image"]),"icon-rotate":new qe(ae.layout_symbol["icon-rotate"]),"icon-padding":new qe(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new Ae(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new qe(ae.layout_symbol["icon-offset"]),"icon-anchor":new qe(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ae(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ae(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ae(ae.layout_symbol["text-rotation-alignment"]),"text-field":new qe(ae.layout_symbol["text-field"]),"text-font":new qe(ae.layout_symbol["text-font"]),"text-size":new qe(ae.layout_symbol["text-size"]),"text-max-width":new qe(ae.layout_symbol["text-max-width"]),"text-line-height":new Ae(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new qe(ae.layout_symbol["text-letter-spacing"]),"text-justify":new qe(ae.layout_symbol["text-justify"]),"text-radial-offset":new qe(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ae(ae.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qe(ae.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qe(ae.layout_symbol["text-anchor"]),"text-max-angle":new Ae(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new Ae(ae.layout_symbol["text-writing-mode"]),"text-rotate":new qe(ae.layout_symbol["text-rotate"]),"text-padding":new Ae(ae.layout_symbol["text-padding"]),"text-keep-upright":new Ae(ae.layout_symbol["text-keep-upright"]),"text-transform":new qe(ae.layout_symbol["text-transform"]),"text-offset":new qe(ae.layout_symbol["text-offset"]),"text-allow-overlap":new Ae(ae.layout_symbol["text-allow-overlap"]),"text-overlap":new Ae(ae.layout_symbol["text-overlap"]),"text-ignore-placement":new Ae(ae.layout_symbol["text-ignore-placement"]),"text-optional":new Ae(ae.layout_symbol["text-optional"])})}};class hp{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ee("FormatSectionOverride",hp,{omit:["defaultValue"]});class Gc extends n{constructor(t){super(t,Iu)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let u of a)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,l){let u=this.layout.get(t).evaluate(r,{},a,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||Ao(d.value)||!u?u:function(m,g){return g.replace(/{([^{}]+)}/g,(v,x)=>m&&x in m?String(m[x]):"")}(r.properties,u)}createBucket(t){return new ns(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Iu.paint.overridableProperties){if(!Gc.hasPaintOverride(this.layout,t))continue;let r=this.paint.get(t),a=new hp(r),l=new Po(a,r.property.specification),u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Kn("source",l):new Jn("composite",l,r.value.zoomStops),this.paint._values[t]=new kr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Gc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){let a=t.get("text-field"),l=Iu.paint.properties[r],u=!1,d=m=>{for(let g of m)if(l.overrides&&l.overrides.hasOverride(g))return void(u=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Di)d(a.value.value.sections);else if(a.value.kind==="source"){let m=v=>{u||(v instanceof ir&&Nt(v.value)===Br?d(v.value.sections):v instanceof bo?d(v.sections):v.eachChild(m))},g=a.value;g._styleExpression&&m(g._styleExpression.expression)}return u}}let up;var _g={get paint(){return up=up||new h({"background-color":new Ae(ae.paint_background["background-color"]),"background-pattern":new $o(ae.paint_background["background-pattern"]),"background-opacity":new Ae(ae.paint_background["background-opacity"])})}};class yg extends n{constructor(t){super(t,_g)}}let dp;var vg={get paint(){return dp=dp||new h({"raster-opacity":new Ae(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ae(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ae(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ae(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new Ae(ae.paint_raster["raster-saturation"]),"raster-contrast":new Ae(ae.paint_raster["raster-contrast"]),"raster-resampling":new Ae(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new Ae(ae.paint_raster["raster-fade-duration"])})}};class xg extends n{constructor(t){super(t,vg)}}class bg extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let Eu=63710088e-1;class fa{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fa(_r(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let r=Math.PI/180,a=this.lat*r,l=t.lat*r,u=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return Eu*Math.acos(Math.min(u,1))}static convert(t){if(t instanceof fa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new fa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new fa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let pp=2*Math.PI*Eu;function mp(i){return pp*Math.cos(i*Math.PI/180)}function fp(i){return(180+i)/360}function gp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function _p(i,t){return i/mp(t)}function Pu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ll{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){let a=fa.convert(t);return new Ll(fp(a.lng),gp(a.lat),_p(r,a.lat))}toLngLat(){return new fa(360*this.x-180,Pu(this.y))}toAltitude(){return this.z*mp(Pu(this.y))}meterInMercatorCoordinateUnits(){return 1/pp*(t=Pu(this.y),1/Math.cos(t*Math.PI/180));var t}}function yp(i,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Au{constructor(t,r,a){if(!function(l,u,d){return!(l<0||l>25||d<0||d>=Math.pow(2,l)||u<0||u>=Math.pow(2,l))}(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=Rl(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){let l=(d=this.y,m=this.z,g=yp(256*(u=this.x),256*(d=Math.pow(2,m)-d-1),m),v=yp(256*(u+1),256*(d+1),m),g[0]+","+g[1]+","+v[0]+","+v[1]);var u,d,m,g,v;let x=function(S,T,E){let A,D="";for(let O=S;O>0;O--)A=1<<O-1,D+=(T&A?1:0)+(E&A?2:0);return D}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,x).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){let r=Math.pow(2,this.z);return new ge((t.x*r-this.x)*jt,(t.y*r-this.y)*jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vp{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Rl(t,r.z,r.z,r.x,r.y)}}class hr{constructor(t,r,a,l,u){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Au(a,+l,+u),this.key=Rl(r,t,a,l,u)}clone(){return new hr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let r=this.canonical.z-t;return t>this.canonical.z?new hr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?Rl(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Rl(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new hr(r,this.wrap,r,a,l),new hr(r,this.wrap,r,a+1,l),new hr(r,this.wrap,r,a,l+1),new hr(r,this.wrap,r,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new hr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ll(t.x-this.wrap,t.y))}}function Rl(i,t,r,a,l){(i*=2)<0&&(i=-1*i-1);let u=1<<r;return(u*u*i+u*l+a).toString(36)+r.toString(36)+t.toString(36)}Ee("CanonicalTileID",Au),Ee("OverscaledTileID",hr,{omit:["posMatrix"]});class xp{constructor(t,r,a,l=1,u=1,d=1,m=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Qt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;let g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=u,this.blueFactor=d,this.baseShift=m;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let x=0;x<g;x++){let S=this.get(v,x);S>this.max&&(this.max=S),S<this.min&&(this.min=S)}}get(t,r){let a=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new cr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,d=a*this.dim,m=a*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(a){case-1:d=m-1;break;case 1:m=d+1}let g=-r*this.dim,v=-a*this.dim;for(let x=d;x<m;x++)for(let S=l;S<u;S++)this.data[this._idx(S,x)]=t.data[this._idx(S+g,x+v)]}}Ee("DEMData",xp);class bp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){let a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class wp{constructor(t,r,a,l,u){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=l,this.properties=t.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Sp{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ta(jt,16,0),this.grid3D=new ta(jt,16,0),this.featureIndexArray=new pi,this.promoteId=r}insert(t,r,a,l,u,d){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,u);let g=d?this.grid3D:this.grid;for(let v=0;v<r.length;v++){let x=r[v],S=[1/0,1/0,-1/0,-1/0];for(let T=0;T<x.length;T++){let E=x[T];S[0]=Math.min(S[0],E.x),S[1]=Math.min(S[1],E.y),S[2]=Math.max(S[2],E.x),S[3]=Math.max(S[3],E.y)}S[0]<jt&&S[1]<jt&&S[2]>=0&&S[3]>=0&&g.insert(m,S[0],S[1],S[2],S[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new da.VectorTile(new vu(this.rawTileData)).layers,this.sourceLayerCoder=new bp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,l){this.loadVTLayers();let u=t.params||{},d=jt/t.tileSize/t.scale,m=el(u.filter),g=t.queryGeometry,v=t.queryPadding*d,x=Mp(g),S=this.grid.query(x.minX-v,x.minY-v,x.maxX+v,x.maxY+v),T=Mp(t.cameraQueryGeometry),E=this.grid3D.query(T.minX-v,T.minY-v,T.maxX+v,T.maxY+v,(O,j,ie,W)=>function(ee,oe,pe,Te,Ve){for(let we of ee)if(oe<=we.x&&pe<=we.y&&Te>=we.x&&Ve>=we.y)return!0;let Ce=[new ge(oe,pe),new ge(oe,Ve),new ge(Te,Ve),new ge(Te,pe)];if(ee.length>2){for(let we of Ce)if(Jo(ee,we))return!0}for(let we=0;we<ee.length-1;we++)if(tf(ee[we],ee[we+1],Ce))return!0;return!1}(t.cameraQueryGeometry,O-v,j-v,ie+v,W+v));for(let O of E)S.push(O);S.sort(Sg);let A={},D;for(let O=0;O<S.length;O++){let j=S[O];if(j===D)continue;D=j;let ie=this.featureIndexArray.get(j),W=null;this.loadMatchingFeature(A,ie.bucketIndex,ie.sourceLayerIndex,ie.featureIndex,m,u.layers,u.availableImages,r,a,l,(ee,oe,pe)=>(W||(W=eo(ee)),oe.queryIntersectsFeature(g,ee,pe,W,this.z,t.transform,d,t.pixelPosMatrix)))}return A}loadMatchingFeature(t,r,a,l,u,d,m,g,v,x,S){let T=this.bucketLayerIDs[r];if(d&&!function(O,j){for(let ie=0;ie<O.length;ie++)if(j.indexOf(O[ie])>=0)return!0;return!1}(d,T))return;let E=this.sourceLayerCoder.decode(a),A=this.vtLayers[E].feature(l);if(u.needGeometry){let O=to(A,!0);if(!u.filter(new Ct(this.tileID.overscaledZ),O,this.tileID.canonical))return}else if(!u.filter(new Ct(this.tileID.overscaledZ),A))return;let D=this.getId(A,E);for(let O=0;O<T.length;O++){let j=T[O];if(d&&d.indexOf(j)<0)continue;let ie=g[j];if(!ie)continue;let W={};D&&x&&(W=x.getState(ie.sourceLayer||"_geojsonTileLayer",D));let ee=Ni({},v[j]);ee.paint=Cp(ee.paint,ie.paint,A,W,m),ee.layout=Cp(ee.layout,ie.layout,A,W,m);let oe=!S||S(A,ie,W);if(!oe)continue;let pe=new wp(A,this.z,this.x,this.y,D);pe.layer=ee;let Te=t[j];Te===void 0&&(Te=t[j]=[]),Te.push({featureIndex:l,feature:pe,intersectionZ:oe})}}lookupSymbolFeatures(t,r,a,l,u,d,m,g){let v={};this.loadVTLayers();let x=el(u);for(let S of t)this.loadMatchingFeature(v,a,l,S,x,d,m,g,r);return v}hasLayer(t){for(let r of this.bucketLayerIDs)for(let a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Cp(i,t,r,a,l){return yr(i,(u,d)=>{let m=t instanceof Ka?t.get(d):null;return m&&m.evaluate?m.evaluate(r,a,l):m})}function Mp(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return{minX:t,minY:r,maxX:a,maxY:l}}function Sg(i,t){return t-i}function Tp(i,t,r,a,l){let u=[];for(let d=0;d<i.length;d++){let m=i[d],g;for(let v=0;v<m.length-1;v++){let x=m[v],S=m[v+1];x.x<t&&S.x<t||(x.x<t?x=new ge(t,x.y+(t-x.x)/(S.x-x.x)*(S.y-x.y))._round():S.x<t&&(S=new ge(t,x.y+(t-x.x)/(S.x-x.x)*(S.y-x.y))._round()),x.y<r&&S.y<r||(x.y<r?x=new ge(x.x+(r-x.y)/(S.y-x.y)*(S.x-x.x),r)._round():S.y<r&&(S=new ge(x.x+(r-x.y)/(S.y-x.y)*(S.x-x.x),r)._round()),x.x>=a&&S.x>=a||(x.x>=a?x=new ge(a,x.y+(a-x.x)/(S.x-x.x)*(S.y-x.y))._round():S.x>=a&&(S=new ge(a,x.y+(a-x.x)/(S.x-x.x)*(S.y-x.y))._round()),x.y>=l&&S.y>=l||(x.y>=l?x=new ge(x.x+(l-x.y)/(S.y-x.y)*(S.x-x.x),l)._round():S.y>=l&&(S=new ge(x.x+(l-x.y)/(S.y-x.y)*(S.x-x.x),l)._round()),g&&x.equals(g[g.length-1])||(g=[x],u.push(g)),g.push(S)))))}}return u}Ee("FeatureIndex",Sp,{omit:["rawTileData","sourceLayerCoder"]});class ga extends ge{constructor(t,r,a,l){super(t,r),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new ga(this.x,this.y,this.angle,this.segment)}}function kp(i,t,r,a,l){if(t.segment===void 0||r===0)return!0;let u=t,d=t.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=i[d].dist(u),u=i[d]}m+=i[d].dist(i[d+1]),d++;let g=[],v=0;for(;m<r/2;){let x=i[d],S=i[d+1];if(!S)return!1;let T=i[d-1].angleTo(x)-x.angleTo(S);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:T}),v+=T;m-g[0].distance>a;)v-=g.shift().angleDelta;if(v>l)return!1;d++,m+=x.dist(S)}return!0}function Ip(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Ep(i,t,r){return i?.6*t*r:0}function Pp(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Cg(i,t,r,a,l,u){let d=Ep(r,l,u),m=Pp(r,a)*u,g=0,v=Ip(i)/2;for(let x=0;x<i.length-1;x++){let S=i[x],T=i[x+1],E=S.dist(T);if(g+E>v){let A=(v-g)/E,D=xi.number(S.x,T.x,A),O=xi.number(S.y,T.y,A),j=new ga(D,O,T.angleTo(S),x);return j._round(),!d||kp(i,j,m,d,t)?j:void 0}g+=E}}function Mg(i,t,r,a,l,u,d,m,g){let v=Ep(a,u,d),x=Pp(a,l),S=x*d,T=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return t-S<t/4&&(t=S+t/4),Ap(i,T?t/2*m%t:(x/2+2*u)*d*m%t,t,v,r,S,T,!1,g)}function Ap(i,t,r,a,l,u,d,m,g){let v=u/2,x=Ip(i),S=0,T=t-r,E=[];for(let A=0;A<i.length-1;A++){let D=i[A],O=i[A+1],j=D.dist(O),ie=O.angleTo(D);for(;T+r<S+j;){T+=r;let W=(T-S)/j,ee=xi.number(D.x,O.x,W),oe=xi.number(D.y,O.y,W);if(ee>=0&&ee<g&&oe>=0&&oe<g&&T-v>=0&&T+v<=x){let pe=new ga(ee,oe,ie,A);pe._round(),a&&!kp(i,pe,u,a,l)||E.push(pe)}}S+=j}return m||E.length||d||(E=Ap(i,S/2,r,a,l,u,d,!0,g)),E}Ee("Anchor",ga);let as=Vi;function zp(i,t,r,a){let l=[],u=i.image,d=u.pixelRatio,m=u.paddedRect.w-2*as,g=u.paddedRect.h-2*as,v={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom},x=u.stretchX||[[0,m]],S=u.stretchY||[[0,g]],T=(he,Re)=>he+Re[1]-Re[0],E=x.reduce(T,0),A=S.reduce(T,0),D=m-E,O=g-A,j=0,ie=E,W=0,ee=A,oe=0,pe=D,Te=0,Ve=O;if(u.content&&a){let he=u.content,Re=he[2]-he[0],De=he[3]-he[1];(u.textFitWidth||u.textFitHeight)&&(v=ap(i)),j=Hc(x,0,he[0]),W=Hc(S,0,he[1]),ie=Hc(x,he[0],he[2]),ee=Hc(S,he[1],he[3]),oe=he[0]-j,Te=he[1]-W,pe=Re-ie,Ve=De-ee}let Ce=v.x1,we=v.y1,Le=v.x2-Ce,Pe=v.y2-we,Ie=(he,Re,De,$e)=>{let xt=Wc(he.stretch-j,ie,Le,Ce),vt=Xc(he.fixed-oe,pe,he.stretch,E),Zt=Wc(Re.stretch-W,ee,Pe,we),Er=Xc(Re.fixed-Te,Ve,Re.stretch,A),ai=Wc(De.stretch-j,ie,Le,Ce),Gt=Xc(De.fixed-oe,pe,De.stretch,E),Ci=Wc($e.stretch-W,ee,Pe,we),Mi=Xc($e.fixed-Te,Ve,$e.stretch,A),Ti=new ge(xt,Zt),Ft=new ge(ai,Zt),Ht=new ge(ai,Ci),fi=new ge(xt,Ci),oi=new ge(vt/d,Er/d),ki=new ge(Gt/d,Mi/d),si=t*Math.PI/180;if(si){let st=Math.sin(si),St=Math.cos(si),It=[St,-st,st,St];Ti._matMult(It),Ft._matMult(It),fi._matMult(It),Ht._matMult(It)}let ur=he.stretch+he.fixed,qi=Re.stretch+Re.fixed;return{tl:Ti,tr:Ft,bl:fi,br:Ht,tex:{x:u.paddedRect.x+as+ur,y:u.paddedRect.y+as+qi,w:De.stretch+De.fixed-ur,h:$e.stretch+$e.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:oi,pixelOffsetBR:ki,minFontScaleX:pe/d/Le,minFontScaleY:Ve/d/Pe,isSDF:r}};if(a&&(u.stretchX||u.stretchY)){let he=Dp(x,D,E),Re=Dp(S,O,A);for(let De=0;De<he.length-1;De++){let $e=he[De],xt=he[De+1];for(let vt=0;vt<Re.length-1;vt++)l.push(Ie($e,Re[vt],xt,Re[vt+1]))}}else l.push(Ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return l}function Hc(i,t,r){let a=0;for(let l of i)a+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return a}function Dp(i,t,r){let a=[{fixed:-as,stretch:0}];for(let[l,u]of i){let d=a[a.length-1];a.push({fixed:l-d.stretch,stretch:d.stretch}),a.push({fixed:l-d.stretch,stretch:d.stretch+(u-l)})}return a.push({fixed:t+as,stretch:r}),a}function Wc(i,t,r,a){return i/t*r+a}function Xc(i,t,r,a){return i-t*r/a}class Kc{constructor(t,r,a,l,u,d,m,g,v,x){var S;if(this.boxStartIndex=t.length,v){let T=d.top,E=d.bottom,A=d.collisionPadding;A&&(T-=A[1],E+=A[3]);let D=E-T;D>0&&(D=Math.max(10,D),this.circleDiameter=D)}else{let T=!((S=d.image)===null||S===void 0)&&S.content&&(d.image.textFitWidth||d.image.textFitHeight)?ap(d):{x1:d.left,y1:d.top,x2:d.right,y2:d.bottom};T.y1=T.y1*m-g[0],T.y2=T.y2*m+g[2],T.x1=T.x1*m-g[3],T.x2=T.x2*m+g[1];let E=d.collisionPadding;if(E&&(T.x1-=E[0]*m,T.y1-=E[1]*m,T.x2+=E[2]*m,T.y2+=E[3]*m),x){let A=new ge(T.x1,T.y1),D=new ge(T.x2,T.y1),O=new ge(T.x1,T.y2),j=new ge(T.x2,T.y2),ie=x*Math.PI/180;A._rotate(ie),D._rotate(ie),O._rotate(ie),j._rotate(ie),T.x1=Math.min(A.x,D.x,O.x,j.x),T.x2=Math.max(A.x,D.x,O.x,j.x),T.y1=Math.min(A.y,D.y,O.y,j.y),T.y2=Math.max(A.y,D.y,O.y,j.y)}t.emplaceBack(r.x,r.y,T.x1,T.y1,T.x2,T.y2,a,l,u)}this.boxEndIndex=t.length}}class Tg{constructor(t=[],r=(a,l)=>a<l?-1:a>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:r,compare:a}=this,l=r[t];for(;t>0;){let u=t-1>>1,d=r[u];if(a(l,d)>=0)break;r[t]=d,t=u}r[t]=l}_down(t){let{data:r,compare:a}=this,l=this.length>>1,u=r[t];for(;t<l;){let d=1+(t<<1),m=d+1;if(m<this.length&&a(r[m],r[d])<0&&(d=m),a(r[d],u)>=0)break;r[t]=r[d],t=d}r[t]=u}}function kg(i,t=1,r=!1){let a=1/0,l=1/0,u=-1/0,d=-1/0,m=i[0];for(let E=0;E<m.length;E++){let A=m[E];(!E||A.x<a)&&(a=A.x),(!E||A.y<l)&&(l=A.y),(!E||A.x>u)&&(u=A.x),(!E||A.y>d)&&(d=A.y)}let g=Math.min(u-a,d-l),v=g/2,x=new Tg([],Ig);if(g===0)return new ge(a,l);for(let E=a;E<u;E+=g)for(let A=l;A<d;A+=g)x.push(new os(E+v,A+v,v,i));let S=function(E){let A=0,D=0,O=0,j=E[0];for(let ie=0,W=j.length,ee=W-1;ie<W;ee=ie++){let oe=j[ie],pe=j[ee],Te=oe.x*pe.y-pe.x*oe.y;D+=(oe.x+pe.x)*Te,O+=(oe.y+pe.y)*Te,A+=3*Te}return new os(D/A,O/A,0,E)}(i),T=x.length;for(;x.length;){let E=x.pop();(E.d>S.d||!S.d)&&(S=E,r&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,T)),E.max-S.d<=t||(v=E.h/2,x.push(new os(E.p.x-v,E.p.y-v,v,i)),x.push(new os(E.p.x+v,E.p.y-v,v,i)),x.push(new os(E.p.x-v,E.p.y+v,v,i)),x.push(new os(E.p.x+v,E.p.y+v,v,i)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${S.d}`)),S.p}function Ig(i,t){return t.max-i.max}function os(i,t,r,a){this.p=new ge(i,t),this.h=r,this.d=function(l,u){let d=!1,m=1/0;for(let g=0;g<u.length;g++){let v=u[g];for(let x=0,S=v.length,T=S-1;x<S;T=x++){let E=v[x],A=v[T];E.y>l.y!=A.y>l.y&&l.x<(A.x-E.x)*(l.y-E.y)/(A.y-E.y)+E.x&&(d=!d),m=Math.min(m,gd(l,E,A))}}return(d?1:-1)*Math.sqrt(m)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var ni;w.aq=void 0,(ni=w.aq||(w.aq={}))[ni.center=1]="center",ni[ni.left=2]="left",ni[ni.right=3]="right",ni[ni.top=4]="top",ni[ni.bottom=5]="bottom",ni[ni["top-left"]=6]="top-left",ni[ni["top-right"]=7]="top-right",ni[ni["bottom-left"]=8]="bottom-left",ni[ni["bottom-right"]=9]="bottom-right";let _a=7,zu=Number.POSITIVE_INFINITY;function Lp(i,t){return t[1]!==zu?function(r,a,l){let u=0,d=0;switch(a=Math.abs(a),l=Math.abs(l),r){case"top-right":case"top-left":case"top":d=l-_a;break;case"bottom-right":case"bottom-left":case"bottom":d=-l+_a}switch(r){case"top-right":case"bottom-right":case"right":u=-a;break;case"top-left":case"bottom-left":case"left":u=a}return[u,d]}(i,t[0],t[1]):function(r,a){let l=0,u=0;a<0&&(a=0);let d=a/Math.SQRT2;switch(r){case"top-right":case"top-left":u=d-_a;break;case"bottom-right":case"bottom-left":u=-d+_a;break;case"bottom":u=-a+_a;break;case"top":u=a-_a}switch(r){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=a;break;case"right":l=-a}return[l,u]}(i,t[0])}function Rp(i,t,r){var a;let l=i.layout,u=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(u){let m=u.values,g=[];for(let v=0;v<m.length;v+=2){let x=g[v]=m[v],S=m[v+1].map(T=>T*Ut);x.startsWith("top")?S[1]-=_a:x.startsWith("bottom")&&(S[1]+=_a),g[v+1]=S}return new Ui(g)}let d=l.get("text-variable-anchor");if(d){let m;m=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Ut,zu]:l.get("text-offset").evaluate(t,{},r).map(v=>v*Ut);let g=[];for(let v of d)g.push(v,Lp(v,m));return new Ui(g)}return null}function Du(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Eg(i,t,r,a,l,u,d,m,g,v,x){let S=u.textMaxSize.evaluate(t,{});S===void 0&&(S=d);let T=i.layers[0].layout,E=T.get("icon-offset").evaluate(t,{},x),A=Bp(r.horizontal),D=d/24,O=i.tilePixelRatio*D,j=i.tilePixelRatio*S/24,ie=i.tilePixelRatio*m,W=i.tilePixelRatio*T.get("symbol-spacing"),ee=T.get("text-padding")*i.tilePixelRatio,oe=function(he,Re,De,$e=1){let xt=he.get("icon-padding").evaluate(Re,{},De),vt=xt&&xt.values;return[vt[0]*$e,vt[1]*$e,vt[2]*$e,vt[3]*$e]}(T,t,x,i.tilePixelRatio),pe=T.get("text-max-angle")/180*Math.PI,Te=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",Ve=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Ce=T.get("symbol-placement"),we=W/2,Le=T.get("icon-text-fit"),Pe;a&&Le!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Pe=op(a,r.vertical,Le,T.get("icon-text-fit-padding"),E,D)),A&&(a=op(a,A,Le,T.get("icon-text-fit-padding"),E,D)));let Ie=(he,Re)=>{Re.x<0||Re.x>=jt||Re.y<0||Re.y>=jt||function(De,$e,xt,vt,Zt,Er,ai,Gt,Ci,Mi,Ti,Ft,Ht,fi,oi,ki,si,ur,qi,st,St,It,Ki,Dt,ss){let tn=De.addToLineVertexArray($e,xt),rn,Pr,dr,Yt,kn=0,Ol=0,Np=0,jp=0,Nu=-1,ju=-1,In={},Up=Ho("");if(De.allowVerticalPlacement&&vt.vertical){let gi=Gt.layout.get("text-rotate").evaluate(St,{},Dt)+90;dr=new Kc(Ci,$e,Mi,Ti,Ft,vt.vertical,Ht,fi,oi,gi),ai&&(Yt=new Kc(Ci,$e,Mi,Ti,Ft,ai,si,ur,oi,gi))}if(Zt){let gi=Gt.layout.get("icon-rotate").evaluate(St,{}),pr=Gt.layout.get("icon-text-fit")!=="none",ro=zp(Zt,gi,Ki,pr),jr=ai?zp(ai,gi,Ki,pr):void 0;Pr=new Kc(Ci,$e,Mi,Ti,Ft,Zt,si,ur,!1,gi),kn=4*ro.length;let no=De.iconSizeData,nn=null;no.kind==="source"?(nn=[en*Gt.layout.get("icon-size").evaluate(St,{})],nn[0]>ma&&Qt(`${De.layerIds[0]}: Value for "icon-size" is >= ${Dl}. Reduce your "icon-size".`)):no.kind==="composite"&&(nn=[en*It.compositeIconSizes[0].evaluate(St,{},Dt),en*It.compositeIconSizes[1].evaluate(St,{},Dt)],(nn[0]>ma||nn[1]>ma)&&Qt(`${De.layerIds[0]}: Value for "icon-size" is >= ${Dl}. Reduce your "icon-size".`)),De.addSymbols(De.icon,ro,nn,st,qi,St,w.ah.none,$e,tn.lineStartIndex,tn.lineLength,-1,Dt),Nu=De.icon.placedSymbolArray.length-1,jr&&(Ol=4*jr.length,De.addSymbols(De.icon,jr,nn,st,qi,St,w.ah.vertical,$e,tn.lineStartIndex,tn.lineLength,-1,Dt),ju=De.icon.placedSymbolArray.length-1)}let $p=Object.keys(vt.horizontal);for(let gi of $p){let pr=vt.horizontal[gi];if(!rn){Up=Ho(pr.text);let jr=Gt.layout.get("text-rotate").evaluate(St,{},Dt);rn=new Kc(Ci,$e,Mi,Ti,Ft,pr,Ht,fi,oi,jr)}let ro=pr.positionedLines.length===1;if(Np+=Fp(De,$e,pr,Er,Gt,oi,St,ki,tn,vt.vertical?w.ah.horizontal:w.ah.horizontalOnly,ro?$p:[gi],In,Nu,It,Dt),ro)break}vt.vertical&&(jp+=Fp(De,$e,vt.vertical,Er,Gt,oi,St,ki,tn,w.ah.vertical,["vertical"],In,ju,It,Dt));let zg=rn?rn.boxStartIndex:De.collisionBoxArray.length,Dg=rn?rn.boxEndIndex:De.collisionBoxArray.length,Lg=dr?dr.boxStartIndex:De.collisionBoxArray.length,Rg=dr?dr.boxEndIndex:De.collisionBoxArray.length,Fg=Pr?Pr.boxStartIndex:De.collisionBoxArray.length,Bg=Pr?Pr.boxEndIndex:De.collisionBoxArray.length,Og=Yt?Yt.boxStartIndex:De.collisionBoxArray.length,Vg=Yt?Yt.boxEndIndex:De.collisionBoxArray.length,Nr=-1,Yc=(gi,pr)=>gi&&gi.circleDiameter?Math.max(gi.circleDiameter,pr):pr;Nr=Yc(rn,Nr),Nr=Yc(dr,Nr),Nr=Yc(Pr,Nr),Nr=Yc(Yt,Nr);let Zp=Nr>-1?1:0;Zp&&(Nr*=ss/Ut),De.glyphOffsetArray.length>=ns.MAX_GLYPHS&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),St.sortKey!==void 0&&De.addToSortKeyRanges(De.symbolInstances.length,St.sortKey);let qg=Rp(Gt,St,Dt),[Ng,jg]=function(gi,pr){let ro=gi.length,jr=pr?.values;if(jr?.length>0)for(let no=0;no<jr.length;no+=2){let nn=jr[no+1];gi.emplaceBack(w.aq[jr[no]],nn[0],nn[1])}return[ro,gi.length]}(De.textAnchorOffsets,qg);De.symbolInstances.emplaceBack($e.x,$e.y,In.right>=0?In.right:-1,In.center>=0?In.center:-1,In.left>=0?In.left:-1,In.vertical||-1,Nu,ju,Up,zg,Dg,Lg,Rg,Fg,Bg,Og,Vg,Mi,Np,jp,kn,Ol,Zp,0,Ht,Nr,Ng,jg)}(i,Re,he,r,a,l,Pe,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,O,[ee,ee,ee,ee],Te,g,ie,oe,Ve,E,t,u,v,x,d)};if(Ce==="line")for(let he of Tp(t.geometry,0,0,jt,jt)){let Re=Mg(he,W,pe,r.vertical||A,a,24,j,i.overscaling,jt);for(let De of Re)A&&Pg(i,A.text,we,De)||Ie(he,De)}else if(Ce==="line-center"){for(let he of t.geometry)if(he.length>1){let Re=Cg(he,pe,r.vertical||A,a,24,j);Re&&Ie(he,Re)}}else if(t.type==="Polygon")for(let he of So(t.geometry,0)){let Re=kg(he,16);Ie(he[0],new ga(Re.x,Re.y,0))}else if(t.type==="LineString")for(let he of t.geometry)Ie(he,new ga(he[0].x,he[0].y,0));else if(t.type==="Point")for(let he of t.geometry)for(let Re of he)Ie([Re],new ga(Re.x,Re.y,0))}function Fp(i,t,r,a,l,u,d,m,g,v,x,S,T,E,A){let D=function(ie,W,ee,oe,pe,Te,Ve,Ce){let we=oe.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Le=[];for(let Pe of W.positionedLines)for(let Ie of Pe.positionedGlyphs){if(!Ie.rect)continue;let he=Ie.rect||{},Re=Yd+1,De=!0,$e=1,xt=0,vt=(pe||Ce)&&Ie.vertical,Zt=Ie.metrics.advance*Ie.scale/2;if(Ce&&W.verticalizable&&(xt=Pe.lineOffset/2-(Ie.imageName?-(Ut-Ie.metrics.width*Ie.scale)/2:(Ie.scale-1)*Ut)),Ie.imageName){let st=Ve[Ie.imageName];De=st.sdf,$e=st.pixelRatio,Re=Vi/$e}let Er=pe?[Ie.x+Zt,Ie.y]:[0,0],ai=pe?[0,0]:[Ie.x+Zt+ee[0],Ie.y+ee[1]-xt],Gt=[0,0];vt&&(Gt=ai,ai=[0,0]);let Ci=Ie.metrics.isDoubleResolution?2:1,Mi=(Ie.metrics.left-Re)*Ie.scale-Zt+ai[0],Ti=(-Ie.metrics.top-Re)*Ie.scale+ai[1],Ft=Mi+he.w/Ci*Ie.scale/$e,Ht=Ti+he.h/Ci*Ie.scale/$e,fi=new ge(Mi,Ti),oi=new ge(Ft,Ti),ki=new ge(Mi,Ht),si=new ge(Ft,Ht);if(vt){let st=new ge(-Zt,Zt-Al),St=-Math.PI/2,It=Ut/2-Zt,Ki=new ge(5-Al-It,-(Ie.imageName?It:0)),Dt=new ge(...Gt);fi._rotateAround(St,st)._add(Ki)._add(Dt),oi._rotateAround(St,st)._add(Ki)._add(Dt),ki._rotateAround(St,st)._add(Ki)._add(Dt),si._rotateAround(St,st)._add(Ki)._add(Dt)}if(we){let st=Math.sin(we),St=Math.cos(we),It=[St,-st,st,St];fi._matMult(It),oi._matMult(It),ki._matMult(It),si._matMult(It)}let ur=new ge(0,0),qi=new ge(0,0);Le.push({tl:fi,tr:oi,bl:ki,br:si,tex:he,writingMode:W.writingMode,glyphOffset:Er,sectionIndex:Ie.sectionIndex,isSDF:De,pixelOffsetTL:ur,pixelOffsetBR:qi,minFontScaleX:0,minFontScaleY:0})}return Le}(0,r,m,l,u,d,a,i.allowVerticalPlacement),O=i.textSizeData,j=null;O.kind==="source"?(j=[en*l.layout.get("text-size").evaluate(d,{})],j[0]>ma&&Qt(`${i.layerIds[0]}: Value for "text-size" is >= ${Dl}. Reduce your "text-size".`)):O.kind==="composite"&&(j=[en*E.compositeTextSizes[0].evaluate(d,{},A),en*E.compositeTextSizes[1].evaluate(d,{},A)],(j[0]>ma||j[1]>ma)&&Qt(`${i.layerIds[0]}: Value for "text-size" is >= ${Dl}. Reduce your "text-size".`)),i.addSymbols(i.text,D,j,m,u,d,v,t,g.lineStartIndex,g.lineLength,T,A);for(let ie of x)S[ie]=i.text.placedSymbolArray.length-1;return 4*D.length}function Bp(i){for(let t in i)return i[t];return null}function Pg(i,t,r,a){let l=i.compareText;if(t in l){let u=l[t];for(let d=u.length-1;d>=0;d--)if(a.dist(u[d])<r)return!0}else l[t]=[];return l[t].push(a),!1}let Op=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Lu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let u=Op[15&a];if(!u)throw new Error("Unrecognized array type.");let[d]=new Uint16Array(t,2,1),[m]=new Uint32Array(t,4,1);return new Lu(m,d,u,t)}constructor(t,r=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let u=Op.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,m=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-m%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+m+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ru(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:d,nodeSize:m}=this,g=[0,u.length-1,0],v=[];for(;g.length;){let x=g.pop()||0,S=g.pop()||0,T=g.pop()||0;if(S-T<=m){for(let O=T;O<=S;O++){let j=d[2*O],ie=d[2*O+1];j>=t&&j<=a&&ie>=r&&ie<=l&&v.push(u[O])}continue}let E=T+S>>1,A=d[2*E],D=d[2*E+1];A>=t&&A<=a&&D>=r&&D<=l&&v.push(u[E]),(x===0?t<=A:r<=D)&&(g.push(T),g.push(E-1),g.push(1-x)),(x===0?a>=A:l>=D)&&(g.push(E+1),g.push(S),g.push(1-x))}return v}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:d}=this,m=[0,l.length-1,0],g=[],v=a*a;for(;m.length;){let x=m.pop()||0,S=m.pop()||0,T=m.pop()||0;if(S-T<=d){for(let O=T;O<=S;O++)qp(u[2*O],u[2*O+1],t,r)<=v&&g.push(l[O]);continue}let E=T+S>>1,A=u[2*E],D=u[2*E+1];qp(A,D,t,r)<=v&&g.push(l[E]),(x===0?t-a<=A:r-a<=D)&&(m.push(T),m.push(E-1),m.push(1-x)),(x===0?t+a>=A:r+a>=D)&&(m.push(E+1),m.push(S),m.push(1-x))}return g}}function Ru(i,t,r,a,l,u){if(l-a<=r)return;let d=a+l>>1;Vp(i,t,d,a,l,u),Ru(i,t,r,a,d-1,1-u),Ru(i,t,r,d+1,l,1-u)}function Vp(i,t,r,a,l,u){for(;l>a;){if(l-a>600){let v=l-a+1,x=r-a+1,S=Math.log(v),T=.5*Math.exp(2*S/3),E=.5*Math.sqrt(S*T*(v-T)/v)*(x-v/2<0?-1:1);Vp(i,t,r,Math.max(a,Math.floor(r-x*T/v+E)),Math.min(l,Math.floor(r+(v-x)*T/v+E)),u)}let d=t[2*r+u],m=a,g=l;for(Fl(i,t,a,r),t[2*l+u]>d&&Fl(i,t,a,l);m<g;){for(Fl(i,t,m,g),m++,g--;t[2*m+u]<d;)m++;for(;t[2*g+u]>d;)g--}t[2*a+u]===d?Fl(i,t,a,g):(g++,Fl(i,t,g,l)),g<=r&&(a=g+1),r<=g&&(l=g-1)}}function Fl(i,t,r,a){Fu(i,r,a),Fu(t,2*r,2*a),Fu(t,2*r+1,2*a+1)}function Fu(i,t,r){let a=i[t];i[t]=i[r],i[r]=a}function qp(i,t,r,a){let l=i-r,u=t-a;return l*l+u*u}var Bu;w.bg=void 0,(Bu=w.bg||(w.bg={})).create="create",Bu.load="load",Bu.fullLoad="fullLoad";let Jc=null,Bl=[],Ou=1e3/60,Vu="loadTime",qu="fullLoadTime",Ag={mark(i){performance.mark(i)},frame(i){let t=i;Jc!=null&&Bl.push(t-Jc),Jc=t},clearMetrics(){Jc=null,Bl=[],performance.clearMeasures(Vu),performance.clearMeasures(qu);for(let i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(Vu,w.bg.create,w.bg.load),performance.measure(qu,w.bg.create,w.bg.fullLoad);let i=performance.getEntriesByName(Vu)[0].duration,t=performance.getEntriesByName(qu)[0].duration,r=Bl.length,a=1/(Bl.reduce((u,d)=>u+d,0)/r/1e3),l=Bl.filter(u=>u>Ou).reduce((u,d)=>u+(d-Ou)/Ou,0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};w.$=class extends C{},w.A=Yo,w.B=Wh,w.C=function(i){if(Dn==null){let t=i.navigator?i.navigator.userAgent:null;Dn=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Dn},w.D=Ae,w.E=Fn,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wg(()=>this.process()),this.subscription=function(r,a,l,u){return r.addEventListener(a,l,!1),{unsubscribe:()=>{r.removeEventListener(a,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Dr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,a)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];let m={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(m)},{once:!0});let u=[],d=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:ia(i.data,u)});this.target.postMessage(d,{transfer:u})})}receive(i){let t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];let a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(Dr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;let i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return p(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(ra(t.error)):l.resolve(ra(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let r=ra(t.data),a=new AbortController;this.abortControllers[i]=a;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){let a=[];delete this.abortControllers[i];let l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ia(t):null,data:ia(r,a)};this.target.postMessage(l,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=Rn,w.H=function(){var i=new Yo(16);return Yo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=bu,w.J=function(i,t,r){var a,l,u,d,m,g,v,x,S,T,E,A,D=r[0],O=r[1],j=r[2];return t===i?(i[12]=t[0]*D+t[4]*O+t[8]*j+t[12],i[13]=t[1]*D+t[5]*O+t[9]*j+t[13],i[14]=t[2]*D+t[6]*O+t[10]*j+t[14],i[15]=t[3]*D+t[7]*O+t[11]*j+t[15]):(l=t[1],u=t[2],d=t[3],m=t[4],g=t[5],v=t[6],x=t[7],S=t[8],T=t[9],E=t[10],A=t[11],i[0]=a=t[0],i[1]=l,i[2]=u,i[3]=d,i[4]=m,i[5]=g,i[6]=v,i[7]=x,i[8]=S,i[9]=T,i[10]=E,i[11]=A,i[12]=a*D+m*O+S*j+t[12],i[13]=l*D+g*O+T*j+t[13],i[14]=u*D+v*O+E*j+t[14],i[15]=d*D+x*O+A*j+t[15]),i},w.K=function(i,t,r){var a=r[0],l=r[1],u=r[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*u,i[9]=t[9]*u,i[10]=t[10]*u,i[11]=t[11]*u,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=xd,w.M=function(i,t){let r={};for(let a=0;a<t.length;a++){let l=t[a];l in i&&(r[l]=i[l])}return r},w.N=fa,w.O=fp,w.P=ge,w.Q=gp,w.R=cr,w.S=hr,w.T=jo,w.U=zr,w.V=Ta,w.W=ln,w.X=jt,w.Y=f,w.Z=Ll,w._=p,w.a=$r,w.a$=function(i,t){var r=i[0],a=i[1],l=i[2],u=i[3],d=i[4],m=i[5],g=i[6],v=i[7],x=i[8],S=i[9],T=i[10],E=i[11],A=i[12],D=i[13],O=i[14],j=i[15],ie=t[0],W=t[1],ee=t[2],oe=t[3],pe=t[4],Te=t[5],Ve=t[6],Ce=t[7],we=t[8],Le=t[9],Pe=t[10],Ie=t[11],he=t[12],Re=t[13],De=t[14],$e=t[15];return Math.abs(r-ie)<=Si*Math.max(1,Math.abs(r),Math.abs(ie))&&Math.abs(a-W)<=Si*Math.max(1,Math.abs(a),Math.abs(W))&&Math.abs(l-ee)<=Si*Math.max(1,Math.abs(l),Math.abs(ee))&&Math.abs(u-oe)<=Si*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(d-pe)<=Si*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(m-Te)<=Si*Math.max(1,Math.abs(m),Math.abs(Te))&&Math.abs(g-Ve)<=Si*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(v-Ce)<=Si*Math.max(1,Math.abs(v),Math.abs(Ce))&&Math.abs(x-we)<=Si*Math.max(1,Math.abs(x),Math.abs(we))&&Math.abs(S-Le)<=Si*Math.max(1,Math.abs(S),Math.abs(Le))&&Math.abs(T-Pe)<=Si*Math.max(1,Math.abs(T),Math.abs(Pe))&&Math.abs(E-Ie)<=Si*Math.max(1,Math.abs(E),Math.abs(Ie))&&Math.abs(A-he)<=Si*Math.max(1,Math.abs(A),Math.abs(he))&&Math.abs(D-Re)<=Si*Math.max(1,Math.abs(D),Math.abs(Re))&&Math.abs(O-De)<=Si*Math.max(1,Math.abs(O),Math.abs(De))&&Math.abs(j-$e)<=Si*Math.max(1,Math.abs(j),Math.abs($e))},w.a0=rt,w.a1=Au,w.a2=fe,w.a3=i=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(let a of i){let l=window.document.createElement("source");hn(a)||(t.crossOrigin="Anonymous"),l.src=a,t.appendChild(l)}})},w.a4=function(){return ho++},w.a5=Me,w.a6=ns,w.a7=el,w.a8=to,w.a9=wp,w.aA=function(i){if(i.type==="custom")return new bg(i);switch(i.type){case"background":return new yg(i);case"circle":return new af(i);case"fill":return new wf(i);case"fill-extrusion":return new Bf(i);case"heatmap":return new sf(i);case"hillshade":return new cf(i);case"line":return new Zf(i);case"raster":return new xg(i);case"symbol":return new Gc(i)}},w.aB=gt,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!lt(i.version,t.version))return[{command:"setStyle",args:[t]}];lt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),lt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),lt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),lt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),lt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),lt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),lt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),lt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),lt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),lt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),lt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});let a={},l=[];(function(d,m,g,v){let x;for(x in m=m||{},d=d||{})Object.prototype.hasOwnProperty.call(d,x)&&(Object.prototype.hasOwnProperty.call(m,x)||Hr(x,g,v));for(x in m)Object.prototype.hasOwnProperty.call(m,x)&&(Object.prototype.hasOwnProperty.call(d,x)?lt(d[x],m[x])||(d[x].type==="geojson"&&m[x].type==="geojson"&&Bn(d,m,x)?At(g,{command:"setGeoJSONSourceData",args:[x,m[x].data]}):Fr(x,m,g,v)):Pa(x,m,g))})(i.sources,t.sources,l,a);let u=[];i.layers&&i.layers.forEach(d=>{"source"in d&&a[d.source]?r.push({command:"removeLayer",args:[d.id]}):u.push(d)}),r=r.concat(l),function(d,m,g){m=m||[];let v=(d=d||[]).map(Aa),x=m.map(Aa),S=d.reduce(za,{}),T=m.reduce(za,{}),E=v.slice(),A=Object.create(null),D,O,j,ie,W;for(let ee=0,oe=0;ee<v.length;ee++)D=v[ee],Object.prototype.hasOwnProperty.call(T,D)?oe++:(At(g,{command:"removeLayer",args:[D]}),E.splice(E.indexOf(D,oe),1));for(let ee=0,oe=0;ee<x.length;ee++)D=x[x.length-1-ee],E[E.length-1-ee]!==D&&(Object.prototype.hasOwnProperty.call(S,D)?(At(g,{command:"removeLayer",args:[D]}),E.splice(E.lastIndexOf(D,E.length-oe),1)):oe++,ie=E[E.length-ee],At(g,{command:"addLayer",args:[T[D],ie]}),E.splice(E.length-ee,0,D),A[D]=!0);for(let ee=0;ee<x.length;ee++)if(D=x[ee],O=S[D],j=T[D],!A[D]&&!lt(O,j))if(lt(O.source,j.source)&&lt(O["source-layer"],j["source-layer"])&&lt(O.type,j.type)){for(W in ji(O.layout,j.layout,g,D,null,"setLayoutProperty"),ji(O.paint,j.paint,g,D,null,"setPaintProperty"),lt(O.filter,j.filter)||At(g,{command:"setFilter",args:[D,j.filter]}),lt(O.minzoom,j.minzoom)&&lt(O.maxzoom,j.maxzoom)||At(g,{command:"setLayerZoomRange",args:[D,j.minzoom,j.maxzoom]}),O)Object.prototype.hasOwnProperty.call(O,W)&&W!=="layout"&&W!=="paint"&&W!=="filter"&&W!=="metadata"&&W!=="minzoom"&&W!=="maxzoom"&&(W.indexOf("paint.")===0?ji(O[W],j[W],g,D,W.slice(6),"setPaintProperty"):lt(O[W],j[W])||At(g,{command:"setLayerProperty",args:[D,W,j[W]]}));for(W in j)Object.prototype.hasOwnProperty.call(j,W)&&!Object.prototype.hasOwnProperty.call(O,W)&&W!=="layout"&&W!=="paint"&&W!=="filter"&&W!=="metadata"&&W!=="minzoom"&&W!=="maxzoom"&&(W.indexOf("paint.")===0?ji(O[W],j[W],g,D,W.slice(6),"setPaintProperty"):lt(O[W],j[W])||At(g,{command:"setLayerProperty",args:[D,W,j[W]]}))}else At(g,{command:"removeLayer",args:[D]}),ie=E[E.lastIndexOf(D)+1],At(g,{command:"addLayer",args:[j,ie]})}(u,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){let t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let a in t)if(!i(t[a],r[a]))return!1;return!0}return t===r},w.aF=yr,w.aG=ka,w.aH=class extends Ya{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=Dc,w.aJ=class extends Ya{constructor(i,t){super(i,t),this.current=Km}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=cd,w.aL=hd,w.aM=pt,w.aN=class extends Ya{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends Ya{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,a,l,u,d){var m=1/(t-r),g=1/(a-l),v=1/(u-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(t+r)*m,i[13]=(l+a)*g,i[14]=(d+u)*v,i[15]=1,i},w.aQ=nf,w.aR=class extends K{},w.aS=Xf,w.aT=class extends re{},w.aU=cu,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=Md,w.aX=ii,w.aY=lr,w.aZ=class extends ze{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){let t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,l,u)=>{let d=l||u;return t[a]=!d||d.toLowerCase(),""}),t["max-age"]){let r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){let r=[];for(let a in i)a in t||r.push(a);return r},w.ac=Yi,w.ad=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[0],d=t[1],m=t[2],g=t[3],v=t[4],x=t[5],S=t[6],T=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=u*l+v*a,i[1]=d*l+x*a,i[2]=m*l+S*a,i[3]=g*l+T*a,i[4]=v*l-u*a,i[5]=x*l-d*a,i[6]=S*l-m*a,i[7]=T*l-g*a,i},w.ae=function(i){var t=new Yo(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=Bc,w.ag=function(i,t){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:l,minZoom:u,maxZoom:d}=i,m=l?Yi(bi.interpolationFactor(l,t,u,d),0,1):0;i.kind==="camera"?a=xi.number(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:a}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:l}){return i.kind==="source"?a/en:i.kind==="composite"?xi.number(a/en,l/en,r):t},w.aj=Mu,w.ak=function(i,t,r,a){let l=t.y-i.y,u=t.x-i.x,d=a.y-r.y,m=a.x-r.x,g=d*u-m*l;if(g===0)return null;let v=(m*(i.y-r.y)-d*(i.x-r.x))/g;return new ge(i.x+v*u,i.y+v*l)},w.al=Tp,w.am=md,w.an=ou,w.ao=function(i){let t=1/0,r=1/0,a=-1/0,l=-1/0;for(let u of i)t=Math.min(t,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),l=Math.max(l,u.y);return[t,r,a,l]},w.ap=Ut,w.ar=Cu,w.as=function(i,t){var r=t[0],a=t[1],l=t[2],u=t[3],d=t[4],m=t[5],g=t[6],v=t[7],x=t[8],S=t[9],T=t[10],E=t[11],A=t[12],D=t[13],O=t[14],j=t[15],ie=r*m-a*d,W=r*g-l*d,ee=r*v-u*d,oe=a*g-l*m,pe=a*v-u*m,Te=l*v-u*g,Ve=x*D-S*A,Ce=x*O-T*A,we=x*j-E*A,Le=S*O-T*D,Pe=S*j-E*D,Ie=T*j-E*O,he=ie*Ie-W*Pe+ee*Le+oe*we-pe*Ce+Te*Ve;return he?(i[0]=(m*Ie-g*Pe+v*Le)*(he=1/he),i[1]=(l*Pe-a*Ie-u*Le)*he,i[2]=(D*Te-O*pe+j*oe)*he,i[3]=(T*pe-S*Te-E*oe)*he,i[4]=(g*we-d*Ie-v*Ce)*he,i[5]=(r*Ie-l*we+u*Ce)*he,i[6]=(O*ee-A*Te-j*W)*he,i[7]=(x*Te-T*ee+E*W)*he,i[8]=(d*Pe-m*we+v*Ve)*he,i[9]=(a*we-r*Pe-u*Ve)*he,i[10]=(A*pe-D*ee+j*ie)*he,i[11]=(S*ee-x*pe-E*ie)*he,i[12]=(m*Ce-d*Le-g*Ve)*he,i[13]=(r*Le-a*Ce+l*Ve)*he,i[14]=(D*W-A*oe-O*ie)*he,i[15]=(x*oe-S*W+T*ie)*he,i):null},w.at=Du,w.au=Su,w.av=Lu,w.aw=function(){let i={},t=ae.$version;for(let r in ae.$root){let a=ae.$root[r];if(a.required){let l=null;l=r==="version"?t:a.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},w.ax=ml,w.ay=er,w.az=function(i){i=i.slice();let t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Ea(i[r],t[i[r].ref]));return i},w.b=vr,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=_r,w.b4=vp,w.b5=_p,w.b6=function(i,t,r,a,l){var u,d=1/Math.tan(t/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+a)*(u=1/(a-l)),i[14]=2*l*a*u):(i[10]=-1,i[14]=-2*a),i},w.b7=function(i,t,r){var a=Math.sin(r),l=Math.cos(r),u=t[4],d=t[5],m=t[6],g=t[7],v=t[8],x=t[9],S=t[10],T=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=u*l+v*a,i[5]=d*l+x*a,i[6]=m*l+S*a,i[7]=g*l+T*a,i[8]=v*l-u*a,i[9]=x*l-d*a,i[10]=S*l-m*a,i[11]=T*l-g*a,i},w.b8=Ai,w.b9=Ps,w.bA=Zd,w.bB=function(i){return i.message===Qi},w.bC=Xn,w.bD=Bi,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){let{x:r,y:a}=Ll.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends b{},w.be=Eu,w.bf=Ag,w.bh=zi,w.bi=function(i,t){$r.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete $r.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){let r={};for(let l=0;l<i.length;l++){let u=t&&t[i[l].id]||bc(i[l]);t&&(t[i[l].id]=u);let d=r[u];d||(d=r[u]=[]),d.push(i[l])}let a=[];for(let l in r)a.push(r[l]);return a},w.bl=Ee,w.bm=bp,w.bn=Sp,w.bo=ep,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=jt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;let t=i.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new Ct(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Ct(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Ct(18))};if(i.bucket.textSizeData.kind==="composite"){let{minZoom:v,maxZoom:x}=i.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Ct(v),i.canonical),a["text-size"].possiblyEvaluate(new Ct(x),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){let{minZoom:v,maxZoom:x}=i.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Ct(v),i.canonical),a["icon-size"].possiblyEvaluate(new Ct(x),i.canonical)]}let u=r.get("text-line-height")*Ut,d=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",m=r.get("text-keep-upright"),g=r.get("text-size");for(let v of i.bucket.features){let x=r.get("text-font").evaluate(v,{},i.canonical).join(","),S=g.evaluate(v,{},i.canonical),T=l.layoutTextSize.evaluate(v,{},i.canonical),E=l.layoutIconSize.evaluate(v,{},i.canonical),A={horizontal:{},vertical:void 0},D=v.text,O,j=[0,0];if(D){let ee=D.toString(),oe=r.get("text-letter-spacing").evaluate(v,{},i.canonical)*Ut,pe=Xh(ee)?oe:0,Te=r.get("text-anchor").evaluate(v,{},i.canonical),Ve=Rp(t,v,i.canonical);if(!Ve){let Pe=r.get("text-radial-offset").evaluate(v,{},i.canonical);j=Pe?Lp(Te,[Pe*Ut,zu]):r.get("text-offset").evaluate(v,{},i.canonical).map(Ie=>Ie*Ut)}let Ce=d?"center":r.get("text-justify").evaluate(v,{},i.canonical),we=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(v,{},i.canonical)*Ut:1/0,Le=()=>{i.bucket.allowVerticalPlacement&&fl(ee)&&(A.vertical=Uc(D,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,u,Te,"left",pe,j,w.ah.vertical,!0,T,S))};if(!d&&Ve){let Pe=new Set;if(Ce==="auto")for(let he=0;he<Ve.values.length;he+=2)Pe.add(Du(Ve.values[he]));else Pe.add(Ce);let Ie=!1;for(let he of Pe)if(!A.horizontal[he])if(Ie)A.horizontal[he]=A.horizontal[0];else{let Re=Uc(D,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,u,"center",he,pe,j,w.ah.horizontal,!1,T,S);Re&&(A.horizontal[he]=Re,Ie=Re.positionedLines.length===1)}Le()}else{Ce==="auto"&&(Ce=Du(Te));let Pe=Uc(D,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,u,Te,Ce,pe,j,w.ah.horizontal,!1,T,S);Pe&&(A.horizontal[Ce]=Pe),Le(),fl(ee)&&d&&m&&(A.vertical=Uc(D,i.glyphMap,i.glyphPositions,i.imagePositions,x,we,u,Te,Ce,pe,j,w.ah.vertical,!1,T,S))}}let ie=!1;if(v.icon&&v.icon.name){let ee=i.imageMap[v.icon.name];ee&&(O=pg(i.imagePositions[v.icon.name],r.get("icon-offset").evaluate(v,{},i.canonical),r.get("icon-anchor").evaluate(v,{},i.canonical)),ie=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ie:i.bucket.sdfIcons!==ie&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}let W=Bp(A.horizontal)||A.vertical;i.bucket.iconsInText=!!W&&W.iconsInText,(W||O)&&Eg(i.bucket,v,A,O,i.imageMap,l,T,E,j,ie,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=_u,w.br=mu,w.bs=gu,w.bt=da,w.bu=vu,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,a,l){return p(this,void 0,void 0,function*(){if(Ta())try{return yield ln(i,t,r,a,l)}catch{}return function(u,d,m,g,v){let x=u.width,S=u.height;Lr&&yi||(Lr=new OffscreenCanvas(x,S),yi=Lr.getContext("2d",{willReadFrequently:!0})),Lr.width=x,Lr.height=S,yi.drawImage(u,0,0,x,S);let T=yi.getImageData(d,m,g,v);return yi.clearRect(0,0,x,S),T.data}(i,t,r,a,l)})},w.bx=xp,w.by=Fe,w.bz=Pt,w.c=Ln,w.d=i=>p(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=Ni,w.f=i=>new Promise((t,r)=>{let a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=po})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(l):po}),w.g=xr,w.h=(i,t)=>cn(Ni(i,{type:"json"}),t),w.i=Dr,w.j=Gr,w.k=Zr,w.l=(i,t)=>cn(Ni(i,{type:"arrayBuffer"}),t),w.m=cn,w.n=function(i){return new vu(i).readFields(og,[])},w.o=Cl,w.p=Qd,w.q=h,w.r=Hh,w.s=hn,w.t=dl,w.u=Sn,w.v=ae,w.w=Qt,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=xi,w.z=Ct}),z("worker",["./shared"],function(w){"use strict";class p{constructor(I){this.keyCache={},I&&this.replace(I)}replace(I){this._layerConfigs={},this._layers={},this.update(I,[])}update(I,k){for(let V of I){this._layerConfigs[V.id]=V;let X=this._layers[V.id]=w.aA(V);X._featureFilter=w.a7(X.filter),this.keyCache[V.id]&&delete this.keyCache[V.id]}for(let V of k)delete this.keyCache[V],delete this._layerConfigs[V],delete this._layers[V];this.familiesBySource={};let R=w.bk(Object.values(this._layerConfigs),this.keyCache);for(let V of R){let X=V.map(ne=>this._layers[ne.id]),Y=X[0];if(Y.visibility==="none")continue;let te=Y.source||"",Z=this.familiesBySource[te];Z||(Z=this.familiesBySource[te]={});let se=Y.sourceLayer||"_geojsonTileLayer",de=Z[se];de||(de=Z[se]=[]),de.push(X)}}}class Fe{constructor(I){let k={},R=[];for(let te in I){let Z=I[te],se=k[te]={};for(let de in Z){let ne=Z[+de];if(!ne||ne.bitmap.width===0||ne.bitmap.height===0)continue;let _e={x:0,y:0,w:ne.bitmap.width+2,h:ne.bitmap.height+2};R.push(_e),se[de]={rect:_e,metrics:ne.metrics}}}let{w:V,h:X}=w.p(R),Y=new w.o({width:V||1,height:X||1});for(let te in I){let Z=I[te];for(let se in Z){let de=Z[+se];if(!de||de.bitmap.width===0||de.bitmap.height===0)continue;let ne=k[te][se].rect;w.o.copy(de.bitmap,Y,{x:0,y:0},{x:ne.x+1,y:ne.y+1},de.bitmap)}}this.image=Y,this.positions=k}}w.bl("GlyphAtlas",Fe);class Pt{constructor(I){this.tileID=new w.S(I.tileID.overscaledZ,I.tileID.wrap,I.tileID.canonical.z,I.tileID.canonical.x,I.tileID.canonical.y),this.uid=I.uid,this.zoom=I.zoom,this.pixelRatio=I.pixelRatio,this.tileSize=I.tileSize,this.source=I.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=I.showCollisionBoxes,this.collectResourceTiming=!!I.collectResourceTiming,this.returnDependencies=!!I.returnDependencies,this.promoteId=I.promoteId,this.inFlightDependencies=[]}parse(I,k,R,V){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=I,this.collisionBoxArray=new w.a5;let X=new w.bm(Object.keys(I.layers).sort()),Y=new w.bn(this.tileID,this.promoteId);Y.bucketLayerIDs=[];let te={},Z={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:R},se=k.familiesBySource[this.source];for(let Je in se){let dt=I.layers[Je];if(!dt)continue;dt.version===1&&w.w(`Vector tile source "${this.source}" layer "${Je}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Et=X.encode(Je),$t=[];for(let Kt=0;Kt<dt.length;Kt++){let di=dt.feature(Kt),On=Y.getId(di,Je);$t.push({feature:di,id:On,index:Kt,sourceLayerIndex:Et})}for(let Kt of se[Je]){let di=Kt[0];di.source!==this.source&&w.w(`layer.source = ${di.source} does not equal this.source = ${this.source}`),di.minzoom&&this.zoom<Math.floor(di.minzoom)||di.maxzoom&&this.zoom>=di.maxzoom||di.visibility!=="none"&&(bt(Kt,this.zoom,R),(te[di.id]=di.createBucket({index:Y.bucketLayerIDs.length,layers:Kt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Et,sourceID:this.source})).populate($t,Z,this.tileID.canonical),Y.bucketLayerIDs.push(Kt.map(On=>On.id)))}}let de=w.aF(Z.glyphDependencies,Je=>Object.keys(Je).map(Number));this.inFlightDependencies.forEach(Je=>Je?.abort()),this.inFlightDependencies=[];let ne=Promise.resolve({});if(Object.keys(de).length){let Je=new AbortController;this.inFlightDependencies.push(Je),ne=V.sendAsync({type:"GG",data:{stacks:de,source:this.source,tileID:this.tileID,type:"glyphs"}},Je)}let _e=Object.keys(Z.iconDependencies),Be=Promise.resolve({});if(_e.length){let Je=new AbortController;this.inFlightDependencies.push(Je),Be=V.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},Je)}let Oe=Object.keys(Z.patternDependencies),nt=Promise.resolve({});if(Oe.length){let Je=new AbortController;this.inFlightDependencies.push(Je),nt=V.sendAsync({type:"GI",data:{icons:Oe,source:this.source,tileID:this.tileID,type:"patterns"}},Je)}let[He,at,et]=yield Promise.all([ne,Be,nt]),qt=new Fe(He),zt=new w.bo(at,et);for(let Je in te){let dt=te[Je];dt instanceof w.a6?(bt(dt.layers,this.zoom,R),w.bp({bucket:dt,glyphMap:He,glyphPositions:qt.positions,imageMap:at,imagePositions:zt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):dt.hasPattern&&(dt instanceof w.bq||dt instanceof w.br||dt instanceof w.bs)&&(bt(dt.layers,this.zoom,R),dt.addFeatures(Z,this.tileID.canonical,zt.patternPositions))}return this.status="done",{buckets:Object.values(te).filter(Je=>!Je.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qt.image,imageAtlas:zt,glyphMap:this.returnDependencies?He:null,iconMap:this.returnDependencies?at:null,glyphPositions:this.returnDependencies?qt.positions:null}})}}function bt(N,I,k){let R=new w.z(I);for(let V of N)V.recalculate(R,k)}class ge{constructor(I,k,R){this.actor=I,this.layerIndex=k,this.availableImages=R,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(I,k){return w._(this,void 0,void 0,function*(){let R=yield w.l(I.request,k);try{return{vectorTile:new w.bt.VectorTile(new w.bu(R.data)),rawData:R.data,cacheControl:R.cacheControl,expires:R.expires}}catch(V){let X=new Uint8Array(R.data),Y=`Unable to parse the tile at ${I.request.url}, `;throw Y+=X[0]===31&&X[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${V.message}`,new Error(Y)}})}loadTile(I){return w._(this,void 0,void 0,function*(){let k=I.uid,R=!!(I&&I.request&&I.request.collectResourceTiming)&&new w.bv(I.request),V=new Pt(I);this.loading[k]=V;let X=new AbortController;V.abort=X;try{let Y=yield this.loadVectorTile(I,X);if(delete this.loading[k],!Y)return null;let te=Y.rawData,Z={};Y.expires&&(Z.expires=Y.expires),Y.cacheControl&&(Z.cacheControl=Y.cacheControl);let se={};if(R){let ne=R.finish();ne&&(se.resourceTiming=JSON.parse(JSON.stringify(ne)))}V.vectorTile=Y.vectorTile;let de=V.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[k]=V,this.fetching[k]={rawTileData:te,cacheControl:Z,resourceTiming:se};try{let ne=yield de;return w.e({rawTileData:te.slice(0)},ne,Z,se)}finally{delete this.fetching[k]}}catch(Y){throw delete this.loading[k],V.status="done",this.loaded[k]=V,Y}})}reloadTile(I){return w._(this,void 0,void 0,function*(){let k=I.uid;if(!this.loaded||!this.loaded[k])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let R=this.loaded[k];if(R.showCollisionBoxes=I.showCollisionBoxes,R.status==="parsing"){let V=yield R.parse(R.vectorTile,this.layerIndex,this.availableImages,this.actor),X;if(this.fetching[k]){let{rawTileData:Y,cacheControl:te,resourceTiming:Z}=this.fetching[k];delete this.fetching[k],X=w.e({rawTileData:Y.slice(0)},V,te,Z)}else X=V;return X}if(R.status==="done"&&R.vectorTile)return R.parse(R.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(I){return w._(this,void 0,void 0,function*(){let k=this.loading,R=I.uid;k&&k[R]&&k[R].abort&&(k[R].abort.abort(),delete k[R])})}removeTile(I){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[I.uid]&&delete this.loaded[I.uid]})}}class le{constructor(){this.loaded={}}loadTile(I){return w._(this,void 0,void 0,function*(){let{uid:k,encoding:R,rawImageData:V,redFactor:X,greenFactor:Y,blueFactor:te,baseShift:Z}=I,se=V.width+2,de=V.height+2,ne=w.b(V)?new w.R({width:se,height:de},yield w.bw(V,-1,-1,se,de)):V,_e=new w.bx(k,ne,R,X,Y,te,Z);return this.loaded=this.loaded||{},this.loaded[k]=_e,_e})}removeTile(I){let k=this.loaded,R=I.uid;k&&k[R]&&delete k[R]}}function Ji(N,I){if(N.length!==0){_i(N[0],I);for(var k=1;k<N.length;k++)_i(N[k],!I)}}function _i(N,I){for(var k=0,R=0,V=0,X=N.length,Y=X-1;V<X;Y=V++){var te=(N[V][0]-N[Y][0])*(N[Y][1]+N[V][1]),Z=k+te;R+=Math.abs(k)>=Math.abs(te)?k-Z+te:te-Z+k,k=Z}k+R>=0!=!!I&&N.reverse()}var Pi=w.by(function N(I,k){var R,V=I&&I.type;if(V==="FeatureCollection")for(R=0;R<I.features.length;R++)N(I.features[R],k);else if(V==="GeometryCollection")for(R=0;R<I.geometries.length;R++)N(I.geometries[R],k);else if(V==="Feature")N(I.geometry,k);else if(V==="Polygon")Ji(I.coordinates,k);else if(V==="MultiPolygon")for(R=0;R<I.coordinates.length;R++)Ji(I.coordinates[R],k);return I});let Ur=w.bt.VectorTileFeature.prototype.toGeoJSON;var zr={exports:{}},Ta=w.bz,Ai=w.bt.VectorTileFeature,Ps=Yi;function Yi(N,I){this.options=I||{},this.features=N,this.length=N.length}function _r(N,I){this.id=typeof N.id=="number"?N.id:void 0,this.type=N.type,this.rawGeometry=N.type===1?[N.geometry]:N.geometry,this.properties=N.tags,this.extent=I||4096}Yi.prototype.feature=function(N){return new _r(this.features[N],this.options.extent)},_r.prototype.loadGeometry=function(){var N=this.rawGeometry;this.geometry=[];for(var I=0;I<N.length;I++){for(var k=N[I],R=[],V=0;V<k.length;V++)R.push(new Ta(k[V][0],k[V][1]));this.geometry.push(R)}return this.geometry},_r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var N=this.geometry,I=1/0,k=-1/0,R=1/0,V=-1/0,X=0;X<N.length;X++)for(var Y=N[X],te=0;te<Y.length;te++){var Z=Y[te];I=Math.min(I,Z.x),k=Math.max(k,Z.x),R=Math.min(R,Z.y),V=Math.max(V,Z.y)}return[I,R,k,V]},_r.prototype.toGeoJSON=Ai.prototype.toGeoJSON;var Ni=w.bA,ho=Ps;function yr(N){var I=new Ni;return function(k,R){for(var V in k.layers)R.writeMessage(3,ka,k.layers[V])}(N,I),I.finish()}function ka(N,I){var k;I.writeVarintField(15,N.version||1),I.writeStringField(1,N.name||""),I.writeVarintField(5,N.extent||4096);var R={keys:[],values:[],keycache:{},valuecache:{}};for(k=0;k<N.length;k++)R.feature=N.feature(k),I.writeMessage(2,gt,R);var V=R.keys;for(k=0;k<V.length;k++)I.writeStringField(3,V[k]);var X=R.values;for(k=0;k<X.length;k++)I.writeMessage(4,Dn,X[k])}function gt(N,I){var k=N.feature;k.id!==void 0&&I.writeVarintField(1,k.id),I.writeMessage(2,uo,N),I.writeVarintField(3,k.type),I.writeMessage(4,Dr,k)}function uo(N,I){var k=N.feature,R=N.keys,V=N.values,X=N.keycache,Y=N.valuecache;for(var te in k.properties){var Z=k.properties[te],se=X[te];if(Z!==null){se===void 0&&(R.push(te),X[te]=se=R.length-1),I.writeVarint(se);var de=typeof Z;de!=="string"&&de!=="boolean"&&de!=="number"&&(Z=JSON.stringify(Z));var ne=de+":"+Z,_e=Y[ne];_e===void 0&&(V.push(Z),Y[ne]=_e=V.length-1),I.writeVarint(_e)}}}function Qt(N,I){return(I<<3)+(7&N)}function hi(N){return N<<1^N>>31}function Dr(N,I){for(var k=N.loadGeometry(),R=N.type,V=0,X=0,Y=k.length,te=0;te<Y;te++){var Z=k[te],se=1;R===1&&(se=Z.length),I.writeVarint(Qt(1,se));for(var de=R===3?Z.length-1:Z.length,ne=0;ne<de;ne++){ne===1&&R!==1&&I.writeVarint(Qt(2,de-1));var _e=Z[ne].x-V,Be=Z[ne].y-X;I.writeVarint(hi(_e)),I.writeVarint(hi(Be)),V+=_e,X+=Be}R===3&&I.writeVarint(Qt(7,1))}}function Dn(N,I){var k=typeof N;k==="string"?I.writeStringField(1,N):k==="boolean"?I.writeBooleanField(7,N):k==="number"&&(N%1!=0?I.writeDoubleField(3,N):N<0?I.writeSVarintField(6,N):I.writeVarintField(5,N))}zr.exports=yr,zr.exports.fromVectorTileJs=yr,zr.exports.fromGeojsonVt=function(N,I){I=I||{};var k={};for(var R in N)k[R]=new ho(N[R].features,I),k[R].name=R,k[R].version=I.version,k[R].extent=I.extent;return yr({layers:k})},zr.exports.GeoJSONWrapper=ho;var vr=w.by(zr.exports);let po={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:N=>N},ln=Math.fround||(Lr=new Float32Array(1),N=>(Lr[0]=+N,Lr[0]));var Lr;let yi=3,Qi=5,Ln=6;class $r{constructor(I){this.options=Object.assign(Object.create(po),I),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(I){let{log:k,minZoom:R,maxZoom:V}=this.options;k&&console.time("total time");let X=`prepare ${I.length} points`;k&&console.time(X),this.points=I;let Y=[];for(let Z=0;Z<I.length;Z++){let se=I[Z];if(!se.geometry)continue;let[de,ne]=se.geometry.coordinates,_e=ln(zi(de)),Be=ln(er(ne));Y.push(_e,Be,1/0,Z,-1,1),this.options.reduce&&Y.push(0)}let te=this.trees[V+1]=this._createTree(Y);k&&console.timeEnd(X);for(let Z=V;Z>=R;Z--){let se=+Date.now();te=this.trees[Z]=this._createTree(this._cluster(te,Z)),k&&console.log("z%d: %d clusters in %dms",Z,te.numItems,+Date.now()-se)}return k&&console.timeEnd("total time"),this}getClusters(I,k){let R=((I[0]+180)%360+360)%360-180,V=Math.max(-90,Math.min(90,I[1])),X=I[2]===180?180:((I[2]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,I[3]));if(I[2]-I[0]>=360)R=-180,X=180;else if(R>X){let ne=this.getClusters([R,V,180,Y],k),_e=this.getClusters([-180,V,X,Y],k);return ne.concat(_e)}let te=this.trees[this._limitZoom(k)],Z=te.range(zi(R),er(Y),zi(X),er(V)),se=te.data,de=[];for(let ne of Z){let _e=this.stride*ne;de.push(se[_e+Qi]>1?xr(se,_e,this.clusterProps):this.points[se[_e+yi]])}return de}getChildren(I){let k=this._getOriginId(I),R=this._getOriginZoom(I),V="No cluster with the specified id.",X=this.trees[R];if(!X)throw new Error(V);let Y=X.data;if(k*this.stride>=Y.length)throw new Error(V);let te=this.options.radius/(this.options.extent*Math.pow(2,R-1)),Z=X.within(Y[k*this.stride],Y[k*this.stride+1],te),se=[];for(let de of Z){let ne=de*this.stride;Y[ne+4]===I&&se.push(Y[ne+Qi]>1?xr(Y,ne,this.clusterProps):this.points[Y[ne+yi]])}if(se.length===0)throw new Error(V);return se}getLeaves(I,k,R){let V=[];return this._appendLeaves(V,I,k=k||10,R=R||0,0),V}getTile(I,k,R){let V=this.trees[this._limitZoom(I)],X=Math.pow(2,I),{extent:Y,radius:te}=this.options,Z=te/Y,se=(R-Z)/X,de=(R+1+Z)/X,ne={features:[]};return this._addTileFeatures(V.range((k-Z)/X,se,(k+1+Z)/X,de),V.data,k,R,X,ne),k===0&&this._addTileFeatures(V.range(1-Z/X,se,1,de),V.data,X,R,X,ne),k===X-1&&this._addTileFeatures(V.range(0,se,Z/X,de),V.data,-1,R,X,ne),ne.features.length?ne:null}getClusterExpansionZoom(I){let k=this._getOriginZoom(I)-1;for(;k<=this.options.maxZoom;){let R=this.getChildren(I);if(k++,R.length!==1)break;I=R[0].properties.cluster_id}return k}_appendLeaves(I,k,R,V,X){let Y=this.getChildren(k);for(let te of Y){let Z=te.properties;if(Z&&Z.cluster?X+Z.point_count<=V?X+=Z.point_count:X=this._appendLeaves(I,Z.cluster_id,R,V,X):X<V?X++:I.push(te),I.length===R)break}return X}_createTree(I){let k=new w.av(I.length/this.stride|0,this.options.nodeSize,Float32Array);for(let R=0;R<I.length;R+=this.stride)k.add(I[R],I[R+1]);return k.finish(),k.data=I,k}_addTileFeatures(I,k,R,V,X,Y){for(let te of I){let Z=te*this.stride,se=k[Z+Qi]>1,de,ne,_e;if(se)de=Rn(k,Z,this.clusterProps),ne=k[Z],_e=k[Z+1];else{let nt=this.points[k[Z+yi]];de=nt.properties;let[He,at]=nt.geometry.coordinates;ne=zi(He),_e=er(at)}let Be={type:1,geometry:[[Math.round(this.options.extent*(ne*X-R)),Math.round(this.options.extent*(_e*X-V))]],tags:de},Oe;Oe=se||this.options.generateId?k[Z+yi]:this.points[k[Z+yi]].id,Oe!==void 0&&(Be.id=Oe),Y.features.push(Be)}}_limitZoom(I){return Math.max(this.options.minZoom,Math.min(Math.floor(+I),this.options.maxZoom+1))}_cluster(I,k){let{radius:R,extent:V,reduce:X,minPoints:Y}=this.options,te=R/(V*Math.pow(2,k)),Z=I.data,se=[],de=this.stride;for(let ne=0;ne<Z.length;ne+=de){if(Z[ne+2]<=k)continue;Z[ne+2]=k;let _e=Z[ne],Be=Z[ne+1],Oe=I.within(Z[ne],Z[ne+1],te),nt=Z[ne+Qi],He=nt;for(let at of Oe){let et=at*de;Z[et+2]>k&&(He+=Z[et+Qi])}if(He>nt&&He>=Y){let at,et=_e*nt,qt=Be*nt,zt=-1,Je=((ne/de|0)<<5)+(k+1)+this.points.length;for(let dt of Oe){let Et=dt*de;if(Z[Et+2]<=k)continue;Z[Et+2]=k;let $t=Z[Et+Qi];et+=Z[Et]*$t,qt+=Z[Et+1]*$t,Z[Et+4]=Je,X&&(at||(at=this._map(Z,ne,!0),zt=this.clusterProps.length,this.clusterProps.push(at)),X(at,this._map(Z,Et)))}Z[ne+4]=Je,se.push(et/He,qt/He,1/0,Je,-1,He),X&&se.push(zt)}else{for(let at=0;at<de;at++)se.push(Z[ne+at]);if(He>1)for(let at of Oe){let et=at*de;if(!(Z[et+2]<=k)){Z[et+2]=k;for(let qt=0;qt<de;qt++)se.push(Z[et+qt])}}}}return se}_getOriginId(I){return I-this.points.length>>5}_getOriginZoom(I){return(I-this.points.length)%32}_map(I,k,R){if(I[k+Qi]>1){let Y=this.clusterProps[I[k+Ln]];return R?Object.assign({},Y):Y}let V=this.points[I[k+yi]].properties,X=this.options.map(V);return R&&X===V?Object.assign({},X):X}}function xr(N,I,k){return{type:"Feature",id:N[I+yi],properties:Rn(N,I,k),geometry:{type:"Point",coordinates:[(R=N[I],360*(R-.5)),cn(N[I+1])]}};var R}function Rn(N,I,k){let R=N[I+Qi],V=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R,X=N[I+Ln],Y=X===-1?{}:Object.assign({},k[X]);return Object.assign(Y,{cluster:!0,cluster_id:N[I+yi],point_count:R,point_count_abbreviated:V})}function zi(N){return N/360+.5}function er(N){let I=Math.sin(N*Math.PI/180),k=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return k<0?0:k>1?1:k}function cn(N){let I=(180-360*N)*Math.PI/180;return 360*Math.atan(Math.exp(I))/Math.PI-90}function hn(N,I,k,R){let V=R,X=I+(k-I>>1),Y,te=k-I,Z=N[I],se=N[I+1],de=N[k],ne=N[k+1];for(let _e=I+3;_e<k;_e+=3){let Be=Ia(N[_e],N[_e+1],Z,se,de,ne);if(Be>V)Y=_e,V=Be;else if(Be===V){let Oe=Math.abs(_e-X);Oe<te&&(Y=_e,te=Oe)}}V>R&&(Y-I>3&&hn(N,I,Y,R),N[Y+2]=V,k-Y>3&&hn(N,Y,k,R))}function Ia(N,I,k,R,V,X){let Y=V-k,te=X-R;if(Y!==0||te!==0){let Z=((N-k)*Y+(I-R)*te)/(Y*Y+te*te);Z>1?(k=V,R=X):Z>0&&(k+=Y*Z,R+=te*Z)}return Y=N-k,te=I-R,Y*Y+te*te}function Rr(N,I,k,R){let V={id:N??null,type:I,geometry:k,tags:R,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(I==="Point"||I==="MultiPoint"||I==="LineString")Zr(V,k);else if(I==="Polygon")Zr(V,k[0]);else if(I==="MultiLineString")for(let X of k)Zr(V,X);else if(I==="MultiPolygon")for(let X of k)Zr(V,X[0]);return V}function Zr(N,I){for(let k=0;k<I.length;k+=3)N.minX=Math.min(N.minX,I[k]),N.minY=Math.min(N.minY,I[k+1]),N.maxX=Math.max(N.maxX,I[k]),N.maxY=Math.max(N.maxY,I[k+1])}function Gr(N,I,k,R){if(!I.geometry)return;let V=I.geometry.coordinates;if(V&&V.length===0)return;let X=I.geometry.type,Y=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),te=[],Z=I.id;if(k.promoteId?Z=I.properties[k.promoteId]:k.generateId&&(Z=R||0),X==="Point")Fn(V,te);else if(X==="MultiPoint")for(let se of V)Fn(se,te);else if(X==="LineString")ae(V,te,Y,!1);else if(X==="MultiLineString"){if(k.lineMetrics){for(let se of V)te=[],ae(se,te,Y,!1),N.push(Rr(Z,"LineString",te,I.properties));return}un(V,te,Y,!1)}else if(X==="Polygon")un(V,te,Y,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(let se of I.geometry.geometries)Gr(N,{id:Z,geometry:se,properties:I.properties},k,R);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let se of V){let de=[];un(se,de,Y,!0),te.push(de)}}N.push(Rr(Z,X,te,I.properties))}function Fn(N,I){I.push(Ea(N[0]),lt(N[1]),0)}function ae(N,I,k,R){let V,X,Y=0;for(let Z=0;Z<N.length;Z++){let se=Ea(N[Z][0]),de=lt(N[Z][1]);I.push(se,de,0),Z>0&&(Y+=R?(V*de-se*X)/2:Math.sqrt(Math.pow(se-V,2)+Math.pow(de-X,2))),V=se,X=de}let te=I.length-3;I[2]=1,hn(I,0,te,k),I[te+2]=1,I.size=Math.abs(Y),I.start=0,I.end=I.size}function un(N,I,k,R){for(let V=0;V<N.length;V++){let X=[];ae(N[V],X,k,R),I.push(X)}}function Ea(N){return N/360+.5}function lt(N){let I=Math.sin(N*Math.PI/180),k=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return k<0?0:k>1?1:k}function At(N,I,k,R,V,X,Y,te){if(R/=I,X>=(k/=I)&&Y<R)return N;if(Y<k||X>=R)return null;let Z=[];for(let se of N){let de=se.geometry,ne=se.type,_e=V===0?se.minX:se.minY,Be=V===0?se.maxX:se.maxY;if(_e>=k&&Be<R){Z.push(se);continue}if(Be<k||_e>=R)continue;let Oe=[];if(ne==="Point"||ne==="MultiPoint")Pa(de,Oe,k,R,V);else if(ne==="LineString")Hr(de,Oe,k,R,V,!1,te.lineMetrics);else if(ne==="MultiLineString")Bn(de,Oe,k,R,V,!1);else if(ne==="Polygon")Bn(de,Oe,k,R,V,!0);else if(ne==="MultiPolygon")for(let nt of de){let He=[];Bn(nt,He,k,R,V,!0),He.length&&Oe.push(He)}if(Oe.length){if(te.lineMetrics&&ne==="LineString"){for(let nt of Oe)Z.push(Rr(se.id,ne,nt,se.tags));continue}ne!=="LineString"&&ne!=="MultiLineString"||(Oe.length===1?(ne="LineString",Oe=Oe[0]):ne="MultiLineString"),ne!=="Point"&&ne!=="MultiPoint"||(ne=Oe.length===3?"Point":"MultiPoint"),Z.push(Rr(se.id,ne,Oe,se.tags))}}return Z.length?Z:null}function Pa(N,I,k,R,V){for(let X=0;X<N.length;X+=3){let Y=N[X+V];Y>=k&&Y<=R&&ji(I,N[X],N[X+1],N[X+2])}}function Hr(N,I,k,R,V,X,Y){let te=Fr(N),Z=V===0?Aa:za,se,de,ne=N.start;for(let He=0;He<N.length-3;He+=3){let at=N[He],et=N[He+1],qt=N[He+2],zt=N[He+3],Je=N[He+4],dt=V===0?at:et,Et=V===0?zt:Je,$t=!1;Y&&(se=Math.sqrt(Math.pow(at-zt,2)+Math.pow(et-Je,2))),dt<k?Et>k&&(de=Z(te,at,et,zt,Je,k),Y&&(te.start=ne+se*de)):dt>R?Et<R&&(de=Z(te,at,et,zt,Je,R),Y&&(te.start=ne+se*de)):ji(te,at,et,qt),Et<k&&dt>=k&&(de=Z(te,at,et,zt,Je,k),$t=!0),Et>R&&dt<=R&&(de=Z(te,at,et,zt,Je,R),$t=!0),!X&&$t&&(Y&&(te.end=ne+se*de),I.push(te),te=Fr(N)),Y&&(ne+=se)}let _e=N.length-3,Be=N[_e],Oe=N[_e+1],nt=V===0?Be:Oe;nt>=k&&nt<=R&&ji(te,Be,Oe,N[_e+2]),_e=te.length-3,X&&_e>=3&&(te[_e]!==te[0]||te[_e+1]!==te[1])&&ji(te,te[0],te[1],te[2]),te.length&&I.push(te)}function Fr(N){let I=[];return I.size=N.size,I.start=N.start,I.end=N.end,I}function Bn(N,I,k,R,V,X){for(let Y of N)Hr(Y,I,k,R,V,X,!1)}function ji(N,I,k,R){N.push(I,k,R)}function Aa(N,I,k,R,V,X){let Y=(X-I)/(R-I);return ji(N,X,k+(V-k)*Y,1),Y}function za(N,I,k,R,V,X){let Y=(X-k)/(V-k);return ji(N,I+(R-I)*Y,X,1),Y}function fe(N,I){let k=[];for(let R=0;R<N.length;R++){let V=N[R],X=V.type,Y;if(X==="Point"||X==="MultiPoint"||X==="LineString")Y=br(V.geometry,I);else if(X==="MultiLineString"||X==="Polygon"){Y=[];for(let te of V.geometry)Y.push(br(te,I))}else if(X==="MultiPolygon"){Y=[];for(let te of V.geometry){let Z=[];for(let se of te)Z.push(br(se,I));Y.push(Z)}}k.push(Rr(V.id,X,Y,V.tags))}return k}function br(N,I){let k=[];k.size=N.size,N.start!==void 0&&(k.start=N.start,k.end=N.end);for(let R=0;R<N.length;R+=3)k.push(N[R]+I,N[R+1],N[R+2]);return k}function ui(N,I){if(N.transformed)return N;let k=1<<N.z,R=N.x,V=N.y;for(let X of N.features){let Y=X.geometry,te=X.type;if(X.geometry=[],te===1)for(let Z=0;Z<Y.length;Z+=2)X.geometry.push(wr(Y[Z],Y[Z+1],I,k,R,V));else for(let Z=0;Z<Y.length;Z++){let se=[];for(let de=0;de<Y[Z].length;de+=2)se.push(wr(Y[Z][de],Y[Z][de+1],I,k,R,V));X.geometry.push(se)}}return N.transformed=!0,N}function wr(N,I,k,R,V,X){return[Math.round(k*(N*R-V)),Math.round(k*(I*R-X))]}function Wr(N,I,k,R,V){let X=I===V.maxZoom?0:V.tolerance/((1<<I)*V.extent),Y={features:[],numPoints:0,numSimplified:0,numFeatures:N.length,source:null,x:k,y:R,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let te of N)xe(Y,te,X,V);return Y}function xe(N,I,k,R){let V=I.geometry,X=I.type,Y=[];if(N.minX=Math.min(N.minX,I.minX),N.minY=Math.min(N.minY,I.minY),N.maxX=Math.max(N.maxX,I.maxX),N.maxY=Math.max(N.maxY,I.maxY),X==="Point"||X==="MultiPoint")for(let te=0;te<V.length;te+=3)Y.push(V[te],V[te+1]),N.numPoints++,N.numSimplified++;else if(X==="LineString")Ke(Y,V,N,k,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(let te=0;te<V.length;te++)Ke(Y,V[te],N,k,X==="Polygon",te===0);else if(X==="MultiPolygon")for(let te=0;te<V.length;te++){let Z=V[te];for(let se=0;se<Z.length;se++)Ke(Y,Z[se],N,k,!0,se===0)}if(Y.length){let te=I.tags||null;if(X==="LineString"&&R.lineMetrics){te={};for(let se in I.tags)te[se]=I.tags[se];te.mapbox_clip_start=V.start/V.size,te.mapbox_clip_end=V.end/V.size}let Z={geometry:Y,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:te};I.id!==null&&(Z.id=I.id),N.features.push(Z)}}function Ke(N,I,k,R,V,X){let Y=R*R;if(R>0&&I.size<(V?Y:R))return void(k.numPoints+=I.length/3);let te=[];for(let Z=0;Z<I.length;Z+=3)(R===0||I[Z+2]>Y)&&(k.numSimplified++,te.push(I[Z],I[Z+1])),k.numPoints++;V&&function(Z,se){let de=0;for(let ne=0,_e=Z.length,Be=_e-2;ne<_e;Be=ne,ne+=2)de+=(Z[ne]-Z[Be])*(Z[ne+1]+Z[Be+1]);if(de>0===se)for(let ne=0,_e=Z.length;ne<_e/2;ne+=2){let Be=Z[ne],Oe=Z[ne+1];Z[ne]=Z[_e-2-ne],Z[ne+1]=Z[_e-1-ne],Z[_e-2-ne]=Be,Z[_e-1-ne]=Oe}}(te,X),N.push(te)}let Ne={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class vi{constructor(I,k){let R=(k=this.options=function(X,Y){for(let te in Y)X[te]=Y[te];return X}(Object.create(Ne),k)).debug;if(R&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");let V=function(X,Y){let te=[];if(X.type==="FeatureCollection")for(let Z=0;Z<X.features.length;Z++)Gr(te,X.features[Z],Y,Z);else Gr(te,X.type==="Feature"?X:{geometry:X},Y);return te}(I,k);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(X,Y){let te=Y.buffer/Y.extent,Z=X,se=At(X,1,-1-te,te,0,-1,2,Y),de=At(X,1,1-te,2+te,0,-1,2,Y);return(se||de)&&(Z=At(X,1,-te,1+te,0,-1,2,Y)||[],se&&(Z=fe(se,1).concat(Z)),de&&(Z=Z.concat(fe(de,-1)))),Z}(V,k),V.length&&this.splitTile(V,0,0,0),R&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(I,k,R,V,X,Y,te){let Z=[I,k,R,V],se=this.options,de=se.debug;for(;Z.length;){V=Z.pop(),R=Z.pop(),k=Z.pop(),I=Z.pop();let ne=1<<k,_e=tr(k,R,V),Be=this.tiles[_e];if(!Be&&(de>1&&console.time("creation"),Be=this.tiles[_e]=Wr(I,k,R,V,se),this.tileCoords.push({z:k,x:R,y:V}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,R,V,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));let $t=`z${k}`;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(Be.source=I,X==null){if(k===se.indexMaxZoom||Be.numPoints<=se.indexMaxPoints)continue}else{if(k===se.maxZoom||k===X)continue;if(X!=null){let $t=X-k;if(R!==Y>>$t||V!==te>>$t)continue}}if(Be.source=null,I.length===0)continue;de>1&&console.time("clipping");let Oe=.5*se.buffer/se.extent,nt=.5-Oe,He=.5+Oe,at=1+Oe,et=null,qt=null,zt=null,Je=null,dt=At(I,ne,R-Oe,R+He,0,Be.minX,Be.maxX,se),Et=At(I,ne,R+nt,R+at,0,Be.minX,Be.maxX,se);I=null,dt&&(et=At(dt,ne,V-Oe,V+He,1,Be.minY,Be.maxY,se),qt=At(dt,ne,V+nt,V+at,1,Be.minY,Be.maxY,se),dt=null),Et&&(zt=At(Et,ne,V-Oe,V+He,1,Be.minY,Be.maxY,se),Je=At(Et,ne,V+nt,V+at,1,Be.minY,Be.maxY,se),Et=null),de>1&&console.timeEnd("clipping"),Z.push(et||[],k+1,2*R,2*V),Z.push(qt||[],k+1,2*R,2*V+1),Z.push(zt||[],k+1,2*R+1,2*V),Z.push(Je||[],k+1,2*R+1,2*V+1)}}getTile(I,k,R){I=+I,k=+k,R=+R;let V=this.options,{extent:X,debug:Y}=V;if(I<0||I>24)return null;let te=1<<I,Z=tr(I,k=k+te&te-1,R);if(this.tiles[Z])return ui(this.tiles[Z],X);Y>1&&console.log("drilling down to z%d-%d-%d",I,k,R);let se,de=I,ne=k,_e=R;for(;!se&&de>0;)de--,ne>>=1,_e>>=1,se=this.tiles[tr(de,ne,_e)];return se&&se.source?(Y>1&&(console.log("found parent tile z%d-%d-%d",de,ne,_e),console.time("drilling down")),this.splitTile(se.source,de,ne,_e,I,k,R),Y>1&&console.timeEnd("drilling down"),this.tiles[Z]?ui(this.tiles[Z],X):null):null}}function tr(N,I,k){return 32*((1<<N)*k+I)+N}function Ge(N,I){return I?N.properties[I]:N.id}function Sr(N,I){if(N==null)return!0;if(N.type==="Feature")return Ge(N,I)!=null;if(N.type==="FeatureCollection"){let k=new Set;for(let R of N.features){let V=Ge(R,I);if(V==null||k.has(V))return!1;k.add(V)}return!0}return!1}function Br(N,I){let k=new Map;if(N!=null)if(N.type==="Feature")k.set(Ge(N,I),N);else for(let R of N.features)k.set(Ge(R,I),R);return k}class Xr extends ge{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(I,k){return w._(this,void 0,void 0,function*(){let R=I.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let V=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!V)return null;let X=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=te.length,this._features=te}feature(te){return new class{constructor(Z){this._feature=Z,this.extent=w.X,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){let Z=[];for(let se of this._feature.geometry)Z.push([new w.P(se[0],se[1])]);return Z}{let Z=[];for(let se of this._feature.geometry){let de=[];for(let ne of se)de.push(new w.P(ne[0],ne[1]));Z.push(de)}return Z}}toGeoJSON(Z,se,de){return Ur.call(this,Z,se,de)}}(this._features[te])}}(V.features),Y=vr(X);return Y.byteOffset===0&&Y.byteLength===Y.buffer.byteLength||(Y=new Uint8Array(Y)),{vectorTile:X,rawData:Y.buffer}})}loadData(I){return w._(this,void 0,void 0,function*(){var k;(k=this._pendingRequest)===null||k===void 0||k.abort();let R=!!(I&&I.request&&I.request.collectResourceTiming)&&new w.bv(I.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(I,this._pendingRequest),this._geoJSONIndex=I.cluster?new $r(function({superclusterOptions:Y,clusterProperties:te}){if(!te||!Y)return Y;let Z={},se={},de={accumulated:null,zoom:0},ne={properties:null},_e=Object.keys(te);for(let Be of _e){let[Oe,nt]=te[Be],He=w.bC(nt),at=w.bC(typeof Oe=="string"?[Oe,["accumulated"],["get",Be]]:Oe);Z[Be]=He.value,se[Be]=at.value}return Y.map=Be=>{ne.properties=Be;let Oe={};for(let nt of _e)Oe[nt]=Z[nt].evaluate(de,ne);return Oe},Y.reduce=(Be,Oe)=>{ne.properties=Oe;for(let nt of _e)de.accumulated=Be[nt],Be[nt]=se[nt].evaluate(de,ne)},Y}(I)).load((yield this._pendingData).features):(V=yield this._pendingData,new vi(V,I.geojsonVtOptions)),this.loaded={};let X={};if(R){let Y=R.finish();Y&&(X.resourceTiming={},X.resourceTiming[I.source]=JSON.parse(JSON.stringify(Y)))}return X}catch(X){if(delete this._pendingRequest,w.bB(X))return{abandoned:!0};throw X}var V})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(I){let k=this.loaded;return k&&k[I.uid]?super.reloadTile(I):this.loadTile(I)}loadAndProcessGeoJSON(I,k){return w._(this,void 0,void 0,function*(){let R=yield this.loadGeoJSON(I,k);if(delete this._pendingRequest,typeof R!="object")throw new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`);if(Pi(R,!0),I.filter){let V=w.bC(I.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(V.result==="error")throw new Error(V.value.map(Y=>`${Y.key}: ${Y.message}`).join(", "));R={type:"FeatureCollection",features:R.features.filter(Y=>V.value.evaluate({zoom:0},Y))}}return R})}loadGeoJSON(I,k){return w._(this,void 0,void 0,function*(){let{promoteId:R}=I;if(I.request){let V=yield w.h(I.request,k);return this._dataUpdateable=Sr(V.data,R)?Br(V.data,R):void 0,V.data}if(typeof I.data=="string")try{let V=JSON.parse(I.data);return this._dataUpdateable=Sr(V,R)?Br(V,R):void 0,V}catch{throw new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`)}if(!I.dataDiff)throw new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${I.source}`);return function(V,X,Y){var te,Z,se,de;if(X.removeAll&&V.clear(),X.remove)for(let ne of X.remove)V.delete(ne);if(X.add)for(let ne of X.add){let _e=Ge(ne,Y);_e!=null&&V.set(_e,ne)}if(X.update)for(let ne of X.update){let _e=V.get(ne.id);if(_e==null)continue;let Be=!ne.removeAllProperties&&(((te=ne.removeProperties)===null||te===void 0?void 0:te.length)>0||((Z=ne.addOrUpdateProperties)===null||Z===void 0?void 0:Z.length)>0);if((ne.newGeometry||ne.removeAllProperties||Be)&&(_e=Object.assign({},_e),V.set(ne.id,_e),Be&&(_e.properties=Object.assign({},_e.properties))),ne.newGeometry&&(_e.geometry=ne.newGeometry),ne.removeAllProperties)_e.properties={};else if(((se=ne.removeProperties)===null||se===void 0?void 0:se.length)>0)for(let Oe of ne.removeProperties)Object.prototype.hasOwnProperty.call(_e.properties,Oe)&&delete _e.properties[Oe];if(((de=ne.addOrUpdateProperties)===null||de===void 0?void 0:de.length)>0)for(let{key:Oe,value:nt}of ne.addOrUpdateProperties)_e.properties[Oe]=nt}}(this._dataUpdateable,I.dataDiff,R),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(I){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(I){return this._geoJSONIndex.getClusterExpansionZoom(I.clusterId)}getClusterChildren(I){return this._geoJSONIndex.getChildren(I.clusterId)}getClusterLeaves(I){return this._geoJSONIndex.getLeaves(I.clusterId,I.limit,I.offset)}}class Cr{constructor(I){this.self=I,this.actor=new w.F(I),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(k,R)=>{if(this.externalWorkerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.externalWorkerSourceTypes[k]=R},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=k=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(k)},this.actor.registerMessageHandler("LDT",(k,R)=>this._getDEMWorkerSource(k,R.source).loadTile(R)),this.actor.registerMessageHandler("RDT",(k,R)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(k,R.source).removeTile(R)})),this.actor.registerMessageHandler("GCEZ",(k,R)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,R.type,R.source).getClusterExpansionZoom(R)})),this.actor.registerMessageHandler("GCC",(k,R)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,R.type,R.source).getClusterChildren(R)})),this.actor.registerMessageHandler("GCL",(k,R)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(k,R.type,R.source).getClusterLeaves(R)})),this.actor.registerMessageHandler("LD",(k,R)=>this._getWorkerSource(k,R.type,R.source).loadData(R)),this.actor.registerMessageHandler("GD",(k,R)=>this._getWorkerSource(k,R.type,R.source).getData()),this.actor.registerMessageHandler("LT",(k,R)=>this._getWorkerSource(k,R.type,R.source).loadTile(R)),this.actor.registerMessageHandler("RT",(k,R)=>this._getWorkerSource(k,R.type,R.source).reloadTile(R)),this.actor.registerMessageHandler("AT",(k,R)=>this._getWorkerSource(k,R.type,R.source).abortTile(R)),this.actor.registerMessageHandler("RMT",(k,R)=>this._getWorkerSource(k,R.type,R.source).removeTile(R)),this.actor.registerMessageHandler("RS",(k,R)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[k]||!this.workerSources[k][R.type]||!this.workerSources[k][R.type][R.source])return;let V=this.workerSources[k][R.type][R.source];delete this.workerSources[k][R.type][R.source],V.removeSource!==void 0&&V.removeSource(R)})),this.actor.registerMessageHandler("RM",k=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[k],delete this.availableImages[k],delete this.workerSources[k],delete this.demWorkerSources[k]})),this.actor.registerMessageHandler("SR",(k,R)=>w._(this,void 0,void 0,function*(){this.referrer=R})),this.actor.registerMessageHandler("SRPS",(k,R)=>this._syncRTLPluginState(k,R)),this.actor.registerMessageHandler("IS",(k,R)=>w._(this,void 0,void 0,function*(){this.self.importScripts(R)})),this.actor.registerMessageHandler("SI",(k,R)=>this._setImages(k,R)),this.actor.registerMessageHandler("UL",(k,R)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(k).update(R.layers,R.removedIds)})),this.actor.registerMessageHandler("SL",(k,R)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(k).replace(R)}))}_setImages(I,k){return w._(this,void 0,void 0,function*(){this.availableImages[I]=k;for(let R in this.workerSources[I]){let V=this.workerSources[I][R];for(let X in V)V[X].availableImages=k}})}_syncRTLPluginState(I,k){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(k.pluginStatus!=="loading")return w.bD.setState(k),k;let R=k.pluginURL;if(this.self.importScripts(R),w.bD.isParsed()){let V={pluginStatus:"loaded",pluginURL:R};return w.bD.setState(V),V}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${R}`)})}_getAvailableImages(I){let k=this.availableImages[I];return k||(k=[]),k}_getLayerIndex(I){let k=this.layerIndexes[I];return k||(k=this.layerIndexes[I]=new p),k}_getWorkerSource(I,k,R){if(this.workerSources[I]||(this.workerSources[I]={}),this.workerSources[I][k]||(this.workerSources[I][k]={}),!this.workerSources[I][k][R]){let V={sendAsync:(X,Y)=>(X.targetMapId=I,this.actor.sendAsync(X,Y))};switch(k){case"vector":this.workerSources[I][k][R]=new ge(V,this._getLayerIndex(I),this._getAvailableImages(I));break;case"geojson":this.workerSources[I][k][R]=new Xr(V,this._getLayerIndex(I),this._getAvailableImages(I));break;default:this.workerSources[I][k][R]=new this.externalWorkerSourceTypes[k](V,this._getLayerIndex(I),this._getAvailableImages(I))}}return this.workerSources[I][k][R]}_getDEMWorkerSource(I,k){return this.demWorkerSources[I]||(this.demWorkerSources[I]={}),this.demWorkerSources[I][k]||(this.demWorkerSources[I][k]=new le),this.demWorkerSources[I][k]}}return w.i(self)&&(self.worker=new Cr(self)),Cr}),z("index",["exports","./shared"],function(w,p){"use strict";var Fe="4.7.1";let Pt,bt,ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:h=>new Promise((e,n)=>{let o=requestAnimationFrame(e);h.signal.addEventListener("abort",()=>{cancelAnimationFrame(o),n(p.c())})}),getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){let e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,n.drawImage(h,0,0,h.width,h.height),n},resolveURL:h=>(Pt||(Pt=document.createElement("a")),Pt.href=h,Pt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(bt==null&&(bt=matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)}};class le{static testProp(e){if(!le.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in le.docStyle)return e[n];return e[0]}static create(e,n,o){let s=window.document.createElement(e);return n!==void 0&&(s.className=n),o&&o.appendChild(s),s}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){le.docStyle&&le.selectProp&&(le.userSelect=le.docStyle[le.selectProp],le.docStyle[le.selectProp]="none")}static enableDrag(){le.docStyle&&le.selectProp&&(le.docStyle[le.selectProp]=le.userSelect)}static setTransform(e,n){e.style[le.transformProp]=n}static addEventListener(e,n,o,s={}){e.addEventListener(n,o,"passive"in s?s:s.capture)}static removeEventListener(e,n,o,s={}){e.removeEventListener(n,o,"passive"in s?s:s.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",le.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",le.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",le.suppressClickInternal,!0)},0)}static getScale(e){let n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,o){let s=n.boundingClientRect;return new p.P((o.clientX-s.left)/n.x-e.clientLeft,(o.clientY-s.top)/n.y-e.clientTop)}static mousePos(e,n){let o=le.getScale(e);return le.getPoint(e,o,n)}static touchPos(e,n){let o=[],s=le.getScale(e);for(let c=0;c<n.length;c++)o.push(le.getPoint(e,s,n[c]));return o}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}le.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,le.selectProp=le.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),le.transformProp=le.testProp(["transform","WebkitTransform"]);let Ji={supported:!1,testSupport:function(h){!Ur&&Pi&&(zr?Ta(h):_i=h)}},_i,Pi,Ur=!1,zr=!1;function Ta(h){let e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Pi),h.isContextLost())return;Ji.supported=!0}catch{}h.deleteTexture(e),Ur=!0}var Ai;typeof document<"u"&&(Pi=document.createElement("img"),Pi.onload=()=>{_i&&Ta(_i),_i=null,zr=!0},Pi.onerror=()=>{Ur=!0,_i=null},Pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(h){let e,n,o,s;h.resetRequestQueue=()=>{e=[],n=0,o=0,s={}},h.addThrottleControl=y=>{let b=o++;return s[b]=y,b},h.removeThrottleControl=y=>{delete s[y],f()},h.getImage=(y,b,C=!0)=>new Promise((M,P)=>{Ji.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),p.e(y,{type:"image"}),e.push({abortController:b,requestParameters:y,supportImageRefresh:C,state:"queued",onError:L=>{P(L)},onSuccess:L=>{M(L)}}),f()});let c=y=>p._(this,void 0,void 0,function*(){y.state="running";let{requestParameters:b,supportImageRefresh:C,onError:M,onSuccess:P,abortController:L}=y,F=C===!1&&!p.i(self)&&!p.g(b.url)&&(!b.headers||Object.keys(b.headers).reduce(($,G)=>$&&G==="accept",!0));n++;let q=F?_(b,L):p.m(b,L);try{let $=yield q;delete y.abortController,y.state="completed",$.data instanceof HTMLImageElement||p.b($.data)?P($):$.data&&P({data:yield(U=$.data,typeof createImageBitmap=="function"?p.d(U):p.f(U)),cacheControl:$.cacheControl,expires:$.expires})}catch($){delete y.abortController,M($)}finally{n--,f()}var U}),f=()=>{let y=(()=>{for(let b of Object.keys(s))if(s[b]())return!0;return!1})()?p.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:p.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let b=n;b<y&&e.length>0;b++){let C=e.shift();C.abortController.signal.aborted?b--:c(C)}},_=(y,b)=>new Promise((C,M)=>{let P=new Image,L=y.url,F=y.credentials;F&&F==="include"?P.crossOrigin="use-credentials":(F&&F==="same-origin"||!p.s(L))&&(P.crossOrigin="anonymous"),b.signal.addEventListener("abort",()=>{P.src="",M(p.c())}),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,C({data:P})},P.onerror=()=>{P.onerror=P.onload=null,b.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=L})}(Ai||(Ai={})),Ai.resetRequestQueue();class Ps{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Yi(h){var e=new p.A(3);return e[0]=h[0],e[1]=h[1],e[2]=h[2],e}var _r,Ni=function(h,e,n){return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],h};_r=new p.A(3),p.A!=Float32Array&&(_r[0]=0,_r[1]=0,_r[2]=0);var ho=function(h){var e=h[0],n=h[1];return e*e+n*n};function yr(h){let e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){let n=[];for(let{id:o,url:s}of h){let c=`${o}${s}`;n.indexOf(c)===-1&&(n.push(c),e.push({id:o,url:s}))}}return e}function ka(h,e,n){let o=h.split("?");return o[0]+=`${e}${n}`,o.join("?")}(function(){var h=new p.A(2);p.A!=Float32Array&&(h[0]=0,h[1]=0)})();class gt{constructor(e,n,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,s)}update(e,n,o){let{width:s,height:c}=e,f=!(this.size&&this.size[0]===s&&this.size[1]===c||o),{context:_}=this,{gl:y}=_;if(this.useMipmap=!!(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),f)this.size=[s,c],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||p.b(e)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,s,c,0,this.format,y.UNSIGNED_BYTE,e.data);else{let{x:b,y:C}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||p.b(e)?y.texSubImage2D(y.TEXTURE_2D,0,b,C,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,b,C,s,c,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,o){let{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),o!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function uo(h){let{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class Qt extends p.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:n,promiseResolve:o}of this.requestors)o(this._getImagesForIds(n));this.requestors=[]}}getImage(e){let n=this.images[e];if(n&&!n.data&&n.spriteData){let o=n.spriteData;n.data=new p.R({width:o.width,height:o.height},o.context.getImageData(o.x,o.y,o.width,o.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let o=!0,s=n.data||n.spriteData;return this._validateStretch(n.stretchX,s&&s.width)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,s&&s.height)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "content" value`))),o=!1),o}_validateStretch(e,n){if(!e)return!0;let o=0;for(let s of e){if(s[0]<o||s[1]<s[0]||n<s[1])return!1;o=s[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;let o=n.spriteData,s=o&&o.width||n.data.width,c=o&&o.height||n.data.height;return!(e[0]<0||s<e[0]||e[1]<0||c<e[1]||e[2]<0||s<e[2]||e[3]<0||c<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,o=!0){let s=this.getImage(e);if(o&&(s.data.width!==n.data.width||s.data.height!==n.data.height))throw new Error(`size mismatch between old image (${s.data.width}x${s.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=s.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){let n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,o)=>{let s=!0;if(!this.isLoaded())for(let c of e)this.images[c]||(s=!1);this.isLoaded()||s?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){let n={};for(let o of e){let s=this.getImage(o);s||(this.fire(new p.k("styleimagemissing",{id:o})),s=this.getImage(o)),s?n[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,textFitWidth:s.textFitWidth,textFitHeight:s.textFitHeight,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:p.w(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){let{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){let n=this.patterns[e],o=this.getImage(e);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{let s={w:o.data.width+2,h:o.data.height+2,x:0,y:0},c=new p.I(s,o);this.patterns[e]={bin:s,position:c}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new gt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let c in this.patterns)e.push(this.patterns[c].bin);let{w:n,h:o}=p.p(e),s=this.atlasImage;s.resize({width:n||1,height:o||1});for(let c in this.patterns){let{bin:f}=this.patterns[c],_=f.x+1,y=f.y+1,b=this.getImage(c).data,C=b.width,M=b.height;p.R.copy(b,s,{x:0,y:0},{x:_,y},{width:C,height:M}),p.R.copy(b,s,{x:0,y:M-1},{x:_,y:y-1},{width:C,height:1}),p.R.copy(b,s,{x:0,y:0},{x:_,y:y+M},{width:C,height:1}),p.R.copy(b,s,{x:C-1,y:0},{x:_-1,y},{width:1,height:M}),p.R.copy(b,s,{x:0,y:0},{x:_+C,y},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;let o=this.getImage(n);o||p.w(`Image with ID: "${n}" was not found`),uo(o)&&this.updateImage(n,o)}}}let hi=1e20;function Dr(h,e,n,o,s,c,f,_,y){for(let b=e;b<e+o;b++)Dn(h,n*c+b,c,s,f,_,y);for(let b=n;b<n+s;b++)Dn(h,b*c+e,1,o,f,_,y)}function Dn(h,e,n,o,s,c,f){c[0]=0,f[0]=-hi,f[1]=hi,s[0]=h[e];for(let _=1,y=0,b=0;_<o;_++){s[_]=h[e+_*n];let C=_*_;do{let M=c[y];b=(s[_]-s[M]+C-M*M)/(_-M)/2}while(b<=f[y]&&--y>-1);y++,c[y]=_,f[y]=b,f[y+1]=hi}for(let _=0,y=0;_<o;_++){for(;f[y+1]<_;)y++;let b=c[y],C=_-b;h[e+_*n]=s[b]+C*C}}class vr{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return p._(this,void 0,void 0,function*(){let n=[];for(let c in e)for(let f of e[c])n.push(this._getAndCacheGlyphsPromise(c,f));let o=yield Promise.all(n),s={};for(let{stack:c,id:f,glyph:_}of o)s[c]||(s[c]={}),s[c][f]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return s})}_getAndCacheGlyphsPromise(e,n){return p._(this,void 0,void 0,function*(){let o=this.entries[e];o||(o=this.entries[e]={glyphs:{},requests:{},ranges:{}});let s=o.glyphs[n];if(s!==void 0)return{stack:e,id:n,glyph:s};if(s=this._tinySDF(o,e,n),s)return o.glyphs[n]=s,{stack:e,id:n,glyph:s};let c=Math.floor(n/256);if(256*c>65535)throw new Error("glyphs > 65535 not supported");if(o.ranges[c])return{stack:e,id:n,glyph:s};if(!this.url)throw new Error("glyphsUrl is not set");if(!o.requests[c]){let _=vr.loadGlyphRange(e,c,this.url,this.requestManager);o.requests[c]=_}let f=yield o.requests[c];for(let _ in f)this._doesCharSupportLocalGlyph(+_)||(o.glyphs[+_]=f[+_]);return o.ranges[c]=!0,{stack:e,id:n,glyph:f[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,o){let s=this.localIdeographFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let c=e.tinySDF;if(!c){let _="400";/bold/i.test(n)?_="900":/medium/i.test(n)?_="500":/light/i.test(n)&&(_="200"),c=e.tinySDF=new vr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:s,fontWeight:_})}let f=c.draw(String.fromCharCode(o));return{id:o,bitmap:new p.o({width:f.width||60,height:f.height||60},f.data),metrics:{width:f.glyphWidth/2||24,height:f.glyphHeight/2||24,left:f.glyphLeft/2+.5||0,top:f.glyphTop/2-27.5||-8,advance:f.glyphAdvance/2||24,isDoubleResolution:!0}}}}vr.loadGlyphRange=function(h,e,n,o){return p._(this,void 0,void 0,function*(){let s=256*e,c=s+255,f=o.transformRequest(n.replace("{fontstack}",h).replace("{range}",`${s}-${c}`),"Glyphs"),_=yield p.l(f,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${e}, ${s}-${c}`);let y={};for(let b of p.n(_.data))y[b.id]=b;return y})},vr.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;let _=this.size=h+4*e,y=this._createCanvas(_),b=this.ctx=y.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${c} ${h}px ${s}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(h){let e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:c}=this.ctx.measureText(h),f=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-s))),y=Math.min(this.size-this.buffer,f+Math.ceil(o)),b=_+2*this.buffer,C=y+2*this.buffer,M=Math.max(b*C,0),P=new Uint8ClampedArray(M),L={data:P,width:b,height:C,glyphWidth:_,glyphHeight:y,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return L;let{ctx:F,buffer:q,gridInner:U,gridOuter:$}=this;F.clearRect(q,q,_,y),F.fillText(h,q,q+f);let G=F.getImageData(q,q,_,y);$.fill(hi,0,M),U.fill(0,0,M);for(let B=0;B<y;B++)for(let K=0;K<_;K++){let Q=G.data[4*(B*_+K)+3]/255;if(Q===0)continue;let re=(B+q)*b+K+q;if(Q===1)$[re]=0,U[re]=hi;else{let ue=.5-Q;$[re]=ue>0?ue*ue:0,U[re]=ue<0?ue*ue:0}}Dr($,0,0,b,C,b,this.f,this.v,this.z),Dr(U,q,q,_,y,b,this.f,this.v,this.z);for(let B=0;B<M;B++){let K=Math.sqrt($[B])-Math.sqrt(U[B]);P[B]=Math.round(255-255*(K/this.radius+this.cutoff))}return L}};class po{constructor(){this.specification=p.v.light.position}possiblyEvaluate(e,n){return p.x(e.expression.evaluate(n))}interpolate(e,n,o){return{x:p.y.number(e.x,n.x,o),y:p.y.number(e.y,n.y,o),z:p.y.number(e.z,n.z,o)}}}let ln;class Lr extends p.E{constructor(e){super(),ln=ln||new p.q({anchor:new p.D(p.v.light.anchor),position:new po,color:new p.D(p.v.light.color),intensity:new p.D(p.v.light.intensity)}),this._transitionable=new p.T(ln),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(p.r,e,n))for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o){return(!o||o.validate!==!1)&&p.t(this,e.call(p.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:p.v}))}}let yi=new p.q({"sky-color":new p.D(p.v.sky["sky-color"]),"horizon-color":new p.D(p.v.sky["horizon-color"]),"fog-color":new p.D(p.v.sky["fog-color"]),"fog-ground-blend":new p.D(p.v.sky["fog-ground-blend"]),"horizon-fog-blend":new p.D(p.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new p.D(p.v.sky["sky-horizon-blend"]),"atmosphere-blend":new p.D(p.v.sky["atmosphere-blend"])});class Qi extends p.E{constructor(e){super(),this._transitionable=new p.T(yi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new p.z(0))}setSky(e,n={}){if(!this._validate(p.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let o in e){let s=e[o];o.endsWith("-transition")?this._transitionable.setTransition(o.slice(0,-11),s):this._transitionable.setValue(o,s)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,o={}){return o?.validate!==!1&&p.t(this,e.call(p.u,p.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:p.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ln{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){let o=e.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(e,n)),this.dashEntry[o]}getDashRanges(e,n,o){let s=[],c=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,_=!0;s.push({left:c,right:f,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let b=1;b<e.length;b++){_=!_;let C=e[b];c=y*o,y+=C,f=y*o,s.push({left:c,right:f,isDash:_,zeroLength:C===0})}return s}addRoundDash(e,n,o){let s=n/2;for(let c=-o;c<=o;c++){let f=this.width*(this.nextRow+o+c),_=0,y=e[_];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++_]);let C=Math.abs(b-y.left),M=Math.abs(b-y.right),P=Math.min(C,M),L,F=c/o*(s+1);if(y.isDash){let q=s-Math.abs(F);L=Math.sqrt(P*P+q*q)}else L=s-Math.sqrt(P*P+F*F);this.data[f+b]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e){for(let _=e.length-1;_>=0;--_){let y=e[_],b=e[_+1];y.zeroLength?e.splice(_,1):b&&b.isDash===y.isDash&&(b.left=y.left,e.splice(_,1))}let n=e[0],o=e[e.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);let s=this.width*this.nextRow,c=0,f=e[c];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++c]);let y=Math.abs(_-f.left),b=Math.abs(_-f.right),C=Math.min(y,b);this.data[s+_]=Math.max(0,Math.min(255,(f.isDash?C:-C)+128))}}addDash(e,n){let o=n?7:0,s=2*o+1;if(this.nextRow+s>this.height)return p.w("LineAtlas out of space"),null;let c=0;for(let _=0;_<e.length;_++)c+=e[_];if(c!==0){let _=this.width/c,y=this.getDashRanges(e,this.width,_);n?this.addRoundDash(y,_,o):this.addRegularDash(y)}let f={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:c};return this.nextRow+=s,this.dirty=!0,f}bind(e){let n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}let $r="maplibre_preloaded_worker_pool";class xr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<xr.workerCount;)this.workers.push(new Worker(p.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$r]}numActive(){return Object.keys(this.active).length}}let Rn=Math.floor(ge.hardwareConcurrency/2),zi,er;function cn(){return zi||(zi=new xr),zi}xr.workerCount=p.C(globalThis)?Math.max(Math.min(Rn,3),1):1;class hn{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;let o=this.workerPool.acquire(n);for(let s=0;s<o.length;s++){let c=new p.F(o[s],n);c.name=`Worker ${s}`,this.actors.push(c)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){let o=[];for(let s of this.actors)o.push(s.sendAsync({type:e,data:n}));return Promise.all(o)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(let o of this.actors)o.registerMessageHandler(e,n)}}function Ia(){return er||(er=new hn(cn(),p.G),er.registerMessageHandler("GR",(h,e,n)=>p.m(e,n))),er}function Rr(h,e){let n=p.H();return p.J(n,n,[1,1,0]),p.K(n,n,[.5*h.width,.5*h.height,1]),p.L(n,n,h.calculatePosMatrix(e.toUnwrapped()))}function Zr(h,e,n,o,s,c){let f=function(M,P,L){if(M)for(let F of M){let q=P[F];if(q&&q.source===L&&q.type==="fill-extrusion")return!0}else for(let F in P){let q=P[F];if(q.source===L&&q.type==="fill-extrusion")return!0}return!1}(s&&s.layers,e,h.id),_=c.maxPitchScaleFactor(),y=h.tilesIn(o,_,f);y.sort(Gr);let b=[];for(let M of y)b.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,n,h._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,s,c,_,Rr(h.transform,M.tileID))});let C=function(M){let P={},L={};for(let F of M){let q=F.queryResults,U=F.wrappedTileID,$=L[U]=L[U]||{};for(let G in q){let B=q[G],K=$[G]=$[G]||{},Q=P[G]=P[G]||[];for(let re of B)K[re.featureIndex]||(K[re.featureIndex]=!0,Q.push(re))}}return P}(b);for(let M in C)C[M].forEach(P=>{let L=P.feature,F=h.getFeatureState(L.layer["source-layer"],L.id);L.source=L.layer.source,L.layer["source-layer"]&&(L.sourceLayer=L.layer["source-layer"]),L.state=F});return C}function Gr(h,e){let n=h.tileID,o=e.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}function Fn(h,e,n){return p._(this,void 0,void 0,function*(){let o=h;if(h.url?o=(yield p.h(e.transformRequest(h.url,"Source"),n)).data:yield ge.frameAsync(n),!o)return null;let s=p.M(p.e(o,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in o&&o.vector_layers&&(s.vectorLayerIds=o.vector_layers.map(c=>c.id)),s})}class ae{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof p.N?new p.N(e.lng,e.lat):p.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof p.N?new p.N(e.lng,e.lat):p.N.convert(e),this}extend(e){let n=this._sw,o=this._ne,s,c;if(e instanceof p.N)s=e,c=e;else{if(!(e instanceof ae))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ae.convert(e)):this.extend(p.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(p.N.convert(e)):this;if(s=e._sw,c=e._ne,!s||!c)return this}return n||o?(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),o.lng=Math.max(c.lng,o.lng),o.lat=Math.max(c.lat,o.lat)):(this._sw=new p.N(s.lng,s.lat),this._ne=new p.N(c.lng,c.lat)),this}getCenter(){return new p.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new p.N(this.getWest(),this.getNorth())}getSouthEast(){return new p.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:o}=p.N.convert(e),s=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return e instanceof ae?e:e&&new ae(e)}static fromLngLat(e,n=0){let o=360*n/40075017,s=o/Math.cos(Math.PI/180*e.lat);return new ae(new p.N(e.lng-s,e.lat-o),new p.N(e.lng+s,e.lat+o))}adjustAntiMeridian(){let e=new p.N(this._sw.lng,this._sw.lat),n=new p.N(this._ne.lng,this._ne.lat);return new ae(e,e.lng>n.lng?new p.N(n.lng+360,n.lat):n)}}class un{constructor(e,n,o){this.bounds=ae.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),o=Math.floor(p.O(this.bounds.getWest())*n),s=Math.floor(p.Q(this.bounds.getNorth())*n),c=Math.ceil(p.O(this.bounds.getEast())*n),f=Math.ceil(p.Q(this.bounds.getSouth())*n);return e.x>=o&&e.x<c&&e.y>=s&&e.y<f}}class Ea extends p.E{constructor(e,n,o,s){if(super(),this.id=e,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.e(this,p.M(n,["url","scheme","tileSize","promoteId"])),this._options=p.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Fn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(p.e(this,e),e.bounds&&(this.tileBounds=new un(e.bounds,this.minzoom,this.maxzoom)),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new p.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return p.e({},this._options)}loadTile(e){return p._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request.collectResourceTiming=this._collectResourceTiming;let s="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((c,f)=>{e.reloadPromise={resolve:c,reject:f}})}else e.actor=this.dispatcher.getActor(),s="LT";e.abortController=new AbortController;try{let c=yield e.actor.sendAsync({type:s,data:o},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,c)}catch(c){if(delete e.abortController,e.aborted)return;if(c&&c.status!==404)throw c;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){let o=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(o.resolve).catch(o.reject)}}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class lt extends p.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.e({type:"raster"},n),p.e(this,p.M(n,["url","scheme","tileSize"]))}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Fn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(p.e(this,e),e.bounds&&(this.tileBounds=new un(e.bounds,this.minzoom,this.maxzoom)),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new p.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return p.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return p._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let o=yield Ai.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});let s=this.map.painter.context,c=s.gl,f=o.data;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new gt(s,f,c.RGBA,{useMipmap:!0}),e.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE,c.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class At extends lt{constructor(e,n,o,s){super(e,n,o,s),this.type="raster-dem",this.maxzoom=22,this._options=p.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return p._(this,void 0,void 0,function*(){let n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),o=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let s=yield Ai.getImage(o,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){let c=s.data;this.map._refreshExpiredTiles&&s.cacheControl&&s.expires&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let f=p.b(c)&&p.U()?c:yield this.readImageNow(c),_={type:this.type,uid:e.uid,source:this.id,rawImageData:f,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let y=yield e.actor.sendAsync({type:"LDT",data:_});e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}readImageNow(e){return p._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&p.V()){let n=e.width+2,o=e.height+2;try{return new p.R({width:n,height:o},yield p.W(e,-1,-1,n,o))}catch{}}return ge.getImageData(e,1)})}_getNeighboringTiles(e){let n=e.canonical,o=Math.pow(2,n.z),s=(n.x-1+o)%o,c=n.x===0?e.wrap-1:e.wrap,f=(n.x+1+o)%o,_=n.x+1===o?e.wrap+1:e.wrap,y={};return y[new p.S(e.overscaledZ,c,n.z,s,n.y).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(y[new p.S(e.overscaledZ,c,n.z,s,n.y-1).key]={backfilled:!1},y[new p.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<o&&(y[new p.S(e.overscaledZ,c,n.z,s,n.y+1).key]={backfilled:!1},y[new p.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,n.z,f,n.y+1).key]={backfilled:!1}),y}unloadTile(e){return p._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Pa extends p.E{constructor(e,n,o,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(s),this._data=n.data,this._options=p.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let c=p.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&p.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=p.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*c,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*c,extent:p.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:p.X,radius:(n.clusterRadius||50)*c,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return p._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return p._(this,void 0,void 0,function*(){let e=p.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,o){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:o}})}_updateWorkerData(e){return p._(this,void 0,void 0,function*(){let n=p.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(ge.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new p.k("dataloading",{dataType:"source"}));try{let o=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||o.abandoned)return void this.fire(new p.k("dataabort",{dataType:"source"}));let s=null;o.resourceTiming&&o.resourceTiming[this.id]&&(s=o.resourceTiming[this.id].slice(0));let c={dataType:"source"};this._collectResourceTiming&&s&&s.length>0&&p.e(c,{resourceTiming:s}),this.fire(new p.k("data",Object.assign(Object.assign({},c),{sourceDataType:"metadata"}))),this.fire(new p.k("data",Object.assign(Object.assign({},c),{sourceDataType:"content"})))}catch(o){if(this._pendingLoads--,this._removed)return void this.fire(new p.k("dataabort",{dataType:"source"}));this.fire(new p.j(o))}})}loaded(){return this._pendingLoads===0}loadTile(e){return p._(this,void 0,void 0,function*(){let n=e.actor?"RT":"LT";e.actor=this.actor;let o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;let s=yield this.actor.sendAsync({type:n,data:o},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(s,this.map.painter,n==="RT")})}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return p.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Hr=p.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fr extends p.E{constructor(e,n,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=n}load(e){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let n=yield Ai.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new p.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let n=e.map(p.Z.fromLngLat);this.tileID=function(s){let c=1/0,f=1/0,_=-1/0,y=-1/0;for(let P of s)c=Math.min(c,P.x),f=Math.min(f,P.y),_=Math.max(_,P.x),y=Math.max(y,P.y);let b=Math.max(_-c,y-f),C=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),M=Math.pow(2,C);return new p.a1(C,Math.floor((c+_)/2*M),Math.floor((f+y)/2*M))}(n),this.minzoom=this.maxzoom=this.tileID.z;let o=n.map(s=>this.tileID.getTilePoint(s)._round());return this._boundsArray=new p.$,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,p.X,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,p.X),this._boundsArray.emplaceBack(o[2].x,o[2].y,p.X,p.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new gt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let c=this.tiles[s];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture,o=!0)}o&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return p._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Bn extends Fr{constructor(e,n,o,s){super(e,n,o,s),this.roundZoom=!0,this.type="video",this.options=n}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{let n=yield p.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new p.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new p.j(new p.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new gt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let o=!1;for(let s in this.tiles){let c=this.tiles[s];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture,o=!0)}o&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ji extends Fr{constructor(e,n,o,s){super(e,n,o,s),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(c=>!Array.isArray(c)||c.length!==2||c.some(f=>typeof f!="number"))||this.fire(new p.j(new p.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.j(new p.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new p.j(new p.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new p.j(new p.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.j(new p.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return p._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new gt(n,this.canvas,o.RGBA,{premultiply:!0});let s=!1;for(let c in this.tiles){let f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,s=!0)}s&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Aa={},za=h=>{switch(h){case"geojson":return Pa;case"image":return Fr;case"raster":return lt;case"raster-dem":return At;case"vector":return Ea;case"video":return Bn;case"canvas":return ji}return Aa[h]},fe="RTLPluginLoaded";class br extends p.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ia()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return p._(this,arguments,void 0,function*(n,o=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!o)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return p._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new p.k(fe))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ui=null;function wr(){return ui||(ui=new br),ui}class Wr{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=p.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,c){let f={};if(!c)return f;for(let _ of s){let y=_.layerIds.map(b=>c.getLayer(b)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>y.filter(C=>C.id===b)[0]));for(let b of y)f[b.id]=_}}return f}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let s in this.buckets){let c=this.buckets[s];if(c instanceof p.a6){if(this.hasSymbolBuckets=!0,!o)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let s in this.buckets){let c=this.buckets[s];if(c instanceof p.a6&&c.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(let s in this.buckets){let c=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(s).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new p.a5}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let o in this.buckets){let s=this.buckets[o];s.uploadPending()&&s.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,s,c,f,_,y,b,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:c,scale:f,tileSize:this.tileSize,pixelPosMatrix:C,transform:y,params:_,queryPadding:this.queryPadding*b},e,n,o):{}}querySourceFeatures(e,n){let o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;let s=o.loadVTLayers(),c=n&&n.sourceLayer?n.sourceLayer:"",f=s._geojsonTileLayer||s[c];if(!f)return;let _=p.a7(n&&n.filter),{z:y,x:b,y:C}=this.tileID.canonical,M={z:y,x:b,y:C};for(let P=0;P<f.length;P++){let L=f.feature(P);if(_.needGeometry){let U=p.a8(L,!0);if(!_.filter(new p.z(this.tileID.overscaledZ),U,this.tileID.canonical))continue}else if(!_.filter(new p.z(this.tileID.overscaledZ),L))continue;let F=o.getId(L,c),q=new p.a9(L,y,b,C,F);q.tile=M,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let o=p.aa(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let o=Date.now(),s=!1;if(this.expirationTime>o)s=!1;else if(n)if(this.expirationTime<n)s=!0;else{let c=this.expirationTime-n;c?this.expirationTime=o+Math.max(c,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let o=this.latestFeatureIndex.loadVTLayers();for(let s in this.buckets){if(!n.style.hasLayer(s))continue;let c=this.buckets[s],f=c.layers[0].sourceLayer||"_geojsonTileLayer",_=o[f],y=e[f];if(!_||!y||Object.keys(y).length===0)continue;c.update(y,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});let b=n&&n.style&&n.style.getLayer(s);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(c)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ge.now()+e}setDependencies(e,n){let o={};for(let s of n)o[s]=!0;this.dependencies[e]=o}hasDependency(e,n){for(let o of e){let s=this.dependencies[o];if(s){for(let c of n)if(s[c])return!0}}return!1}}class xe{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){let s=e.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);let c={value:n,timeout:void 0};if(o!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},o)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){let f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let o=e.wrapped().key,s=n===void 0?0:this.data[o].indexOf(n),c=this.data[o][s];return this.data[o].splice(s,1),c.timeout&&clearTimeout(c.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(c.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let o in this.data)for(let s of this.data[o])e(s.value)||n.push(s);for(let o of n)this.remove(o.value.tileID,o)}}class Ke{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){let s=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},p.e(this.stateChanges[e][s],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(let c in this.state[e])c!==s&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][s]===null){this.deletedStates[e][s]={};for(let c in this.state[e][s])o[c]||(this.deletedStates[e][s][c]=null)}else for(let c in o)this.deletedStates[e]&&this.deletedStates[e][s]&&this.deletedStates[e][s][c]===null&&delete this.deletedStates[e][s][c]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;let s=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][s]!==null&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][s])for(o in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][o]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,n){let o=String(n),s=p.e({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let c=this.deletedStates[e][n];if(c===null)return{};for(let f in c)delete s[f]}return s}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let o={};for(let s in this.stateChanges){this.state[s]=this.state[s]||{};let c={};for(let f in this.stateChanges[s])this.state[s][f]||(this.state[s][f]={}),p.e(this.state[s][f],this.stateChanges[s][f]),c[f]=this.state[s][f];o[s]=c}for(let s in this.deletedStates){this.state[s]=this.state[s]||{};let c={};if(this.deletedStates[s]===null)for(let f in this.state[s])c[f]={},this.state[s][f]={};else for(let f in this.deletedStates[s]){if(this.deletedStates[s][f]===null)this.state[s][f]={};else for(let _ of Object.keys(this.deletedStates[s][f]))delete this.state[s][f][_];c[f]=this.state[s][f]}o[s]=o[s]||{},p.e(o[s],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(let s in e)e[s].setFeatureState(o,n)}}class Ne extends p.E{constructor(e,n,o){super(),this.id=e,this.dispatcher=o,this.on("data",s=>this._dataHandler(s)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((s,c,f,_)=>{let y=new(za(c.type))(s,c,f,_);if(y.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${y.id}`);return y})(e,n,o,this),this._tiles={},this._cache=new xe(0,s=>this._unloadTile(s)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ke,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,o){return p._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,o)}catch(s){e.state="errored",s.status!==404?this._source.fire(new p.j(s,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new p.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(vi).map(e=>e.key)}getRenderableIds(e){let n=[];for(let o in this._tiles)this._isIdRenderable(o,e)&&n.push(this._tiles[o]);return e?n.sort((o,s)=>{let c=o.tileID,f=s.tileID,_=new p.P(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),y=new p.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-f.overscaledZ||y.y-_.y||y.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(vi).map(o=>o.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return p._(this,void 0,void 0,function*(){let o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),yield this._loadTile(o,e,n))})}_tileLoaded(e,n,o){e.timeAdded=ge.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new p.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let n=this.getRenderableIds();for(let s=0;s<n.length;s++){let c=n[s];if(e.neighboringTiles&&e.neighboringTiles[c]){let f=this.getTileByID(c);o(e,f),o(f,e)}}function o(s,c){s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0;let f=c.tileID.canonical.x-s.tileID.canonical.x,_=c.tileID.canonical.y-s.tileID.canonical.y,y=Math.pow(2,s.tileID.canonical.z),b=c.tileID.key;f===0&&_===0||Math.abs(_)>1||(Math.abs(f)>1&&(Math.abs(f+y)===1?f+=y:Math.abs(f-y)===1&&(f-=y)),c.dem&&s.dem&&(s.dem.backfillBorder(c.dem,f,_),s.neighboringTiles&&s.neighboringTiles[b]&&(s.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,s){for(let c in this._tiles){let f=this._tiles[c];if(s[c]||!f.hasData()||f.tileID.overscaledZ<=n||f.tileID.overscaledZ>o)continue;let _=f.tileID;for(;f&&f.tileID.overscaledZ>n+1;){let b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(_=b)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){s[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){let s=e.scaledTo(o),c=this._getLoadedTile(s);if(c)return c}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let n=Math.ceil(e.width/this._source.tileSize)+1,o=Math.ceil(e.height/this._source.tileSize)+1,s=Math.floor(n*o*(this._maxTileCacheZoomLevels===null?p.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),c=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(c)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let o={};for(let s in this._tiles){let c=this._tiles[s];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+n),o[c.tileID.key]=c}this._tiles=o;for(let s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(let s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}}_updateCoveredAndRetainedTiles(e,n,o,s,c,f){let _={},y={},b=Object.keys(e),C=ge.now();for(let M of b){let P=e[M],L=this._tiles[M];if(!L||L.fadeEndTime!==0&&L.fadeEndTime<=C)continue;let F=this.findLoadedParent(P,n),q=this.findLoadedSibling(P),U=F||q||null;U&&(this._addTile(U.tileID),_[U.tileID.key]=U.tileID),y[M]=P}this._retainLoadedChildren(y,s,o,e);for(let M in _)e[M]||(this._coveredTiles[M]=!0,e[M]=_[M]);if(f){let M={},P={};for(let L of c)this._tiles[L.key].hasData()?M[L.key]=L:P[L.key]=L;for(let L in P){let F=P[L].children(this._source.maxzoom);this._tiles[F[0].key]&&this._tiles[F[1].key]&&this._tiles[F[2].key]&&this._tiles[F[3].key]&&(M[F[0].key]=e[F[0].key]=F[0],M[F[1].key]=e[F[1].key]=F[1],M[F[2].key]=e[F[2].key]=F[2],M[F[3].key]=e[F[3].key]=F[3],delete P[L])}for(let L in P){let F=P[L],q=this.findLoadedParent(F,this._source.minzoom),U=this.findLoadedSibling(F),$=q||U||null;if($){M[$.tileID.key]=e[$.tileID.key]=$.tileID;for(let G in M)M[G].isChildOf($.tileID)&&delete M[G]}}for(let L in this._tiles)M[L]||(this._coveredTiles[L]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let o;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new p.S(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(o=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(C=>this._source.hasTile(C)))):o=[];let s=e.coveringZoomLevel(this._source),c=Math.max(s-Ne.maxOverzooming,this._source.minzoom),f=Math.max(s+Ne.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let C={};for(let M of o)if(M.canonical.z>this._source.minzoom){let P=M.scaledTo(M.canonical.z-1);C[P.key]=P;let L=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));C[L.key]=L}o=o.concat(Object.values(C))}let _=o.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new p.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let y=this._updateRetainedTiles(o,s);tr(this._source.type)&&this._updateCoveredAndRetainedTiles(y,c,f,s,o,n);for(let C in y)this._tiles[C].clearFadeHold();let b=p.ab(this._tiles,y);for(let C of b){let M=this._tiles[C];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var o;let s={},c={},f=Math.max(n-Ne.maxOverzooming,this._source.minzoom),_=Math.max(n+Ne.maxUnderzooming,this._source.minzoom),y={};for(let b of e){let C=this._addTile(b);s[b.key]=b,C.hasData()||n<this._source.maxzoom&&(y[b.key]=b)}this._retainLoadedChildren(y,n,_,s);for(let b of e){let C=this._tiles[b.key];if(C.hasData())continue;if(n+1>this._source.maxzoom){let P=b.children(this._source.maxzoom)[0],L=this.getTile(P);if(L&&L.hasData()){s[P.key]=P;continue}}else{let P=b.children(this._source.maxzoom);if(s[P[0].key]&&s[P[1].key]&&s[P[2].key]&&s[P[3].key])continue}let M=C.wasRequested();for(let P=b.overscaledZ-1;P>=f;--P){let L=b.scaledTo(P);if(c[L.key])break;if(c[L.key]=!0,C=this.getTile(L),!C&&M&&(C=this._addTile(L)),C){let F=C.hasData();if((F||!(!((o=this.map)===null||o===void 0)&&o.cancelPendingTileRequestsWhileZooming)||M)&&(s[L.key]=L),M=C.wasRequested(),F)break}}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],o,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){o=this._loadedParentTiles[s.key];break}n.push(s.key);let c=s.scaledTo(s.overscaledZ-1);if(o=this._getLoadedTile(c),o)break;s=c}for(let c of n)this._loadedParentTiles[c]=o}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let n=this._tiles[e].tileID,o=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let o=n;return n||(n=new Wr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,o||this._source.fire(new p.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){let n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,o){let s=[],c=this.transform;if(!c)return s;let f=o?c.getCameraQueryGeometry(e):e,_=e.map(F=>c.pointCoordinate(F,this.terrain)),y=f.map(F=>c.pointCoordinate(F,this.terrain)),b=this.getIds(),C=1/0,M=1/0,P=-1/0,L=-1/0;for(let F of y)C=Math.min(C,F.x),M=Math.min(M,F.y),P=Math.max(P,F.x),L=Math.max(L,F.y);for(let F=0;F<b.length;F++){let q=this._tiles[b[F]];if(q.holdingForFade())continue;let U=q.tileID,$=Math.pow(2,c.zoom-q.tileID.overscaledZ),G=n*q.queryPadding*p.X/q.tileSize/$,B=[U.getTilePoint(new p.Z(C,M)),U.getTilePoint(new p.Z(P,L))];if(B[0].x-G<p.X&&B[0].y-G<p.X&&B[1].x+G>=0&&B[1].y+G>=0){let K=_.map(re=>U.getTilePoint(re)),Q=y.map(re=>U.getTilePoint(re));s.push({tile:q,tileID:U,queryGeometry:K,cameraQueryGeometry:Q,scale:$})}}return s}getVisibleCoordinates(e){let n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(let o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(tr(this._source.type)){let e=ge.now();for(let n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){let s=this._tiles[e];s&&s.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(let o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}}function vi(h,e){let n=Math.abs(2*h.wrap)-+(h.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||o-n||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function tr(h){return h==="raster"||h==="image"||h==="video"}Ne.maxOverzooming=10,Ne.maxUnderzooming=3;class Ge{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=p.ac(e,0,1);let n=1,o=this._distances[n],s=e*this.paddedLength+this.padding;for(;o<s&&n<this._distances.length;)o=this._distances[++n];let c=n-1,f=this._distances[c],_=o-f,y=_>0?(s-f)/_:0;return this.points[c].mult(1-y).add(this.points[n].mult(y))}}function Sr(h,e){let n=!0;return h==="always"||h!=="never"&&e!=="never"||(n=!1),n}class Br{constructor(e,n,o){let s=this.boxCells=[],c=this.circleCells=[];this.xCellCount=Math.ceil(e/o),this.yCellCount=Math.ceil(n/o);for(let f=0;f<this.xCellCount*this.yCellCount;f++)s.push([]),c.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,o,s,c){this._forEachCell(n,o,s,c,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(c)}insertCircle(e,n,o,s){this._forEachCell(n-s,o-s,n+s,o+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(o),this.circles.push(s)}_insertBoxCell(e,n,o,s,c,f){this.boxCells[c].push(f)}_insertCircleCell(e,n,o,s,c,f){this.circleCells[c].push(f)}_query(e,n,o,s,c,f,_){if(o<0||e>this.width||s<0||n>this.height)return[];let y=[];if(e<=0&&n<=0&&this.width<=o&&this.height<=s){if(c)return[{key:null,x1:e,y1:n,x2:o,y2:s}];for(let b=0;b<this.boxKeys.length;b++)y.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){let C=this.circles[3*b],M=this.circles[3*b+1],P=this.circles[3*b+2];y.push({key:this.circleKeys[b],x1:C-P,y1:M-P,x2:C+P,y2:M+P})}}else this._forEachCell(e,n,o,s,this._queryCell,y,{hitTest:c,overlapMode:f,seenUids:{box:{},circle:{}}},_);return y}query(e,n,o,s){return this._query(e,n,o,s,!1,null)}hitTest(e,n,o,s,c,f){return this._query(e,n,o,s,!0,c,f).length>0}hitTestCircle(e,n,o,s,c){let f=e-o,_=e+o,y=n-o,b=n+o;if(_<0||f>this.width||b<0||y>this.height)return!1;let C=[];return this._forEachCell(f,y,_,b,this._queryCellCircle,C,{hitTest:!0,overlapMode:s,circle:{x:e,y:n,radius:o},seenUids:{box:{},circle:{}}},c),C.length>0}_queryCell(e,n,o,s,c,f,_,y){let{seenUids:b,hitTest:C,overlapMode:M}=_,P=this.boxCells[c];if(P!==null){let F=this.bboxes;for(let q of P)if(!b.box[q]){b.box[q]=!0;let U=4*q,$=this.boxKeys[q];if(e<=F[U+2]&&n<=F[U+3]&&o>=F[U+0]&&s>=F[U+1]&&(!y||y($))&&(!C||!Sr(M,$.overlapMode))&&(f.push({key:$,x1:F[U],y1:F[U+1],x2:F[U+2],y2:F[U+3]}),C))return!0}}let L=this.circleCells[c];if(L!==null){let F=this.circles;for(let q of L)if(!b.circle[q]){b.circle[q]=!0;let U=3*q,$=this.circleKeys[q];if(this._circleAndRectCollide(F[U],F[U+1],F[U+2],e,n,o,s)&&(!y||y($))&&(!C||!Sr(M,$.overlapMode))){let G=F[U],B=F[U+1],K=F[U+2];if(f.push({key:$,x1:G-K,y1:B-K,x2:G+K,y2:B+K}),C)return!0}}}return!1}_queryCellCircle(e,n,o,s,c,f,_,y){let{circle:b,seenUids:C,overlapMode:M}=_,P=this.boxCells[c];if(P!==null){let F=this.bboxes;for(let q of P)if(!C.box[q]){C.box[q]=!0;let U=4*q,$=this.boxKeys[q];if(this._circleAndRectCollide(b.x,b.y,b.radius,F[U+0],F[U+1],F[U+2],F[U+3])&&(!y||y($))&&!Sr(M,$.overlapMode))return f.push(!0),!0}}let L=this.circleCells[c];if(L!==null){let F=this.circles;for(let q of L)if(!C.circle[q]){C.circle[q]=!0;let U=3*q,$=this.circleKeys[q];if(this._circlesCollide(F[U],F[U+1],F[U+2],b.x,b.y,b.radius)&&(!y||y($))&&!Sr(M,$.overlapMode))return f.push(!0),!0}}}_forEachCell(e,n,o,s,c,f,_,y){let b=this._convertToXCellCoord(e),C=this._convertToYCellCoord(n),M=this._convertToXCellCoord(o),P=this._convertToYCellCoord(s);for(let L=b;L<=M;L++)for(let F=C;F<=P;F++)if(c.call(this,e,n,o,s,this.xCellCount*F+L,f,_,y))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,o,s,c,f){let _=s-e,y=c-n,b=o+f;return b*b>_*_+y*y}_circleAndRectCollide(e,n,o,s,c,f,_){let y=(f-s)/2,b=Math.abs(e-(s+y));if(b>y+o)return!1;let C=(_-c)/2,M=Math.abs(n-(c+C));if(M>C+o)return!1;if(b<=y||M<=C)return!0;let P=b-y,L=M-C;return P*P+L*L<=o*o}}function Xr(h,e,n,o,s){let c=p.H();return e?(p.K(c,c,[1/s,1/s,1]),n||p.ad(c,c,o.angle)):p.L(c,o.labelPlaneMatrix,h),c}function Cr(h,e,n,o,s){if(e){let c=p.ae(h);return p.K(c,c,[s,s,1]),n||p.ad(c,c,-o.angle),c}return o.glCoordMatrix}function N(h,e,n,o){let s;o?(s=[h,e,o(h,e),1],p.af(s,s,n)):(s=[h,e,0,1],nt(s,s,n));let c=s[3];return{point:new p.P(s[0]/c,s[1]/c),signedDistanceFromCamera:c,isOccluded:!1}}function I(h,e){return .5+h/e*.5}function k(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function R(h,e,n,o,s,c,f,_,y,b,C,M,P,L,F){let q=o?h.textSizeData:h.iconSizeData,U=p.ag(q,n.transform.zoom),$=[256/n.width*2+1,256/n.height*2+1],G=o?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();let B=h.lineVertexArray,K=o?h.text.placedSymbolArray:h.icon.placedSymbolArray,Q=n.transform.width/n.transform.height,re=!1;for(let ue=0;ue<K.length;ue++){let me=K.get(ue);if(me.hidden||me.writingMode===p.ah.vertical&&!re){Oe(me.numGlyphs,G);continue}re=!1;let Se=N(me.anchorX,me.anchorY,e,F);if(!k(Se.point,$)){Oe(me.numGlyphs,G);continue}let ke=I(n.transform.cameraToCenterDistance,Se.signedDistanceFromCamera),ve=p.ai(q,U,me),ye=f?ve/ke:ve*ke,ze={getElevation:F,labelPlaneMatrix:s,lineVertexArray:B,pitchWithMap:f,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:b,tileAnchorPoint:new p.P(me.anchorX,me.anchorY),unwrappedTileID:C,width:M,height:P,translation:L},Ze=Y(ze,me,ye,!1,_,e,c,h.glyphOffsetArray,G,Q,y);re=Ze.useVertical,(Ze.notEnoughRoom||re||Ze.needsFlipping&&Y(ze,me,ye,!0,_,e,c,h.glyphOffsetArray,G,Q,y).notEnoughRoom)&&Oe(me.numGlyphs,G)}o?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function V(h,e,n,o,s,c,f,_){let y=c.glyphStartIndex+c.numGlyphs,b=c.lineStartIndex,C=c.lineStartIndex+c.lineLength,M=e.getoffsetX(c.glyphStartIndex),P=e.getoffsetX(y-1),L=_e(h*M,n,o,s,c.segment,b,C,_,f);if(!L)return null;let F=_e(h*P,n,o,s,c.segment,b,C,_,f);return F?_.projectionCache.anyProjectionOccluded?null:{first:L,last:F}:null}function X(h,e,n,o){return h===p.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*o?{useVertical:!0}:(h===p.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Y(h,e,n,o,s,c,f,_,y,b,C){let M=n/24,P=e.lineOffsetX*M,L=e.lineOffsetY*M,F;if(e.numGlyphs>1){let q=e.glyphStartIndex+e.numGlyphs,U=e.lineStartIndex,$=e.lineStartIndex+e.lineLength,G=V(M,_,P,L,o,e,C,h);if(!G)return{notEnoughRoom:!0};let B=N(G.first.point.x,G.first.point.y,f,h.getElevation).point,K=N(G.last.point.x,G.last.point.y,f,h.getElevation).point;if(s&&!o){let Q=X(e.writingMode,B,K,b);if(Q)return Q}F=[G.first];for(let Q=e.glyphStartIndex+1;Q<q-1;Q++)F.push(_e(M*_.getoffsetX(Q),P,L,o,e.segment,U,$,h,C));F.push(G.last)}else{if(s&&!o){let U=N(h.tileAnchorPoint.x,h.tileAnchorPoint.y,c,h.getElevation).point,$=e.lineStartIndex+e.segment+1,G=new p.P(h.lineVertexArray.getx($),h.lineVertexArray.gety($)),B=N(G.x,G.y,c,h.getElevation),K=B.signedDistanceFromCamera>0?B.point:function(re,ue,me,Se,ke,ve){return te(re,ue,me,1,ke,ve)}(h.tileAnchorPoint,G,U,0,c,h),Q=X(e.writingMode,U,K,b);if(Q)return Q}let q=_e(M*_.getoffsetX(e.glyphStartIndex),P,L,o,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,h,C);if(!q||h.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};F=[q]}for(let q of F)p.aj(y,q.point,q.angle);return{}}function te(h,e,n,o,s,c){let f=h.add(h.sub(e)._unit()),_=s!==void 0?N(f.x,f.y,s,c.getElevation).point:se(f.x,f.y,c).point,y=n.sub(_);return n.add(y._mult(o/y.mag()))}function Z(h,e,n){let o=e.projectionCache;if(o.projections[h])return o.projections[h];let s=new p.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),c=se(s.x,s.y,e);if(c.signedDistanceFromCamera>0)return o.projections[h]=c.point,o.anyProjectionOccluded=o.anyProjectionOccluded||c.isOccluded,c.point;let f=h-n.direction;return function(_,y,b,C,M){return te(_,y,b,C,void 0,M)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new p.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),s,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function se(h,e,n){let o=h+n.translation[0],s=e+n.translation[1],c;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(c=n.projection.projectTileCoordinates(o,s,n.unwrappedTileID,n.getElevation),c.point.x=(.5*c.point.x+.5)*n.width,c.point.y=(.5*-c.point.y+.5)*n.height):(c=N(o,s,n.labelPlaneMatrix,n.getElevation),c.isOccluded=!1),c}function de(h,e,n){return h._unit()._perp()._mult(e*n)}function ne(h,e,n,o,s,c,f,_,y){if(_.projectionCache.offsets[h])return _.projectionCache.offsets[h];let b=n.add(e);if(h+y.direction<o||h+y.direction>=s)return _.projectionCache.offsets[h]=b,b;let C=Z(h+y.direction,_,y),M=de(C.sub(n),f,y.direction),P=n.add(M),L=C.add(M);return _.projectionCache.offsets[h]=p.ak(c,b,P,L)||b,_.projectionCache.offsets[h]}function _e(h,e,n,o,s,c,f,_,y){let b=o?h-e:h+e,C=b>0?1:-1,M=0;o&&(C*=-1,M=Math.PI),C<0&&(M+=Math.PI);let P,L=C>0?c+s:c+s+1;_.projectionCache.cachedAnchorPoint?P=_.projectionCache.cachedAnchorPoint:(P=se(_.tileAnchorPoint.x,_.tileAnchorPoint.y,_).point,_.projectionCache.cachedAnchorPoint=P);let F,q,U=P,$=P,G=0,B=0,K=Math.abs(b),Q=[],re;for(;G+B<=K;){if(L+=C,L<c||L>=f)return null;G+=B,$=U,q=F;let Se={absOffsetX:K,direction:C,distanceFromAnchor:G,previousVertex:$};if(U=Z(L,_,Se),n===0)Q.push($),re=U.sub($);else{let ke,ve=U.sub($);ke=ve.mag()===0?de(Z(L+C,_,Se).sub(U),n,C):de(ve,n,C),q||(q=$.add(ke)),F=ne(L,ke,U,c,f,q,n,_,Se),Q.push(q),re=F.sub(q)}B=re.mag()}let ue=re._mult((K-G)/B)._add(q||$),me=M+Math.atan2(U.y-$.y,U.x-$.x);return Q.push(ue),{point:ue,angle:y?me:0,path:Q}}let Be=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oe(h,e){for(let n=0;n<h;n++){let o=e.length;e.resize(o+4),e.float32.set(Be,3*o)}}function nt(h,e,n){let o=e[0],s=e[1];return h[0]=n[0]*o+n[4]*s+n[12],h[1]=n[1]*o+n[5]*s+n[13],h[3]=n[3]*o+n[7]*s+n[15],h}let He=100;class at{constructor(e,n,o=new Br(e.width+200,e.height+200,25),s=new Br(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=o,this.ignoredGrid=s,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+He,this.screenBottomBoundary=e.height+He,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,o,s,c,f,_,y,b,C,M){let P=e.anchorPointX+y[0],L=e.anchorPointY+y[1],F=this.projectAndGetPerspectiveRatio(s,P,L,c,C),q=o*F.perspectiveRatio,U;if(f||_)U=this._projectCollisionBox(e,q,s,c,f,_,y,F,C,M);else{let Q=F.point.x+(M?M.x*q:0),re=F.point.y+(M?M.y*q:0);U={allPointsOccluded:!1,box:[Q+e.x1*q,re+e.y1*q,Q+e.x2*q,re+e.y2*q]}}let[$,G,B,K]=U.box;return this.mapProjection.useSpecialProjectionForSymbols&&(f?U.allPointsOccluded:this.mapProjection.isOccluded(P,L,c))||F.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid($,G,B,K)||n!=="always"&&this.grid.hitTest($,G,B,K,n,b)?{box:[$,G,B,K],placeable:!1,offscreen:!1}:{box:[$,G,B,K],placeable:!0,offscreen:this.isOffscreen($,G,B,K)}}placeCollisionCircles(e,n,o,s,c,f,_,y,b,C,M,P,L,F,q,U){let $=[],G=new p.P(n.anchorX,n.anchorY),B=this.getPerspectiveRatio(f,G.x,G.y,_,U),K=(M?c/B:c*B)/p.ap,Q={getElevation:U,labelPlaneMatrix:y,lineVertexArray:o,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:G,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:q},re=V(K,s,n.lineOffsetX*K,n.lineOffsetY*K,!1,n,!1,Q),ue=!1,me=!1,Se=!0;if(re){let ke=.5*L*B+F,ve=new p.P(-100,-100),ye=new p.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new Ge,Ze=re.first,be=re.last,Me=[];for(let We=Ze.path.length-1;We>=1;We--)Me.push(Ze.path[We]);for(let We=1;We<be.path.length;We++)Me.push(be.path[We]);let Ue=2.5*ke;if(b){let We=this.projectPathToScreenSpace(Me,Q,b);Me=We.some(tt=>tt.signedDistanceFromCamera<=0)?[]:We.map(tt=>tt.point)}let Mt=[];if(Me.length>0){let We=Me[0].clone(),tt=Me[0].clone();for(let Tt=1;Tt<Me.length;Tt++)We.x=Math.min(We.x,Me[Tt].x),We.y=Math.min(We.y,Me[Tt].y),tt.x=Math.max(tt.x,Me[Tt].x),tt.y=Math.max(tt.y,Me[Tt].y);Mt=We.x>=ve.x&&tt.x<=ye.x&&We.y>=ve.y&&tt.y<=ye.y?[Me]:tt.x<ve.x||We.x>ye.x||tt.y<ve.y||We.y>ye.y?[]:p.al([Me],ve.x,ve.y,ye.x,ye.y)}for(let We of Mt){ze.reset(We,.25*ke);let tt=0;tt=ze.length<=.5*ke?1:Math.ceil(ze.paddedLength/Ue)+1;for(let Tt=0;Tt<tt;Tt++){let ti=Tt/Math.max(tt-1,1),sr=ze.lerp(ti),kt=sr.x+He,wi=sr.y+He;$.push(kt,wi,ke,0);let pi=kt-ke,ii=wi-ke,mi=kt+ke,Ir=wi+ke;if(Se=Se&&this.isOffscreen(pi,ii,mi,Ir),me=me||this.isInsideGrid(pi,ii,mi,Ir),e!=="always"&&this.grid.hitTestCircle(kt,wi,ke,e,P)&&(ue=!0,!C))return{circles:[],offscreen:!1,collisionDetected:ue}}}}return{circles:!C&&ue||!me||B<this.perspectiveRatioCutoff?[]:$,offscreen:Se,collisionDetected:ue}}projectPathToScreenSpace(e,n,o){return e.map(s=>N(s.x,s.y,o,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],o=1/0,s=1/0,c=-1/0,f=-1/0;for(let C of e){let M=new p.P(C.x+He,C.y+He);o=Math.min(o,M.x),s=Math.min(s,M.y),c=Math.max(c,M.x),f=Math.max(f,M.y),n.push(M)}let _=this.grid.query(o,s,c,f).concat(this.ignoredGrid.query(o,s,c,f)),y={},b={};for(let C of _){let M=C.key;if(y[M.bucketInstanceId]===void 0&&(y[M.bucketInstanceId]={}),y[M.bucketInstanceId][M.featureIndex])continue;let P=[new p.P(C.x1,C.y1),new p.P(C.x2,C.y1),new p.P(C.x2,C.y2),new p.P(C.x1,C.y2)];p.am(n,P)&&(y[M.bucketInstanceId][M.featureIndex]=!0,b[M.bucketInstanceId]===void 0&&(b[M.bucketInstanceId]=[]),b[M.bucketInstanceId].push(M.featureIndex))}return b}insertCollisionBox(e,n,o,s,c,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:c,collisionGroupID:f,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,o,s,c,f){let _=o?this.ignoredGrid:this.grid,y={bucketInstanceId:s,featureIndex:c,collisionGroupID:f,overlapMode:n};for(let b=0;b<e.length;b+=4)_.insertCircle(y,e[b],e[b+1],e[b+2])}projectAndGetPerspectiveRatio(e,n,o,s,c){let f;c?(f=[n,o,c(n,o),1],p.af(f,f,e)):(f=[n,o,0,1],nt(f,f,e));let _=f[3];return{point:new p.P((f[0]/_+1)/2*this.transform.width+He,(-f[1]/_+1)/2*this.transform.height+He),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_*.5,isOccluded:!1,signedDistanceFromCamera:_}}getPerspectiveRatio(e,n,o,s,c){let f=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,o,s,c):N(n,o,e,c);return .5+this.transform.cameraToCenterDistance/f.signedDistanceFromCamera*.5}isOffscreen(e,n,o,s){return o<He||e>=this.screenRightBoundary||s<He||n>this.screenBottomBoundary}isInsideGrid(e,n,o,s){return o>=0&&e<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=p.an([]);return p.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,o,s,c,f,_,y,b,C){let M=new p.P(1,0),P=new p.P(0,1),L=new p.P(e.anchorPointX+_[0],e.anchorPointY+_[1]);if(f&&!c){let Se=this.projectAndGetPerspectiveRatio(o,L.x+1,L.y,s,b).point.sub(y.point).unit(),ke=Math.atan(Se.y/Se.x)+(Se.x<0?Math.PI:0),ve=Math.sin(ke),ye=Math.cos(ke);M=new p.P(ye,ve),P=new p.P(-ve,ye)}else if(!f&&c){let Se=-this.transform.angle,ke=Math.sin(Se),ve=Math.cos(Se);M=new p.P(ve,ke),P=new p.P(-ke,ve)}let F=y.point,q=n;if(c){F=L;let Se=this.transform.zoom-Math.floor(this.transform.zoom);q=Math.pow(2,-Se),q*=this.mapProjection.getPitchedTextCorrection(this.transform,L,s),C||(q*=p.ac(.5+y.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}C&&(F=F.add(M.mult(C.x*q)).add(P.mult(C.y*q)));let U=e.x1*q,$=e.x2*q,G=(U+$)/2,B=e.y1*q,K=e.y2*q,Q=(B+K)/2,re=[{offsetX:U,offsetY:B},{offsetX:G,offsetY:B},{offsetX:$,offsetY:B},{offsetX:$,offsetY:Q},{offsetX:$,offsetY:K},{offsetX:G,offsetY:K},{offsetX:U,offsetY:K},{offsetX:U,offsetY:Q}],ue=[];for(let{offsetX:Se,offsetY:ke}of re)ue.push(new p.P(F.x+M.x*Se+P.x*ke,F.y+M.y*Se+P.y*ke));let me=!1;if(c){let Se=ue.map(ke=>this.projectAndGetPerspectiveRatio(o,ke.x,ke.y,s,b));me=Se.some(ke=>!ke.isOccluded),ue=Se.map(ke=>ke.point)}else me=!0;return{box:p.ao(ue),allPointsOccluded:!me}}}function et(h,e,n){return e*(p.X/(h.tileSize*Math.pow(2,n-h.tileID.overscaledZ)))}class qt{constructor(e,n,o,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):s&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class zt{constructor(e,n,o,s,c){this.text=new qt(e?e.text:null,n,o,c),this.icon=new qt(e?e.icon:null,n,s,c)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Je{constructor(e,n,o){this.text=e,this.icon=n,this.skipFade=o}}class dt{constructor(){this.invProjMatrix=p.H(),this.viewportMatrix=p.H(),this.circles=[]}}class Et{constructor(e,n,o,s,c){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=s,this.tileID=c}}class $t{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[e]}}function Kt(h,e,n,o,s){let{horizontalAlign:c,verticalAlign:f}=p.au(h);return new p.P(-(c-.5)*e+o[0]*s,-(f-.5)*n+o[1]*s)}class di{constructor(e,n,o,s,c,f){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new at(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new $t(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let n=this.terrain;return n?(o,s)=>n.getElevation(e,o,s):null}getBucketParts(e,n,o,s){let c=o.getBucket(n),f=o.latestFeatureIndex;if(!c||!f||n.id!==c.layerIds[0])return;let _=o.collisionBoxArray,y=c.layers[0].layout,b=c.layers[0].paint,C=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),M=o.tileSize/p.X,P=o.tileID.toUnwrapped(),L=this.transform.calculatePosMatrix(P),F=y.get("text-pitch-alignment")==="map",q=y.get("text-rotation-alignment")==="map",U=et(o,1,this.transform.zoom),$=this.collisionIndex.mapProjection.translatePosition(this.transform,o,b.get("text-translate"),b.get("text-translate-anchor")),G=this.collisionIndex.mapProjection.translatePosition(this.transform,o,b.get("icon-translate"),b.get("icon-translate-anchor")),B=Xr(L,F,q,this.transform,U),K=null;if(F){let re=Cr(L,F,q,this.transform,U);K=p.L([],this.transform.labelPlaneMatrix,re)}this.retainedQueryData[c.bucketInstanceId]=new Et(c.bucketInstanceId,f,c.sourceLayerIndex,c.index,o.tileID);let Q={bucket:c,layout:y,translationText:$,translationIcon:G,posMatrix:L,unwrappedTileID:P,textLabelPlaneMatrix:B,labelToScreenMatrix:K,scale:C,textPixelRatio:M,holdingForFade:o.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:p.ag(c.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(c.sourceID)};if(s)for(let re of c.sortKeyRanges){let{sortKey:ue,symbolInstanceStart:me,symbolInstanceEnd:Se}=re;e.push({sortKey:ue,symbolInstanceStart:me,symbolInstanceEnd:Se,parameters:Q})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:c.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(e,n,o,s,c,f,_,y,b,C,M,P,L,F,q,U,$,G,B){let K=p.aq[e.textAnchor],Q=[e.textOffset0,e.textOffset1],re=Kt(K,o,s,Q,c),ue=this.collisionIndex.placeCollisionBox(n,P,y,b,C,_,f,U,M.predicate,B,re);if((!G||this.collisionIndex.placeCollisionBox(G,P,y,b,C,_,f,$,M.predicate,B,re).placeable)&&ue.placeable){let me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(me=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:Q,width:o,height:s,anchor:K,textBoxScale:c,prevAnchor:me},this.markUsedJustification(F,K,L,q),F.allowVerticalPlacement&&(this.markUsedOrientation(F,q,L),this.placedOrientations[L.crossTileID]=q),{shift:re,placedGlyphBoxes:ue}}}placeLayerBucketPart(e,n,o){let{bucket:s,layout:c,translationText:f,translationIcon:_,posMatrix:y,unwrappedTileID:b,textLabelPlaneMatrix:C,labelToScreenMatrix:M,textPixelRatio:P,holdingForFade:L,collisionBoxArray:F,partiallyEvaluatedTextSize:q,collisionGroup:U}=e.parameters,$=c.get("text-optional"),G=c.get("icon-optional"),B=p.ar(c,"text-overlap","text-allow-overlap"),K=B==="always",Q=p.ar(c,"icon-overlap","icon-allow-overlap"),re=Q==="always",ue=c.get("text-rotation-alignment")==="map",me=c.get("text-pitch-alignment")==="map",Se=c.get("icon-text-fit")!=="none",ke=c.get("symbol-z-order")==="viewport-y",ve=K&&(re||!s.hasIconData()||G),ye=re&&(K||!s.hasTextData()||$);!s.collisionArrays&&F&&s.deserializeCollisionBoxes(F);let ze=this._getTerrainElevationFunc(this.retainedQueryData[s.bucketInstanceId].tileID),Ze=(be,Me,Ue)=>{var Mt,We;if(n[be.crossTileID])return;if(L)return void(this.placements[be.crossTileID]=new Je(!1,!1,!1));let tt=!1,Tt=!1,ti=!0,sr=null,kt={box:null,placeable:!1,offscreen:null},wi={box:null,placeable:!1,offscreen:null},pi=null,ii=null,mi=null,Ir=0,oa=0,Zo=0;Me.textFeatureIndex?Ir=Me.textFeatureIndex:be.useRuntimeCollisionCircles&&(Ir=be.featureIndex),Me.verticalTextFeatureIndex&&(oa=Me.verticalTextFeatureIndex);let sa=Me.textBox;if(sa){let Wi=Jt=>{let ri=p.ah.horizontal;if(s.allowVerticalPlacement&&!Jt&&this.prevPlacement){let Oi=this.prevPlacement.placedOrientations[be.crossTileID];Oi&&(this.placedOrientations[be.crossTileID]=Oi,ri=Oi,this.markUsedOrientation(s,ri,be))}return ri},Xi=(Jt,ri)=>{if(s.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Me.verticalTextBox){for(let Oi of s.writingModes)if(Oi===p.ah.vertical?(kt=ri(),wi=kt):kt=Jt(),kt&&kt.placeable)break}else kt=Jt()},Yr=be.textAnchorOffsetStartIndex,lr=be.textAnchorOffsetEndIndex;if(lr===Yr){let Jt=(ri,Oi)=>{let rt=this.collisionIndex.placeCollisionBox(ri,B,P,y,b,me,ue,f,U.predicate,ze);return rt&&rt.placeable&&(this.markUsedOrientation(s,Oi,be),this.placedOrientations[be.crossTileID]=Oi),rt};Xi(()=>Jt(sa,p.ah.horizontal),()=>{let ri=Me.verticalTextBox;return s.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&ri?Jt(ri,p.ah.vertical):{box:null,offscreen:null}}),Wi(kt&&kt.placeable)}else{let Jt=p.aq[(We=(Mt=this.prevPlacement)===null||Mt===void 0?void 0:Mt.variableOffsets[be.crossTileID])===null||We===void 0?void 0:We.anchor],ri=(rt,Cn,la)=>{let ca=rt.x2-rt.x1,Pc=rt.y2-rt.y1,eu=be.textBoxScale,Ac=Se&&Q==="never"?Cn:null,Qr=null,zc=B==="never"?1:2,Ho="never";Jt&&zc++;for(let Ja=0;Ja<zc;Ja++){for(let Wo=Yr;Wo<lr;Wo++){let Xo=s.textAnchorOffsets.get(Wo);if(Jt&&Xo.textAnchor!==Jt)continue;let ha=this.attemptAnchorPlacement(Xo,rt,ca,Pc,eu,ue,me,P,y,b,U,Ho,be,s,la,f,_,Ac,ze);if(ha&&(Qr=ha.placedGlyphBoxes,Qr&&Qr.placeable))return tt=!0,sr=ha.shift,Qr}Jt?Jt=null:Ho=B}return o&&!Qr&&(Qr={box:this.collisionIndex.placeCollisionBox(sa,"always",P,y,b,me,ue,f,U.predicate,ze,new p.P(0,0)).box,offscreen:!1,placeable:!1}),Qr};Xi(()=>ri(sa,Me.iconBox,p.ah.horizontal),()=>{let rt=Me.verticalTextBox;return s.allowVerticalPlacement&&(!kt||!kt.placeable)&&be.numVerticalGlyphVertices>0&&rt?ri(rt,Me.verticalIconBox,p.ah.vertical):{box:null,occluded:!0,offscreen:null}}),kt&&(tt=kt.placeable,ti=kt.offscreen);let Oi=Wi(kt&&kt.placeable);if(!tt&&this.prevPlacement){let rt=this.prevPlacement.variableOffsets[be.crossTileID];rt&&(this.variableOffsets[be.crossTileID]=rt,this.markUsedJustification(s,rt.anchor,be,Oi))}}}if(pi=kt,tt=pi&&pi.placeable,ti=pi&&pi.offscreen,be.useRuntimeCollisionCircles){let Wi=s.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex),Xi=p.ai(s.textSizeData,q,Wi),Yr=c.get("text-padding");ii=this.collisionIndex.placeCollisionCircles(B,Wi,s.lineVertexArray,s.glyphOffsetArray,Xi,y,b,C,M,o,me,U.predicate,be.collisionCircleDiameter,Yr,f,ze),ii.circles.length&&ii.collisionDetected&&!o&&p.w("Collisions detected, but collision boxes are not shown"),tt=K||ii.circles.length>0&&!ii.collisionDetected,ti=ti&&ii.offscreen}if(Me.iconFeatureIndex&&(Zo=Me.iconFeatureIndex),Me.iconBox){let Wi=Xi=>this.collisionIndex.placeCollisionBox(Xi,Q,P,y,b,me,ue,_,U.predicate,ze,Se&&sr?sr:void 0);wi&&wi.placeable&&Me.verticalIconBox?(mi=Wi(Me.verticalIconBox),Tt=mi.placeable):(mi=Wi(Me.iconBox),Tt=mi.placeable),ti=ti&&mi.offscreen}let Hi=$||be.numHorizontalGlyphVertices===0&&be.numVerticalGlyphVertices===0,Go=G||be.numIconVertices===0;Hi||Go?Go?Hi||(Tt=Tt&&tt):tt=Tt&&tt:Tt=tt=Tt&&tt;let xl=Tt&&mi.placeable;if(tt&&pi.placeable&&this.collisionIndex.insertCollisionBox(pi.box,B,c.get("text-ignore-placement"),s.bucketInstanceId,wi&&wi.placeable&&oa?oa:Ir,U.ID),xl&&this.collisionIndex.insertCollisionBox(mi.box,Q,c.get("icon-ignore-placement"),s.bucketInstanceId,Zo,U.ID),ii&&tt&&this.collisionIndex.insertCollisionCircles(ii.circles,B,c.get("text-ignore-placement"),s.bucketInstanceId,Ir,U.ID),o&&this.storeCollisionData(s.bucketInstanceId,Ue,Me,pi,mi,ii),be.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(s.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[be.crossTileID]=new Je(tt||ve,Tt||ye,ti||s.justReloaded),n[be.crossTileID]=!0};if(ke){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let be=s.getSortedSymbolIndexes(this.transform.angle);for(let Me=be.length-1;Me>=0;--Me){let Ue=be[Me];Ze(s.symbolInstances.get(Ue),s.collisionArrays[Ue],Ue)}}else for(let be=e.symbolInstanceStart;be<e.symbolInstanceEnd;be++)Ze(s.symbolInstances.get(be),s.collisionArrays[be],be);if(o&&s.bucketInstanceId in this.collisionCircleArrays){let be=this.collisionCircleArrays[s.bucketInstanceId];p.as(be.invProjMatrix,y),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}storeCollisionData(e,n,o,s,c,f){if(o.textBox||o.iconBox){let _,y;this.collisionBoxArrays.has(e)?_=this.collisionBoxArrays.get(e):(_=new Map,this.collisionBoxArrays.set(e,_)),_.has(n)?y=_.get(n):(y={text:null,icon:null},_.set(n,y)),o.textBox&&(y.text=s.box),o.iconBox&&(y.icon=c.box)}if(f){let _=this.collisionCircleArrays[e];_===void 0&&(_=this.collisionCircleArrays[e]=new dt);for(let y=0;y<f.circles.length;y+=4)_.circles.push(f.circles[y+0]),_.circles.push(f.circles[y+1]),_.circles.push(f.circles[y+2]),_.circles.push(f.collisionDetected?1:0)}}markUsedJustification(e,n,o,s){let c;c=s===p.ah.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[p.at(n)];let f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(let _ of f)_>=0&&(e.text.placedSymbolArray.get(_).crossTileID=c>=0&&_!==c?0:o.crossTileID)}markUsedOrientation(e,n,o){let s=n===p.ah.horizontal||n===p.ah.horizontalOnly?n:0,c=n===p.ah.vertical?n:0,f=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(let _ of f)e.text.placedSymbolArray.get(_).placedOrientation=s;o.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=c)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let s=n?n.symbolFadeChange(e):1,c=n?n.opacities:{},f=n?n.variableOffsets:{},_=n?n.placedOrientations:{};for(let y in this.placements){let b=this.placements[y],C=c[y];C?(this.opacities[y]=new zt(C,s,b.text,b.icon),o=o||b.text!==C.text.placed||b.icon!==C.icon.placed):(this.opacities[y]=new zt(null,s,b.text,b.icon,b.skipFade),o=o||b.text||b.icon)}for(let y in c){let b=c[y];if(!this.opacities[y]){let C=new zt(b,s,!1,!1);C.isHidden()||(this.opacities[y]=C,o=o||b.text.placed||b.icon.placed)}}for(let y in f)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=f[y]);for(let y in _)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=_[y]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let o={};for(let s of n){let c=s.getBucket(e);c&&s.latestFeatureIndex&&e.id===c.layerIds[0]&&this.updateBucketOpacities(c,s.tileID,o,s.collisionBoxArray)}}updateBucketOpacities(e,n,o,s){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let c=e.layers[0],f=c.layout,_=new zt(null,0,!1,!1,!0),y=f.get("text-allow-overlap"),b=f.get("icon-allow-overlap"),C=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",L=f.get("icon-text-fit")!=="none",F=new zt(null,0,y&&(b||!e.hasIconData()||f.get("icon-optional")),b&&(y||!e.hasTextData()||f.get("text-optional")),!0);!e.collisionArrays&&s&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(s);let q=($,G,B)=>{for(let K=0;K<G/4;K++)$.opacityVertexArray.emplaceBack(B);$.hasVisibleVertices=$.hasVisibleVertices||B!==Vn},U=this.collisionBoxArrays.get(e.bucketInstanceId);for(let $=0;$<e.symbolInstances.length;$++){let G=e.symbolInstances.get($),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:K,crossTileID:Q}=G,re=this.opacities[Q];o[Q]?re=_:re||(re=F,this.opacities[Q]=re),o[Q]=!0;let ue=G.numIconVertices>0,me=this.placedOrientations[G.crossTileID],Se=me===p.ah.vertical,ke=me===p.ah.horizontal||me===p.ah.horizontalOnly;if(B>0||K>0){let ye=Ri(re.text);q(e.text,B,Se?Vn:ye),q(e.text,K,ke?Vn:ye);let ze=re.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Me=>{Me>=0&&(e.text.placedSymbolArray.get(Me).hidden=ze||Se?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=ze||ke?1:0);let Ze=this.variableOffsets[G.crossTileID];Ze&&this.markUsedJustification(e,Ze.anchor,G,me);let be=this.placedOrientations[G.crossTileID];be&&(this.markUsedJustification(e,"left",G,be),this.markUsedOrientation(e,be,G))}if(ue){let ye=Ri(re.icon),ze=!(L&&G.verticalPlacedIconSymbolIndex&&Se);G.placedIconSymbolIndex>=0&&(q(e.icon,G.numIconVertices,ze?ye:Vn),e.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=re.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,G.numVerticalIconVertices,ze?Vn:ye),e.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}let ve=U&&U.has($)?U.get($):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let ye=e.collisionArrays[$];if(ye){let ze=new p.P(0,0);if(ye.textBox||ye.verticalTextBox){let Ze=!0;if(C){let be=this.variableOffsets[Q];be?(ze=Kt(be.anchor,be.width,be.height,be.textOffset,be.textBoxScale),M&&ze._rotate(P?this.transform.angle:-this.transform.angle)):Ze=!1}if(ye.textBox||ye.verticalTextBox){let be;ye.textBox&&(be=Se),ye.verticalTextBox&&(be=ke),On(e.textCollisionBox.collisionVertexArray,re.text.placed,!Ze||be,ve.text,ze.x,ze.y)}}if(ye.iconBox||ye.verticalIconBox){let Ze=!!(!ke&&ye.verticalIconBox),be;ye.iconBox&&(be=Ze),ye.verticalIconBox&&(be=!Ze),On(e.iconCollisionBox.collisionVertexArray,re.icon.placed,be,ve.icon,L?ze.x:0,L?ze.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let $=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=$.invProjMatrix,e.placementViewportMatrix=$.viewportMatrix,e.collisionCircleArray=$.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>e}setStale(){this.stale=!0}}function On(h,e,n,o,s,c){o&&o.length!==0||(o=[0,0,0,0]);let f=o[0]-He,_=o[1]-He,y=o[2]-He,b=o[3]-He;h.emplaceBack(e?1:0,n?1:0,s||0,c||0,f,_),h.emplaceBack(e?1:0,n?1:0,s||0,c||0,y,_),h.emplaceBack(e?1:0,n?1:0,s||0,c||0,y,b),h.emplaceBack(e?1:0,n?1:0,s||0,c||0,f,b)}let pt=Math.pow(2,25),As=Math.pow(2,24),zs=Math.pow(2,17),Di=Math.pow(2,16),Li=Math.pow(2,9),Ih=Math.pow(2,8),Ui=Math.pow(2,1);function Ri(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let e=h.placed?1:0,n=Math.floor(127*h.opacity);return n*pt+e*As+n*zs+e*Di+n*Li+e*Ih+n*Ui+e}let Vn=0;function dn(){return{isOccluded:(h,e,n)=>!1,getPitchedTextCorrection:(h,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(h,e,n,o){throw new Error("Not implemented.")},translatePosition:(h,e,n,o)=>function(s,c,f,_,y=!1){if(!f[0]&&!f[1])return[0,0];let b=y?_==="map"?s.angle:0:_==="viewport"?-s.angle:0;if(b){let C=Math.sin(b),M=Math.cos(b);f=[f[0]*M-f[1]*C,f[0]*C+f[1]*M]}return[y?f[0]:et(c,f[0],s.zoom),y?f[1]:et(c,f[1],s.zoom)]}(h,e,n,o),getCircleRadiusCorrection:h=>1}}class Nt{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,o,s,c){let f=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(f,s,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,c())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((_,y)=>_.sortKey-y.sortKey));this._currentPartIndex<f.length;)if(n.placeLayerBucketPart(f[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,c())return!0;return!1}}class Da{constructor(e,n,o,s,c,f,_,y){this.placement=new di(e,dn(),n,f,_,y),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=c,this._done=!1}isDone(){return this._done}continuePlacement(e,n,o){let s=ge.now(),c=()=>!this._forceFullPlacement&&ge.now()-s>2;for(;this._currentPlacementIndex>=0;){let f=n[e[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(f.type==="symbol"&&(!f.minzoom||f.minzoom<=_)&&(!f.maxzoom||f.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Nt(f)),this._inProgressLayer.continuePlacement(o[f.source],this.placement,this._showCollisionBoxes,f,c))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let ir=512/p.X/2;class Ot{constructor(e,n,o){this.tileID=e,this.bucketInstanceId=o,this._symbolsByKey={};let s=new Map;for(let c=0;c<n.length;c++){let f=n.get(c),_=f.key,y=s.get(_);y?y.push(f):s.set(_,[f])}for(let[c,f]of s){let _={positions:f.map(y=>({x:Math.floor(y.anchorX*ir),y:Math.floor(y.anchorY*ir)})),crossTileIDs:f.map(y=>y.crossTileID)};if(_.positions.length>128){let y=new p.av(_.positions.length,16,Uint16Array);for(let{x:b,y:C}of _.positions)y.add(b,C);y.finish(),delete _.positions,_.index=y}this._symbolsByKey[c]=_}}getScaledCoordinates(e,n){let{x:o,y:s,z:c}=this.tileID.canonical,{x:f,y:_,z:y}=n.canonical,b=ir/Math.pow(2,y-c),C=(_*p.X+e.anchorY)*b,M=s*p.X*ir;return{x:Math.floor((f*p.X+e.anchorX)*b-o*p.X*ir),y:Math.floor(C-M)}}findMatches(e,n,o){let s=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let c=0;c<e.length;c++){let f=e.get(c);if(f.crossTileID)continue;let _=this._symbolsByKey[f.key];if(!_)continue;let y=this.getScaledCoordinates(f,n);if(_.index){let b=_.index.range(y.x-s,y.y-s,y.x+s,y.y+s).sort();for(let C of b){let M=_.crossTileIDs[C];if(!o[M]){o[M]=!0,f.crossTileID=M;break}}}else if(_.positions)for(let b=0;b<_.positions.length;b++){let C=_.positions[b],M=_.crossTileIDs[b];if(Math.abs(C.x-y.x)<=s&&Math.abs(C.y-y.y)<=s&&!o[M]){o[M]=!0,f.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class mo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let o in this.indexes){let s=this.indexes[o],c={};for(let f in s){let _=s[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+n),c[_.tileID.key]=_}this.indexes[o]=c}this.lng=e}addBucket(e,n,o){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let c=0;c<n.symbolInstances.length;c++)n.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let s=this.usedCrossTileIDs[e.overscaledZ];for(let c in this.indexes){let f=this.indexes[c];if(Number(c)>e.overscaledZ)for(let _ in f){let y=f[_];y.tileID.isChildOf(e)&&y.findMatches(n.symbolInstances,e,s)}else{let _=f[e.scaledTo(Number(c)).key];_&&_.findMatches(n.symbolInstances,e,s)}}for(let c=0;c<n.symbolInstances.length;c++){let f=n.symbolInstances.get(c);f.crossTileID||(f.crossTileID=o.generate(),s[f.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ot(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let o of n.getCrossTileIDsLists())for(let s of o)delete this.usedCrossTileIDs[e][s]}removeStaleBuckets(e){let n=!1;for(let o in this.indexes){let s=this.indexes[o];for(let c in s)e[s[c].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,s[c]),delete s[c],n=!0)}return n}}class Ds{constructor(){this.layerIndexes={},this.crossTileIDs=new mo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,o){let s=this.layerIndexes[e.id];s===void 0&&(s=this.layerIndexes[e.id]=new rr);let c=!1,f={};s.handleWrapJump(o);for(let _ of n){let y=_.getBucket(e);y&&e.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(_.tileID,y,this.crossTileIDs)&&(c=!0),f[y.bucketInstanceId]=!0)}return s.removeStaleBuckets(f)&&(c=!0),c}pruneUnusedLayers(e){let n={};e.forEach(o=>{n[o]=!0});for(let o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}let nr=(h,e)=>p.t(h,e&&e.filter(n=>n.identifier!=="source.canvas")),Eh=p.aw();class fo extends p.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(let o in this.sourceCaches){let s=this.sourceCaches[o].getSource().type;s!=="vector"&&s!=="geojson"||this.sourceCaches[o].reload()}},this.map=e,this.dispatcher=new hn(cn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(o,s)=>this.getGlyphs(o,s)),this.dispatcher.registerMessageHandler("GI",(o,s)=>this.getImages(o,s)),this.imageManager=new Qt,this.imageManager.setEventedParent(this),this.glyphManager=new vr(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ln(256,512),this.crossTileSymbolIndex=new Ds,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",p.ay()),wr().on(fe,this._rtlPluginLoaded),this.on("data",o=>{if(o.dataType!=="source"||o.sourceDataType!=="metadata")return;let s=this.sourceCaches[o.sourceId];if(!s)return;let c=s.getSource();if(c&&c.vectorLayerIds)for(let f in this._layers){let _=this._layers[f];_.source===c.id&&this._validateLayer(_)}})}loadURL(e,n={},o){this.fire(new p.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;let s=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let c=this._loadStyleRequest;p.h(s,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,n,o)}).catch(f=>{this._loadStyleRequest=null,f&&!c.signal.aborted&&this.fire(new p.j(f))})}loadJSON(e,n={},o){this.fire(new p.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,o)}).catch(()=>{})}loadEmpty(){this.fire(new p.k("dataloading",{dataType:"style"})),this._load(Eh,{validate:!1})}_load(e,n,o){var s;let c=n.transformStyle?n.transformStyle(o,e):e;if(!n.validate||!nr(this,p.u(c))){this._loaded=!0,this.stylesheet=c;for(let f in c.sources)this.addSource(f,c.sources[f],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs),this._createLayers(),this.light=new Lr(this.stylesheet.light),this.sky=new Qi(this.stylesheet.sky),this.map.setTerrain((s=this.stylesheet.terrain)!==null&&s!==void 0?s:null),this.fire(new p.k("data",{dataType:"style"})),this.fire(new p.k("style.load"))}}_createLayers(){let e=p.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(let n of e){let o=p.aA(n);o.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=o}}_loadSprite(e,n=!1,o=void 0){let s;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(c,f,_,y){return p._(this,void 0,void 0,function*(){let b=yr(c),C=_>1?"@2x":"",M={},P={};for(let{id:L,url:F}of b){let q=f.transformRequest(ka(F,C,".json"),"SpriteJSON");M[L]=p.h(q,y);let U=f.transformRequest(ka(F,C,".png"),"SpriteImage");P[L]=Ai.getImage(U,y)}return yield Promise.all([...Object.values(M),...Object.values(P)]),function(L,F){return p._(this,void 0,void 0,function*(){let q={};for(let U in L){q[U]={};let $=ge.getImageCanvasContext((yield F[U]).data),G=(yield L[U]).data;for(let B in G){let{width:K,height:Q,x:re,y:ue,sdf:me,pixelRatio:Se,stretchX:ke,stretchY:ve,content:ye,textFitWidth:ze,textFitHeight:Ze}=G[B];q[U][B]={data:null,pixelRatio:Se,sdf:me,stretchX:ke,stretchY:ve,content:ye,textFitWidth:ze,textFitHeight:Ze,spriteData:{width:K,height:Q,x:re,y:ue,context:$}}}}return q})}(M,P)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(c=>{if(this._spriteRequest=null,c)for(let f in c){this._spritesImagesIds[f]=[];let _=this._spritesImagesIds[f]?this._spritesImagesIds[f].filter(y=>!(y in c)):[];for(let y of _)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(let y in c[f]){let b=f==="default"?y:`${f}:${y}`;this._spritesImagesIds[f].push(b),b in this.imageManager.images?this.imageManager.updateImage(b,c[f][y],!1):this.imageManager.addImage(b,c[f][y]),n&&(this._changedImages[b]=!0)}}}).catch(c=>{this._spriteRequest=null,s=c,this.fire(new p.j(s))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"})),o&&o(s)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}_validateLayer(e){let n=this.sourceCaches[e.source];if(!n)return;let o=e.sourceLayer;if(!o)return;let s=n.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(o)===-1)&&this.fire(new p.j(new Error(`Source layer "${o}" does not exist on source "${s.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){let o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?p.aB(o):o);let s=[];for(let c of e)if(o[c]){let f=n?p.aB(o[c]):o[c];s.push(f)}return s}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let n=Object.keys(this._layers);for(let o of n){let s=this._layers[o];s.type!=="custom"&&(e[o]=s.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let n=this._changed;if(n){let s=Object.keys(this._updatedLayers),c=Object.keys(this._removedLayers);(s.length||c.length)&&this._updateWorkerLayers(s,c);for(let f in this._updatedSources){let _=this._updatedSources[f];if(_==="reload")this._reloadSource(f);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(f)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let f in this._updatedPaintProps)this._layers[f].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let o={};for(let s in this.sourceCaches){let c=this.sourceCaches[s];o[s]=c.used,c.used=!1}for(let s of this._order){let c=this._layers[s];c.recalculate(e,this._availableImages),!c.isHidden(e.zoom)&&c.source&&(this.sourceCaches[c.source].used=!0)}for(let s in o){let c=this.sourceCaches[s];!!o[s]!=!!c.used&&c.fire(new p.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new p.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var o;this._checkLoaded();let s=this.serialize();if(e=n.transformStyle?n.transformStyle(s,e):e,((o=n.validate)===null||o===void 0||o)&&nr(this,p.u(e)))return!1;(e=p.aB(e)).layers=p.az(e.layers);let c=p.aC(s,e),f=this._getOperationsToPerform(c);if(f.unimplemented.length>0)throw new Error(`Unimplemented: ${f.unimplemented.join(", ")}.`);if(f.operations.length===0)return!1;for(let _ of f.operations)_();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let n=[],o=[];for(let s of e)switch(s.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,s.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,s.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,s.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,s.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,s.args));break;case"addSource":n.push(()=>this.addSource.apply(this,s.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,s.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,s.args));break;case"setLight":n.push(()=>this.setLight.apply(this,s.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,s.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,s.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,s.args));break;case"setSky":n.push(()=>this.setSky.apply(this,s.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,s.args));break;case"setTransition":n.push(()=>{});break;default:o.push(s.command)}return{operations:n,unimplemented:o}}addImage(e,n){if(this.getImage(e))return this.fire(new p.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new p.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,o={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(p.u.source,`sources.${e}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let s=this.sourceCaches[e]=new Ne(e,n,this.dispatcher);s.style=this,s.setEventedParent(this,()=>({isSourceLoaded:s.loaded(),source:s.serialize(),sourceId:e})),s.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let o in this._layers)if(this._layers[o].source===e)return this.fire(new p.j(new Error(`Source "${e}" cannot be removed while layer "${o}" is using it.`)));let n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new p.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let o=this.sourceCaches[e].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,o={}){this._checkLoaded();let s=e.id;if(this.getLayer(s))return void this.fire(new p.j(new Error(`Layer "${s}" already exists on this map.`)));let c;if(e.type==="custom"){if(nr(this,p.aD(e)))return;c=p.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(s,e.source),e=p.aB(e),e=p.e(e,{source:s})),this._validate(p.u.layer,`layers.${s}`,e,{arrayIndex:-1},o))return;c=p.aA(e),this._validateLayer(c),c.setEventedParent(this,{layer:{id:s}})}let f=n?this._order.indexOf(n):this._order.length;if(n&&f===-1)this.fire(new p.j(new Error(`Cannot add layer "${s}" before non-existing layer "${n}".`)));else{if(this._order.splice(f,0,s),this._layerOrderChanged=!0,this._layers[s]=c,this._removedLayers[s]&&c.source&&c.type!=="custom"){let _=this._removedLayers[s];delete this._removedLayers[s],_.type!==c.type?this._updatedSources[c.source]="clear":(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause())}this._updateLayer(c),c.onAdd&&c.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new p.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;let o=this._order.indexOf(e);this._order.splice(o,1);let s=n?this._order.indexOf(n):this._order.length;n&&s===-1?this.fire(new p.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(s,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let n=this._layers[e];if(!n)return void this.fire(new p.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);let o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,o){this._checkLoaded();let s=this.getLayer(e);s?s.minzoom===n&&s.maxzoom===o||(n!=null&&(s.minzoom=n),o!=null&&(s.maxzoom=o),this._updateLayer(s)):this.fire(new p.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,o={}){this._checkLoaded();let s=this.getLayer(e);if(s){if(!p.aE(s.filter,n))return n==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(p.u.filter,`layers.${s.id}.filter`,n,null,o)||(s.filter=p.aB(n),this._updateLayer(s)))}else this.fire(new p.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return p.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,o,s={}){this._checkLoaded();let c=this.getLayer(e);c?p.aE(c.getLayoutProperty(n),o)||(c.setLayoutProperty(n,o,s),this._updateLayer(c)):this.fire(new p.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){let o=this.getLayer(e);if(o)return o.getLayoutProperty(n);this.fire(new p.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,o,s={}){this._checkLoaded();let c=this.getLayer(e);c?p.aE(c.getPaintProperty(n),o)||(c.setPaintProperty(n,o,s)&&this._updateLayer(c),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new p.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let o=e.source,s=e.sourceLayer,c=this.sourceCaches[o];if(c===void 0)return void this.fire(new p.j(new Error(`The source '${o}' does not exist in the map's style.`)));let f=c.getSource().type;f==="geojson"&&s?this.fire(new p.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):f!=="vector"||s?(e.id===void 0&&this.fire(new p.j(new Error("The feature id parameter must be provided."))),c.setFeatureState(s,e.id,n)):this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();let o=e.source,s=this.sourceCaches[o];if(s===void 0)return void this.fire(new p.j(new Error(`The source '${o}' does not exist in the map's style.`)));let c=s.getSource().type,f=c==="vector"?e.sourceLayer:void 0;c!=="vector"||f?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new p.j(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(f,e.id,n):this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let n=e.source,o=e.sourceLayer,s=this.sourceCaches[n];if(s!==void 0)return s.getSource().type!=="vector"||o?(e.id===void 0&&this.fire(new p.j(new Error("The feature id parameter must be provided."))),s.getFeatureState(o,e.id)):void this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new p.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return p.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=p.aF(this.sourceCaches,c=>c.serialize()),n=this._serializeByIds(this._order,!0),o=this.map.getTerrain()||void 0,s=this.stylesheet;return p.aG({version:s.version,name:s.name,metadata:s.metadata,light:s.light,sky:s.sky,center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,sprite:s.sprite,glyphs:s.glyphs,transition:s.transition,sources:e,layers:n,terrain:o},c=>c!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let n=f=>this._layers[f].type==="fill-extrusion",o={},s=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_)){o[_]=f;for(let y of e){let b=y[_];if(b)for(let C of b)s.push(C)}}}s.sort((f,_)=>_.intersectionZ-f.intersectionZ);let c=[];for(let f=this._order.length-1;f>=0;f--){let _=this._order[f];if(n(_))for(let y=s.length-1;y>=0;y--){let b=s[y].feature;if(o[b.layer.id]<f)break;c.push(b),s.pop()}else for(let y of e){let b=y[_];if(b)for(let C of b)c.push(C.feature)}}return c}queryRenderedFeatures(e,n,o){n&&n.filter&&this._validate(p.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);let s={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new p.j(new Error("parameters.layers must be an Array."))),[];for(let _ of n.layers){let y=this._layers[_];if(!y)return this.fire(new p.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];s[y.source]=!0}}let c=[];n.availableImages=this._availableImages;let f=this._serializedAllLayers();for(let _ in this.sourceCaches)n.layers&&!s[_]||c.push(Zr(this.sourceCaches[_],this._layers,f,e,n,o));return this.placement&&c.push(function(_,y,b,C,M,P,L){let F={},q=P.queryRenderedSymbols(C),U=[];for(let $ of Object.keys(q).map(Number))U.push(L[$]);U.sort(Gr);for(let $ of U){let G=$.featureIndex.lookupSymbolFeatures(q[$.bucketInstanceId],y,$.bucketIndex,$.sourceLayerIndex,M.filter,M.layers,M.availableImages,_);for(let B in G){let K=F[B]=F[B]||[],Q=G[B];Q.sort((re,ue)=>{let me=$.featureSortOrder;if(me){let Se=me.indexOf(re.featureIndex);return me.indexOf(ue.featureIndex)-Se}return ue.featureIndex-re.featureIndex});for(let re of Q)K.push(re)}}for(let $ in F)F[$].forEach(G=>{let B=G.feature,K=b[_[$].source].getFeatureState(B.layer["source-layer"],B.id);B.source=B.layer.source,B.layer["source-layer"]&&(B.sourceLayer=B.layer["source-layer"]),B.state=K});return F}(this._layers,f,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(e,n){n&&n.filter&&this._validate(p.u.filter,"querySourceFeatures.filter",n.filter,null,n);let o=this.sourceCaches[e];return o?function(s,c){let f=s.getRenderableIds().map(b=>s.getTileByID(b)),_=[],y={};for(let b=0;b<f.length;b++){let C=f[b],M=C.tileID.canonical.key;y[M]||(y[M]=!0,C.querySourceFeatures(_,c))}return _}(o,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();let o=this.light.getLight(),s=!1;for(let f in e)if(!p.aE(e[f],o[f])){s=!0;break}if(!s)return;let c={now:ge.now(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(c)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){let o=this.getSky(),s=!1;if(!e&&!o)return;if(e&&!o)s=!0;else if(!e&&o)s=!0;else for(let f in e)if(!p.aE(e[f],o[f])){s=!0;break}if(!s)return;let c={now:ge.now(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(c)}_validate(e,n,o,s,c={}){return(!c||c.validate!==!1)&&nr(this,e.call(p.u,p.e({key:n,style:this.serialize(),value:o,styleSpec:p.v},s)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(fe,this._rtlPluginLoaded);for(let n in this._layers)this._layers[n].setEventedParent(null);for(let n in this.sourceCaches){let o=this.sourceCaches[n];o.setEventedParent(null),o.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,o,s,c=!1){let f=!1,_=!1,y={};for(let b of this._order){let C=this._layers[b];if(C.type!=="symbol")continue;if(!y[C.source]){let P=this.sourceCaches[C.source];y[C.source]=P.getRenderableIds(!0).map(L=>P.getTileByID(L)).sort((L,F)=>F.tileID.overscaledZ-L.tileID.overscaledZ||(L.tileID.isLessThan(F.tileID)?-1:1))}let M=this.crossTileSymbolIndex.addLayer(C,y[C.source],e.center.lng);f=f||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((c=c||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ge.now(),e.zoom))&&(this.pauseablePlacement=new Da(e,this.map.terrain,this._order,c,n,o,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ge.now()),_=!0),f&&this.pauseablePlacement.placement.setStale()),_||f)for(let b of this._order){let C=this._layers[b];C.type==="symbol"&&this.placement.updateLayerOpacities(C,y[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ge.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return p._(this,void 0,void 0,function*(){let o=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();let s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,n.icons),o})}getGlyphs(e,n){return p._(this,void 0,void 0,function*(){let o=yield this.glyphManager.getGlyphs(n.stacks),s=this.sourceCaches[n.source];return s&&s.setDependencies(n.tileID.key,n.type,[""]),o})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(p.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,o={},s){this._checkLoaded();let c=[{id:e,url:n}],f=[...yr(this.stylesheet.sprite),...c];this._validate(p.u.sprite,"sprite",f,null,o)||(this.stylesheet.sprite=f,this._loadSprite(c,!0,s))}removeSprite(e){this._checkLoaded();let n=yr(this.stylesheet.sprite);if(n.find(o=>o.id===e)){if(this._spritesImagesIds[e])for(let o of this._spritesImagesIds[e])this.imageManager.removeImage(o),this._changedImages[o]=!0;n.splice(n.findIndex(o=>o.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}else this.fire(new p.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return yr(this.stylesheet.sprite)}setSprite(e,n={},o){this._checkLoaded(),e&&this._validate(p.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,o):(this._unloadSprite(),o&&o(null)))}}var pn=p.Y([{name:"a_pos",type:"Int16",components:2}]);let Kr={prelude:ct(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ct(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ct(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ct(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ct(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ct(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ct("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ct(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ct(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ct(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ct(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ct(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ct(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ct(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ct(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ct(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ct(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ct(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ct(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ct(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ct("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ct("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ct("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ct("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ct(h,e){let n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=e.match(/attribute ([\w]+) ([\w]+)/g),s=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),c=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=c?c.concat(s):s,_={};return{fragmentSource:h=h.replace(n,(y,b,C,M,P)=>(_[P]=!0,b==="define"?`
#ifndef HAS_UNIFORM_u_${P}
varying ${C} ${M} ${P};
#else
uniform ${C} ${M} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${C} ${M} ${P} = u_${P};
#endif
`)),vertexSource:e=e.replace(n,(y,b,C,M,P)=>{let L=M==="float"?"vec2":"vec4",F=P.match(/color/)?"color":L;return _[P]?b==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${C} ${L} a_${P};
varying ${C} ${M} ${P};
#else
uniform ${C} ${M} u_${P};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${C} ${M} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${F}(a_${P}, u_${P}_t);
#else
    ${C} ${M} ${P} = u_${P};
#endif
`:b==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
attribute ${C} ${L} a_${P};
#else
uniform ${C} ${M} u_${P};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${C} ${M} ${P} = a_${P};
#else
    ${C} ${M} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${C} ${M} ${P} = unpack_mix_${F}(a_${P}, u_${P}_t);
#else
    ${C} ${M} ${P} = u_${P};
#endif
`}),staticAttributes:o,staticUniforms:f}}class Ls{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,o,s,c,f,_,y,b){this.context=e;let C=this.boundPaintVertexBuffers.length!==s.length;for(let M=0;!C&&M<s.length;M++)this.boundPaintVertexBuffers[M]!==s[M]&&(C=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==o||C||this.boundIndexBuffer!==c||this.boundVertexOffset!==f||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==b?this.freshBind(n,o,s,c,f,_,y,b):(e.bindVertexArray.set(this.vao),_&&_.bind(),c&&c.dynamicDraw&&c.bind(),y&&y.bind(),b&&b.bind())}freshBind(e,n,o,s,c,f,_,y){let b=e.numAttributes,C=this.context,M=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=s,this.boundVertexOffset=c,this.boundDynamicVertexBuffer=f,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=y,n.enableAttributes(M,e);for(let P of o)P.enableAttributes(M,e);f&&f.enableAttributes(M,e),_&&_.enableAttributes(M,e),y&&y.enableAttributes(M,e),n.bind(),n.setVertexAttribPointers(M,e,c);for(let P of o)P.bind(),P.setVertexAttribPointers(M,e,c);f&&(f.bind(),f.setVertexAttribPointers(M,e,c)),s&&s.bind(),_&&(_.bind(),_.setVertexAttribPointers(M,e,c)),y&&(y.bind(),y.setVertexAttribPointers(M,e,c)),C.currentNumAttributes=b}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let Rs=(h,e,n,o,s)=>({u_matrix:h,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:o?o.properties.get("fog-color"):p.aM.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?o.calculateFogBlendOpacity(s):0,u_horizon_color:o?o.properties.get("horizon-color"):p.aM.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1});function qn(h){let e=[];for(let n=0;n<h.length;n++){if(h[n]===null)continue;let o=h[n].split(" ");e.push(o.pop())}return e}class Fs{constructor(e,n,o,s,c,f){let _=e.gl;this.program=_.createProgram();let y=qn(n.staticAttributes),b=o?o.getBinderAttributes():[],C=y.concat(b),M=Kr.prelude.staticUniforms?qn(Kr.prelude.staticUniforms):[],P=n.staticUniforms?qn(n.staticUniforms):[],L=o?o.getBinderUniforms():[],F=M.concat(P).concat(L),q=[];for(let re of F)q.indexOf(re)<0&&q.push(re);let U=o?o.defines():[];c&&U.push("#define OVERDRAW_INSPECTOR;"),f&&U.push("#define TERRAIN3D;");let $=U.concat(Kr.prelude.fragmentSource,n.fragmentSource).join(`
`),G=U.concat(Kr.prelude.vertexSource,n.vertexSource).join(`
`),B=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(B,$),_.compileShader(B),!_.getShaderParameter(B,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(B)}`);_.attachShader(this.program,B);let K=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(K,G),_.compileShader(K),!_.getShaderParameter(K,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(K)}`);_.attachShader(this.program,K),this.attributes={};let Q={};this.numAttributes=C.length;for(let re=0;re<this.numAttributes;re++)C[re]&&(_.bindAttribLocation(this.program,re,C[re]),this.attributes[C[re]]=re);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(K),_.deleteShader(B);for(let re=0;re<q.length;re++){let ue=q[re];if(ue&&!Q[ue]){let me=_.getUniformLocation(this.program,ue);me&&(Q[ue]=me)}}this.fixedUniforms=s(e,Q),this.terrainUniforms=((re,ue)=>({u_depth:new p.aH(re,ue.u_depth),u_terrain:new p.aH(re,ue.u_terrain),u_terrain_dim:new p.aI(re,ue.u_terrain_dim),u_terrain_matrix:new p.aJ(re,ue.u_terrain_matrix),u_terrain_unpack:new p.aK(re,ue.u_terrain_unpack),u_terrain_exaggeration:new p.aI(re,ue.u_terrain_exaggeration)}))(e,Q),this.binderUniforms=o?o.getUniforms(e,Q):[]}draw(e,n,o,s,c,f,_,y,b,C,M,P,L,F,q,U,$,G){let B=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(o),e.setStencilMode(s),e.setColorMode(c),e.setCullFace(f),y){e.activeTexture.set(B.TEXTURE2),B.bindTexture(B.TEXTURE_2D,y.depthTexture),e.activeTexture.set(B.TEXTURE3),B.bindTexture(B.TEXTURE_2D,y.texture);for(let Q in this.terrainUniforms)this.terrainUniforms[Q].set(y[Q])}for(let Q in this.fixedUniforms)this.fixedUniforms[Q].set(_[Q]);q&&q.setUniforms(e,this.binderUniforms,L,{zoom:F});let K=0;switch(n){case B.LINES:K=2;break;case B.TRIANGLES:K=3;break;case B.LINE_STRIP:K=1}for(let Q of P.get()){let re=Q.vaos||(Q.vaos={});(re[b]||(re[b]=new Ls)).bind(e,this,C,q?q.getPaintVertexBuffers():[],M,Q.vertexOffset,U,$,G),B.drawElements(n,Q.primitiveLength*K,B.UNSIGNED_SHORT,Q.primitiveOffset*K*2)}}}function go(h,e,n){let o=1/et(n,1,e.transform.tileZoom),s=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,e.transform.tileZoom)/s,f=c*(n.tileID.canonical.x+n.tileID.wrap*s),_=c*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[f>>16,_>>16],u_pixel_coord_lower:[65535&f,65535&_]}}let La=(h,e,n,o)=>{let s=e.style.light,c=s.properties.get("position"),f=[c.x,c.y,c.z],_=function(){var b=new p.A(9);return p.A!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0),b[0]=1,b[4]=1,b[8]=1,b}();s.properties.get("anchor")==="viewport"&&function(b,C){var M=Math.sin(C),P=Math.cos(C);b[0]=P,b[1]=M,b[2]=0,b[3]=-M,b[4]=P,b[5]=0,b[6]=0,b[7]=0,b[8]=1}(_,-e.transform.angle),function(b,C,M){var P=C[0],L=C[1],F=C[2];b[0]=P*M[0]+L*M[3]+F*M[6],b[1]=P*M[1]+L*M[4]+F*M[7],b[2]=P*M[2]+L*M[5]+F*M[8]}(f,f,_);let y=s.properties.get("color");return{u_matrix:h,u_lightpos:f,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+n,u_opacity:o}},_o=(h,e,n,o,s,c,f)=>p.e(La(h,e,n,o),go(c,e,f),{u_height_factor:-Math.pow(2,s.overscaledZ)/f.tileSize/8}),Nn=h=>({u_matrix:h}),Jl=(h,e,n,o)=>p.e(Nn(h),go(n,e,o)),Ph=(h,e)=>({u_matrix:h,u_world:e}),Yl=(h,e,n,o,s)=>p.e(Jl(h,e,n,o),{u_world:s}),Ah=(h,e,n,o)=>{let s=h.transform,c,f;if(o.paint.get("circle-pitch-alignment")==="map"){let _=et(n,1,s.zoom);c=!0,f=[_,_]}else c=!1,f=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(e.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+c,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:f}},mn=(h,e,n)=>({u_matrix:h,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),Ra=(h,e,n=1)=>({u_matrix:h,u_color:e,u_overlay:0,u_overlay_scale:n}),xi=h=>({u_matrix:h}),bi=(h,e,n,o)=>({u_matrix:h,u_extrude_scale:et(e,1,n),u_intensity:o}),yo=(h,e,n,o)=>{let s=p.H();p.aP(s,0,h.width,h.height,0,0,1);let c=h.context.gl;return{u_matrix:s,u_world:[c.drawingBufferWidth,c.drawingBufferHeight],u_image:n,u_color_ramp:o,u_opacity:e.paint.get("heatmap-opacity")}};function vo(h,e){let n=Math.pow(2,e.canonical.z),o=e.canonical.y;return[new p.Z(0,o/n).toLngLat().lat,new p.Z(0,(o+1)/n).toLngLat().lat]}let xo=(h,e,n,o)=>{let s=h.transform;return{u_matrix:tc(h,e,n,o),u_ratio:1/et(e,1,s.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Ql=(h,e,n,o,s)=>p.e(xo(h,e,n,s),{u_image:0,u_image_height:o}),jn=(h,e,n,o,s)=>{let c=h.transform,f=ec(e,c);return{u_matrix:tc(h,e,n,s),u_texsize:e.imageAtlasTexture.size,u_ratio:1/et(e,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[f,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},zh=(h,e,n,o,s,c)=>{let f=h.lineAtlas,_=ec(e,h.transform),y=n.layout.get("line-cap")==="round",b=f.getDash(o.from,y),C=f.getDash(o.to,y),M=b.width*s.fromScale,P=C.width*s.toScale;return p.e(xo(h,e,n,c),{u_patternscale_a:[_/M,-b.height/2],u_patternscale_b:[_/P,-C.height/2],u_sdfgamma:f.width/(256*Math.min(M,P)*h.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:C.y,u_mix:s.t})};function ec(h,e){return 1/et(h,1,e.tileZoom)}function tc(h,e,n,o){return h.translatePosMatrix(o?o.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let Dh=(h,e,n,o,s)=>{return{u_matrix:h,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(f=s.paint.get("raster-saturation"),f>0?1-1/(1.001-f):-f),u_contrast_factor:(c=s.paint.get("raster-contrast"),c>0?1/(1-c):1+c),u_spin_weights:Lh(s.paint.get("raster-hue-rotate"))};var c,f};function Lh(h){h*=Math.PI/180;let e=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}let ic=(h,e,n,o,s,c,f,_,y,b,C,M,P,L)=>{let F=f.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:F.width/F.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:y,u_coord_matrix:b,u_is_text:+M,u_pitch_with_map:+o,u_is_along_line:s,u_is_variable_anchor:c,u_texsize:P,u_texture:0,u_translation:C,u_pitched_scale:L}},Fa=(h,e,n,o,s,c,f,_,y,b,C,M,P,L,F)=>{let q=f.transform;return p.e(ic(h,e,n,o,s,c,f,_,y,b,C,M,P,F),{u_gamma_scale:o?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+L})},Bs=(h,e,n,o,s,c,f,_,y,b,C,M,P,L)=>p.e(Fa(h,e,n,o,s,c,f,_,y,b,C,!0,M,!0,L),{u_texsize_icon:P,u_texture_icon:1}),bo=(h,e,n)=>({u_matrix:h,u_opacity:e,u_color:n}),Os=(h,e,n,o,s,c)=>p.e(function(f,_,y,b){let C=y.imageManager.getPattern(f.from.toString()),M=y.imageManager.getPattern(f.to.toString()),{width:P,height:L}=y.imageManager.getPixelSize(),F=Math.pow(2,b.tileID.overscaledZ),q=b.tileSize*Math.pow(2,y.transform.tileZoom)/F,U=q*(b.tileID.canonical.x+b.tileID.wrap*F),$=q*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[P,L],u_mix:_.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/et(b,1,y.transform.tileZoom),u_pixel_coord_upper:[U>>16,$>>16],u_pixel_coord_lower:[65535&U,65535&$]}}(o,c,n,s),{u_matrix:h,u_opacity:e}),Vs={fillExtrusion:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_lightpos:new p.aN(h,e.u_lightpos),u_lightintensity:new p.aI(h,e.u_lightintensity),u_lightcolor:new p.aN(h,e.u_lightcolor),u_vertical_gradient:new p.aI(h,e.u_vertical_gradient),u_opacity:new p.aI(h,e.u_opacity)}),fillExtrusionPattern:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_lightpos:new p.aN(h,e.u_lightpos),u_lightintensity:new p.aI(h,e.u_lightintensity),u_lightcolor:new p.aN(h,e.u_lightcolor),u_vertical_gradient:new p.aI(h,e.u_vertical_gradient),u_height_factor:new p.aI(h,e.u_height_factor),u_image:new p.aH(h,e.u_image),u_texsize:new p.aO(h,e.u_texsize),u_pixel_coord_upper:new p.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(h,e.u_pixel_coord_lower),u_scale:new p.aN(h,e.u_scale),u_fade:new p.aI(h,e.u_fade),u_opacity:new p.aI(h,e.u_opacity)}),fill:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix)}),fillPattern:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_image:new p.aH(h,e.u_image),u_texsize:new p.aO(h,e.u_texsize),u_pixel_coord_upper:new p.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(h,e.u_pixel_coord_lower),u_scale:new p.aN(h,e.u_scale),u_fade:new p.aI(h,e.u_fade)}),fillOutline:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_world:new p.aO(h,e.u_world)}),fillOutlinePattern:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_world:new p.aO(h,e.u_world),u_image:new p.aH(h,e.u_image),u_texsize:new p.aO(h,e.u_texsize),u_pixel_coord_upper:new p.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(h,e.u_pixel_coord_lower),u_scale:new p.aN(h,e.u_scale),u_fade:new p.aI(h,e.u_fade)}),circle:(h,e)=>({u_camera_to_center_distance:new p.aI(h,e.u_camera_to_center_distance),u_scale_with_map:new p.aH(h,e.u_scale_with_map),u_pitch_with_map:new p.aH(h,e.u_pitch_with_map),u_extrude_scale:new p.aO(h,e.u_extrude_scale),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_matrix:new p.aJ(h,e.u_matrix)}),collisionBox:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_pixel_extrude_scale:new p.aO(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_inv_matrix:new p.aJ(h,e.u_inv_matrix),u_camera_to_center_distance:new p.aI(h,e.u_camera_to_center_distance),u_viewport_size:new p.aO(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new p.aL(h,e.u_color),u_matrix:new p.aJ(h,e.u_matrix),u_overlay:new p.aH(h,e.u_overlay),u_overlay_scale:new p.aI(h,e.u_overlay_scale)}),clippingMask:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix)}),heatmap:(h,e)=>({u_extrude_scale:new p.aI(h,e.u_extrude_scale),u_intensity:new p.aI(h,e.u_intensity),u_matrix:new p.aJ(h,e.u_matrix)}),heatmapTexture:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_world:new p.aO(h,e.u_world),u_image:new p.aH(h,e.u_image),u_color_ramp:new p.aH(h,e.u_color_ramp),u_opacity:new p.aI(h,e.u_opacity)}),hillshade:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_image:new p.aH(h,e.u_image),u_latrange:new p.aO(h,e.u_latrange),u_light:new p.aO(h,e.u_light),u_shadow:new p.aL(h,e.u_shadow),u_highlight:new p.aL(h,e.u_highlight),u_accent:new p.aL(h,e.u_accent)}),hillshadePrepare:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_image:new p.aH(h,e.u_image),u_dimension:new p.aO(h,e.u_dimension),u_zoom:new p.aI(h,e.u_zoom),u_unpack:new p.aK(h,e.u_unpack)}),line:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_ratio:new p.aI(h,e.u_ratio),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_ratio:new p.aI(h,e.u_ratio),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(h,e.u_units_to_pixels),u_image:new p.aH(h,e.u_image),u_image_height:new p.aI(h,e.u_image_height)}),linePattern:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_texsize:new p.aO(h,e.u_texsize),u_ratio:new p.aI(h,e.u_ratio),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_image:new p.aH(h,e.u_image),u_units_to_pixels:new p.aO(h,e.u_units_to_pixels),u_scale:new p.aN(h,e.u_scale),u_fade:new p.aI(h,e.u_fade)}),lineSDF:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_ratio:new p.aI(h,e.u_ratio),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(h,e.u_units_to_pixels),u_patternscale_a:new p.aO(h,e.u_patternscale_a),u_patternscale_b:new p.aO(h,e.u_patternscale_b),u_sdfgamma:new p.aI(h,e.u_sdfgamma),u_image:new p.aH(h,e.u_image),u_tex_y_a:new p.aI(h,e.u_tex_y_a),u_tex_y_b:new p.aI(h,e.u_tex_y_b),u_mix:new p.aI(h,e.u_mix)}),raster:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_tl_parent:new p.aO(h,e.u_tl_parent),u_scale_parent:new p.aI(h,e.u_scale_parent),u_buffer_scale:new p.aI(h,e.u_buffer_scale),u_fade_t:new p.aI(h,e.u_fade_t),u_opacity:new p.aI(h,e.u_opacity),u_image0:new p.aH(h,e.u_image0),u_image1:new p.aH(h,e.u_image1),u_brightness_low:new p.aI(h,e.u_brightness_low),u_brightness_high:new p.aI(h,e.u_brightness_high),u_saturation_factor:new p.aI(h,e.u_saturation_factor),u_contrast_factor:new p.aI(h,e.u_contrast_factor),u_spin_weights:new p.aN(h,e.u_spin_weights)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new p.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(h,e.u_is_size_feature_constant),u_size_t:new p.aI(h,e.u_size_t),u_size:new p.aI(h,e.u_size),u_camera_to_center_distance:new p.aI(h,e.u_camera_to_center_distance),u_pitch:new p.aI(h,e.u_pitch),u_rotate_symbol:new p.aH(h,e.u_rotate_symbol),u_aspect_ratio:new p.aI(h,e.u_aspect_ratio),u_fade_change:new p.aI(h,e.u_fade_change),u_matrix:new p.aJ(h,e.u_matrix),u_label_plane_matrix:new p.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(h,e.u_coord_matrix),u_is_text:new p.aH(h,e.u_is_text),u_pitch_with_map:new p.aH(h,e.u_pitch_with_map),u_is_along_line:new p.aH(h,e.u_is_along_line),u_is_variable_anchor:new p.aH(h,e.u_is_variable_anchor),u_texsize:new p.aO(h,e.u_texsize),u_texture:new p.aH(h,e.u_texture),u_translation:new p.aO(h,e.u_translation),u_pitched_scale:new p.aI(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new p.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(h,e.u_is_size_feature_constant),u_size_t:new p.aI(h,e.u_size_t),u_size:new p.aI(h,e.u_size),u_camera_to_center_distance:new p.aI(h,e.u_camera_to_center_distance),u_pitch:new p.aI(h,e.u_pitch),u_rotate_symbol:new p.aH(h,e.u_rotate_symbol),u_aspect_ratio:new p.aI(h,e.u_aspect_ratio),u_fade_change:new p.aI(h,e.u_fade_change),u_matrix:new p.aJ(h,e.u_matrix),u_label_plane_matrix:new p.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(h,e.u_coord_matrix),u_is_text:new p.aH(h,e.u_is_text),u_pitch_with_map:new p.aH(h,e.u_pitch_with_map),u_is_along_line:new p.aH(h,e.u_is_along_line),u_is_variable_anchor:new p.aH(h,e.u_is_variable_anchor),u_texsize:new p.aO(h,e.u_texsize),u_texture:new p.aH(h,e.u_texture),u_gamma_scale:new p.aI(h,e.u_gamma_scale),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_is_halo:new p.aH(h,e.u_is_halo),u_translation:new p.aO(h,e.u_translation),u_pitched_scale:new p.aI(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new p.aH(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(h,e.u_is_size_feature_constant),u_size_t:new p.aI(h,e.u_size_t),u_size:new p.aI(h,e.u_size),u_camera_to_center_distance:new p.aI(h,e.u_camera_to_center_distance),u_pitch:new p.aI(h,e.u_pitch),u_rotate_symbol:new p.aH(h,e.u_rotate_symbol),u_aspect_ratio:new p.aI(h,e.u_aspect_ratio),u_fade_change:new p.aI(h,e.u_fade_change),u_matrix:new p.aJ(h,e.u_matrix),u_label_plane_matrix:new p.aJ(h,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(h,e.u_coord_matrix),u_is_text:new p.aH(h,e.u_is_text),u_pitch_with_map:new p.aH(h,e.u_pitch_with_map),u_is_along_line:new p.aH(h,e.u_is_along_line),u_is_variable_anchor:new p.aH(h,e.u_is_variable_anchor),u_texsize:new p.aO(h,e.u_texsize),u_texsize_icon:new p.aO(h,e.u_texsize_icon),u_texture:new p.aH(h,e.u_texture),u_texture_icon:new p.aH(h,e.u_texture_icon),u_gamma_scale:new p.aI(h,e.u_gamma_scale),u_device_pixel_ratio:new p.aI(h,e.u_device_pixel_ratio),u_is_halo:new p.aH(h,e.u_is_halo),u_translation:new p.aO(h,e.u_translation),u_pitched_scale:new p.aI(h,e.u_pitched_scale)}),background:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_opacity:new p.aI(h,e.u_opacity),u_color:new p.aL(h,e.u_color)}),backgroundPattern:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_opacity:new p.aI(h,e.u_opacity),u_image:new p.aH(h,e.u_image),u_pattern_tl_a:new p.aO(h,e.u_pattern_tl_a),u_pattern_br_a:new p.aO(h,e.u_pattern_br_a),u_pattern_tl_b:new p.aO(h,e.u_pattern_tl_b),u_pattern_br_b:new p.aO(h,e.u_pattern_br_b),u_texsize:new p.aO(h,e.u_texsize),u_mix:new p.aI(h,e.u_mix),u_pattern_size_a:new p.aO(h,e.u_pattern_size_a),u_pattern_size_b:new p.aO(h,e.u_pattern_size_b),u_scale_a:new p.aI(h,e.u_scale_a),u_scale_b:new p.aI(h,e.u_scale_b),u_pixel_coord_upper:new p.aO(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new p.aI(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_texture:new p.aH(h,e.u_texture),u_ele_delta:new p.aI(h,e.u_ele_delta),u_fog_matrix:new p.aJ(h,e.u_fog_matrix),u_fog_color:new p.aL(h,e.u_fog_color),u_fog_ground_blend:new p.aI(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new p.aI(h,e.u_fog_ground_blend_opacity),u_horizon_color:new p.aL(h,e.u_horizon_color),u_horizon_fog_blend:new p.aI(h,e.u_horizon_fog_blend)}),terrainDepth:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_ele_delta:new p.aI(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_matrix:new p.aJ(h,e.u_matrix),u_texture:new p.aH(h,e.u_texture),u_terrain_coords_id:new p.aI(h,e.u_terrain_coords_id),u_ele_delta:new p.aI(h,e.u_ele_delta)}),sky:(h,e)=>({u_sky_color:new p.aL(h,e.u_sky_color),u_horizon_color:new p.aL(h,e.u_horizon_color),u_horizon:new p.aI(h,e.u_horizon),u_sky_horizon_blend:new p.aI(h,e.u_sky_horizon_blend)})};class Mr{constructor(e,n,o){this.context=e;let s=e.gl;this.buffer=s.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Rh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qs{constructor(e,n,o,s){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=s,this.context=e;let c=e.gl;this.buffer=c.createBuffer(),e.bindVertexBuffer.set(this.buffer),c.bufferData(c.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let o=0;o<this.attributes.length;o++){let s=n.attributes[this.attributes[o].name];s!==void 0&&e.enableVertexAttribArray(s)}}setVertexAttribPointers(e,n,o){for(let s=0;s<this.attributes.length;s++){let c=this.attributes[s],f=n.attributes[c.name];f!==void 0&&e.vertexAttribPointer(f,c.components,e[Rh[c.type]],!1,this.itemSize,c.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let fn=new WeakMap;function Jr(h){var e;if(fn.has(h))return fn.get(h);{let n=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return fn.set(h,n),n}}class ut{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wo extends ut{getDefault(){return p.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Fh extends ut{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Un extends ut{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Bh extends ut{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class rc extends ut{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Oh extends ut{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class nc extends ut{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ns extends ut{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ac extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class oc extends ut{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class sc extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class lc extends ut{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class gn extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class cc extends ut{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Vh extends ut{getDefault(){return p.aM.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class hc extends ut{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ba extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class qh extends ut{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class So extends ut{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Nh extends ut{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class jh extends ut{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class uc extends ut{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class dc extends ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class pc extends ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class js extends ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class mc extends ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Co extends ut{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Or extends ut{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;let o=this.gl;Jr(o)?o.bindVertexArray(e):(n=o.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Us extends ut{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $s extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Zs extends ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Mo extends ut{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Gs extends Mo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class _n extends Mo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Hs extends Mo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Uh{constructor(e,n,o,s,c){this.context=e,this.width=n,this.height=o;let f=e.gl,_=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new Gs(e,_),s)this.depthAttachment=c?new Hs(e,_):new _n(e,_);else if(c)throw new Error("Stencil cannot be set without depth");if(f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){let o=this.depthAttachment.get();o&&e.deleteRenderbuffer(o)}e.deleteFramebuffer(this.framebuffer)}}class Lt{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}Lt.Replace=[1,0],Lt.disabled=new Lt(Lt.Replace,p.aM.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,p.aM.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,771],p.aM.transparent,[!0,!0,!0,!0]);class $h{constructor(e){var n,o;if(this.gl=e,this.clearColor=new wo(this),this.clearDepth=new Fh(this),this.clearStencil=new Un(this),this.colorMask=new Bh(this),this.depthMask=new rc(this),this.stencilMask=new Oh(this),this.stencilFunc=new nc(this),this.stencilOp=new Ns(this),this.stencilTest=new ac(this),this.depthRange=new oc(this),this.depthTest=new sc(this),this.depthFunc=new lc(this),this.blend=new gn(this),this.blendFunc=new cc(this),this.blendColor=new Vh(this),this.blendEquation=new hc(this),this.cullFace=new Ba(this),this.cullFaceSide=new qh(this),this.frontFace=new So(this),this.program=new Nh(this),this.activeTexture=new jh(this),this.viewport=new uc(this),this.bindFramebuffer=new dc(this),this.bindRenderbuffer=new pc(this),this.bindTexture=new js(this),this.bindVertexBuffer=new mc(this),this.bindElementBuffer=new Co(this),this.bindVertexArray=new Or(this),this.pixelStoreUnpack=new Us(this),this.pixelStoreUnpackPremultiplyAlpha=new $s(this),this.pixelStoreUnpackFlipY=new Zs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Jr(e)){this.HALF_FLOAT=e.HALF_FLOAT;let s=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:s?.RGBA16F_EXT,this.RGB16F=(o=e.RGB16F)!==null&&o!==void 0?o:s?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let s=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=s?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Mr(this,e,n)}createVertexBuffer(e,n,o){return new qs(this,e,n,o)}createRenderbuffer(e,n,o){let s=this.gl,c=s.createRenderbuffer();return this.bindRenderbuffer.set(c),s.renderbufferStorage(s.RENDERBUFFER,e,n,o),this.bindRenderbuffer.set(null),c}createFramebuffer(e,n,o,s){return new Uh(this,e,n,o,s)}clear({color:e,depth:n,stencil:o}){let s=this.gl,c=0;e&&(c|=s.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(c|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o!==void 0&&(c|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),s.clear(c)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){p.aE(e.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Jr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return Jr(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Qe{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}Qe.ReadOnly=!1,Qe.ReadWrite=!0,Qe.disabled=new Qe(519,Qe.ReadOnly,[0,1]);let To=7680;class wt{constructor(e,n,o,s,c,f){this.test=e,this.ref=n,this.mask=o,this.fail=s,this.depthFail=c,this.pass=f}}wt.disabled=new wt({func:519,mask:0},0,0,To,To,To);class _t{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}let yn;function Oa(h,e,n,o,s){let c=h.context,f=c.gl,_=h.useProgram("collisionBox"),y=[],b=0,C=0;for(let $=0;$<o.length;$++){let G=o[$],B=e.getTile(G).getBucket(n);if(!B)continue;let K=s?B.textCollisionBox:B.iconCollisionBox,Q=B.collisionCircleArray;if(Q.length>0){let re=p.H();p.aQ(re,B.placementInvProjMatrix,h.transform.glCoordMatrix),p.aQ(re,re,B.placementViewportMatrix),y.push({circleArray:Q,circleOffset:C,transform:G.posMatrix,invTransform:re,coord:G}),b+=Q.length/4,C=b}K&&_.draw(c,f.LINES,Qe.disabled,wt.disabled,h.colorModeForRenderPass(),_t.disabled,{u_matrix:G.posMatrix,u_pixel_extrude_scale:[1/(M=h.transform).width,1/M.height]},h.style.map.terrain&&h.style.map.terrain.getTerrainData(G),n.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,h.transform.zoom,null,null,K.collisionVertexBuffer)}var M;if(!s||!y.length)return;let P=h.useProgram("collisionCircle"),L=new p.aR;L.resize(4*b),L._trim();let F=0;for(let $ of y)for(let G=0;G<$.circleArray.length/4;G++){let B=4*G,K=$.circleArray[B+0],Q=$.circleArray[B+1],re=$.circleArray[B+2],ue=$.circleArray[B+3];L.emplace(F++,K,Q,re,ue,0),L.emplace(F++,K,Q,re,ue,1),L.emplace(F++,K,Q,re,ue,2),L.emplace(F++,K,Q,re,ue,3)}(!yn||yn.length<2*b)&&(yn=function($){let G=2*$,B=new p.aT;B.resize(G),B._trim();for(let K=0;K<G;K++){let Q=6*K;B.uint16[Q+0]=4*K+0,B.uint16[Q+1]=4*K+1,B.uint16[Q+2]=4*K+2,B.uint16[Q+3]=4*K+2,B.uint16[Q+4]=4*K+3,B.uint16[Q+5]=4*K+0}return B}(b));let q=c.createIndexBuffer(yn,!0),U=c.createVertexBuffer(L,p.aS.members,!0);for(let $ of y){let G=mn($.transform,$.invTransform,h.transform);P.draw(c,f.TRIANGLES,Qe.disabled,wt.disabled,h.colorModeForRenderPass(),_t.disabled,G,h.style.map.terrain&&h.style.map.terrain.getTerrainData($.coord),n.id,U,q,p.a0.simpleSegment(0,2*$.circleOffset,$.circleArray.length,$.circleArray.length/2),null,h.transform.zoom,null,null,null)}U.destroy(),q.destroy()}_t.disabled=new _t(!1,1029,2305),_t.backCCW=new _t(!0,1029,2305);let Va=p.an(new Float32Array(16));function Ws(h,e,n,o,s,c){let{horizontalAlign:f,verticalAlign:_}=p.au(h);return new p.P((-(f-.5)*e/s+o[0])*c,(-(_-.5)*n/s+o[1])*c)}function vn(h,e,n,o,s,c){let f=e.tileAnchorPoint.add(new p.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let _=o.mult(c);n||(_=_.rotate(-s));let y=f.add(_);return N(y.x,y.y,e.labelPlaneMatrix,e.getElevation).point}if(n){let _=se(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),y=Math.atan(_.y/_.x)+(_.x<0?Math.PI:0);return h.add(o.rotate(y))}return h.add(o)}function $n(h,e,n,o,s,c,f,_,y,b,C,M,P,L){let F=h.text.placedSymbolArray,q=h.text.dynamicLayoutVertexArray,U=h.icon.dynamicLayoutVertexArray,$={};q.clear();for(let G=0;G<F.length;G++){let B=F.get(G),K=B.hidden||!B.crossTileID||h.allowVerticalPlacement&&!B.placedOrientation?null:o[B.crossTileID];if(K){let Q=new p.P(B.anchorX,B.anchorY),re={getElevation:L,width:s.width,height:s.height,labelPlaneMatrix:c,lineVertexArray:null,pitchWithMap:n,projection:C,projectionCache:null,tileAnchorPoint:Q,translation:M,unwrappedTileID:P},ue=n?N(Q.x,Q.y,f,L):se(Q.x,Q.y,re),me=I(s.cameraToCenterDistance,ue.signedDistanceFromCamera),Se=p.ai(h.textSizeData,y,B)*me/p.ap;n&&(Se*=h.tilePixelRatio/_);let{width:ke,height:ve,anchor:ye,textOffset:ze,textBoxScale:Ze}=K,be=Ws(ye,ke,ve,ze,Ze,Se),Me=C.getPitchedTextCorrection(s,Q.add(new p.P(M[0],M[1])),P),Ue=vn(ue.point,re,e,be,s.angle,Me),Mt=h.allowVerticalPlacement&&B.placedOrientation===p.ah.vertical?Math.PI/2:0;for(let We=0;We<B.numGlyphs;We++)p.aj(q,Ue,Mt);b&&B.associatedIconIndex>=0&&($[B.associatedIconIndex]={shiftedAnchor:Ue,angle:Mt})}else Oe(B.numGlyphs,q)}if(b){U.clear();let G=h.icon.placedSymbolArray;for(let B=0;B<G.length;B++){let K=G.get(B);if(K.hidden)Oe(K.numGlyphs,U);else{let Q=$[B];if(Q)for(let re=0;re<K.numGlyphs;re++)p.aj(U,Q.shiftedAnchor,Q.angle);else Oe(K.numGlyphs,U)}}h.icon.dynamicLayoutVertexBuffer.updateData(U)}h.text.dynamicLayoutVertexBuffer.updateData(q)}function $i(h,e,n){return n.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Xs(h,e,n,o,s,c,f,_,y,b,C,M){let P=h.context,L=P.gl,F=h.transform,q=dn(),U=_==="map",$=y==="map",G=_!=="viewport"&&n.layout.get("symbol-placement")!=="point",B=U&&!$&&!G,K=!$&&G,Q=!n.layout.get("symbol-sort-key").isConstant(),re=!1,ue=h.depthModeForSublayer(0,Qe.ReadOnly),me=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Se=[],ke=q.getCircleRadiusCorrection(F);for(let ve of o){let ye=e.getTile(ve),ze=ye.getBucket(n);if(!ze)continue;let Ze=s?ze.text:ze.icon;if(!Ze||!Ze.segments.get().length||!Ze.hasVisibleVertices)continue;let be=Ze.programConfigurations.get(n.id),Me=s||ze.sdfIcons,Ue=s?ze.textSizeData:ze.iconSizeData,Mt=$||F.pitch!==0,We=h.useProgram($i(Me,s,ze),be),tt=p.ag(Ue,F.zoom),Tt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ve),ti,sr,kt,wi,pi=[0,0],ii=null;if(s)sr=ye.glyphAtlasTexture,kt=L.LINEAR,ti=ye.glyphAtlasTexture.size,ze.iconsInText&&(pi=ye.imageAtlasTexture.size,ii=ye.imageAtlasTexture,wi=Mt||h.options.rotating||h.options.zooming||Ue.kind==="composite"||Ue.kind==="camera"?L.LINEAR:L.NEAREST);else{let rt=n.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;sr=ye.imageAtlasTexture,kt=Me||h.options.rotating||h.options.zooming||rt||Mt?L.LINEAR:L.NEAREST,ti=ye.imageAtlasTexture.size}let mi=et(ye,1,h.transform.zoom),Ir=K?ve.posMatrix:Va,oa=Xr(Ir,$,U,h.transform,mi),Zo=Cr(Ir,$,U,h.transform,mi),sa=Cr(ve.posMatrix,$,U,h.transform,mi),Hi=q.translatePosition(h.transform,ye,c,f),Go=me&&ze.hasTextData(),xl=n.layout.get("icon-text-fit")!=="none"&&Go&&ze.hasIconData();if(G){let rt=h.style.map.terrain?(la,ca)=>h.style.map.terrain.getElevation(ve,la,ca):null,Cn=n.layout.get("text-rotation-alignment")==="map";R(ze,ve.posMatrix,h,s,oa,sa,$,b,Cn,q,ve.toUnwrapped(),F.width,F.height,Hi,rt)}let Wi=ve.posMatrix,Xi=s&&me||xl,Yr=G||Xi?Va:oa,lr=Zo,Jt=Me&&n.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ri;ri=Me?ze.iconsInText?Bs(Ue.kind,tt,B,$,G,Xi,h,Wi,Yr,lr,Hi,ti,pi,ke):Fa(Ue.kind,tt,B,$,G,Xi,h,Wi,Yr,lr,Hi,s,ti,!0,ke):ic(Ue.kind,tt,B,$,G,Xi,h,Wi,Yr,lr,Hi,s,ti,ke);let Oi={program:We,buffers:Ze,uniformValues:ri,atlasTexture:sr,atlasTextureIcon:ii,atlasInterpolation:kt,atlasInterpolationIcon:wi,isSDF:Me,hasHalo:Jt};if(Q&&ze.canOverlap){re=!0;let rt=Ze.segments.get();for(let Cn of rt)Se.push({segments:new p.a0([Cn]),sortKey:Cn.sortKey,state:Oi,terrainData:Tt})}else Se.push({segments:Ze.segments,sortKey:0,state:Oi,terrainData:Tt})}re&&Se.sort((ve,ye)=>ve.sortKey-ye.sortKey);for(let ve of Se){let ye=ve.state;if(P.activeTexture.set(L.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,L.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(P.activeTexture.set(L.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,L.CLAMP_TO_EDGE)),ye.isSDF){let ze=ye.uniformValues;ye.hasHalo&&(ze.u_is_halo=1,Ks(ye.buffers,ve.segments,n,h,ye.program,ue,C,M,ze,ve.terrainData)),ze.u_is_halo=0}Ks(ye.buffers,ve.segments,n,h,ye.program,ue,C,M,ye.uniformValues,ve.terrainData)}}function Ks(h,e,n,o,s,c,f,_,y,b){let C=o.context;s.draw(C,C.gl.TRIANGLES,c,f,_,_t.disabled,y,b,n.id,h.layoutVertexBuffer,h.indexBuffer,e,n.paint,o.transform.zoom,h.programConfigurations.get(n.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Js(h,e,n,o){let s=h.context,c=s.gl,f=wt.disabled,_=new Lt([c.ONE,c.ONE],p.aM.transparent,[!0,!0,!0,!0]),y=e.getBucket(n);if(!y)return;let b=o.key,C=n.heatmapFbos.get(b);C||(C=qa(s,e.tileSize,e.tileSize),n.heatmapFbos.set(b,C)),s.bindFramebuffer.set(C.framebuffer),s.viewport.set([0,0,e.tileSize,e.tileSize]),s.clear({color:p.aM.transparent});let M=y.programConfigurations.get(n.id),P=h.useProgram("heatmap",M),L=h.style.map.terrain.getTerrainData(o);P.draw(s,c.TRIANGLES,Qe.disabled,f,_,_t.disabled,bi(o.posMatrix,e,h.transform.zoom,n.paint.get("heatmap-intensity")),L,n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,h.transform.zoom,M)}function xn(h,e,n){let o=h.context,s=o.gl;o.setColorMode(h.colorModeForRenderPass());let c=Na(o,e),f=n.key,_=e.heatmapFbos.get(f);_&&(o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,_.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),c.bind(s.LINEAR,s.CLAMP_TO_EDGE),h.useProgram("heatmapTexture").draw(o,s.TRIANGLES,Qe.disabled,wt.disabled,h.colorModeForRenderPass(),_t.disabled,yo(h,e,0,1),null,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,h.transform.zoom),_.destroy(),e.heatmapFbos.delete(f))}function qa(h,e,n){var o,s;let c=h.gl,f=c.createTexture();c.bindTexture(c.TEXTURE_2D,f),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);let _=(o=h.HALF_FLOAT)!==null&&o!==void 0?o:c.UNSIGNED_BYTE,y=(s=h.RGBA16F)!==null&&s!==void 0?s:c.RGBA;c.texImage2D(c.TEXTURE_2D,0,y,e,n,0,c.RGBA,_,null);let b=h.createFramebuffer(e,n,!1,!1);return b.colorAttachment.set(f),b}function Na(h,e){return e.colorRampTexture||(e.colorRampTexture=new gt(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function Zn(h,e,n,o,s){if(!n||!o||!o.imageAtlas)return;let c=o.imageAtlas.patternPositions,f=c[n.to.toString()],_=c[n.from.toString()];if(!f&&_&&(f=_),!_&&f&&(_=f),!f||!_){let y=s.getPaintProperty(e);f=c[y],_=c[y]}f&&_&&h.setConstantPatternPositions(f,_)}function ja(h,e,n,o,s,c,f){let _=h.context.gl,y="fill-pattern",b=n.paint.get(y),C=b&&b.constantOr(1),M=n.getCrossfadeParameters(),P,L,F,q,U;f?(L=C&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=_.LINES):(L=C?"fillPattern":"fill",P=_.TRIANGLES);let $=b.constantOr(null);for(let G of o){let B=e.getTile(G);if(C&&!B.patternsLoaded())continue;let K=B.getBucket(n);if(!K)continue;let Q=K.programConfigurations.get(n.id),re=h.useProgram(L,Q),ue=h.style.map.terrain&&h.style.map.terrain.getTerrainData(G);C&&(h.context.activeTexture.set(_.TEXTURE0),B.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),Q.updatePaintBuffers(M)),Zn(Q,y,$,B,n);let me=ue?G:null,Se=h.translatePosMatrix(me?me.posMatrix:G.posMatrix,B,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(f){q=K.indexBuffer2,U=K.segments2;let ke=[_.drawingBufferWidth,_.drawingBufferHeight];F=L==="fillOutlinePattern"&&C?Yl(Se,h,M,B,ke):Ph(Se,ke)}else q=K.indexBuffer,U=K.segments,F=C?Jl(Se,h,M,B):Nn(Se);re.draw(h.context,P,s,h.stencilModeForClipping(G),c,_t.disabled,F,ue,n.id,K.layoutVertexBuffer,q,U,n.paint,h.transform.zoom,Q)}}function ko(h,e,n,o,s,c,f){let _=h.context,y=_.gl,b="fill-extrusion-pattern",C=n.paint.get(b),M=C.constantOr(1),P=n.getCrossfadeParameters(),L=n.paint.get("fill-extrusion-opacity"),F=C.constantOr(null);for(let q of o){let U=e.getTile(q),$=U.getBucket(n);if(!$)continue;let G=h.style.map.terrain&&h.style.map.terrain.getTerrainData(q),B=$.programConfigurations.get(n.id),K=h.useProgram(M?"fillExtrusionPattern":"fillExtrusion",B);M&&(h.context.activeTexture.set(y.TEXTURE0),U.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),B.updatePaintBuffers(P)),Zn(B,b,F,U,n);let Q=h.translatePosMatrix(q.posMatrix,U,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),re=n.paint.get("fill-extrusion-vertical-gradient"),ue=M?_o(Q,h,re,L,q,P,U):La(Q,h,re,L);K.draw(_,_.gl.TRIANGLES,s,c,f,_t.backCCW,ue,G,n.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,n.paint,h.transform.zoom,B,h.style.map.terrain&&$.centroidVertexBuffer)}}function Gn(h,e,n,o,s,c,f){let _=h.context,y=_.gl,b=n.fbo;if(!b)return;let C=h.useProgram("hillshade"),M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(e);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,b.colorAttachment.get()),C.draw(_,y.TRIANGLES,s,c,f,_t.disabled,((P,L,F,q)=>{let U=F.paint.get("hillshade-shadow-color"),$=F.paint.get("hillshade-highlight-color"),G=F.paint.get("hillshade-accent-color"),B=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(B-=P.transform.angle);let K=!P.options.moving;return{u_matrix:q?q.posMatrix:P.transform.calculatePosMatrix(L.tileID.toUnwrapped(),K),u_image:0,u_latrange:vo(0,L.tileID),u_light:[F.paint.get("hillshade-exaggeration"),B],u_shadow:U,u_highlight:$,u_accent:G}})(h,n,o,M?e:null),M,o.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function Hn(h,e,n,o,s,c){let f=h.context,_=f.gl,y=e.dem;if(y&&y.data){let b=y.dim,C=y.stride,M=y.getPixels();if(f.activeTexture.set(_.TEXTURE1),f.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||h.getTileTexture(C),e.demTexture){let L=e.demTexture;L.update(M,{premultiply:!1}),L.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else e.demTexture=new gt(f,M,_.RGBA,{premultiply:!1}),e.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);f.activeTexture.set(_.TEXTURE0);let P=e.fbo;if(!P){let L=new gt(f,{width:b,height:b,data:null},_.RGBA);L.bind(_.LINEAR,_.CLAMP_TO_EDGE),P=e.fbo=f.createFramebuffer(b,b,!0,!1),P.colorAttachment.set(L.texture)}f.bindFramebuffer.set(P.framebuffer),f.viewport.set([0,0,b,b]),h.useProgram("hillshadePrepare").draw(f,_.TRIANGLES,o,s,c,_t.disabled,((L,F)=>{let q=F.stride,U=p.H();return p.aP(U,0,p.X,-p.X,0,0,1),p.J(U,U,[0,-p.X,0]),{u_matrix:U,u_image:1,u_dimension:[q,q],u_zoom:L.overscaledZ,u_unpack:F.getUnpackVector()}})(e.tileID,y),null,n.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function fc(h,e,n,o,s,c){let f=o.paint.get("raster-fade-duration");if(!c&&f>0){let _=ge.now(),y=(_-h.timeAdded)/f,b=e?(_-e.timeAdded)/f:-1,C=n.getSource(),M=s.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),P=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(h.tileID.overscaledZ-M),L=P&&h.refreshedUponExpiration?1:p.ac(P?y:1-b,0,1);return h.refreshedUponExpiration&&y>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}let Ys=new p.aM(1,0,0,1),ot=new p.aM(0,1,0,1),Io=new p.aM(0,0,1,1),Zh=new p.aM(1,0,1,1),gc=new p.aM(0,1,1,1);function Wn(h,e,n,o){Eo(h,0,e+n/2,h.transform.width,n,o)}function _c(h,e,n,o){Eo(h,e-n/2,0,n,h.transform.height,o)}function Eo(h,e,n,o,s,c){let f=h.context,_=f.gl;_.enable(_.SCISSOR_TEST),_.scissor(e*h.pixelRatio,n*h.pixelRatio,o*h.pixelRatio,s*h.pixelRatio),f.clear({color:c}),_.disable(_.SCISSOR_TEST)}function yc(h,e,n){let o=h.context,s=o.gl,c=n.posMatrix,f=h.useProgram("debug"),_=Qe.disabled,y=wt.disabled,b=h.colorModeForRenderPass(),C="$debug",M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(n);o.activeTexture.set(s.TEXTURE0);let P=e.getTileByID(n.key).latestRawTileData,L=Math.floor((P&&P.byteLength||0)/1024),F=e.getTile(n).tileSize,q=512/Math.min(F,512)*(n.overscaledZ/h.transform.zoom)*.5,U=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(U+=` => ${n.overscaledZ}`),function($,G){$.initDebugOverlayCanvas();let B=$.debugOverlayCanvas,K=$.context.gl,Q=$.debugOverlayCanvas.getContext("2d");Q.clearRect(0,0,B.width,B.height),Q.shadowColor="white",Q.shadowBlur=2,Q.lineWidth=1.5,Q.strokeStyle="white",Q.textBaseline="top",Q.font="bold 36px Open Sans, sans-serif",Q.fillText(G,5,5),Q.strokeText(G,5,5),$.debugOverlayTexture.update(B),$.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)}(h,`${U} ${L}kB`),f.draw(o,s.TRIANGLES,_,y,Lt.alphaBlended,_t.disabled,Ra(c,p.aM.transparent,q),null,C,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),f.draw(o,s.LINE_STRIP,_,y,b,_t.disabled,Ra(c,p.aM.red),M,C,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function vc(h,e,n){let o=h.context,s=o.gl,c=h.colorModeForRenderPass(),f=new Qe(s.LEQUAL,Qe.ReadWrite,h.depthRangeFor3D),_=h.useProgram("terrain"),y=e.getTerrainMesh();o.bindFramebuffer.set(null),o.viewport.set([0,0,h.width,h.height]);for(let b of n){let C=h.renderToTexture.getTexture(b),M=e.getTerrainData(b.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,C.texture);let P=h.transform.calculatePosMatrix(b.tileID.toUnwrapped()),L=e.getMeshFrameDelta(h.transform.zoom),F=h.transform.calculateFogMatrix(b.tileID.toUnwrapped()),q=Rs(P,L,F,h.style.sky,h.transform.pitch);_.draw(o,s.TRIANGLES,f,wt.disabled,c,_t.backCCW,q,M,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}}class Po{constructor(e,n,o){this.vertexBuffer=e,this.indexBuffer=n,this.segments=o}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ao{constructor(e,n){this.context=new $h(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:p.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ne.maxUnderzooming+Ne.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ds}resize(e,n,o){if(this.width=Math.floor(e*o),this.height=Math.floor(n*o),this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let s of this.style._order)this.style._layers[s].resize()}setup(){let e=this.context,n=new p.aX;n.emplaceBack(0,0),n.emplaceBack(p.X,0),n.emplaceBack(0,p.X),n.emplaceBack(p.X,p.X),this.tileExtentBuffer=e.createVertexBuffer(n,pn.members),this.tileExtentSegments=p.a0.simpleSegment(0,0,4,2);let o=new p.aX;o.emplaceBack(0,0),o.emplaceBack(p.X,0),o.emplaceBack(0,p.X),o.emplaceBack(p.X,p.X),this.debugBuffer=e.createVertexBuffer(o,pn.members),this.debugSegments=p.a0.simpleSegment(0,0,4,5);let s=new p.$;s.emplaceBack(0,0,0,0),s.emplaceBack(p.X,0,p.X,0),s.emplaceBack(0,p.X,0,p.X),s.emplaceBack(p.X,p.X,p.X,p.X),this.rasterBoundsBuffer=e.createVertexBuffer(s,Hr.members),this.rasterBoundsSegments=p.a0.simpleSegment(0,0,4,2);let c=new p.aX;c.emplaceBack(0,0),c.emplaceBack(1,0),c.emplaceBack(0,1),c.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(c,pn.members),this.viewportSegments=p.a0.simpleSegment(0,0,4,2);let f=new p.aZ;f.emplaceBack(0),f.emplaceBack(1),f.emplaceBack(3),f.emplaceBack(2),f.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(f);let _=new p.aY;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(_);let y=this.context.gl;this.stencilClearMode=new wt({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){let e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let o=p.H();p.aP(o,0,this.width,this.height,0,0,1),p.K(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Qe.disabled,this.stencilClearMode,Lt.disabled,_t.disabled,xi(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;let o=this.context,s=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Lt.disabled),o.setDepthMode(Qe.disabled);let c=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let f of n){let _=this._tileClippingMaskIDs[f.key]=this.nextStencilID++,y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(f);c.draw(o,s.TRIANGLES,Qe.disabled,new wt({func:s.ALWAYS,mask:0},_,255,s.KEEP,s.KEEP,s.REPLACE),Lt.disabled,_t.disabled,xi(f.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new wt({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){let n=this.context.gl;return new wt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){let n=this.context.gl,o=e.sort((f,_)=>_.overscaledZ-f.overscaledZ),s=o[o.length-1].overscaledZ,c=o[0].overscaledZ-s+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();let f={};for(let _=0;_<c;_++)f[_+s]=new wt({func:n.GEQUAL,mask:255},_+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=c,[f,o]}return[{[s]:wt.disabled},o]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Lt([e.CONSTANT_COLOR,e.ONE],new p.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lt.unblended:Lt.alphaBlended}depthModeForSublayer(e,n,o){if(!this.opaquePassEnabledForLayer())return Qe.disabled;let s=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Qe(o||this.context.gl.LEQUAL,n,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ge.now()),this.imageManager.beginFrame();let o=this.style._order,s=this.style.sourceCaches,c={},f={},_={};for(let y in s){let b=s[y];b.used&&b.prepare(this.context),c[y]=b.getVisibleCoordinates(),f[y]=c[y].slice().reverse(),_[y]=b.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let y=0;y<o.length;y++)if(this.style._layers[o[y]].is3D()){this.opaquePassCutoff=y;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let y of o){let b=this.style._layers[y];if(!b.hasOffscreenPass()||b.isHidden(this.transform.zoom))continue;let C=f[b.source];(b.type==="custom"||C.length)&&this.renderLayer(this,s[b.source],b,C)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?p.aM.black:p.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(y,b){let C=y.context,M=C.gl,P=(($,G,B)=>({u_sky_color:$.properties.get("sky-color"),u_horizon_color:$.properties.get("horizon-color"),u_horizon:(G.height/2+G.getHorizon())*B,u_sky_horizon_blend:$.properties.get("sky-horizon-blend")*G.height/2*B}))(b,y.style.map.transform,y.pixelRatio),L=new Qe(M.LEQUAL,Qe.ReadWrite,[0,1]),F=wt.disabled,q=y.colorModeForRenderPass(),U=y.useProgram("sky");if(!b.mesh){let $=new p.aX;$.emplaceBack(-1,-1),$.emplaceBack(1,-1),$.emplaceBack(1,1),$.emplaceBack(-1,1);let G=new p.aY;G.emplaceBack(0,1,2),G.emplaceBack(0,2,3),b.mesh=new Po(C.createVertexBuffer($,pn.members),C.createIndexBuffer(G),p.a0.simpleSegment(0,0,$.length,G.length))}U.draw(C,M.TRIANGLES,L,F,q,_t.disabled,P,void 0,"sky",b.mesh.vertexBuffer,b.mesh.indexBuffer,b.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){let y=this.style._layers[o[this.currentLayer]],b=s[y.source],C=c[y.source];this._renderTileClippingMasks(y,C),this.renderLayer(this,b,y,C)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){let y=this.style._layers[o[this.currentLayer]],b=s[y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(y))continue;let C=(y.type==="symbol"?_:f)[y.source];this._renderTileClippingMasks(y,c[y.source]),this.renderLayer(this,b,y,C)}if(this.options.showTileBoundaries){let y=function(b,C){let M=null,P=Object.values(b._layers).flatMap(U=>U.source&&!U.isHidden(C)?[b.sourceCaches[U.source]]:[]),L=P.filter(U=>U.getSource().type==="vector"),F=P.filter(U=>U.getSource().type!=="vector"),q=U=>{(!M||M.getSource().maxzoom<U.getSource().maxzoom)&&(M=U)};return L.forEach(U=>q(U)),M||F.forEach(U=>q(U)),M}(this.style,this.transform.zoom);y&&function(b,C,M){for(let P=0;P<M.length;P++)yc(b,C,M[P])}(this,y,y.getVisibleCoordinates())}this.options.showPadding&&function(y){let b=y.transform.padding;Wn(y,y.transform.height-(b.top||0),3,Ys),Wn(y,b.bottom||0,3,ot),_c(y,b.left||0,3,Io),_c(y,y.transform.width-(b.right||0),3,Zh);let C=y.transform.centerPoint;(function(M,P,L,F){Eo(M,P-1,L-10,2,20,F),Eo(M,P-10,L-1,20,2,F)})(y,C.x,y.transform.height-C.y,gc)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let n=this.terrainFacilitator.matrix,o=this.transform.modelViewProjectionMatrix,s=this.terrainFacilitator.dirty;s||(s=e?!p.a_(n,o):!p.a$(n,o)),s||(s=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),s&&(p.b0(n,o),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(c,f){let _=c.context,y=_.gl,b=Lt.unblended,C=new Qe(y.LEQUAL,Qe.ReadWrite,[0,1]),M=f.getTerrainMesh(),P=f.sourceCache.getRenderableTiles(),L=c.useProgram("terrainDepth");_.bindFramebuffer.set(f.getFramebuffer("depth").framebuffer),_.viewport.set([0,0,c.width/devicePixelRatio,c.height/devicePixelRatio]),_.clear({color:p.aM.transparent,depth:1});for(let F of P){let q=f.getTerrainData(F.tileID),U={u_matrix:c.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_ele_delta:f.getMeshFrameDelta(c.transform.zoom)};L.draw(_,y.TRIANGLES,C,wt.disabled,b,_t.backCCW,U,q,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height])}(this,this.style.map.terrain),function(c,f){let _=c.context,y=_.gl,b=Lt.unblended,C=new Qe(y.LEQUAL,Qe.ReadWrite,[0,1]),M=f.getTerrainMesh(),P=f.getCoordsTexture(),L=f.sourceCache.getRenderableTiles(),F=c.useProgram("terrainCoords");_.bindFramebuffer.set(f.getFramebuffer("coords").framebuffer),_.viewport.set([0,0,c.width/devicePixelRatio,c.height/devicePixelRatio]),_.clear({color:p.aM.transparent,depth:1}),f.coordsIndex=[];for(let q of L){let U=f.getTerrainData(q.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,P.texture);let $={u_matrix:c.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-f.coordsIndex.length)/255,u_texture:0,u_ele_delta:f.getMeshFrameDelta(c.transform.zoom)};F.draw(_,y.TRIANGLES,C,wt.disabled,b,_t.backCCW,$,U,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),f.coordsIndex.push(q.tileID.key)}_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height])}(this,this.style.map.terrain))}renderLayer(e,n,o,s){if(!o.isHidden(this.transform.zoom)&&(o.type==="background"||o.type==="custom"||(s||[]).length))switch(this.id=o.id,o.type){case"symbol":(function(c,f,_,y,b){if(c.renderPass!=="translucent")return;let C=wt.disabled,M=c.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(P,L,F,q,U,$,G,B,K){let Q=L.transform,re=dn(),ue=U==="map",me=$==="map";for(let Se of P){let ke=q.getTile(Se),ve=ke.getBucket(F);if(!ve||!ve.text||!ve.text.segments.get().length)continue;let ye=p.ag(ve.textSizeData,Q.zoom),ze=et(ke,1,L.transform.zoom),Ze=Xr(Se.posMatrix,me,ue,L.transform,ze),be=F.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(ye){let Me=Math.pow(2,Q.zoom-ke.tileID.overscaledZ),Ue=L.style.map.terrain?(We,tt)=>L.style.map.terrain.getElevation(Se,We,tt):null,Mt=re.translatePosition(Q,ke,G,B);$n(ve,ue,me,K,Q,Ze,Se.posMatrix,Me,ye,be,re,Mt,Se.toUnwrapped(),Ue)}}}(y,c,_,f,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),b),_.paint.get("icon-opacity").constantOr(1)!==0&&Xs(c,f,_,y,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),C,M),_.paint.get("text-opacity").constantOr(1)!==0&&Xs(c,f,_,y,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),C,M),f.map.showCollisionBoxes&&(Oa(c,f,_,y,!0),Oa(c,f,_,y,!1))})(e,n,o,s,this.style.placement.variableOffsets);break;case"circle":(function(c,f,_,y){if(c.renderPass!=="translucent")return;let b=_.paint.get("circle-opacity"),C=_.paint.get("circle-stroke-width"),M=_.paint.get("circle-stroke-opacity"),P=!_.layout.get("circle-sort-key").isConstant();if(b.constantOr(1)===0&&(C.constantOr(1)===0||M.constantOr(1)===0))return;let L=c.context,F=L.gl,q=c.depthModeForSublayer(0,Qe.ReadOnly),U=wt.disabled,$=c.colorModeForRenderPass(),G=[];for(let B=0;B<y.length;B++){let K=y[B],Q=f.getTile(K),re=Q.getBucket(_);if(!re)continue;let ue=re.programConfigurations.get(_.id),me=c.useProgram("circle",ue),Se=re.layoutVertexBuffer,ke=re.indexBuffer,ve=c.style.map.terrain&&c.style.map.terrain.getTerrainData(K),ye={programConfiguration:ue,program:me,layoutVertexBuffer:Se,indexBuffer:ke,uniformValues:Ah(c,K,Q,_),terrainData:ve};if(P){let ze=re.segments.get();for(let Ze of ze)G.push({segments:new p.a0([Ze]),sortKey:Ze.sortKey,state:ye})}else G.push({segments:re.segments,sortKey:0,state:ye})}P&&G.sort((B,K)=>B.sortKey-K.sortKey);for(let B of G){let{programConfiguration:K,program:Q,layoutVertexBuffer:re,indexBuffer:ue,uniformValues:me,terrainData:Se}=B.state;Q.draw(L,F.TRIANGLES,q,U,$,_t.disabled,me,Se,_.id,re,ue,B.segments,_.paint,c.transform.zoom,K)}})(e,n,o,s);break;case"heatmap":(function(c,f,_,y){if(_.paint.get("heatmap-opacity")===0)return;let b=c.context;if(c.style.map.terrain){for(let C of y){let M=f.getTile(C);f.hasRenderableParent(C)||(c.renderPass==="offscreen"?Js(c,M,_,C):c.renderPass==="translucent"&&xn(c,_,C))}b.viewport.set([0,0,c.width,c.height])}else c.renderPass==="offscreen"?function(C,M,P,L){let F=C.context,q=F.gl,U=wt.disabled,$=new Lt([q.ONE,q.ONE],p.aM.transparent,[!0,!0,!0,!0]);(function(G,B,K){let Q=G.gl;G.activeTexture.set(Q.TEXTURE1),G.viewport.set([0,0,B.width/4,B.height/4]);let re=K.heatmapFbos.get(p.aU);re?(Q.bindTexture(Q.TEXTURE_2D,re.colorAttachment.get()),G.bindFramebuffer.set(re.framebuffer)):(re=qa(G,B.width/4,B.height/4),K.heatmapFbos.set(p.aU,re))})(F,C,P),F.clear({color:p.aM.transparent});for(let G=0;G<L.length;G++){let B=L[G];if(M.hasRenderableParent(B))continue;let K=M.getTile(B),Q=K.getBucket(P);if(!Q)continue;let re=Q.programConfigurations.get(P.id),ue=C.useProgram("heatmap",re),{zoom:me}=C.transform;ue.draw(F,q.TRIANGLES,Qe.disabled,U,$,_t.disabled,bi(B.posMatrix,K,me,P.paint.get("heatmap-intensity")),null,P.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,P.paint,C.transform.zoom,re)}F.viewport.set([0,0,C.width,C.height])}(c,f,_,y):c.renderPass==="translucent"&&function(C,M){let P=C.context,L=P.gl;P.setColorMode(C.colorModeForRenderPass());let F=M.heatmapFbos.get(p.aU);F&&(P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),P.activeTexture.set(L.TEXTURE1),Na(P,M).bind(L.LINEAR,L.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(P,L.TRIANGLES,Qe.disabled,wt.disabled,C.colorModeForRenderPass(),_t.disabled,yo(C,M,0,1),null,M.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,M.paint,C.transform.zoom))}(c,_)})(e,n,o,s);break;case"line":(function(c,f,_,y){if(c.renderPass!=="translucent")return;let b=_.paint.get("line-opacity"),C=_.paint.get("line-width");if(b.constantOr(1)===0||C.constantOr(1)===0)return;let M=c.depthModeForSublayer(0,Qe.ReadOnly),P=c.colorModeForRenderPass(),L=_.paint.get("line-dasharray"),F=_.paint.get("line-pattern"),q=F.constantOr(1),U=_.paint.get("line-gradient"),$=_.getCrossfadeParameters(),G=q?"linePattern":L?"lineSDF":U?"lineGradient":"line",B=c.context,K=B.gl,Q=!0;for(let re of y){let ue=f.getTile(re);if(q&&!ue.patternsLoaded())continue;let me=ue.getBucket(_);if(!me)continue;let Se=me.programConfigurations.get(_.id),ke=c.context.program.get(),ve=c.useProgram(G,Se),ye=Q||ve.program!==ke,ze=c.style.map.terrain&&c.style.map.terrain.getTerrainData(re),Ze=F.constantOr(null);if(Ze&&ue.imageAtlas){let Ue=ue.imageAtlas,Mt=Ue.patternPositions[Ze.to.toString()],We=Ue.patternPositions[Ze.from.toString()];Mt&&We&&Se.setConstantPatternPositions(Mt,We)}let be=ze?re:null,Me=q?jn(c,ue,_,$,be):L?zh(c,ue,_,L,$,be):U?Ql(c,ue,_,me.lineClipsArray.length,be):xo(c,ue,_,be);if(q)B.activeTexture.set(K.TEXTURE0),ue.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Se.updatePaintBuffers($);else if(L&&(ye||c.lineAtlas.dirty))B.activeTexture.set(K.TEXTURE0),c.lineAtlas.bind(B);else if(U){let Ue=me.gradients[_.id],Mt=Ue.texture;if(_.gradientVersion!==Ue.version){let We=256;if(_.stepInterpolant){let tt=f.getSource().maxzoom,Tt=re.canonical.z===tt?Math.ceil(1<<c.transform.maxZoom-re.canonical.z):1;We=p.ac(p.aV(me.maxLineLength/p.X*1024*Tt),256,B.maxTextureSize)}Ue.gradient=p.aW({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:Ue.gradient||void 0,clips:me.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new gt(B,Ue.gradient,K.RGBA),Ue.version=_.gradientVersion,Mt=Ue.texture}B.activeTexture.set(K.TEXTURE0),Mt.bind(_.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}ve.draw(B,K.TRIANGLES,M,c.stencilModeForClipping(re),P,_t.disabled,Me,ze,_.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,_.paint,c.transform.zoom,Se,me.layoutVertexBuffer2),Q=!1}})(e,n,o,s);break;case"fill":(function(c,f,_,y){let b=_.paint.get("fill-color"),C=_.paint.get("fill-opacity");if(C.constantOr(1)===0)return;let M=c.colorModeForRenderPass(),P=_.paint.get("fill-pattern"),L=c.opaquePassEnabledForLayer()&&!P.constantOr(1)&&b.constantOr(p.aM.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===L){let F=c.depthModeForSublayer(1,c.renderPass==="opaque"?Qe.ReadWrite:Qe.ReadOnly);ja(c,f,_,y,F,M,!1)}if(c.renderPass==="translucent"&&_.paint.get("fill-antialias")){let F=c.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Qe.ReadOnly);ja(c,f,_,y,F,M,!0)}})(e,n,o,s);break;case"fill-extrusion":(function(c,f,_,y){let b=_.paint.get("fill-extrusion-opacity");if(b!==0&&c.renderPass==="translucent"){let C=new Qe(c.context.gl.LEQUAL,Qe.ReadWrite,c.depthRangeFor3D);if(b!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))ko(c,f,_,y,C,wt.disabled,Lt.disabled),ko(c,f,_,y,C,c.stencilModeFor3D(),c.colorModeForRenderPass());else{let M=c.colorModeForRenderPass();ko(c,f,_,y,C,wt.disabled,M)}}})(e,n,o,s);break;case"hillshade":(function(c,f,_,y){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;let b=c.context,C=c.depthModeForSublayer(0,Qe.ReadOnly),M=c.colorModeForRenderPass(),[P,L]=c.renderPass==="translucent"?c.stencilConfigForOverlap(y):[{},y];for(let F of L){let q=f.getTile(F);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&c.renderPass==="offscreen"?Hn(c,q,_,C,wt.disabled,M):c.renderPass==="translucent"&&Gn(c,F,q,_,C,P[F.overscaledZ],M)}b.viewport.set([0,0,c.width,c.height])})(e,n,o,s);break;case"raster":(function(c,f,_,y){if(c.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!y.length)return;let b=c.context,C=b.gl,M=f.getSource(),P=c.useProgram("raster"),L=c.colorModeForRenderPass(),[F,q]=M instanceof Fr?[{},y]:c.stencilConfigForOverlap(y),U=q[q.length-1].overscaledZ,$=!c.options.moving;for(let G of q){let B=c.depthModeForSublayer(G.overscaledZ-U,_.paint.get("raster-opacity")===1?Qe.ReadWrite:Qe.ReadOnly,C.LESS),K=f.getTile(G);K.registerFadeDuration(_.paint.get("raster-fade-duration"));let Q=f.findLoadedParent(G,0),re=f.findLoadedSibling(G),ue=fc(K,Q||re||null,f,_,c.transform,c.style.map.terrain),me,Se,ke=_.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),K.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),Q?(Q.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),me=Math.pow(2,Q.tileID.overscaledZ-K.tileID.overscaledZ),Se=[K.tileID.canonical.x*me%1,K.tileID.canonical.y*me%1]):K.texture.bind(ke,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),K.texture.useMipmap&&b.extTextureFilterAnisotropic&&c.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax);let ve=c.style.map.terrain&&c.style.map.terrain.getTerrainData(G),ye=ve?G:null,ze=ye?ye.posMatrix:c.transform.calculatePosMatrix(G.toUnwrapped(),$),Ze=Dh(ze,Se||[0,0],me||1,ue,_);M instanceof Fr?P.draw(b,C.TRIANGLES,B,wt.disabled,L,_t.disabled,Ze,ve,_.id,M.boundsBuffer,c.quadTriangleIndexBuffer,M.boundsSegments):P.draw(b,C.TRIANGLES,B,F[G.overscaledZ],L,_t.disabled,Ze,ve,_.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}})(e,n,o,s);break;case"background":(function(c,f,_,y){let b=_.paint.get("background-color"),C=_.paint.get("background-opacity");if(C===0)return;let M=c.context,P=M.gl,L=c.transform,F=L.tileSize,q=_.paint.get("background-pattern");if(c.isPatternMissing(q))return;let U=!q&&b.a===1&&C===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==U)return;let $=wt.disabled,G=c.depthModeForSublayer(0,U==="opaque"?Qe.ReadWrite:Qe.ReadOnly),B=c.colorModeForRenderPass(),K=c.useProgram(q?"backgroundPattern":"background"),Q=y||L.coveringTiles({tileSize:F,terrain:c.style.map.terrain});q&&(M.activeTexture.set(P.TEXTURE0),c.imageManager.bind(c.context));let re=_.getCrossfadeParameters();for(let ue of Q){let me=y?ue.posMatrix:c.transform.calculatePosMatrix(ue.toUnwrapped()),Se=q?Os(me,C,c,q,{tileID:ue,tileSize:F},re):bo(me,C,b),ke=c.style.map.terrain&&c.style.map.terrain.getTerrainData(ue);K.draw(M,P.TRIANGLES,G,$,B,_t.disabled,Se,ke,_.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}})(e,0,o,s);break;case"custom":(function(c,f,_){let y=c.context,b=_.implementation;if(c.renderPass==="offscreen"){let C=b.prerender;C&&(c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),C.call(b,y.gl,c.transform.customLayerMatrix()),y.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),y.setStencilMode(wt.disabled);let C=b.renderingMode==="3d"?new Qe(c.context.gl.LEQUAL,Qe.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Qe.ReadOnly);y.setDepthMode(C),b.render(y.gl,c.transform.customLayerMatrix(),{farZ:c.transform.farZ,nearZ:c.transform.nearZ,fov:c.transform._fov,modelViewProjectionMatrix:c.transform.modelViewProjectionMatrix,projectionMatrix:c.transform.projectionMatrix}),y.setDirty(),c.setBaseState(),y.bindFramebuffer.set(null)}})(e,0,o)}}translatePosMatrix(e,n,o,s,c){if(!o[0]&&!o[1])return e;let f=c?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(f){let b=Math.sin(f),C=Math.cos(f);o=[o[0]*C-o[1]*b,o[0]*b+o[1]*C]}let _=[c?o[0]:et(n,o[0],this.transform.zoom),c?o[1]:et(n,o[1],this.transform.zoom),0],y=new Float32Array(16);return p.J(y,e,_),y}saveTileTexture(e){let n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let n=this.imageManager.getPattern(e.from.toString()),o=this.imageManager.getPattern(e.to.toString());return!n||!o}useProgram(e,n){this.cache=this.cache||{};let o=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new Fs(this.context,Kr[e],n,Vs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new gt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class Xn{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o){let s=Math.pow(2,o),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{let y=1/(_=p.af([],_,e))[3]/n*s;return p.b1(_,_,[y,y,1/_[3],y])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{let y=function(P,L){var F=L[0],q=L[1],U=L[2],$=F*F+q*q+U*U;return $>0&&($=1/Math.sqrt($)),P[0]=L[0]*$,P[1]=L[1]*$,P[2]=L[2]*$,P}([],function(P,L,F){var q=L[0],U=L[1],$=L[2],G=F[0],B=F[1],K=F[2];return P[0]=U*K-$*B,P[1]=$*G-q*K,P[2]=q*B-U*G,P}([],Ni([],c[_[0]],c[_[1]]),Ni([],c[_[2]],c[_[1]]))),b=-((C=y)[0]*(M=c[_[1]])[0]+C[1]*M[1]+C[2]*M[2]);var C,M;return y.concat(b)});return new Xn(c,f)}}class Kn{constructor(e,n){this.min=e,this.max=n,this.center=function(o,s,c){return o[0]=.5*s[0],o[1]=.5*s[1],o[2]=.5*s[2],o}([],function(o,s,c){return o[0]=s[0]+c[0],o[1]=s[1]+c[1],o[2]=s[2]+c[2],o}([],this.min,this.max))}quadrant(e){let n=[e%2==0,e<2],o=Yi(this.min),s=Yi(this.max);for(let c=0;c<n.length;c++)o[c]=n[c]?this.min[c]:this.center[c],s[c]=n[c]?this.center[c]:this.max[c];return s[2]=this.max[2],new Kn(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],o=!0;for(let s=0;s<e.planes.length;s++){let c=e.planes[s],f=0;for(let _=0;_<n.length;_++)p.b2(c,n[_])>=0&&f++;if(f===0)return 0;f!==n.length&&(o=!1)}if(o)return 2;for(let s=0;s<3;s++){let c=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){let y=e.points[_][s]-this.min[s];c=Math.min(c,y),f=Math.max(f,y)}if(f<0||c>this.max[s]-this.min[s])return 0}return 1}}class Jn{constructor(e=0,n=0,o=0,s=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=o,this.right=s}interpolate(e,n,o){return n.top!=null&&e.top!=null&&(this.top=p.y.number(e.top,n.top,o)),n.bottom!=null&&e.bottom!=null&&(this.bottom=p.y.number(e.bottom,n.bottom,o)),n.left!=null&&e.left!=null&&(this.left=p.y.number(e.left,n.left,o)),n.right!=null&&e.right!=null&&(this.right=p.y.number(e.right,n.right,o)),this}getCenter(e,n){let o=p.ac((this.left+e-this.right)/2,0,e),s=p.ac((this.top+n-this.bottom)/2,0,n);return new p.P(o,s)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Jn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let Qs=85.051129;class Yn{constructor(e,n,o,s,c){this.tileSize=512,this._renderWorldCopies=c===void 0||!!c,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=s??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Jn,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){let e=new Yn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let n=-p.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var o=new p.A(4);return p.A!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o}(),function(o,s,c){var f=s[0],_=s[1],y=s[2],b=s[3],C=Math.sin(c),M=Math.cos(c);o[0]=f*M+y*C,o[1]=_*M+b*C,o[2]=f*-C+y*M,o[3]=_*-C+b*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let n=p.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,o){this._unmodified=!1,this._edgeInsets.interpolate(e,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){let n=[new p.b4(0,e)];if(this._renderWorldCopies){let o=this.pointCoordinate(new p.P(0,0)),s=this.pointCoordinate(new p.P(this.width,0)),c=this.pointCoordinate(new p.P(this.width,this.height)),f=this.pointCoordinate(new p.P(0,this.height)),_=Math.floor(Math.min(o.x,s.x,c.x,f.x)),y=Math.floor(Math.max(o.x,s.x,c.x,f.x)),b=1;for(let C=_-b;C<=y+b;C++)C!==0&&n.push(new p.b4(C,e))}return n}coveringTiles(e){var n,o;let s=this.coveringZoomLevel(e),c=s;if(e.minzoom!==void 0&&s<e.minzoom)return[];e.maxzoom!==void 0&&s>e.maxzoom&&(s=e.maxzoom);let f=this.pointCoordinate(this.getCameraPoint()),_=p.Z.fromLngLat(this.center),y=Math.pow(2,s),b=[y*f.x,y*f.y,0],C=[y*_.x,y*_.y,0],M=Xn.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,s),P=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(P=s);let L=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,F=B=>({aabb:new Kn([B*y,0,0],[(B+1)*y,y,0]),zoom:0,x:0,y:0,wrap:B,fullyVisible:!1}),q=[],U=[],$=s,G=e.reparseOverscaled?c:s;if(this._renderWorldCopies)for(let B=1;B<=3;B++)q.push(F(-B)),q.push(F(B));for(q.push(F(0));q.length>0;){let B=q.pop(),K=B.x,Q=B.y,re=B.fullyVisible;if(!re){let ve=B.aabb.intersects(M);if(ve===0)continue;re=ve===2}let ue=e.terrain?b:C,me=B.aabb.distanceX(ue),Se=B.aabb.distanceY(ue),ke=Math.max(Math.abs(me),Math.abs(Se));if(B.zoom===$||ke>L+(1<<$-B.zoom)-2&&B.zoom>=P){let ve=$-B.zoom,ye=b[0]-.5-(K<<ve),ze=b[1]-.5-(Q<<ve);U.push({tileID:new p.S(B.zoom===$?G:B.zoom,B.wrap,B.zoom,K,Q),distanceSq:ho([C[0]-.5-K,C[1]-.5-Q]),tileDistanceToCamera:Math.sqrt(ye*ye+ze*ze)})}else for(let ve=0;ve<4;ve++){let ye=(K<<1)+ve%2,ze=(Q<<1)+(ve>>1),Ze=B.zoom+1,be=B.aabb.quadrant(ve);if(e.terrain){let Me=new p.S(Ze,B.wrap,Ze,ye,ze),Ue=e.terrain.getMinMaxElevation(Me),Mt=(n=Ue.minElevation)!==null&&n!==void 0?n:this.elevation,We=(o=Ue.maxElevation)!==null&&o!==void 0?o:this.elevation;be=new Kn([be.min[0],be.min[1],Mt],[be.max[0],be.max[1],We])}q.push({aabb:be,zoom:Ze,x:ye,y:ze,wrap:B.wrap,fullyVisible:re})}}return U.sort((B,K)=>B.distanceSq-K.distanceSq).map(B=>B.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let n=p.ac(e.lat,-85.051129,Qs);return new p.P(p.O(e.lng)*this.worldSize,p.Q(n)*this.worldSize)}unproject(e){return new p.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let n=this.elevation,o=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,s=this.pointLocation(this.centerPoint,e),c=e.getElevationForLngLatZoom(s,this.tileZoom);if(!(this.elevation-c))return;let f=o+n-c,_=Math.cos(this._pitch)*this.cameraToCenterDistance/f/p.b5(1,s.lat),y=this.scaleZoom(_/this.tileSize);this._elevation=c,this._center=s,this.zoom=y}setLocationAtPoint(e,n){let o=this.pointCoordinate(n),s=this.pointCoordinate(this.centerPoint),c=this.locationCoordinate(e),f=new p.Z(c.x-(o.x-s.x),c.y-(o.y-s.y));this.center=this.coordinateLocation(f),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return p.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){let P=n.pointCoordinate(e);if(P!=null)return P}let o=[e.x,e.y,0,1],s=[e.x,e.y,1,1];p.af(o,o,this.pixelMatrixInverse),p.af(s,s,this.pixelMatrixInverse);let c=o[3],f=s[3],_=o[1]/c,y=s[1]/f,b=o[2]/c,C=s[2]/f,M=b===C?0:(0-b)/(C-b);return new p.Z(p.y.number(o[0]/c,s[0]/f,M)/this.worldSize,p.y.number(_,y,M)/this.worldSize)}coordinatePoint(e,n=0,o=this.pixelMatrix){let s=[e.x*this.worldSize,e.y*this.worldSize,n,1];return p.af(s,s,o),new p.P(s[0]/s[3],s[1]/s[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new ae().extend(this.pointLocation(new p.P(0,e))).extend(this.pointLocation(new p.P(this.width,e))).extend(this.pointLocation(new p.P(this.width,this.height))).extend(this.pointLocation(new p.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ae([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Qs])}calculateTileMatrix(e){let n=e.canonical,o=this.worldSize/this.zoomScale(n.z),s=n.x+Math.pow(2,n.z)*e.wrap,c=p.an(new Float64Array(16));return p.J(c,c,[s*o,n.y*o,0]),p.K(c,c,[o/p.X,o/p.X,1]),c}calculatePosMatrix(e,n=!1){let o=e.key,s=n?this._alignedPosMatrixCache:this._posMatrixCache;if(s[o])return s[o];let c=this.calculateTileMatrix(e);return p.L(c,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,c),s[o]=new Float32Array(c),s[o]}calculateFogMatrix(e){let n=e.key,o=this._fogMatrixCache;if(o[n])return o[n];let s=this.calculateTileMatrix(e);return p.L(s,this.fogMatrix,s),o[n]=new Float32Array(s),o[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=p.ac(+n,this.minZoom,this.maxZoom);let o={center:new p.N(e.lng,e.lat),zoom:n},s=this.lngRange;if(!this._renderWorldCopies&&s===null){let B=179.9999999999;s=[-B,B]}let c=this.tileSize*this.zoomScale(o.zoom),f=0,_=c,y=0,b=c,C=0,M=0,{x:P,y:L}=this.size;if(this.latRange){let B=this.latRange;f=p.Q(B[1])*c,_=p.Q(B[0])*c,_-f<L&&(C=L/(_-f))}s&&(y=p.b3(p.O(s[0])*c,0,c),b=p.b3(p.O(s[1])*c,0,c),b<y&&(b+=c),b-y<P&&(M=P/(b-y)));let{x:F,y:q}=this.project.call({worldSize:c},e),U,$,G=Math.max(M||0,C||0);if(G){let B=new p.P(M?(b+y)/2:F,C?(_+f)/2:q);return o.center=this.unproject.call({worldSize:c},B).wrap(),o.zoom+=this.scaleZoom(G),o}if(this.latRange){let B=L/2;q-B<f&&($=f+B),q+B>_&&($=_-B)}if(s){let B=(y+b)/2,K=F;this._renderWorldCopies&&(K=p.b3(F,B-c/2,B+c/2));let Q=P/2;K-Q<y&&(U=y+Q),K+Q>b&&(U=b-Q)}if(U!==void 0||$!==void 0){let B=new p.P(U??F,$??q);o.center=this.unproject.call({worldSize:c},B).wrap()}return o}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:n,zoom:o}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=o,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=p.b5(1,this.center.lat)*this.worldSize;let s=p.an(new Float64Array(16));p.K(s,s,[this.width/2,-this.height/2,1]),p.J(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=p.an(new Float64Array(16)),p.K(s,s,[1,-1,1]),p.J(s,s,[-1,-1,0]),p.K(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s;let c=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),f=Math.min(this.elevation,this.minElevationForCurrentTile),_=c-f*this._pixelPerMeter/Math.cos(this._pitch),y=f<0?_:c,b=Math.PI/2+this._pitch,C=this._fov*(.5+e.y/this.height),M=Math.sin(C)*y/Math.sin(p.ac(Math.PI-b-C,.01,Math.PI-.01)),P=this.getHorizon(),L=2*Math.atan(P/this.cameraToCenterDistance)*(.5+e.y/(2*P)),F=Math.sin(L)*y/Math.sin(p.ac(Math.PI-b-L,.01,Math.PI-.01)),q=Math.min(M,F);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*q+y),this.nearZ=this.height/50,s=new Float64Array(16),p.b6(s,this._fov,this.width/this.height,this.nearZ,this.farZ),s[8]=2*-e.x/this.width,s[9]=2*e.y/this.height,this.projectionMatrix=p.ae(s),p.K(s,s,[1,-1,1]),p.J(s,s,[0,0,-this.cameraToCenterDistance]),p.b7(s,s,this._pitch),p.ad(s,s,this.angle),p.J(s,s,[-n,-o,0]),this.mercatorMatrix=p.K([],s,[this.worldSize,this.worldSize,this.worldSize]),p.K(s,s,[1,1,this._pixelPerMeter]),this.pixelMatrix=p.L(new Float64Array(16),this.labelPlaneMatrix,s),p.J(s,s,[0,0,-this.elevation]),this.modelViewProjectionMatrix=s,this.invModelViewProjectionMatrix=p.as([],s),this.fogMatrix=new Float64Array(16),p.b6(this.fogMatrix,this._fov,this.width/this.height,c,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,p.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),p.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),p.b7(this.fogMatrix,this.fogMatrix,this._pitch),p.ad(this.fogMatrix,this.fogMatrix,this.angle),p.J(this.fogMatrix,this.fogMatrix,[-n,-o,0]),p.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),p.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=p.L(new Float64Array(16),this.labelPlaneMatrix,s);let U=this.width%2/2,$=this.height%2/2,G=Math.cos(this.angle),B=Math.sin(this.angle),K=n-Math.round(n)+G*U+B*$,Q=o-Math.round(o)+G*$+B*U,re=new Float64Array(s);if(p.J(re,re,[K>.5?K-1:K,Q>.5?Q-1:Q,0]),this.alignedModelViewProjectionMatrix=re,s=p.as(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new p.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return p.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.P(0,e))}getCameraQueryGeometry(e){let n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let o=n.x,s=n.y,c=n.x,f=n.y;for(let _ of e)o=Math.min(o,_.x),s=Math.min(s,_.y),c=Math.max(c,_.x),f=Math.max(f,_.y);return[new p.P(o,s),new p.P(c,s),new p.P(c,f),new p.P(o,f),new p.P(o,s)]}}lngLatToCameraDepth(e,n){let o=this.locationCoordinate(e),s=[o.x*this.worldSize,o.y*this.worldSize,n,1];return p.af(s,s,this.modelViewProjectionMatrix),s[2]/s[3]}}function Ua(h,e){let n,o=!1,s=null,c=null,f=()=>{s=null,o&&(h.apply(c,n),s=setTimeout(f,e),o=!1)};return(..._)=>(o=!0,c=this,n=_,s||f(),s)}class zo{constructor(e){this._getCurrentHash=()=>{let n=window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(s=>s.split("=")).forEach(s=>{s[0]===this._hashName&&(o=s)}),(o&&o[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{let n=this._getCurrentHash();if(n.length>=3&&!n.some(o=>isNaN(o))){let o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:o,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{let n=this._getCurrentHash();if(n.length===0)return;let o=n.join("/"),s=o;s.split("&").length>0&&(s=s.split("&")[0]),this._hashName&&(s=`${this._hashName}=${o}`);let c=window.location.hash.replace(s,"");c.startsWith("#&")?c=c.slice(0,1)+c.slice(2):c==="#"&&(c="");let f=window.location.href.replace(/(#.+)?$/,c);f=f.replace("&&","&"),window.history.replaceState(window.history.state,null,f)},this._updateHash=Ua(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,s=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,s),f=Math.round(n.lng*c)/c,_=Math.round(n.lat*c)/c,y=this._map.getBearing(),b=this._map.getPitch(),C="";if(C+=e?`/${f}/${_}/${o}`:`${o}/${_}/${f}`,(y||b)&&(C+="/"+Math.round(10*y)/10),b&&(C+=`/${Math.round(b)}`),this._hashName){let M=this._hashName,P=!1,L=window.location.hash.slice(1).split("&").map(F=>{let q=F.split("=")[0];return q===M?(P=!0,`${q}=${C}`):F}).filter(F=>F);return P||L.push(`${M}=${C}`),`#${L.join("&")}`}return`#${C}`}}let Do={linearity:.3,easing:p.b8(0,0,.3,1)},el=p.e({deceleration:2500,maxSpeed:1400},Do),Gh=p.e({deceleration:20,maxSpeed:1400},Do),xc=p.e({deceleration:1e3,maxSpeed:360},Do),Lo=p.e({deceleration:1e3,maxSpeed:90},Do);class tl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ge.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=ge.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let n={zoom:0,bearing:0,pitch:0,pan:new p.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:c}of this._inertiaBuffer)n.zoom+=c.zoomDelta||0,n.bearing+=c.bearingDelta||0,n.pitch+=c.pitchDelta||0,c.panDelta&&n.pan._add(c.panDelta),c.around&&(n.around=c.around),c.pinchAround&&(n.pinchAround=c.pinchAround);let o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){let c=Za(n.pan.mag(),o,p.e({},el,e||{}));s.offset=n.pan.mult(c.amount/n.pan.mag()),s.center=this._map.transform.center,$a(s,c)}if(n.zoom){let c=Za(n.zoom,o,Gh);s.zoom=this._map.transform.zoom+c.amount,$a(s,c)}if(n.bearing){let c=Za(n.bearing,o,xc);s.bearing=this._map.transform.bearing+p.ac(c.amount,-179,179),$a(s,c)}if(n.pitch){let c=Za(n.pitch,o,Lo);s.pitch=this._map.transform.pitch+c.amount,$a(s,c)}if(s.zoom||s.bearing){let c=n.pinchAround===void 0?n.around:n.pinchAround;s.around=c?this._map.unproject(c):this._map.getCenter()}return this.clear(),p.e(s,{noMoveStart:!0})}}function $a(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function Za(h,e,n){let{maxSpeed:o,linearity:s,deceleration:c}=n,f=p.ac(h*s/(e/1e3),-o,o),_=Math.abs(f)/(c*s);return{easing:n.easing,duration:1e3*_,amount:f*(_/2)}}class ei extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o,s={}){let c=le.mousePos(n.getCanvas(),o),f=n.unproject(c);super(e,p.e({point:c,lngLat:f,originalEvent:o},s)),this._defaultPrevented=!1,this.target=n}}class bn extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){let s=e==="touchend"?o.changedTouches:o.touches,c=le.touchPos(n.getCanvasContainer(),s),f=c.map(y=>n.unproject(y)),_=c.reduce((y,b,C,M)=>y.add(b.div(M.length)),new p.P(0,0));super(e,{points:c,point:_,lngLats:f,lngLat:n.unproject(_),originalEvent:o}),this._defaultPrevented=!1}}class bc extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,o){super(e,{originalEvent:o}),this._defaultPrevented=!1}}class wc{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new bc(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ei(e.type,this._map,e))}mouseup(e){this._map.fire(new ei(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ei(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ei(e.type,this._map,e))}mouseover(e){this._map.fire(new ei(e.type,this._map,e))}mouseout(e){this._map.fire(new ei(e.type,this._map,e))}touchstart(e){return this._firePreventable(new bn(e.type,this._map,e))}touchmove(e){this._map.fire(new bn(e.type,this._map,e))}touchend(e){this._map.fire(new bn(e.type,this._map,e))}touchcancel(e){this._map.fire(new bn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rt{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ei(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ei(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ar{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(p.P.convert(e),this._map.terrain)}}class Fi{constructor(e,n){this._map=e,this._tr=new ar(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(le.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;let s=this._startPos;this._lastPos=o,this._box||(this._box=le.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let c=Math.min(s.x,o.x),f=Math.max(s.x,o.x),_=Math.min(s.y,o.y),y=Math.max(s.y,o.y);le.setTransform(this._box,`translate(${c}px,${_}px)`),this._box.style.width=f-c+"px",this._box.style.height=y-_+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;let o=this._startPos,s=n;if(this.reset(),le.suppressClick(),o.x!==s.x||o.y!==s.y)return this._map.fire(new p.k("boxzoomend",{originalEvent:e})),{cameraAnimation:c=>c.fitScreenCoordinates(o,s,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(le.remove(this._box),this._box=null),le.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new p.k(e,{originalEvent:n}))}}function Ga(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);let n={};for(let o=0;o<h.length;o++)n[h[o].identifier]=e[o];return n}class il{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),o.length===this.numTouches&&(this.centroid=function(s){let c=new p.P(0,0);for(let f of s)c._add(f);return c.div(s.length)}(n),this.touches=Ga(o,n)))}touchmove(e,n,o){if(this.aborted||!this.centroid)return;let s=Ga(o,n);for(let c in this.touches){let f=s[c];(!f||f.dist(this.touches[c])>30)&&(this.aborted=!0)}}touchend(e,n,o){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){let s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class Ro{constructor(e){this.singleTap=new il(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,o){this.singleTap.touchstart(e,n,o)}touchmove(e,n,o){this.singleTap.touchmove(e,n,o)}touchend(e,n,o){let s=this.singleTap.touchend(e,n,o);if(s){let c=e.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(s)<30;if(c&&f||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class Qn{constructor(e){this._tr=new ar(e),this._zoomIn=new Ro({numTouches:1,numTaps:2}),this._zoomOut=new Ro({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,o){this._zoomIn.touchstart(e,n,o),this._zoomOut.touchstart(e,n,o)}touchmove(e,n,o){this._zoomIn.touchmove(e,n,o),this._zoomOut.touchmove(e,n,o)}touchend(e,n,o){let s=this._zoomIn.touchend(e,n,o),c=this._zoomOut.touchend(e,n,o),f=this._tr;return s?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom+1,around:f.unproject(s)},{originalEvent:e})}):c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:f.zoom-1,around:f.unproject(c)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;let o=this._lastPoint;if(!o)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let s=n.length?n[0]:n;return!this._moved&&s.dist(o)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=s,this._move(o,s))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&le.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let rl={0:1,2:2};class Fo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let n=le.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,o){let s=rl[o];return n.buttons===void 0||(n.buttons&s)!==s}(e,this._eventButton)}isValidEndEvent(e){return le.mouseButton(e)===this._eventButton}}class nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let Bo=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}},al=({enable:h,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{let o=new Fo({checkCorrectEvent:s=>le.mouseButton(s)===0&&s.ctrlKey||le.mouseButton(s)===2});return new Vr({clickTolerance:e,move:(s,c)=>({bearingDelta:(c.x-s.x)*n}),moveStateManager:o,enable:h,assignEvents:Bo})},ol=({enable:h,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{let o=new Fo({checkCorrectEvent:s=>le.mouseButton(s)===0&&s.ctrlKey||le.mouseButton(s)===2});return new Vr({clickTolerance:e,move:(s,c)=>({pitchDelta:(c.y-s.y)*n}),moveStateManager:o,enable:h,assignEvents:Bo})};class wn{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new p.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,o){return this._calculateTransform(e,n,o)}touchmove(e,n,o){if(this._active){if(!this._shouldBePrevented(o.length))return e.preventDefault(),this._calculateTransform(e,n,o);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,o){this._calculateTransform(e,n,o),this._active&&this._shouldBePrevented(o.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,o){o.length>0&&(this._active=!0);let s=Ga(o,n),c=new p.P(0,0),f=new p.P(0,0),_=0;for(let b in s){let C=s[b],M=this._touches[b];M&&(c._add(C),f._add(C.sub(M)),_++,s[b]=C)}if(this._touches=s,this._shouldBePrevented(_)||!f.mag())return;let y=f.div(_);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:c.div(_),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,o){if(!this._firstTwoTouches)return;e.preventDefault();let[s,c]=this._firstTwoTouches,f=Ha(o,n,s),_=Ha(o,n,c);if(!f||!_)return;let y=this._aroundCenter?null:f.add(_).div(2);return this._move([f,_],y,e)}touchend(e,n,o){if(!this._firstTwoTouches)return;let[s,c]=this._firstTwoTouches,f=Ha(o,n,s),_=Ha(o,n,c);f&&_||(this._active&&le.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ha(h,e,n){for(let o=0;o<h.length;o++)if(h[o].identifier===n)return e[o]}function sl(h,e){return Math.log(h/e)/Math.LN2}class ll extends Oo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let o=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(sl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sl(this._distance,o),pinchAround:n}}}function cl(h,e){return 180*h.angleWith(e)/Math.PI}class hl extends Oo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,o){let s=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cl(this._vector,s),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,o=cl(e,this._startVector);return Math.abs(o)<n}}function Vo(h){return Math.abs(h.y)>Math.abs(h.x)}class ea extends Oo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,o){super.touchstart(e,n,o),this._currentTouchCount=o.length}_start(e){this._lastPoints=e,Vo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,o){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let s=e[0].sub(this._lastPoints[0]),c=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(s,c,o.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(s.y+c.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,o){if(this._valid!==void 0)return this._valid;let s=e.mag()>=2,c=n.mag()>=2;if(!s&&!c)return;if(!s||!c)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;let f=e.y>0==n.y>0;return Vo(e)&&Vo(n)&&f}}let Sc={panStep:100,bearingStep:15,pitchStep:10};class Zi{constructor(e){this._tr=new ar(e);let n=Sc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,o=0,s=0,c=0,f=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?o=-1:(e.preventDefault(),c=-1);break;case 39:e.shiftKey?o=1:(e.preventDefault(),c=1);break;case 38:e.shiftKey?s=1:(e.preventDefault(),f=-1);break;case 40:e.shiftKey?s=-1:(e.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(o=0,s=0),{cameraAnimation:_=>{let y=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Tr,zoom:n?Math.round(y.zoom)+n*(e.shiftKey?2:1):y.zoom,bearing:y.bearing+o*this._bearingStep,pitch:y.pitch+s*this._pitchStep,offset:[-c*this._panStep,-f*this._panStep],center:y.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tr(h){return h*(2-h)}let ul=4.000244140625;class or{constructor(e,n){this._onTimeout=o=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)},this._map=e,this._tr=new ar(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=ge.now(),s=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%ul==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=le.mousePos(this._map.getCanvas(),e),o=this._tr;this._around=n.y>o.transform.height/2-o.transform.getHorizon()?p.N.convert(this._aroundCenter?o.center:o.unproject(n)):p.N.convert(o.center),this._aroundPoint=o.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let y=this._type==="wheel"&&Math.abs(this._delta)>ul?this._wheelZoomRate:this._defaultZoomRate,b=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&b!==0&&(b=1/b);let C=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(C*b))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,o=this._startZoom,s=this._easing,c,f=!1,_=ge.now()-this._lastWheelEventTime;if(this._type==="wheel"&&o&&s&&_){let y=Math.min(_/200,1),b=s(y);c=p.y.number(o,n,b),y<1?this._frameId||(this._frameId=!0):f=!0}else c=n,f=!0;return this._active=!0,f&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!f,zoomDelta:c-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=p.b9;if(this._prevEase){let o=this._prevEase,s=(ge.now()-o.start)/o.duration,c=o.easing(s+.01)-o.easing(s),f=.27/Math.sqrt(c*c+1e-4)*.01,_=Math.sqrt(.0729-f*f);n=p.b8(f,_,.25,1)}return this._prevEase={start:ge.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Sn{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hh{constructor(e){this._tr=new ar(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(){this._tap=new Ro({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,o){if(!this._swipePoint)if(this._tapTime){let s=n[0],c=e.timeStamp-this._tapTime<500,f=this._tapPoint.dist(s)<30;c&&f?o.length>0&&(this._swipePoint=s,this._swipeTouch=o[0].identifier):this.reset()}else this._tap.touchstart(e,n,o)}touchmove(e,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;let s=n[0],c=s.y-this._swipePoint.y;return this._swipePoint=s,e.preventDefault(),this._active=!0,{zoomDelta:c/128}}}else this._tap.touchmove(e,n,o)}touchend(e,n,o){if(this._tapTime)this._swipePoint&&o.length===0&&this.reset();else{let s=this._tap.touchend(e,n,o);s&&(this._tapTime=e.timeStamp,this._tapPoint=s)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cc{constructor(e,n,o){this._el=e,this._mousePan=n,this._touchPan=o}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mc{constructor(e,n,o){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class dl{constructor(e,n,o,s){this._el=e,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ta{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=le.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let o=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),s=document.createElement("div");s.className="maplibregl-desktop-message",s.textContent=n,this._container.appendChild(s);let c=document.createElement("div");c.className="maplibregl-mobile-message",c.textContent=o,this._container.appendChild(c),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(le.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new p.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Gi=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ee extends p.k{}function qo(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class pl{constructor(e,n){this.handleWindowEvent=s=>{this.handleEvent(s,`${s.type}Window`)},this.handleEvent=(s,c)=>{if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let f=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},y={},b={},C=s.touches,M=C?this._getMapTouches(C):void 0,P=M?le.touchPos(this._map.getCanvas(),M):le.mousePos(this._map.getCanvas(),s);for(let{handlerName:q,handler:U,allowed:$}of this._handlers){if(!U.isEnabled())continue;let G;this._blockedByActive(b,$,q)?U.reset():U[c||s.type]&&(G=U[c||s.type](s,P,M),this.mergeHandlerResult(_,y,G,q,f),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||U.isActive())&&(b[q]=U)}let L={};for(let q in this._previousActiveHandlers)b[q]||(L[q]=f);this._previousActiveHandlers=b,(Object.keys(L).length||qo(_))&&(this._changes.push([_,y,L]),this._triggerRenderFrame()),(Object.keys(b).length||qo(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=_;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);let o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(let[s,c,f]of this._listeners)le.addEventListener(s,c,s===document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(let[e,n,o]of this._listeners)le.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(e){let n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new wc(n,e));let s=n.boxZoom=new Fi(n,e);this._add("boxZoom",s),e.interactive&&e.boxZoom&&s.enable();let c=n.cooperativeGestures=new ta(n,e.cooperativeGestures);this._add("cooperativeGestures",c),e.cooperativeGestures&&c.enable();let f=new Qn(n),_=new Hh(n);n.doubleClickZoom=new Sn(_,f),this._add("tapZoom",f),this._add("clickZoom",_),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();let y=new Wh;this._add("tapDragZoom",y);let b=n.touchPitch=new ea(n);this._add("touchPitch",b),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);let C=al(e),M=ol(e);n.dragRotate=new Mc(e,C,M),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();let P=(({enable:G,clickTolerance:B})=>{let K=new Fo({checkCorrectEvent:Q=>le.mouseButton(Q)===0&&!Q.ctrlKey});return new Vr({clickTolerance:B,move:(Q,re)=>({around:re,panDelta:re.sub(Q)}),activateOnStart:!0,moveStateManager:K,enable:G,assignEvents:Bo})})(e),L=new wn(e,n);n.dragPan=new Cc(o,P,L),this._add("mousePan",P),this._add("touchPan",L,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);let F=new hl,q=new ll;n.touchZoomRotate=new dl(o,q,F,y),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);let U=n.scrollZoom=new or(n,()=>this._triggerRenderFrame());this._add("scrollZoom",U,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);let $=n.keyboard=new Zi(n);this._add("keyboard",$),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Rt(n))}_add(e,n,o){this._handlers.push({handlerName:e,handler:n,allowed:o}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,o){for(let s in e)if(s!==o&&(!n||n.indexOf(s)<0))return!0;return!1}_getMapTouches(e){let n=[];for(let o of e)this._el.contains(o.target)&&n.push(o);return n}mergeHandlerResult(e,n,o,s,c){if(!o)return;p.e(e,o);let f={handlerName:s,originalEvent:o.originalEvent||c};o.zoomDelta!==void 0&&(n.zoom=f),o.panDelta!==void 0&&(n.drag=f),o.pitchDelta!==void 0&&(n.pitch=f),o.bearingDelta!==void 0&&(n.rotate=f)}_applyChanges(){let e={},n={},o={};for(let[s,c,f]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new p.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(e.around=s.around),s.pinchAround!==void 0&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),p.e(n,c),p.e(o,f);this._updateMapTransform(e,n,o),this._changes=[]}_updateMapTransform(e,n,o){let s=this._map,c=s._getTransformForUpdate(),f=s.terrain;if(!(qo(e)||f&&this._terrainMovement))return this._fireEvents(n,o,!0);let{panDelta:_,zoomDelta:y,bearingDelta:b,pitchDelta:C,around:M,pinchAround:P}=e;P!==void 0&&(M=P),s._stop(!0),M=M||s.transform.centerPoint;let L=c.pointLocation(_?M.sub(_):M);b&&(c.bearing+=b),C&&(c.pitch+=C),y&&(c.zoom+=y),f?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?c.center=c.pointLocation(c.centerPoint.sub(_)):c.setLocationAtPoint(L,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,c.setLocationAtPoint(L,M)):c.setLocationAtPoint(L,M),s._applyUpdatedTransform(c),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,o,!0)}_fireEvents(e,n,o){let s=Gi(this._eventsInProgress),c=Gi(e),f={};for(let M in e){let{originalEvent:P}=e[M];this._eventsInProgress[M]||(f[`${M}start`]=P),this._eventsInProgress[M]=e[M]}!s&&c&&this._fireEvent("movestart",c.originalEvent);for(let M in f)this._fireEvent(M,f[M]);c&&this._fireEvent("move",c.originalEvent);for(let M in e){let{originalEvent:P}=e[M];this._fireEvent(M,P)}let _={},y;for(let M in this._eventsInProgress){let{handlerName:P,originalEvent:L}=this._eventsInProgress[M];this._handlersById[P].isActive()||(delete this._eventsInProgress[M],y=n[P]||L,_[`${M}end`]=y)}for(let M in _)this._fireEvent(M,_[M]);let b=Gi(this._eventsInProgress),C=(s||c)&&!b;if(C&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(o&&C){this._updatingCamera=!0;let M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!M||!M.essential&&ge.prefersReducedMotion?(this._map.fire(new p.k("moveend",{originalEvent:y})),P(this._map.getBearing())&&this._map.resetNorth()):(P(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new p.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ee("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tc extends p.E{constructor(e,n){super(),this._renderFrameCallback=()=>{let o=Math.min((ge.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new p.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,o){return e=p.P.convert(e).mult(-1),this.panTo(this.transform.center,p.e({offset:e},n),o)}panTo(e,n,o){return this.easeTo(p.e({center:e},n),o)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,o){return this.easeTo(p.e({zoom:e},n),o)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,o){return this.easeTo(p.e({bearing:e},n),o)}resetNorth(e,n){return this.rotateTo(0,p.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(p.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=ae.convert(e).adjustAntiMeridian();let o=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),o,n)}_cameraForBoxAndBearing(e,n,o,s){let c={top:0,bottom:0,right:0,left:0};if(typeof(s=p.e({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){let ve=s.padding;s.padding={top:ve,bottom:ve,right:ve,left:ve}}s.padding=p.e(c,s.padding);let f=this.transform,_=f.padding,y=new ae(e,n),b=f.project(y.getNorthWest()),C=f.project(y.getNorthEast()),M=f.project(y.getSouthEast()),P=f.project(y.getSouthWest()),L=p.ba(-o),F=b.rotate(L),q=C.rotate(L),U=M.rotate(L),$=P.rotate(L),G=new p.P(Math.max(F.x,q.x,$.x,U.x),Math.max(F.y,q.y,$.y,U.y)),B=new p.P(Math.min(F.x,q.x,$.x,U.x),Math.min(F.y,q.y,$.y,U.y)),K=G.sub(B),Q=(f.width-(_.left+_.right+s.padding.left+s.padding.right))/K.x,re=(f.height-(_.top+_.bottom+s.padding.top+s.padding.bottom))/K.y;if(re<0||Q<0)return void p.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ue=Math.min(f.scaleZoom(f.scale*Math.min(Q,re)),s.maxZoom),me=p.P.convert(s.offset),Se=new p.P((s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2).rotate(p.ba(o)),ke=me.add(Se).mult(f.scale/f.zoomScale(ue));return{center:f.unproject(b.add(M).div(2).sub(ke)),zoom:ue,bearing:o}}fitBounds(e,n,o){return this._fitInternal(this.cameraForBounds(e,n),n,o)}fitScreenCoordinates(e,n,o,s,c){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.P.convert(e)),this.transform.pointLocation(p.P.convert(n)),o,s),s,c)}_fitInternal(e,n,o){return e?(delete(n=p.e(e,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(e,n){this.stop();let o=this._getTransformForUpdate(),s=!1,c=!1,f=!1;return"zoom"in e&&o.zoom!==+e.zoom&&(s=!0,o.zoom=+e.zoom),e.center!==void 0&&(o.center=p.N.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(c=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(f=!0,o.pitch=+e.pitch),e.padding==null||o.isPaddingEqual(e.padding)||(o.padding=e.padding),this._applyUpdatedTransform(o),this.fire(new p.k("movestart",n)).fire(new p.k("move",n)),s&&this.fire(new p.k("zoomstart",n)).fire(new p.k("zoom",n)).fire(new p.k("zoomend",n)),c&&this.fire(new p.k("rotatestart",n)).fire(new p.k("rotate",n)).fire(new p.k("rotateend",n)),f&&this.fire(new p.k("pitchstart",n)).fire(new p.k("pitch",n)).fire(new p.k("pitchend",n)),this.fire(new p.k("moveend",n))}calculateCameraOptionsFromTo(e,n,o,s=0){let c=p.Z.fromLngLat(e,n),f=p.Z.fromLngLat(o,s),_=f.x-c.x,y=f.y-c.y,b=f.z-c.z,C=Math.hypot(_,y,b);if(C===0)throw new Error("Can't calculate camera options with same From and To");let M=Math.hypot(_,y),P=this.transform.scaleZoom(this.transform.cameraToCenterDistance/C/this.transform.tileSize),L=180*Math.atan2(_,-y)/Math.PI,F=180*Math.acos(M/C)/Math.PI;return F=b<0?90-F:90+F,{center:f.toLngLat(),zoom:P,pitch:F,bearing:L}}easeTo(e,n){var o;this._stop(!1,e.easeId),((e=p.e({offset:[0,0],duration:500,easing:p.b9},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);let s=this._getTransformForUpdate(),c=s.zoom,f=s.bearing,_=s.pitch,y=s.padding,b="bearing"in e?this._normalizeBearing(e.bearing,f):f,C="pitch"in e?+e.pitch:_,M="padding"in e?e.padding:s.padding,P=p.P.convert(e.offset),L=s.centerPoint.add(P),F=s.pointLocation(L),{center:q,zoom:U}=s.getConstrained(p.N.convert(e.center||F),(o=e.zoom)!==null&&o!==void 0?o:c);this._normalizeCenter(q,s);let $=s.project(F),G=s.project(q).sub($),B=s.zoomScale(U-c),K,Q;e.around&&(K=p.N.convert(e.around),Q=s.locationPoint(K));let re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||U!==c,this._rotating=this._rotating||f!==b,this._pitching=this._pitching||C!==_,this._padding=!s.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,re),this.terrain&&this._prepareElevation(q),this._ease(ue=>{if(this._zooming&&(s.zoom=p.y.number(c,U,ue)),this._rotating&&(s.bearing=p.y.number(f,b,ue)),this._pitching&&(s.pitch=p.y.number(_,C,ue)),this._padding&&(s.interpolatePadding(y,M,ue),L=s.centerPoint.add(P)),this.terrain&&!e.freezeElevation&&this._updateElevation(ue),K)s.setLocationAtPoint(K,Q);else{let me=s.zoomScale(s.zoom-c),Se=U>c?Math.min(2,B):Math.max(.5,B),ke=Math.pow(Se,1-ue),ve=s.unproject($.add(G.mult(ue*ke)).mult(me));s.setLocationAtPoint(s.renderWorldCopies?ve.wrap():ve,L)}this._applyUpdatedTransform(s),this._fireMoveEvents(n)},ue=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ue)},e),this}_prepareEase(e,n,o={}){this._moving=!0,n||o.moving||this.fire(new p.k("movestart",e)),this._zooming&&!o.zooming&&this.fire(new p.k("zoomstart",e)),this._rotating&&!o.rotating&&this.fire(new p.k("rotatestart",e)),this._pitching&&!o.pitching&&this.fire(new p.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){let o=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(o-(n-(o*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=p.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){let n=e.getCameraPosition(),o=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<o){let s=this.calculateCameraOptionsFromTo(n.lngLat,o,e.center,e.elevation);return{pitch:s.pitch,zoom:s.zoom}}return{}}_applyUpdatedTransform(e){let n=[];if(this.terrain&&n.push(s=>this._elevateCameraIfInsideTerrain(s)),this.transformCameraUpdate&&n.push(s=>this.transformCameraUpdate(s)),!n.length)return;let o=e.clone();for(let s of n){let c=o.clone(),{center:f,zoom:_,pitch:y,bearing:b,elevation:C}=s(c);f&&(c.center=f),_!==void 0&&(c.zoom=_),y!==void 0&&(c.pitch=y),b!==void 0&&(c.bearing=b),C!==void 0&&(c.elevation=C),o.apply(c)}this.transform.apply(o)}_fireMoveEvents(e){this.fire(new p.k("move",e)),this._zooming&&this.fire(new p.k("zoom",e)),this._rotating&&this.fire(new p.k("rotate",e)),this._pitching&&this.fire(new p.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;let o=this._zooming,s=this._rotating,c=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new p.k("zoomend",e)),s&&this.fire(new p.k("rotateend",e)),c&&this.fire(new p.k("pitchend",e)),this.fire(new p.k("moveend",e))}flyTo(e,n){var o;if(!e.essential&&ge.prefersReducedMotion){let Me=p.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Me,n)}this.stop(),e=p.e({offset:[0,0],speed:1.2,curve:1.42,easing:p.b9},e);let s=this._getTransformForUpdate(),c=s.zoom,f=s.bearing,_=s.pitch,y=s.padding,b="bearing"in e?this._normalizeBearing(e.bearing,f):f,C="pitch"in e?+e.pitch:_,M="padding"in e?e.padding:s.padding,P=p.P.convert(e.offset),L=s.centerPoint.add(P),F=s.pointLocation(L),{center:q,zoom:U}=s.getConstrained(p.N.convert(e.center||F),(o=e.zoom)!==null&&o!==void 0?o:c);this._normalizeCenter(q,s);let $=s.zoomScale(U-c),G=s.project(F),B=s.project(q).sub(G),K=e.curve,Q=Math.max(s.width,s.height),re=Q/$,ue=B.mag();if("minZoom"in e){let Me=p.ac(Math.min(e.minZoom,c,U),s.minZoom,s.maxZoom),Ue=Q/s.zoomScale(Me-c);K=Math.sqrt(Ue/ue*2)}let me=K*K;function Se(Me){let Ue=(re*re-Q*Q+(Me?-1:1)*me*me*ue*ue)/(2*(Me?re:Q)*me*ue);return Math.log(Math.sqrt(Ue*Ue+1)-Ue)}function ke(Me){return(Math.exp(Me)-Math.exp(-Me))/2}function ve(Me){return(Math.exp(Me)+Math.exp(-Me))/2}let ye=Se(!1),ze=function(Me){return ve(ye)/ve(ye+K*Me)},Ze=function(Me){return Q*((ve(ye)*(ke(Ue=ye+K*Me)/ve(Ue))-ke(ye))/me)/ue;var Ue},be=(Se(!0)-ye)/K;if(Math.abs(ue)<1e-6||!isFinite(be)){if(Math.abs(Q-re)<1e-6)return this.easeTo(e,n);let Me=re<Q?-1:1;be=Math.abs(Math.log(re/Q))/K,Ze=()=>0,ze=Ue=>Math.exp(Me*K*Ue)}return e.duration="duration"in e?+e.duration:1e3*be/("screenSpeed"in e?+e.screenSpeed/K:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==b,this._pitching=C!==_,this._padding=!s.isPaddingEqual(M),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(q),this._ease(Me=>{let Ue=Me*be,Mt=1/ze(Ue);s.zoom=Me===1?U:c+s.scaleZoom(Mt),this._rotating&&(s.bearing=p.y.number(f,b,Me)),this._pitching&&(s.pitch=p.y.number(_,C,Me)),this._padding&&(s.interpolatePadding(y,M,Me),L=s.centerPoint.add(P)),this.terrain&&!e.freezeElevation&&this._updateElevation(Me);let We=Me===1?q:s.unproject(G.add(B.mult(Ze(Ue))).mult(Mt));s.setLocationAtPoint(s.renderWorldCopies?We.wrap():We,L),this._applyUpdatedTransform(s),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var o;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let s=this._onEaseEnd;delete this._onEaseEnd,s.call(this,n)}return e||(o=this.handlers)===null||o===void 0||o.stop(!1),this}_ease(e,n,o){o.animate===!1||o.duration===0?(e(1),n()):(this._easeStart=ge.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=p.b3(e,-180,180);let o=Math.abs(e-n);return Math.abs(e-360-n)<o&&(e-=360),Math.abs(e+360-n)<o&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;let o=e.lng-n.center.lng;e.lng+=o>180?-360:o<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(p.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}let ia={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ra{constructor(e=ia){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=le.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=le.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=le.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){le.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let o=this._map._getUIString(`AttributionControl.${n}`);e.title=o,e.setAttribute("aria-label",o)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(s=>typeof s!="string"?"":s)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}let n=this._map.style.sourceCaches;for(let s in n){let c=n[s];if(c.used||c.usedForTerrain){let f=c.getSource();f.attribution&&e.indexOf(f.attribution)<0&&e.push(f.attribution)}}e=e.filter(s=>String(s).trim()),e.sort((s,c)=>s.length-c.length),e=e.filter((s,c)=>{for(let f=c+1;f<e.length;f++)if(e[f].indexOf(s)>=0)return!1;return!0});let o=e.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ml{constructor(e={}){this._updateCompact=()=>{let n=this._container.children;if(n.length){let o=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&o.classList.add("maplibregl-compact"):o.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=le.create("div","maplibregl-ctrl");let n=le.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){le.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class it{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(let s of o)if(s.id===e)return void(s.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let n=this._currentlyRunning=this._queue;this._queue=[];for(let o of n)if(!o.cancelled&&(o.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var fl=p.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Xh extends p.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];let o={};for(let s of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))o[s.key]=!0,this._renderableTilesKeys.push(s.key),this._tiles[s.key]||(s.posMatrix=new Float64Array(16),p.aP(s.posMatrix,0,p.X,0,p.X,0,1),this._tiles[s.key]=new Wr(s,this.tileSize));for(let s in this._tiles)o[s]||delete this._tiles[s]}freeRtt(e){for(let n in this._tiles){let o=this._tiles[n];(!e||o.tileID.equals(e)||o.tileID.isChildOf(e)||e.isChildOf(o.tileID))&&(o.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let n={};for(let o of this._renderableTilesKeys){let s=this._tiles[o].tileID;if(s.canonical.equals(e.canonical)){let c=e.clone();c.posMatrix=new Float64Array(16),p.aP(c.posMatrix,0,p.X,0,p.X,0,1),n[o]=c}else if(s.canonical.isChildOf(e.canonical)){let c=e.clone();c.posMatrix=new Float64Array(16);let f=s.canonical.z-e.canonical.z,_=s.canonical.x-(s.canonical.x>>f<<f),y=s.canonical.y-(s.canonical.y>>f<<f),b=p.X>>f;p.aP(c.posMatrix,0,b,0,b,0,1),p.J(c.posMatrix,c.posMatrix,[-_*b,-y*b,0]),n[o]=c}else if(e.canonical.isChildOf(s.canonical)){let c=e.clone();c.posMatrix=new Float64Array(16);let f=e.canonical.z-s.canonical.z,_=e.canonical.x-(e.canonical.x>>f<<f),y=e.canonical.y-(e.canonical.y>>f<<f),b=p.X>>f;p.aP(c.posMatrix,0,p.X,0,p.X,0,1),p.J(c.posMatrix,c.posMatrix,[_*b,y*b,0]),p.K(c.posMatrix,c.posMatrix,[1/2**f,1/2**f,0]),n[o]=c}}return n}getSourceTile(e,n){let o=this.sourceCache._source,s=e.overscaledZ-this.deltaZoom;if(s>o.maxzoom&&(s=o.maxzoom),s<o.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(s).key);let c=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!c||!c.dem)&&n)for(;s>=o.minzoom&&(!c||!c.dem);)c=this.sourceCache.getTileByID(e.scaledTo(s--).key);return c}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class gl{constructor(e,n,o){this.painter=e,this.sourceCache=new Xh(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,o,s=p.X){var c;if(!(n>=0&&n<s&&o>=0&&o<s))return 0;let f=this.getTerrainData(e),_=(c=f.tile)===null||c===void 0?void 0:c.dem;if(!_)return 0;let y=function(F,q,U){var $=q[0],G=q[1];return F[0]=U[0]*$+U[4]*G+U[12],F[1]=U[1]*$+U[5]*G+U[13],F}([],[n/s*p.X,o/s*p.X],f.u_terrain_matrix),b=[y[0]*_.dim,y[1]*_.dim],C=Math.floor(b[0]),M=Math.floor(b[1]),P=b[0]-C,L=b[1]-M;return _.get(C,M)*(1-P)*(1-L)+_.get(C+1,M)*P*(1-L)+_.get(C,M+1)*(1-P)*L+_.get(C+1,M+1)*P*L}getElevationForLngLatZoom(e,n){if(!p.bb(n,e.wrap()))return 0;let{tileID:o,mercatorX:s,mercatorY:c}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(o,s%p.X,c%p.X,p.X)}getElevation(e,n,o,s=p.X){return this.getDEMElevation(e,n,o,s)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let s=this.painter.context,c=new p.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new gt(s,c,s.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new gt(s,new p.R({width:1,height:1}),s.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=p.an([])}let n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){let s=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new gt(s,n.dem.getPixels(),s.gl.RGBA,{premultiply:!1}),n.demTexture.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}let o=n&&n+n.tileID.key+e.key;if(o&&!this._demMatrixCache[o]){let s=this.sourceCache.sourceCache._source.maxzoom,c=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=s?c=e.canonical.z-s:p.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let f=e.canonical.x-(e.canonical.x>>c<<c),_=e.canonical.y-(e.canonical.y>>c<<c),y=p.bc(new Float64Array(16),[1/(p.X<<c),1/(p.X<<c),0]);p.J(y,y,[f*p.X,_*p.X,0]),this._demMatrixCache[e.key]={matrix:y,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){let n=this.painter,o=n.width/devicePixelRatio,s=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===s||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new gt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new gt(n.context,{width:o,height:s,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,s,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,s))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let c=0,f=0;c<this._coordsTextureSize;c++)for(let _=0;_<this._coordsTextureSize;_++,f+=4)n[f+0]=255&_,n[f+1]=255&c,n[f+2]=_>>8<<4|c>>8,n[f+3]=0;let o=new p.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),s=new gt(e,o,e.gl.RGBA,{premultiply:!1});return s.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=s,s}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let n=new Uint8Array(4),o=this.painter.context,s=o.gl,c=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),f=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),_=Math.round(this.painter.height/devicePixelRatio);o.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),s.readPixels(c,_-f-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null);let y=n[0]+(n[2]>>4<<8),b=n[1]+((15&n[2])<<8),C=this.coordsIndex[255-n[3]],M=C&&this.sourceCache.getTileByID(C);if(!M)return null;let P=this._coordsTextureSize,L=(1<<M.tileID.canonical.z)*P;return new p.Z((M.tileID.canonical.x*P+y)/L+M.tileID.wrap,(M.tileID.canonical.y*P+b)/L,this.getElevation(M.tileID,y,b,P))}depthAtPoint(e){let n=new Uint8Array(4),o=this.painter.context,s=o.gl;return o.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),s.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,s.RGBA,s.UNSIGNED_BYTE,n),o.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,n=new p.bd,o=new p.aY,s=this.meshSize,c=p.X/s,f=s*s;for(let M=0;M<=s;M++)for(let P=0;P<=s;P++)n.emplaceBack(P*c,M*c,0);for(let M=0;M<f;M+=s+1)for(let P=0;P<s;P++)o.emplaceBack(P+M,s+P+M+1,s+P+M+2),o.emplaceBack(P+M,s+P+M+2,P+M+1);let _=n.length,y=_+2*(s+1);for(let M of[0,1])for(let P=0;P<=s;P++)for(let L of[0,1])n.emplaceBack(P*c,M*p.X,L);for(let M=0;M<2*s;M+=2)o.emplaceBack(y+M,y+M+1,y+M+3),o.emplaceBack(y+M,y+M+3,y+M+2),o.emplaceBack(_+M,_+M+3,_+M+1),o.emplaceBack(_+M,_+M+2,_+M+3);let b=n.length,C=b+2*(s+1);for(let M of[0,1])for(let P=0;P<=s;P++)for(let L of[0,1])n.emplaceBack(M*p.X,P*c,L);for(let M=0;M<2*s;M+=2)o.emplaceBack(b+M,b+M+1,b+M+3),o.emplaceBack(b+M,b+M+3,b+M+2),o.emplaceBack(C+M,C+M+3,C+M+1),o.emplaceBack(C+M,C+M+2,C+M+3);return this._mesh=new Po(e.createVertexBuffer(n,fl.members),e.createIndexBuffer(o),p.a0.simpleSegment(0,0,n.length,o.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*p.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var o;let{tileID:s}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(o=this.getMinMaxElevation(s).minElevation)!==null&&o!==void 0?o:0}getMinMaxElevation(e){let n=this.getTerrainData(e).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=n.dem.min*this.exaggeration,o.maxElevation=n.dem.max*this.exaggeration),o}_getOverscaledTileIDFromLngLatZoom(e,n){let o=p.Z.fromLngLat(e.wrap()),s=(1<<n)*p.X,c=o.x*s,f=o.y*s,_=Math.floor(c/p.X),y=Math.floor(f/p.X);return{tileID:new p.S(n,0,n,_,y),mercatorX:c,mercatorY:f}}}class Kh{constructor(e,n,o){this._context=e,this._size=n,this._tileSize=o,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),o=new gt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return o.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(o.texture),{id:e,fbo:n,texture:o,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let na={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class kc{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new Kh(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(o=>!e._layers[o].isHidden(n)),this._coordsDescendingInv={};for(let o in e.sourceCaches){this._coordsDescendingInv[o]={};let s=e.sourceCaches[o].getVisibleCoordinates();for(let c of s){let f=this.terrain.sourceCache.getTerrainCoords(c);for(let _ in f)this._coordsDescendingInv[o][_]||(this._coordsDescendingInv[o][_]=[]),this._coordsDescendingInv[o][_].push(f[_])}}this._coordsDescendingInvStr={};for(let o of e._order){let s=e._layers[o],c=s.source;if(na[s.type]&&!this._coordsDescendingInvStr[c]){this._coordsDescendingInvStr[c]={};for(let f in this._coordsDescendingInv[c])this._coordsDescendingInvStr[c][f]=this._coordsDescendingInv[c][f].map(_=>_.key).sort().join()}}for(let o of this._renderableTiles)for(let s in this._coordsDescendingInvStr){let c=this._coordsDescendingInvStr[s][o.tileID.key];c&&c!==o.rttCoords[s]&&(o.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let n=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(na[n]&&(this._prevType&&na[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(na[this._prevType]||na[n]&&s){this._prevType=n;let c=this._stacks.length-1,f=this._stacks[c]||[];for(let _ of this._renderableTiles){if(this.pool.isFull()&&(vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[c]){let b=this.pool.getObjectForId(_.rtt[c].id);if(b.stamp===_.rtt[c].stamp){this.pool.useObject(b);continue}}let y=this.pool.getOrCreateFreeObject();this.pool.useObject(y),this.pool.stampObject(y),_.rtt[c]={id:y.id,stamp:y.stamp},o.context.bindFramebuffer.set(y.fbo.framebuffer),o.context.clear({color:p.aM.transparent,stencil:0}),o.currentStencilSource=void 0;for(let b=0;b<f.length;b++){let C=o.style._layers[f[b]],M=C.source?this._coordsDescendingInv[C.source][_.tileID.key]:[_.tileID];o.context.viewport.set([0,0,y.fbo.width,y.fbo.height]),o._renderTileClippingMasks(C,M),o.renderLayer(o,o.style.sourceCaches[C.source],C,M),C.source&&(_.rttCoords[C.source]=this._coordsDescendingInvStr[C.source][_.tileID.key])}}return vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),na[n]}return!1}}let _l={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ic=Fe,Jh={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ia,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:p.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},yl=h=>{h.touchstart=h.dragStart,h.touchmoveWindow=h.dragMove,h.touchend=h.dragEnd},Yh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qh{constructor(e,n,o=!1){this.mousedown=f=>{this.startMouse(p.e({},f,{ctrlKey:!0,preventDefault:()=>f.preventDefault()}),le.mousePos(this.element,f)),le.addEventListener(window,"mousemove",this.mousemove),le.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=f=>{this.moveMouse(f,le.mousePos(this.element,f))},this.mouseup=f=>{this.mouseRotate.dragEnd(f),this.mousePitch&&this.mousePitch.dragEnd(f),this.offTemp()},this.touchstart=f=>{f.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=le.touchPos(this.element,f.targetTouches)[0],this.startTouch(f,this._startPos),le.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.addEventListener(window,"touchend",this.touchend))},this.touchmove=f=>{f.targetTouches.length!==1?this.reset():(this._lastPos=le.touchPos(this.element,f.targetTouches)[0],this.moveTouch(f,this._lastPos))},this.touchend=f=>{f.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let s=e.dragRotate._mouseRotate.getClickTolerance(),c=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=al({clickTolerance:s,enable:!0}),this.touchRotate=(({enable:f,clickTolerance:_,bearingDegreesPerPixelMoved:y=.8})=>{let b=new nl;return new Vr({clickTolerance:_,move:(C,M)=>({bearingDelta:(M.x-C.x)*y}),moveStateManager:b,enable:f,assignEvents:yl})})({clickTolerance:s,enable:!0}),this.map=e,o&&(this.mousePitch=ol({clickTolerance:c,enable:!0}),this.touchPitch=(({enable:f,clickTolerance:_,pitchDegreesPerPixelMoved:y=-.5})=>{let b=new nl;return new Vr({clickTolerance:_,move:(C,M)=>({pitchDelta:(M.y-C.y)*y}),moveStateManager:b,enable:f,assignEvents:yl})})({clickTolerance:c,enable:!0})),le.addEventListener(n,"mousedown",this.mousedown),le.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),le.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),le.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),le.disableDrag()}moveMouse(e,n){let o=this.map,{bearingDelta:s}=this.mouseRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.mousePitch){let{pitchDelta:c}=this.mousePitch.dragMove(e,n)||{};c&&o.setPitch(o.getPitch()+c)}}moveTouch(e,n){let o=this.map,{bearingDelta:s}=this.touchRotate.dragMove(e,n)||{};if(s&&o.setBearing(o.getBearing()+s),this.touchPitch){let{pitchDelta:c}=this.touchPitch.dragMove(e,n)||{};c&&o.setPitch(o.getPitch()+c)}}off(){let e=this.element;le.removeEventListener(e,"mousedown",this.mousedown),le.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),le.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.removeEventListener(window,"touchend",this.touchend),le.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){le.enableDrag(),le.removeEventListener(window,"mousemove",this.mousemove),le.removeEventListener(window,"mouseup",this.mouseup),le.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),le.removeEventListener(window,"touchend",this.touchend)}}let Bi;function Ct(h,e,n){let o=new p.N(h.lng,h.lat);if(h=new p.N(h.lng,h.lat),e){let s=new p.N(h.lng-360,h.lat),c=new p.N(h.lng+360,h.lat),f=n.locationPoint(h).distSqr(e);n.locationPoint(s).distSqr(e)<f?h=s:n.locationPoint(c).distSqr(e)<f&&(h=c)}for(;Math.abs(h.lng-n.center.lng)>180;){let s=n.locationPoint(h);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h.lng!==o.lng&&n.locationPoint(h).y>n.height/2-n.getHorizon()?h:o}let aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function No(h,e,n){let o=h.classList;for(let s in aa)o.remove(`maplibregl-${n}-anchor-${s}`);o.add(`maplibregl-${n}-anchor-${e}`)}class jo extends p.E{constructor(e){if(super(),this._onKeyPress=n=>{let o=n.code,s=n.charCode||n.keyCode;o!=="Space"&&o!=="Enter"&&s!==32&&s!==13||this.togglePopup()},this._onMapClick=n=>{let o=n.originalEvent.target,s=this._element;this._popup&&(o===s||s.contains(o))&&this.togglePopup()},this._update=n=>{var o;if(!this._map)return;let s=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ct(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),le.setTransform(this._element,`${aa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${c}`),ge.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){let o=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.k("dragstart"))),this.fire(new p.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=p.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=le.create("div");let n=le.createNS("http://www.w3.org/2000/svg","svg"),o=41,s=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${o}px`),n.setAttributeNS(null,"width",`${s}px`),n.setAttributeNS(null,"viewBox",`0 0 ${s} ${o}`);let c=le.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"stroke","none"),c.setAttributeNS(null,"stroke-width","1"),c.setAttributeNS(null,"fill","none"),c.setAttributeNS(null,"fill-rule","evenodd");let f=le.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");let _=le.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");let y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let $ of y){let G=le.createNS("http://www.w3.org/2000/svg","ellipse");G.setAttributeNS(null,"opacity","0.04"),G.setAttributeNS(null,"cx","10.5"),G.setAttributeNS(null,"cy","5.80029008"),G.setAttributeNS(null,"rx",$.rx),G.setAttributeNS(null,"ry",$.ry),_.appendChild(G)}let b=le.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",this._color);let C=le.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(C);let M=le.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");let P=le.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(P);let L=le.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(6.0, 7.0)"),L.setAttributeNS(null,"fill","#FFFFFF");let F=le.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(8.0, 8.0)");let q=le.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");let U=le.createNS("http://www.w3.org/2000/svg","circle");U.setAttributeNS(null,"fill","#FFFFFF"),U.setAttributeNS(null,"cx","5.5"),U.setAttributeNS(null,"cy","5.5"),U.setAttributeNS(null,"r","5.4999962"),F.appendChild(q),F.appendChild(U),f.appendChild(_),f.appendChild(b),f.appendChild(M),f.appendChild(L),f.appendChild(F),n.appendChild(f),n.setAttributeNS(null,"height",o*this._scale+"px"),n.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(n),this._offset=p.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),No(this._element,this._anchor,"marker"),e&&e.className)for(let n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),le.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=p.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let s=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,o;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let s=this._map,c=s.terrain.depthAtPoint(this._pos),f=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,f)-c<.006)return void(this._element.style.opacity=this._opacity);let _=-this._offset.y/s.transform._pixelPerMeter,y=Math.sin(s.getPitch()*Math.PI/180)*_,b=s.terrain.depthAtPoint(new p.P(this._pos.x,this._pos.y-this._offset.y)),C=s.transform.lngLatToCameraDepth(this._lngLat,f+y)-b>.006;!((o=this._popup)===null||o===void 0)&&o.isOpen()&&C&&this._popup.remove(),this._element.style.opacity=C?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=p.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}let Ec={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Wa=0,Xa=!1,kr={maxWidth:100,unit:"metric"};function Ka(h,e,n){let o=n&&n.maxWidth||100,s=h._container.clientHeight/2,c=h.unproject([0,s]),f=h.unproject([o,s]),_=c.distanceTo(f);if(n&&n.unit==="imperial"){let y=3.2808*_;y>5280?Ae(e,o,y/5280,h._getUIString("ScaleControl.Miles")):Ae(e,o,y,h._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Ae(e,o,_/1852,h._getUIString("ScaleControl.NauticalMiles")):_>=1e3?Ae(e,o,_/1e3,h._getUIString("ScaleControl.Kilometers")):Ae(e,o,_,h._getUIString("ScaleControl.Meters"))}function Ae(h,e,n,o){let s=function(c){let f=Math.pow(10,`${Math.floor(c)}`.length-1),_=c/f;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(y){let b=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*b)/b}(_),f*_}(n);h.style.width=e*(s/n)+"px",h.innerHTML=`${s}&nbsp;${o}`}let qe={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Uo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $o(h){if(h){if(typeof h=="number"){let e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new p.P(0,0),top:new p.P(0,h),"top-left":new p.P(e,e),"top-right":new p.P(-e,e),bottom:new p.P(0,-h),"bottom-left":new p.P(e,-e),"bottom-right":new p.P(-e,-e),left:new p.P(h,0),right:new p.P(-h,0)}}if(h instanceof p.P||Array.isArray(h)){let e=p.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:p.P.convert(h.center||[0,0]),top:p.P.convert(h.top||[0,0]),"top-left":p.P.convert(h["top-left"]||[0,0]),"top-right":p.P.convert(h["top-right"]||[0,0]),bottom:p.P.convert(h.bottom||[0,0]),"bottom-left":p.P.convert(h["bottom-left"]||[0,0]),"bottom-right":p.P.convert(h["bottom-right"]||[0,0]),left:p.P.convert(h.left||[0,0]),right:p.P.convert(h.right||[0,0])}}return $o(new p.P(0,0))}let vl=Fe;w.AJAXError=p.bh,w.Evented=p.E,w.LngLat=p.N,w.MercatorCoordinate=p.Z,w.Point=p.P,w.addProtocol=p.bi,w.config=p.a,w.removeProtocol=p.bj,w.AttributionControl=ra,w.BoxZoomHandler=Fi,w.CanvasSource=ji,w.CooperativeGesturesHandler=ta,w.DoubleClickZoomHandler=Sn,w.DragPanHandler=Cc,w.DragRotateHandler=Mc,w.EdgeInsets=Jn,w.FullscreenControl=class extends p.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:p.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){le.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let h=this._fullscreenButton=le.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);le.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new p.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new p.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=Pa,w.GeolocateControl=class extends p.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new p.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new p.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let n=new p.N(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy,s=this._map.getBearing(),c=p.e({bearing:s},this.options.fitBoundsOptions),f=ae.fromLngLat(n,o);this._map.fitBounds(f,c,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let n=new p.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Xa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new p.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=le.create("button","maplibregl-ctrl-geolocate",this._container),le.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){p.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=le.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jo({element:this._dotElement}),this._circleElement=le.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new p.k("trackuserlocationend")),this.fire(new p.k("userlocationlostfocus")))})}},this.options=p.e({},Ec,h)}onAdd(h){return this._map=h,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return p._(this,arguments,void 0,function*(e=!1){if(Bi!==void 0&&!e)return Bi;if(window.navigator.permissions===void 0)return Bi=!!window.navigator.geolocation,Bi;try{Bi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Bi=!!window.navigator.geolocation}return Bi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),le.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wa=0,Xa=!1}_isOutOfMapMaxBounds(h){let e=this._map.getMaxBounds(),n=h.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let h=this._map.getBounds(),e=h.getSouthEast(),n=h.getNorthEast(),o=e.distanceTo(n),s=Math.ceil(this._accuracy/(o/this._map._container.clientHeight)*2);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}trigger(){if(!this._setup)return p.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wa--,Xa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new p.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.k("trackuserlocationstart")),this.fire(new p.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wa++,Wa>1?(h={maximumAge:6e5,timeout:0},Xa=!0):(h=this.options.positionOptions,Xa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=zo,w.ImageSource=Fr,w.KeyboardHandler=Zi,w.LngLatBounds=ae,w.LogoControl=ml,w.Map=class extends Tc{constructor(h){p.bf.mark(p.bg.create);let e=Object.assign(Object.assign({},Jh),h);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Yn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new it,this._controls=[],this._mapId=p.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new p.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new p.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_l),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ai.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ps(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1,o=Ua(s=>{this._trackResize&&!this._removed&&(this.resize(s),this.redraw())},50);this._resizeObserver=new ResizeObserver(s=>{n?o(s):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new pl(this,e),this._hash=e.hash&&new zo(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,p.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ra(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new ml,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new p.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new p.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new p.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=h.onAdd(this);this._controls.push(h);let o=this._controlPositions[e];return e.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new p.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,n,o){return o==null&&this.terrain&&(o=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,n,o)}resize(h){var e;let n=this._containerDimensions(),o=n[0],s=n[1],c=this._getClampedPixelRatio(o,s);if(this._resizeCanvas(o,s,c),this.painter.resize(o,s,c),this.painter.overLimit()){let _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];let y=this._getClampedPixelRatio(o,s);this._resizeCanvas(o,s,y),this.painter.resize(o,s,y)}this.transform.resize(o,s),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,s);let f=!this._moving;return f&&(this.stop(),this.fire(new p.k("movestart",h)).fire(new p.k("move",h))),this.fire(new p.k("resize",h)),f&&this.fire(new p.k("moveend",h)),this}_getClampedPixelRatio(h,e){let{0:n,1:o}=this._maxCanvasSize,s=this.getPixelRatio(),c=h*s,f=e*s;return Math.min(c>n?n/c:1,f>o?o/f:1)*s}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(ae.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(p.N.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.pointLocation(p.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,n){if(h==="mouseenter"||h==="mouseover"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:c=>{let f=e.filter(y=>this.getLayer(y)),_=f.length!==0?this.queryRenderedFeatures(c.point,{layers:f}):[];_.length?o||(o=!0,n.call(this,new ei(h,this,c.originalEvent,{features:_}))):o=!1},mouseout:()=>{o=!1}}}}if(h==="mouseleave"||h==="mouseout"){let o=!1;return{layers:e,listener:n,delegates:{mousemove:f=>{let _=e.filter(y=>this.getLayer(y));(_.length!==0?this.queryRenderedFeatures(f.point,{layers:_}):[]).length?o=!0:o&&(o=!1,n.call(this,new ei(h,this,f.originalEvent)))},mouseout:f=>{o&&(o=!1,n.call(this,new ei(h,this,f.originalEvent)))}}}}{let o=s=>{let c=e.filter(_=>this.getLayer(_)),f=c.length!==0?this.queryRenderedFeatures(s.point,{layers:c}):[];f.length&&(s.features=f,n.call(this,s),delete s.features)};return{layers:e,listener:n,delegates:{[h]:o}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,n){if(!this._delegatedListeners||!this._delegatedListeners[h])return;let o=this._delegatedListeners[h];for(let s=0;s<o.length;s++){let c=o[s];if(c.listener===n&&c.layers.length===e.length&&c.layers.every(f=>e.includes(f))){for(let f in c.delegates)this.off(f,c.delegates[f]);return void o.splice(s,1)}}}on(h,e,n){if(n===void 0)return super.on(h,e);let o=this._createDelegatedListener(h,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(h,o);for(let s in o.delegates)this.on(s,o.delegates[s]);return this}once(h,e,n){if(n===void 0)return super.once(h,e);let o=typeof e=="string"?[e]:e,s=this._createDelegatedListener(h,o,n);for(let c in s.delegates){let f=s.delegates[c];s.delegates[c]=(..._)=>{this._removeDelegatedListener(h,o,n),f(..._)}}this._saveDelegatedListener(h,s);for(let c in s.delegates)this.once(c,s.delegates[c]);return this}off(h,e,n){return n===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let n,o=h instanceof p.P||Array.isArray(h),s=o?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(o?{}:h)||{},s instanceof p.P||typeof s[0]=="number")n=[p.P.convert(s)];else{let c=p.P.convert(s[0]),f=p.P.convert(s[1]);n=[c,new p.P(f.x,c.y),f,new p.P(c.x,f.y),c]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=p.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){let e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));let n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new fo(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,n):this.style.loadJSON(h,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){let n=this._requestManager.transformRequest(h,"Style");p.h(n,new AbortController).then(o=>{this._updateDiff(o.data,e)}).catch(o=>{o&&this.fire(new p.j(o))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(n){p.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){let e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new p.j(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){let e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(let n in this.style._layers){let o=this.style._layers[n];o.type==="hillshade"&&o.source===h.source&&p.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gl(this.painter,e,h),this.painter.renderToTexture=new kc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==h.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new p.k("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let h=this.style&&this.style.sourceCaches;for(let e in h){let n=h[e]._tiles;for(let o in n){let s=n[o];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,e,n={}){let{pixelRatio:o=1,sdf:s=!1,stretchX:c,stretchY:f,content:_,textFitWidth:y,textFitHeight:b}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||p.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new p.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:C,height:M,data:P}=e,L=e;return this.style.addImage(h,{data:new p.R({width:C,height:M},new Uint8Array(P)),pixelRatio:o,stretchX:c,stretchY:f,content:_,textFitWidth:y,textFitHeight:b,sdf:s,version:0,userImage:L}),L.onAdd&&L.onAdd(this,h),this}}{let{width:C,height:M,data:P}=ge.getImageData(e);this.style.addImage(h,{data:new p.R({width:C,height:M},P),pixelRatio:o,stretchX:c,stretchY:f,content:_,textFitWidth:y,textFitHeight:b,sdf:s,version:0})}}updateImage(h,e){let n=this.style.getImage(h);if(!n)return this.fire(new p.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let o=e instanceof HTMLImageElement||p.b(e)?ge.getImageData(e):e,{width:s,height:c,data:f}=o;if(s===void 0||c===void 0)return this.fire(new p.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==n.data.width||c!==n.data.height)return this.fire(new p.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let _=!(e instanceof HTMLImageElement||p.b(e));return n.data.replace(f,_),this.style.updateImage(h,n),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new p.j(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return Ai.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,n){return this.style.setLayerZoomRange(h,e,n),this._update(!0)}setFilter(h,e,n={}){return this.style.setFilter(h,e,n),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,n,o={}){return this.style.setPaintProperty(h,e,n,o),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,n,o={}){return this.style.setLayoutProperty(h,e,n,o),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,n,o=>{o||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,n=>{n||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h){return this._lazyInitEmptyStyle(),this.style.setSky(h),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){let h=this._container;h.classList.add("maplibregl-map");let e=this._canvasContainer=le.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=le.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let n=this._containerDimensions(),o=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],o);let s=this._controlContainer=le.create("div","maplibregl-control-container",h),c=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{c[f]=le.create("div",`maplibregl-ctrl-${f} `,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,n){this._canvas.width=Math.floor(n*h),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let h={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",o=>{e={requestedAttributes:h},o&&(e.statusMessage=o.statusMessage,e.type=o.type)},{once:!0});let n=this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h);if(!n){let o="Failed to initialize WebGL";throw e?(e.message=o,new Error(JSON.stringify(e))):new Error(o)}this.painter=new Ao(n,this.transform),Ji.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let s=this.transform.zoom,c=ge.now();this.style.zoomHistory.update(s,c);let f=new p.z(s,{now:c,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=f.crossFadingFactor();_===1&&_===this._crossFadingFactor||(n=!0,this._crossFadingFactor=_),this.style.update(f)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new p.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,p.bf.mark(p.bg.load),this.fire(new p.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let o=this._sourcesDirty||this._styleDirty||this._placementDirty;return o||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.k("idle")),!this._loaded||this._fullyLoaded||o||(this._fullyLoaded=!0,p.bf.mark(p.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ai.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),le.remove(this._canvasContainer),le.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),p.bf.clearMetrics(),this._removed=!0,this.fire(new p.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(h=>{p.bf.frame(h),this._frameRequest=null,this._render(h)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return Ic}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=ei,w.MapTouchEvent=bn,w.MapWheelEvent=bc,w.Marker=jo,w.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{let e=this._map.getZoom(),n=e===this._map.getMaxZoom(),o=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{let o=this._map._getUIString(`NavigationControl.${n}`);e.title=o,e.setAttribute("aria-label",o)},this.options=p.e({},Yh,h),this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),le.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),le.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=le.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){le.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){let n=le.create("button",h,this._container);return n.type="button",n.addEventListener("click",e),n}},w.Popup=class extends p.E{constructor(h){super(),this.remove=()=>(this._content&&le.remove(this._content),this._container&&(le.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new p.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=le.create("div","maplibregl-popup",this._map.getContainer()),this._tip=le.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ct(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;let o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let s=this.options.anchor,c=$o(this.options.offset);if(!s){let _=this._container.offsetWidth,y=this._container.offsetHeight,b;b=o.y+c.bottom.y<y?["top"]:o.y>this._map.transform.height-y?["bottom"]:[],o.x<_/2?b.push("left"):o.x>this._map.transform.width-_/2&&b.push("right"),s=b.length===0?"bottom":b.join("-")}let f=o.add(c[s]);this.options.subpixelPositioning||(f=f.round()),le.setTransform(this._container,`${aa[s]} translate(${f.x}px,${f.y}px)`),No(this._container,s,"popup")},this._onClose=()=>{this.remove()},this.options=p.e(Object.create(qe),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new p.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=p.N.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let e=document.createDocumentFragment(),n=document.createElement("body"),o;for(n.innerHTML=h;o=n.firstChild,o;)e.appendChild(o);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=le.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=le.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(Uo);h&&h.focus()}},w.RasterDEMTileSource=At,w.RasterTileSource=lt,w.ScaleControl=class{constructor(h){this._onMove=()=>{Ka(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ka(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},kr),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){le.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=or,w.Style=fo,w.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=le.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=le.create("button","maplibregl-ctrl-terrain",this._container),le.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){le.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=ea,w.TwoFingersTouchRotateHandler=hl,w.TwoFingersTouchZoomHandler=ll,w.TwoFingersTouchZoomRotateHandler=dl,w.VectorTileSource=Ea,w.VideoSource=Bn,w.addSourceType=(h,e)=>p._(void 0,void 0,void 0,function*(){if(za(h))throw new Error(`A source type called "${h}" already exists.`);((n,o)=>{Aa[n]=o})(h,e)}),w.clearPrewarmedResources=function(){let h=zi;h&&(h.isPreloaded()&&h.numActive()===1?(h.release($r),zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return p.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},w.getVersion=function(){return vl},w.getWorkerCount=function(){return xr.workerCount},w.getWorkerUrl=function(){return p.a.WORKER_URL},w.importScriptInWorkers=function(h){return Ia().broadcast("IS",h)},w.prewarm=function(){cn().acquire($r)},w.setMaxParallelImageRequests=function(h){p.a.MAX_PARALLEL_IMAGE_REQUESTS=h},w.setRTLTextPlugin=function(h,e){return wr().setRTLTextPlugin(h,e)},w.setWorkerCount=function(h){xr.workerCount=h},w.setWorkerUrl=function(h){p.a.WORKER_URL=h}});var H=J;return H})});var Xg=["mat-menu-item",""],Kg=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],Jg=["mat-icon, [matMenuItemIcon]","*"];function Yg(J,ce){J&1&&(Yp(),Xe(0,"svg",2),on(1,"polygon",3),Ye())}var Qg=["*"];function e0(J,ce){if(J&1){let z=mr();Xe(0,"div",0),ci("click",function(){Wt(z);let w=mt();return Xt(w.closed.emit("click"))})("animationstart",function(w){Wt(z);let p=mt();return Xt(p._onAnimationStart(w.animationName))})("animationend",function(w){Wt(z);let p=mt();return Xt(p._onAnimationDone(w.animationName))})("animationcancel",function(w){Wt(z);let p=mt();return Xt(p._onAnimationDone(w.animationName))}),Xe(1,"div",1),va(2),Ye()()}if(J&2){let z=mt();jl(z._classList),an("mat-menu-panel-animations-disabled",z._animationsDisabled)("mat-menu-panel-exit-animation",z._panelAnimationState==="void")("mat-menu-panel-animating",z._isAnimating),Bt("id",z.panelId),Ar("aria-label",z.ariaLabel||null)("aria-labelledby",z.ariaLabelledby||null)("aria-describedby",z.ariaDescribedby||null)}}var Yu=new ql("MAT_MENU_PANEL"),Xl=(()=>{class J{_elementRef=je(gs);_document=je(nm);_focusMonitor=je(Zl);_parentMenu=je(Yu,{optional:!0});_changeDetectorRef=je(ws);role="menuitem";disabled=!1;disableRipple=!1;_hovered=new hs;_focused=new hs;_highlighted=!1;_triggersSubmenu=!1;constructor(){je($l).load(ph),this._parentMenu?.addItem?.(this)}focus(z,H){this._focusMonitor&&z?this._focusMonitor.focusVia(this._getHostElement(),z,H):this._getHostElement().focus(H),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(z){this.disabled&&(z.preventDefault(),z.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let z=this._elementRef.nativeElement.cloneNode(!0),H=z.querySelectorAll("mat-icon, .material-icons");for(let w=0;w<H.length;w++)H[w].remove();return z.textContent?.trim()||""}_setHighlighted(z){this._highlighted=z,this._changeDetectorRef.markForCheck()}_setTriggersSubmenu(z){this._triggersSubmenu=z,this._changeDetectorRef.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}static \u0275fac=function(H){return new(H||J)};static \u0275cmp=Ii({type:J,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-focus-indicator"],hostVars:8,hostBindings:function(H,w){H&1&&ci("click",function(Fe){return w._checkDisabled(Fe)})("mouseenter",function(){return w._handleMouseEnter()}),H&2&&(Ar("role",w.role)("tabindex",w._getTabIndex())("aria-disabled",w.disabled)("disabled",w.disabled||null),an("mat-mdc-menu-item-highlighted",w._highlighted)("mat-mdc-menu-item-submenu-trigger",w._triggersSubmenu))},inputs:{role:"role",disabled:[2,"disabled","disabled",Ul],disableRipple:[2,"disableRipple","disableRipple",Ul]},exportAs:["matMenuItem"],features:[$u],attrs:Xg,ngContentSelectors:Jg,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(H,w){H&1&&(co(Kg),va(0),Xe(1,"span",0),va(2,1),Ye(),on(3,"div",1),li(4,Yg,2,0,":svg:svg",2)),H&2&&(ht(3),Bt("matRippleDisabled",w.disableRipple||w.disabled)("matRippleTrigger",w._getHostElement()),ht(),Ei(w._triggersSubmenu?4:-1))},dependencies:[mh],encapsulation:2,changeDetection:0})}return J})();var t0=new ql("MatMenuContent");var i0=new ql("mat-menu-default-options",{providedIn:"root",factory:r0});function r0(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var Ju="_mat-menu-enter",vh="_mat-menu-exit",Ts=(()=>{class J{_elementRef=je(gs);_changeDetectorRef=je(ws);_injector=je(Uu);_keyManager;_xPosition;_yPosition;_firstItemFocusRef;_exitFallbackTimeout;_animationsDisabled;_allItems;_directDescendantItems=new ih;_classList={};_panelAnimationState="void";_animationDone=new hs;_isAnimating=!1;parentMenu;direction;overlayPanelClass;backdropClass;ariaLabel;ariaLabelledby;ariaDescribedby;get xPosition(){return this._xPosition}set xPosition(z){this._xPosition=z,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(z){this._yPosition=z,this.setPositionClasses()}templateRef;items;lazyContent;overlapTrigger;hasBackdrop;set panelClass(z){let H=this._previousPanelClass,w=ao({},this._classList);H&&H.length&&H.split(" ").forEach(p=>{w[p]=!1}),this._previousPanelClass=z,z&&z.length&&(z.split(" ").forEach(p=>{w[p]=!0}),this._elementRef.nativeElement.className=""),this._classList=w}_previousPanelClass;get classList(){return this.panelClass}set classList(z){this.panelClass=z}closed=new fs;close=this.closed;panelId=je(pm).getId("mat-menu-panel-");constructor(){let z=je(i0);this.overlayPanelClass=z.overlayPanelClass||"",this._xPosition=z.xPosition,this._yPosition=z.yPosition,this.backdropClass=z.backdropClass,this.overlapTrigger=z.overlapTrigger,this.hasBackdrop=z.hasBackdrop,this._animationsDisabled=je(rh,{optional:!0})==="NoopAnimations"}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new hm(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(oo(this._directDescendantItems),so(z=>Qc(...z.map(H=>H._focused)))).subscribe(z=>this._keyManager.updateActiveItem(z)),this._directDescendantItems.changes.subscribe(z=>{let H=this._keyManager;if(this._panelAnimationState==="enter"&&H.activeItem?._hasFocus()){let w=z.toArray(),p=Math.max(0,Math.min(w.length-1,H.activeItemIndex||0));w[p]&&!w[p].disabled?H.setActiveItem(p):H.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusRef?.destroy(),clearTimeout(this._exitFallbackTimeout)}_hovered(){return this._directDescendantItems.changes.pipe(oo(this._directDescendantItems),so(H=>Qc(...H.map(w=>w._hovered))))}addItem(z){}removeItem(z){}_handleKeydown(z){let H=z.keyCode,w=this._keyManager;switch(H){case 27:cm(z)||(z.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(H===38||H===40)&&w.setFocusOrigin("keyboard"),w.onKeydown(z);return}}focusFirstItem(z="program"){this._firstItemFocusRef?.destroy(),this._firstItemFocusRef=nh(()=>{let H=this._resolvePanel();if(!H||!H.contains(document.activeElement)){let w=this._keyManager;w.setFocusOrigin(z).setFirstItemActive(),!w.activeItem&&H&&H.focus()}},{injector:this._injector})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(z){}setPositionClasses(z=this.xPosition,H=this.yPosition){this._classList=ls(ao({},this._classList),{"mat-menu-before":z==="before","mat-menu-after":z==="after","mat-menu-above":H==="above","mat-menu-below":H==="below"}),this._changeDetectorRef.markForCheck()}_onAnimationDone(z){let H=z===vh;(H||z===Ju)&&(H&&(clearTimeout(this._exitFallbackTimeout),this._exitFallbackTimeout=void 0),this._animationDone.next(H?"void":"enter"),this._isAnimating=!1)}_onAnimationStart(z){(z===Ju||z===vh)&&(this._isAnimating=!0)}_setIsOpen(z){if(this._panelAnimationState=z?"enter":"void",z){if(this._keyManager.activeItemIndex===0){let H=this._resolvePanel();H&&(H.scrollTop=0)}}else this._animationsDisabled||(this._exitFallbackTimeout=setTimeout(()=>this._onAnimationDone(vh),200));this._animationsDisabled&&setTimeout(()=>{this._onAnimationDone(z?Ju:vh)}),this._changeDetectorRef.markForCheck()}_updateDirectDescendants(){this._allItems.changes.pipe(oo(this._allItems)).subscribe(z=>{this._directDescendantItems.reset(z.filter(H=>H._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}_resolvePanel(){let z=null;return this._directDescendantItems.length&&(z=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),z}static \u0275fac=function(H){return new(H||J)};static \u0275cmp=Ii({type:J,selectors:[["mat-menu"]],contentQueries:function(H,w,p){if(H&1&&(sn(p,t0,5),sn(p,Xl,5),sn(p,Xl,4)),H&2){let Fe;fr(Fe=gr())&&(w.lazyContent=Fe.first),fr(Fe=gr())&&(w._allItems=Fe),fr(Fe=gr())&&(w.items=Fe)}},viewQuery:function(H,w){if(H&1&&xs(Nl,5),H&2){let p;fr(p=gr())&&(w.templateRef=p.first)}},hostVars:3,hostBindings:function(H,w){H&2&&Ar("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[2,"overlapTrigger","overlapTrigger",Ul],hasBackdrop:[2,"hasBackdrop","hasBackdrop",z=>z==null?null:Ul(z)],panelClass:[0,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],features:[bs([{provide:Yu,useExisting:J}]),$u],ngContentSelectors:Qg,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel",3,"click","animationstart","animationend","animationcancel","id"],[1,"mat-mdc-menu-content"]],template:function(H,w){H&1&&(co(),li(0,e0,3,12,"ng-template"))},styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;outline:0}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-menu-item-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-menu-item-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-menu-item-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-menu-item-label-text-weight, var(--mat-sys-label-large-weight))}@keyframes _mat-menu-enter{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:none}}@keyframes _mat-menu-exit{from{opacity:1}to{opacity:0}}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;box-sizing:border-box;outline:0;animation:_mat-menu-enter 120ms cubic-bezier(0, 0, 0.2, 1);border-radius:var(--mat-menu-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-menu-container-color, var(--mat-sys-surface-container));box-shadow:var(--mat-menu-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));will-change:transform,opacity}.mat-mdc-menu-panel.mat-menu-panel-exit-animation{animation:_mat-menu-exit 100ms 25ms linear forwards}.mat-mdc-menu-panel.mat-menu-panel-animations-disabled{animation:none}.mat-mdc-menu-panel.mat-menu-panel-animating{pointer-events:none}.mat-mdc-menu-panel.mat-menu-panel-animating:has(.mat-mdc-menu-content:empty){display:none}@media(forced-colors: active){.mat-mdc-menu-panel{outline:solid 1px}}.mat-mdc-menu-panel .mat-divider{color:var(--mat-menu-divider-color, var(--mat-sys-surface-variant));margin-bottom:var(--mat-menu-divider-bottom-spacing, 8px);margin-top:var(--mat-menu-divider-top-spacing, 8px)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;min-height:48px;padding-left:var(--mat-menu-item-leading-spacing, 12px);padding-right:var(--mat-menu-item-trailing-spacing, 12px);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-menu-item::-moz-focus-inner{border:0}[dir=rtl] .mat-mdc-menu-item{padding-left:var(--mat-menu-item-trailing-spacing, 12px);padding-right:var(--mat-menu-item-leading-spacing, 12px)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-trailing-spacing, 12px)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-trailing-spacing, 12px);padding-right:var(--mat-menu-item-with-icon-leading-spacing, 12px)}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color, var(--mat-sys-on-surface))}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item:focus{outline:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing, 12px);height:var(--mat-menu-item-icon-size, 24px);width:var(--mat-menu-item-icon-size, 24px)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing, 12px)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent))}@media(forced-colors: active){.mat-mdc-menu-item{margin-top:1px}}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size, 24px);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing, 12px)}[dir=rtl] .mat-mdc-menu-submenu-icon{padding-right:var(--mat-menu-item-spacing, 12px);padding-left:0}[dir=rtl] .mat-mdc-menu-submenu-icon polygon{transform:scaleX(-1);transform-origin:center}@media(forced-colors: active){.mat-mdc-menu-submenu-icon{fill:CanvasText}}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,changeDetection:0})}return J})(),Fm=new ql("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let J=je(yh);return()=>J.scrollStrategies.reposition()}});function n0(J){return()=>J.scrollStrategies.reposition()}var a0={provide:Fm,deps:[yh],useFactory:n0},Dm=sm({passive:!0});var Wl=new WeakMap,Bm=(()=>{class J{_overlay=je(yh);_element=je(gs);_viewContainerRef=je(ah);_menuItemInstance=je(Xl,{optional:!0,self:!0});_dir=je(mm,{optional:!0});_focusMonitor=je(Zl);_ngZone=je(th);_scrollStrategy=je(Fm);_changeDetectorRef=je(ws);_portal;_overlayRef=null;_menuOpen=!1;_closingActionsSubscription=cs.EMPTY;_hoverSubscription=cs.EMPTY;_menuCloseSubscription=cs.EMPTY;_pendingRemoval;_parentMaterialMenu;_parentInnerPadding;_handleTouchStart=z=>{dm(z)||(this._openedBy="touch")};_openedBy=void 0;get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(z){this.menu=z}get menu(){return this._menu}set menu(z){z!==this._menu&&(this._menu=z,this._menuCloseSubscription.unsubscribe(),z&&(this._parentMaterialMenu,this._menuCloseSubscription=z.close.subscribe(H=>{this._destroyMenu(H),(H==="click"||H==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(H)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}_menu;menuData;restoreFocus=!0;menuOpened=new fs;onMenuOpen=this.menuOpened;menuClosed=new fs;onMenuClose=this.menuClosed;constructor(){let z=je(Yu,{optional:!0});this._parentMaterialMenu=z instanceof Ts?z:void 0,this._element.nativeElement.addEventListener("touchstart",this._handleTouchStart,Dm)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this.menu&&this._ownsMenu(this.menu)&&Wl.delete(this.menu),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,Dm),this._pendingRemoval?.unsubscribe(),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe(),this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null)}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let z=this.menu;if(this._menuOpen||!z)return;this._pendingRemoval?.unsubscribe();let H=Wl.get(z);Wl.set(z,this),H&&H!==this&&H.closeMenu();let w=this._createOverlay(z),p=w.getConfig(),Fe=p.positionStrategy;this._setPosition(z,Fe),p.hasBackdrop=z.hasBackdrop==null?!this.triggersSubmenu():z.hasBackdrop,w.hasAttached()||(w.attach(this._getPortal(z)),z.lazyContent?.attach(this.menuData)),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),z.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,z.direction=this.dir,z.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0),z instanceof Ts&&(z._setIsOpen(!0),z._directDescendantItems.changes.pipe(ds(z.close)).subscribe(()=>{Fe.withLockedPosition(!1).reapplyLastPosition(),Fe.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(z,H){this._focusMonitor&&z?this._focusMonitor.focusVia(this._element,z,H):this._element.nativeElement.focus(H)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(z){let H=this._overlayRef,w=this._menu;!H||!this.menuOpen||(this._closingActionsSubscription.unsubscribe(),this._pendingRemoval?.unsubscribe(),w instanceof Ts&&this._ownsMenu(w)?(this._pendingRemoval=w._animationDone.pipe(Wp(1)).subscribe(()=>{H.detach(),w.lazyContent?.detach()}),w._setIsOpen(!1)):(H.detach(),w?.lazyContent?.detach()),w&&this._ownsMenu(w)&&Wl.delete(w),this.restoreFocus&&(z==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,this._setIsMenuOpen(!1))}_setIsMenuOpen(z){z!==this._menuOpen&&(this._menuOpen=z,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(z),this._changeDetectorRef.markForCheck())}_createOverlay(z){if(!this._overlayRef){let H=this._getOverlayConfig(z);this._subscribeToPositions(z,H.positionStrategy),this._overlayRef=this._overlay.create(H),this._overlayRef.keydownEvents().subscribe(w=>{this.menu instanceof Ts&&this.menu._handleKeydown(w)})}return this._overlayRef}_getOverlayConfig(z){return new bm({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:z.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:z.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir||"ltr"})}_subscribeToPositions(z,H){z.setPositionClasses&&H.positionChanges.subscribe(w=>{this._ngZone.run(()=>{let p=w.connectionPair.overlayX==="start"?"after":"before",Fe=w.connectionPair.overlayY==="top"?"below":"above";z.setPositionClasses(p,Fe)})})}_setPosition(z,H){let[w,p]=z.xPosition==="before"?["end","start"]:["start","end"],[Fe,Pt]=z.yPosition==="above"?["bottom","top"]:["top","bottom"],[bt,ge]=[Fe,Pt],[le,Ji]=[w,p],_i=0;if(this.triggersSubmenu()){if(Ji=w=z.xPosition==="before"?"start":"end",p=le=w==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let Pi=this._parentMaterialMenu.items.first;this._parentInnerPadding=Pi?Pi._getHostElement().offsetTop:0}_i=Fe==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else z.overlapTrigger||(bt=Fe==="top"?"bottom":"top",ge=Pt==="top"?"bottom":"top");H.withPositions([{originX:w,originY:bt,overlayX:le,overlayY:Fe,offsetY:_i},{originX:p,originY:bt,overlayX:Ji,overlayY:Fe,offsetY:_i},{originX:w,originY:ge,overlayX:le,overlayY:Pt,offsetY:-_i},{originX:p,originY:ge,overlayX:Ji,overlayY:Pt,offsetY:-_i}])}_menuClosingActions(){let z=this._overlayRef.backdropClick(),H=this._overlayRef.detachments(),w=this._parentMaterialMenu?this._parentMaterialMenu.closed:Vl(),p=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(Hp(Fe=>this._menuOpen&&Fe!==this._menuItemInstance)):Vl();return Qc(z,w,p,H)}_handleMousedown(z){um(z)||(this._openedBy=z.button===0?"mouse":void 0,this.triggersSubmenu()&&z.preventDefault())}_handleKeydown(z){let H=z.keyCode;(H===13||H===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(H===39&&this.dir==="ltr"||H===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(z){this.triggersSubmenu()?(z.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){this.triggersSubmenu()&&this._parentMaterialMenu&&(this._hoverSubscription=this._parentMaterialMenu._hovered().subscribe(z=>{z===this._menuItemInstance&&!z.disabled&&(this._openedBy="mouse",this.openMenu())}))}_getPortal(z){return(!this._portal||this._portal.templateRef!==z.templateRef)&&(this._portal=new _h(z.templateRef,this._viewContainerRef)),this._portal}_ownsMenu(z){return Wl.get(z)===this}static \u0275fac=function(H){return new(H||J)};static \u0275dir=ys({type:J,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(H,w){H&1&&ci("click",function(Fe){return w._handleClick(Fe)})("mousedown",function(Fe){return w._handleMousedown(Fe)})("keydown",function(Fe){return w._handleKeydown(Fe)}),H&2&&Ar("aria-haspopup",w.menu?"menu":null)("aria-expanded",w.menuOpen)("aria-controls",w.menuOpen?w.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[0,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[0,"matMenuTriggerFor","menu"],menuData:[0,"matMenuTriggerData","menuData"],restoreFocus:[0,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"]})}return J})(),xh=(()=>{class J{static \u0275fac=function(H){return new(H||J)};static \u0275mod=_s({type:J});static \u0275inj=ms({providers:[a0],imports:[fh,Pn,wm,Hl,Pn]})}return J})(),Om={transformMenu:Gl("transformMenu",[Ku("void",An({opacity:0,transform:"scale(0.8)"})),Ms("void => enter",Cs("120ms cubic-bezier(0, 0, 0.2, 1)",An({opacity:1,transform:"scale(1)"}))),Ms("* => void",Cs("100ms 25ms linear",An({opacity:0})))]),fadeInItems:Gl("fadeInItems",[Ku("showing",An({opacity:1})),Ms("void => *",[An({opacity:0}),Cs("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},p_=Om.fadeInItems,m_=Om.transformMenu;var Vm=(()=>{class J{static \u0275fac=function(H){return new(H||J)};static \u0275mod=_s({type:J});static \u0275inj=ms({imports:[Pn,Hl,Hl,Pn]})}return J})();function s0(J,ce){if(J&1&&lo(0,2),J&2){let z=mt();Bt("ngTemplateOutlet",z.iconOverrides[z.state])("ngTemplateOutletContext",z._getIconContext())}}function l0(J,ce){if(J&1&&(Xe(0,"span",7),ft(1),Ye()),J&2){let z=mt(2);ht(),ba(z._getDefaultTextForState(z.state))}}function c0(J,ce){if(J&1&&(Xe(0,"span",8),ft(1),Ye()),J&2){let z=mt(3);ht(),ba(z._intl.completedLabel)}}function h0(J,ce){if(J&1&&(Xe(0,"span",8),ft(1),Ye()),J&2){let z=mt(3);ht(),ba(z._intl.editableLabel)}}function u0(J,ce){if(J&1&&(li(0,c0,2,1,"span",8)(1,h0,2,1,"span",8),Xe(2,"mat-icon",7),ft(3),Ye()),J&2){let z=mt(2);Ei(z.state==="done"?0:z.state==="edit"?1:-1),ht(3),ba(z._getDefaultTextForState(z.state))}}function d0(J,ce){if(J&1&&li(0,l0,2,1,"span",7)(1,u0,4,2),J&2){let z,H=mt();Ei((z=H.state)==="number"?0:1)}}function p0(J,ce){J&1&&(Xe(0,"div",4),lo(1,9),Ye()),J&2&&(ht(),Bt("ngTemplateOutlet",ce.template))}function m0(J,ce){if(J&1&&(Xe(0,"div",4),ft(1),Ye()),J&2){let z=mt();ht(),ba(z.label)}}function f0(J,ce){if(J&1&&(Xe(0,"div",5),ft(1),Ye()),J&2){let z=mt();ht(),ba(z._intl.optionalLabel)}}function g0(J,ce){if(J&1&&(Xe(0,"div",6),ft(1),Ye()),J&2){let z=mt();ht(),ba(z.errorMessage)}}var qm=["*"];function _0(J,ce){}function y0(J,ce){if(J&1&&(va(0),li(1,_0,0,0,"ng-template",0)),J&2){let z=mt();ht(),Bt("cdkPortalOutlet",z._portal)}}var v0=["animatedContainer"],Nm=(J,ce)=>({step:J,i:ce});function x0(J,ce){J&1&&va(0)}function b0(J,ce){J&1&&on(0,"div",7)}function w0(J,ce){if(J&1&&(lo(0,6),li(1,b0,1,0,"div",7)),J&2){let z=ce.$implicit,H=ce.$index,w=ce.$index,p=ce.$count;mt(2);let Fe=xa(4);Bt("ngTemplateOutlet",Fe)("ngTemplateOutletContext",Gu(3,Nm,z,H)),ht(),Ei(w!==p-1?1:-1)}}function S0(J,ce){if(J&1&&(Xe(0,"div",8,1),lo(2,9),Ye()),J&2){let z=ce.$implicit,H=ce.$index,w=mt(2);jl("mat-horizontal-stepper-content-"+w._getAnimationDirection(H)),Bt("id",w._getStepContentId(H)),Ar("aria-labelledby",w._getStepLabelId(H))("inert",w.selectedIndex===H?null:""),ht(2),Bt("ngTemplateOutlet",z.content)}}function C0(J,ce){if(J&1&&(Xe(0,"div",2)(1,"div",3),sh(2,w0,2,6,null,null,oh),Ye(),Xe(4,"div",4),sh(5,S0,3,6,"div",5,oh),Ye()()),J&2){let z=mt();ht(2),lh(z.steps),ht(3),lh(z.steps)}}function M0(J,ce){if(J&1&&(Xe(0,"div",10),lo(1,6),Xe(2,"div",11,1)(4,"div",12)(5,"div",13),lo(6,9),Ye()()()()),J&2){let z=ce.$implicit,H=ce.$index,w=ce.$index,p=ce.$count,Fe=mt(2),Pt=xa(4);ht(),Bt("ngTemplateOutlet",Pt)("ngTemplateOutletContext",Gu(10,Nm,z,H)),ht(),an("mat-stepper-vertical-line",w!==p-1)("mat-vertical-content-container-active",Fe.selectedIndex===H),Ar("inert",Fe.selectedIndex===H?null:""),ht(2),Bt("id",Fe._getStepContentId(H)),Ar("aria-labelledby",Fe._getStepLabelId(H)),ht(2),Bt("ngTemplateOutlet",z.content)}}function T0(J,ce){if(J&1&&sh(0,M0,7,13,"div",10,oh),J&2){let z=mt();lh(z.steps)}}function k0(J,ce){if(J&1){let z=mr();Xe(0,"mat-step-header",14),ci("click",function(){let w=Wt(z).step;return Xt(w.select())})("keydown",function(w){Wt(z);let p=mt();return Xt(p._onKeydown(w))}),Ye()}if(J&2){let z=ce.step,H=ce.i,w=mt();an("mat-horizontal-stepper-header",w.orientation==="horizontal")("mat-vertical-stepper-header",w.orientation==="vertical"),Bt("tabIndex",w._getFocusIndex()===H?0:-1)("id",w._getStepLabelId(H))("index",H)("state",w._getIndicatorType(H,z.state))("label",z.stepLabel||z.label)("selected",w.selectedIndex===H)("active",w._stepIsNavigable(H,z))("optional",z.optional)("errorMessage",z.errorMessage)("iconOverrides",w._iconOverrides)("disableRipple",w.disableRipple||!w._stepIsNavigable(H,z))("color",z.color||w.color),Ar("aria-posinset",H+1)("aria-setsize",w.steps.length)("aria-controls",w._getStepContentId(H))("aria-selected",w.selectedIndex==H)("aria-label",z.ariaLabel||null)("aria-labelledby",!z.ariaLabel&&z.ariaLabelledby?z.ariaLabelledby:null)("aria-disabled",w._stepIsNavigable(H,z)?null:!0)}}var Qu=(()=>{class J extends gm{static \u0275fac=(()=>{let z;return function(w){return(z||(z=eh(J)))(w||J)}})();static \u0275dir=ys({type:J,selectors:[["","matStepLabel",""]],features:[vs]})}return J})(),bh=(()=>{class J{changes=new hs;optionalLabel="Optional";completedLabel="Completed";editableLabel="Editable";static \u0275fac=function(H){return new(H||J)};static \u0275prov=ya({token:J,factory:J.\u0275fac,providedIn:"root"})}return J})();function I0(J){return J||new bh}var E0={provide:bh,deps:[[new Xp,new Kp,bh]],useFactory:I0},ed=(()=>{class J extends fm{_intl=je(bh);_focusMonitor=je(Zl);_intlSubscription;state;label;errorMessage;iconOverrides;index;selected;active;optional;disableRipple;color;constructor(){super(),je($l).load(ph),je($l).load(lm);let z=je(ws);this._intlSubscription=this._intl.changes.subscribe(()=>z.markForCheck())}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._intlSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._elementRef)}focus(z,H){z?this._focusMonitor.focusVia(this._elementRef,z,H):this._elementRef.nativeElement.focus(H)}_stringLabel(){return this.label instanceof Qu?null:this.label}_templateLabel(){return this.label instanceof Qu?this.label:null}_getHostElement(){return this._elementRef.nativeElement}_getIconContext(){return{index:this.index,active:this.active,optional:this.optional}}_getDefaultTextForState(z){return z=="number"?`${this.index+1}`:z=="edit"?"create":z=="error"?"warning":z}static \u0275fac=function(H){return new(H||J)};static \u0275cmp=Ii({type:J,selectors:[["mat-step-header"]],hostAttrs:["role","tab",1,"mat-step-header"],hostVars:2,hostBindings:function(H,w){H&2&&jl("mat-"+(w.color||"primary"))},inputs:{state:"state",label:"label",errorMessage:"errorMessage",iconOverrides:"iconOverrides",index:"index",selected:"selected",active:"active",optional:"optional",disableRipple:"disableRipple",color:"color"},features:[vs],decls:10,vars:17,consts:[["matRipple","",1,"mat-step-header-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-step-icon-content"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-step-label"],[1,"mat-step-text-label"],[1,"mat-step-optional"],[1,"mat-step-sub-label-error"],["aria-hidden","true"],[1,"cdk-visually-hidden"],[3,"ngTemplateOutlet"]],template:function(H,w){if(H&1&&(on(0,"div",0),Xe(1,"div")(2,"div",1),li(3,s0,1,2,"ng-container",2)(4,d0,2,1),Ye()(),Xe(5,"div",3),li(6,p0,2,1,"div",4)(7,m0,2,1,"div",4)(8,f0,2,1,"div",5)(9,g0,2,1,"div",6),Ye()),H&2){let p;Bt("matRippleTrigger",w._getHostElement())("matRippleDisabled",w.disableRipple),ht(),tm("mat-step-icon-state-",w.state," mat-step-icon"),an("mat-step-icon-selected",w.selected),ht(2),Ei(w.iconOverrides&&w.iconOverrides[w.state]?3:4),ht(2),an("mat-step-label-active",w.active)("mat-step-label-selected",w.selected)("mat-step-label-error",w.state=="error"),ht(),Ei((p=w._templateLabel())?6:w._stringLabel()?7:-1,p),ht(2),Ei(w.optional&&w.state!="error"?8:-1),ht(),Ei(w.state==="error"?9:-1)}},dependencies:[mh,Hu,Ca],styles:['.mat-step-header{overflow:hidden;outline:none;cursor:pointer;position:relative;box-sizing:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-step-header:focus .mat-focus-indicator::before{content:""}.mat-step-header:hover[aria-disabled=true]{cursor:default}.mat-step-header:hover:not([aria-disabled]),.mat-step-header:hover[aria-disabled=false]{background-color:var(--mat-stepper-header-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-hover-state-layer-shape, var(--mat-sys-corner-medium))}.mat-step-header.cdk-keyboard-focused,.mat-step-header.cdk-program-focused{background-color:var(--mat-stepper-header-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-inverse-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));border-radius:var(--mat-stepper-header-focus-state-layer-shape, var(--mat-sys-corner-medium))}@media(hover: none){.mat-step-header:hover{background:none}}@media(forced-colors: active){.mat-step-header{outline:solid 1px}.mat-step-header[aria-selected=true] .mat-step-label{text-decoration:underline}.mat-step-header[aria-disabled=true]{outline-color:GrayText}.mat-step-header[aria-disabled=true] .mat-step-label,.mat-step-header[aria-disabled=true] .mat-step-icon,.mat-step-header[aria-disabled=true] .mat-step-optional{color:GrayText}}.mat-step-optional{font-size:12px;color:var(--mat-stepper-header-optional-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-sub-label-error{font-size:12px;font-weight:normal}.mat-step-icon{border-radius:50%;height:24px;width:24px;flex-shrink:0;position:relative;color:var(--mat-stepper-header-icon-foreground-color, var(--mat-sys-surface));background-color:var(--mat-stepper-header-icon-background-color, var(--mat-sys-on-surface-variant))}.mat-step-icon-content{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex}.mat-step-icon .mat-icon{font-size:16px;height:16px;width:16px}.mat-step-icon-state-error{background-color:var(--mat-stepper-header-error-state-icon-background-color, transparent);color:var(--mat-stepper-header-error-state-icon-foreground-color, var(--mat-sys-error))}.mat-step-icon-state-error .mat-icon{font-size:24px;height:24px;width:24px}.mat-step-label{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:50px;vertical-align:middle;font-family:var(--mat-stepper-header-label-text-font, var(--mat-sys-title-small-font));font-size:var(--mat-stepper-header-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-label-text-weight, var(--mat-sys-title-small-weight));color:var(--mat-stepper-header-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-active{color:var(--mat-stepper-header-selected-state-label-text-color, var(--mat-sys-on-surface-variant))}.mat-step-label.mat-step-label-error{color:var(--mat-stepper-header-error-state-label-text-color, var(--mat-sys-error));font-size:var(--mat-stepper-header-error-state-label-text-size, var(--mat-sys-title-small-size))}.mat-step-label.mat-step-label-selected{font-size:var(--mat-stepper-header-selected-state-label-text-size, var(--mat-sys-title-small-size));font-weight:var(--mat-stepper-header-selected-state-label-text-weight, var(--mat-sys-title-small-weight))}.mat-step-text-label{text-overflow:ellipsis;overflow:hidden}.mat-step-header .mat-step-header-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-step-icon-selected{background-color:var(--mat-stepper-header-selected-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-selected-state-icon-foreground-color, var(--mat-sys-on-primary))}.mat-step-icon-state-done{background-color:var(--mat-stepper-header-done-state-icon-background-color);color:var(--mat-stepper-header-done-state-icon-foreground-color)}.mat-step-icon-state-edit{background-color:var(--mat-stepper-header-edit-state-icon-background-color, var(--mat-sys-primary));color:var(--mat-stepper-header-edit-state-icon-foreground-color, var(--mat-sys-on-primary))}'],encapsulation:2,changeDetection:0})}return J})(),td=(()=>{class J{templateRef=je(Nl);name;constructor(){}static \u0275fac=function(H){return new(H||J)};static \u0275dir=ys({type:J,selectors:[["ng-template","matStepperIcon",""]],inputs:{name:[0,"matStepperIcon","name"]}})}return J})(),P0=(()=>{class J{_template=je(Nl);constructor(){}static \u0275fac=function(H){return new(H||J)};static \u0275dir=ys({type:J,selectors:[["ng-template","matStepContent",""]]})}return J})(),id=(()=>{class J extends Wu{_errorStateMatcher=je(dh,{skipSelf:!0});_viewContainerRef=je(ah);_isSelected=cs.EMPTY;stepLabel=void 0;color;_lazyContent;_portal;ngAfterContentInit(){this._isSelected=this._stepper.steps.changes.pipe(so(()=>this._stepper.selectionChange.pipe(us(z=>z.selectedStep===this),oo(this._stepper.selected===this)))).subscribe(z=>{z&&this._lazyContent&&!this._portal&&(this._portal=new _h(this._lazyContent._template,this._viewContainerRef))})}ngOnDestroy(){this._isSelected.unsubscribe()}isErrorState(z,H){let w=this._errorStateMatcher.isErrorState(z,H),p=!!(z&&z.invalid&&this.interacted);return w||p}static \u0275fac=(()=>{let z;return function(w){return(z||(z=eh(J)))(w||J)}})();static \u0275cmp=Ii({type:J,selectors:[["mat-step"]],contentQueries:function(H,w,p){if(H&1&&(sn(p,Qu,5),sn(p,P0,5)),H&2){let Fe;fr(Fe=gr())&&(w.stepLabel=Fe.first),fr(Fe=gr())&&(w._lazyContent=Fe.first)}},hostAttrs:["hidden",""],inputs:{color:"color"},exportAs:["matStep"],features:[bs([{provide:dh,useExisting:J},{provide:Wu,useExisting:J}]),vs],ngContentSelectors:qm,decls:1,vars:0,consts:[[3,"cdkPortalOutlet"]],template:function(H,w){H&1&&(co(),li(0,y0,2,1,"ng-template"))},dependencies:[vm],encapsulation:2,changeDetection:0})}return J})(),rd=(()=>{class J extends Xu{_ngZone=je(th);_renderer=je(em);_animationsModule=je(rh,{optional:!0});_cleanupTransition;_isAnimating=En(!1);_stepHeader=void 0;_animatedContainers;_steps=void 0;steps=new ih;_icons;animationDone=new fs;disableRipple;color;labelPosition="end";headerPosition="top";_iconOverrides={};get animationDuration(){return this._animationDuration}set animationDuration(z){this._animationDuration=/^\d+$/.test(z)?z+"ms":z}_animationDuration="";_isServer=!je(om).isBrowser;constructor(){super();let H=je(gs).nativeElement.nodeName.toLowerCase();this.orientation=H==="mat-vertical-stepper"?"vertical":"horizontal"}ngAfterContentInit(){super.ngAfterContentInit(),this._icons.forEach(({name:z,templateRef:H})=>this._iconOverrides[z]=H),this.steps.changes.pipe(ds(this._destroyed)).subscribe(()=>this._stateChanged()),this.selectedIndexChange.pipe(ds(this._destroyed)).subscribe(()=>{let z=this._getAnimationDuration();z==="0ms"||z==="0s"?this._onAnimationDone():this._isAnimating.set(!0)}),this._ngZone.runOutsideAngular(()=>{this._animationsModule!=="NoopAnimations"&&setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-stepper-animations-enabled"),this._cleanupTransition=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._handleTransitionend)},200)})}ngAfterViewInit(){if(super.ngAfterViewInit(),typeof queueMicrotask=="function"){let z=!1;this._animatedContainers.changes.pipe(oo(null),ds(this._destroyed)).subscribe(()=>queueMicrotask(()=>{z||(z=!0,this.animationDone.emit()),this._stateChanged()}))}}ngOnDestroy(){super.ngOnDestroy(),this._cleanupTransition?.()}_stepIsNavigable(z,H){return H.completed||this.selectedIndex===z||!this.linear}_getAnimationDuration(){return this._animationsModule==="NoopAnimations"?"0ms":this.animationDuration?this.animationDuration:this.orientation==="horizontal"?"500ms":"225ms"}_handleTransitionend=z=>{let H=z.target;if(!H)return;let w=this.orientation==="horizontal"&&z.propertyName==="transform"&&H.classList.contains("mat-horizontal-stepper-content-current"),p=this.orientation==="vertical"&&z.propertyName==="grid-template-rows"&&H.classList.contains("mat-vertical-content-container-active");(w||p)&&this._animatedContainers.find(Pt=>Pt.nativeElement===H)&&this._onAnimationDone()};_onAnimationDone(){this._isAnimating.set(!1),this.animationDone.emit()}static \u0275fac=function(H){return new(H||J)};static \u0275cmp=Ii({type:J,selectors:[["mat-stepper"],["mat-vertical-stepper"],["mat-horizontal-stepper"],["","matStepper",""]],contentQueries:function(H,w,p){if(H&1&&(sn(p,id,5),sn(p,td,5)),H&2){let Fe;fr(Fe=gr())&&(w._steps=Fe),fr(Fe=gr())&&(w._icons=Fe)}},viewQuery:function(H,w){if(H&1&&(xs(ed,5),xs(v0,5)),H&2){let p;fr(p=gr())&&(w._stepHeader=p),fr(p=gr())&&(w._animatedContainers=p)}},hostAttrs:["role","tablist"],hostVars:15,hostBindings:function(H,w){H&2&&(Ar("aria-orientation",w.orientation),Zu("--mat-stepper-animation-duration",w._getAnimationDuration()),an("mat-stepper-horizontal",w.orientation==="horizontal")("mat-stepper-vertical",w.orientation==="vertical")("mat-stepper-label-position-end",w.orientation==="horizontal"&&w.labelPosition=="end")("mat-stepper-label-position-bottom",w.orientation==="horizontal"&&w.labelPosition=="bottom")("mat-stepper-header-position-bottom",w.headerPosition==="bottom")("mat-stepper-animating",w._isAnimating()))},inputs:{disableRipple:"disableRipple",color:"color",labelPosition:"labelPosition",headerPosition:"headerPosition",animationDuration:"animationDuration"},outputs:{animationDone:"animationDone"},exportAs:["matStepper","matVerticalStepper","matHorizontalStepper"],features:[bs([{provide:Xu,useExisting:J}]),vs],ngContentSelectors:qm,decls:5,vars:2,consts:[["stepTemplate",""],["animatedContainer",""],[1,"mat-horizontal-stepper-wrapper"],[1,"mat-horizontal-stepper-header-container"],[1,"mat-horizontal-content-container"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id","class"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mat-stepper-horizontal-line"],["role","tabpanel",1,"mat-horizontal-stepper-content",3,"id"],[3,"ngTemplateOutlet"],[1,"mat-step"],[1,"mat-vertical-content-container"],["role","tabpanel",1,"mat-vertical-stepper-content",3,"id"],[1,"mat-vertical-content"],[3,"click","keydown","tabIndex","id","index","state","label","selected","active","optional","errorMessage","iconOverrides","disableRipple","color"]],template:function(H,w){if(H&1&&(co(),li(0,x0,1,0)(1,C0,7,0,"div",2)(2,T0,2,0)(3,k0,1,23,"ng-template",null,0,im)),H&2){let p;Ei(w._isServer?0:-1),ht(),Ei((p=w.orientation)==="horizontal"?1:p==="vertical"?2:-1)}},dependencies:[Hu,ed],styles:['.mat-stepper-vertical,.mat-stepper-horizontal{display:block;font-family:var(--mat-stepper-container-text-font, var(--mat-sys-body-medium-font));background:var(--mat-stepper-container-color, var(--mat-sys-surface))}.mat-horizontal-stepper-header-container{white-space:nowrap;display:flex;align-items:center}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header-container{align-items:flex-start}.mat-stepper-header-position-bottom .mat-horizontal-stepper-header-container{order:1}.mat-stepper-horizontal-line{border-top-width:1px;border-top-style:solid;flex:auto;height:0;margin:0 -16px;min-width:32px;border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-stepper-horizontal-line{margin:0;min-width:0;position:relative;top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{border-top-width:1px;border-top-style:solid;content:"";display:inline-block;height:0;position:absolute;width:calc(50% - 20px)}.mat-horizontal-stepper-header{display:flex;height:72px;overflow:hidden;align-items:center;padding:0 24px;height:var(--mat-stepper-header-height, 72px)}.mat-horizontal-stepper-header .mat-step-icon{margin-right:8px;flex:none}[dir=rtl] .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:8px}.mat-horizontal-stepper-header::before,.mat-horizontal-stepper-header::after{border-top-color:var(--mat-stepper-line-color, var(--mat-sys-outline))}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::before,.mat-stepper-label-position-bottom .mat-horizontal-stepper-header::after{top:calc(calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) + 12px)}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header{box-sizing:border-box;flex-direction:column;height:auto}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::after,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::after{right:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:first-child)::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:not(:last-child)::before{left:0}[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:last-child::before,[dir=rtl] .mat-stepper-label-position-bottom .mat-horizontal-stepper-header:first-child::after{display:none}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-icon{margin-right:0;margin-left:0}.mat-stepper-label-position-bottom .mat-horizontal-stepper-header .mat-step-label{padding:16px 0 0 0;text-align:center;width:100%}.mat-vertical-stepper-header{display:flex;align-items:center;height:24px;padding:calc((var(--mat-stepper-header-height, 72px) - 24px) / 2) 24px}.mat-vertical-stepper-header .mat-step-icon{margin-right:12px}[dir=rtl] .mat-vertical-stepper-header .mat-step-icon{margin-right:0;margin-left:12px}.mat-horizontal-stepper-wrapper{display:flex;flex-direction:column}.mat-horizontal-stepper-content{visibility:hidden;overflow:hidden;outline:0;height:0}.mat-stepper-animations-enabled .mat-horizontal-stepper-content{transition:transform var(--mat-stepper-animation-duration, 0) cubic-bezier(0.35, 0, 0.25, 1)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-previous{transform:translate3d(-100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-next{transform:translate3d(100%, 0, 0)}.mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{visibility:visible;transform:none;height:auto}.mat-stepper-horizontal:not(.mat-stepper-animating) .mat-horizontal-stepper-content.mat-horizontal-stepper-content-current{overflow:visible}.mat-horizontal-content-container{overflow:hidden;padding:0 24px 24px 24px}@media(forced-colors: active){.mat-horizontal-content-container{outline:solid 1px}}.mat-stepper-header-position-bottom .mat-horizontal-content-container{padding:24px 24px 0 24px}.mat-vertical-content-container{display:grid;grid-template-rows:0fr;grid-template-columns:100%;margin-left:36px;border:0;position:relative}.mat-stepper-animations-enabled .mat-vertical-content-container{transition:grid-template-rows var(--mat-stepper-animation-duration, 0) cubic-bezier(0.4, 0, 0.2, 1)}.mat-vertical-content-container.mat-vertical-content-container-active{grid-template-rows:1fr}.mat-step:last-child .mat-vertical-content-container{border:none}@media(forced-colors: active){.mat-vertical-content-container{outline:solid 1px}}[dir=rtl] .mat-vertical-content-container{margin-left:0;margin-right:36px}@supports not (grid-template-rows: 0fr){.mat-vertical-content-container{height:0}.mat-vertical-content-container.mat-vertical-content-container-active{height:auto}}.mat-stepper-vertical-line::before{content:"";position:absolute;left:0;border-left-width:1px;border-left-style:solid;border-left-color:var(--mat-stepper-line-color, var(--mat-sys-outline));top:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2));bottom:calc(8px - calc((var(--mat-stepper-header-height, 72px) - 24px) / 2))}[dir=rtl] .mat-stepper-vertical-line::before{left:auto;right:0}.mat-vertical-stepper-content{overflow:hidden;outline:0;visibility:hidden}.mat-stepper-animations-enabled .mat-vertical-stepper-content{transition:visibility var(--mat-stepper-animation-duration, 0) linear}.mat-vertical-content-container-active>.mat-vertical-stepper-content{visibility:visible}.mat-vertical-content{padding:0 24px 24px 24px}'],encapsulation:2,changeDetection:0})}return J})();var jm=(()=>{class J{static \u0275fac=function(H){return new(H||J)};static \u0275mod=_s({type:J});static \u0275inj=ms({providers:[E0,dh],imports:[Pn,xm,_m,Ma,fh,rd,ed,Pn]})}return J})();function z0(J,ce){if(J&1&&ft(0),J&2){let z=ce.index;ch(" ",z+1," ")}}function D0(J,ce){if(J&1&&ft(0),J&2){let z=ce.index;ch(" ",z+1," ")}}function L0(J,ce){if(J&1&&ft(0),J&2){let z=ce.index;ch(" ",z+1," ")}}var wh=class J{_dialogRef=je(Cm);constructor(){this._dialogRef.addPanelClass("dialog-fullscreen")}static \u0275fac=function(z){return new(z||J)};static \u0275cmp=Ii({type:J,selectors:[["app-guide-dialog"]],decls:23,vars:0,consts:[["stepper",""],["mat-dialog-title",""],["mat-dialog-close",""],[1,"content"],["matStepperIcon","edit"],["matStepperIcon","done"],["matStepperIcon","number"],["align","end"],["mat-button","",3,"click"],["mat-flat-button","",3,"click"]],template:function(z,H){if(z&1){let w=mr();Xe(0,"div",1)(1,"span"),ft(2,"Install Angular"),Ye(),Xe(3,"mat-icon",2),ft(4,"close"),Ye()(),Xe(5,"mat-stepper",null,0)(7,"mat-step")(8,"div",3),ft(9," Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque?Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente, maiores. Doloremque, eius soluta odio vero consectetur hic aspernatur sunt accusantium. In, sed ut vel cumque optio distinctio libero consequuntur atque? "),Ye()(),Xe(10,"mat-step"),ft(11,"asd "),Ye(),Xe(12,"mat-step"),ft(13," asd"),Ye(),li(14,z0,1,1,"ng-template",4)(15,D0,1,1,"ng-template",5)(16,L0,1,1,"ng-template",6),Ye(),on(17,"mat-dialog-content"),Xe(18,"mat-dialog-actions",7)(19,"button",8),ci("click",function(){Wt(w);let Fe=xa(6);return Xt(Fe.previous())}),ft(20,"Poprzednie"),Ye(),Xe(21,"button",9),ci("click",function(){Wt(w);let Fe=xa(6);return Xt(Fe.next())}),ft(22,"Nast\u0119pne"),Ye()()}},dependencies:[jm,id,rd,td,Ss,gh,Am,km,Im,Pm,Em,Ma,Ca],styles:[".mat-step-label{display:none!important}  .mat-horizontal-stepper-header-container{position:sticky;top:0;background-color:var(--mat-sys-surface)}.content[_ngcontent-%COMP%]{overflow:hidden;flex:1}mat-dialog-actions[_ngcontent-%COMP%]{background-color:var(--mat-sys-surface);position:sticky;bottom:0}"],changeDetection:0})};var Is=Gp(sd());var Gm=Gp(sd());var Sh=class J{prepareMarker(){let ce=document.createElement("div");return ce.className="marker",new Gm.Marker({element:ce})}async preparePoiLayers(ce,z){ce.addSource(z,{type:"geojson",data:{type:"FeatureCollection",features:[]},cluster:!0,clusterMaxZoom:14,clusterRadius:50});let H=await ce.loadImage("https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Cyprus_road_sign_parking.svg/212px-Cyprus_road_sign_parking.svg.png?20130416124154");ce.addImage("parking-poi-icon",H.data),ce.addSource("point",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[0,0]}}]}}),ce.addLayer({id:"unclustered-point",type:"symbol",source:z,filter:["!",["has","point_count"]],layout:{"icon-image":"parking-poi-icon","icon-size":.1}}),ce.addLayer({id:"clusters",type:"circle",source:z,filter:["has","point_count"],paint:{"circle-color":Sa.primaryColor,"circle-radius":["step",["get","point_count"],20,100,30,750,40],"circle-stroke-color":"#FFFFFF","circle-stroke-width":2}}),ce.addLayer({id:"cluster-count",type:"symbol",source:z,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Roboto Regular"],"text-size":16},paint:{"text-color":"#FFFFFF"}}),ce.addSource("line-source",{type:"geojson",data:this.getLineGeoJson()}),ce.addLayer({id:"line-layer",type:"line",source:"line-source",paint:{"line-color":Sa.primaryColor,"line-width":3,"line-dasharray":[2,2]}})}getLineGeoJson(ce,z){let H=[];return ce&&z&&(H=[[ce.lng,ce.lat],[z.lng,z.lat]]),{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:H},properties:[]}]}}static \u0275fac=function(z){return new(z||J)};static \u0275prov=ya({token:J,factory:J.\u0275fac,providedIn:"root"})};var Kl=[14,48,24.5,56],R0=[Kl[0]-3,Kl[1]-3,Kl[2]+3,Kl[3]+3],F0=16,ks=class J{_mapRendererService=je(Sh);_markerMoveListener;_markerRef=this._mapRendererService.prepareMarker();_map;_selectingMode="enabled";selectedParking=En(null);_isMapLoaded=En(!1);isMapLoaded=this._isMapLoaded.asReadonly();constructor(){this._prepareAdditionalFeaturesOnLoadMap()}_prepareAdditionalFeaturesOnLoadMap(){uh(()=>{this.isMapLoaded()&&wa(()=>{this._listenForPoiClick(),this._mapRendererService.preparePoiLayers(this._map,"parkings")})})}getMarkerLatLng(){return this._markerRef?.getLngLat()}setSelectingMode(ce){this._selectingMode=ce}getMap(){return this._map}async initialRenderMap(){let ce=await import("./chunk-O5XZMIA2.js");this._map=new Is.Map({container:"map",maxBounds:R0,bounds:Kl,style:ce}).addControl(new Is.NavigationControl({showCompass:!1})).addControl(new Is.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,fitBoundsOptions:{maxZoom:17}})).on("load",()=>this._isMapLoaded.set(!0))}_listenForPoiClick(){this._map.on("click","unclustered-point",ce=>{if(this._selectingMode==="disabled")return;let z=ce.features?.[0]?.properties;this.selectedParking.set(JSON.parse(z.parking))})}renderPoiList(ce){this._map.getSource("parkings").setData({type:"FeatureCollection",features:ce.map(w=>({type:"Feature",geometry:{type:"Point",coordinates:[w.location.lng,w.location.lat]},properties:{parking:w}}))})}renderMarkerForFocusPoi(ce){this.removeMarkerForFocusPoi(),this._markerRef.setLngLat(ce).addTo(this._map)}removeMarkerForFocusPoi(){this._markerRef.remove()}renderMoveableMarker(){this.removeMoveableMarker(),this._markerRef.setLngLat(this._map.getCenter()).addTo(this._map),this._markerMoveListener=ce=>{this._markerRef.setLngLat(ce.target.getCenter()),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson(this.selectedParking()?.location,this._markerRef.getLngLat()))},this._map.on("move",this._markerMoveListener)}removeMoveableMarker(){this._markerRef.remove(),this._map.getSource("line-source").setData(this._mapRendererService.getLineGeoJson()),this._map.off("move",this._markerMoveListener)}jumpToPoi(ce){this._map.jumpTo({center:[ce.lng,ce.lat],zoom:F0})}ngOnDestroy(){this._map?.remove()}static \u0275fac=function(z){return new(z||J)};static \u0275prov=ya({token:J,factory:J.\u0275fac,providedIn:"root"})};var Ch=class J{_mapService=je(ks);parkingsList=Qp([]);constructor(){nh(()=>this._mapService.initialRenderMap()),uh(()=>{this._mapService.isMapLoaded()&&(this.parkingsList(),wa(()=>this._mapService.renderPoiList(this.parkingsList())))})}static \u0275fac=function(z){return new(z||J)};static \u0275cmp=Ii({type:J,selectors:[["app-map"]],hostAttrs:["id","map"],inputs:{parkingsList:[1,"parkingsList"]},decls:0,vars:0,template:function(z,H){},styles:[`.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors: active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors: active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors: active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors: active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors: active) and (prefers-color-scheme: light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors: active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors: active) and (prefers-color-scheme: light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover: none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}#map{height:100vh;width:100%;display:flex}#map .maplibregl-ctrl-attrib{display:none}#map .maplibregl-ctrl-group{border-radius:var(--mat-sys-corner-medium)}#map .maplibregl-ctrl-group button{width:40px;height:40px}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.marker{background-image:url("./media/parking-poi-KLDG7L2W.svg");background-size:cover;width:60px;aspect-ratio:1/1;translate:0px -50%;position:relative;animation:fadeIn .5s}
`],encapsulation:2,changeDetection:0})};var Hm=Gl("enterFadeAnimation",[Ms(":enter",[An({opacity:0}),Cs("200ms",An({opacity:1}))])]);function ld(J){return J?.injector||Jp(ld),rm(ls(ao({},J),{stream:ce=>{let z,H=()=>z.unsubscribe();ce.abortSignal.addEventListener("abort",H);let w=En({value:void 0}),p,Fe=new Promise(bt=>p=bt);function Pt(bt){w.set(bt),p?.(w),p=void 0}return z=J.loader(ce).subscribe({next:bt=>Pt({value:bt}),error:bt=>Pt({error:bt}),complete:()=>{p&&Pt({error:new Error("Resource completed before producing a value")}),ce.abortSignal.removeEventListener("abort",H)}}),Fe}}))}var Mh=class{id;created_at;updated_at};var Th=class extends Mh{location;name;description;constructor(ce){super(),Object.entries(ce).forEach(([z,H])=>{["created_at","updated_at"].includes(z)?this[z]=new Date(H):this[z]=H})}};var Es=class J{_httpClient=je(am);parkingsList=ld({loader:()=>this.getParkings(),defaultValue:[]});getParkings(){return this._httpClient.get(`${Sa.apiUrl}/parkings/`).pipe(us(ce=>ce.map(z=>new Th(z))))}postParking(ce){return this._httpClient.post(`${Sa.apiUrl}/parkings/`,ce).pipe(ps(z=>this.parkingsList.update(H=>[...H,z])))}patchParking(ce,z){return this._httpClient.patch(`${Sa.apiUrl}/parkings/${ce}/`,z).pipe(ps(H=>this.parkingsList.update(w=>w.map(p=>p.id!==ce?p:H))))}deleteParking(ce){return this._httpClient.delete(`${Sa.apiUrl}/parkings/${ce}/`).pipe(ps(()=>this.parkingsList.update(z=>z.filter(H=>H.id!==ce))))}static \u0275fac=function(z){return new(z||J)};static \u0275prov=ya({token:J,factory:J.\u0275fac,providedIn:"root"})};function B0(J,ce){if(J&1){let z=mr();Xe(0,"button",2),ci("click",function(){Wt(z);let w=mt(2);return Xt(w.startAddingPoi())}),Xe(1,"mat-icon"),ft(2,"local_parking"),Ye(),ft(3," Dodaj bezp\u0142atny parking "),Ye()}J&2&&Bt("@enterFadeAnimation",void 0)}function O0(J,ce){if(J&1){let z=mr();Xe(0,"button",3),ci("click",function(){Wt(z);let w=mt(2);return Xt(w.stopAddingPoi())}),ft(1," Anuluj "),Ye(),Xe(2,"button",2),ci("click",function(){Wt(z);let w=mt(2);return Xt(w.confirmAddedPoi())}),Xe(3,"mat-icon"),ft(4,"check"),Ye(),ft(5," Zatwierd\u017A "),Ye()}J&2&&(Bt("@enterFadeAnimation",void 0),ht(2),Bt("@enterFadeAnimation",void 0))}function V0(J,ce){if(J&1){let z=mr();Xe(0,"button",3),ci("click",function(){Wt(z);let w=mt(2);return Xt(w.stopUpdatingPoiPosition())}),ft(1," Anuluj "),Ye(),Xe(2,"button",2),ci("click",function(){Wt(z);let w=mt(2);return Xt(w.confirmUpdatedPoiPosition())}),Xe(3,"mat-icon"),ft(4,"check"),Ye(),ft(5," Zatwierd\u017A "),Ye()}J&2&&(Bt("@enterFadeAnimation",void 0),ht(2),Bt("@enterFadeAnimation",void 0))}function q0(J,ce){if(J&1&&(Xe(0,"div",0),li(1,B0,4,1,"button",1)(2,O0,6,2)(3,V0,6,2),Ye()),J&2){let z,H=mt();ht(),Ei((z=H.activeMode())===H.ACTIVE_MODE_ENUM.DEFAULT?1:z===H.ACTIVE_MODE_ENUM.ADDING_POI?2:z===H.ACTIVE_MODE_ENUM.UPDATING_POI_POSITION?3:-1)}}var Wm=(w=>(w.DEFAULT="DEFAULT",w.ADDING_POI="ADDING_POI",w.EDITING_POI="EDITING_POI",w.UPDATING_POI_POSITION="UPDATE_POI_POSITION",w))(Wm||{}),kh=class J{_mapService=je(ks);_parkingsService=je(Es);_sharedUtilsService=je(zm);ACTIVE_MODE_ENUM=Wm;activeMode=En("DEFAULT");isMapLoaded=this._mapService.isMapLoaded;constructor(){hh(()=>this._listenForSelectedPoiToStartEdit()),hh(()=>this._listenForActiveModeToSetMapState())}_listenForSelectedPoiToStartEdit(){this._mapService.selectedParking(),wa(()=>this.startEditingPoi())}_listenForActiveModeToSetMapState(){this.activeMode(),wa(()=>{this.activeMode()==="DEFAULT"?(this._mapService.selectedParking.set(null),this._mapService.setSelectingMode("enabled")):this._mapService.setSelectingMode("disabled")})}startAddingPoi(){this.activeMode.set("ADDING_POI"),this._mapService.renderMoveableMarker()}stopAddingPoi(){this._mapService.removeMoveableMarker(),this.activeMode.set("DEFAULT")}confirmAddedPoi(){let ce=this._mapService.getMarkerLatLng();this._parkingsService.postParking({location:ce}).subscribe({next:()=>{this._sharedUtilsService.openSnackbar(`Gotowe!
Oznaczenie bezp\u0142atnego parkingu zosta\u0142o dodane`,"SUCCESS")},complete:()=>{this.stopAddingPoi()}})}startEditingPoi(){if(!this._mapService.selectedParking())return;this.activeMode.set("EDITING_POI");let ce=[{label:"Popraw pozycj\u0119 na mapie",icon:"edit_location_alt",result:"UPDATE"},{label:"Usu\u0144 znacznik",icon:"wrong_location",result:"REMOVE"},{label:"Anuluj",icon:"close",result:"CANCEL"}];this._sharedUtilsService.openSheet(ce).afterDismissed().subscribe(z=>{(z==="CANCEL"||!z)&&this.activeMode.set("DEFAULT"),z==="UPDATE"&&this.startUpdatingPoiPosition(),z==="REMOVE"&&this.removePoi()})}startUpdatingPoiPosition(){let ce=this._mapService.selectedParking();ce&&(this.activeMode.set("UPDATE_POI_POSITION"),this._mapService.renderMoveableMarker(),this._mapService.jumpToPoi(ce?.location))}stopUpdatingPoiPosition(){this._mapService.removeMoveableMarker(),this.startEditingPoi()}confirmUpdatedPoiPosition(){let ce=this._mapService.selectedParking();if(!ce)return;let z=this._mapService.getMarkerLatLng();this._parkingsService.patchParking(ce.id,{location:z}).subscribe({next:()=>{this._sharedUtilsService.openSnackbar(`Gotowe!
Pozycja bezp\u0142atnego parkingu zosta\u0142a poprawiona`,"SUCCESS")},complete:()=>{this._mapService.removeMoveableMarker(),this.activeMode.set("DEFAULT")}})}removePoi(){let ce=this._mapService.selectedParking();ce&&(this._mapService.jumpToPoi({lat:ce.location.lat-.001,lng:ce.location.lng}),this._mapService.renderMarkerForFocusPoi(ce.location),this._sharedUtilsService.openDialog({title:"Usuwanie punktu",content:"Czy na pewno chcesz usun\u0105\u0107 obszar p\u0142atnego parkingu?"}).afterClosed().pipe(so(z=>z?this._parkingsService.deleteParking(ce.id).pipe(ps(()=>{this._sharedUtilsService.openSnackbar(`Gotowe!
Usuni\u0119to znacznik bezp\u0142atnego parkingu`,"SUCCESS")})).pipe(us(()=>!0)):Vl(!1))).subscribe({next:z=>{this._mapService.removeMarkerForFocusPoi(),z?this.activeMode.set("DEFAULT"):this.startEditingPoi()}}))}static \u0275fac=function(z){return new(z||J)};static \u0275cmp=Ii({type:J,selectors:[["app-poi-controller"]],decls:1,vars:1,consts:[[1,"menu-buttons-wrapper"],["mat-flat-button","",1,"menu-button"],["mat-flat-button","",1,"menu-button",3,"click"],["mat-raised-button","",1,"menu-button",3,"click"]],template:function(z,H){z&1&&li(0,q0,4,1,"div",0),z&2&&Ei(H.isMapLoaded()?0:-1)},dependencies:[xh,Ma,Ca,Ss,gh,Sm,Mm],styles:[".menu-buttons-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center;gap:10px;position:fixed;z-index:100;left:0;right:0;bottom:0;white-space:nowrap;padding:10px}.menu-buttons-wrapper[_ngcontent-%COMP%]   .menu-button[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #fff,0 0 2px 2px #00000080}"],data:{animation:[Hm]},changeDetection:0})};var Xm=class J{_matDialog=je(Tm);_parkingsService=je(Es);parkingsList=this._parkingsService.parkingsList;openHelpDialog(){this._matDialog.open(wh)}static \u0275fac=function(z){return new(z||J)};static \u0275cmp=Ii({type:J,selectors:[["app-main-page"]],decls:12,vars:2,consts:[["menu","matMenu"],["mat-mini-fab","",1,"menu-button",3,"matMenuTriggerFor"],[3,"parkingsList"],["mat-menu-item","",3,"click"]],template:function(z,H){if(z&1){let w=mr();Xe(0,"button",1)(1,"mat-icon"),ft(2,"menu"),Ye()(),on(3,"app-poi-controller")(4,"app-map",2),Xe(5,"mat-menu",null,0)(7,"button",3),ci("click",function(){return Wt(w),Xt(H.openHelpDialog())}),Xe(8,"mat-icon"),ft(9,"not_listed_location"),Ye(),Xe(10,"span"),ft(11,"Poradnik"),Ye()()()}if(z&2){let w=xa(6);Bt("matMenuTriggerFor",w),ht(4),Bt("parkingsList",H.parkingsList.value())}},dependencies:[Ch,kh,Ss,ym,Vm,Ma,Ca,xh,Ts,Xl,Bm],styles:[".menu-button[_ngcontent-%COMP%]{position:fixed;z-index:100;left:10px;top:10px;box-shadow:0 0 2px #00000080}.menu-button[_ngcontent-%COMP%]:hover, .menu-button[_ngcontent-%COMP%]:focus:active, .menu-button[_ngcontent-%COMP%]:active, .menu-button[_ngcontent-%COMP%]:focus{box-shadow:0 0 2px #00000080}"],changeDetection:0})};export{Xm as MainPageComponent};
